{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-24T10:23:36.286Z","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-24T10:23:36.288Z","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"5390940c-6d63-4a5b-aa14-67a46600c2a8","toolUseID":"5390940c-6d63-4a5b-aa14-67a46600c2a8","timestamp":"2026-02-24T10:23:35.042Z","uuid":"65f0f38e-6ed8-433b-bcd3-a76b9f6646dc"}
{"parentUuid":"65f0f38e-6ed8-433b-bcd3-a76b9f6646dc","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"a50e7c36-b099-4848-9843-c3a8b620a4ca","timestamp":"2026-02-24T10:23:36.314Z","permissionMode":"bypassPermissions"}
{"parentUuid":"a50e7c36-b099-4848-9843-c3a8b620a4ca","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01KYAVoAgz3vSjQpQQF6ry4i","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to analyze the socialhomes project and create comprehensive specification documents. Let me start by exploring the existing codebase, reading any existing docs, and understanding the project structure before creating the specification documents.\n\nLet me begin by reading existing files and exploring the project structure.","signature":"Ev0DCkYICxgCKkDDkwuS5aC0OWTNmt5IobMiCYyOKSeZz8IKCKR2gIcS6KukQ28VcK/oG3O5IjqjcE4h84T5zsOeDcMlJaYH1ckeEgxWl8vBUybhep6BbycaDNv9SxPLAd4Vr6/nYiIwPDF0+tiRXOmASEWPkRK8xYR/FlAaicWRA0VYbRb/Kiyx2bK0MiQA9oGRar4kZOEsKuQCqwkeoctSpyobdDVs+OLNE2PQmnk1goS70gKdJI4FhWYlq18NXrR1vDczSdSZhvBVT12c6wZGwal4O+exqgXhot+GnAd/KXEFViXhqBK8q/iHRbj0X1+Kc5o58q3wsB5uoNW69Zj08ywFR3cNkvOWhgoenaSsJrtMAsHXnfS6F1AZly/dpwQlRmRq02QKAAu1CoTG6l6f1xgcrDtZSqFFSgtgmMvssFp6WLRunFJL0GAyaUjJoyogtxmGRcgOp/Vxx+I35Iu/sWmAm/88iXF1ASTunZJ2B1eKLzSepPOBW95PwAhJ9JQTpR1BO305PUV0eXTT1KFPd7wc1+pMbJ9FjHVUl5lXffl3AU8/RSkKjuLBP1gOjtSMfB3lbDHSBxiI/tzePcW9VlKhWHk/Q/2glGzIf173vwANN6T/8NMXrc2Lvqliiqqx7XcWH6EqFWfVLVjrS3IOkv2BKqOC5NKcjx/cCi8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSk3oVDgXbXYDZFey3Zt","type":"assistant","uuid":"1d731ffa-2086-4b8e-8a65-e6b5231ca5d0","timestamp":"2026-02-24T10:33:37.184Z"}
{"parentUuid":"1d731ffa-2086-4b8e-8a65-e6b5231ca5d0","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01KYAVoAgz3vSjQpQQF6ry4i","type":"message","role":"assistant","content":[{"type":"text","text":"I'll start by exploring the project structure and reading all existing documentation to understand the project thoroughly before creating the specification documents."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSk3oVDgXbXYDZFey3Zt","type":"assistant","uuid":"8202e906-9794-4f16-a81a-7111491a6b12","timestamp":"2026-02-24T10:33:37.916Z"}
{"parentUuid":"8202e906-9794-4f16-a81a-7111491a6b12","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01KYAVoAgz3vSjQpQQF6ry4i","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GPSCxdTHVJVciCBwFh8ouk","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSk3oVDgXbXYDZFey3Zt","type":"assistant","uuid":"82d940aa-b3f5-46e0-bf27-d58bb1900ada","timestamp":"2026-02-24T10:33:40.367Z"}
{"parentUuid":"82d940aa-b3f5-46e0-bf27-d58bb1900ada","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GPSCxdTHVJVciCBwFh8ouk","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"829f4845-9898-4bf6-a475-6d7a2823df65","timestamp":"2026-02-24T10:33:40.377Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"82d940aa-b3f5-46e0-bf27-d58bb1900ada"}
{"parentUuid":"829f4845-9898-4bf6-a475-6d7a2823df65","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_017gmDJT5DHRV5UL8tbxuSC7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FKizLUEPuwqfEUPokcVQFA","name":"Task","input":{"subagent_type":"Explore","description":"Explore socialhomes project structure","prompt":"Very thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all folders, key files)\n2. All existing documentation files (Doc1, Doc2, Doc3, README, CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, EXECUTION-PLAN.md, any other .md or .txt files)\n3. Package.json files (root, app/, server/) - dependencies and scripts\n4. Server routes and API structure (server/src/routes/)\n5. Frontend pages and components (app/src/pages/, app/src/components/)\n6. Data models / types / interfaces\n7. Configuration files (firebase, cloud build, docker, etc.)\n8. Any existing docs/requirements/ directory\n\nRead the full contents of: CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, any existing Doc1/Doc2/Doc3 files, EXECUTION-PLAN.md if it exists, and package.json files. Also read key server route files and frontend page files to understand the full feature set."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":407,"cache_read_input_tokens":19135,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":407},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSk4KVkkmMJNZ51a2ohR","type":"assistant","uuid":"519045f6-bdb8-4456-b996-7bf3f465ad2d","timestamp":"2026-02-24T10:33:49.091Z"}
{"parentUuid":"519045f6-bdb8-4456-b996-7bf3f465ad2d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FKizLUEPuwqfEUPokcVQFA","type":"tool_result","content":[{"type":"text","text":"Excellent! Now I have a comprehensive understanding. Let me create a thorough summary report:\n\n## COMPREHENSIVE EXPLORATION: SocialHomes.Ai Project\n\n---\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native social housing management platform built for UK housing associations and local authorities. It's a complete, modern replacement for legacy systems like Civica Cx and NEC/Northgate.\n\n- **Location:** `/mnt/c/.netapps/socialhomes`\n- **Status:** Production-ready (deployed on Google Cloud Run)\n- **Git Repo:** https://github.com/rajivpeter/SocialHomes_ai\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Test Coverage:** 331 Selenium tests (99.7% pass rate)\n- **Development Status:** Phases 0-4 complete, Phase 5 (Evolution) in planning\n\n---\n\n### 2. FULL DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\nâ”œâ”€â”€ .git/                          # Git repository\nâ”œâ”€â”€ .entire/                        # Entire.io CLI session metadata\nâ”œâ”€â”€ .mission-control/               # Mission Control orchestration files\nâ”œâ”€â”€ .claude/                        # Claude Code context\nâ”œâ”€â”€ app/                            # Frontend React application\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ pages/                 # 19 page directories (40+ routes)\nâ”‚   â”‚   â”œâ”€â”€ components/            # Layout & shared components\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout/            # Header, Sidebar, Layout, etc.\nâ”‚   â”‚   â”‚   â””â”€â”€ shared/            # Reusable UI components\nâ”‚   â”‚   â”œâ”€â”€ data/                  # Frontend data files & fixtures\nâ”‚   â”‚   â”œâ”€â”€ hooks/                 # React hooks (useApi, useEntityIntelligence, etc.)\nâ”‚   â”‚   â”œâ”€â”€ services/              # API client, data fetching\nâ”‚   â”‚   â”œâ”€â”€ contexts/              # React Context (Auth, App)\nâ”‚   â”‚   â”œâ”€â”€ App.tsx                # Main router\nâ”‚   â”‚   â”œâ”€â”€ main.tsx               # Entry point\nâ”‚   â”‚   â””â”€â”€ index.css              # Global styles & animations\nâ”‚   â”œâ”€â”€ dist/                       # Built output (Vite)\nâ”‚   â”œâ”€â”€ public/                     # Static assets\nâ”‚   â”œâ”€â”€ package.json               # Dependencies (React 19, Vite, Tailwind 4)\nâ”‚   â””â”€â”€ tsconfig.json\nâ”œâ”€â”€ server/                         # Express.js backend\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ routes/                # 16 API route modules (50+ endpoints)\nâ”‚   â”‚   â”œâ”€â”€ services/              # 17 service modules (AI, external APIs, etc.)\nâ”‚   â”‚   â”œâ”€â”€ middleware/            # Auth, RBAC, rate-limiter, error-handler\nâ”‚   â”‚   â”œâ”€â”€ models/                # TypeScript interfaces\nâ”‚   â”‚   â”œâ”€â”€ index.ts               # Express app entry point\nâ”‚   â”‚   â””â”€â”€ types.ts               # Global type definitions\nâ”‚   â”œâ”€â”€ dist/                       # Compiled JavaScript\nâ”‚   â”œâ”€â”€ package.json               # Dependencies (Express, Firebase, TypeScript)\nâ”‚   â””â”€â”€ tsconfig.json\nâ”œâ”€â”€ tests/                          # Selenium test suite\nâ”‚   â”œâ”€â”€ screenshots/               # Test result screenshots\nâ”‚   â””â”€â”€ [multiple test variants]   # Deep dive, v2, v3, v5 test runs\nâ”œâ”€â”€ scripts/                        # Utility scripts\nâ”œâ”€â”€ docs/\nâ”‚   â”œâ”€â”€ requirements/              # v3.0 specification documents\nâ”‚   â”‚   â”œâ”€â”€ Doc1-socialhomes-Base-Specification.txt\nâ”‚   â”‚   â”œâ”€â”€ Doc2-socialhomes-Technical-Architecture.txt\nâ”‚   â”‚   â””â”€â”€ Doc3-socialhomes-API-Requirements.txt\nâ”‚   â”œâ”€â”€ page-screenshots/          # Screenshot documentation (10 UI pages)\nâ”‚   â””â”€â”€ ProposalSocialHomesAi.docx # Marketing proposal\nâ”œâ”€â”€ UK Housing Data Standard Version 3.5/  # Reference data (housing standards)\nâ”œâ”€â”€ node_modules/                  # Root node_modules (Puppeteer for Selenium)\nâ”œâ”€â”€ firestore.rules                # Firestore security rules\nâ”œâ”€â”€ firestore.indexes.json         # Firestore composite indexes (16 indexes)\nâ”œâ”€â”€ Dockerfile                     # Multi-stage Docker build\nâ”œâ”€â”€ cloudbuild.yaml               # Cloud Build CI/CD config\nâ”œâ”€â”€ .gitignore                    # Git ignore rules\nâ”œâ”€â”€ .mcp.json                     # Telegram MCP bot config (not committed)\nâ”œâ”€â”€ CLAUDE.md                     # Claude Code project instructions\nâ”œâ”€â”€ SESSION-HISTORY.md            # Persistent session notes (500 lines)\nâ”œâ”€â”€ DEV-FIX-LIST.md              # Bug/warning tracker\nâ”œâ”€â”€ EXECUTION-PLAN.md            # Master orchestration plan (v3.0, 346 lines)\nâ”œâ”€â”€ DEVOPS.md                    # DevOps & deployment guide (952 lines)\nâ”œâ”€â”€ README.md                    # Project readme\nâ”œâ”€â”€ Doc1-SocialHomesAi-Base-Specification.txt        # Original spec\nâ”œâ”€â”€ Doc2-SocialHomesAi-AI-Native-Features.txt        # Original AI spec\nâ”œâ”€â”€ Doc3-Public-API-Integration-Requirements.txt    # Original API spec (2,333 lines)\nâ””â”€â”€ Doc4-UI-UX-Audit-Build-Guide.md                 # UI/UX audit & build guide\n```\n\n---\n\n### 3. DOCUMENTATION FILES (Complete Reference)\n\n| File | Lines | Purpose | Status |\n|------|-------|---------|--------|\n| `CLAUDE.md` | 51 | Claude Code project instructions | Current |\n| `SESSION-HISTORY.md` | 501 | Persistent conversation history (9 sessions) | Current (Session 9: Feb 23) |\n| `DEV-FIX-LIST.md` | 97 | Bug/warning tracker from Selenium tests | Current (All issues resolved) |\n| `EXECUTION-PLAN.md` | 346 | Master execution plan (Phases 0-5, v3.0) | Current |\n| `DEVOPS.md` | 952 | DevOps, infrastructure, deployment guide | Current |\n| `docs/requirements/Doc1-socialhomes-Base-Specification.txt` | 33KB | Core product spec (v3.0) | Current |\n| `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` | 42KB | Technical architecture (v3.0) | Current |\n| `docs/requirements/Doc3-socialhomes-API-Requirements.txt` | 29KB | API & integration requirements (v3.0) | Current |\n| `Doc1-SocialHomesAi-Base-Specification.txt` | 481 | Original base specification (root) | Reference |\n| `Doc2-SocialHomesAi-AI-Native-Features.txt` | 470 | Original AI features spec (root) | Reference |\n| `Doc3-Public-API-Integration-Requirements.txt` | 2,333 | Original API requirements (root) | Reference |\n| `Doc4-UI-UX-Audit-Build-Guide.md` | 15KB | UI/UX audit & build guide | Reference |\n| `TEST-REPORT.md` | 28KB | Selenium test report v1 | Historical |\n| `TEST-REPORT-V2.md` | 86KB | Selenium test report v2 | Historical |\n\n---\n\n### 4. FRONTEND STRUCTURE (React 19 + TypeScript + Tailwind)\n\n**Technology Stack:**\n- React 19.2.0 | TypeScript 5.9.3 | Vite 7.2.4 | Tailwind CSS 4.1.18\n- Three.js 0.182.0 (3D visualization) | Leaflet 1.9.4 (Maps) | Recharts 3.7.0 (Charts)\n- React Query 5.90.20 (Data fetching) | React Router v7 | Firebase 12.9.0\n\n**File Count:** 73 TypeScript/TSX files\n\n**Pages (19 directories, 40+ routes):**\n\n1. **Dashboard** (`dashboard/DashboardPage.tsx`) â€” 8 KPI cards, charts, compliance heatmap\n2. **Briefing** (`briefing/BriefingPage.tsx`) â€” Morning briefing, AI alerts, estate selector\n3. **Explore** (`explore/ExplorePage.tsx`) â€” 7-level spatial drill-down, map/3D views, data layers\n4. **Search** (`search/SearchPage.tsx`) â€” Global search across all entities\n5. **Tenancies** (`tenancies/`) â€” List/detail, vulnerability detection, benefits check\n6. **Properties** (`properties/`) â€” List/detail, EPC data, damp intelligence, viewing booking\n7. **Repairs** (`repairs/`) â€” List/detail with workflow, AI estimates, contractor verification\n8. **Rent & Income** (`rent/RentPage.tsx`) â€” Arrears tracking, 52-week ledger, UC integration\n9. **Compliance** (`compliance/`) â€” Big 6 certificates, Awaab's Law countdown, compliance heatmap\n10. **Complaints** (`complaints/`) â€” List/detail with timeline, ombudsman tracking\n11. **ASB Cases** (`asb/`) â€” Anti-social behaviour cases with crime context\n12. **Allocations** (`allocations/AllocationsPage.tsx`) â€” Void properties, lettings workflow\n13. **Communications** (`communications/CommunicationsPage.tsx`) â€” Template-driven messaging\n14. **Reports** (`reports/`) â€” 27 pre-built reports, TSM report, dynamic report builder\n15. **AI Centre** (`ai-centre/AiCentrePage.tsx`) â€” Insights, Predictions, Differentiators, Assistant\n16. **Admin** (`admin/`) â€” Organisation, Users, Teams, Workflows, Integrations, Audit, System\n17. **Tenant Portal** (`tenant-portal/TenantPortalPage.tsx`) â€” Self-service portal\n18. **Auth** (`auth/LoginPage.tsx`) â€” Firebase email + Google sign-in\n19. **Shared** (`shared/ComingSoonPage.tsx`) â€” Placeholder pages\n\n**Components (shared + layout):**\n- **Layout:** Header, Sidebar (14 nav links), Layout wrapper, Breadcrumbs, YantraAssist (AI chat)\n- **Shared Panels:** DampIntelligencePanel, VulnerabilityPanel, BenefitsPanel, NeighbourhoodBriefingPanel, PropertyMap, KpiCard, StatusPill, CountdownTimer, ActionModal, AiActionCard, HelpDrawer, ProtectedRoute\n\n**Data Layer:**\n- `data/` â€” 8 TypeScript fixture files (estates, properties, tenants, cases, organization, regions, help content)\n- `hooks/useApi.ts` â€” 20+ React Query hooks for API integration\n- `hooks/useEntityIntelligence.ts` â€” Property/repair intelligence hooks\n- `hooks/usePersonaScope.ts` â€” Persona-scoped data filtering\n- `services/api-client.ts` â€” 50+ API methods (wrapped in axios/fetch)\n- `services/public-data.ts` â€” External data integration (weather, crime, etc.)\n\n**Routing (App.tsx):**\n- 40+ routes defined with React Router v7\n- Protected routes via `<ProtectedRoute>` wrapper\n- Layout applied to all authenticated pages\n- Root redirect: `/login` if not authenticated, `/dashboard` if authenticated\n\n---\n\n### 5. BACKEND STRUCTURE (Express.js + TypeScript + Firestore)\n\n**Technology Stack:**\n- Express.js 4.21.2 | TypeScript 5.7.0 | Node.js 20.17.0\n- Firebase Admin SDK 13.6.1 | Google Firestore | Helmet 8.1.0 | Morgan 1.10.0\n\n**File Count:** 43 TypeScript files\n\n**Route Modules (16 files, 50+ endpoints):**\n\n| Route | Purpose | Key Endpoints |\n|-------|---------|--------------|\n| `admin.ts` | Admin operations | GET /integrations, POST /toggle, POST /test, GET /monitoring |\n| `ai.ts` | AI & intelligence services | GET /damp-risk/:propertyId, GET /crime-context/:estateId, GET /vulnerability/:tenantId, GET /benefits-check/:tenantId, GET /property-passport/:propertyId, GET /briefing/:estateId, GET /notify/*, POST /notify/render, 5 mock routes |\n| `auth.ts` | Authentication | POST /login, POST /logout, POST /verify-token |\n| `booking.ts` | Property viewing booking | POST /booking, GET /booking/:id |\n| `briefing.ts` | Morning briefing | GET /briefing/:userId, GET /alerts |\n| `cases.ts` | Case management | GET /cases, POST /cases, PATCH /cases/:id, DELETE /cases/:id (with pagination) |\n| `compliance.ts` | Compliance tracking | GET /compliance, GET /compliance/:type, GET /awaabs-law |\n| `explore.ts` | Explore/drill-down | GET /hierarchy/:level/:id, GET /hierarchy/map/:zoom |\n| `export.ts` | Data export | POST /export (HACT, CSV) |\n| `lettings.ts` | Lettings workflow | GET /lettings, POST /application |\n| `properties.ts` | Property management | GET /properties, GET /properties/:id, PATCH /properties/:id |\n| `public-data.ts` | External API proxy | GET /police/:postcode, GET /weather/:lat/:lng, GET /census/:lsoaCode, GET /gas-safe/:regNum, GET /electrical-safety/:regNum |\n| `rent.ts` | Rent & income | GET /rent/:tenantId, GET /transactions/:tenantId, GET /arrears |\n| `reports.ts` | Report generation | GET /reports, GET /reports/:slug, POST /export/tsm |\n| `tenants.ts` | Tenant management | GET /tenants, GET /tenants/:id, PATCH /tenants/:id |\n\n**Service Modules (17 files):**\n\n| Service | Purpose | Technology |\n|---------|---------|-----------|\n| `external-api.ts` | API proxy framework | Caching, rate limiting, audit logging |\n| `firebase-admin.ts` | Firebase initialization | Service account authentication |\n| `firestore.ts` | Firestore queries | CRUD operations, indexing |\n| `seed.ts` + `seed-data.ts` | Test data generation | 75 properties, 68 tenants, 279 cases |\n| **AI Services** | â€” | â€” |\n| `damp-prediction.ts` | Damp intelligence | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| `crime-context.ts` | Live crime analysis | Police data correlation, hotspot detection |\n| `vulnerability-detection.ts` | Tenant vulnerability | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC) |\n| `property-passport.ts` | Property aggregation | Multi-source data dossier |\n| `benefits-engine.ts` | UK benefits analysis | 2025/26 benefit rules (UC, PIP, AA, PC, etc.) |\n| `neighbourhood-briefing.ts` | Estate intelligence | Daily briefing combining crime, damp, compliance, weather |\n| `govuk-notify.ts` | GOV.UK Notify | 24 templates across 7 categories (rent, repairs, ASB, compliance, tenancy, damp, general) |\n| `census-nomis.ts` | Census/NOMIS/Gas Safe | Census 2021 (ONS), labour market, gas/electrical safety checks |\n| `mock-services.ts` | Tier 3 mock APIs | Repairs marketplace, regulatory, DocuSign, referencing, Land Registry |\n| **Infrastructure** | â€” | â€” |\n| `monitoring.ts` | Health & metrics | Request counts, response times, status codes, cache stats |\n\n**Middleware (5 files):**\n\n| Middleware | Purpose |\n|-----------|---------|\n| `auth.ts` | Firebase token verification, persona extraction |\n| `rbac.ts` | Role-based access control (COO/Head/Manager/Officer/Operative) |\n| `rate-limiter.ts` | Sliding window rate limiting (API 100/min, Auth 10/min, AI 30/min, Admin 20/min) |\n| `error-handler.ts` | Structured error logging, no stack leaks in production |\n| `metrics.ts` | Request lifecycle metrics collection |\n\n**Data Models (types.ts):**\n- 30+ TypeScript interfaces for entities (Property, Tenant, Case, Repair, Complaint, ASB, Activity, Communication, RentTransaction, etc.)\n\n---\n\n### 6. FIRESTORE SCHEMA\n\n**Collections (17 total, ~550 documents):**\n\n| Collection | Documents | Indexes | Purpose |\n|-----------|-----------|---------|---------|\n| `properties` | 75 | 3 | Housing stock (buildings, flats) |\n| `tenants` | 68 | 2 | Tenancy records (household, accounts) |\n| `cases` | 279+ | 5 | Universal case management (repairs, complaints, ASB, damp, financial) |\n| `organisations` | 1 | â€” | Organisation metadata |\n| `regions` | 3 | â€” | Geographic hierarchy (London, South, Midlands) |\n| `localAuthorities` | 5 | 1 | Local authority boundaries |\n| `estates` | 5 | 1 | Housing estates (Oak Park, Riverside, etc.) |\n| `blocks` | 8 | 1 | Building blocks within estates |\n| `activities` | 500+ | 2 | Case activity timeline (notes, status changes) |\n| `communications` | 50+ | â€” | Messages, emails, SMS |\n| `rentTransactions` | 1000+ | 1 | Rent payment ledger |\n| `users` | 10+ | â€” | Staff user accounts |\n| `auditLog` | 500+ | 1 | Audit trail (compliance) |\n| `notifications` | 100+ | â€” | In-app notifications |\n| `hactCodes` | 100+ | â€” | HACT reference codes |\n| `voidProperties` | 10+ | â€” | Void tracking |\n| `applicants` | 50+ | â€” | Housing applicants |\n| `externalDataCache` | 500+ | â€” | API response cache (TTL-managed) |\n| `tsmMeasures` | 50+ | â€” | Tenant Service Measures |\n\n**Security Rules:** Role-based access control (5 personas) with read/write/create/delete permissions per collection\n\n**Indexes:** 16 composite indexes optimizing query patterns (type+status+date, tenantId+date, propertyId+status, etc.)\n\n---\n\n### 7. API ARCHITECTURE\n\n**Integration Strategy:** Server-side proxy pattern with caching, rate limiting, and fallback strategies.\n\n**Tier 1 APIs (3 live, no registration):**\n- **Police.uk** â€” Street-level crime data (crime-context.ts, Explore map)\n- **Open-Meteo** â€” Weather forecasting (damp-prediction.ts, briefing)\n- **DEFRA Flood Risk** â€” Flood warnings per property\n\n**Tier 2 APIs (6 live + simulated fallbacks):**\n- **Postcodes.io** â€” Postcode lookup, LSOA, lat/long\n- **EPC.gov.uk** â€” Energy Performance Certificates\n- **NOMIS (ONS)** â€” Census 2021, labour market data\n- **Gas Safe Register** â€” Contractor verification\n- **Electrical Safety Register** â€” Contractor verification\n- **Land Registry** â€” Property title data\n\n**Tier 3 APIs (5 mock, production-realistic):**\n- **DWP UC Verification** â€” Universal Credit data (mocked)\n- **IoT Sensors** â€” Switchee/Aico temperature/humidity (mocked)\n- **GoCardless** â€” Direct debit processing (mocked)\n- **DocuSign** â€” Digital signing (mocked)\n- **Experian/TransUnion** â€” Credit referencing (mocked)\n\n**API Response Caching:**\n- Custom TTL per endpoint (24h for crime, 1h for weather, etc.)\n- Firestore `externalDataCache` collection with TTL management\n- Cache-through pattern (fetch on miss, cache result)\n\n**Rate Limiting (4 tiers):**\n- API routes: 100 req/min\n- Auth routes: 10 req/min\n- AI routes: 30 req/min\n- Admin routes: 20 req/min\n\n**Response Format:**\n- All responses wrapped in `{ success: boolean, data: T, error?: string }`\n- Pagination for list endpoints (offset, page, pageSize, totalPages)\n- Standardized error codes\n\n---\n\n### 8. KEY FEATURES & DIFFERENTIATORS\n\n**7 \"Killer Differentiators\" (implemented in Phase 2):**\n\n1. **Predictive Damp Intelligence** â€” 5-factor ML algorithm (weather, building condition, history, sensors, occupancy)\n2. **Live Crime Context for ASB** â€” Real-time police data correlation with internal cases\n3. **Automatic Vulnerability Detection** â€” 7-factor tenant scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Property Passport** â€” Multi-source property dossier (title, surveys, compliance, systems, asbestos, EPC)\n5. **Benefits Entitlement Engine** â€” UK 2025/26 benefit rules analysis\n6. **AI Neighbourhood Briefing** â€” Daily estate-level intelligence combining all data sources\n7. **GOV.UK Notify Integration** â€” 24 templates across 7 categories (rent, repairs, ASB, compliance, tenancy, damp, general)\n\n**AI Features:**\n- YantraAssist â€” Contextual AI chat panel (currently mock, Vertex AI integration planned Phase 5)\n- Dynamic forms & action flows (AI-suggested next steps)\n- AI-powered insights, predictions, recommendations\n- Entity intelligence hooks for property/repair/tenant context\n\n**UI/UX Highlights:**\n- Dark theme with Yantra teal accent (#14B8A6)\n- Bloomberg Terminal meets Figma aesthetic (not legacy government forms)\n- 40+ routes with full WCAG AA accessibility\n- Breadcrumb navigation\n- Responsive design (mobile/tablet/desktop)\n- Full-screen help drawer with contextual guides\n- Skeleton screens & lazy loading\n- 3D building visualization (Three.js)\n- Interactive Leaflet maps with data layer toggles\n\n---\n\n### 9. TESTING & QUALITY\n\n**Selenium Test Suite (331 tests, 99.7% pass rate):**\n- All 14 sidebar navigation links functional\n- All 40+ pages load and render correctly\n- CRUD operations working\n- Navigation flows tested\n- Data fetching verified\n- Form submissions tested\n- Error states validated\n\n**Covered Areas:**\n- Authentication (Firebase email + Google)\n- Dashboard KPIs, charts, compliance, activity\n- Tenancies: list, detail, vulnerability, benefits\n- Properties: list, detail, damp intelligence, EPC, map\n- Repairs: 200 items, full workflow, AI estimates\n- Complaints: 34 items, timeline, ombudsman\n- ASB: 12 cases with crime context\n- Rent: arrears tracking, 52-week ledger\n- Compliance: Big 6, Awaab's Law\n- Communications: templates, AI analysis\n- Reports: 27 pre-built + TSM\n- AI Centre: insights, predictions, differentiators\n- Admin: all 7 sub-pages\n- Tenant Portal: self-service\n- Explore: map drill-down, 3D views\n- Yantra Assist: chat trigger, panel\n\n**TypeScript Quality:**\n- 0 compilation errors (strict mode)\n- 0 React errors (Rules of Hooks verified)\n- All 73 frontend files typed\n- All 43 backend files typed\n\n**Build Metrics:**\n- Vite build: ~3,400 modules, ~38s\n- Bundle size: ~2.5MB JS\n- Cloud Run cold start: <2s\n- Response time P95: ~200-300ms\n\n---\n\n### 10. DEPLOYMENT & INFRASTRUCTURE\n\n**Cloud Platform:** Google Cloud Run (europe-west2)\n- **Service URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Health Check:** /health endpoint (Firestore connectivity + memory)\n- **Instance Config:** 1 GB memory, 1 CPU, 0-10 instances (auto-scaling)\n- **Port:** 8080 (Cloud Run default)\n\n**Docker Build (Multi-stage):**\n- Stage 1: Build React frontend (npm ci, vite build)\n- Stage 2: Build Express backend (npm ci, tsc)\n- Stage 3: Production image (node:20-slim with production deps only)\n\n**CI/CD Pipeline:**\n- GitHub â†’ Cloud Build trigger on `main` push\n- Build steps: docker build â†’ push to Artifact Registry â†’ gcloud run deploy\n- Artifact Registry: `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n\n**Secrets Management (4 secrets in Secret Manager):**\n- `FIREBASE_API_KEY` â€” Public API key\n- `FIREBASE_AUTH_DOMAIN` â€” Firebase project domain\n- `FIREBASE_PROJECT_ID` â€” Firestore project ID\n- `DEMO_USER_PASSWORD` â€” Demo user credential\n\n**Security Hardening:**\n- Content Security Policy (CSP) with Google APIs, Firebase, OSM, Fonts whitelisted\n- CORS restricted to known origins (localhost + Cloud Run)\n- Helmet middleware (X-Frame-Options, X-Content-Type-Options, etc.)\n- Rate limiting (4 tiers per endpoint type)\n- Request correlation ID (X-Request-ID)\n- Structured error logging (no stack leaks in production)\n- JSON body limit: 1MB\n\n**Monitoring & Health:**\n- Custom metrics singleton (request counts, response times, status codes, cache stats)\n- Health endpoint returns: Firestore connectivity, memory usage, uptime, degraded/unhealthy states\n- Morgan request logging\n- Metrics dashboard (admin `/admin/monitoring` route)\n\n---\n\n### 11. PROJECT MANAGEMENT & EXECUTION PLAN\n\n**Master Execution Plan (v3.0, Phases 0-5):**\n\n| Phase | Name | Status | Tasks | Purpose |\n|-------|------|--------|-------|---------|\n| 0 | Infrastructure | âœ… DONE | 10/10 | Setup, testing, config |\n| 1 | Foundation | âœ… DONE | 12/12 | Free APIs, caching, external integrations |\n| 2 | Intelligence | âœ… DONE | 14/14 | 7 differentiators, AI services, mock endpoints |\n| 3 | Enrichment | âœ… DONE | 14/17 | Tier 2 APIs, GOV.UK Notify, accessibility |\n| 4 | Completion | âœ… DONE | 11/14 | Mock services, admin dashboard, security, monitoring |\n| 5 | Evolution | ðŸ”µ TODO | 38 tasks | Real AI (Vertex AI), WebSocket, testing, DevOps |\n\n**Phase 5 Breakdown (38 tasks across 5 sub-phases):**\n- 5.1: Project Setup & Architecture (8 tasks)\n- 5.2: Backend Development (12 tasks)\n- 5.3: Frontend Development (9 tasks)\n- 5.4: Testing & QA (7 tasks)\n- 5.5: DevOps & Deployment (8 tasks)\n\n**Critical Path (Recommended Execution Order):**\n1. 5.1.3 â†’ 5.2.1 â†’ 5.2.2 (Vertex AI architecture â†’ implementation â†’ prompts)\n2. 5.1.4 â†’ 5.2.3 (WebSocket design â†’ implementation)\n3. 5.5.1 (Fix cloudbuild.yaml â€” unblocks CI)\n4. 5.2.4 (Notification dispatch â€” depends on WebSocket)\n5. 5.3.1 (Yantra Assist UI â€” depends on Vertex AI backend)\n6. 5.4.1â€“5.4.7 (Testing suite â€” parallel with features)\n7. 5.5.2â€“5.5.8 (Infrastructure hardening)\n\n**Agent Responsibilities:**\n- **Fullstack:** Routes, API integrations, data models, Firestore, AI services\n- **Frontend:** UI components, pages, state management, styling, accessibility\n- **Tester:** E2E, unit tests, integration tests, load tests, a11y audits\n- **BA:** Requirements, specs, user stories, API reference\n- **DevOps:** CI/CD, monitoring, security, infrastructure, scaling, backups\n\n---\n\n### 12. SESSION CONTINUITY & DOCUMENTATION\n\n**SESSION-HISTORY.md (9 sessions documented):**\n1. Initial setup (Feb 12) â€” GCP/Telegram config\n2. Security cleanup (Feb 13) â€” API keys removal, UI polish\n3. Bug fixes (Feb 14) â€” 11 Selenium warnings resolved\n4. Telegram MCP setup (Feb 14) â€” Bot integration\n5. Phase 2 Completion (Feb 15) â€” All 7 differentiators implemented\n6. Phase 3 Enrichment (Feb 16) â€” GOV.UK Notify, Census/NOMIS, accessibility\n7. Phase 4 Completion (Feb 16) â€” Mock services, admin dashboard, security\n8. Cloud Run deployment (Feb 16-18) â€” Secret Manager, live deployment\n9. BA Spec Refresh (Feb 23) â€” Comprehensive v3.0 documentation\n\n**Key Files to Maintain:**\n- `CLAUDE.md` â€” Always read at session start\n- `SESSION-HISTORY.md` â€” Update at session end with what was done, files changed, commits made\n- `DEV-FIX-LIST.md` â€” Track bugs/warnings\n- `EXECUTION-PLAN.md` â€” Update task progress\n- `DEVOPS.md` â€” Maintain deployment procedures\n\n---\n\n### 13. KEY NUMBERS & STATS\n\n| Metric | Value |\n|--------|-------|\n| Frontend TypeScript/TSX Files | 73 |\n| Backend TypeScript Files | 43 |\n| Frontend Pages | 40+ routes across 19 directories |\n| Backend API Endpoints | 50+ |\n| Firestore Collections | 17 |\n| Firestore Documents | ~550 seeded, scalable to 50,000+ |\n| Personas | 5 (COO, Head of Housing, Manager, Officer, Operative) |\n| CSS Framework | Tailwind 4.1.18 |\n| Test Coverage | 331 Selenium tests (99.7% pass) |\n| TypeScript Errors | 0 |\n| Vite Build Modules | ~3,400 |\n| Bundle Size | ~2.5MB JS |\n| API Integrations | 20 (3 Tier 1, 6 Tier 2, 5 Tier 3 mock, 6 Tier 3 planned) |\n| AI Services | 7 implemented (damp, crime, vulnerability, property passport, benefits, briefing, notify) |\n| Caching Strategy | Cache-through with TTL per endpoint |\n| Rate Limit Tiers | 4 (API, Auth, AI, Admin) |\n| Cloud Run Region | europe-west2 |\n| Live URL | https://socialhomes-587984201316.europe-west2.run.app |\n| GitHub Repo | rajivpeter/SocialHomes_ai |\n| Lines of Code (Docs) | 5,231 in root documentation alone |\n| Original Spec Size | 3,284 lines (Doc1, Doc2, Doc3 combined) |\n| Updated Spec Size | 104KB (Doc1, Doc2, Doc3 in docs/requirements/) |\n\n---\n\n### 14. CURRENT STATUS SUMMARY\n\n**What's Complete:**\n- All core UI (40+ pages, 14 navigation links)\n- All major integrations (3 Tier 1, 6 Tier 2, 5 Tier 3 mock)\n- All 7 killer differentiators\n- Full Firestore schema with 17 collections\n- Complete API with 50+ endpoints\n- Authentication (Firebase + Google SSO)\n- Admin dashboard with integrations page\n- GOV.UK Notify templates (24 templates)\n- Security hardening (CSP, CORS, rate limiting, helmet)\n- Monitoring & health checks\n- Docker containerization\n- Cloud Run deployment (live & working)\n- Selenium test suite (331 tests, 99.7% pass)\n- Comprehensive documentation (v3.0 specs)\n\n**What's Next (Phase 5):**\n- Real Vertex AI integration for Yantra Assist (replacing mock chat)\n- WebSocket server (Socket.io) for real-time notifications\n- Notification bell with real-time updates\n- AI communication drafting (LLM-powered email generation)\n- Real-time case status indicators\n- Workflow builder UI (drag-and-drop)\n- Dark/light theme toggle\n- Full regression test suite\n- Load testing (100 concurrent users)\n- Staging environment (Cloud Run)\n- Custom domain (socialhomes.ai)\n- Monitoring alerts & runbook\n\n---\n\n### 15. IMPORTANT NOTES FOR FUTURE SESSIONS\n\n1. **Always start by reading:** `CLAUDE.md` + `SESSION-HISTORY.md`\n2. **Update at session end:** Add to `SESSION-HISTORY.md` what was done, files changed, commits made, decisions taken\n3. **Convention reminders:**\n   - Tailwind dark theme with brand teal (#14B8A6) accent\n   - Use `safeText()` helper for undefined values\n   - Use `?? []` for nullable arrays (React Error #310 prevention)\n   - API routes in `server/src/routes/`\n   - Frontend pages in `app/src/pages/`\n   - Shared components in `app/src/components/shared/`\n4. **Telegram notifications:** Use `mcp__telegram__notify_user` for async updates\n5. **Build before deploying:** `npm run build` both app/ and server/, then `git push origin main`\n6. **Never commit:** .env files, API keys, .mcp.json (already in .gitignore)\n7. **npm install note:** Use `--legacy-peer-deps` for firebaseui conflict\n8. **Entire.io:** Captures sessions on every commit (manual-commit strategy)\n\n---\n\nThis comprehensive exploration gives you a complete map of the SocialHomes.Ai project. All paths are absolute and verified. The project is production-ready with 99.7% test coverage and all documentation synchronized."},{"type":"text","text":"agentId: a830718dfbe271a3d (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 74404\ntool_uses: 30\nduration_ms: 109690</usage>"}]}]},"uuid":"dec82303-2e4e-4488-b4a6-4e3b805044f7","timestamp":"2026-02-24T10:38:53.974Z","toolUseResult":{"status":"completed","prompt":"Very thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all folders, key files)\n2. All existing documentation files (Doc1, Doc2, Doc3, README, CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, EXECUTION-PLAN.md, any other .md or .txt files)\n3. Package.json files (root, app/, server/) - dependencies and scripts\n4. Server routes and API structure (server/src/routes/)\n5. Frontend pages and components (app/src/pages/, app/src/components/)\n6. Data models / types / interfaces\n7. Configuration files (firebase, cloud build, docker, etc.)\n8. Any existing docs/requirements/ directory\n\nRead the full contents of: CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, any existing Doc1/Doc2/Doc3 files, EXECUTION-PLAN.md if it exists, and package.json files. Also read key server route files and frontend page files to understand the full feature set.","agentId":"a830718dfbe271a3d","content":[{"type":"text","text":"Excellent! Now I have a comprehensive understanding. Let me create a thorough summary report:\n\n## COMPREHENSIVE EXPLORATION: SocialHomes.Ai Project\n\n---\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native social housing management platform built for UK housing associations and local authorities. It's a complete, modern replacement for legacy systems like Civica Cx and NEC/Northgate.\n\n- **Location:** `/mnt/c/.netapps/socialhomes`\n- **Status:** Production-ready (deployed on Google Cloud Run)\n- **Git Repo:** https://github.com/rajivpeter/SocialHomes_ai\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Test Coverage:** 331 Selenium tests (99.7% pass rate)\n- **Development Status:** Phases 0-4 complete, Phase 5 (Evolution) in planning\n\n---\n\n### 2. FULL DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\nâ”œâ”€â”€ .git/                          # Git repository\nâ”œâ”€â”€ .entire/                        # Entire.io CLI session metadata\nâ”œâ”€â”€ .mission-control/               # Mission Control orchestration files\nâ”œâ”€â”€ .claude/                        # Claude Code context\nâ”œâ”€â”€ app/                            # Frontend React application\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ pages/                 # 19 page directories (40+ routes)\nâ”‚   â”‚   â”œâ”€â”€ components/            # Layout & shared components\nâ”‚   â”‚   â”‚   â”œâ”€â”€ layout/            # Header, Sidebar, Layout, etc.\nâ”‚   â”‚   â”‚   â””â”€â”€ shared/            # Reusable UI components\nâ”‚   â”‚   â”œâ”€â”€ data/                  # Frontend data files & fixtures\nâ”‚   â”‚   â”œâ”€â”€ hooks/                 # React hooks (useApi, useEntityIntelligence, etc.)\nâ”‚   â”‚   â”œâ”€â”€ services/              # API client, data fetching\nâ”‚   â”‚   â”œâ”€â”€ contexts/              # React Context (Auth, App)\nâ”‚   â”‚   â”œâ”€â”€ App.tsx                # Main router\nâ”‚   â”‚   â”œâ”€â”€ main.tsx               # Entry point\nâ”‚   â”‚   â””â”€â”€ index.css              # Global styles & animations\nâ”‚   â”œâ”€â”€ dist/                       # Built output (Vite)\nâ”‚   â”œâ”€â”€ public/                     # Static assets\nâ”‚   â”œâ”€â”€ package.json               # Dependencies (React 19, Vite, Tailwind 4)\nâ”‚   â””â”€â”€ tsconfig.json\nâ”œâ”€â”€ server/                         # Express.js backend\nâ”‚   â”œâ”€â”€ src/\nâ”‚   â”‚   â”œâ”€â”€ routes/                # 16 API route modules (50+ endpoints)\nâ”‚   â”‚   â”œâ”€â”€ services/              # 17 service modules (AI, external APIs, etc.)\nâ”‚   â”‚   â”œâ”€â”€ middleware/            # Auth, RBAC, rate-limiter, error-handler\nâ”‚   â”‚   â”œâ”€â”€ models/                # TypeScript interfaces\nâ”‚   â”‚   â”œâ”€â”€ index.ts               # Express app entry point\nâ”‚   â”‚   â””â”€â”€ types.ts               # Global type definitions\nâ”‚   â”œâ”€â”€ dist/                       # Compiled JavaScript\nâ”‚   â”œâ”€â”€ package.json               # Dependencies (Express, Firebase, TypeScript)\nâ”‚   â””â”€â”€ tsconfig.json\nâ”œâ”€â”€ tests/                          # Selenium test suite\nâ”‚   â”œâ”€â”€ screenshots/               # Test result screenshots\nâ”‚   â””â”€â”€ [multiple test variants]   # Deep dive, v2, v3, v5 test runs\nâ”œâ”€â”€ scripts/                        # Utility scripts\nâ”œâ”€â”€ docs/\nâ”‚   â”œâ”€â”€ requirements/              # v3.0 specification documents\nâ”‚   â”‚   â”œâ”€â”€ Doc1-socialhomes-Base-Specification.txt\nâ”‚   â”‚   â”œâ”€â”€ Doc2-socialhomes-Technical-Architecture.txt\nâ”‚   â”‚   â””â”€â”€ Doc3-socialhomes-API-Requirements.txt\nâ”‚   â”œâ”€â”€ page-screenshots/          # Screenshot documentation (10 UI pages)\nâ”‚   â””â”€â”€ ProposalSocialHomesAi.docx # Marketing proposal\nâ”œâ”€â”€ UK Housing Data Standard Version 3.5/  # Reference data (housing standards)\nâ”œâ”€â”€ node_modules/                  # Root node_modules (Puppeteer for Selenium)\nâ”œâ”€â”€ firestore.rules                # Firestore security rules\nâ”œâ”€â”€ firestore.indexes.json         # Firestore composite indexes (16 indexes)\nâ”œâ”€â”€ Dockerfile                     # Multi-stage Docker build\nâ”œâ”€â”€ cloudbuild.yaml               # Cloud Build CI/CD config\nâ”œâ”€â”€ .gitignore                    # Git ignore rules\nâ”œâ”€â”€ .mcp.json                     # Telegram MCP bot config (not committed)\nâ”œâ”€â”€ CLAUDE.md                     # Claude Code project instructions\nâ”œâ”€â”€ SESSION-HISTORY.md            # Persistent session notes (500 lines)\nâ”œâ”€â”€ DEV-FIX-LIST.md              # Bug/warning tracker\nâ”œâ”€â”€ EXECUTION-PLAN.md            # Master orchestration plan (v3.0, 346 lines)\nâ”œâ”€â”€ DEVOPS.md                    # DevOps & deployment guide (952 lines)\nâ”œâ”€â”€ README.md                    # Project readme\nâ”œâ”€â”€ Doc1-SocialHomesAi-Base-Specification.txt        # Original spec\nâ”œâ”€â”€ Doc2-SocialHomesAi-AI-Native-Features.txt        # Original AI spec\nâ”œâ”€â”€ Doc3-Public-API-Integration-Requirements.txt    # Original API spec (2,333 lines)\nâ””â”€â”€ Doc4-UI-UX-Audit-Build-Guide.md                 # UI/UX audit & build guide\n```\n\n---\n\n### 3. DOCUMENTATION FILES (Complete Reference)\n\n| File | Lines | Purpose | Status |\n|------|-------|---------|--------|\n| `CLAUDE.md` | 51 | Claude Code project instructions | Current |\n| `SESSION-HISTORY.md` | 501 | Persistent conversation history (9 sessions) | Current (Session 9: Feb 23) |\n| `DEV-FIX-LIST.md` | 97 | Bug/warning tracker from Selenium tests | Current (All issues resolved) |\n| `EXECUTION-PLAN.md` | 346 | Master execution plan (Phases 0-5, v3.0) | Current |\n| `DEVOPS.md` | 952 | DevOps, infrastructure, deployment guide | Current |\n| `docs/requirements/Doc1-socialhomes-Base-Specification.txt` | 33KB | Core product spec (v3.0) | Current |\n| `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` | 42KB | Technical architecture (v3.0) | Current |\n| `docs/requirements/Doc3-socialhomes-API-Requirements.txt` | 29KB | API & integration requirements (v3.0) | Current |\n| `Doc1-SocialHomesAi-Base-Specification.txt` | 481 | Original base specification (root) | Reference |\n| `Doc2-SocialHomesAi-AI-Native-Features.txt` | 470 | Original AI features spec (root) | Reference |\n| `Doc3-Public-API-Integration-Requirements.txt` | 2,333 | Original API requirements (root) | Reference |\n| `Doc4-UI-UX-Audit-Build-Guide.md` | 15KB | UI/UX audit & build guide | Reference |\n| `TEST-REPORT.md` | 28KB | Selenium test report v1 | Historical |\n| `TEST-REPORT-V2.md` | 86KB | Selenium test report v2 | Historical |\n\n---\n\n### 4. FRONTEND STRUCTURE (React 19 + TypeScript + Tailwind)\n\n**Technology Stack:**\n- React 19.2.0 | TypeScript 5.9.3 | Vite 7.2.4 | Tailwind CSS 4.1.18\n- Three.js 0.182.0 (3D visualization) | Leaflet 1.9.4 (Maps) | Recharts 3.7.0 (Charts)\n- React Query 5.90.20 (Data fetching) | React Router v7 | Firebase 12.9.0\n\n**File Count:** 73 TypeScript/TSX files\n\n**Pages (19 directories, 40+ routes):**\n\n1. **Dashboard** (`dashboard/DashboardPage.tsx`) â€” 8 KPI cards, charts, compliance heatmap\n2. **Briefing** (`briefing/BriefingPage.tsx`) â€” Morning briefing, AI alerts, estate selector\n3. **Explore** (`explore/ExplorePage.tsx`) â€” 7-level spatial drill-down, map/3D views, data layers\n4. **Search** (`search/SearchPage.tsx`) â€” Global search across all entities\n5. **Tenancies** (`tenancies/`) â€” List/detail, vulnerability detection, benefits check\n6. **Properties** (`properties/`) â€” List/detail, EPC data, damp intelligence, viewing booking\n7. **Repairs** (`repairs/`) â€” List/detail with workflow, AI estimates, contractor verification\n8. **Rent & Income** (`rent/RentPage.tsx`) â€” Arrears tracking, 52-week ledger, UC integration\n9. **Compliance** (`compliance/`) â€” Big 6 certificates, Awaab's Law countdown, compliance heatmap\n10. **Complaints** (`complaints/`) â€” List/detail with timeline, ombudsman tracking\n11. **ASB Cases** (`asb/`) â€” Anti-social behaviour cases with crime context\n12. **Allocations** (`allocations/AllocationsPage.tsx`) â€” Void properties, lettings workflow\n13. **Communications** (`communications/CommunicationsPage.tsx`) â€” Template-driven messaging\n14. **Reports** (`reports/`) â€” 27 pre-built reports, TSM report, dynamic report builder\n15. **AI Centre** (`ai-centre/AiCentrePage.tsx`) â€” Insights, Predictions, Differentiators, Assistant\n16. **Admin** (`admin/`) â€” Organisation, Users, Teams, Workflows, Integrations, Audit, System\n17. **Tenant Portal** (`tenant-portal/TenantPortalPage.tsx`) â€” Self-service portal\n18. **Auth** (`auth/LoginPage.tsx`) â€” Firebase email + Google sign-in\n19. **Shared** (`shared/ComingSoonPage.tsx`) â€” Placeholder pages\n\n**Components (shared + layout):**\n- **Layout:** Header, Sidebar (14 nav links), Layout wrapper, Breadcrumbs, YantraAssist (AI chat)\n- **Shared Panels:** DampIntelligencePanel, VulnerabilityPanel, BenefitsPanel, NeighbourhoodBriefingPanel, PropertyMap, KpiCard, StatusPill, CountdownTimer, ActionModal, AiActionCard, HelpDrawer, ProtectedRoute\n\n**Data Layer:**\n- `data/` â€” 8 TypeScript fixture files (estates, properties, tenants, cases, organization, regions, help content)\n- `hooks/useApi.ts` â€” 20+ React Query hooks for API integration\n- `hooks/useEntityIntelligence.ts` â€” Property/repair intelligence hooks\n- `hooks/usePersonaScope.ts` â€” Persona-scoped data filtering\n- `services/api-client.ts` â€” 50+ API methods (wrapped in axios/fetch)\n- `services/public-data.ts` â€” External data integration (weather, crime, etc.)\n\n**Routing (App.tsx):**\n- 40+ routes defined with React Router v7\n- Protected routes via `<ProtectedRoute>` wrapper\n- Layout applied to all authenticated pages\n- Root redirect: `/login` if not authenticated, `/dashboard` if authenticated\n\n---\n\n### 5. BACKEND STRUCTURE (Express.js + TypeScript + Firestore)\n\n**Technology Stack:**\n- Express.js 4.21.2 | TypeScript 5.7.0 | Node.js 20.17.0\n- Firebase Admin SDK 13.6.1 | Google Firestore | Helmet 8.1.0 | Morgan 1.10.0\n\n**File Count:** 43 TypeScript files\n\n**Route Modules (16 files, 50+ endpoints):**\n\n| Route | Purpose | Key Endpoints |\n|-------|---------|--------------|\n| `admin.ts` | Admin operations | GET /integrations, POST /toggle, POST /test, GET /monitoring |\n| `ai.ts` | AI & intelligence services | GET /damp-risk/:propertyId, GET /crime-context/:estateId, GET /vulnerability/:tenantId, GET /benefits-check/:tenantId, GET /property-passport/:propertyId, GET /briefing/:estateId, GET /notify/*, POST /notify/render, 5 mock routes |\n| `auth.ts` | Authentication | POST /login, POST /logout, POST /verify-token |\n| `booking.ts` | Property viewing booking | POST /booking, GET /booking/:id |\n| `briefing.ts` | Morning briefing | GET /briefing/:userId, GET /alerts |\n| `cases.ts` | Case management | GET /cases, POST /cases, PATCH /cases/:id, DELETE /cases/:id (with pagination) |\n| `compliance.ts` | Compliance tracking | GET /compliance, GET /compliance/:type, GET /awaabs-law |\n| `explore.ts` | Explore/drill-down | GET /hierarchy/:level/:id, GET /hierarchy/map/:zoom |\n| `export.ts` | Data export | POST /export (HACT, CSV) |\n| `lettings.ts` | Lettings workflow | GET /lettings, POST /application |\n| `properties.ts` | Property management | GET /properties, GET /properties/:id, PATCH /properties/:id |\n| `public-data.ts` | External API proxy | GET /police/:postcode, GET /weather/:lat/:lng, GET /census/:lsoaCode, GET /gas-safe/:regNum, GET /electrical-safety/:regNum |\n| `rent.ts` | Rent & income | GET /rent/:tenantId, GET /transactions/:tenantId, GET /arrears |\n| `reports.ts` | Report generation | GET /reports, GET /reports/:slug, POST /export/tsm |\n| `tenants.ts` | Tenant management | GET /tenants, GET /tenants/:id, PATCH /tenants/:id |\n\n**Service Modules (17 files):**\n\n| Service | Purpose | Technology |\n|---------|---------|-----------|\n| `external-api.ts` | API proxy framework | Caching, rate limiting, audit logging |\n| `firebase-admin.ts` | Firebase initialization | Service account authentication |\n| `firestore.ts` | Firestore queries | CRUD operations, indexing |\n| `seed.ts` + `seed-data.ts` | Test data generation | 75 properties, 68 tenants, 279 cases |\n| **AI Services** | â€” | â€” |\n| `damp-prediction.ts` | Damp intelligence | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| `crime-context.ts` | Live crime analysis | Police data correlation, hotspot detection |\n| `vulnerability-detection.ts` | Tenant vulnerability | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC) |\n| `property-passport.ts` | Property aggregation | Multi-source data dossier |\n| `benefits-engine.ts` | UK benefits analysis | 2025/26 benefit rules (UC, PIP, AA, PC, etc.) |\n| `neighbourhood-briefing.ts` | Estate intelligence | Daily briefing combining crime, damp, compliance, weather |\n| `govuk-notify.ts` | GOV.UK Notify | 24 templates across 7 categories (rent, repairs, ASB, compliance, tenancy, damp, general) |\n| `census-nomis.ts` | Census/NOMIS/Gas Safe | Census 2021 (ONS), labour market, gas/electrical safety checks |\n| `mock-services.ts` | Tier 3 mock APIs | Repairs marketplace, regulatory, DocuSign, referencing, Land Registry |\n| **Infrastructure** | â€” | â€” |\n| `monitoring.ts` | Health & metrics | Request counts, response times, status codes, cache stats |\n\n**Middleware (5 files):**\n\n| Middleware | Purpose |\n|-----------|---------|\n| `auth.ts` | Firebase token verification, persona extraction |\n| `rbac.ts` | Role-based access control (COO/Head/Manager/Officer/Operative) |\n| `rate-limiter.ts` | Sliding window rate limiting (API 100/min, Auth 10/min, AI 30/min, Admin 20/min) |\n| `error-handler.ts` | Structured error logging, no stack leaks in production |\n| `metrics.ts` | Request lifecycle metrics collection |\n\n**Data Models (types.ts):**\n- 30+ TypeScript interfaces for entities (Property, Tenant, Case, Repair, Complaint, ASB, Activity, Communication, RentTransaction, etc.)\n\n---\n\n### 6. FIRESTORE SCHEMA\n\n**Collections (17 total, ~550 documents):**\n\n| Collection | Documents | Indexes | Purpose |\n|-----------|-----------|---------|---------|\n| `properties` | 75 | 3 | Housing stock (buildings, flats) |\n| `tenants` | 68 | 2 | Tenancy records (household, accounts) |\n| `cases` | 279+ | 5 | Universal case management (repairs, complaints, ASB, damp, financial) |\n| `organisations` | 1 | â€” | Organisation metadata |\n| `regions` | 3 | â€” | Geographic hierarchy (London, South, Midlands) |\n| `localAuthorities` | 5 | 1 | Local authority boundaries |\n| `estates` | 5 | 1 | Housing estates (Oak Park, Riverside, etc.) |\n| `blocks` | 8 | 1 | Building blocks within estates |\n| `activities` | 500+ | 2 | Case activity timeline (notes, status changes) |\n| `communications` | 50+ | â€” | Messages, emails, SMS |\n| `rentTransactions` | 1000+ | 1 | Rent payment ledger |\n| `users` | 10+ | â€” | Staff user accounts |\n| `auditLog` | 500+ | 1 | Audit trail (compliance) |\n| `notifications` | 100+ | â€” | In-app notifications |\n| `hactCodes` | 100+ | â€” | HACT reference codes |\n| `voidProperties` | 10+ | â€” | Void tracking |\n| `applicants` | 50+ | â€” | Housing applicants |\n| `externalDataCache` | 500+ | â€” | API response cache (TTL-managed) |\n| `tsmMeasures` | 50+ | â€” | Tenant Service Measures |\n\n**Security Rules:** Role-based access control (5 personas) with read/write/create/delete permissions per collection\n\n**Indexes:** 16 composite indexes optimizing query patterns (type+status+date, tenantId+date, propertyId+status, etc.)\n\n---\n\n### 7. API ARCHITECTURE\n\n**Integration Strategy:** Server-side proxy pattern with caching, rate limiting, and fallback strategies.\n\n**Tier 1 APIs (3 live, no registration):**\n- **Police.uk** â€” Street-level crime data (crime-context.ts, Explore map)\n- **Open-Meteo** â€” Weather forecasting (damp-prediction.ts, briefing)\n- **DEFRA Flood Risk** â€” Flood warnings per property\n\n**Tier 2 APIs (6 live + simulated fallbacks):**\n- **Postcodes.io** â€” Postcode lookup, LSOA, lat/long\n- **EPC.gov.uk** â€” Energy Performance Certificates\n- **NOMIS (ONS)** â€” Census 2021, labour market data\n- **Gas Safe Register** â€” Contractor verification\n- **Electrical Safety Register** â€” Contractor verification\n- **Land Registry** â€” Property title data\n\n**Tier 3 APIs (5 mock, production-realistic):**\n- **DWP UC Verification** â€” Universal Credit data (mocked)\n- **IoT Sensors** â€” Switchee/Aico temperature/humidity (mocked)\n- **GoCardless** â€” Direct debit processing (mocked)\n- **DocuSign** â€” Digital signing (mocked)\n- **Experian/TransUnion** â€” Credit referencing (mocked)\n\n**API Response Caching:**\n- Custom TTL per endpoint (24h for crime, 1h for weather, etc.)\n- Firestore `externalDataCache` collection with TTL management\n- Cache-through pattern (fetch on miss, cache result)\n\n**Rate Limiting (4 tiers):**\n- API routes: 100 req/min\n- Auth routes: 10 req/min\n- AI routes: 30 req/min\n- Admin routes: 20 req/min\n\n**Response Format:**\n- All responses wrapped in `{ success: boolean, data: T, error?: string }`\n- Pagination for list endpoints (offset, page, pageSize, totalPages)\n- Standardized error codes\n\n---\n\n### 8. KEY FEATURES & DIFFERENTIATORS\n\n**7 \"Killer Differentiators\" (implemented in Phase 2):**\n\n1. **Predictive Damp Intelligence** â€” 5-factor ML algorithm (weather, building condition, history, sensors, occupancy)\n2. **Live Crime Context for ASB** â€” Real-time police data correlation with internal cases\n3. **Automatic Vulnerability Detection** â€” 7-factor tenant scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Property Passport** â€” Multi-source property dossier (title, surveys, compliance, systems, asbestos, EPC)\n5. **Benefits Entitlement Engine** â€” UK 2025/26 benefit rules analysis\n6. **AI Neighbourhood Briefing** â€” Daily estate-level intelligence combining all data sources\n7. **GOV.UK Notify Integration** â€” 24 templates across 7 categories (rent, repairs, ASB, compliance, tenancy, damp, general)\n\n**AI Features:**\n- YantraAssist â€” Contextual AI chat panel (currently mock, Vertex AI integration planned Phase 5)\n- Dynamic forms & action flows (AI-suggested next steps)\n- AI-powered insights, predictions, recommendations\n- Entity intelligence hooks for property/repair/tenant context\n\n**UI/UX Highlights:**\n- Dark theme with Yantra teal accent (#14B8A6)\n- Bloomberg Terminal meets Figma aesthetic (not legacy government forms)\n- 40+ routes with full WCAG AA accessibility\n- Breadcrumb navigation\n- Responsive design (mobile/tablet/desktop)\n- Full-screen help drawer with contextual guides\n- Skeleton screens & lazy loading\n- 3D building visualization (Three.js)\n- Interactive Leaflet maps with data layer toggles\n\n---\n\n### 9. TESTING & QUALITY\n\n**Selenium Test Suite (331 tests, 99.7% pass rate):**\n- All 14 sidebar navigation links functional\n- All 40+ pages load and render correctly\n- CRUD operations working\n- Navigation flows tested\n- Data fetching verified\n- Form submissions tested\n- Error states validated\n\n**Covered Areas:**\n- Authentication (Firebase email + Google)\n- Dashboard KPIs, charts, compliance, activity\n- Tenancies: list, detail, vulnerability, benefits\n- Properties: list, detail, damp intelligence, EPC, map\n- Repairs: 200 items, full workflow, AI estimates\n- Complaints: 34 items, timeline, ombudsman\n- ASB: 12 cases with crime context\n- Rent: arrears tracking, 52-week ledger\n- Compliance: Big 6, Awaab's Law\n- Communications: templates, AI analysis\n- Reports: 27 pre-built + TSM\n- AI Centre: insights, predictions, differentiators\n- Admin: all 7 sub-pages\n- Tenant Portal: self-service\n- Explore: map drill-down, 3D views\n- Yantra Assist: chat trigger, panel\n\n**TypeScript Quality:**\n- 0 compilation errors (strict mode)\n- 0 React errors (Rules of Hooks verified)\n- All 73 frontend files typed\n- All 43 backend files typed\n\n**Build Metrics:**\n- Vite build: ~3,400 modules, ~38s\n- Bundle size: ~2.5MB JS\n- Cloud Run cold start: <2s\n- Response time P95: ~200-300ms\n\n---\n\n### 10. DEPLOYMENT & INFRASTRUCTURE\n\n**Cloud Platform:** Google Cloud Run (europe-west2)\n- **Service URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Health Check:** /health endpoint (Firestore connectivity + memory)\n- **Instance Config:** 1 GB memory, 1 CPU, 0-10 instances (auto-scaling)\n- **Port:** 8080 (Cloud Run default)\n\n**Docker Build (Multi-stage):**\n- Stage 1: Build React frontend (npm ci, vite build)\n- Stage 2: Build Express backend (npm ci, tsc)\n- Stage 3: Production image (node:20-slim with production deps only)\n\n**CI/CD Pipeline:**\n- GitHub â†’ Cloud Build trigger on `main` push\n- Build steps: docker build â†’ push to Artifact Registry â†’ gcloud run deploy\n- Artifact Registry: `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n\n**Secrets Management (4 secrets in Secret Manager):**\n- `FIREBASE_API_KEY` â€” Public API key\n- `FIREBASE_AUTH_DOMAIN` â€” Firebase project domain\n- `FIREBASE_PROJECT_ID` â€” Firestore project ID\n- `DEMO_USER_PASSWORD` â€” Demo user credential\n\n**Security Hardening:**\n- Content Security Policy (CSP) with Google APIs, Firebase, OSM, Fonts whitelisted\n- CORS restricted to known origins (localhost + Cloud Run)\n- Helmet middleware (X-Frame-Options, X-Content-Type-Options, etc.)\n- Rate limiting (4 tiers per endpoint type)\n- Request correlation ID (X-Request-ID)\n- Structured error logging (no stack leaks in production)\n- JSON body limit: 1MB\n\n**Monitoring & Health:**\n- Custom metrics singleton (request counts, response times, status codes, cache stats)\n- Health endpoint returns: Firestore connectivity, memory usage, uptime, degraded/unhealthy states\n- Morgan request logging\n- Metrics dashboard (admin `/admin/monitoring` route)\n\n---\n\n### 11. PROJECT MANAGEMENT & EXECUTION PLAN\n\n**Master Execution Plan (v3.0, Phases 0-5):**\n\n| Phase | Name | Status | Tasks | Purpose |\n|-------|------|--------|-------|---------|\n| 0 | Infrastructure | âœ… DONE | 10/10 | Setup, testing, config |\n| 1 | Foundation | âœ… DONE | 12/12 | Free APIs, caching, external integrations |\n| 2 | Intelligence | âœ… DONE | 14/14 | 7 differentiators, AI services, mock endpoints |\n| 3 | Enrichment | âœ… DONE | 14/17 | Tier 2 APIs, GOV.UK Notify, accessibility |\n| 4 | Completion | âœ… DONE | 11/14 | Mock services, admin dashboard, security, monitoring |\n| 5 | Evolution | ðŸ”µ TODO | 38 tasks | Real AI (Vertex AI), WebSocket, testing, DevOps |\n\n**Phase 5 Breakdown (38 tasks across 5 sub-phases):**\n- 5.1: Project Setup & Architecture (8 tasks)\n- 5.2: Backend Development (12 tasks)\n- 5.3: Frontend Development (9 tasks)\n- 5.4: Testing & QA (7 tasks)\n- 5.5: DevOps & Deployment (8 tasks)\n\n**Critical Path (Recommended Execution Order):**\n1. 5.1.3 â†’ 5.2.1 â†’ 5.2.2 (Vertex AI architecture â†’ implementation â†’ prompts)\n2. 5.1.4 â†’ 5.2.3 (WebSocket design â†’ implementation)\n3. 5.5.1 (Fix cloudbuild.yaml â€” unblocks CI)\n4. 5.2.4 (Notification dispatch â€” depends on WebSocket)\n5. 5.3.1 (Yantra Assist UI â€” depends on Vertex AI backend)\n6. 5.4.1â€“5.4.7 (Testing suite â€” parallel with features)\n7. 5.5.2â€“5.5.8 (Infrastructure hardening)\n\n**Agent Responsibilities:**\n- **Fullstack:** Routes, API integrations, data models, Firestore, AI services\n- **Frontend:** UI components, pages, state management, styling, accessibility\n- **Tester:** E2E, unit tests, integration tests, load tests, a11y audits\n- **BA:** Requirements, specs, user stories, API reference\n- **DevOps:** CI/CD, monitoring, security, infrastructure, scaling, backups\n\n---\n\n### 12. SESSION CONTINUITY & DOCUMENTATION\n\n**SESSION-HISTORY.md (9 sessions documented):**\n1. Initial setup (Feb 12) â€” GCP/Telegram config\n2. Security cleanup (Feb 13) â€” API keys removal, UI polish\n3. Bug fixes (Feb 14) â€” 11 Selenium warnings resolved\n4. Telegram MCP setup (Feb 14) â€” Bot integration\n5. Phase 2 Completion (Feb 15) â€” All 7 differentiators implemented\n6. Phase 3 Enrichment (Feb 16) â€” GOV.UK Notify, Census/NOMIS, accessibility\n7. Phase 4 Completion (Feb 16) â€” Mock services, admin dashboard, security\n8. Cloud Run deployment (Feb 16-18) â€” Secret Manager, live deployment\n9. BA Spec Refresh (Feb 23) â€” Comprehensive v3.0 documentation\n\n**Key Files to Maintain:**\n- `CLAUDE.md` â€” Always read at session start\n- `SESSION-HISTORY.md` â€” Update at session end with what was done, files changed, commits made\n- `DEV-FIX-LIST.md` â€” Track bugs/warnings\n- `EXECUTION-PLAN.md` â€” Update task progress\n- `DEVOPS.md` â€” Maintain deployment procedures\n\n---\n\n### 13. KEY NUMBERS & STATS\n\n| Metric | Value |\n|--------|-------|\n| Frontend TypeScript/TSX Files | 73 |\n| Backend TypeScript Files | 43 |\n| Frontend Pages | 40+ routes across 19 directories |\n| Backend API Endpoints | 50+ |\n| Firestore Collections | 17 |\n| Firestore Documents | ~550 seeded, scalable to 50,000+ |\n| Personas | 5 (COO, Head of Housing, Manager, Officer, Operative) |\n| CSS Framework | Tailwind 4.1.18 |\n| Test Coverage | 331 Selenium tests (99.7% pass) |\n| TypeScript Errors | 0 |\n| Vite Build Modules | ~3,400 |\n| Bundle Size | ~2.5MB JS |\n| API Integrations | 20 (3 Tier 1, 6 Tier 2, 5 Tier 3 mock, 6 Tier 3 planned) |\n| AI Services | 7 implemented (damp, crime, vulnerability, property passport, benefits, briefing, notify) |\n| Caching Strategy | Cache-through with TTL per endpoint |\n| Rate Limit Tiers | 4 (API, Auth, AI, Admin) |\n| Cloud Run Region | europe-west2 |\n| Live URL | https://socialhomes-587984201316.europe-west2.run.app |\n| GitHub Repo | rajivpeter/SocialHomes_ai |\n| Lines of Code (Docs) | 5,231 in root documentation alone |\n| Original Spec Size | 3,284 lines (Doc1, Doc2, Doc3 combined) |\n| Updated Spec Size | 104KB (Doc1, Doc2, Doc3 in docs/requirements/) |\n\n---\n\n### 14. CURRENT STATUS SUMMARY\n\n**What's Complete:**\n- All core UI (40+ pages, 14 navigation links)\n- All major integrations (3 Tier 1, 6 Tier 2, 5 Tier 3 mock)\n- All 7 killer differentiators\n- Full Firestore schema with 17 collections\n- Complete API with 50+ endpoints\n- Authentication (Firebase + Google SSO)\n- Admin dashboard with integrations page\n- GOV.UK Notify templates (24 templates)\n- Security hardening (CSP, CORS, rate limiting, helmet)\n- Monitoring & health checks\n- Docker containerization\n- Cloud Run deployment (live & working)\n- Selenium test suite (331 tests, 99.7% pass)\n- Comprehensive documentation (v3.0 specs)\n\n**What's Next (Phase 5):**\n- Real Vertex AI integration for Yantra Assist (replacing mock chat)\n- WebSocket server (Socket.io) for real-time notifications\n- Notification bell with real-time updates\n- AI communication drafting (LLM-powered email generation)\n- Real-time case status indicators\n- Workflow builder UI (drag-and-drop)\n- Dark/light theme toggle\n- Full regression test suite\n- Load testing (100 concurrent users)\n- Staging environment (Cloud Run)\n- Custom domain (socialhomes.ai)\n- Monitoring alerts & runbook\n\n---\n\n### 15. IMPORTANT NOTES FOR FUTURE SESSIONS\n\n1. **Always start by reading:** `CLAUDE.md` + `SESSION-HISTORY.md`\n2. **Update at session end:** Add to `SESSION-HISTORY.md` what was done, files changed, commits made, decisions taken\n3. **Convention reminders:**\n   - Tailwind dark theme with brand teal (#14B8A6) accent\n   - Use `safeText()` helper for undefined values\n   - Use `?? []` for nullable arrays (React Error #310 prevention)\n   - API routes in `server/src/routes/`\n   - Frontend pages in `app/src/pages/`\n   - Shared components in `app/src/components/shared/`\n4. **Telegram notifications:** Use `mcp__telegram__notify_user` for async updates\n5. **Build before deploying:** `npm run build` both app/ and server/, then `git push origin main`\n6. **Never commit:** .env files, API keys, .mcp.json (already in .gitignore)\n7. **npm install note:** Use `--legacy-peer-deps` for firebaseui conflict\n8. **Entire.io:** Captures sessions on every commit (manual-commit strategy)\n\n---\n\nThis comprehensive exploration gives you a complete map of the SocialHomes.Ai project. All paths are absolute and verified. The project is production-ready with 99.7% test coverage and all documentation synchronized."}],"totalDurationMs":109690,"totalTokens":74404,"totalToolUseCount":30,"usage":{"input_tokens":7,"cache_creation_input_tokens":1170,"cache_read_input_tokens":64667,"output_tokens":8560,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1170,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"519045f6-bdb8-4456-b996-7bf3f465ad2d"}
{"parentUuid":"dec82303-2e4e-4488-b4a6-4e3b805044f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent â€” I now have a comprehensive understanding of the project. Let me now read the existing docs/requirements/ files to understand the current v3.0 spec content, plus the existing EXECUTION-PLAN.md, so I can create updated, comprehensive versions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"e137e0bb-d590-4c72-82d7-1917bff363ca","timestamp":"2026-02-24T10:42:20.619Z"}
{"parentUuid":"e137e0bb-d590-4c72-82d7-1917bff363ca","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FWntXq7Pd7JSLXg8UmNVWE","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"c4f809fa-c6ea-4aed-ba2a-c0ba51a38bed","timestamp":"2026-02-24T10:42:21.806Z"}
{"parentUuid":"c4f809fa-c6ea-4aed-ba2a-c0ba51a38bed","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FWntXq7Pd7JSLXg8UmNVWE","type":"tool_result","content":"     1â†’================================================================================\n     2â†’  Doc1 â€” SocialHomes.Ai Base Specification\n     3â†’  Version: 3.0  |  Date: 2026-02-23\n     4â†’  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5â†’================================================================================\n     6â†’\n     7â†’1. PRODUCT OVERVIEW\n     8â†’================================================================================\n     9â†’\n    10â†’1.1 Product Name\n    11â†’    SocialHomes.Ai\n    12â†’\n    13â†’1.2 Tagline\n    14â†’    AI-native social housing management for UK housing associations.\n    15â†’    Secondary: \"AI-native. Human-assured.\"\n    16â†’\n    17â†’1.3 Vision\n    18â†’    To be the first truly AI-native housing management system that embeds\n    19â†’    predictive intelligence, automation, and contextual assistance into every\n    20â†’    screen, workflow, and decision â€” transforming reactive housing operations\n    21â†’    into proactive, data-driven housing management.\n    22â†’\n    23â†’    This is NOT a legacy system with a fresh coat of paint. This must look and\n    24â†’    feel like nothing the social housing sector has ever seen â€” think Bloomberg\n    25â†’    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    26â†’    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    27â†’    is the opposite: dark, fast, visually stunning, animated, intelligent.\n    28â†’\n    29â†’1.4 Target Market\n    30â†’    UK Social Housing Providers:\n    31â†’    - Housing Associations (Registered Providers)\n    32â†’    - Local Authority housing departments\n    33â†’    - ALMOs (Arms Length Management Organisations)\n    34â†’    Typical scale: 5,000â€“20,000 housing units across multiple regions.\n    35â†’\n    36â†’1.5 Simulated Organisation\n    37â†’    Name:           Riverside Crescent Housing Association (RCHA)\n    38â†’    RP Number:      4567\n    39â†’    Regulatory:     G1/V1\n    40â†’    HQ:             Southwark\n    41â†’    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    42â†’    Stock:          75 properties, 68 tenants, 279+ cases\n    43â†’    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    44â†’    UPRNs:          Realistic 12-digit references\n    45â†’    EPCs:           Mapped to real certificates where available\n    46â†’\n    47â†’    5 Estates:\n    48â†’    1. Oak Park Estate (SE15) â€” 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    49â†’    2. Riverside Crescent (SE1) â€” 2 blocks, 48 flats, 2005 new build, higher-risk building\n    50â†’    3. Elm Gardens (SE13) â€” street properties, 35 houses/maisonettes, 1930s terraces\n    51â†’    4. Birch Court (SE6) â€” 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    52â†’    5. Maple Lane (SE24) â€” 1 block 20 flats + 12 houses, mixed 1980s-90s\n    53â†’\n    54â†’1.6 Built By\n    55â†’    Yantra Works â€” an AI-native development studio.\n    56â†’\n    57â†’\n    58â†’2. CORE FUNCTIONAL MODULES (16 modules)\n    59â†’================================================================================\n    60â†’\n    61â†’2.1 Dashboard\n    62â†’    Route: /dashboard\n    63â†’    Purpose: Real-time operational overview with persona-scoped KPIs\n    64â†’    Features:\n    65â†’    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n    66â†’      arrears, compliance %, open complaints, AI alerts)\n    67â†’    - KPI trend sparklines (12 months)\n    68â†’    - Charts row: rent collection 12-month trend vs 97% target;\n    69â†’      repairs monthly volume by priority with avg days line\n    70â†’    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n    71â†’      with countdown timers | AI insights scrolling feed\n    72â†’    - Activity timeline with real-time system event feed\n    73â†’    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    74â†’    - Quick action buttons for common tasks\n    75â†’\n    76â†’2.2 Visual Drill-Down Explorer (Flagship Feature)\n    77â†’    Route: /explore\n    78â†’    Purpose: 7-level spatial hierarchy navigation\n    79â†’    Hierarchy:\n    80â†’      Country â†’ Region â†’ Local Authority â†’ Estate â†’ Block â†’ Core â†’ Unit â†’ Tenant\n    81â†’\n    82â†’    Layout:\n    83â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    84â†’    â”‚                                â”‚  CONTEXT PANEL (scrollable)     â”‚\n    85â†’    â”‚      MAP / 3D VIEW (60%)       â”‚  - Entity name & summary        â”‚\n    86â†’    â”‚                                â”‚  - Attribute cards               â”‚\n    87â†’    â”‚      Interactive Leaflet map   â”‚  - Compliance status             â”‚\n    88â†’    â”‚      OR Three.js 3D building   â”‚  - KPI metrics                   â”‚\n    89â†’    â”‚      depending on zoom level   â”‚  - AI insights (purple section)  â”‚\n    90â†’    â”‚                                â”‚  - Children list (next level)    â”‚\n    91â†’    â”‚                                â”‚  - Quick actions                  â”‚\n    92â†’    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    93â†’    â”‚ Bottom bar: Level summary stats | Toggle: Map/List/3D view       â”‚\n    94â†’    â”‚ Data layer toggles: Crime / Damp Risk / Compliance               â”‚\n    95â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    96â†’\n    97â†’    Features:\n    98â†’    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    99â†’    - Three.js 3D building visualization (digital twin) at block level\n   100â†’    - Context panel with attributes, KPIs, compliance, AI insights\n   101â†’    - Color-coded units: green (compliant), amber (warning), red (critical),\n   102â†’      purple (AI flag), grey (void)\n   103â†’    - Data layer toggles: Crime, Damp Risk, Compliance\n   104â†’    - Click-through navigation from any level\n   105â†’\n   106â†’    Level Details:\n   107â†’    L0 Country:     England centred, 3 regions, portfolio summary\n   108â†’    L1 Region:      Zoomed to region, LA areas as markers\n   109â†’    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n   110â†’    L3 Estate:      Zoom 16-17, individual buildings as footprints\n   111â†’    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n   112â†’                    (FRA, Building Safety Case, communal systems, asbestos plan,\n   113â†’                    legionella, structural surveys)\n   114â†’    L4a Core:       For multi-core buildings, schematic floor plan\n   115â†’    L5 Unit:        Highlighted unit in building model, tabbed detail\n   116â†’                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n   117â†’                    Works History, Documents)\n   118â†’    L6 Tenant:      Full tenant record with tabbed view\n   119â†’    L7 Case:        Case detail with timeline\n   120â†’\n   121â†’2.3 Tenancies Management\n   122â†’    Route: /tenancies, /tenancies/:id\n   123â†’    Purpose: Tenancy lifecycle management\n   124â†’    Features:\n   125â†’    - Tenancy list with search (name, address, ID, officer), filter, sort\n   126â†’    - 68 tenants with dynamic count subtitle\n   127â†’    - Tenancy detail: household composition, rent account, case timeline\n   128â†’    - Vulnerability detection (AI 7-factor scoring)\n   129â†’    - Benefits entitlement check\n   130â†’    - Arrears status with color-coded balance\n   131â†’    - 52-week transaction ledger with balance trend chart\n   132â†’    - Action workflows: arrears action, schedule visit, create case\n   133â†’    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n   134â†’      referral generators, communication drafters\n   135â†’\n   136â†’2.4 Properties Management\n   137â†’    Route: /properties, /properties/:id, /properties/:id/apply,\n   138â†’           /properties/:id/book-viewing\n   139â†’    Purpose: Property and asset data management\n   140â†’    Features:\n   141â†’    - Property list with mini Leaflet map in list view\n   142â†’    - 75 properties with pagination\n   143â†’    - Property detail: building attributes, compliance certificates, case history\n   144â†’    - Property Passport (multi-source AI aggregation)\n   145â†’    - Damp Intelligence Panel (5-factor predictive score)\n   146â†’    - Compliance timeline (Big 6 certificates)\n   147â†’    - Viewing bookings and allocation workflow\n   148â†’    - Digital twin (3D block visualization)\n   149â†’    - Application page for void properties\n   150â†’\n   151â†’2.5 Repairs Management\n   152â†’    Route: /repairs, /repairs/:id\n   153â†’    Purpose: Responsive and planned repairs case management\n   154â†’    Features:\n   155â†’    - 200+ repair cases with list/kanban toggle\n   156â†’    - Kanban: Reported â†’ Diagnosed â†’ Scheduled â†’ In Progress â†’ Complete\n   157â†’    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n   158â†’    - Appointment booking with time slots\n   159â†’    - Operative notes, before/after photos\n   160â†’    - Contractor verification badges (Gas Safe green, NICEIC blue)\n   161â†’    - Satisfaction survey (post-completion)\n   162â†’    - Recurrence prediction (AI)\n   163â†’    - Cost tracking and authorisation workflow\n   164â†’    - AI-assisted repair intake: free-text â†’ AI auto-suggests SOR code,\n   165â†’      priority, trade, Awaab's Law flags\n   166â†’\n   167â†’2.6 Compliance Management\n   168â†’    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n   169â†’    Purpose: Regulatory compliance tracking and Awaab's Law\n   170â†’    Features:\n   171â†’    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n   172â†’    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n   173â†’    - Awaab's Law dedicated page:\n   174â†’      - Emergency hazard response: 24-hour countdown timer\n   175â†’      - Significant hazard repair: 10â€“12 week countdown timer\n   176â†’      - Risk register with property-level assessments\n   177â†’      - Proactive inspection programme tracking\n   178â†’    - Building-level compliance: FRA, Building Safety Case\n   179â†’    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n   180â†’    - Compliance failure prediction (AI)\n   181â†’    - No-access tracker, contractor performance\n   182â†’\n   183â†’2.7 Complaints Management\n   184â†’    Route: /complaints, /complaints/:id\n   185â†’    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n   186â†’    Features:\n   187â†’    - 34 complaints with status filtering\n   188â†’    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n   189â†’    - Deadline countdown timers with color-coded urgency\n   190â†’    - Ombudsman escalation pathway\n   191â†’    - Complaint escalation prediction (AI)\n   192â†’    - Linked cases and evidence log\n   193â†’    - TSM CH01/CH02 reporting integration\n   194â†’    - Categories pie chart, findings breakdown, learning tracker\n   195â†’\n   196â†’2.8 Anti-Social Behaviour (ASB)\n   197â†’    Route: /asb, /asb/:id\n   198â†’    Purpose: ASB case management with escalation pipeline\n   199â†’    Features:\n   200â†’    - 12 ASB cases with severity indicators\n   201â†’    - Escalation pipeline: Warning â†’ ABC â†’ CPW â†’ CPN â†’ Injunction â†’ Possession\n   202â†’    - Evidence log with timestamps and categories\n   203â†’    - Live Crime Context (Police.uk data correlation)\n   204â†’    - ASB hotspot analysis per estate\n   205â†’    - ASB escalation prediction (AI)\n   206â†’    - Witness/victim support tracking\n   207â†’    - Community Trigger threshold monitoring\n   208â†’    - Multi-agency panel and referral forms\n   209â†’\n   210â†’2.9 Rent & Arrears\n   211â†’    Route: /rent\n   212â†’    Purpose: Rent management and arrears recovery\n   213â†’    Features:\n   214â†’    - Arrears dashboard with band analysis\n   215â†’    - Pre-Action Protocol (PAP) checklist\n   216â†’    - Arrears worklist with AI-prioritised scoring (1-100)\n   217â†’    - Universal Credit tracking and verification\n   218â†’    - Payment arrangement management\n   219â†’    - Direct debit integration (GoCardless mock)\n   220â†’    - HB/UC transition tracking\n   221â†’    - Arrears risk prediction (AI)\n   222â†’    - 12-month payment trend analysis\n   223â†’    - Collection rate gauge, payment method breakdown\n   224â†’\n   225â†’2.10 Allocations & Lettings\n   226â†’    Route: /allocations\n   227â†’    Purpose: Void management and lettings workflow\n   228â†’    Features:\n   229â†’    - Housing register management (Band A-D, bedroom need, medical priority)\n   230â†’    - Void property kanban: Notice â†’ Keys â†’ Inspection â†’ Works â†’ Quality\n   231â†’      â†’ Ready â†’ Offer â†’ Let\n   232â†’    - Void duration prediction (AI)\n   233â†’    - Days void RAG indicators (green <14, amber 14-28, red >28)\n   234â†’    - Applicant shortlisting and matching\n   235â†’    - Viewing booking system\n   236â†’    - Tenancy sign-up workflow\n   237â†’    - CORE lettings/sales reporting\n   238â†’\n   239â†’2.11 Communications\n   240â†’    Route: /communications\n   241â†’    Purpose: Unified multi-channel inbox\n   242â†’    Features:\n   243â†’    - Unified inbox (email, SMS, letter, portal message)\n   244â†’    - GOV.UK Notify template integration (24 templates, 7 categories)\n   245â†’    - Template rendering with ((field)) personalisation\n   246â†’    - Message history per tenant\n   247â†’    - Bulk communications\n   248â†’    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n   249â†’    - AI triage: auto-categorise, priority, sentiment, suggested response\n   250â†’    - Tone options: Supportive / Formal / Urgent / Legally required\n   251â†’\n   252â†’2.12 Reports & Analytics\n   253â†’    Route: /reports, /reports/:type, /reports/tsm\n   254â†’    Purpose: Regulatory reporting and operational analytics\n   255â†’    Features:\n   256â†’    - 27 regulatory reports\n   257â†’    - TSM (Tenant Satisfaction Measures) â€” 22 measures with benchmarking\n   258â†’    - CORE lettings and sales returns\n   259â†’    - Consumer Standards compliance scorecard\n   260â†’    - Housing Ombudsman reporting\n   261â†’    - Building Safety Act compliance reporting\n   262â†’    - Dynamic report builder with filters\n   263â†’    - CSV/PDF export capability\n   264â†’    - Trend charts, sector median/quartile benchmarking\n   265â†’    - AI-generated narrative summary per report\n   266â†’    Report Categories:\n   267â†’    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n   268â†’    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n   269â†’    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n   270â†’      EPC/Energy\n   271â†’    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n   272â†’      void loss\n   273â†’    - Governance: Board pack, risk register, H&S summary\n   274â†’    - Tenant-facing: Annual report, estate reports\n   275â†’\n   276â†’2.13 AI Centre\n   277â†’    Route: /ai-centre\n   278â†’    Purpose: AI capabilities hub and differentiator showcase\n   279â†’    Features:\n   280â†’    - Insights tab: AI-generated operational insights with confidence %,\n   281â†’      affected entities, action buttons\n   282â†’    - Predictions tab: 8 predictive models dashboard with scatter plots,\n   283â†’      top-50 table, feature importance, accuracy gauges\n   284â†’    - Differentiators tab: 7 killer differentiator feature cards with\n   285â†’      vulnerability scan\n   286â†’    - Assistant tab: Conversational AI interface (Yantra Assist)\n   287â†’\n   288â†’2.14 AI Morning Briefing\n   289â†’    Route: /briefing\n   290â†’    Purpose: Personalised daily operational briefing\n   291â†’    Features:\n   292â†’    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n   293â†’      attention today\")\n   294â†’    - Weather forecast with property impact assessment\n   295â†’    - Today's tasks with priority indicators and action buttons\n   296â†’    - AI predictions and alerts\n   297â†’    - Estate-level neighbourhood briefing accordion\n   298â†’    - Compliance section with Big 6 stats\n   299â†’    - [Start my day â†’] and [Skip briefing] buttons\n   300â†’\n   301â†’2.15 Admin System\n   302â†’    Route: /admin, /admin/integrations\n   303â†’    Purpose: System configuration and management\n   304â†’    Features:\n   305â†’    - Organisation profile and branding\n   306â†’    - User management with RBAC (10 default roles Ã— permission matrix)\n   307â†’    - Team and patch management with caseload balancing\n   308â†’    - Workflow engine (visual builder with triggers/conditions/actions)\n   309â†’    - Integration hub (20 integrations across 3 tiers)\n   310â†’    - Integration toggle, test connection, status monitoring\n   311â†’    - Audit trail (full CRUD logging â€” timestamp, user, entity, field,\n   312â†’      old/new value, IP)\n   313â†’    - GDPR tools (SAR processor, right to erasure, retention policies,\n   314â†’      consent management, Data Processing Register)\n   315â†’    - System reference data configuration (editable lookup tables)\n   316â†’    - Notification configuration\n   317â†’    - AI model configuration (toggle on/off, confidence thresholds)\n   318â†’    - White-label: multi-HA deployment support\n   319â†’\n   320â†’2.16 Tenant Portal\n   321â†’    Route: /tenant-portal\n   322â†’    Purpose: Tenant self-service interface\n   323â†’    Features:\n   324â†’    - Distinct lighter/warmer UI theme (visually separate from staff system)\n   325â†’    - Report repair (conversational wizard: room â†’ problem â†’ photo â†’\n   326â†’      appointment â†’ confirm)\n   327â†’    - Check rent balance and make payment\n   328â†’    - View active repairs with photos and status\n   329â†’    - Quick message to housing officer\n   330â†’    - Document access\n   331â†’    - Larger text, no jargon, large touch targets\n   332â†’\n   333â†’2.17 Global Search\n   334â†’    Route: /search\n   335â†’    Purpose: Cross-entity full-text search\n   336â†’    Features:\n   337â†’    - Global search bar in header\n   338â†’    - Searches across tenants, properties, cases, communications\n   339â†’    - Results grouped by entity type\n   340â†’    - Direct navigation to entity detail\n   341â†’\n   342â†’\n   343â†’3. PERSONA SYSTEM\n   344â†’================================================================================\n   345â†’\n   346â†’3.1 Overview\n   347â†’    5 operational personas with scoped data visibility and dashboard layout.\n   348â†’    Persona selection via sidebar switcher. Persisted per session.\n   349â†’\n   350â†’3.2 Persona Definitions\n   351â†’\n   352â†’    PERSONA 1: Chief Operating Officer (COO)\n   353â†’    Scope: Organisation-wide\n   354â†’    Dashboard: High-level KPIs, financial summary, compliance overview,\n   355â†’              risk heatmap\n   356â†’    Access: Full read/write, admin settings, reports\n   357â†’    AI Focus: Strategic â€” regulatory risk, portfolio compliance trends,\n   358â†’              financial performance, TSM trajectory\n   359â†’    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n   360â†’                \"Benchmark against sector\"\n   361â†’\n   362â†’    PERSONA 2: Head of Housing\n   363â†’    Scope: Regional (multiple Local Authorities)\n   364â†’    Dashboard: Regional performance, team metrics, escalated cases\n   365â†’    Access: Team management, regional reports, case oversight\n   366â†’    AI Focus: Operational â€” SLA performance, team capacity, complaint trends\n   367â†’    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n   368â†’\n   369â†’    PERSONA 3: Housing Manager\n   370â†’    Scope: Estate/Block level\n   371â†’    Dashboard: Estate KPIs, staff workload, compliance deadlines\n   372â†’    Access: Case assignment, approval workflows, local reports\n   373â†’    AI Focus: Team management â€” workload, case overdue, skill gaps\n   374â†’    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n   375â†’\n   376â†’    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n   377â†’    Scope: Assigned patch (specific estates/blocks)\n   378â†’    Dashboard: Caseload worklist, today's visits, tenant alerts\n   379â†’    Access: Case CRUD, tenant interactions, notes\n   380â†’    AI Focus: What to do TODAY â€” appointments, calls, tasks, cases needing action\n   381â†’    AI Actions: Richest set â€” holding reply buttons, follow-up task creators,\n   382â†’                referral generators, communication drafters on every page\n   383â†’\n   384â†’    PERSONA 5: Repairs Operative\n   385â†’    Scope: Assigned jobs\n   386â†’    Dashboard: Today's job list, materials, access notes\n   387â†’    Access: Repair status updates, photos, completion notes\n   388â†’    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n   389â†’    No access to: Financial data, personal tenant details beyond job needs\n   390â†’\n   391â†’\n   392â†’4. AI-NATIVE FEATURES\n   393â†’================================================================================\n   394â†’\n   395â†’4.1 Core Principle: Dynamic AI Interface Elements\n   396â†’    Every entity page has TWO zones:\n   397â†’    1. Standard zone: Fixed fields, tabs, buttons â€” always present\n   398â†’    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n   399â†’       change based on context\n   400â†’\n   401â†’    Dynamic elements include:\n   402â†’    - Dynamic action buttons â€” only appear when AI determines they're relevant\n   403â†’    - Dynamic info cards â€” contextual information the system thinks user needs\n   404â†’    - Dynamic prompts â€” questions AI asks user, answering triggers workflows\n   405â†’    - Dynamic warnings â€” alerts about this entity needing attention\n   406â†’    - Dynamic information fields â€” calculated data not in standard layout\n   407â†’\n   408â†’    Styling: Purple left border (--status-ai), --surface-elevated background,\n   409â†’    \"âœ¦\" symbol prefix on AI-generated content\n   410â†’\n   411â†’4.2 The AI Action Flow Pattern\n   412â†’    Every AI dynamic button follows this pattern:\n   413â†’    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n   414â†’    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n   415â†’    3. EDIT: User can edit anything in the preview\n   416â†’    4. CONFIRM: User approves the action\n   417â†’    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n   418â†’    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n   419â†’    7. LEARN: System records accept/modify/reject for model improvement\n   420â†’\n   421â†’4.3 Yantra Assist\n   422â†’    Location: Bottom-left floating trigger (all pages)\n   423â†’    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n   424â†’    Panel: 400px, slides from left, overlaying sidebar\n   425â†’    Content changes based on current page/entity AND user persona\n   426â†’\n   427â†’    Panel Structure:\n   428â†’    - ðŸ”´ URGENT: Items needing immediate action\n   429â†’    - ðŸŸ  ATTENTION: Items approaching deadlines\n   430â†’    - ðŸ’¡ INSIGHTS: AI predictions & recommendations\n   431â†’    - ðŸ“Š BRIEFING: Contextual summary & key stats\n   432â†’    - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context\n   433â†’    - [Ask Yantra...] chat input at bottom\n   434â†’\n   435â†’4.4 Prediction Models (8 total)\n   436â†’    MODEL 1: Arrears Risk\n   437â†’      Input: Payment history, UC status, seasonal patterns, life events\n   438â†’      Output: Risk score (0â€“100), predicted arrears amount, recommended actions\n   439â†’\n   440â†’    MODEL 2: Damp & Mould Risk\n   441â†’      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n   442â†’             IoT sensors (0.20), occupancy (0.10)\n   443â†’      Output: Risk score (0â€“100), factor breakdown, proactive recommendations\n   444â†’\n   445â†’    MODEL 3: Complaint Escalation\n   446â†’      Input: Response times, complaint category, tenant history, complexity\n   447â†’      Output: Escalation probability, recommended priority, deadline warnings\n   448â†’\n   449â†’    MODEL 4: Void Duration\n   450â†’      Input: Property type, condition, location, market demand, works needed\n   451â†’      Output: Predicted void days, optimal marketing strategy\n   452â†’\n   453â†’    MODEL 5: Repair Recurrence\n   454â†’      Input: Component age, repair history, building type, contractor quality\n   455â†’      Output: Recurrence probability, recommended planned maintenance\n   456â†’\n   457â†’    MODEL 6: Vulnerability Detection\n   458â†’      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n   459â†’             social isolation (0.15), age risk (0.10), dependents (0.10),\n   460â†’             UC transition (0.10)\n   461â†’      Output: Vulnerability score (0â€“100), detected flags, recommended support\n   462â†’\n   463â†’    MODEL 7: ASB Escalation\n   464â†’      Input: Case history, estate context, crime data, tenant profile\n   465â†’      Output: Escalation risk, recommended intervention level\n   466â†’\n   467â†’    MODEL 8: Compliance Failure\n   468â†’      Input: Certificate expiry, contractor availability, building complexity\n   469â†’      Output: Failure probability, priority scheduling recommendations\n   470â†’\n   471â†’4.5 Seven Killer Differentiators\n   472â†’    D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm\n   473â†’    D2: Live Crime Context for ASB â€” Police.uk data correlation\n   474â†’    D3: Automatic Vulnerability Detection â€” 7-factor scoring\n   475â†’    D4: Property Passport â€” Multi-source property dossier\n   476â†’    D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules\n   477â†’    D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence\n   478â†’    D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)\n   479â†’\n   480â†’4.6 AI-Augmented Workflows\n   481â†’    - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,\n   482â†’      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n   483â†’      checks recurring pattern, estimates cost, flags Awaab's Law\n   484â†’    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n   485â†’      suggests appropriate case type, pre-fills forms\n   486â†’    - Communication Sending: AI generates drafts using correct templates,\n   487â†’      tenant details, plain English, legally required wording, tone options\n   488â†’    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n   489â†’      contractor instructions, pre-booked appointments\n   490â†’    - Complaint Prevention: AI detects patterns (multiple calls, declining\n   491â†’      satisfaction), generates prevention plan\n   492â†’\n   493â†’4.7 Signature AI Interactions\n   494â†’    1. \"Holding Reply\" Flow â€” pre-drafted email â†’ edit â†’ send â†’ follow-up task\n   495â†’    2. \"Inbound Email Triage\" â€” AI reads â†’ categorises â†’ creates case(s)\n   496â†’    3. \"Proactive Damp Prevention\" â€” weather forecast â†’ risk cross-reference\n   497â†’       â†’ preventive advice letters â†’ inspection tasks\n   498â†’    4. \"Compliance Cascade\" â€” batch contractor booking â†’ letters â†’ calendar\n   499â†’    5. \"Complaint Prevention\" â€” pattern detection â†’ prevention plan execution\n   500â†’\n   501â†’\n   502â†’5. DATA MODEL (SUMMARY)\n   503â†’================================================================================\n   504â†’\n   505â†’5.1 Core Entities\n   506â†’    - Property (75 records) â€” address, UPRN, type, bedrooms, EPC, compliance\n   507â†’    - Tenant (68 records) â€” name, contact, vulnerability, household, UC status\n   508â†’    - Tenancy â€” propertyâ€“tenant link, start date, type, rent, balance\n   509â†’    - Case (279+ records) â€” unified: repair, complaint, ASB, financial, damp-mould\n   510â†’    - Repair (200 records) â€” SOR code, priority, SLA, appointments, contractor\n   511â†’    - Complaint (34 records) â€” stage, deadlines, Ombudsman reference\n   512â†’    - ASB (12 records) â€” severity, escalation level, evidence log\n   513â†’    - Activity â€” timeline events for any entity\n   514â†’    - Task â€” assigned work items with due dates\n   515â†’\n   516â†’5.2 Supporting Entities\n   517â†’    - Organisation â€” RCHA metadata, branding, settings\n   518â†’    - Region (3) â€” London, South, Midlands\n   519â†’    - Local Authority â€” Southwark, Lewisham, Lambeth\n   520â†’    - Estate (5) â€” name, location, block count, manager\n   521â†’    - Block â€” floors, cores, unit count\n   522â†’    - User â€” auth profile, role, persona, team\n   523â†’    - Team â€” name, manager, patch, members\n   524â†’    - Integration â€” external service config (20 integrations)\n   525â†’    - Report â€” template definitions (27 reports)\n   526â†’    - ExternalDataCache â€” TTL-based cache for API responses\n   527â†’\n   528â†’5.3 Firestore Collections (17)\n   529â†’    users, properties, tenants, cases, activities, tasks,\n   530â†’    repairs, complaints, asb, financial, damp-mould,\n   531â†’    organisations, teams, integrations, auditLog,\n   532â†’    externalDataCache, imdData\n   533â†’\n   534â†’5.4 Case Reference Formats\n   535â†’    | Type        | Format           | Colour  |\n   536â†’    |-------------|------------------|---------|\n   537â†’    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n   538â†’    | Repair      | REP-YYYY-XXXXX   | Blue    |\n   539â†’    | ASB         | ASB-YYYY-XXXXX   | Red     |\n   540â†’    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n   541â†’    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n   542â†’    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n   543â†’    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n   544â†’\n   545â†’\n   546â†’6. USER INTERFACE DESIGN\n   547â†’================================================================================\n   548â†’\n   549â†’6.1 Theme\n   550â†’    Brand: Yantra Works dark theme\n   551â†’    Primary Background: --surface-dark (#0D1117)\n   552â†’    Card Background: --surface-card (#151B23)\n   553â†’    Elevated: --surface-elevated (#1C2333)\n   554â†’    Hover: --surface-hover (#222D3D)\n   555â†’    Accent: --brand-teal (#058995)\n   556â†’    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n   557â†’    AI Colour: --status-ai (#A371F7) â€” purple for all AI elements\n   558â†’    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n   559â†’\n   560â†’6.2 Typography\n   561â†’    Headings: \"Space Grotesk\", sans-serif â€” bold, technical\n   562â†’    Body: \"Inter\", Arial, sans-serif â€” clean, readable (15px, line-height 1.6)\n   563â†’    Monospace: \"JetBrains Mono\", monospace â€” references, codes\n   564â†’    Headings in --brand-peach on dark backgrounds\n   565â†’    Section labels: --brand-teal, uppercase, letter-spaced\n   566â†’\n   567â†’6.3 Layout\n   568â†’    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n   569â†’    - Top header with logo, global search, notifications, AI trigger, user menu\n   570â†’    - Breadcrumb navigation reflecting hierarchy\n   571â†’    - Main content area with responsive grid (max 1400px)\n   572â†’    - Yantra Assist floating panel (bottom-left)\n   573â†’    - Phase banner: garnet \"BETA\" tag\n   574â†’\n   575â†’6.4 Navigation Items (Sidebar)\n   576â†’    NAVIGATE: Explore, Dashboard\n   577â†’    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n   578â†’            Complaints, Allocations, ASB\n   579â†’    COMMUNICATE: Communications\n   580â†’    ANALYSE: Reports, AI Centre\n   581â†’    SYSTEM: Admin, Settings\n   582â†’    + Persona Switcher\n   583â†’\n   584â†’6.5 Design Principles\n   585â†’    - Dark mode is default â€” Yantra Works brand palette throughout\n   586â†’    - Mobile-aware responsive design\n   587â†’    - WCAG AA compliant (contrast â‰¥ 4.5:1, focus, keyboard, ARIA)\n   588â†’    - Skip-to-content link\n   589â†’    - Reduced-motion support (@media prefers-reduced-motion)\n   590â†’    - Focus-visible outlines on all interactive elements\n   591â†’    - Screen-reader-only (.sr-only) text for context\n   592â†’    - Animations throughout â€” staggered reveals, sliding panels, smooth\n   593â†’      transitions, pulsing alerts. UI must feel ALIVE, not static.\n   594â†’    - UK conventions: DD/MM/YYYY, British English, GBP Â£\n   595â†’\n   596â†’6.6 Component Library\n   597â†’    - KpiCard â€” metric display with trend sparkline\n   598â†’    - StatusPill â€” status badge (green/amber/red)\n   599â†’    - ActionModal â€” accessible form modal with focus trap, Escape handler,\n   600â†’      aria attributes, form validation, previous focus restoration\n   601â†’    - AiActionCard â€” purple-bordered AI suggestion card\n   602â†’    - CountdownTimer â€” deadline countdown with color urgency transitions\n   603â†’      (green â†’ peach â†’ garnet â†’ pulsing garnet)\n   604â†’    - PropertyMap â€” Leaflet map with markers\n   605â†’    - HelpDrawer â€” full-screen contextual help (20 topics)\n   606â†’    - DampIntelligencePanel â€” damp risk factor display with score badge\n   607â†’    - VulnerabilityPanel â€” 7-factor vulnerability assessment\n   608â†’    - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts\n   609â†’    - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions\n   610â†’\n   611â†’\n   612â†’7. REGULATORY COMPLIANCE\n   613â†’================================================================================\n   614â†’\n   615â†’7.1 Housing Regulations Supported\n   616â†’    - Housing Ombudsman Complaint Handling Code (2024)\n   617â†’    - Awaab's Law (Social Housing Regulation Act 2023)\n   618â†’    - Building Safety Act 2022\n   619â†’    - Regulator of Social Housing (RSH) Consumer Standards\n   620â†’    - Tenant Satisfaction Measures (TSM) Standard\n   621â†’    - CORE lettings and sales data collection\n   622â†’    - Gas Safety (Installation and Use) Regulations 1998\n   623â†’    - Electrical Safety Standards in the Private Rented Sector\n   624â†’    - Regulatory Reform (Fire Safety) Order 2005\n   625â†’    - Control of Asbestos Regulations 2012\n   626â†’    - Legionella risk assessment (HSE ACoP L8)\n   627â†’    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n   628â†’\n   629â†’7.2 GDPR Compliance\n   630â†’    - Full audit trail on all data operations\n   631â†’    - Subject Access Request (SAR) processor\n   632â†’    - Right to erasure workflow\n   633â†’    - Data retention policy configuration\n   634â†’    - Consent management\n   635â†’    - Data Processing Register\n   636â†’\n   637â†’7.3 Accessibility (WCAG AA)\n   638â†’    - Focus traps in modals\n   639â†’    - Skip-to-content link\n   640â†’    - Keyboard navigation (Tab, Escape)\n   641â†’    - ARIA labels, roles, described-by\n   642â†’    - Reduced-motion media query\n   643â†’    - Color contrast ratio â‰¥ 4.5:1\n   644â†’    - Screen-reader-only text\n   645â†’    - Focus-visible outlines\n   646â†’\n   647â†’\n   648â†’8. NON-FUNCTIONAL REQUIREMENTS\n   649â†’================================================================================\n   650â†’\n   651â†’8.1 Performance\n   652â†’    - API response time (P95): < 500ms\n   653â†’    - Frontend bundle size: < 3MB\n   654â†’    - Cloud Run cold start: < 3s\n   655â†’    - Firestore query latency: < 200ms\n   656â†’    - AI response latency (target): < 3s for conversational queries\n   657â†’\n   658â†’8.2 Security\n   659â†’    - Firebase Authentication with Google sign-in\n   660â†’    - RBAC with 10 default roles (super-admin through read-only)\n   661â†’    - CSP headers with whitelist\n   662â†’    - CORS restricted to allowed origins\n   663â†’    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   664â†’    - Security headers (Permissions-Policy, X-Content-Type-Options,\n   665â†’      X-Frame-Options, Referrer-Policy, HSTS)\n   666â†’    - Secret Manager for all credentials (no secrets in code)\n   667â†’    - JSON body limit 1MB\n   668â†’    - Request correlation via X-Request-ID\n   669â†’\n   670â†’8.3 Scalability\n   671â†’    - Cloud Run: 0â€“10 instances (auto-scaling)\n   672â†’    - Firestore: NoSQL, horizontally scalable\n   673â†’    - External API caching reduces load\n   674â†’    - Concurrency: 80 requests/instance\n   675â†’\n   676â†’8.4 Availability\n   677â†’    - Cloud Run SLA: 99.95%\n   678â†’    - External API fallbacks (simulated data on failure)\n   679â†’    - Health check with Firestore connectivity monitoring\n   680â†’    - States: healthy / degraded / unhealthy\n   681â†’\n   682â†’8.5 Testing\n   683â†’    - Selenium E2E: 331 tests, 99.7% pass rate\n   684â†’    - Unit tests: 66 tests for public data APIs\n   685â†’    - TypeScript: 0 errors (strict mode)\n   686â†’    - Vite build: 0 critical warnings\n   687â†’\n   688â†’\n   689â†’9. SIMULATED DATA\n   690â†’================================================================================\n   691â†’\n   692â†’9.1 Scale\n   693â†’    75 properties, 68 active tenancies, 5 voids\n   694â†’    Realistic SE London postcodes, 12-digit UPRNs\n   695â†’    Diverse tenant names reflecting London demographics\n   696â†’\n   697â†’9.2 Financial Profile\n   698â†’    Rents: social Â£95-140/week, affordable Â£140-200/week\n   699â†’    Service charges: Â£5-35/week\n   700â†’    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n   701â†’    Arrears: 60% nil, 20% <Â£250, 10% Â£250-500, 5% Â£500-1k, 5% >Â£1k\n   702â†’\n   703â†’9.3 Cases\n   704â†’    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n   705â†’    34 open complaints (28 Stage 1, 6 Stage 2)\n   706â†’    12 ASB cases\n   707â†’    8 damp/mould cases (3 emergency, 5 significant)\n   708â†’    25 financial cases\n   709â†’    5 voids at various pipeline stages\n   710â†’\n   711â†’9.4 Compliance\n   712â†’    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n   713â†’    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n   714â†’\n   715â†’\n   716â†’10. CURRENT STATUS & METRICS\n   717â†’================================================================================\n   718â†’\n   719â†’10.1 Production Deployment\n   720â†’    URL: https://socialhomes-587984201316.europe-west2.run.app\n   721â†’    Region: europe-west2 (London)\n   722â†’    Status: LIVE and operational\n   723â†’    Database: 460+ documents across 17 Firestore collections\n   724â†’\n   725â†’10.2 Build Metrics\n   726â†’    | Metric                    | Value           |\n   727â†’    |---------------------------|-----------------|\n   728â†’    | Frontend modules          | 3,397           |\n   729â†’    | Frontend build time       | ~35â€“39 seconds  |\n   730â†’    | Backend TypeScript errors | 0               |\n   731â†’    | Frontend TypeScript errors| 0               |\n   732â†’    | Selenium tests            | 331             |\n   733â†’    | Selenium pass rate        | 99.7%           |\n   734â†’    | Unit tests (public data)  | 66              |\n   735â†’    | Firestore collections     | 17              |\n   736â†’    | Seeded properties         | 75              |\n   737â†’    | Seeded tenants            | 68              |\n   738â†’    | Seeded cases              | 279+            |\n   739â†’    | API endpoints             | 50+             |\n   740â†’    | Frontend routes           | 40+             |\n   741â†’    | Lines of code             | 23,852          |\n   742â†’\n   743â†’10.3 Phase Completion\n   744â†’    Phase 0: Infrastructure        â€” DONE (10/10)\n   745â†’    Phase 1: Foundation            â€” DONE (12/12)\n   746â†’    Phase 2: Intelligence          â€” DONE (14/14)\n   747â†’    Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)\n   748â†’    Phase 4: Completion            â€” DONE (11/14, 3 deferred)\n   749â†’    Phase 5: Evolution             â€” TODO (0/32)\n   750â†’\n   751â†’================================================================================\n   752â†’  End of Doc1 â€” SocialHomes.Ai Base Specification\n   753â†’  Yantra Works | 2026-02-23\n   754â†’================================================================================\n   755â†’"}]},"uuid":"4afb4d03-dbbd-4500-84cd-d2f2ea4c0967","timestamp":"2026-02-24T10:42:22.067Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 â€” SocialHomes.Ai Base Specification\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision â€” transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen â€” think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000â€“20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) â€” 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) â€” 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) â€” street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) â€” 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) â€” 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works â€” an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (16 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country â†’ Region â†’ Local Authority â†’ Estate â†’ Block â†’ Core â†’ Unit â†’ Tenant\n\n    Layout:\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚                                â”‚  CONTEXT PANEL (scrollable)     â”‚\n    â”‚      MAP / 3D VIEW (60%)       â”‚  - Entity name & summary        â”‚\n    â”‚                                â”‚  - Attribute cards               â”‚\n    â”‚      Interactive Leaflet map   â”‚  - Compliance status             â”‚\n    â”‚      OR Three.js 3D building   â”‚  - KPI metrics                   â”‚\n    â”‚      depending on zoom level   â”‚  - AI insights (purple section)  â”‚\n    â”‚                                â”‚  - Children list (next level)    â”‚\n    â”‚                                â”‚  - Quick actions                  â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ Bottom bar: Level summary stats | Toggle: Map/List/3D view       â”‚\n    â”‚ Data layer toggles: Crime / Damp Risk / Compliance               â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported â†’ Diagnosed â†’ Scheduled â†’ In Progress â†’ Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text â†’ AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10â€“12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning â†’ ABC â†’ CPW â†’ CPN â†’ Injunction â†’ Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice â†’ Keys â†’ Inspection â†’ Works â†’ Quality\n      â†’ Ready â†’ Offer â†’ Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) â€” 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day â†’] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles Ã— permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging â€” timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room â†’ problem â†’ photo â†’\n      appointment â†’ confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic â€” regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational â€” SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management â€” workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY â€” appointments, calls, tasks, cases needing action\n    AI Actions: Richest set â€” holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons â€” always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons â€” only appear when AI determines they're relevant\n    - Dynamic info cards â€” contextual information the system thinks user needs\n    - Dynamic prompts â€” questions AI asks user, answering triggers workflows\n    - Dynamic warnings â€” alerts about this entity needing attention\n    - Dynamic information fields â€” calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"âœ¦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - ðŸ”´ URGENT: Items needing immediate action\n    - ðŸŸ  ATTENTION: Items approaching deadlines\n    - ðŸ’¡ INSIGHTS: AI predictions & recommendations\n    - ðŸ“Š BRIEFING: Contextual summary & key stats\n    - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0â€“100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0â€“100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0â€“100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm\n    D2: Live Crime Context for ASB â€” Police.uk data correlation\n    D3: Automatic Vulnerability Detection â€” 7-factor scoring\n    D4: Property Passport â€” Multi-source property dossier\n    D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence\n    D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow â€” pre-drafted email â†’ edit â†’ send â†’ follow-up task\n    2. \"Inbound Email Triage\" â€” AI reads â†’ categorises â†’ creates case(s)\n    3. \"Proactive Damp Prevention\" â€” weather forecast â†’ risk cross-reference\n       â†’ preventive advice letters â†’ inspection tasks\n    4. \"Compliance Cascade\" â€” batch contractor booking â†’ letters â†’ calendar\n    5. \"Complaint Prevention\" â€” pattern detection â†’ prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) â€” address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) â€” name, contact, vulnerability, household, UC status\n    - Tenancy â€” propertyâ€“tenant link, start date, type, rent, balance\n    - Case (279+ records) â€” unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) â€” SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) â€” stage, deadlines, Ombudsman reference\n    - ASB (12 records) â€” severity, escalation level, evidence log\n    - Activity â€” timeline events for any entity\n    - Task â€” assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation â€” RCHA metadata, branding, settings\n    - Region (3) â€” London, South, Midlands\n    - Local Authority â€” Southwark, Lewisham, Lambeth\n    - Estate (5) â€” name, location, block count, manager\n    - Block â€” floors, cores, unit count\n    - User â€” auth profile, role, persona, team\n    - Team â€” name, manager, patch, members\n    - Integration â€” external service config (20 integrations)\n    - Report â€” template definitions (27 reports)\n    - ExternalDataCache â€” TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) â€” purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif â€” bold, technical\n    Body: \"Inter\", Arial, sans-serif â€” clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace â€” references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default â€” Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast â‰¥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout â€” staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP Â£\n\n6.6 Component Library\n    - KpiCard â€” metric display with trend sparkline\n    - StatusPill â€” status badge (green/amber/red)\n    - ActionModal â€” accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard â€” purple-bordered AI suggestion card\n    - CountdownTimer â€” deadline countdown with color urgency transitions\n      (green â†’ peach â†’ garnet â†’ pulsing garnet)\n    - PropertyMap â€” Leaflet map with markers\n    - HelpDrawer â€” full-screen contextual help (20 topics)\n    - DampIntelligencePanel â€” damp risk factor display with score badge\n    - VulnerabilityPanel â€” 7-factor vulnerability assessment\n    - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio â‰¥ 4.5:1\n    - Screen-reader-only text\n    - Focus-visible outlines\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0â€“10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social Â£95-140/week, affordable Â£140-200/week\n    Service charges: Â£5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <Â£250, 10% Â£250-500, 5% Â£500-1k, 5% >Â£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35â€“39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | 23,852          |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        â€” DONE (10/10)\n    Phase 1: Foundation            â€” DONE (12/12)\n    Phase 2: Intelligence          â€” DONE (14/14)\n    Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)\n    Phase 4: Completion            â€” DONE (11/14, 3 deferred)\n    Phase 5: Evolution             â€” TODO (0/32)\n\n================================================================================\n  End of Doc1 â€” SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-23\n================================================================================\n","numLines":755,"startLine":1,"totalLines":755}},"sourceToolAssistantUUID":"c4f809fa-c6ea-4aed-ba2a-c0ba51a38bed"}
{"parentUuid":"4afb4d03-dbbd-4500-84cd-d2f2ea4c0967","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0117hRXtDDsgijAW1d7KBkLM","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"7fda5ba8-772e-4e59-983c-2045e1a0d1d4","timestamp":"2026-02-24T10:42:22.364Z"}
{"parentUuid":"7fda5ba8-772e-4e59-983c-2045e1a0d1d4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0117hRXtDDsgijAW1d7KBkLM","type":"tool_result","content":"     1â†’================================================================================\n     2â†’  Doc2 â€” SocialHomes.Ai Technical Architecture & Data Models\n     3â†’  Version: 3.0  |  Date: 2026-02-23\n     4â†’  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5â†’================================================================================\n     6â†’\n     7â†’1. SYSTEM ARCHITECTURE OVERVIEW\n     8â†’================================================================================\n     9â†’\n    10â†’1.1 Architecture Style\n    11â†’    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    12â†’    deployed as a single container on Google Cloud Run. The Express server\n    13â†’    serves both the API and the built React static assets.\n    14â†’\n    15â†’1.2 High-Level Architecture Diagram (ASCII)\n    16â†’\n    17â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    18â†’    â”‚                        CLOUD RUN (europe-west2)                â”‚\n    19â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\n    20â†’    â”‚  â”‚                    Express.js Server                      â”‚  â”‚\n    21â†’    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚\n    22â†’    â”‚  â”‚  â”‚ Static Files â”‚  â”‚   API v1     â”‚  â”‚  Middleware    â”‚  â”‚  â”‚\n    23â†’    â”‚  â”‚  â”‚ (React SPA)  â”‚  â”‚  /api/v1/*   â”‚  â”‚ Auth/RBAC/    â”‚  â”‚  â”‚\n    24â†’    â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ Rate Limit/   â”‚  â”‚  â”‚\n    25â†’    â”‚  â”‚  â”‚ Vite Build   â”‚  â”‚ 16 route     â”‚  â”‚ Metrics/CSP   â”‚  â”‚  â”‚\n    26â†’    â”‚  â”‚  â”‚ Output       â”‚  â”‚ modules      â”‚  â”‚               â”‚  â”‚  â”‚\n    27â†’    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚\n    28â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\n    29â†’    â”‚                              â”‚                                  â”‚\n    30â†’    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\n    31â†’    â”‚  â”‚                    Service Layer (25 modules)             â”‚  â”‚\n    32â†’    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚\n    33â†’    â”‚  â”‚  â”‚ AI      â”‚ â”‚ External â”‚ â”‚ GOV.UK   â”‚ â”‚ Mock        â”‚  â”‚  â”‚\n    34â†’    â”‚  â”‚  â”‚ Servicesâ”‚ â”‚ API      â”‚ â”‚ Notify   â”‚ â”‚ Services    â”‚  â”‚  â”‚\n    35â†’    â”‚  â”‚  â”‚ (7)     â”‚ â”‚ Proxy    â”‚ â”‚ (24 tmpl)â”‚ â”‚ (5 Tier 3)  â”‚  â”‚  â”‚\n    36â†’    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚\n    37â†’    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\n    38â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    39â†’                                   â”‚\n    40â†’              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    41â†’              â”‚                    â”‚                     â”‚\n    42â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”\n    43â†’    â”‚   Firestore    â”‚  â”‚  Firebase Auth â”‚  â”‚ Secret Manager â”‚\n    44â†’    â”‚  (17 colls)    â”‚  â”‚  (Google SSO)  â”‚  â”‚  (4 secrets)   â”‚\n    45â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    46â†’              â”‚\n    47â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    48â†’    â”‚              External APIs (3 Tiers)               â”‚\n    49â†’    â”‚  Tier 1: Police.uk, Open-Meteo, DEFRA             â”‚\n    50â†’    â”‚  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. â”‚\n    51â†’    â”‚  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      â”‚\n    52â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    53â†’\n    54â†’1.3 Request Flow Diagram\n    55â†’\n    56â†’    Browser â†’ React SPA â†’ api-client.ts â†’ HTTP Request\n    57â†’                                              â”‚\n    58â†’                                              â–¼\n    59â†’    Express Server â† Middleware Pipeline â† Route Handler\n    60â†’         â”‚               â”‚\n    61â†’         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    62â†’         â”‚     â”‚ Morgan â†’ Helmet â†’ CORS â†’ Compressionâ”‚\n    63â†’         â”‚     â”‚ â†’ JSON Parser (1MB) â†’ X-Request-ID  â”‚\n    64â†’         â”‚     â”‚ â†’ Rate Limiter â†’ Metrics â†’ Handler   â”‚\n    65â†’         â”‚     â”‚ â†’ Error Handler â†’ Response            â”‚\n    66â†’         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n    67â†’         â”‚\n    68â†’         â”œâ”€â†’ Firestore (read/write)\n    69â†’         â”œâ”€â†’ External API Proxy (with cache)\n    70â†’         â””â”€â†’ AI Service (computation)\n    71â†’\n    72â†’\n    73â†’2. TECHNOLOGY STACK\n    74â†’================================================================================\n    75â†’\n    76â†’2.1 Frontend Stack\n    77â†’\n    78â†’    | Component          | Technology              | Version    |\n    79â†’    |--------------------|-------------------------|------------|\n    80â†’    | Framework          | React                   | 19.2.0     |\n    81â†’    | Language           | TypeScript              | 5.9.3      |\n    82â†’    | Router             | React Router            | v7         |\n    83â†’    | Styling            | Tailwind CSS            | 4.1.18     |\n    84â†’    | State Management   | React Context + Hooks   | â€”          |\n    85â†’    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    86â†’    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    87â†’    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    88â†’    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    89â†’    | Icons              | Lucide React            | 0.563.0    |\n    90â†’    | Auth UI            | FirebaseUI              | latest     |\n    91â†’    | Build Tool         | Vite                    | 7.2.4      |\n    92â†’\n    93â†’2.2 Backend Stack\n    94â†’\n    95â†’    | Component          | Technology              | Version    |\n    96â†’    |--------------------|-------------------------|------------|\n    97â†’    | Framework          | Express.js              | 4.21.2     |\n    98â†’    | Language           | TypeScript              | 5.7.0      |\n    99â†’    | Runtime            | Node.js                 | 20.17.0    |\n   100â†’    | Database           | Google Firestore        | Native     |\n   101â†’    | Auth               | Firebase Admin SDK      | 13.6.1     |\n   102â†’    | Security           | Helmet                  | 8.1.0      |\n   103â†’    | CORS               | cors                    | 2.8.5      |\n   104â†’    | Logging            | Morgan                  | 1.10.0     |\n   105â†’    | Compression        | compression             | 1.8.0      |\n   106â†’    | Testing            | Vitest                  | 4.0.18     |\n   107â†’    | Build              | tsc + tsx                | latest     |\n   108â†’\n   109â†’2.3 Infrastructure\n   110â†’\n   111â†’    | Component          | Technology              | Details              |\n   112â†’    |--------------------|-------------------------|----------------------|\n   113â†’    | Hosting            | Google Cloud Run        | europe-west2         |\n   114â†’    | Container Registry | Artifact Registry       | europe-west2         |\n   115â†’    | Database           | Google Firestore        | Native mode          |\n   116â†’    | Authentication     | Firebase Auth           | Google SSO + email   |\n   117â†’    | Secrets            | Secret Manager          | 4 secrets            |\n   118â†’    | CI/CD              | Cloud Build             | Auto on git push     |\n   119â†’    | Source Control     | GitHub                  | rajivpeter repo      |\n   120â†’    | Monitoring         | Custom metrics + health | In-app               |\n   121â†’    | Session Capture    | Entire.io               | Manual commit        |\n   122â†’\n   123â†’2.4 Testing Stack\n   124â†’\n   125â†’    | Component          | Technology              | Coverage             |\n   126â†’    |--------------------|-------------------------|----------------------|\n   127â†’    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n   128â†’    | Unit               | Vitest                  | 66 tests             |\n   129â†’    | Type Checking      | TypeScript (strict)     | 0 errors             |\n   130â†’\n   131â†’\n   132â†’3. FRONTEND ARCHITECTURE\n   133â†’================================================================================\n   134â†’\n   135â†’3.1 Directory Structure\n   136â†’\n   137â†’    app/src/\n   138â†’    â”œâ”€â”€ App.tsx                  â€” Router with 40+ routes\n   139â†’    â”œâ”€â”€ main.tsx                 â€” React DOM entry point (QueryClient)\n   140â†’    â”œâ”€â”€ index.css                â€” Global styles, animations, accessibility\n   141â†’    â”‚\n   142â†’    â”œâ”€â”€ pages/                   â€” 19 page directories\n   143â†’    â”‚   â”œâ”€â”€ admin/               â€” AdminPage, IntegrationsPage\n   144â†’    â”‚   â”œâ”€â”€ ai-centre/           â€” AiCentrePage (Insights/Predictions/Differentiators)\n   145â†’    â”‚   â”œâ”€â”€ allocations/         â€” AllocationsPage\n   146â†’    â”‚   â”œâ”€â”€ asb/                 â€” AsbPage, AsbDetailPage\n   147â†’    â”‚   â”œâ”€â”€ auth/                â€” LoginPage (Firebase + Google)\n   148â†’    â”‚   â”œâ”€â”€ briefing/            â€” BriefingPage (morning briefing + neighbourhood)\n   149â†’    â”‚   â”œâ”€â”€ communications/      â€” CommunicationsPage\n   150â†’    â”‚   â”œâ”€â”€ complaints/          â€” ComplaintsPage, ComplaintDetailPage\n   151â†’    â”‚   â”œâ”€â”€ compliance/          â€” CompliancePage, ComplianceTypePage, AwaabsLawPage\n   152â†’    â”‚   â”œâ”€â”€ dashboard/           â€” DashboardPage (8 KPIs, charts, activity)\n   153â†’    â”‚   â”œâ”€â”€ explore/             â€” ExplorePage (7-level drill-down)\n   154â†’    â”‚   â”œâ”€â”€ properties/          â€” PropertiesPage, PropertyDetailPage,\n   155â†’    â”‚   â”‚                          ApplicationPage, ViewingBookingPage\n   156â†’    â”‚   â”œâ”€â”€ rent/                â€” RentPage\n   157â†’    â”‚   â”œâ”€â”€ repairs/             â€” RepairsPage, RepairDetailPage\n   158â†’    â”‚   â”œâ”€â”€ reports/             â€” ReportsPage, DynamicReportPage, TsmReportPage\n   159â†’    â”‚   â”œâ”€â”€ search/              â€” SearchPage\n   160â†’    â”‚   â”œâ”€â”€ tenancies/           â€” TenanciesPage, TenancyDetailPage\n   161â†’    â”‚   â”œâ”€â”€ tenant-portal/       â€” TenantPortalPage\n   162â†’    â”‚   â””â”€â”€ shared/              â€” ComingSoonPage\n   163â†’    â”‚\n   164â†’    â”œâ”€â”€ components/\n   165â†’    â”‚   â”œâ”€â”€ layout/              â€” Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n   166â†’    â”‚   â””â”€â”€ shared/              â€” 12 reusable components (ActionModal, AiActionCard,\n   167â†’    â”‚                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n   168â†’    â”‚                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n   169â†’    â”‚                              PropertyMap, StatusPill, VulnerabilityPanel)\n   170â†’    â”‚\n   171â†’    â”œâ”€â”€ data/                    â€” Mock/seed data (10 files)\n   172â†’    â”œâ”€â”€ hooks/                   â€” Custom hooks (3 files)\n   173â†’    â”‚   â”œâ”€â”€ useApi.ts            â€” 23 React Query hooks wrapping API methods\n   174â†’    â”‚   â”œâ”€â”€ useEntityIntelligence.ts  â€” AI scoring hooks\n   175â†’    â”‚   â””â”€â”€ usePersonaScope.ts   â€” Persona-based data filtering\n   176â†’    â”œâ”€â”€ types/                   â€” TypeScript definitions (721 lines)\n   177â†’    â”œâ”€â”€ services/                â€” API client (70+ methods), Firebase, AI drafting,\n   178â†’    â”‚                              public data helpers\n   179â†’    â”œâ”€â”€ contexts/                â€” AuthContext, AppContext\n   180â†’    â”œâ”€â”€ utils/                   â€” Formatting utilities (safeText, etc.)\n   181â†’    â””â”€â”€ assets/                  â€” Images, fonts\n   182â†’\n   183â†’3.2 Routing Architecture (React Router v7)\n   184â†’    All routes defined in App.tsx within BrowserRouter.\n   185â†’    Routes wrapped in Layout component (sidebar + header).\n   186â†’    Protected routes use ProtectedRoute component (Firebase auth guard).\n   187â†’\n   188â†’    Key Route Groups:\n   189â†’    /                           â†’ Redirect to /dashboard\n   190â†’    /login                      â†’ LoginPage (public)\n   191â†’    /dashboard                  â†’ DashboardPage\n   192â†’    /explore                    â†’ ExplorePage\n   193â†’    /tenancies                  â†’ TenanciesPage\n   194â†’    /tenancies/:id              â†’ TenancyDetailPage\n   195â†’    /properties                 â†’ PropertiesPage\n   196â†’    /properties/:id             â†’ PropertyDetailPage\n   197â†’    /properties/:id/apply       â†’ ApplicationPage\n   198â†’    /properties/:id/book-viewingâ†’ ViewingBookingPage\n   199â†’    /repairs                    â†’ RepairsPage\n   200â†’    /repairs/:id                â†’ RepairDetailPage\n   201â†’    /compliance                 â†’ CompliancePage\n   202â†’    /compliance/:type           â†’ ComplianceTypePage\n   203â†’    /compliance/awaabs-law      â†’ AwaabsLawPage\n   204â†’    /complaints                 â†’ ComplaintsPage\n   205â†’    /complaints/:id             â†’ ComplaintDetailPage\n   206â†’    /asb                        â†’ AsbPage\n   207â†’    /asb/:id                    â†’ AsbDetailPage\n   208â†’    /rent                       â†’ RentPage\n   209â†’    /allocations                â†’ AllocationsPage\n   210â†’    /communications             â†’ CommunicationsPage\n   211â†’    /reports                    â†’ ReportsPage\n   212â†’    /reports/:type              â†’ DynamicReportPage\n   213â†’    /reports/tsm                â†’ TsmReportPage\n   214â†’    /ai-centre                  â†’ AiCentrePage\n   215â†’    /briefing                   â†’ BriefingPage\n   216â†’    /admin                      â†’ AdminPage\n   217â†’    /admin/integrations         â†’ IntegrationsPage\n   218â†’    /tenant-portal              â†’ TenantPortalPage\n   219â†’    /search                     â†’ SearchPage\n   220â†’\n   221â†’3.3 State Management\n   222â†’    - React Context for global state (auth user, persona)\n   223â†’    - @tanstack/react-query for server state (API caching, 5-min stale time)\n   224â†’    - Local component state (useState, useReducer) for UI state\n   225â†’    - No Redux/Zustand â€” kept deliberately simple\n   226â†’\n   227â†’3.4 Data Fetching Layer\n   228â†’    - api-client.ts: 70+ typed API methods organized by domain\n   229â†’    - useApi.ts: React Query hooks wrapping api-client methods\n   230â†’    - useEntityIntelligence.ts: AI scoring hooks\n   231â†’    - usePersonaScope.ts: Persona-based data filtering\n   232â†’\n   233â†’3.5 Frontend Conventions\n   234â†’    - safeText() helper for rendering potentially undefined values\n   235â†’    - ?? [] for nullable arrays (prevents React Error #310)\n   236â†’    - Tailwind CSS utility classes (no CSS modules)\n   237â†’    - Lucide React for all icons\n   238â†’    - Purple border for AI-generated elements\n   239â†’    - Consistent page structure: header + filter bar + content grid\n   240â†’    - ErrorBoundary wrapping for error resilience\n   241â†’\n   242â†’3.6 Accessibility Implementation\n   243â†’    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n   244â†’      aria-modal, aria-labelledby, aria-describedby, focus restoration\n   245â†’    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n   246â†’      .sr-only class, .skip-to-content link, .field-error styles\n   247â†’    - Layout: skip-to-content link + id=\"main-content\" on <main>\n   248â†’    - Sidebar: aria-label on <nav> and collapse button\n   249â†’    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n   250â†’\n   251â†’\n   252â†’4. BACKEND ARCHITECTURE\n   253â†’================================================================================\n   254â†’\n   255â†’4.1 Directory Structure\n   256â†’\n   257â†’    server/src/\n   258â†’    â”œâ”€â”€ index.ts                 â€” Express entry, middleware, route registration\n   259â†’    â”‚\n   260â†’    â”œâ”€â”€ middleware/               â€” 5 middleware modules\n   261â†’    â”‚   â”œâ”€â”€ auth.ts              â€” Firebase token verification + X-Persona fallback\n   262â†’    â”‚   â”œâ”€â”€ error-handler.ts     â€” Structured JSON error handler (no stack leaks)\n   263â†’    â”‚   â”œâ”€â”€ metrics.ts           â€” Request/response metrics recording\n   264â†’    â”‚   â”œâ”€â”€ rate-limiter.ts      â€” Sliding window rate limiter (4 tiers)\n   265â†’    â”‚   â””â”€â”€ rbac.ts              â€” Role-based access control\n   266â†’    â”‚\n   267â†’    â”œâ”€â”€ routes/                  â€” 16 route modules (2,300+ lines)\n   268â†’    â”‚   â”œâ”€â”€ admin.ts             â€” Integration management, monitoring\n   269â†’    â”‚   â”œâ”€â”€ ai.ts                â€” 14 AI endpoints + 4 GOV.UK Notify endpoints\n   270â†’    â”‚   â”œâ”€â”€ auth.ts              â€” Login, register, logout\n   271â†’    â”‚   â”œâ”€â”€ briefing.ts          â€” Personalised morning briefing\n   272â†’    â”‚   â”œâ”€â”€ booking.ts           â€” Viewing bookings, applications\n   273â†’    â”‚   â”œâ”€â”€ cases.ts             â€” Unified case CRUD + pagination\n   274â†’    â”‚   â”œâ”€â”€ compliance.ts        â€” Big 6 compliance data\n   275â†’    â”‚   â”œâ”€â”€ explore.ts           â€” Hierarchy drill-down data\n   276â†’    â”‚   â”œâ”€â”€ export.ts            â€” CSV/PDF exports\n   277â†’    â”‚   â”œâ”€â”€ lettings.ts          â€” Void management, allocations\n   278â†’    â”‚   â”œâ”€â”€ properties.ts        â€” Property list/detail\n   279â†’    â”‚   â”œâ”€â”€ public-data.ts       â€” External API proxy (Tier 1-2)\n   280â†’    â”‚   â”œâ”€â”€ rent.ts              â€” Arrears, statements, transactions\n   281â†’    â”‚   â”œâ”€â”€ reports.ts           â€” 27 regulatory reports\n   282â†’    â”‚   â””â”€â”€ tenants.ts           â€” Tenant list/detail\n   283â†’    â”‚\n   284â†’    â”œâ”€â”€ services/                â€” 25 service modules\n   285â†’    â”‚   â”œâ”€â”€ external-api.ts      â€” Cache-through, rate limiting, audit\n   286â†’    â”‚   â”œâ”€â”€ firestore.ts         â€” Firestore connection + helpers\n   287â†’    â”‚   â”œâ”€â”€ firebase-admin.ts    â€” Firebase Admin initialization\n   288â†’    â”‚   â”œâ”€â”€ damp-prediction.ts   â€” 5-factor damp risk algorithm\n   289â†’    â”‚   â”œâ”€â”€ crime-context.ts     â€” Police data correlation\n   290â†’    â”‚   â”œâ”€â”€ vulnerability-detection.ts  â€” 7-factor scoring\n   291â†’    â”‚   â”œâ”€â”€ benefits-engine.ts   â€” UK benefit rules engine\n   292â†’    â”‚   â”œâ”€â”€ property-passport.ts â€” Multi-source aggregation\n   293â†’    â”‚   â”œâ”€â”€ neighbourhood-briefing.ts   â€” Per-estate briefing\n   294â†’    â”‚   â”œâ”€â”€ govuk-notify.ts      â€” 24 notification templates (1,257 lines)\n   295â†’    â”‚   â”œâ”€â”€ census-nomis.ts      â€” Census + NOMIS + Gas/Electrical (493 lines)\n   296â†’    â”‚   â”œâ”€â”€ mock-services.ts     â€” 9 Tier 3 mock endpoints\n   297â†’    â”‚   â”œâ”€â”€ monitoring.ts        â€” Metrics singleton\n   298â†’    â”‚   â”œâ”€â”€ hact-export.ts       â€” HACT reporting format\n   299â†’    â”‚   â”œâ”€â”€ seed.ts              â€” Database seeding\n   300â†’    â”‚   â”œâ”€â”€ seed-data.ts         â€” Seed data definitions\n   301â†’    â”‚   â””â”€â”€ hact-codes.ts        â€” SOR code definitions\n   302â†’    â”‚\n   303â†’    â”œâ”€â”€ models/\n   304â†’    â”‚   â”œâ”€â”€ firestore-schemas.ts â€” Firestore collection schemas\n   305â†’    â”‚   â””â”€â”€ hact-codes.ts        â€” Repair code models\n   306â†’    â”‚\n   307â†’    â””â”€â”€ scripts/\n   308â†’        â”œâ”€â”€ seed-imd.ts          â€” IMD data loader\n   309â†’        â””â”€â”€ seed.ts              â€” Main seed runner\n   310â†’\n   311â†’4.2 Middleware Pipeline (Request Flow)\n   312â†’\n   313â†’    Request â†’ Morgan Logger â†’ Helmet (CSP, security headers)\n   314â†’            â†’ CORS (restricted origins) â†’ Compression (gzip)\n   315â†’            â†’ JSON Parser (1MB limit) â†’ Request ID (X-Request-ID)\n   316â†’            â†’ Rate Limiter (4 tiers) â†’ Metrics Recorder â†’ Route Handler\n   317â†’            â†’ Error Handler â†’ Response\n   318â†’\n   319â†’4.3 Rate Limiting (4 Tiers)\n   320â†’\n   321â†’    | Tier    | Routes              | Limit        | Window  |\n   322â†’    |---------|---------------------|--------------|---------|\n   323â†’    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   324â†’    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   325â†’    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   326â†’    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   327â†’\n   328â†’4.4 Error Handling\n   329â†’    - Structured JSON error responses: { error, message, statusCode }\n   330â†’    - No stack traces leaked in production\n   331â†’    - Error logging with request ID correlation (X-Request-ID)\n   332â†’    - Graceful degradation for external API failures\n   333â†’    - ErrorBoundary on frontend for component-level recovery\n   334â†’\n   335â†’4.5 Health Check\n   336â†’    GET /health â†’ { status, firestore, uptime, memory, timestamp }\n   337â†’    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n   338â†’    Memory: RSS, heap used, heap total\n   339â†’\n   340â†’\n   341â†’5. DATA MODELS (FIRESTORE)\n   342â†’================================================================================\n   343â†’\n   344â†’5.1 Collection Map (17 Collections)\n   345â†’\n   346â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   347â†’    â”‚   organisations â”‚     â”‚     users        â”‚     â”‚     teams       â”‚\n   348â†’    â”‚   (1 doc)       â”‚â”€â”€â”€â”€â–¶â”‚   (10+ docs)     â”‚â”€â”€â”€â”€â–¶â”‚   (5+ docs)    â”‚\n   349â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   350â†’                                    â”‚\n   351â†’                                    â–¼\n   352â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   353â†’    â”‚   properties    â”‚â—€â”€â”€â”€â–¶â”‚    tenants       â”‚â—€â”€â”€â”€â–¶â”‚     cases       â”‚\n   354â†’    â”‚   (75 docs)     â”‚     â”‚   (68 docs)      â”‚     â”‚  (279+ docs)    â”‚\n   355â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   356â†’             â”‚                                               â”‚\n   357â†’             â–¼                                               â–¼\n   358â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   359â†’    â”‚   repairs       â”‚     â”‚   complaints     â”‚     â”‚      asb        â”‚\n   360â†’    â”‚  (200 docs)     â”‚     â”‚   (34 docs)      â”‚     â”‚   (12 docs)     â”‚\n   361â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   362â†’                                                            â”‚\n   363â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   364â†’    â”‚   financial     â”‚     â”‚   damp-mould     â”‚     â”‚   activities    â”‚\n   365â†’    â”‚   (docs)        â”‚     â”‚   (docs)         â”‚     â”‚   (docs)        â”‚\n   366â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   367â†’\n   368â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   369â†’    â”‚   tasks         â”‚     â”‚  integrations    â”‚     â”‚    auditLog     â”‚\n   370â†’    â”‚   (docs)        â”‚     â”‚   (20 docs)      â”‚     â”‚  (write-once)   â”‚\n   371â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   372â†’\n   373â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   374â†’    â”‚  externalDataCache   â”‚     â”‚    imdData       â”‚\n   375â†’    â”‚  (TTL-based cache)   â”‚     â”‚   (LSOA docs)    â”‚\n   376â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   377â†’\n   378â†’5.2 Property Schema\n   379â†’\n   380â†’    {\n   381â†’      id: string                    // Firestore document ID\n   382â†’      uprn: string                  // 12-digit UPRN\n   383â†’      address: {\n   384â†’        line1: string\n   385â†’        line2?: string\n   386â†’        town: string\n   387â†’        postcode: string            // Real SE London postcode\n   388â†’        lat: number\n   389â†’        lng: number\n   390â†’        lsoaCode: string            // LSOA for IMD/Census\n   391â†’      }\n   392â†’      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n   393â†’      bedrooms: number\n   394â†’      floor?: number\n   395â†’      estateId: string\n   396â†’      blockId?: string\n   397â†’      buildYear: number\n   398â†’      heatingType: string\n   399â†’      wallType: string\n   400â†’      roofType: string\n   401â†’      epc: {\n   402â†’        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n   403â†’        score: number\n   404â†’        certificateNumber?: string\n   405â†’        expiryDate: string\n   406â†’      }\n   407â†’      compliance: {\n   408â†’        gasSafety: { status, expiryDate, certificateRef }\n   409â†’        electricalSafety: { status, expiryDate, certificateRef }\n   410â†’        fireRiskAssessment: { status, lastAssessmentDate }\n   411â†’        asbestos: { status, surveyDate }\n   412â†’        legionella: { status, assessmentDate }\n   413â†’        liftSafety?: { status, inspectionDate }\n   414â†’      }\n   415â†’      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n   416â†’      tenantId?: string\n   417â†’      createdAt: timestamp\n   418â†’      updatedAt: timestamp\n   419â†’    }\n   420â†’\n   421â†’5.3 Tenant Schema\n   422â†’\n   423â†’    {\n   424â†’      id: string\n   425â†’      title: string\n   426â†’      firstName: string\n   427â†’      lastName: string\n   428â†’      dateOfBirth: string\n   429â†’      email: string\n   430â†’      phone: string\n   431â†’      nino?: string                 // National Insurance Number\n   432â†’      propertyId: string\n   433â†’      tenancyId: string\n   434â†’      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n   435â†’      tenancyStartDate: string\n   436â†’      rent: {\n   437â†’        weeklyAmount: number\n   438â†’        balance: number             // Negative = arrears\n   439â†’        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n   440â†’        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n   441â†’      }\n   442â†’      household: [\n   443â†’        { name, relationship, dateOfBirth, isDependent }\n   444â†’      ]\n   445â†’      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n   446â†’      emergencyContact: {\n   447â†’        name: string\n   448â†’        phone: string\n   449â†’        relationship: string\n   450â†’      }\n   451â†’      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n   452â†’      createdAt: timestamp\n   453â†’      updatedAt: timestamp\n   454â†’    }\n   455â†’\n   456â†’5.4 Case Schema (Unified)\n   457â†’\n   458â†’    {\n   459â†’      id: string\n   460â†’      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n   461â†’             | 'safeguarding' | 'enquiry'\n   462â†’      reference: string             // e.g., REP-2025-001\n   463â†’      title: string\n   464â†’      description: string\n   465â†’      status: string                // Type-specific statuses\n   466â†’      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n   467â†’      propertyId: string\n   468â†’      tenantId: string\n   469â†’      assignedTo: string            // User ID\n   470â†’      createdDate: string\n   471â†’      updatedDate: string\n   472â†’      closedDate?: string\n   473â†’      sla: {\n   474â†’        targetDate: string\n   475â†’        breached: boolean\n   476â†’      }\n   477â†’      timeline: [\n   478â†’        { date, action, actor, notes }\n   479â†’      ]\n   480â†’      // Type-specific fields via discriminated union\n   481â†’    }\n   482â†’\n   483â†’5.5 Repair Schema (extends Case)\n   484â†’\n   485â†’    {\n   486â†’      ...Case,\n   487â†’      type: 'repair',\n   488â†’      sorCode: string               // HACT SOR code\n   489â†’      trade: string                 // plumbing, electrical, carpentry, etc.\n   490â†’      appointment: {\n   491â†’        date: string\n   492â†’        timeSlot: string\n   493â†’        confirmedBy: string\n   494â†’      }\n   495â†’      contractor: {\n   496â†’        name: string\n   497â†’        company: string\n   498â†’        gasSafeNumber?: string\n   499â†’        niceicNumber?: string\n   500â†’      }\n   501â†’      cost: {\n   502â†’        estimated: number\n   503â†’        actual?: number\n   504â†’        authorised: boolean\n   505â†’      }\n   506â†’      photos: {\n   507â†’        before: string[]\n   508â†’        after: string[]\n   509â†’      }\n   510â†’      satisfaction?: {\n   511â†’        rating: number              // 1-5\n   512â†’        feedback: string\n   513â†’        date: string\n   514â†’      }\n   515â†’    }\n   516â†’\n   517â†’5.6 Complaint Schema (extends Case)\n   518â†’\n   519â†’    {\n   520â†’      ...Case,\n   521â†’      type: 'complaint',\n   522â†’      stage: 1 | 2\n   523â†’      category: string\n   524â†’      deadlines: {\n   525â†’        stage1Acknowledgement: string   // 5 working days\n   526â†’        stage1Response: string          // 10 working days\n   527â†’        stage2Response?: string         // 20 working days\n   528â†’      }\n   529â†’      ombudsmanRef?: string\n   530â†’      escalatedDate?: string\n   531â†’      outcome?: string\n   532â†’      learningActions: string[]\n   533â†’    }\n   534â†’\n   535â†’5.7 ASB Schema (extends Case)\n   536â†’\n   537â†’    {\n   538â†’      ...Case,\n   539â†’      type: 'asb',\n   540â†’      severity: 'low' | 'medium' | 'high' | 'critical'\n   541â†’      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n   542â†’      evidenceLog: [\n   543â†’        { date, type, description, attachments }\n   544â†’      ]\n   545â†’      perpetratorId?: string\n   546â†’      victimIds: string[]\n   547â†’      communityTrigger: boolean\n   548â†’    }\n   549â†’\n   550â†’5.8 ExternalDataCache Schema\n   551â†’\n   552â†’    {\n   553â†’      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n   554â†’      source: string                // API source identifier\n   555â†’      data: object                  // Cached response payload\n   556â†’      fetchedAt: timestamp          // When data was fetched\n   557â†’      ttl: number                   // TTL in seconds\n   558â†’      expiresAt: timestamp          // Computed expiry\n   559â†’      requestParams: object         // Original request parameters\n   560â†’    }\n   561â†’\n   562â†’5.9 Integration Schema\n   563â†’\n   564â†’    {\n   565â†’      id: string\n   566â†’      name: string\n   567â†’      tier: 1 | 2 | 3\n   568â†’      category: string\n   569â†’      status: 'active' | 'inactive' | 'error' | 'pending'\n   570â†’      enabled: boolean\n   571â†’      config: {\n   572â†’        baseUrl: string\n   573â†’        apiKey?: string\n   574â†’        rateLimit: number\n   575â†’      }\n   576â†’      stats: {\n   577â†’        lastUsed: string\n   578â†’        requestCount: number\n   579â†’        avgResponseTime: number\n   580â†’        cacheHitRate: number\n   581â†’        errorRate: number\n   582â†’      }\n   583â†’    }\n   584â†’\n   585â†’5.10 Firestore Indexes (Composite)\n   586â†’    Defined in firestore.indexes.json at project root (16 indexes).\n   587â†’    Key indexes for:\n   588â†’    - cases: (propertyId, type, createdDate DESC)\n   589â†’    - cases: (tenantId, type, createdDate DESC)\n   590â†’    - cases: (status, priority, createdDate DESC)\n   591â†’    - activities: (entityId, timestamp DESC)\n   592â†’    - externalDataCache: (source, expiresAt)\n   593â†’\n   594â†’5.11 Firestore Security Rules\n   595â†’    Defined in firestore.rules at project root.\n   596â†’    Persona-based access control for all 15 collections.\n   597â†’    Audit log is write-once, read-many (immutable).\n   598â†’\n   599â†’\n   600â†’6. API ARCHITECTURE\n   601â†’================================================================================\n   602â†’\n   603â†’6.1 API Design Principles\n   604â†’    - RESTful design with /api/v1/ prefix\n   605â†’    - JSON request/response bodies\n   606â†’    - Consistent error format: { error, message, statusCode }\n   607â†’    - Pagination: ?page=N&limit=N (default 20, max 50)\n   608â†’    - Filtering: Query parameters per endpoint\n   609â†’    - Sorting: ?sort=field&order=asc|desc\n   610â†’    - Request correlation via X-Request-ID header\n   611â†’\n   612â†’6.2 API Route Registry (50+ endpoints)\n   613â†’\n   614â†’    AUTHENTICATION (3)\n   615â†’    POST   /api/v1/auth/login          â€” Firebase token login\n   616â†’    POST   /api/v1/auth/register       â€” User registration\n   617â†’    POST   /api/v1/auth/logout         â€” Session invalidation\n   618â†’\n   619â†’    PROPERTIES (2)\n   620â†’    GET    /api/v1/properties           â€” List with pagination/filter\n   621â†’    GET    /api/v1/properties/:id       â€” Property detail\n   622â†’\n   623â†’    TENANTS (2)\n   624â†’    GET    /api/v1/tenants              â€” List with pagination/filter\n   625â†’    GET    /api/v1/tenants/:id          â€” Tenant detail\n   626â†’\n   627â†’    CASES (5)\n   628â†’    GET    /api/v1/cases                â€” List with type/status filter\n   629â†’    GET    /api/v1/cases/:id            â€” Case detail\n   630â†’    POST   /api/v1/cases                â€” Create case\n   631â†’    PUT    /api/v1/cases/:id            â€” Update case\n   632â†’    DELETE /api/v1/cases/:id            â€” Close/archive case\n   633â†’\n   634â†’    CONVENIENCE ALIASES\n   635â†’    GET    /api/v1/repairs              â€” All repairs (type=='repair')\n   636â†’    GET    /api/v1/complaints           â€” All complaints (type=='complaint')\n   637â†’\n   638â†’    COMPLIANCE (2)\n   639â†’    GET    /api/v1/compliance           â€” Big 6 summary dashboard\n   640â†’    GET    /api/v1/compliance/:type     â€” Type-specific data\n   641â†’\n   642â†’    EXPLORE (2+)\n   643â†’    GET    /api/v1/explore/hierarchy    â€” Full drill-down hierarchy\n   644â†’    GET    /api/v1/explore/estate/:id   â€” Estate detail with blocks\n   645â†’\n   646â†’    RENT (3)\n   647â†’    GET    /api/v1/rent/arrears         â€” Arrears dashboard summary\n   648â†’    GET    /api/v1/rent/statements/:id  â€” Tenant statement (52 weeks)\n   649â†’    GET    /api/v1/rent/transactions    â€” Transaction list\n   650â†’\n   651â†’    REPAIRS (2)\n   652â†’    GET    /api/v1/repairs              â€” Repair list\n   653â†’    GET    /api/v1/repairs/:id          â€” Repair detail\n   654â†’\n   655â†’    REPORTS (3)\n   656â†’    GET    /api/v1/reports              â€” Report catalog (27 types)\n   657â†’    GET    /api/v1/reports/:type        â€” Generate report data\n   658â†’    GET    /api/v1/reports/tsm          â€” TSM specific data\n   659â†’\n   660â†’    LETTINGS (2)\n   661â†’    GET    /api/v1/lettings/voids       â€” Void property list\n   662â†’    GET    /api/v1/lettings/register    â€” Housing register\n   663â†’\n   664â†’    BOOKING (2)\n   665â†’    POST   /api/v1/booking/viewing      â€” Book a viewing\n   666â†’    POST   /api/v1/booking/application  â€” Submit application\n   667â†’\n   668â†’    BRIEFING (2)\n   669â†’    GET    /api/v1/briefing             â€” Personalised morning briefing\n   670â†’    GET    /api/v1/briefing/:estateId   â€” Estate-specific briefing\n   671â†’\n   672â†’    EXPORT (2)\n   673â†’    GET    /api/v1/export/csv/:type     â€” CSV export\n   674â†’    GET    /api/v1/export/pdf/:type     â€” PDF export\n   675â†’\n   676â†’    AI INTELLIGENCE (14)\n   677â†’    GET    /api/v1/ai/damp-risk/:propertyId            â€” Damp risk score\n   678â†’    GET    /api/v1/ai/damp-risk/estate/:estateId       â€” Estate damp overview\n   679â†’    GET    /api/v1/ai/crime-context/:estateId           â€” Crime context\n   680â†’    GET    /api/v1/ai/crime-context/case/:caseId        â€” Case crime correlation\n   681â†’    GET    /api/v1/ai/vulnerability/:tenantId            â€” Vulnerability score\n   682â†’    POST   /api/v1/ai/vulnerability/scan                 â€” Bulk scan all tenants\n   683â†’    GET    /api/v1/ai/benefits-check/:tenantId           â€” Benefits entitlement\n   684â†’    GET    /api/v1/ai/property-passport/:propertyId      â€” Property passport\n   685â†’    GET    /api/v1/ai/briefing/:estateId                 â€” Neighbourhood briefing\n   686â†’    GET    /api/v1/ai/notify/templates                   â€” List GOV.UK templates\n   687â†’    GET    /api/v1/ai/notify/templates/:category         â€” Templates by category\n   688â†’    GET    /api/v1/ai/notify/template/:id                â€” Template detail\n   689â†’    POST   /api/v1/ai/notify/render                      â€” Render template\n   690â†’    POST   /api/v1/ai/chat                               â€” Yantra Assist chat\n   691â†’\n   692â†’    MOCK TIER 3 (9)\n   693â†’    GET    /api/v1/ai/mock/uc-verification/:tenantId     â€” DWP UC check\n   694â†’    GET    /api/v1/ai/mock/iot-sensors/:propertyId       â€” IoT sensor data\n   695â†’    GET    /api/v1/ai/mock/direct-debit/:tenantId        â€” GoCardless data\n   696â†’    GET    /api/v1/ai/mock/labour-market/:lsoaCode       â€” NOMIS data\n   697â†’    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   â€” Plentific\n   698â†’    POST   /api/v1/ai/mock/regulatory                    â€” RSH/CORE submission\n   699â†’    POST   /api/v1/ai/mock/signing                       â€” DocuSign envelope\n   700â†’    GET    /api/v1/ai/mock/referencing/:applicantId      â€” Experian check\n   701â†’    GET    /api/v1/ai/mock/land-registry/:propertyId     â€” Land Registry\n   702â†’\n   703â†’    EXTERNAL DATA PROXY (9)\n   704â†’    GET    /api/v1/public-data/police/:postcode          â€” Police crime data\n   705â†’    GET    /api/v1/public-data/weather/:lat/:lng          â€” Weather forecast\n   706â†’    GET    /api/v1/public-data/flood-risk/:postcode       â€” Flood risk\n   707â†’    GET    /api/v1/public-data/postcode/:postcode         â€” Postcode lookup\n   708â†’    GET    /api/v1/public-data/epc/:uprn                  â€” EPC certificate\n   709â†’    GET    /api/v1/public-data/census/:lsoaCode            â€” Census 2021\n   710â†’    GET    /api/v1/public-data/nomis/:lsoaCode             â€” NOMIS labour\n   711â†’    GET    /api/v1/public-data/gas-safe/:regNumber         â€” Gas Safe verify\n   712â†’    GET    /api/v1/public-data/electrical-safety/:regNo    â€” Electrical verify\n   713â†’\n   714â†’    ADMIN (4)\n   715â†’    GET    /api/v1/admin/integrations                    â€” List integrations\n   716â†’    POST   /api/v1/admin/integrations/:id/toggle         â€” Enable/disable\n   717â†’    POST   /api/v1/admin/integrations/:id/test           â€” Test connection\n   718â†’    GET    /api/v1/admin/monitoring                       â€” Metrics dashboard\n   719â†’\n   720â†’    CONFIG & HEALTH\n   721â†’    GET    /api/v1/config              â€” Firebase client config (public)\n   722â†’    GET    /health                     â€” Health check\n   723â†’\n   724â†’\n   725â†’7. EXTERNAL API INTEGRATION ARCHITECTURE\n   726â†’================================================================================\n   727â†’\n   728â†’7.1 Server-Side Proxy Pattern\n   729â†’    All external API calls are proxied through the Express server.\n   730â†’    Frontend NEVER calls external APIs directly.\n   731â†’\n   732â†’    Frontend â†’ api-client.ts â†’ /api/v1/public-data/* â†’ external-api.ts â†’ External API\n   733â†’\n   734â†’7.2 Caching Strategy (Firestore-based)\n   735â†’    Collection: externalDataCache\n   736â†’    Pattern: Cache-through with TTL\n   737â†’\n   738â†’    | Data Source       | TTL      | Rationale                    |\n   739â†’    |-------------------|----------|------------------------------|\n   740â†’    | Weather           | 1 hour   | Forecast changes frequently  |\n   741â†’    | Crime data        | 24 hours | Updated monthly by Police.uk |\n   742â†’    | EPC certificates  | 30 days  | Rarely changes               |\n   743â†’    | Census data       | 90 days  | Static (Census 2021)         |\n   744â†’    | Postcode lookup   | 7 days   | Rarely changes               |\n   745â†’    | Gas Safe          | 24 hours | Registration status           |\n   746â†’    | Electrical Safety | 24 hours | Registration status           |\n   747â†’    | IMD data          | 90 days  | Annual update cycle          |\n   748â†’    | NOMIS             | 30 days  | Monthly refresh               |\n   749â†’    | Flood risk        | 1 hour   | Changes with weather          |\n   750â†’\n   751â†’7.3 Rate Limiting (External APIs)\n   752â†’    Token bucket pattern per API source.\n   753â†’    Fair-use limit: 15 requests/second across all external APIs.\n   754â†’\n   755â†’7.4 Graceful Degradation\n   756â†’    All external APIs have simulated fallbacks.\n   757â†’    If an API fails or times out:\n   758â†’    - Timeout: 10 seconds per external request\n   759â†’    - Retry: 1 retry with exponential backoff (2s)\n   760â†’    - Return simulated fallback data\n   761â†’    - Flag response: { source: 'live' | 'simulated' }\n   762â†’    Simulated data is realistic, consistent (deterministic seeding), flagged.\n   763â†’\n   764â†’\n   765â†’8. SECURITY ARCHITECTURE\n   766â†’================================================================================\n   767â†’\n   768â†’8.1 Authentication Flow\n   769â†’    1. User visits /login\n   770â†’    2. FirebaseUI widget presents Google SSO or email/password\n   771â†’    3. Firebase returns ID token (JWT)\n   772â†’    4. Frontend stores token, sends in Authorization header\n   773â†’    5. Express middleware verifies token via Firebase Admin SDK\n   774â†’    6. User context loaded (role, persona, permissions)\n   775â†’    7. Fallback: X-Persona header for development (non-production)\n   776â†’\n   777â†’8.2 Authorization (RBAC)\n   778â†’    10 default roles with hierarchical permissions:\n   779â†’    - super-admin, org-admin, regional-manager, area-manager\n   780â†’    - housing-manager, senior-officer, housing-officer\n   781â†’    - repairs-coordinator, repairs-operative, read-only\n   782â†’\n   783â†’8.3 Security Headers\n   784â†’    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n   785â†’    - X-Content-Type-Options: nosniff\n   786â†’    - X-Frame-Options: DENY\n   787â†’    - Referrer-Policy: strict-origin-when-cross-origin\n   788â†’    - Permissions-Policy (camera, microphone, geolocation disabled)\n   789â†’    - Strict-Transport-Security: max-age=31536000\n   790â†’\n   791â†’8.4 Secrets Management\n   792â†’    All secrets stored in Google Secret Manager:\n   793â†’    - FIREBASE_API_KEY\n   794â†’    - FIREBASE_AUTH_DOMAIN\n   795â†’    - FIREBASE_PROJECT_ID\n   796â†’    - DEMO_USER_PASSWORD\n   797â†’    No secrets in source code or environment files.\n   798â†’\n   799â†’\n   800â†’9. DEPLOYMENT ARCHITECTURE\n   801â†’================================================================================\n   802â†’\n   803â†’9.1 Deployment Pipeline\n   804â†’\n   805â†’    Developer â†’ git push origin main\n   806â†’                    â”‚\n   807â†’                    â–¼\n   808â†’    GitHub Repository (rajivpeter/SocialHomes_ai)\n   809â†’                    â”‚\n   810â†’                    â–¼\n   811â†’    Cloud Build (auto-triggered)\n   812â†’     â”œâ”€â”€ Step 1: Build React frontend (Vite)\n   813â†’     â”œâ”€â”€ Step 2: Build Express backend (tsc)\n   814â†’     â””â”€â”€ Step 3: Build & push Docker image\n   815â†’                    â”‚\n   816â†’                    â–¼\n   817â†’    Artifact Registry (europe-west2)\n   818â†’     â””â”€â”€ cloud-run-source-deploy/socialhomes:latest\n   819â†’                    â”‚\n   820â†’                    â–¼\n   821â†’    Cloud Run (europe-west2)\n   822â†’     â”œâ”€â”€ Min instances: 0\n   823â†’     â”œâ”€â”€ Max instances: 10\n   824â†’     â”œâ”€â”€ Memory: 1Gi\n   825â†’     â”œâ”€â”€ CPU: 1\n   826â†’     â”œâ”€â”€ Concurrency: 80\n   827â†’     â”œâ”€â”€ Timeout: 300s\n   828â†’     â”œâ”€â”€ Port: 8080\n   829â†’     â””â”€â”€ Secrets: 4 from Secret Manager\n   830â†’\n   831â†’9.2 Docker Build (Multi-Stage)\n   832â†’    Stage 1: Build client (Vite) â€” node:20-slim base\n   833â†’    Stage 2: Build server (tsc) â€” node:20-slim base\n   834â†’    Stage 3: Production â€” copy built assets, start server (~500MB image)\n   835â†’\n   836â†’9.3 Cloud Run Configuration\n   837â†’    Region: europe-west2 (London)\n   838â†’    Auto-scaling based on request volume\n   839â†’    Min instances 0 for cost efficiency (cold start < 3s)\n   840â†’\n   841â†’9.4 Key Infrastructure References\n   842â†’    GCP Project ID: gen-lang-client-0878518473\n   843â†’    GCP Project Number: 587984201316\n   844â†’    Firebase Project: gen-lang-client-0146156913\n   845â†’    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n   846â†’                       cloud-run-source-deploy/socialhomes\n   847â†’    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n   848â†’\n   849â†’\n   850â†’10. MONITORING & OBSERVABILITY\n   851â†’================================================================================\n   852â†’\n   853â†’10.1 Custom Metrics (In-App)\n   854â†’    - Request count (by endpoint, method, status code)\n   855â†’    - Response time percentiles (P50, P95, P99)\n   856â†’    - Cache hit/miss rates per API source\n   857â†’    - Firestore query latency\n   858â†’    - Error rate and error types\n   859â†’    - Active concurrent requests\n   860â†’\n   861â†’10.2 Health Check\n   862â†’    GET /health\n   863â†’    - Firestore connectivity check with latency measurement\n   864â†’    - Memory usage (RSS, heap used, heap total)\n   865â†’    - Process uptime\n   866â†’    - Status: healthy | degraded | unhealthy\n   867â†’\n   868â†’10.3 Structured Logging\n   869â†’    - JSON format for all logs\n   870â†’    - Request ID correlation (X-Request-ID)\n   871â†’    - No sensitive data in logs (no PII)\n   872â†’    - Error logging with full non-PII context\n   873â†’\n   874â†’10.4 Admin Monitoring Dashboard\n   875â†’    GET /api/v1/admin/monitoring\n   876â†’    - Real-time metrics display\n   877â†’    - Integration status overview (20 integrations)\n   878â†’    - Cache performance statistics\n   879â†’    - Error rate trending\n   880â†’\n   881â†’\n   882â†’================================================================================\n   883â†’  End of Doc2 â€” SocialHomes.Ai Technical Architecture & Data Models\n   884â†’  Yantra Works | 2026-02-23\n   885â†’================================================================================\n   886â†’"}]},"uuid":"dca37a27-0239-4c9b-81bd-e87f707e7791","timestamp":"2026-02-24T10:42:22.594Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 â€” SocialHomes.Ai Technical Architecture & Data Models\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚                        CLOUD RUN (europe-west2)                â”‚\n    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\n    â”‚  â”‚                    Express.js Server                      â”‚  â”‚\n    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚\n    â”‚  â”‚  â”‚ Static Files â”‚  â”‚   API v1     â”‚  â”‚  Middleware    â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚ (React SPA)  â”‚  â”‚  /api/v1/*   â”‚  â”‚ Auth/RBAC/    â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ Rate Limit/   â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚ Vite Build   â”‚  â”‚ 16 route     â”‚  â”‚ Metrics/CSP   â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚ Output       â”‚  â”‚ modules      â”‚  â”‚               â”‚  â”‚  â”‚\n    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚\n    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\n    â”‚                              â”‚                                  â”‚\n    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\n    â”‚  â”‚                    Service Layer (25 modules)             â”‚  â”‚\n    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚\n    â”‚  â”‚  â”‚ AI      â”‚ â”‚ External â”‚ â”‚ GOV.UK   â”‚ â”‚ Mock        â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚ Servicesâ”‚ â”‚ API      â”‚ â”‚ Notify   â”‚ â”‚ Services    â”‚  â”‚  â”‚\n    â”‚  â”‚  â”‚ (7)     â”‚ â”‚ Proxy    â”‚ â”‚ (24 tmpl)â”‚ â”‚ (5 Tier 3)  â”‚  â”‚  â”‚\n    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚\n    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                   â”‚\n              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n              â”‚                    â”‚                     â”‚\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”\n    â”‚   Firestore    â”‚  â”‚  Firebase Auth â”‚  â”‚ Secret Manager â”‚\n    â”‚  (17 colls)    â”‚  â”‚  (Google SSO)  â”‚  â”‚  (4 secrets)   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n              â”‚\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚              External APIs (3 Tiers)               â”‚\n    â”‚  Tier 1: Police.uk, Open-Meteo, DEFRA             â”‚\n    â”‚  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. â”‚\n    â”‚  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n1.3 Request Flow Diagram\n\n    Browser â†’ React SPA â†’ api-client.ts â†’ HTTP Request\n                                              â”‚\n                                              â–¼\n    Express Server â† Middleware Pipeline â† Route Handler\n         â”‚               â”‚\n         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n         â”‚     â”‚ Morgan â†’ Helmet â†’ CORS â†’ Compressionâ”‚\n         â”‚     â”‚ â†’ JSON Parser (1MB) â†’ X-Request-ID  â”‚\n         â”‚     â”‚ â†’ Rate Limiter â†’ Metrics â†’ Handler   â”‚\n         â”‚     â”‚ â†’ Error Handler â†’ Response            â”‚\n         â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n         â”‚\n         â”œâ”€â†’ Firestore (read/write)\n         â”œâ”€â†’ External API Proxy (with cache)\n         â””â”€â†’ AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | â€”          |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    â”œâ”€â”€ App.tsx                  â€” Router with 40+ routes\n    â”œâ”€â”€ main.tsx                 â€” React DOM entry point (QueryClient)\n    â”œâ”€â”€ index.css                â€” Global styles, animations, accessibility\n    â”‚\n    â”œâ”€â”€ pages/                   â€” 19 page directories\n    â”‚   â”œâ”€â”€ admin/               â€” AdminPage, IntegrationsPage\n    â”‚   â”œâ”€â”€ ai-centre/           â€” AiCentrePage (Insights/Predictions/Differentiators)\n    â”‚   â”œâ”€â”€ allocations/         â€” AllocationsPage\n    â”‚   â”œâ”€â”€ asb/                 â€” AsbPage, AsbDetailPage\n    â”‚   â”œâ”€â”€ auth/                â€” LoginPage (Firebase + Google)\n    â”‚   â”œâ”€â”€ briefing/            â€” BriefingPage (morning briefing + neighbourhood)\n    â”‚   â”œâ”€â”€ communications/      â€” CommunicationsPage\n    â”‚   â”œâ”€â”€ complaints/          â€” ComplaintsPage, ComplaintDetailPage\n    â”‚   â”œâ”€â”€ compliance/          â€” CompliancePage, ComplianceTypePage, AwaabsLawPage\n    â”‚   â”œâ”€â”€ dashboard/           â€” DashboardPage (8 KPIs, charts, activity)\n    â”‚   â”œâ”€â”€ explore/             â€” ExplorePage (7-level drill-down)\n    â”‚   â”œâ”€â”€ properties/          â€” PropertiesPage, PropertyDetailPage,\n    â”‚   â”‚                          ApplicationPage, ViewingBookingPage\n    â”‚   â”œâ”€â”€ rent/                â€” RentPage\n    â”‚   â”œâ”€â”€ repairs/             â€” RepairsPage, RepairDetailPage\n    â”‚   â”œâ”€â”€ reports/             â€” ReportsPage, DynamicReportPage, TsmReportPage\n    â”‚   â”œâ”€â”€ search/              â€” SearchPage\n    â”‚   â”œâ”€â”€ tenancies/           â€” TenanciesPage, TenancyDetailPage\n    â”‚   â”œâ”€â”€ tenant-portal/       â€” TenantPortalPage\n    â”‚   â””â”€â”€ shared/              â€” ComingSoonPage\n    â”‚\n    â”œâ”€â”€ components/\n    â”‚   â”œâ”€â”€ layout/              â€” Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    â”‚   â””â”€â”€ shared/              â€” 12 reusable components (ActionModal, AiActionCard,\n    â”‚                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    â”‚                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    â”‚                              PropertyMap, StatusPill, VulnerabilityPanel)\n    â”‚\n    â”œâ”€â”€ data/                    â€” Mock/seed data (10 files)\n    â”œâ”€â”€ hooks/                   â€” Custom hooks (3 files)\n    â”‚   â”œâ”€â”€ useApi.ts            â€” 23 React Query hooks wrapping API methods\n    â”‚   â”œâ”€â”€ useEntityIntelligence.ts  â€” AI scoring hooks\n    â”‚   â””â”€â”€ usePersonaScope.ts   â€” Persona-based data filtering\n    â”œâ”€â”€ types/                   â€” TypeScript definitions (721 lines)\n    â”œâ”€â”€ services/                â€” API client (70+ methods), Firebase, AI drafting,\n    â”‚                              public data helpers\n    â”œâ”€â”€ contexts/                â€” AuthContext, AppContext\n    â”œâ”€â”€ utils/                   â€” Formatting utilities (safeText, etc.)\n    â””â”€â”€ assets/                  â€” Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           â†’ Redirect to /dashboard\n    /login                      â†’ LoginPage (public)\n    /dashboard                  â†’ DashboardPage\n    /explore                    â†’ ExplorePage\n    /tenancies                  â†’ TenanciesPage\n    /tenancies/:id              â†’ TenancyDetailPage\n    /properties                 â†’ PropertiesPage\n    /properties/:id             â†’ PropertyDetailPage\n    /properties/:id/apply       â†’ ApplicationPage\n    /properties/:id/book-viewingâ†’ ViewingBookingPage\n    /repairs                    â†’ RepairsPage\n    /repairs/:id                â†’ RepairDetailPage\n    /compliance                 â†’ CompliancePage\n    /compliance/:type           â†’ ComplianceTypePage\n    /compliance/awaabs-law      â†’ AwaabsLawPage\n    /complaints                 â†’ ComplaintsPage\n    /complaints/:id             â†’ ComplaintDetailPage\n    /asb                        â†’ AsbPage\n    /asb/:id                    â†’ AsbDetailPage\n    /rent                       â†’ RentPage\n    /allocations                â†’ AllocationsPage\n    /communications             â†’ CommunicationsPage\n    /reports                    â†’ ReportsPage\n    /reports/:type              â†’ DynamicReportPage\n    /reports/tsm                â†’ TsmReportPage\n    /ai-centre                  â†’ AiCentrePage\n    /briefing                   â†’ BriefingPage\n    /admin                      â†’ AdminPage\n    /admin/integrations         â†’ IntegrationsPage\n    /tenant-portal              â†’ TenantPortalPage\n    /search                     â†’ SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand â€” kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    â”œâ”€â”€ index.ts                 â€” Express entry, middleware, route registration\n    â”‚\n    â”œâ”€â”€ middleware/               â€” 5 middleware modules\n    â”‚   â”œâ”€â”€ auth.ts              â€” Firebase token verification + X-Persona fallback\n    â”‚   â”œâ”€â”€ error-handler.ts     â€” Structured JSON error handler (no stack leaks)\n    â”‚   â”œâ”€â”€ metrics.ts           â€” Request/response metrics recording\n    â”‚   â”œâ”€â”€ rate-limiter.ts      â€” Sliding window rate limiter (4 tiers)\n    â”‚   â””â”€â”€ rbac.ts              â€” Role-based access control\n    â”‚\n    â”œâ”€â”€ routes/                  â€” 16 route modules (2,300+ lines)\n    â”‚   â”œâ”€â”€ admin.ts             â€” Integration management, monitoring\n    â”‚   â”œâ”€â”€ ai.ts                â€” 14 AI endpoints + 4 GOV.UK Notify endpoints\n    â”‚   â”œâ”€â”€ auth.ts              â€” Login, register, logout\n    â”‚   â”œâ”€â”€ briefing.ts          â€” Personalised morning briefing\n    â”‚   â”œâ”€â”€ booking.ts           â€” Viewing bookings, applications\n    â”‚   â”œâ”€â”€ cases.ts             â€” Unified case CRUD + pagination\n    â”‚   â”œâ”€â”€ compliance.ts        â€” Big 6 compliance data\n    â”‚   â”œâ”€â”€ explore.ts           â€” Hierarchy drill-down data\n    â”‚   â”œâ”€â”€ export.ts            â€” CSV/PDF exports\n    â”‚   â”œâ”€â”€ lettings.ts          â€” Void management, allocations\n    â”‚   â”œâ”€â”€ properties.ts        â€” Property list/detail\n    â”‚   â”œâ”€â”€ public-data.ts       â€” External API proxy (Tier 1-2)\n    â”‚   â”œâ”€â”€ rent.ts              â€” Arrears, statements, transactions\n    â”‚   â”œâ”€â”€ reports.ts           â€” 27 regulatory reports\n    â”‚   â””â”€â”€ tenants.ts           â€” Tenant list/detail\n    â”‚\n    â”œâ”€â”€ services/                â€” 25 service modules\n    â”‚   â”œâ”€â”€ external-api.ts      â€” Cache-through, rate limiting, audit\n    â”‚   â”œâ”€â”€ firestore.ts         â€” Firestore connection + helpers\n    â”‚   â”œâ”€â”€ firebase-admin.ts    â€” Firebase Admin initialization\n    â”‚   â”œâ”€â”€ damp-prediction.ts   â€” 5-factor damp risk algorithm\n    â”‚   â”œâ”€â”€ crime-context.ts     â€” Police data correlation\n    â”‚   â”œâ”€â”€ vulnerability-detection.ts  â€” 7-factor scoring\n    â”‚   â”œâ”€â”€ benefits-engine.ts   â€” UK benefit rules engine\n    â”‚   â”œâ”€â”€ property-passport.ts â€” Multi-source aggregation\n    â”‚   â”œâ”€â”€ neighbourhood-briefing.ts   â€” Per-estate briefing\n    â”‚   â”œâ”€â”€ govuk-notify.ts      â€” 24 notification templates (1,257 lines)\n    â”‚   â”œâ”€â”€ census-nomis.ts      â€” Census + NOMIS + Gas/Electrical (493 lines)\n    â”‚   â”œâ”€â”€ mock-services.ts     â€” 9 Tier 3 mock endpoints\n    â”‚   â”œâ”€â”€ monitoring.ts        â€” Metrics singleton\n    â”‚   â”œâ”€â”€ hact-export.ts       â€” HACT reporting format\n    â”‚   â”œâ”€â”€ seed.ts              â€” Database seeding\n    â”‚   â”œâ”€â”€ seed-data.ts         â€” Seed data definitions\n    â”‚   â””â”€â”€ hact-codes.ts        â€” SOR code definitions\n    â”‚\n    â”œâ”€â”€ models/\n    â”‚   â”œâ”€â”€ firestore-schemas.ts â€” Firestore collection schemas\n    â”‚   â””â”€â”€ hact-codes.ts        â€” Repair code models\n    â”‚\n    â””â”€â”€ scripts/\n        â”œâ”€â”€ seed-imd.ts          â€” IMD data loader\n        â””â”€â”€ seed.ts              â€” Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request â†’ Morgan Logger â†’ Helmet (CSP, security headers)\n            â†’ CORS (restricted origins) â†’ Compression (gzip)\n            â†’ JSON Parser (1MB limit) â†’ Request ID (X-Request-ID)\n            â†’ Rate Limiter (4 tiers) â†’ Metrics Recorder â†’ Route Handler\n            â†’ Error Handler â†’ Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health â†’ { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚   organisations â”‚     â”‚     users        â”‚     â”‚     teams       â”‚\n    â”‚   (1 doc)       â”‚â”€â”€â”€â”€â–¶â”‚   (10+ docs)     â”‚â”€â”€â”€â”€â–¶â”‚   (5+ docs)    â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                    â”‚\n                                    â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚   properties    â”‚â—€â”€â”€â”€â–¶â”‚    tenants       â”‚â—€â”€â”€â”€â–¶â”‚     cases       â”‚\n    â”‚   (75 docs)     â”‚     â”‚   (68 docs)      â”‚     â”‚  (279+ docs)    â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n             â”‚                                               â”‚\n             â–¼                                               â–¼\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚   repairs       â”‚     â”‚   complaints     â”‚     â”‚      asb        â”‚\n    â”‚  (200 docs)     â”‚     â”‚   (34 docs)      â”‚     â”‚   (12 docs)     â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                                                            â”‚\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚   financial     â”‚     â”‚   damp-mould     â”‚     â”‚   activities    â”‚\n    â”‚   (docs)        â”‚     â”‚   (docs)         â”‚     â”‚   (docs)        â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚   tasks         â”‚     â”‚  integrations    â”‚     â”‚    auditLog     â”‚\n    â”‚   (docs)        â”‚     â”‚   (20 docs)      â”‚     â”‚  (write-once)   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚  externalDataCache   â”‚     â”‚    imdData       â”‚\n    â”‚  (TTL-based cache)   â”‚     â”‚   (LSOA docs)    â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (16 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.11 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15 collections.\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          â€” Firebase token login\n    POST   /api/v1/auth/register       â€” User registration\n    POST   /api/v1/auth/logout         â€” Session invalidation\n\n    PROPERTIES (2)\n    GET    /api/v1/properties           â€” List with pagination/filter\n    GET    /api/v1/properties/:id       â€” Property detail\n\n    TENANTS (2)\n    GET    /api/v1/tenants              â€” List with pagination/filter\n    GET    /api/v1/tenants/:id          â€” Tenant detail\n\n    CASES (5)\n    GET    /api/v1/cases                â€” List with type/status filter\n    GET    /api/v1/cases/:id            â€” Case detail\n    POST   /api/v1/cases                â€” Create case\n    PUT    /api/v1/cases/:id            â€” Update case\n    DELETE /api/v1/cases/:id            â€” Close/archive case\n\n    CONVENIENCE ALIASES\n    GET    /api/v1/repairs              â€” All repairs (type=='repair')\n    GET    /api/v1/complaints           â€” All complaints (type=='complaint')\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance           â€” Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     â€” Type-specific data\n\n    EXPLORE (2+)\n    GET    /api/v1/explore/hierarchy    â€” Full drill-down hierarchy\n    GET    /api/v1/explore/estate/:id   â€” Estate detail with blocks\n\n    RENT (3)\n    GET    /api/v1/rent/arrears         â€” Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  â€” Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    â€” Transaction list\n\n    REPAIRS (2)\n    GET    /api/v1/repairs              â€” Repair list\n    GET    /api/v1/repairs/:id          â€” Repair detail\n\n    REPORTS (3)\n    GET    /api/v1/reports              â€” Report catalog (27 types)\n    GET    /api/v1/reports/:type        â€” Generate report data\n    GET    /api/v1/reports/tsm          â€” TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       â€” Void property list\n    GET    /api/v1/lettings/register    â€” Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      â€” Book a viewing\n    POST   /api/v1/booking/application  â€” Submit application\n\n    BRIEFING (2)\n    GET    /api/v1/briefing             â€” Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   â€” Estate-specific briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     â€” CSV export\n    GET    /api/v1/export/pdf/:type     â€” PDF export\n\n    AI INTELLIGENCE (14)\n    GET    /api/v1/ai/damp-risk/:propertyId            â€” Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       â€” Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           â€” Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        â€” Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            â€” Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 â€” Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId           â€” Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      â€” Property passport\n    GET    /api/v1/ai/briefing/:estateId                 â€” Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   â€” List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         â€” Templates by category\n    GET    /api/v1/ai/notify/template/:id                â€” Template detail\n    POST   /api/v1/ai/notify/render                      â€” Render template\n    POST   /api/v1/ai/chat                               â€” Yantra Assist chat\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     â€” DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       â€” IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        â€” GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       â€” NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   â€” Plentific\n    POST   /api/v1/ai/mock/regulatory                    â€” RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       â€” DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      â€” Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     â€” Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          â€” Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          â€” Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode       â€” Flood risk\n    GET    /api/v1/public-data/postcode/:postcode         â€” Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                  â€” EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            â€” Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode             â€” NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber         â€” Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo    â€” Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                    â€” List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         â€” Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           â€” Test connection\n    GET    /api/v1/admin/monitoring                       â€” Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              â€” Firebase client config (public)\n    GET    /health                     â€” Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend â†’ api-client.ts â†’ /api/v1/public-data/* â†’ external-api.ts â†’ External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer â†’ git push origin main\n                    â”‚\n                    â–¼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    â”‚\n                    â–¼\n    Cloud Build (auto-triggered)\n     â”œâ”€â”€ Step 1: Build React frontend (Vite)\n     â”œâ”€â”€ Step 2: Build Express backend (tsc)\n     â””â”€â”€ Step 3: Build & push Docker image\n                    â”‚\n                    â–¼\n    Artifact Registry (europe-west2)\n     â””â”€â”€ cloud-run-source-deploy/socialhomes:latest\n                    â”‚\n                    â–¼\n    Cloud Run (europe-west2)\n     â”œâ”€â”€ Min instances: 0\n     â”œâ”€â”€ Max instances: 10\n     â”œâ”€â”€ Memory: 1Gi\n     â”œâ”€â”€ CPU: 1\n     â”œâ”€â”€ Concurrency: 80\n     â”œâ”€â”€ Timeout: 300s\n     â”œâ”€â”€ Port: 8080\n     â””â”€â”€ Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) â€” node:20-slim base\n    Stage 2: Build server (tsc) â€” node:20-slim base\n    Stage 3: Production â€” copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 â€” SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-23\n================================================================================\n","numLines":886,"startLine":1,"totalLines":886}},"sourceToolAssistantUUID":"7fda5ba8-772e-4e59-983c-2045e1a0d1d4"}
{"parentUuid":"dca37a27-0239-4c9b-81bd-e87f707e7791","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ThRX5cnkDsVCr6aZ2R7k7U","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"deec85a2-9253-460c-845e-4a7e2750cc32","timestamp":"2026-02-24T10:42:22.929Z"}
{"parentUuid":"deec85a2-9253-460c-845e-4a7e2750cc32","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ThRX5cnkDsVCr6aZ2R7k7U","type":"tool_result","content":"     1â†’================================================================================\n     2â†’  Doc3 â€” SocialHomes.Ai API & Integration Requirements\n     3â†’  Version: 3.0  |  Date: 2026-02-23\n     4â†’  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5â†’================================================================================\n     6â†’\n     7â†’1. API OVERVIEW\n     8â†’================================================================================\n     9â†’\n    10â†’1.1 API Strategy\n    11â†’    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    12â†’    integrations. The React frontend communicates exclusively with the Express\n    13â†’    backend, which handles external calls, caching, rate limiting, and\n    14â†’    graceful degradation.\n    15â†’\n    16â†’1.2 Integration Tiers\n    17â†’\n    18â†’    TIER 1 â€” Free, No API Key Required\n    19â†’    Publicly available APIs with no registration needed.\n    20â†’    Status: LIVE with real data\n    21â†’\n    22â†’    TIER 2 â€” Free, Registration Required\n    23â†’    APIs requiring account creation or key registration.\n    24â†’    Status: LIVE with real data (where keys available) + simulated fallbacks\n    25â†’\n    26â†’    TIER 3 â€” Subscription/Paid APIs\n    27â†’    Commercial APIs requiring contracts or paid subscriptions.\n    28â†’    Status: MOCK endpoints with realistic simulated data\n    29â†’\n    30â†’1.3 Current Integration Count\n    31â†’    Total: 20 integrations\n    32â†’    - Tier 1: 3 live\n    33â†’    - Tier 2: 6 live (with simulated fallbacks)\n    34â†’    - Tier 3: 5 mock services + 6 planned\n    35â†’\n    36â†’\n    37â†’2. TIER 1 INTEGRATIONS (Free, No Key)\n    38â†’================================================================================\n    39â†’\n    40â†’2.1 Police.uk â€” Street-Level Crime Data\n    41â†’    Status: LIVE\n    42â†’    Base URL: https://data.police.uk/api\n    43â†’    Documentation: https://data.police.uk/docs/\n    44â†’\n    45â†’    Endpoints Used:\n    46â†’    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    47â†’    - GET /crimes-at-location?location_id={id}\n    48â†’    - GET /outcomes-at-location?location_id={id}\n    49â†’\n    50â†’    Server Route: GET /api/v1/public-data/police/:postcode\n    51â†’    Cache TTL: 24 hours\n    52â†’    Rate Limit: 15 req/sec (fair-use)\n    53â†’    Fallback: Simulated crime data matching postcode area\n    54â†’\n    55â†’    Used By:\n    56â†’    - D2: Live Crime Context for ASB (crime-context.ts)\n    57â†’    - Explore page crime data layer\n    58â†’    - ASB case correlation\n    59â†’    - Neighbourhood Briefing crime section\n    60â†’\n    61â†’    Data Returned:\n    62â†’    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    63â†’    - Month, location (lat/lng), outcome status\n    64â†’    - 12-month historical data per location\n    65â†’\n    66â†’2.2 Open-Meteo â€” Weather Forecasting\n    67â†’    Status: LIVE\n    68â†’    Base URL: https://api.open-meteo.com/v1\n    69â†’    Documentation: https://open-meteo.com/en/docs\n    70â†’\n    71â†’    Endpoints Used:\n    72â†’    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n    73â†’          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n    74â†’          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n    75â†’          &timezone=Europe/London\n    76â†’\n    77â†’    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    78â†’    Cache TTL: 1 hour\n    79â†’    Rate Limit: 10,000 req/day (no key needed)\n    80â†’    Fallback: Static weather for London SE\n    81â†’\n    82â†’    Used By:\n    83â†’    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    84â†’    - AI Morning Briefing (weather section)\n    85â†’    - Neighbourhood Briefing (environmental context)\n    86â†’    - Property impact assessment\n    87â†’\n    88â†’    Data Returned:\n    89â†’    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    90â†’    - Daily: max/min temperature, precipitation sum\n    91â†’    - 7-day forecast + current conditions\n    92â†’\n    93â†’2.3 DEFRA Flood Risk API\n    94â†’    Status: LIVE\n    95â†’    Base URL: https://environment.data.gov.uk/flood-monitoring\n    96â†’    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n    97â†’\n    98â†’    Endpoints Used:\n    99â†’    - GET /id/floods?lat={lat}&long={lng}&dist=3\n   100â†’    - GET /id/stations?lat={lat}&long={lng}&dist=3\n   101â†’\n   102â†’    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n   103â†’    Cache TTL: 1 hour\n   104â†’    Rate Limit: No formal limit\n   105â†’    Fallback: \"No active warnings\" with zone classification\n   106â†’\n   107â†’    Used By:\n   108â†’    - Property Passport (flood risk section)\n   109â†’    - Neighbourhood Briefing (environmental alerts)\n   110â†’    - Property detail page (risk indicators)\n   111â†’\n   112â†’    Data Returned:\n   113â†’    - Active flood warnings/alerts\n   114â†’    - Flood risk zone classification\n   115â†’    - Nearest monitoring station readings\n   116â†’\n   117â†’\n   118â†’3. TIER 2 INTEGRATIONS (Registration Required)\n   119â†’================================================================================\n   120â†’\n   121â†’3.1 Postcodes.io â€” Postcode Lookup\n   122â†’    Status: LIVE\n   123â†’    Base URL: https://api.postcodes.io\n   124â†’    Documentation: https://postcodes.io/docs\n   125â†’    Registration: None (open API)\n   126â†’\n   127â†’    Endpoints Used:\n   128â†’    - GET /postcodes/{postcode}\n   129â†’    - GET /postcodes/{postcode}/nearest\n   130â†’    - POST /postcodes (bulk lookup)\n   131â†’\n   132â†’    Server Route: GET /api/v1/public-data/postcode/:postcode\n   133â†’    Cache TTL: 7 days\n   134â†’    Rate Limit: Generous (no formal limit)\n   135â†’    Fallback: Static mapping for SE London postcodes\n   136â†’\n   137â†’    Data Returned:\n   138â†’    - Latitude, longitude\n   139â†’    - LSOA code and name (for IMD/Census/NOMIS)\n   140â†’    - Ward, parliamentary constituency\n   141â†’    - Local authority, region\n   142â†’\n   143â†’    Used By:\n   144â†’    - All location-dependent lookups\n   145â†’    - LSOA resolution for Census/NOMIS/IMD\n   146â†’    - Property geocoding\n   147â†’\n   148â†’3.2 EPC Open Data\n   149â†’    Status: LIVE (with simulated fallback)\n   150â†’    Base URL: https://epc.opendatacommunities.org/api/v1\n   151â†’    Documentation: https://epc.opendatacommunities.org/docs/api\n   152â†’    Registration: API key via MHCLG portal\n   153â†’\n   154â†’    Endpoints Used:\n   155â†’    - GET /domestic/search?uprn={uprn}\n   156â†’    - GET /domestic/certificate/{lmk-key}\n   157â†’\n   158â†’    Server Route: GET /api/v1/public-data/epc/:uprn\n   159â†’    Cache TTL: 30 days\n   160â†’    Rate Limit: 1,000 req/month (free tier)\n   161â†’    Fallback: Generated EPC data matching property attributes\n   162â†’\n   163â†’    Data Returned:\n   164â†’    - Current energy rating (Aâ€“G) and score\n   165â†’    - Potential rating\n   166â†’    - Environmental impact rating\n   167â†’    - Floor area, wall/roof type\n   168â†’    - Heating type, hot water system\n   169â†’    - Recommendations for improvement\n   170â†’    - Certificate expiry date\n   171â†’\n   172â†’    Used By:\n   173â†’    - Property Passport (energy section)\n   174â†’    - Compliance page (EPC tracking)\n   175â†’    - Property detail page\n   176â†’    - D1: Damp prediction (building factor input)\n   177â†’\n   178â†’3.3 Census 2021 (ONS via NOMIS)\n   179â†’    Status: LIVE (with simulated fallback)\n   180â†’    Base URL: https://www.nomisweb.co.uk/api/v01\n   181â†’    Documentation: https://www.nomisweb.co.uk/api/v01/help\n   182â†’\n   183â†’    Datasets Used:\n   184â†’    - NM_2072_1 â€” Population by age/sex (Census 2021)\n   185â†’    - NM_2021_1 â€” Accommodation type (Census 2021)\n   186â†’\n   187â†’    Server Route: GET /api/v1/public-data/census/:lsoaCode\n   188â†’    Cache TTL: 90 days\n   189â†’    Rate Limit: 100,000 req/month\n   190â†’    Fallback: Simulated demographics for Southwark LSOA areas\n   191â†’\n   192â†’    Data Returned:\n   193â†’    - Population count and density\n   194â†’    - Age distribution (0â€“15, 16â€“64, 65+)\n   195â†’    - Household composition\n   196â†’    - Accommodation type breakdown\n   197â†’    - Ethnicity distribution\n   198â†’\n   199â†’    Used By:\n   200â†’    - Neighbourhood Briefing (demographics section)\n   201â†’    - Property Passport (area context)\n   202â†’    - D3: Vulnerability Detection (deprivation context)\n   203â†’\n   204â†’3.4 NOMIS â€” Labour Market Statistics\n   205â†’    Status: LIVE (with simulated fallback)\n   206â†’    Base URL: https://www.nomisweb.co.uk/api/v01\n   207â†’\n   208â†’    Datasets Used:\n   209â†’    - NM_162_1 â€” JSA claimant count by age/sex\n   210â†’    - NM_17_5  â€” Annual Population Survey (employment/unemployment)\n   211â†’\n   212â†’    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n   213â†’    Cache TTL: 30 days\n   214â†’    Rate Limit: 100,000 req/month\n   215â†’    Fallback: Simulated labour market data for SE London\n   216â†’\n   217â†’    Data Returned:\n   218â†’    - Employment rate, unemployment rate\n   219â†’    - Economic activity breakdown\n   220â†’    - Claimant count (JSA/UC)\n   221â†’    - Occupation types\n   222â†’    - Qualification levels\n   223â†’\n   224â†’    Used By:\n   225â†’    - D5: Benefits Entitlement Engine (employment context)\n   226â†’    - Neighbourhood Briefing (economic section)\n   227â†’    - D3: Vulnerability Detection (economic deprivation factor)\n   228â†’\n   229â†’3.5 Gas Safe Register\n   230â†’    Status: LIVE (with simulated fallback)\n   231â†’    Base URL: https://www.gassaferegister.co.uk/api\n   232â†’    Documentation: Restricted (via partnership application)\n   233â†’\n   234â†’    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n   235â†’    Cache TTL: 24 hours\n   236â†’    Rate Limit: 100 req/hour\n   237â†’    Fallback: Simulated verification with valid/expired/suspended status\n   238â†’\n   239â†’    Data Returned:\n   240â†’    - Engineer name and company\n   241â†’    - Registration status (valid/expired/suspended)\n   242â†’    - Qualifications (boiler, cooker, fire, etc.)\n   243â†’    - Registration number and expiry date\n   244â†’\n   245â†’    Used By:\n   246â†’    - Repair detail page (contractor verification badge â€” green)\n   247â†’    - Compliance management (contractor vetting)\n   248â†’\n   249â†’3.6 Electrical Safety Register (NICEIC)\n   250â†’    Status: LIVE (with simulated fallback)\n   251â†’    Base URL: https://www.niceic.com/api\n   252â†’    Documentation: Via partnership application\n   253â†’\n   254â†’    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n   255â†’    Cache TTL: 24 hours\n   256â†’    Rate Limit: 100 req/hour\n   257â†’    Fallback: Simulated verification with valid/expired/suspended status\n   258â†’\n   259â†’    Data Returned:\n   260â†’    - Contractor name and company\n   261â†’    - Registration status (valid/expired/suspended)\n   262â†’    - Scheme (NICEIC Approved Contractor / Competent Person)\n   263â†’    - Registration number and expiry date\n   264â†’\n   265â†’    Used By:\n   266â†’    - Repair detail page (contractor verification badge â€” blue)\n   267â†’    - Compliance management (electrical contractor vetting)\n   268â†’\n   269â†’\n   270â†’4. TIER 3 INTEGRATIONS (Mock/Subscription)\n   271â†’================================================================================\n   272â†’\n   273â†’4.1 DWP Universal Credit Verification\n   274â†’    Status: MOCK\n   275â†’    Mock Function: mockUcVerification(tenantId)\n   276â†’    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n   277â†’\n   278â†’    Mock Response:\n   279â†’    - UC claim status (active/pending/none)\n   280â†’    - Housing element amount\n   281â†’    - Payment frequency and next payment date\n   282â†’    - Managed payment status (direct to landlord)\n   283â†’    - Alternative Payment Arrangement (APA) eligibility\n   284â†’\n   285â†’    Used By:\n   286â†’    - D5: Benefits Entitlement Engine\n   287â†’    - Rent management (UC tracking)\n   288â†’    - Arrears prevention (early warning)\n   289â†’\n   290â†’4.2 IoT Sensor Integration (Switchee/Aico)\n   291â†’    Status: MOCK\n   292â†’    Mock Function: mockIotSensors(propertyId)\n   293â†’    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   294â†’\n   295â†’    Mock Response:\n   296â†’    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n   297â†’    - Humidity readings (per room)\n   298â†’    - CO2 levels\n   299â†’    - Smoke/CO detector status (OK/alert/battery-low)\n   300â†’    - Heating system status (on/off/hours today)\n   301â†’    - Alerts (high humidity, low temperature, CO detected)\n   302â†’\n   303â†’    Used By:\n   304â†’    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n   305â†’    - Property detail page (live sensor data)\n   306â†’    - Compliance monitoring (smoke/CO detector status)\n   307â†’\n   308â†’4.3 GoCardless â€” Direct Debit\n   309â†’    Status: MOCK\n   310â†’    Mock Function: mockDirectDebit(tenantId)\n   311â†’    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n   312â†’\n   313â†’    Mock Response:\n   314â†’    - Mandate status (active/pending/cancelled)\n   315â†’    - Bank details (last 4 digits only)\n   316â†’    - Next collection date and amount\n   317â†’    - Payment history (last 12 months)\n   318â†’    - Failed payment reasons\n   319â†’\n   320â†’    Used By:\n   321â†’    - Rent management (payment processing)\n   322â†’    - Arrears management (DD failure tracking)\n   323â†’    - Tenant detail (payment method)\n   324â†’\n   325â†’4.4 Plentific/Fixflo â€” Repairs Marketplace\n   326â†’    Status: MOCK\n   327â†’    Mock Function: mockRepairsMarketplace(caseId)\n   328â†’    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n   329â†’\n   330â†’    Mock Response:\n   331â†’    - Contractor quotes (3 quotes with price/availability)\n   332â†’    - Dispatch confirmation\n   333â†’    - Appointment scheduling\n   334â†’    - Job completion notification\n   335â†’    - Satisfaction survey trigger\n   336â†’\n   337â†’    Used By:\n   338â†’    - Repairs management (contractor dispatch)\n   339â†’    - Cost management (competitive quotes)\n   340â†’\n   341â†’4.5 DocuSign â€” Digital Signing\n   342â†’    Status: MOCK\n   343â†’    Mock Function: mockSigningEnvelope(documentType, tenantId)\n   344â†’    Server Route: POST /api/v1/ai/mock/signing\n   345â†’\n   346â†’    Mock Response:\n   347â†’    - Envelope ID and status (sent/delivered/signed/declined)\n   348â†’    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n   349â†’    - Recipients with signing status\n   350â†’    - Completion date\n   351â†’    - Signed document URL\n   352â†’\n   353â†’    Used By:\n   354â†’    - Tenancy sign-up workflow\n   355â†’    - Compliance certificate signing\n   356â†’    - Legal document execution\n   357â†’\n   358â†’4.6 Experian/TransUnion â€” Tenant Referencing\n   359â†’    Status: MOCK\n   360â†’    Mock Function: mockReferencingResult(applicantId)\n   361â†’    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n   362â†’\n   363â†’    Mock Response:\n   364â†’    - Credit score (300â€“850)\n   365â†’    - Affordability assessment (pass/refer/fail)\n   366â†’    - CCJ count and value\n   367â†’    - Previous addresses (last 3 years)\n   368â†’    - Employment verification\n   369â†’    - Recommendation (accept/refer/decline)\n   370â†’\n   371â†’    Used By:\n   372â†’    - Allocations (applicant vetting)\n   373â†’    - Lettings workflow (pre-tenancy checks)\n   374â†’\n   375â†’4.7 Land Registry â€” Title Data\n   376â†’    Status: MOCK\n   377â†’    Mock Function: mockLandRegistryTitle(propertyId)\n   378â†’    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n   379â†’\n   380â†’    Mock Response:\n   381â†’    - Title number\n   382â†’    - Tenure type (freehold/leasehold)\n   383â†’    - Price paid and date\n   384â†’    - Registered owner\n   385â†’    - Lease details (start, term, ground rent)\n   386â†’    - Restrictions and charges\n   387â†’\n   388â†’    Used By:\n   389â†’    - Property Passport (ownership section)\n   390â†’    - Property detail page\n   391â†’\n   392â†’4.8 RSH/CORE/Ombudsman â€” Regulatory Submissions\n   393â†’    Status: MOCK\n   394â†’    Mock Function: mockRegulatorySubmission(type, refId)\n   395â†’    Server Route: POST /api/v1/ai/mock/regulatory\n   396â†’\n   397â†’    Submission Types:\n   398â†’    - IDA (Individual Data Return)\n   399â†’    - CORE lettings\n   400â†’    - CORE sales\n   401â†’    - Ombudsman escalation\n   402â†’    - Compliance score return\n   403â†’\n   404â†’    Used By:\n   405â†’    - Reports module (regulatory submissions)\n   406â†’    - Compliance management\n   407â†’\n   408â†’4.9 NOMIS Labour Market (Extended)\n   409â†’    Status: MOCK\n   410â†’    Mock Function: mockLabourMarket(lsoaCode)\n   411â†’    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n   412â†’\n   413â†’    Used By:\n   414â†’    - Neighbourhood Briefing (economic context)\n   415â†’    - Benefits Engine (employment verification)\n   416â†’\n   417â†’\n   418â†’5. SEVEN KILLER DIFFERENTIATOR SERVICES\n   419â†’================================================================================\n   420â†’\n   421â†’5.1 D1: Predictive Damp Intelligence\n   422â†’    Service: server/src/services/damp-prediction.ts\n   423â†’    API Route: GET /api/v1/ai/damp-risk/:propertyId\n   424â†’\n   425â†’    Algorithm: 5-Factor Weighted Score (0â€“100)\n   426â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   427â†’    â”‚ Factor              â”‚ Weight â”‚ Data Sources                   â”‚\n   428â†’    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n   429â†’    â”‚ Weather conditions  â”‚  0.25  â”‚ Open-Meteo (humidity, rain)    â”‚\n   430â†’    â”‚ Building attributes â”‚  0.25  â”‚ Property data (age, type, EPC) â”‚\n   431â†’    â”‚ Repair history      â”‚  0.20  â”‚ Case data (damp/mould reports) â”‚\n   432â†’    â”‚ IoT sensors         â”‚  0.20  â”‚ Switchee/Aico (temp, humidity) â”‚\n   433â†’    â”‚ Occupancy patterns  â”‚  0.10  â”‚ Tenant data (household size)   â”‚\n   434â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   435â†’\n   436â†’    Output:\n   437â†’    - Overall risk score (0â€“100)\n   438â†’    - Risk level: low (0â€“25), moderate (26â€“50), high (51â€“75), critical (76â€“100)\n   439â†’    - Factor breakdown with individual scores\n   440â†’    - Proactive recommendations\n   441â†’    - Awaab's Law compliance status\n   442â†’\n   443â†’5.2 D2: Live Crime Context for ASB\n   444â†’    Service: server/src/services/crime-context.ts\n   445â†’    API Route: GET /api/v1/ai/crime-context/:estateId\n   446â†’\n   447â†’    Algorithm:\n   448â†’    - Fetch Police.uk data for estate location (12-month window)\n   449â†’    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n   450â†’    - Correlate with internal ASB cases\n   451â†’    - Identify hotspots and trends\n   452â†’    - Generate estate safety score\n   453â†’\n   454â†’    Output:\n   455â†’    - Crime summary by category (last 12 months)\n   456â†’    - Monthly trend (rising/stable/declining)\n   457â†’    - Hotspot locations within estate\n   458â†’    - Correlation with internal ASB cases\n   459â†’    - Recommended patrol priorities\n   460â†’\n   461â†’5.3 D3: Automatic Vulnerability Detection\n   462â†’    Service: server/src/services/vulnerability-detection.ts\n   463â†’    API Route: GET /api/v1/ai/vulnerability/:tenantId\n   464â†’\n   465â†’    Algorithm: 7-Factor Weighted Score (0â€“100)\n   466â†’    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n   467â†’    â”‚ Factor                   â”‚ Weight â”‚ Data Sources             â”‚\n   468â†’    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n   469â†’    â”‚ IMD deprivation          â”‚  0.20  â”‚ IMD data (decile)        â”‚\n   470â†’    â”‚ Arrears history          â”‚  0.20  â”‚ Rent account (balance)   â”‚\n   471â†’    â”‚ Health flags             â”‚  0.15  â”‚ Tenant vulnerability     â”‚\n   472â†’    â”‚ Social isolation         â”‚  0.15  â”‚ Household composition    â”‚\n   473â†’    â”‚ Age risk (elderly/young) â”‚  0.10  â”‚ Tenant DOB              â”‚\n   474â†’    â”‚ Dependents               â”‚  0.10  â”‚ Household members        â”‚\n   475â†’    â”‚ UC transition            â”‚  0.10  â”‚ UC status                â”‚\n   476â†’    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n   477â†’\n   478â†’    Output:\n   479â†’    - Vulnerability score (0â€“100)\n   480â†’    - Risk level: low / moderate / high / critical\n   481â†’    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n   482â†’    - Recommended support actions\n   483â†’    - Referral suggestions (social services, CAB, food bank)\n   484â†’\n   485â†’5.4 D4: Property Passport\n   486â†’    Service: server/src/services/property-passport.ts\n   487â†’    API Route: GET /api/v1/ai/property-passport/:propertyId\n   488â†’\n   489â†’    Aggregation Sources:\n   490â†’    - Property data (Firestore)\n   491â†’    - EPC certificate (Tier 2 API)\n   492â†’    - Compliance certificates (Firestore)\n   493â†’    - Repair history (Firestore cases)\n   494â†’    - Damp risk score (D1 service)\n   495â†’    - Flood risk (DEFRA API)\n   496â†’    - Crime context (D2 service)\n   497â†’    - Census demographics (NOMIS API)\n   498â†’    - Land Registry title (mock)\n   499â†’\n   500â†’    Output:\n   501â†’    - Comprehensive property dossier\n   502â†’    - Current condition assessment\n   503â†’    - Compliance status summary\n   504â†’    - Energy efficiency profile\n   505â†’    - Neighbourhood context\n   506â†’    - Investment recommendations\n   507â†’\n   508â†’5.5 D5: Benefits Entitlement Engine\n   509â†’    Service: server/src/services/benefits-engine.ts\n   510â†’    API Route: GET /api/v1/ai/benefits-check/:tenantId\n   511â†’\n   512â†’    Rules Engine (UK 2025/26):\n   513â†’    - Universal Credit (standard allowance, housing element, child element)\n   514â†’    - Personal Independence Payment (PIP)\n   515â†’    - Attendance Allowance\n   516â†’    - Pension Credit (guarantee, savings)\n   517â†’    - Council Tax Reduction\n   518â†’    - Discretionary Housing Payment\n   519â†’    - Warm Home Discount\n   520â†’    - Free school meals\n   521â†’\n   522â†’    Input:\n   523â†’    - Tenant age, household composition\n   524â†’    - Employment status, income\n   525â†’    - Disability/health conditions\n   526â†’    - Current benefit claims\n   527â†’\n   528â†’    Output:\n   529â†’    - List of potential entitlements\n   530â†’    - Estimated weekly/monthly amounts\n   531â†’    - Claim status (claimed/unclaimed/check-eligibility)\n   532â†’    - Total unclaimed benefits estimate\n   533â†’    - Next steps for each entitlement\n   534â†’\n   535â†’5.6 D6: AI Neighbourhood Briefing\n   536â†’    Service: server/src/services/neighbourhood-briefing.ts\n   537â†’    API Route: GET /api/v1/ai/briefing/:estateId\n   538â†’\n   539â†’    Data Sources Combined:\n   540â†’    - Weather forecast (Open-Meteo)\n   541â†’    - Crime data (Police.uk)\n   542â†’    - Active cases (Firestore)\n   543â†’    - Compliance status (Firestore)\n   544â†’    - Census demographics (NOMIS)\n   545â†’    - Damp risk aggregation (D1)\n   546â†’    - ASB incidents (Firestore + Police)\n   547â†’\n   548â†’    Output:\n   549â†’    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n   550â†’    - Officer briefing text (AI-generated narrative)\n   551â†’    - Action items prioritized by urgency\n   552â†’    - Trend comparisons (this week vs last)\n   553â†’\n   554â†’5.7 D7: IoT Sensor Integration\n   555â†’    Service: server/src/services/mock-services.ts\n   556â†’    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   557â†’\n   558â†’    Supported Devices:\n   559â†’    - Switchee smart thermostat (temperature, humidity, heating usage)\n   560â†’    - Aico smoke/CO detectors (status, battery, alerts)\n   561â†’    - Third-party humidity sensors\n   562â†’\n   563â†’    Status: MOCK (ready for real Switchee/Aico API integration)\n   564â†’\n   565â†’\n   566â†’6. GOV.UK NOTIFY INTEGRATION\n   567â†’================================================================================\n   568â†’\n   569â†’6.1 Overview\n   570â†’    Service: server/src/services/govuk-notify.ts (1,257 lines)\n   571â†’    Status: Template library defined (24 templates)\n   572â†’    Integration: Ready for GOV.UK Notify API key\n   573â†’\n   574â†’6.2 Template Categories (7)\n   575â†’\n   576â†’    CATEGORY 1: Rent Arrears (4 templates)\n   577â†’    - arrears-mild: Friendly reminder (1â€“2 weeks behind)\n   578â†’    - arrears-moderate: Formal notice (3â€“4 weeks)\n   579â†’    - arrears-severe: Pre-action warning (5+ weeks)\n   580â†’    - arrears-arrangement: Payment plan confirmation\n   581â†’\n   582â†’    CATEGORY 2: Repairs (4 templates)\n   583â†’    - repair-acknowledged: Repair reported acknowledgement\n   584â†’    - repair-appointment: Appointment booking confirmation\n   585â†’    - repair-completed: Completion notification + satisfaction link\n   586â†’    - repair-follow-up: Post-repair follow-up\n   587â†’\n   588â†’    CATEGORY 3: ASB (3 templates)\n   589â†’    - asb-reported: ASB report acknowledgement\n   590â†’    - asb-warning: Warning letter to perpetrator\n   591â†’    - asb-update: Case update to victim/reporter\n   592â†’\n   593â†’    CATEGORY 4: Compliance (3 templates)\n   594â†’    - compliance-access: Access request for inspection\n   595â†’    - compliance-reminder: Appointment reminder\n   596â†’    - compliance-certificate: Certificate available notification\n   597â†’\n   598â†’    CATEGORY 5: Tenancy (4 templates)\n   599â†’    - tenancy-welcome: New tenant welcome pack\n   600â†’    - tenancy-renewal: Renewal offer\n   601â†’    - tenancy-end: End of tenancy notification\n   602â†’    - tenancy-annual-visit: Annual visit scheduling\n   603â†’\n   604â†’    CATEGORY 6: Damp & Mould (3 templates)\n   605â†’    - damp-report-ack: Report acknowledged\n   606â†’    - damp-inspection: Inspection scheduled\n   607â†’    - damp-works: Works ordered notification (Awaab's Law timeline)\n   608â†’\n   609â†’    CATEGORY 7: General (3 templates)\n   610â†’    - general-update: Generic case update\n   611â†’    - general-survey: Satisfaction survey invitation\n   612â†’    - general-information: Information request\n   613â†’\n   614â†’6.3 Template Rendering\n   615â†’    - Personalisation fields use ((field)) syntax\n   616â†’    - Rendered server-side via /api/v1/ai/notify/render\n   617â†’    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n   618â†’      ((amount)), ((date)), ((officer_name)), etc.\n   619â†’\n   620â†’6.4 API Endpoints\n   621â†’    GET  /api/v1/ai/notify/templates           â€” List all 24 templates\n   622â†’    GET  /api/v1/ai/notify/templates/:category  â€” Filter by category\n   623â†’    GET  /api/v1/ai/notify/template/:id         â€” Single template detail\n   624â†’    POST /api/v1/ai/notify/render               â€” Render with personalisation\n   625â†’\n   626â†’\n   627â†’7. CACHING ARCHITECTURE\n   628â†’================================================================================\n   629â†’\n   630â†’7.1 Cache Collection: externalDataCache\n   631â†’    Stored in Firestore with TTL-based expiration.\n   632â†’    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n   633â†’\n   634â†’7.2 Cache-Through Pattern\n   635â†’    1. Check Firestore cache for key\n   636â†’    2. If found AND not expired â†’ return cached data\n   637â†’    3. If missing OR expired â†’ fetch from external API\n   638â†’    4. Store result in cache with TTL\n   639â†’    5. Return data to caller\n   640â†’\n   641â†’7.3 TTL Configuration\n   642â†’\n   643â†’    | Source              | TTL       | Key Format                 |\n   644â†’    |---------------------|-----------|----------------------------|\n   645â†’    | police              | 24 hours  | police:{postcode}          |\n   646â†’    | weather             | 1 hour    | weather:{lat},{lng}        |\n   647â†’    | flood-risk          | 1 hour    | flood:{postcode}           |\n   648â†’    | postcode            | 7 days    | postcode:{postcode}        |\n   649â†’    | epc                 | 30 days   | epc:{uprn}                 |\n   650â†’    | census              | 90 days   | census:{lsoaCode}          |\n   651â†’    | nomis               | 30 days   | nomis:{lsoaCode}           |\n   652â†’    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n   653â†’    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n   654â†’    | imd                 | 90 days   | imd:{lsoaCode}             |\n   655â†’\n   656â†’7.4 Cache Management\n   657â†’    - Automatic TTL enforcement on read\n   658â†’    - Manual cache invalidation via admin API\n   659â†’    - Cache hit rate tracked in metrics\n   660â†’    - No cache warming (fetch-on-demand only â€” warming planned Phase 5)\n   661â†’\n   662â†’\n   663â†’8. RATE LIMITING\n   664â†’================================================================================\n   665â†’\n   666â†’8.1 Internal Rate Limits (per client IP)\n   667â†’\n   668â†’    | Tier    | Routes              | Limit        | Window  |\n   669â†’    |---------|---------------------|--------------|---------|\n   670â†’    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   671â†’    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   672â†’    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   673â†’    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   674â†’\n   675â†’8.2 External API Rate Limits\n   676â†’    Token bucket pattern per API source.\n   677â†’    Global fair-use: 15 req/sec across all external APIs.\n   678â†’\n   679â†’    | API               | Limit             | Enforced By       |\n   680â†’    |-------------------|-------------------|-------------------|\n   681â†’    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n   682â†’    | Open-Meteo        | 10,000 req/day    | No key needed     |\n   683â†’    | DEFRA             | No formal limit   | Fair-use          |\n   684â†’    | Postcodes.io      | No formal limit   | Fair-use          |\n   685â†’    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n   686â†’    | NOMIS             | 100,000 req/month | Fair-use          |\n   687â†’    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n   688â†’    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n   689â†’\n   690â†’\n   691â†’9. ERROR HANDLING & GRACEFUL DEGRADATION\n   692â†’================================================================================\n   693â†’\n   694â†’9.1 External API Error Handling\n   695â†’    - Timeout: 10 seconds per external request\n   696â†’    - Retry: 1 retry with exponential backoff (2s)\n   697â†’    - On failure: Return simulated fallback data\n   698â†’    - Flag: Response includes { source: 'live' | 'simulated' }\n   699â†’\n   700â†’9.2 Simulated Fallback Strategy\n   701â†’    Every external API has a corresponding simulated data generator.\n   702â†’    Simulated data is:\n   703â†’    - Realistic for the requested entity/location\n   704â†’    - Consistent across requests (deterministic seeding)\n   705â†’    - Flagged clearly in the response\n   706â†’\n   707â†’9.3 Circuit Breaker Pattern (Planned â€” Phase 5)\n   708â†’    - Track failure count per API source\n   709â†’    - Open circuit after 5 consecutive failures\n   710â†’    - Half-open after 60 seconds (single test request)\n   711â†’    - Close circuit on successful test\n   712â†’    Status: Designed, not yet implemented (task 5.2.5)\n   713â†’\n   714â†’\n   715â†’10. API SECURITY\n   716â†’================================================================================\n   717â†’\n   718â†’10.1 Authentication\n   719â†’    All /api/v1/* routes require Firebase Bearer token.\n   720â†’    Exception: /health (public health check), /api/v1/config (public)\n   721â†’\n   722â†’10.2 Request Validation\n   723â†’    - JSON body limit: 1MB\n   724â†’    - Content-Type: application/json enforced\n   725â†’    - Query parameter sanitization\n   726â†’    - Path parameter validation\n   727â†’\n   728â†’10.3 Response Security\n   729â†’    - No sensitive data in error responses (production)\n   730â†’    - CORS restricted to allowed origins\n   731â†’    - Request ID correlation (X-Request-ID)\n   732â†’    - Security headers on all responses\n   733â†’\n   734â†’10.4 API Key Management\n   735â†’    - No API keys in source code\n   736â†’    - All keys in Google Secret Manager\n   737â†’    - Environment variable injection at runtime\n   738â†’    - Key rotation support via Secret Manager versioning\n   739â†’\n   740â†’\n   741â†’11. FUTURE INTEGRATION ROADMAP\n   742â†’================================================================================\n   743â†’\n   744â†’11.1 Phase 5 â€” Real-Time & Advanced (Planned)\n   745â†’\n   746â†’    | Integration           | Priority | Complexity | Description                     |\n   747â†’    |-----------------------|----------|------------|---------------------------------|\n   748â†’    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n   749â†’    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n   750â†’    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n   751â†’    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n   752â†’    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n   753â†’    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n   754â†’    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n   755â†’    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n   756â†’    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n   757â†’    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n   758â†’\n   759â†’11.2 Phase 6 â€” Enterprise Integrations (Future)\n   760â†’\n   761â†’    | Integration           | Priority | Complexity | Description                     |\n   762â†’    |-----------------------|----------|------------|---------------------------------|\n   763â†’    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n   764â†’    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n   765â†’    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n   766â†’    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n   767â†’    | NHS Digital           | P3       | H          | Health data integration          |\n   768â†’    | Companies House       | P3       | S          | Contractor verification          |\n   769â†’    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n   770â†’\n   771â†’\n   772â†’================================================================================\n   773â†’  End of Doc3 â€” SocialHomes.Ai API & Integration Requirements\n   774â†’  Yantra Works | 2026-02-23\n   775â†’================================================================================\n   776â†’"}]},"uuid":"01eb3c43-9f01-448d-8357-b1b9dfe078e2","timestamp":"2026-02-24T10:42:23.158Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 â€” SocialHomes.Ai API & Integration Requirements\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 â€” Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 â€” Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 â€” Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk â€” Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo â€” Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io â€” Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (Aâ€“G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 â€” Population by age/sex (Census 2021)\n    - NM_2021_1 â€” Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0â€“15, 16â€“64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS â€” Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 â€” JSA claimant count by age/sex\n    - NM_17_5  â€” Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge â€” green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge â€” blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless â€” Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo â€” Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign â€” Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion â€” Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300â€“850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry â€” Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman â€” Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0â€“100)\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Factor              â”‚ Weight â”‚ Data Sources                   â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ Weather conditions  â”‚  0.25  â”‚ Open-Meteo (humidity, rain)    â”‚\n    â”‚ Building attributes â”‚  0.25  â”‚ Property data (age, type, EPC) â”‚\n    â”‚ Repair history      â”‚  0.20  â”‚ Case data (damp/mould reports) â”‚\n    â”‚ IoT sensors         â”‚  0.20  â”‚ Switchee/Aico (temp, humidity) â”‚\n    â”‚ Occupancy patterns  â”‚  0.10  â”‚ Tenant data (household size)   â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Output:\n    - Overall risk score (0â€“100)\n    - Risk level: low (0â€“25), moderate (26â€“50), high (51â€“75), critical (76â€“100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0â€“100)\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚ Factor                   â”‚ Weight â”‚ Data Sources             â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ IMD deprivation          â”‚  0.20  â”‚ IMD data (decile)        â”‚\n    â”‚ Arrears history          â”‚  0.20  â”‚ Rent account (balance)   â”‚\n    â”‚ Health flags             â”‚  0.15  â”‚ Tenant vulnerability     â”‚\n    â”‚ Social isolation         â”‚  0.15  â”‚ Household composition    â”‚\n    â”‚ Age risk (elderly/young) â”‚  0.10  â”‚ Tenant DOB              â”‚\n    â”‚ Dependents               â”‚  0.10  â”‚ Household members        â”‚\n    â”‚ UC transition            â”‚  0.10  â”‚ UC status                â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Output:\n    - Vulnerability score (0â€“100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1â€“2 weeks behind)\n    - arrears-moderate: Formal notice (3â€“4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           â€” List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  â€” Filter by category\n    GET  /api/v1/ai/notify/template/:id         â€” Single template detail\n    POST /api/v1/ai/notify/render               â€” Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired â†’ return cached data\n    3. If missing OR expired â†’ fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only â€” warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned â€” Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 â€” Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 â€” Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 â€” SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-23\n================================================================================\n","numLines":776,"startLine":1,"totalLines":776}},"sourceToolAssistantUUID":"deec85a2-9253-460c-845e-4a7e2750cc32"}
{"parentUuid":"01eb3c43-9f01-448d-8357-b1b9dfe078e2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014uTXjpa4fyKhEMkQRhaqEY","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"691ee0f8-9b4a-496c-af6a-4e55ab6eb340","timestamp":"2026-02-24T10:42:23.377Z"}
{"parentUuid":"691ee0f8-9b4a-496c-af6a-4e55ab6eb340","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014uTXjpa4fyKhEMkQRhaqEY","type":"tool_result","content":"     1â†’# SocialHomes.Ai â€” Master Execution Plan\n     2â†’\n     3â†’> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n     4â†’> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n     5â†’> Studio: Yantra Works\n     6â†’\n     7â†’---\n     8â†’\n     9â†’## PLAN SUMMARY\n    10â†’\n    11â†’| Phase | Name | Sprints | Status | Progress |\n    12â†’|-------|------|---------|--------|----------|\n    13â†’| 0 | Infrastructure | â€” | âœ… DONE | 10/10 |\n    14â†’| 1 | Foundation | 1â€“2 | âœ… DONE | 12/12 |\n    15â†’| 2 | Intelligence | 3â€“4 | âœ… DONE | 14/14 |\n    16â†’| 3 | Enrichment | 5â€“6 | âœ… DONE | 14/17 (3 deferred) |\n    17â†’| 4 | Completion | 7â€“8 | âœ… DONE | 11/14 (3 deferred) |\n    18â†’| **5** | **Evolution** | **9â€“12** | **ðŸ”µ TODO** | **0/38** |\n    19â†’\n    20â†’---\n    21â†’\n    22â†’## PHASE 0: INFRASTRUCTURE â€” âœ… DONE (10/10)\n    23â†’\n    24â†’| # | Task | Status | Agent |\n    25â†’|---|------|--------|-------|\n    26â†’| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    27â†’| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    28â†’| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    29â†’| 0.4 | Build and deploy via git push â†’ Cloud Build | DONE | Claude Code |\n    30â†’| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    31â†’| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    32â†’| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    33â†’| 0.8 | UI/UX Audit â†’ Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    34â†’| 0.9 | BA Requirements â†’ Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    35â†’| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    36â†’\n    37â†’---\n    38â†’\n    39â†’## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) â€” âœ… DONE (12/12)\n    40â†’\n    41â†’### Goal: Core external API infrastructure + free API integrations\n    42â†’\n    43â†’| # | Task | Priority | Complexity | Agent | Status |\n    44â†’|---|------|----------|------------|-------|--------|\n    45â†’| 1.1 | Create `server/src/services/external-api.ts` â€” shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n    46â†’| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n    47â†’| 1.3 | Integrate postcodes.io â€” postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n    48â†’| 1.4 | Integrate Open UPRN (uprn.uk) â€” UPRN lookup | P1 | S | Fullstack | DONE |\n    49â†’| 1.5 | Integrate data.police.uk â€” street-level crime, ASB data | P1 | M | Fullstack | DONE |\n    50â†’| 1.6 | Integrate Open-Meteo API â€” enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n    51â†’| 1.7 | Integrate DEFRA Flood Risk API â€” flood warnings per property | P1 | S | Fullstack | DONE |\n    52â†’| 1.8 | Load IMD data (ONS CSV â†’ Firestore) | P1 | M | Fullstack | DONE |\n    53â†’| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n    54â†’| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n    55â†’| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n    56â†’| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n    57â†’\n    58â†’---\n    59â†’\n    60â†’## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) â€” âœ… DONE (14/14)\n    61â†’\n    62â†’### Goal: 7 killer differentiators + Tier 2 API registrations\n    63â†’\n    64â†’| # | Task | Priority | Complexity | Agent | Status |\n    65â†’|---|------|----------|------------|-------|--------|\n    66â†’| 2.1 | **Predictive Damp Intelligence** â€” 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n    67â†’| 2.2 | **Live Crime Context for ASB** â€” police data correlation | P1 | L | Fullstack | DONE |\n    68â†’| 2.3 | **Automatic Vulnerability Detection** â€” 7-factor scoring | P1 | L | Fullstack | DONE |\n    69â†’| 2.4 | **Property Passport** â€” multi-source aggregation | P1 | L | Fullstack | DONE |\n    70â†’| 2.5 | **Benefits Entitlement Engine** â€” UK benefit rules analysis | P1 | L | Fullstack | DONE |\n    71â†’| 2.6 | **AI Neighbourhood Briefing** â€” per-estate daily intelligence | P1 | L | Fullstack | DONE |\n    72â†’| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n    73â†’| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n    74â†’| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n    75â†’| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n    76â†’| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n    77â†’| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n    78â†’| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n    79â†’| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n    80â†’\n    81â†’---\n    82â†’\n    83â†’## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) â€” âœ… DONE (14/17)\n    84â†’\n    85â†’### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    86â†’\n    87â†’| # | Task | Priority | Complexity | Agent | Status |\n    88â†’|---|------|----------|------------|-------|--------|\n    89â†’| 3.1 | **Benefits Entitlement Engine** â€” NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n    90â†’| 3.2 | **AI Neighbourhood Briefing** â€” per-estate weekly briefing | P1 | L | Fullstack | DONE |\n    91â†’| 3.3 | **GOV.UK Notify templates** â€” full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n    92â†’| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    93â†’| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n    94â†’| 3.6 | Integrate NOMIS API â€” labour market stats | P2 | M | Fullstack | DONE |\n    95â†’| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n    96â†’| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n    97â†’| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n    98â†’| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    99â†’| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n   100â†’| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n   101â†’| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n   102â†’| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n   103â†’| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n   104â†’| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n   105â†’| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n   106â†’\n   107â†’---\n   108â†’\n   109â†’## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) â€” âœ… DONE (11/14)\n   110â†’\n   111â†’### Goal: Mock services + polish + production hardening\n   112â†’\n   113â†’| # | Task | Priority | Complexity | Agent | Status |\n   114â†’|---|------|----------|------------|-------|--------|\n   115â†’| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n   116â†’| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n   117â†’| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n   118â†’| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n   119â†’| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n   120â†’| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n   121â†’| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n   122â†’| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n   123â†’| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n   124â†’| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n   125â†’| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n   126â†’| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n   127â†’| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n   128â†’| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n   129â†’\n   130â†’---\n   131â†’\n   132â†’## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) â€” ðŸ”µ TODO (0/38)\n   133â†’\n   134â†’### Goal: Real AI, real-time features, advanced testing, production scaling\n   135â†’\n   136â†’Phase 5 is organized into 5 sub-phases matching the required agent structure:\n   137â†’Project Setup & Architecture, Backend Development, Frontend Development,\n   138â†’Testing & QA, and DevOps & Deployment.\n   139â†’\n   140â†’---\n   141â†’\n   142â†’### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n   143â†’\n   144â†’| # | Task | Priority | Complexity | Agent | Status |\n   145â†’|---|------|----------|------------|-------|--------|\n   146â†’| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n   147â†’| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n   148â†’| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist â€” design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n   149â†’| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications â€” connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n   150â†’| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub â€” define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n   151â†’| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment â€” organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n   152â†’| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints â€” request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n   153â†’| 5.1.8 | Design Firestore data migration strategy â€” version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n   154â†’\n   155â†’---\n   156â†’\n   157â†’### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n   158â†’\n   159â†’| # | Task | Priority | Complexity | Agent | Status |\n   160â†’|---|------|----------|------------|-------|--------|\n   161â†’| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist â€” server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n   162â†’| 5.2.2 | Build AI prompt engineering layer â€” context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n   163â†’| 5.2.3 | Implement WebSocket server (Socket.io) â€” connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n   164â†’| 5.2.4 | Build notification dispatch service â€” orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n   165â†’| 5.2.5 | Implement circuit breaker pattern for external API resilience â€” per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n   166â†’| 5.2.6 | Add cache warming service â€” scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n   167â†’| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) â€” compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n   168â†’| 5.2.8 | Implement Firestore real-time listeners for case updates â€” server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n   169â†’| 5.2.9 | Add bulk operations API â€” batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n   170â†’| 5.2.10 | Build audit log query API â€” filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n   171â†’| 5.2.11 | Implement AI communication drafting with Vertex AI â€” replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n   172â†’| 5.2.12 | Add tenant activity scoring â€” calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n   173â†’\n   174â†’---\n   175â†’\n   176â†’### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n   177â†’\n   178â†’| # | Task | Priority | Complexity | Agent | Status |\n   179â†’|---|------|----------|------------|-------|--------|\n   180â†’| 5.3.1 | Build Yantra Assist conversational UI â€” chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n   181â†’| 5.3.2 | Implement real-time notification bell with WebSocket â€” notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n   182â†’| 5.3.3 | Build notification preferences page â€” per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n   183â†’| 5.3.4 | Add interactive charts â€” clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n   184â†’| 5.3.5 | Build workflow builder UI â€” visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n   185â†’| 5.3.6 | Implement dark/light theme toggle â€” Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n   186â†’| 5.3.7 | Add progressive image loading and lazy loading â€” Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n   187â†’| 5.3.8 | Build mobile-responsive layout adaptations â€” collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n   188â†’| 5.3.9 | Add real-time case status indicators â€” WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n   189â†’\n   190â†’---\n   191â†’\n   192â†’### PHASE 5.4: TESTING & QA (Sprint 11)\n   193â†’\n   194â†’| # | Task | Priority | Complexity | Agent | Status |\n   195â†’|---|------|----------|------------|-------|--------|\n   196â†’| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes â€” page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n   197â†’| 5.4.2 | Write unit tests for all 7 AI services â€” damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n   198â†’| 5.4.3 | Write integration tests for external API proxy routes â€” mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n   199â†’| 5.4.4 | Perform load testing â€” Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n   200â†’| 5.4.5 | Perform accessibility audit â€” aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n   201â†’| 5.4.6 | Set up CI test pipeline â€” GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n   202â†’| 5.4.7 | Create test data factory â€” generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n   203â†’\n   204â†’---\n   205â†’\n   206â†’### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n   207â†’\n   208â†’| # | Task | Priority | Complexity | Agent | Status |\n   209â†’|---|------|----------|------------|-------|--------|\n   210â†’| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n   211â†’| 5.5.2 | Set up staging environment on Cloud Run â€” separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n   212â†’| 5.5.3 | Configure Cloud Run auto-scaling policies â€” CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n   213â†’| 5.5.4 | Set up Cloud Monitoring alerts â€” error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n   214â†’| 5.5.5 | Implement database backup strategy â€” Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n   215â†’| 5.5.6 | Set up Cloud CDN for static assets â€” frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n   216â†’| 5.5.7 | Configure custom domain with SSL â€” socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTPâ†’HTTPS redirect | P2 | S | DevOps | TODO |\n   217â†’| 5.5.8 | Create runbook documentation â€” incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n   218â†’\n   219â†’---\n   220â†’\n   221â†’## AGENT ROLES\n   222â†’\n   223â†’| Agent | Responsibility | Key Files |\n   224â†’|-------|---------------|-----------|\n   225â†’| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   226â†’| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   227â†’| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n   228â†’| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   229â†’| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n   230â†’\n   231â†’---\n   232â†’\n   233â†’## KEY DOCUMENTS\n   234â†’\n   235â†’| Document | Location | Purpose |\n   236â†’|----------|----------|---------|\n   237â†’| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n   238â†’| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n   239â†’| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n   240â†’| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n   241â†’| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n   242â†’| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n   243â†’| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n   244â†’| CLAUDE.md | Project root | Claude Code project instructions |\n   245â†’| SESSION-HISTORY.md | Project root | Persistent conversation history |\n   246â†’| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n   247â†’| DEVOPS.md | Project root | DevOps and deployment guide |\n   248â†’| EXECUTION-PLAN.md | Project root | This document |\n   249â†’\n   250â†’---\n   251â†’\n   252â†’## COMMUNICATION\n   253â†’\n   254â†’### Telegram (@SocialHomesBot)\n   255â†’- **Async notifications**: Build status, deployment confirmations, test results\n   256â†’- **Permission requests**: Routed via Telegram when user is away from desk\n   257â†’- **Progress updates**: Phase/sprint completion summaries\n   258â†’- **MCP config**: `.mcp.json` (not committed â€” contains bot token)\n   259â†’\n   260â†’### Session Continuity\n   261â†’- Update `SESSION-HISTORY.md` at end of every session\n   262â†’- `CLAUDE.md` provides context for new sessions\n   263â†’- Entire.io captures checkpoints on commits\n   264â†’\n   265â†’---\n   266â†’\n   267â†’## METRICS & SUCCESS CRITERIA\n   268â†’\n   269â†’| Metric | Target | Current |\n   270â†’|--------|--------|---------|\n   271â†’| Selenium test pass rate | > 98% | 99.7% âœ… |\n   272â†’| TypeScript errors | 0 | 0 âœ… |\n   273â†’| Vite build warnings | 0 critical | 0 âœ… |\n   274â†’| API response time (P95) | < 500ms | ~200-300ms âœ… |\n   275â†’| WCAG AA compliance | 100% | 100% âœ… |\n   276â†’| External API uptime | > 99.5% (with fallback) | 100% âœ… |\n   277â†’| Bundle size | < 3MB | ~2.5MB âœ… |\n   278â†’| Cloud Run cold start | < 3s | < 2s âœ… |\n   279â†’\n   280â†’### Phase 5 Additional Targets\n   281â†’\n   282â†’| Metric | Target |\n   283â†’|--------|--------|\n   284â†’| AI response latency (Vertex AI) | < 3s for conversational queries |\n   285â†’| WebSocket connection stability | > 99.9% uptime |\n   286â†’| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n   287â†’| Selenium test coverage | > 95% of routes |\n   288â†’| Unit test coverage (services) | > 80% line coverage |\n   289â†’| Staging deployment frequency | Every PR |\n   290â†’| Database backup frequency | Daily automated |\n   291â†’| Lighthouse accessibility score | > 90 on all pages |\n   292â†’\n   293â†’---\n   294â†’\n   295â†’## DEFERRED ITEMS (From Phases 3-4)\n   296â†’\n   297â†’Items deferred from earlier phases, now included in Phase 5:\n   298â†’\n   299â†’| Original ID | Task | New Phase 5 ID |\n   300â†’|-------------|------|----------------|\n   301â†’| 3.17 | E2E testing for all new features | 5.4.1 |\n   302â†’| 4.12 | Full regression test suite | 5.4.1 |\n   303â†’| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n   304â†’| 4.14 | API reference documentation | 5.1.7 |\n   305â†’| 4.9 | Cache warming, batch updates | 5.2.6 |\n   306â†’\n   307â†’---\n   308â†’\n   309â†’## PHASE 5 TASK SUMMARY BY AGENT\n   310â†’\n   311â†’| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n   312â†’|-------|-------------|----|----|----|----|\n   313â†’| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n   314â†’| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n   315â†’| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n   316â†’| **Tester** | 7 | 0 | 3 | 4 | 0 |\n   317â†’| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n   318â†’| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n   319â†’\n   320â†’### Recommended Execution Order (Critical Path)\n   321â†’\n   322â†’**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n   323â†’1. 5.1.3 â†’ 5.2.1 â†’ 5.2.2 (Vertex AI architecture â†’ implementation â†’ prompts)\n   324â†’2. 5.1.4 â†’ 5.2.3 (WebSocket design â†’ implementation)\n   325â†’3. 5.5.1 (Fix cloudbuild.yaml â€” unblocks CI)\n   326â†’\n   327â†’**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n   328â†’4. 5.2.4 (Notification dispatch â€” depends on WebSocket)\n   329â†’5. 5.2.11 (AI communication drafting â€” depends on Vertex AI)\n   330â†’6. 5.3.1 (Yantra Assist chat UI â€” depends on Vertex AI backend)\n   331â†’7. 5.3.2 (Notification bell â€” depends on WebSocket backend)\n   332â†’8. 5.2.5, 5.2.6, 5.2.7 (Resilience features â€” parallel)\n   333â†’\n   334â†’**Sprint 11 (Weeks 21-22): Frontend + Testing**\n   335â†’9. 5.3.3â€“5.3.9 (Remaining frontend features â€” parallel)\n   336â†’10. 5.4.1â€“5.4.7 (Testing suite â€” parallel with frontend)\n   337â†’11. 5.5.2 (Staging environment â€” enables test pipeline)\n   338â†’\n   339â†’**Sprint 12 (Weeks 23-24): DevOps + Polish**\n   340â†’12. 5.5.3â€“5.5.8 (Infrastructure hardening â€” parallel)\n   341â†’13. 5.1.7 (API documentation â€” after all endpoints stable)\n   342â†’14. Final regression testing and production deploy\n   343â†’\n   344â†’---\n   345â†’\n   346â†’**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n   347â†’"}]},"uuid":"89b4e9e7-0b71-494e-b95c-97830525327b","timestamp":"2026-02-24T10:42:23.402Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai â€” Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | â€” | âœ… DONE | 10/10 |\n| 1 | Foundation | 1â€“2 | âœ… DONE | 12/12 |\n| 2 | Intelligence | 3â€“4 | âœ… DONE | 14/14 |\n| 3 | Enrichment | 5â€“6 | âœ… DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7â€“8 | âœ… DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9â€“12** | **ðŸ”µ TODO** | **0/38** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE â€” âœ… DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push â†’ Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit â†’ Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements â†’ Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) â€” âœ… DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` â€” shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io â€” postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) â€” UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk â€” street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API â€” enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API â€” flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV â†’ Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) â€” âœ… DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** â€” 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** â€” police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** â€” 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** â€” multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** â€” UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** â€” per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) â€” âœ… DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** â€” NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** â€” per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** â€” full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API â€” labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) â€” âœ… DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) â€” ðŸ”µ TODO (0/38)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist â€” design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications â€” connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub â€” define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment â€” organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints â€” request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy â€” version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist â€” server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer â€” context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) â€” connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service â€” orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience â€” per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service â€” scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) â€” compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates â€” server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API â€” batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API â€” filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI â€” replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring â€” calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI â€” chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket â€” notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page â€” per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts â€” clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI â€” visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle â€” Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading â€” Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations â€” collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators â€” WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes â€” page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services â€” damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes â€” mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing â€” Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit â€” aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline â€” GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory â€” generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run â€” separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies â€” CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts â€” error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy â€” Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets â€” frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL â€” socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTPâ†’HTTPS redirect | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation â€” incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed â€” contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% âœ… |\n| TypeScript errors | 0 | 0 âœ… |\n| Vite build warnings | 0 critical | 0 âœ… |\n| API response time (P95) | < 500ms | ~200-300ms âœ… |\n| WCAG AA compliance | 100% | 100% âœ… |\n| External API uptime | > 99.5% (with fallback) | 100% âœ… |\n| Bundle size | < 3MB | ~2.5MB âœ… |\n| Cloud Run cold start | < 3s | < 2s âœ… |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n| **Tester** | 7 | 0 | 3 | 4 | 0 |\n| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 â†’ 5.2.1 â†’ 5.2.2 (Vertex AI architecture â†’ implementation â†’ prompts)\n2. 5.1.4 â†’ 5.2.3 (WebSocket design â†’ implementation)\n3. 5.5.1 (Fix cloudbuild.yaml â€” unblocks CI)\n\n**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n4. 5.2.4 (Notification dispatch â€” depends on WebSocket)\n5. 5.2.11 (AI communication drafting â€” depends on Vertex AI)\n6. 5.3.1 (Yantra Assist chat UI â€” depends on Vertex AI backend)\n7. 5.3.2 (Notification bell â€” depends on WebSocket backend)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features â€” parallel)\n\n**Sprint 11 (Weeks 21-22): Frontend + Testing**\n9. 5.3.3â€“5.3.9 (Remaining frontend features â€” parallel)\n10. 5.4.1â€“5.4.7 (Testing suite â€” parallel with frontend)\n11. 5.5.2 (Staging environment â€” enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): DevOps + Polish**\n12. 5.5.3â€“5.5.8 (Infrastructure hardening â€” parallel)\n13. 5.1.7 (API documentation â€” after all endpoints stable)\n14. Final regression testing and production deploy\n\n---\n\n**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n","numLines":347,"startLine":1,"totalLines":347}},"sourceToolAssistantUUID":"691ee0f8-9b4a-496c-af6a-4e55ab6eb340"}
{"parentUuid":"89b4e9e7-0b71-494e-b95c-97830525327b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_014k5nqnYvKiygEDEoKAd3mT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01R9waPFgEWzrcrkJM25gaJc","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8993,"cache_read_input_tokens":19542,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8993},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiHgvA4GwohLYxsUVM","type":"assistant","uuid":"4d7bfe85-ed9b-43f5-ac51-2b3b6dc178f7","timestamp":"2026-02-24T10:42:23.831Z"}
{"parentUuid":"4d7bfe85-ed9b-43f5-ac51-2b3b6dc178f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01R9waPFgEWzrcrkJM25gaJc","type":"tool_result","content":"     1â†’# SocialHomes.Ai â€” Session History\n     2â†’\n     3â†’> Persistent conversation log across all Claude Code sessions.\n     4â†’> Updated at the end of each session to preserve context.\n     5â†’\n     6â†’---\n     7â†’\n     8â†’## Session 1 â€” 2026-02-12 (Google Drive path)\n     9â†’**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10â†’**Agent:** Claude Opus 4.6\n    11â†’\n    12â†’### What happened:\n    13â†’- Initial project setup and exploration\n    14â†’- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15â†’- Comprehensive Selenium testing initiated (17 test classes)\n    16â†’- Project overview sent to Telegram\n    17â†’\n    18â†’### Key decisions:\n    19â†’- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20â†’- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21â†’- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22â†’\n    23â†’---\n    24â†’\n    25â†’## Session 2 â€” 2026-02-13 (Migrated to C: drive)\n    26â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27â†’**Agent:** Claude Opus 4.6\n    28â†’\n    29â†’### What happened:\n    30â†’- Security cleanup: removed all exposed API keys and secrets from codebase\n    31â†’- Added full workflow actions and cross-entity navigation\n    32â†’- Eliminated all React Error #310 instances\n    33â†’- Redesigned login page\n    34â†’- Polished dashboard\n    35â†’- Updated DEVOPS.md\n    36â†’\n    37â†’### Commits:\n    38â†’- `e0c23e4` â€” security: remove all exposed API keys and secrets from codebase\n    39â†’- `944e952` â€” feat: add full workflow actions & cross-entity navigation\n    40â†’- `7f6c245` â€” fix: eliminate all React Error #310 + add action modals\n    41â†’- `73fe9d7` â€” fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42â†’- `3d6cedd` â€” docs: update DEVOPS.md with security, serialisation, and UI changes\n    43â†’\n    44â†’---\n    45â†’\n    46â†’## Session 3 â€” 2026-02-14\n    47â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48â†’**Agent:** Claude Opus 4.6\n    49â†’\n    50â†’### What happened:\n    51â†’\n    52â†’#### Task 1: Verified 4 previous bug fixes\n    53â†’- BUG-001: ComplaintDetailPage.tsx â€” null checks intact\n    54â†’- BUG-002: TenancyDetailPage.tsx â€” safeText() and ?? [] guards intact\n    55â†’- BUG-003: AsbPage.tsx â€” navigation handlers intact\n    56â†’- BUG-004: DashboardPage.tsx â€” \"Void Properties\" KPI card intact\n    57â†’\n    58â†’#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59â†’| Warning | File | Fix |\n    60â†’|---------|------|-----|\n    61â†’| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62â†’| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63â†’| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64â†’| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65â†’| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66â†’| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67â†’| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68â†’| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69â†’| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70â†’| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71â†’| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72â†’\n    73â†’#### Task 3: Installed Entire.io CLI\n    74â†’- Installed v0.4.4 at ~/.local/bin/entire\n    75â†’- Strategy: manual-commit\n    76â†’- Fixed all 4 git hooks with PATH export\n    77â†’\n    78â†’#### Task 4: Build and deploy\n    79â†’- TypeScript: 0 errors\n    80â†’- Vite build: 2,580.62 kB JS bundle\n    81â†’- Commit: `1aa4cdd` â€” fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82â†’- Push: succeeded â†’ Cloud Build triggered\n    83â†’\n    84â†’---\n    85â†’\n    86â†’## Session 4 â€” 2026-02-14 (current)\n    87â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88â†’**Agent:** Claude Opus 4.6\n    89â†’\n    90â†’### What happened:\n    91â†’\n    92â†’#### Task 5: Telegram notifications setup\n    93â†’- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94â†’- Created .mcp.json with telegram MCP server config\n    95â†’- Added .mcp.json to .gitignore (contains bot token)\n    96â†’- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97â†’\n    98â†’#### Task 6: Persistent conversation history\n    99â†’- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100â†’- Added to .gitignore (local dev reference only)\n   101â†’\n   102â†’#### Task 7: Entire.io repo\n   103â†’- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104â†’- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105â†’- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106â†’- Entire.io dashboard: https://app.entire.io (login required)\n   107â†’\n   108â†’#### Task 8: UI/UX Audit Document (in progress)\n   109â†’- Frontend UI engineer agent reviewing all pages, components, interactions\n   110â†’- Output: comprehensive audit for fullstack and tester agents\n   111â†’\n   112â†’#### Task 9: BA Requirements â€” Public API Integrations (in progress)\n   113â†’- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114â†’- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115â†’- 7 killer differentiators documented\n   116â†’\n   117â†’#### Task 10: Master Execution Plan (pending)\n   118â†’- Will be created after Tasks 8 and 9 complete\n   119â†’\n   120â†’---\n   121â†’\n   122â†’## Architecture Reference\n   123â†’\n   124â†’### Tech Stack\n   125â†’- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126â†’- **Backend:** Express.js + TypeScript\n   127â†’- **Database:** Google Firestore\n   128â†’- **Hosting:** Google Cloud Run (europe-west2)\n   129â†’- **CI/CD:** GitHub â†’ Cloud Build â†’ Artifact Registry â†’ Cloud Run\n   130â†’- **Maps:** Leaflet.js + OpenStreetMap\n   131â†’- **3D:** Three.js\n   132â†’- **Charts:** Recharts\n   133â†’- **AI:** YantraAssist (contextual AI assistant)\n   134â†’\n   135â†’### Key URLs\n   136â†’- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137â†’- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138â†’- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139â†’- **Firebase Project:** gen-lang-client-0146156913\n   140â†’- **Entire.io dashboard:** https://app.entire.io\n   141â†’\n   142â†’### Personas\n   143â†’1. COO â€” Organisation-wide view\n   144â†’2. Head of Housing â€” Regional oversight\n   145â†’3. Housing Manager â€” Estate/block management\n   146â†’4. Housing Officer â€” Frontline casework\n   147â†’5. Repairs Operative â€” Job-level repairs\n   148â†’\n   149â†’### Telegram Bot\n   150â†’- Bot: @SocialHomesBot\n   151â†’- Chat ID: socialhomes:8020560167\n   152â†’- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153â†’\n   154â†’---\n   155â†’\n   156â†’## Session 5 â€” 2026-02-15\n   157â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158â†’**Agent:** Claude Opus 4.6\n   159â†’\n   160â†’### What happened:\n   161â†’\n   162â†’#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163â†’\n   164â†’**Backend Services Created (7 new files):**\n   165â†’| Service | File | Description |\n   166â†’|---------|------|-------------|\n   167â†’| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168â†’| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169â†’| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170â†’| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171â†’| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172â†’| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173â†’| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174â†’\n   175â†’**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176â†’- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177â†’- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178â†’- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179â†’- D4: `GET /benefits-check/:tenantId`\n   180â†’- D5: `GET /property-passport/:propertyId`\n   181â†’- D6: `GET /briefing/:estateId`\n   182â†’- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183â†’\n   184â†’**Frontend Components Created (4 new panels):**\n   185â†’- `DampIntelligencePanel.tsx` â€” score badge, factor bars, recommendations\n   186â†’- `VulnerabilityPanel.tsx` â€” 7-factor assessment, detected flags, actions\n   187â†’- `BenefitsPanel.tsx` â€” entitlement list with status icons, unclaimed amounts\n   188â†’- `NeighbourhoodBriefingPanel.tsx` â€” 6 summary cards, officer briefing, action items\n   189â†’\n   190â†’**Frontend Pages Updated:**\n   191â†’- `PropertyDetailPage.tsx` â€” DampIntelligencePanel replaces static damp display\n   192â†’- `TenancyDetailPage.tsx` â€” VulnerabilityPanel + BenefitsPanel added\n   193â†’- `AiCentrePage.tsx` â€” New Differentiators tab with 6 feature cards + vulnerability scan\n   194â†’- `api-client.ts` â€” 13 new AI API methods\n   195â†’- `useApi.ts` â€” 10 new React Query hooks\n   196â†’\n   197â†’### Build Results:\n   198â†’- TypeScript (server): 0 errors\n   199â†’- TypeScript (app): 0 errors\n   200â†’- Vite build: 3,395 modules, 38.43s\n   201â†’- All clean on first attempt\n   202â†’\n   203â†’### Commits:\n   204â†’- `4ce6faa` â€” feat: implement all 7 Killer Differentiators â€” AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205â†’\n   206â†’### EXECUTION-PLAN.md updated:\n   207â†’- Phase 2 marked as DONE (all 14 tasks)\n   208â†’\n   209â†’---\n   210â†’\n   211â†’## Session 6 â€” 2026-02-16\n   212â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213â†’**Agent:** Claude Opus 4.6\n   214â†’\n   215â†’### What happened:\n   216â†’\n   217â†’#### Phase 3 Complete: Enrichment â€” GOV.UK Notify, Tier 2 APIs, Accessibility\n   218â†’\n   219â†’**New Backend Services (2 files):**\n   220â†’| Service | File | Lines | Description |\n   221â†’|---------|------|-------|-------------|\n   222â†’| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223â†’| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification â€” all with fetchWithCache + simulated fallbacks |\n   224â†’\n   225â†’**API Routes Added (8 new endpoints):**\n   226â†’- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227â†’- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228â†’\n   229â†’**Frontend Enhancements (5 files modified):**\n   230â†’- `BriefingPage.tsx` â€” Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231â†’- `RepairDetailPage.tsx` â€” Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232â†’- `ExplorePage.tsx` â€” Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233â†’- `api-client.ts` â€” 8 new API methods (4 notify + 4 publicData)\n   234â†’\n   235â†’**Accessibility Fixes (WCAG AA):**\n   236â†’- `ActionModal.tsx` â€” Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237â†’- `index.css` â€” `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238â†’- `Layout.tsx` â€” Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239â†’- `Sidebar.tsx` â€” `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240â†’\n   241â†’### Build Results:\n   242â†’- TypeScript (server): 0 errors\n   243â†’- TypeScript (app): 0 errors\n   244â†’- Vite build: 3,396 modules, 39.22s â€” all clean\n   245â†’- Server build: clean\n   246â†’\n   247â†’### Files Changed: 13 modified + 2 new (523 insertions)\n   248â†’\n   249â†’### Commits:\n   250â†’- `e4aa674` â€” feat: Phase 3 Enrichment â€” GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251â†’\n   252â†’### EXECUTION-PLAN.md updated:\n   253â†’- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254â†’\n   255â†’---\n   256â†’\n   257â†’#### Phase 4 Complete: Completion â€” Mock Services, Admin Dashboard, Security, Monitoring\n   258â†’\n   259â†’**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260â†’| Service | Function | Description |\n   261â†’|---------|----------|-------------|\n   262â†’| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263â†’| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264â†’| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP â€” envelope tracking with recipients |\n   265â†’| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266â†’| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267â†’\n   268â†’**Admin Integration Dashboard:**\n   269â†’- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270â†’- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271â†’- Toggle enable/disable + Test Connection buttons\n   272â†’- Summary bar: total, active, issues, avg response time\n   273â†’- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274â†’- Updated App.tsx routing to use IntegrationsPage\n   275â†’\n   276â†’**Security Hardening:**\n   277â†’- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278â†’- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279â†’- New `server/src/middleware/rate-limiter.ts` â€” sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280â†’- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281â†’- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282â†’- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283â†’- JSON body limit reduced from 10mb to 1mb\n   284â†’\n   285â†’**Production Monitoring:**\n   286â†’- New `server/src/services/monitoring.ts` â€” metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287â†’- New `server/src/middleware/metrics.ts` â€” records every request on res.finish\n   288â†’- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289â†’- New admin route: GET /api/v1/admin/monitoring\n   290â†’- Frontend API client: adminApi.monitoring()\n   291â†’\n   292â†’**API Routes Added (8 new):**\n   293â†’- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294â†’- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295â†’\n   296â†’### Build Results:\n   297â†’- TypeScript (server): 0 errors\n   298â†’- TypeScript (app): 0 errors\n   299â†’- Vite build: 3,397 modules, 35.59s â€” all clean\n   300â†’- Server build: clean\n   301â†’\n   302â†’### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303â†’### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304â†’\n   305â†’### EXECUTION-PLAN.md updated:\n   306â†’- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307â†’\n   308â†’---\n   309â†’\n   310â†’## Session 7 â€” 2026-02-16 (Cloud Run Deployment)\n   311â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312â†’**Agent:** Claude Opus 4.6\n   313â†’\n   314â†’### What happened:\n   315â†’\n   316â†’#### Task 11: Cloud Run Deployment â€” Secret Manager + Deploy\n   317â†’\n   318â†’**Problem:** Previous deployment attempts failed:\n   319â†’1. `gcloud builds submit --config=cloudbuild.yaml` â†’ Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320â†’2. `gcloud run deploy --source .` â†’ Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321â†’\n   322â†’**Resolution:**\n   323â†’1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324â†’2. Created 4 secrets in Secret Manager:\n   325â†’   | Secret | Value Source |\n   326â†’   |--------|-------------|\n   327â†’   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328â†’   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329â†’   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330â†’   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331â†’3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332â†’4. Deployed using pre-built image from Artifact Registry:\n   333â†’   ```\n   334â†’   gcloud run deploy socialhomes \\\n   335â†’     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336â†’     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337â†’     --min-instances=0 --max-instances=10 --port=8080 \\\n   338â†’     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339â†’   ```\n   340â†’\n   341â†’**Result:**\n   342â†’- Revision `socialhomes-00008-rhg` deployed â€” 100% traffic\n   343â†’- Health check: `healthy`, Firestore connected (984ms latency)\n   344â†’- Firebase config endpoint: secrets injected correctly\n   345â†’- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346â†’\n   347â†’### Key Discoveries:\n   348â†’- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349â†’- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350â†’- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351â†’- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352â†’\n   353â†’### Architecture Reference (updated):\n   354â†’- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355â†’- **GCP Project ID:** gen-lang-client-0878518473\n   356â†’- **GCP Project Number:** 587984201316\n   357â†’- **Firebase Project:** gen-lang-client-0146156913\n   358â†’- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359â†’- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360â†’\n   361â†’---\n   362â†’\n   363â†’## Session 8 â€” 2026-02-18 (Business Analyst Session)\n   364â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365â†’**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366â†’\n   367â†’### What happened:\n   368â†’\n   369â†’#### Task: Comprehensive Project Analysis & Specification Documents\n   370â†’\n   371â†’Performed full project analysis covering:\n   372â†’- All 73 frontend TypeScript files across 19 page directories\n   373â†’- All 43 backend TypeScript files (routes, services, middleware, models)\n   374â†’- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375â†’- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376â†’- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377â†’\n   378â†’#### Created 3 Specification Documents in `docs/requirements/`:\n   379â†’\n   380â†’1. **Doc1-socialhomes-Base-Specification.txt** â€” Core product specification\n   381â†’   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382â†’   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383â†’   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384â†’\n   385â†’2. **Doc2-socialhomes-Technical-Architecture.txt** â€” Technical architecture & data models\n   386â†’   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387â†’   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388â†’   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389â†’\n   390â†’3. **Doc3-socialhomes-API-Requirements.txt** â€” API & integration requirements\n   391â†’   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392â†’   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393â†’\n   394â†’#### Updated EXECUTION-PLAN.md (v2.0):\n   395â†’\n   396â†’- Preserved Phases 0â€“4 (all DONE) with progress counts\n   397â†’- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398â†’  - 5.1: Project Setup & Architecture (7 tasks) â€” BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399â†’  - 5.2: Backend Development (10 tasks) â€” Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400â†’  - 5.3: Frontend Development (8 tasks) â€” Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401â†’  - 5.4: Testing & QA (7 tasks) â€” Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402â†’  - 5.5: DevOps & Deployment (8 tasks) â€” Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403â†’- Added deferred items cross-reference table\n   404â†’- Added Phase 5 metrics targets\n   405â†’- Updated plan summary table\n   406â†’\n   407â†’### Files Changed:\n   408â†’- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409â†’- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410â†’- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411â†’- `EXECUTION-PLAN.md` (UPDATED â€” v1.0 â†’ v2.0)\n   412â†’- `SESSION-HISTORY.md` (UPDATED â€” added Session 8)\n   413â†’\n   414â†’### Commits:\n   415â†’- (pending â€” awaiting user instruction to commit)\n   416â†’\n   417â†’### Decisions Taken:\n   418â†’- Specification documents placed in `docs/requirements/` (new directory) â€” separate from original Doc1/Doc2/Doc3 at project root\n   419â†’- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420â†’- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421â†’- Deferred items from Phases 3â€“4 formally cross-referenced into Phase 5 tasks\n   422â†’- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423â†’\n   424â†’### Pending Work:\n   425â†’- Phase 5 tasks 5.1.3â€“5.5.8 all at TODO status (30 remaining tasks)\n   426â†’- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427â†’\n   428â†’---\n   429â†’\n   430â†’## Session 9 â€” 2026-02-23 (Business Analyst Session â€” Spec Refresh)\n   431â†’**Working directory:** `/mnt/c/.netapps/socialhomes`\n   432â†’**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   433â†’\n   434â†’### What happened:\n   435â†’\n   436â†’#### Task: Comprehensive Specification Refresh (v2.0 â†’ v3.0)\n   437â†’\n   438â†’Performed full project re-analysis and updated all specification documents to v3.0.\n   439â†’This session built upon Session 8's initial docs with significantly enhanced content.\n   440â†’\n   441â†’#### Updated 3 Specification Documents in `docs/requirements/`:\n   442â†’\n   443â†’1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) â€” Core product specification\n   444â†’   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   445â†’   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n   446â†’     (added Global Search), Persona System (with AI focus per persona), AI-Native\n   447â†’     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n   448â†’     7 differentiators, AI-augmented workflows, signature interactions),\n   449â†’     Data Model, UI Design (full colour palette, typography, component library),\n   450â†’     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   451â†’   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n   452â†’\n   453â†’2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) â€” Technical architecture\n   454â†’   - Enhanced with precise version numbers from package.json files\n   455â†’   - Added request flow diagram, middleware pipeline detail\n   456â†’   - Added accessibility implementation section\n   457â†’   - Added Firestore security rules and indexes references\n   458â†’   - Added infrastructure references (GCP project IDs, URLs)\n   459â†’   - Added Entire.io to infrastructure table\n   460â†’\n   461â†’3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) â€” API & integration requirements\n   462â†’   - Cleaned up and made consistent with Doc2 endpoint registry\n   463â†’   - Added NOMIS Labour Market extended mock (4.9)\n   464â†’   - Enhanced future roadmap with Phase 6 enterprise integrations\n   465â†’   - Added GOV.UK Notify API endpoints section (6.4)\n   466â†’\n   467â†’#### Updated EXECUTION-PLAN.md (v2.0 â†’ v3.0):\n   468â†’\n   469â†’- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n   470â†’  - 5.1.8: Firestore data migration strategy\n   471â†’  - 5.2.11: AI communication drafting with Vertex AI\n   472â†’  - 5.2.12: Tenant activity scoring\n   473â†’  - 5.3.9: Real-time case status indicators\n   474â†’  - (Renumbered existing tasks for consistency)\n   475â†’- Added detailed task descriptions with specific implementation details\n   476â†’- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n   477â†’- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n   478â†’- Added dependency chains (e.g., 5.1.3 â†’ 5.2.1 â†’ 5.2.2 for Vertex AI)\n   479â†’\n   480â†’### Files Changed:\n   481â†’- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED â€” v2.0 â†’ v3.0)\n   482â†’- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED â€” v2.0 â†’ v3.0)\n   483â†’- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED â€” v2.0 â†’ v3.0)\n   484â†’- `EXECUTION-PLAN.md` (UPDATED â€” v2.0 â†’ v3.0)\n   485â†’- `SESSION-HISTORY.md` (UPDATED â€” added Session 9)\n   486â†’\n   487â†’### Commits:\n   488â†’- (pending â€” awaiting user instruction to commit)\n   489â†’\n   490â†’### Decisions Taken:\n   491â†’- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n   492â†’- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n   493â†’- Created sprint-by-sprint critical path execution order\n   494â†’- Added agent task summary with priority breakdown\n   495â†’- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n   496â†’- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n   497â†’\n   498â†’### Pending Work:\n   499â†’- Phase 5 tasks 5.1.3â€“5.5.8 all at TODO status (36 remaining tasks)\n   500â†’- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   501â†’- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   502â†’"}]},"uuid":"d159f6e8-1be2-46ad-9218-729aa479c3b3","timestamp":"2026-02-24T10:42:24.019Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai â€” Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 â€” 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 â€” 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` â€” security: remove all exposed API keys and secrets from codebase\n- `944e952` â€” feat: add full workflow actions & cross-entity navigation\n- `7f6c245` â€” fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` â€” fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` â€” docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 â€” 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx â€” null checks intact\n- BUG-002: TenancyDetailPage.tsx â€” safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx â€” navigation handlers intact\n- BUG-004: DashboardPage.tsx â€” \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` â€” fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded â†’ Cloud Build triggered\n\n---\n\n## Session 4 â€” 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements â€” Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub â†’ Cloud Build â†’ Artifact Registry â†’ Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO â€” Organisation-wide view\n2. Head of Housing â€” Regional oversight\n3. Housing Manager â€” Estate/block management\n4. Housing Officer â€” Frontline casework\n5. Repairs Operative â€” Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 â€” 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` â€” score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` â€” 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` â€” entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` â€” 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` â€” DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` â€” VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` â€” New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` â€” 13 new AI API methods\n- `useApi.ts` â€” 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` â€” feat: implement all 7 Killer Differentiators â€” AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 â€” 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment â€” GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification â€” all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` â€” Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` â€” Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` â€” Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` â€” 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` â€” Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` â€” `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` â€” Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` â€” `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s â€” all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` â€” feat: Phase 3 Enrichment â€” GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion â€” Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP â€” envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` â€” sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` â€” metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` â€” records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s â€” all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 â€” 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment â€” Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` â†’ Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` â†’ Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed â€” 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 â€” 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** â€” Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** â€” Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** â€” API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0â€“4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) â€” BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) â€” Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) â€” Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) â€” Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) â€” Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED â€” v1.0 â†’ v2.0)\n- `SESSION-HISTORY.md` (UPDATED â€” added Session 8)\n\n### Commits:\n- (pending â€” awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) â€” separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3â€“4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3â€“5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 â€” 2026-02-23 (Business Analyst Session â€” Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 â†’ v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) â€” Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) â€” Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) â€” API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 â†’ v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 â†’ 5.2.1 â†’ 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED â€” v2.0 â†’ v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED â€” v2.0 â†’ v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED â€” v2.0 â†’ v3.0)\n- `EXECUTION-PLAN.md` (UPDATED â€” v2.0 â†’ v3.0)\n- `SESSION-HISTORY.md` (UPDATED â€” added Session 9)\n\n### Commits:\n- (pending â€” awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3â€“5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n","numLines":502,"startLine":1,"totalLines":502}},"sourceToolAssistantUUID":"4d7bfe85-ed9b-43f5-ac51-2b3b6dc178f7"}
{"parentUuid":"d159f6e8-1be2-46ad-9218-729aa479c3b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_01N4hayhzrvf9Ut37E939Ub6","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a thorough understanding of the existing documents. The v3.0 documents are already comprehensive. I need to update them to v4.0 with any refinements, and ensure the EXECUTION-PLAN.md is current. Let me also read the root-level original spec documents to make sure nothing is missed."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":54355,"cache_read_input_tokens":28535,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":54355},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiqvQZn9FtJ3TmJbwP","type":"assistant","uuid":"3bd96ccc-346b-486a-8365-b7e1b409f875","timestamp":"2026-02-24T10:42:29.383Z"}
{"parentUuid":"3bd96ccc-346b-486a-8365-b7e1b409f875","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_01N4hayhzrvf9Ut37E939Ub6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TJHPaPM8VNH1JrpAtysiip","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v4.0)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification (v4.0)"},{"content":"Create Doc2 - Technical Architecture (v4.0)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture (v4.0)"},{"content":"Create Doc3 - API Requirements (v4.0)","status":"pending","activeForm":"Creating Doc3 - API Requirements (v4.0)"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v4.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases (v4.0)"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":54355,"cache_read_input_tokens":28535,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":54355},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkiqvQZn9FtJ3TmJbwP","type":"assistant","uuid":"dddb1427-313b-4bda-8e24-b029f66f2ed9","timestamp":"2026-02-24T10:42:32.357Z"}
{"parentUuid":"dddb1427-313b-4bda-8e24-b029f66f2ed9","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TJHPaPM8VNH1JrpAtysiip","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"2a055d10-2f56-414d-80c2-f8d7f29d8517","timestamp":"2026-02-24T10:42:32.361Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v4.0)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification (v4.0)"},{"content":"Create Doc2 - Technical Architecture (v4.0)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture (v4.0)"},{"content":"Create Doc3 - API Requirements (v4.0)","status":"pending","activeForm":"Creating Doc3 - API Requirements (v4.0)"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v4.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases (v4.0)"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"dddb1427-313b-4bda-8e24-b029f66f2ed9"}
{"parentUuid":"2a055d10-2f56-414d-80c2-f8d7f29d8517","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_015HvV6pEkqV1ZS23jqWA2nP","type":"message","role":"assistant","content":[{"type":"text","text":"Let me read a few more key files to ensure complete accuracy before writing the updated documents."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":418,"cache_read_input_tokens":82890,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":418},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjVSPBAmo6o5SAJi8S","type":"assistant","uuid":"e1b18dc7-9ea2-48e3-8309-5699e828ec86","timestamp":"2026-02-24T10:42:36.182Z"}
{"parentUuid":"e1b18dc7-9ea2-48e3-8309-5699e828ec86","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_015HvV6pEkqV1ZS23jqWA2nP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SQy3zj7t9X8zXjPQ6V4xBM","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/app/package.json"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":418,"cache_read_input_tokens":82890,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":418},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjVSPBAmo6o5SAJi8S","type":"assistant","uuid":"1fe1a766-9e2c-4667-9f86-42f4f5fc28cb","timestamp":"2026-02-24T10:42:36.705Z"}
{"parentUuid":"1fe1a766-9e2c-4667-9f86-42f4f5fc28cb","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SQy3zj7t9X8zXjPQ6V4xBM","type":"tool_result","content":"     1â†’{\n     2â†’  \"name\": \"app\",\n     3â†’  \"private\": true,\n     4â†’  \"version\": \"0.0.0\",\n     5â†’  \"type\": \"module\",\n     6â†’  \"scripts\": {\n     7â†’    \"dev\": \"vite\",\n     8â†’    \"build\": \"tsc -b && vite build\",\n     9â†’    \"lint\": \"eslint .\",\n    10â†’    \"preview\": \"vite preview\"\n    11â†’  },\n    12â†’  \"dependencies\": {\n    13â†’    \"@react-three/drei\": \"^10.7.7\",\n    14â†’    \"@react-three/fiber\": \"^9.5.0\",\n    15â†’    \"@tanstack/react-query\": \"^5.90.20\",\n    16â†’    \"@types/d3\": \"^7.4.3\",\n    17â†’    \"@types/leaflet\": \"^1.9.21\",\n    18â†’    \"clsx\": \"^2.1.1\",\n    19â†’    \"d3\": \"^7.9.0\",\n    20â†’    \"date-fns\": \"^4.1.0\",\n    21â†’    \"firebase\": \"^12.9.0\",\n    22â†’    \"firebaseui\": \"^6.1.0\",\n    23â†’    \"leaflet\": \"^1.9.4\",\n    24â†’    \"lucide-react\": \"^0.563.0\",\n    25â†’    \"react\": \"^19.2.0\",\n    26â†’    \"react-dom\": \"^19.2.0\",\n    27â†’    \"react-is\": \"^19.2.4\",\n    28â†’    \"react-leaflet\": \"^5.0.0\",\n    29â†’    \"react-router-dom\": \"^6.30.3\",\n    30â†’    \"recharts\": \"^3.7.0\",\n    31â†’    \"three\": \"^0.182.0\"\n    32â†’  },\n    33â†’  \"devDependencies\": {\n    34â†’    \"@eslint/js\": \"^9.39.1\",\n    35â†’    \"@tailwindcss/vite\": \"^4.1.18\",\n    36â†’    \"@types/node\": \"^24.10.1\",\n    37â†’    \"@types/react\": \"^19.2.5\",\n    38â†’    \"@types/react-dom\": \"^19.2.3\",\n    39â†’    \"@types/three\": \"^0.182.0\",\n    40â†’    \"@vitejs/plugin-react\": \"^5.1.1\",\n    41â†’    \"eslint\": \"^9.39.1\",\n    42â†’    \"eslint-plugin-react-hooks\": \"^7.0.1\",\n    43â†’    \"eslint-plugin-react-refresh\": \"^0.4.24\",\n    44â†’    \"globals\": \"^16.5.0\",\n    45â†’    \"tailwindcss\": \"^4.1.18\",\n    46â†’    \"typescript\": \"~5.9.3\",\n    47â†’    \"typescript-eslint\": \"^8.46.4\",\n    48â†’    \"vite\": \"^7.2.4\"\n    49â†’  }\n    50â†’}\n    51â†’"}]},"uuid":"bb33f7d4-7933-424a-b976-b919d9d647d9","timestamp":"2026-02-24T10:42:36.750Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/app/package.json","content":"{\n  \"name\": \"app\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"tsc -b && vite build\",\n    \"lint\": \"eslint .\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"@react-three/drei\": \"^10.7.7\",\n    \"@react-three/fiber\": \"^9.5.0\",\n    \"@tanstack/react-query\": \"^5.90.20\",\n    \"@types/d3\": \"^7.4.3\",\n    \"@types/leaflet\": \"^1.9.21\",\n    \"clsx\": \"^2.1.1\",\n    \"d3\": \"^7.9.0\",\n    \"date-fns\": \"^4.1.0\",\n    \"firebase\": \"^12.9.0\",\n    \"firebaseui\": \"^6.1.0\",\n    \"leaflet\": \"^1.9.4\",\n    \"lucide-react\": \"^0.563.0\",\n    \"react\": \"^19.2.0\",\n    \"react-dom\": \"^19.2.0\",\n    \"react-is\": \"^19.2.4\",\n    \"react-leaflet\": \"^5.0.0\",\n    \"react-router-dom\": \"^6.30.3\",\n    \"recharts\": \"^3.7.0\",\n    \"three\": \"^0.182.0\"\n  },\n  \"devDependencies\": {\n    \"@eslint/js\": \"^9.39.1\",\n    \"@tailwindcss/vite\": \"^4.1.18\",\n    \"@types/node\": \"^24.10.1\",\n    \"@types/react\": \"^19.2.5\",\n    \"@types/react-dom\": \"^19.2.3\",\n    \"@types/three\": \"^0.182.0\",\n    \"@vitejs/plugin-react\": \"^5.1.1\",\n    \"eslint\": \"^9.39.1\",\n    \"eslint-plugin-react-hooks\": \"^7.0.1\",\n    \"eslint-plugin-react-refresh\": \"^0.4.24\",\n    \"globals\": \"^16.5.0\",\n    \"tailwindcss\": \"^4.1.18\",\n    \"typescript\": \"~5.9.3\",\n    \"typescript-eslint\": \"^8.46.4\",\n    \"vite\": \"^7.2.4\"\n  }\n}\n","numLines":51,"startLine":1,"totalLines":51}},"sourceToolAssistantUUID":"1fe1a766-9e2c-4667-9f86-42f4f5fc28cb"}
{"parentUuid":"bb33f7d4-7933-424a-b976-b919d9d647d9","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_015HvV6pEkqV1ZS23jqWA2nP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NQ1Lz5EFkMSvY6oDbQR8c6","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/server/package.json"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":418,"cache_read_input_tokens":82890,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":418},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjVSPBAmo6o5SAJi8S","type":"assistant","uuid":"79506625-b466-4487-bff5-c5397a5fd98a","timestamp":"2026-02-24T10:42:37.193Z"}
{"parentUuid":"79506625-b466-4487-bff5-c5397a5fd98a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NQ1Lz5EFkMSvY6oDbQR8c6","type":"tool_result","content":"     1â†’{\n     2â†’  \"name\": \"socialhomes-server\",\n     3â†’  \"version\": \"1.0.0\",\n     4â†’  \"private\": true,\n     5â†’  \"type\": \"module\",\n     6â†’  \"scripts\": {\n     7â†’    \"dev\": \"tsx watch src/index.ts\",\n     8â†’    \"build\": \"tsc\",\n     9â†’    \"start\": \"node dist/index.js\",\n    10â†’    \"seed\": \"tsx src/services/seed.ts\",\n    11â†’    \"seed:imd\": \"tsx src/scripts/seed-imd.ts\",\n    12â†’    \"test\": \"vitest run\",\n    13â†’    \"test:watch\": \"vitest\"\n    14â†’  },\n    15â†’  \"dependencies\": {\n    16â†’    \"@google-cloud/firestore\": \"^7.11.0\",\n    17â†’    \"compression\": \"^1.8.0\",\n    18â†’    \"cors\": \"^2.8.5\",\n    19â†’    \"express\": \"^4.21.2\",\n    20â†’    \"firebase-admin\": \"^13.6.1\",\n    21â†’    \"helmet\": \"^8.1.0\",\n    22â†’    \"morgan\": \"^1.10.0\"\n    23â†’  },\n    24â†’  \"devDependencies\": {\n    25â†’    \"@types/compression\": \"^1.7.5\",\n    26â†’    \"@types/cors\": \"^2.8.17\",\n    27â†’    \"@types/express\": \"^5.0.0\",\n    28â†’    \"@types/morgan\": \"^1.9.9\",\n    29â†’    \"@types/node\": \"^22.15.0\",\n    30â†’    \"@vitest/coverage-v8\": \"^4.0.18\",\n    31â†’    \"tsx\": \"^4.19.4\",\n    32â†’    \"typescript\": \"~5.7.0\",\n    33â†’    \"vitest\": \"^4.0.18\"\n    34â†’  }\n    35â†’}\n    36â†’"}]},"uuid":"d3c91a15-fe35-4ca3-8c97-1059e8c47755","timestamp":"2026-02-24T10:42:37.231Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/server/package.json","content":"{\n  \"name\": \"socialhomes-server\",\n  \"version\": \"1.0.0\",\n  \"private\": true,\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"tsx watch src/index.ts\",\n    \"build\": \"tsc\",\n    \"start\": \"node dist/index.js\",\n    \"seed\": \"tsx src/services/seed.ts\",\n    \"seed:imd\": \"tsx src/scripts/seed-imd.ts\",\n    \"test\": \"vitest run\",\n    \"test:watch\": \"vitest\"\n  },\n  \"dependencies\": {\n    \"@google-cloud/firestore\": \"^7.11.0\",\n    \"compression\": \"^1.8.0\",\n    \"cors\": \"^2.8.5\",\n    \"express\": \"^4.21.2\",\n    \"firebase-admin\": \"^13.6.1\",\n    \"helmet\": \"^8.1.0\",\n    \"morgan\": \"^1.10.0\"\n  },\n  \"devDependencies\": {\n    \"@types/compression\": \"^1.7.5\",\n    \"@types/cors\": \"^2.8.17\",\n    \"@types/express\": \"^5.0.0\",\n    \"@types/morgan\": \"^1.9.9\",\n    \"@types/node\": \"^22.15.0\",\n    \"@vitest/coverage-v8\": \"^4.0.18\",\n    \"tsx\": \"^4.19.4\",\n    \"typescript\": \"~5.7.0\",\n    \"vitest\": \"^4.0.18\"\n  }\n}\n","numLines":36,"startLine":1,"totalLines":36}},"sourceToolAssistantUUID":"79506625-b466-4487-bff5-c5397a5fd98a"}
{"parentUuid":"d3c91a15-fe35-4ca3-8c97-1059e8c47755","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_015HvV6pEkqV1ZS23jqWA2nP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Y6NC1RTFXYEwtytBDEcVqu","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/app/src/types/index.ts"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":418,"cache_read_input_tokens":82890,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":418},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjVSPBAmo6o5SAJi8S","type":"assistant","uuid":"9e7ea0ee-352b-45bc-bb18-c79f1b971ff8","timestamp":"2026-02-24T10:42:37.737Z"}
{"parentUuid":"9e7ea0ee-352b-45bc-bb18-c79f1b971ff8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Y6NC1RTFXYEwtytBDEcVqu","type":"tool_result","content":"     1â†’// ============================================================\n     2â†’// SocialHomes.Ai â€” Complete Type Definitions\n     3â†’// ============================================================\n     4â†’\n     5â†’// ---- Personas ----\n     6â†’export type Persona = 'coo' | 'head-of-service' | 'manager' | 'housing-officer' | 'operative';\n     7â†’\n     8â†’export interface User {\n     9â†’  id: string;\n    10â†’  name: string;\n    11â†’  email: string;\n    12â†’  role: string;\n    13â†’  persona: Persona;\n    14â†’  avatar?: string;\n    15â†’  team?: string;\n    16â†’  patch?: string;\n    17â†’}\n    18â†’\n    19â†’// ---- Geography / Hierarchy ----\n    20â†’export interface Region {\n    21â†’  id: string;\n    22â†’  name: string;\n    23â†’  lat: number;\n    24â†’  lng: number;\n    25â†’  localAuthorities: string[];\n    26â†’  totalUnits: number;\n    27â†’  compliance: number;\n    28â†’  arrears: number;\n    29â†’  voids: number;\n    30â†’}\n    31â†’\n    32â†’export interface LocalAuthority {\n    33â†’  id: string;\n    34â†’  name: string;\n    35â†’  regionId: string;\n    36â†’  lat: number;\n    37â†’  lng: number;\n    38â†’  estates: string[];\n    39â†’  totalUnits: number;\n    40â†’  compliance: number;\n    41â†’  lhaRates?: Record<string, number>;\n    42â†’}\n    43â†’\n    44â†’export interface Estate {\n    45â†’  id: string;\n    46â†’  name: string;\n    47â†’  localAuthorityId: string;\n    48â†’  postcode: string;\n    49â†’  lat: number;\n    50â†’  lng: number;\n    51â†’  constructionEra: string;\n    52â†’  totalUnits: number;\n    53â†’  blocks: string[];\n    54â†’  schemeType: 'general-needs' | 'sheltered' | 'extra-care' | 'supported' | 'mixed';\n    55â†’  managingOfficer: string;\n    56â†’  occupancy: number;\n    57â†’  compliance: number;\n    58â†’  dampCases: number;\n    59â†’  arrears: number;\n    60â†’  asbCases: number;\n    61â†’  repairsBacklog: number;\n    62â†’  // External API enrichment fields\n    63â†’  lsoaCodes?: string[];\n    64â†’  crimeCount30Days?: number;\n    65â†’  crimeCountPrevious30Days?: number;\n    66â†’  crimeTrend?: 'up' | 'down' | 'stable';\n    67â†’}\n    68â†’\n    69â†’export interface Block {\n    70â†’  id: string;\n    71â†’  name: string;\n    72â†’  estateId: string;\n    73â†’  address: string;\n    74â†’  uprn: string;\n    75â†’  lat: number;\n    76â†’  lng: number;\n    77â†’  constructionType: string;\n    78â†’  constructionYear: number;\n    79â†’  storeys: number;\n    80â†’  totalUnits: number;\n    81â†’  units: string[];\n    82â†’  higherRisk: boolean;\n    83â†’  fireRiskAssessment: {\n    84â†’    date: string;\n    85â†’    riskLevel: 'low' | 'medium' | 'substantial' | 'high' | 'very-high';\n    86â†’    actionItems: { description: string; status: 'complete' | 'in-progress' | 'overdue'; }[];\n    87â†’  };\n    88â†’  asbestosManagement: {\n    89â†’    surveyDate: string;\n    90â†’    acmCount: number;\n    91â†’    locations: string[];\n    92â†’  };\n    93â†’  legionellaAssessment: {\n    94â†’    date: string;\n    95â†’    waterSystem: string;\n    96â†’    riskLevel: 'low' | 'medium' | 'high';\n    97â†’  };\n    98â†’  communalFire: {\n    99â†’    detectionType: string;\n   100â†’    zones: number;\n   101â†’    serviceDate: string;\n   102â†’    emergencyLighting: boolean;\n   103â†’    compartmentation: 'good' | 'fair' | 'poor';\n   104â†’    fireDoors: { total: number; compliant: number; };\n   105â†’  };\n   106â†’  lifts?: { id: string; lolerDate: string; status: 'compliant' | 'due' | 'overdue'; }[];\n   107â†’}\n   108â†’\n   109â†’// ---- Properties / Units ----\n   110â†’export type TenureType = 'secure' | 'assured' | 'ast' | 'starter' | 'fixed-term' | 'flexible' | 'licence' | 'shared-ownership';\n   111â†’export type PropertyType = 'flat' | 'house' | 'maisonette' | 'bungalow' | 'bedsit' | 'studio';\n   112â†’export type HeatingType = 'gas-central' | 'electric' | 'district' | 'communal' | 'storage-heaters';\n   113â†’\n   114â†’export interface Property {\n   115â†’  id: string;\n   116â†’  uprn: string;\n   117â†’  address: string;\n   118â†’  postcode: string;\n   119â†’  blockId: string;\n   120â†’  estateId: string;\n   121â†’  localAuthorityId: string;\n   122â†’  regionId: string;\n   123â†’  lat: number;\n   124â†’  lng: number;\n   125â†’  type: PropertyType;\n   126â†’  bedrooms: number;\n   127â†’  floor?: number;\n   128â†’  floorArea: number;\n   129â†’  heatingType: HeatingType;\n   130â†’  tenureType: TenureType;\n   131â†’  currentTenancyId?: string;\n   132â†’  isVoid: boolean;\n   133â†’  voidSince?: string;\n   134â†’  compliance: ComplianceStatus;\n   135â†’  epc: {\n   136â†’    rating: string;\n   137â†’    sapScore: number;\n   138â†’    expiryDate: string;\n   139â†’    potentialRating?: string;\n   140â†’    potentialScore?: number;\n   141â†’    wallsDesc?: string;\n   142â†’    roofDesc?: string;\n   143â†’    windowsDesc?: string;\n   144â†’    heatingDesc?: string;\n   145â†’    co2Current?: number;\n   146â†’    heatingCostAnnual?: number;\n   147â†’    recommendations?: { description: string; estimatedSavings: number; indicativeCost: string; }[];\n   148â†’  };\n   149â†’  gasSafety?: { date: string; expiryDate: string; status: 'valid' | 'expiring' | 'expired'; engineer: string; };\n   150â†’  eicr?: { date: string; expiryDate: string; status: 'valid' | 'expiring' | 'expired'; observations: number; };\n   151â†’  asbestos?: { acms: number; lastSurvey: string; riskLevel: 'low' | 'medium' | 'high'; };\n   152â†’  smokeAlarms?: { count: number; lastTest: string; compliant: boolean; };\n   153â†’  coAlarms?: { count: number; lastTest: string; compliant: boolean; };\n   154â†’  boiler?: { make: string; model: string; installYear: number; lastService: string; efficiency: number; };\n   155â†’  stockCondition?: StockComponent[];\n   156â†’  dampRisk: number; // 0-100 AI score\n   157â†’  weeklyRent: number;\n   158â†’  serviceCharge: number;\n   159â†’  accessibility?: string[];\n   160â†’  // External API enrichment fields\n   161â†’  ward?: string;\n   162â†’  lsoa?: string;\n   163â†’  lsoaCode?: string;\n   164â†’  constituency?: string;\n   165â†’  imdDecile?: number;\n   166â†’  imdScore?: number;\n   167â†’  classificationCode?: string;\n   168â†’  localCustodianCode?: string;\n   169â†’  acquisitionPrice?: number;\n   170â†’  acquisitionDate?: string;\n   171â†’  floodRiskZone?: string;\n   172â†’}\n   173â†’\n   174â†’export interface ComplianceStatus {\n   175â†’  overall: 'compliant' | 'expiring' | 'non-compliant';\n   176â†’  gas: 'valid' | 'expiring' | 'expired' | 'na';\n   177â†’  electrical: 'valid' | 'expiring' | 'expired';\n   178â†’  fire: 'valid' | 'expiring' | 'expired';\n   179â†’  asbestos: 'valid' | 'expiring' | 'expired';\n   180â†’  legionella: 'valid' | 'expiring' | 'expired' | 'na';\n   181â†’  lifts: 'valid' | 'expiring' | 'expired' | 'na';\n   182â†’}\n   183â†’\n   184â†’export interface StockComponent {\n   185â†’  component: string;\n   186â†’  type: string;\n   187â†’  installYear: number;\n   188â†’  condition: 1 | 2 | 3 | 4 | 5;\n   189â†’  remainingLife: number;\n   190â†’  replacementCost: number;\n   191â†’}\n   192â†’\n   193â†’// ---- Tenants ----\n   194â†’export interface Tenant {\n   195â†’  id: string;\n   196â†’  title: string;\n   197â†’  firstName: string;\n   198â†’  lastName: string;\n   199â†’  dob: string;\n   200â†’  email: string;\n   201â†’  phone: string;\n   202â†’  mobile?: string;\n   203â†’  propertyId: string;\n   204â†’  tenancyId: string;\n   205â†’  tenancyStartDate: string;\n   206â†’  tenancyType: TenureType;\n   207â†’  tenancyStatus: 'active' | 'notice' | 'former' | 'suspended' | 'evicted';\n   208â†’  household: HouseholdMember[];\n   209â†’  emergencyContact: { name: string; phone: string; relationship: string; };\n   210â†’  assignedOfficer: string;\n   211â†’  vulnerabilityFlags: VulnerabilityFlag[];\n   212â†’  communicationPreference: 'email' | 'phone' | 'letter' | 'sms';\n   213â†’  ucStatus?: 'claiming' | 'transitioning' | 'managed-migration' | 'none';\n   214â†’  paymentMethod: 'dd' | 'uc' | 'so' | 'card' | 'cash' | 'hb';\n   215â†’  rentBalance: number;\n   216â†’  weeklyCharge: number;\n   217â†’  arrearsRisk: number; // AI score 0-100\n   218â†’  lastContact?: string;\n   219â†’  contactCount30Days: number;\n   220â†’  // External API enrichment fields\n   221â†’  ucHousingElement?: number;\n   222â†’  apaActive?: boolean;\n   223â†’  managedPayment?: boolean;\n   224â†’  ucNextPayment?: string;\n   225â†’  vulnerabilityScore?: number;\n   226â†’}\n   227â†’\n   228â†’export interface HouseholdMember {\n   229â†’  name: string;\n   230â†’  relationship: string;\n   231â†’  dob: string;\n   232â†’  isDependent: boolean;\n   233â†’}\n   234â†’\n   235â†’export interface VulnerabilityFlag {\n   236â†’  type: string;\n   237â†’  severity: 'low' | 'medium' | 'high';\n   238â†’  notes?: string;\n   239â†’  dateIdentified: string;\n   240â†’}\n   241â†’\n   242â†’// ---- Cases (unified) ----\n   243â†’export type CaseType = 'complaint' | 'repair' | 'asb' | 'enquiry' | 'financial' | 'safeguarding' | 'damp-mould';\n   244â†’\n   245â†’export interface Case {\n   246â†’  id: string;\n   247â†’  reference: string;\n   248â†’  type: CaseType;\n   249â†’  tenantId: string;\n   250â†’  propertyId: string;\n   251â†’  subject: string;\n   252â†’  description: string;\n   253â†’  status: string;\n   254â†’  priority: 'emergency' | 'urgent' | 'routine' | 'planned';\n   255â†’  handler: string;\n   256â†’  createdDate: string;\n   257â†’  targetDate?: string;\n   258â†’  closedDate?: string;\n   259â†’  daysOpen: number;\n   260â†’  slaStatus: 'within' | 'approaching' | 'breached';\n   261â†’  activities: Activity[];\n   262â†’  tasks: Task[];\n   263â†’}\n   264â†’\n   265â†’// ---- Repairs ----\n   266â†’export interface Repair extends Case {\n   267â†’  type: 'repair';\n   268â†’  sorCode: string;\n   269â†’  sorDescription: string;\n   270â†’  trade: string;\n   271â†’  operative?: string;\n   272â†’  appointmentDate?: string;\n   273â†’  appointmentSlot?: string;\n   274â†’  completionDate?: string;\n   275â†’  cost?: number;\n   276â†’  materials?: string[];\n   277â†’  photosBefore?: string[];\n   278â†’  photosAfter?: string[];\n   279â†’  satisfaction?: number;\n   280â†’  firstTimeFix: boolean;\n   281â†’  isAwaabsLaw: boolean;\n   282â†’  awaabsLawCategory?: 'emergency' | 'significant';\n   283â†’  awaabsLawTimers?: AwaabsLawTimers;\n   284â†’  recurrenceRisk: number;\n   285â†’}\n   286â†’\n   287â†’export interface AwaabsLawTimers {\n   288â†’  category: 'emergency' | 'significant';\n   289â†’  startDate: string;\n   290â†’  investigateDeadline?: string;\n   291â†’  summaryDeadline?: string;\n   292â†’  safetyWorksDeadline?: string;\n   293â†’  fullRepairDeadline?: string;\n   294â†’  emergencyDeadline?: string;\n   295â†’}\n   296â†’\n   297â†’// ---- Complaints ----\n   298â†’export interface Complaint extends Case {\n   299â†’  type: 'complaint';\n   300â†’  stage: 1 | 2;\n   301â†’  category: string;\n   302â†’  acknowledgeDeadline: string;\n   303â†’  responseDeadline: string;\n   304â†’  acknowledgedDate?: string;\n   305â†’  respondedDate?: string;\n   306â†’  finding?: 'upheld' | 'partially-upheld' | 'not-upheld';\n   307â†’  remedy?: string;\n   308â†’  compensation?: number;\n   309â†’  learningActions?: string[];\n   310â†’  ombudsmanEscalation: boolean;\n   311â†’  escalationRisk: number;\n   312â†’}\n   313â†’\n   314â†’// ---- ASB ----\n   315â†’export type AsbSeverity = 'cat-1' | 'cat-2' | 'cat-3';\n   316â†’export type AsbEscalationStage = 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession' | 'closure';\n   317â†’\n   318â†’export interface AsbCase extends Case {\n   319â†’  type: 'asb';\n   320â†’  category: string;\n   321â†’  severity: AsbSeverity;\n   322â†’  escalationStage: AsbEscalationStage;\n   323â†’  evidenceCount: number;\n   324â†’  multiAgencyPanel: boolean;\n   325â†’  perpetratorId?: string;\n   326â†’  communityTrigger: boolean;\n   327â†’  legalActionProbability: number;\n   328â†’}\n   329â†’\n   330â†’// ---- Financial / Arrears ----\n   331â†’export interface FinancialCase extends Case {\n   332â†’  type: 'financial';\n   333â†’  arrearsAmount: number;\n   334â†’  arrearsReason: string;\n   335â†’  escalationStage: 'pre-action' | 'nosp' | 'court' | 'possession';\n   336â†’  paymentArrangement?: { amount: number; frequency: string; compliance: number; startDate: string; };\n   337â†’  preActionChecklist: Record<string, boolean>;\n   338â†’}\n   339â†’\n   340â†’// ---- Damp & Mould ----\n   341â†’export interface DampMouldCase extends Case {\n   342â†’  type: 'damp-mould';\n   343â†’  hazardClassification: 'emergency' | 'significant' | 'non-urgent';\n   344â†’  dampRiskScore: number;\n   345â†’  cause?: string;\n   346â†’  awaabsLawTimers: AwaabsLawTimers;\n   347â†’  environmentalData?: { humidity: number; temperature: number; moisture: number; };\n   348â†’  linkedRepairs: string[];\n   349â†’}\n   350â†’\n   351â†’// ---- Activities ----\n   352â†’export interface Activity {\n   353â†’  id: string;\n   354â†’  caseId?: string;\n   355â†’  tenantId: string;\n   356â†’  type: 'call' | 'visit' | 'letter' | 'email' | 'sms' | 'system' | 'note';\n   357â†’  direction?: 'inbound' | 'outbound';\n   358â†’  subject: string;\n   359â†’  description: string;\n   360â†’  date: string;\n   361â†’  officer: string;\n   362â†’  linkedCaseRef?: string;\n   363â†’}\n   364â†’\n   365â†’// ---- Tasks ----\n   366â†’export interface Task {\n   367â†’  id: string;\n   368â†’  caseId?: string;\n   369â†’  tenantId?: string;\n   370â†’  propertyId?: string;\n   371â†’  description: string;\n   372â†’  dueDate: string;\n   373â†’  priority: 'high' | 'medium' | 'low';\n   374â†’  status: 'pending' | 'in-progress' | 'completed' | 'overdue';\n   375â†’  assignedTo: string;\n   376â†’  createdBy: string;\n   377â†’  createdDate: string;\n   378â†’  completedDate?: string;\n   379â†’  linkedCaseRef?: string;\n   380â†’}\n   381â†’\n   382â†’// ---- Rent / Financial ----\n   383â†’export interface RentTransaction {\n   384â†’  id: string;\n   385â†’  tenantId: string;\n   386â†’  date: string;\n   387â†’  week: number;\n   388â†’  type: 'charge' | 'payment' | 'adjustment' | 'hb' | 'uc';\n   389â†’  description: string;\n   390â†’  debit: number;\n   391â†’  credit: number;\n   392â†’  balance: number;\n   393â†’}\n   394â†’\n   395â†’export interface ServiceCharge {\n   396â†’  description: string;\n   397â†’  weeklyAmount: number;\n   398â†’  annualBudget: number;\n   399â†’  apportionment: string;\n   400â†’}\n   401â†’\n   402â†’// ---- Compliance ----\n   403â†’export interface ComplianceCertificate {\n   404â†’  id: string;\n   405â†’  propertyId: string;\n   406â†’  type: 'gas' | 'electrical' | 'fire' | 'asbestos' | 'legionella' | 'lift';\n   407â†’  issueDate: string;\n   408â†’  expiryDate: string;\n   409â†’  status: 'valid' | 'expiring' | 'expired';\n   410â†’  contractor: string;\n   411â†’  reference: string;\n   412â†’  notes?: string;\n   413â†’  contractorRegNo?: string;\n   414â†’  contractorVerified?: boolean;\n   415â†’  contractorQuals?: string[];\n   416â†’  contractorRegExpiry?: string;\n   417â†’}\n   418â†’\n   419â†’// ---- Allocations / Voids ----\n   420â†’export type VoidStage = 'notice' | 'keys' | 'inspection' | 'works' | 'quality' | 'ready' | 'offer' | 'let';\n   421â†’\n   422â†’export interface VoidProperty {\n   423â†’  id: string;\n   424â†’  propertyId: string;\n   425â†’  stage: VoidStage;\n   426â†’  voidDate: string;\n   427â†’  daysVoid: number;\n   428â†’  estimatedCost: number;\n   429â†’  weeklyRentLoss: number;\n   430â†’  contractor?: string;\n   431â†’  targetLetDate?: string;\n   432â†’}\n   433â†’\n   434â†’export interface Applicant {\n   435â†’  id: string;\n   436â†’  name: string;\n   437â†’  band: 'A' | 'B' | 'C' | 'D';\n   438â†’  bedroomNeed: number;\n   439â†’  medicalPriority: boolean;\n   440â†’  registrationDate: string;\n   441â†’  localConnection: string;\n   442â†’  status: 'active' | 'suspended' | 'housed' | 'withdrawn';\n   443â†’}\n   444â†’\n   445â†’// ---- Communications ----\n   446â†’export interface Communication {\n   447â†’  id: string;\n   448â†’  tenantId?: string;\n   449â†’  propertyId?: string;\n   450â†’  caseRef?: string;\n   451â†’  channel: 'email' | 'phone' | 'letter' | 'sms' | 'portal' | 'govuk-notify';\n   452â†’  direction: 'inbound' | 'outbound';\n   453â†’  subject: string;\n   454â†’  content: string;\n   455â†’  date: string;\n   456â†’  status: 'new' | 'read' | 'actioned' | 'archived';\n   457â†’  sentiment?: 'positive' | 'neutral' | 'negative' | 'urgent';\n   458â†’  aiCategory?: string;\n   459â†’  aiPriority?: 'high' | 'medium' | 'low';\n   460â†’  externalId?: string;\n   461â†’  deliveryStatus?: 'sending' | 'delivered' | 'permanent-failure' | 'temporary-failure';\n   462â†’  templateId?: string;\n   463â†’}\n   464â†’\n   465â†’// ---- AI ----\n   466â†’export interface AiInsight {\n   467â†’  id: string;\n   468â†’  type: 'prediction' | 'alert' | 'recommendation' | 'analysis';\n   469â†’  severity: 'urgent' | 'attention' | 'info';\n   470â†’  title: string;\n   471â†’  description: string;\n   472â†’  confidence: number;\n   473â†’  affectedEntities: { type: string; id: string; name: string; }[];\n   474â†’  action?: string;\n   475â†’  date: string;\n   476â†’  model?: string;\n   477â†’}\n   478â†’\n   479â†’export interface AiAction {\n   480â†’  id: string;\n   481â†’  icon: string;\n   482â†’  label: string;\n   483â†’  description: string;\n   484â†’  entityType: string;\n   485â†’  entityId: string;\n   486â†’  prediction?: { probability: number; consequence: string; };\n   487â†’  workflow: AiWorkflowStep[];\n   488â†’}\n   489â†’\n   490â†’export interface AiWorkflowStep {\n   491â†’  type: 'preview' | 'edit' | 'confirm' | 'followup' | 'auto-create';\n   492â†’  title: string;\n   493â†’  content?: string;\n   494â†’  options?: string[];\n   495â†’}\n   496â†’\n   497â†’// ---- Admin ----\n   498â†’export interface AuditEntry {\n   499â†’  id: string;\n   500â†’  timestamp: string;\n   501â†’  user: string;\n   502â†’  entity: string;\n   503â†’  entityId: string;\n   504â†’  field: string;\n   505â†’  oldValue: string;\n   506â†’  newValue: string;\n   507â†’  ip: string;\n   508â†’  action: 'create' | 'update' | 'delete' | 'view' | 'login' | 'export';\n   509â†’}\n   510â†’\n   511â†’export interface WorkflowTemplate {\n   512â†’  id: string;\n   513â†’  name: string;\n   514â†’  description: string;\n   515â†’  trigger: string;\n   516â†’  conditions: string[];\n   517â†’  actions: string[];\n   518â†’  isActive: boolean;\n   519â†’}\n   520â†’\n   521â†’export interface Integration {\n   522â†’  id: string;\n   523â†’  name: string;\n   524â†’  description: string;\n   525â†’  status: 'connected' | 'disconnected' | 'error';\n   526â†’  lastSync?: string;\n   527â†’  logo: string;\n   528â†’  category: string;\n   529â†’}\n   530â†’\n   531â†’// ---- Reports ----\n   532â†’export interface TsmMeasure {\n   533â†’  id: string;\n   534â†’  code: string;\n   535â†’  name: string;\n   536â†’  actual: number;\n   537â†’  target: number;\n   538â†’  sectorMedian: number;\n   539â†’  upperQuartile: number;\n   540â†’  lowerQuartile: number;\n   541â†’  unit: string;\n   542â†’  trend: 'up' | 'down' | 'stable';\n   543â†’}\n   544â†’\n   545â†’// ---- KPIs ----\n   546â†’export interface KpiCard {\n   547â†’  label: string;\n   548â†’  value: string | number;\n   549â†’  subValue?: string;\n   550â†’  trend?: 'up' | 'down' | 'stable';\n   551â†’  trendValue?: string;\n   552â†’  colour: string;\n   553â†’  icon: string;\n   554â†’}\n   555â†’\n   556â†’// ---- Notification ----\n   557â†’export interface Notification {\n   558â†’  id: string;\n   559â†’  type: 'urgent' | 'warning' | 'info' | 'ai';\n   560â†’  title: string;\n   561â†’  message: string;\n   562â†’  date: string;\n   563â†’  read: boolean;\n   564â†’  entityType?: string;\n   565â†’  entityId?: string;\n   566â†’}\n   567â†’\n   568â†’// ---- External API: Crime ----\n   569â†’export interface CrimeIncident {\n   570â†’  externalId: string;\n   571â†’  category: string;\n   572â†’  lat: number;\n   573â†’  lng: number;\n   574â†’  streetName: string;\n   575â†’  outcome?: string;\n   576â†’  month: string;\n   577â†’  source: 'police-api' | 'simulated';\n   578â†’}\n   579â†’\n   580â†’// ---- External API: Deprivation ----\n   581â†’export interface DeprivationProfile {\n   582â†’  lsoaCode: string;\n   583â†’  imdScore: number;\n   584â†’  imdRank: number;\n   585â†’  imdDecile: number;\n   586â†’  incomeScore: number;\n   587â†’  employmentScore: number;\n   588â†’  educationScore: number;\n   589â†’  healthScore: number;\n   590â†’  crimeScore: number;\n   591â†’  housingScore: number;\n   592â†’  livingEnvironmentScore: number;\n   593â†’  source: 'ons' | 'simulated';\n   594â†’}\n   595â†’\n   596â†’// ---- External API: Area Demographics (Census) ----\n   597â†’export interface AreaDemographics {\n   598â†’  lsoaCode: string;\n   599â†’  socialRentPct: number;\n   600â†’  privateRentPct: number;\n   601â†’  ownerOccupiedPct: number;\n   602â†’  averageHouseholdSize: number;\n   603â†’  over65Pct: number;\n   604â†’  under18Pct: number;\n   605â†’  limitedActivitiesPct: number;\n   606â†’  source: 'census-2021' | 'simulated';\n   607â†’}\n   608â†’\n   609â†’// ---- External API: Labour Market ----\n   610â†’export interface LabourMarket {\n   611â†’  laCode: string;\n   612â†’  claimantCount: number;\n   613â†’  claimantRate: number;\n   614â†’  employmentRate: number;\n   615â†’  jobDensity: number;\n   616â†’  oowBenefitsRate: number;\n   617â†’  period: string;\n   618â†’  source: 'nomis' | 'simulated';\n   619â†’}\n   620â†’\n   621â†’// ---- External API: Flood Risk ----\n   622â†’export interface FloodAlert {\n   623â†’  areaId: string;\n   624â†’  severity: 'severe-warning' | 'warning' | 'alert' | 'none';\n   625â†’  severityLevel: number;\n   626â†’  description: string;\n   627â†’  raisedAt: string;\n   628â†’  message: string;\n   629â†’  source: 'defra' | 'simulated';\n   630â†’}\n   631â†’\n   632â†’// ---- External API: Weather (enhanced) ----\n   633â†’export interface WeatherDetail {\n   634â†’  date: string;\n   635â†’  temperature: number;\n   636â†’  humidity: number;\n   637â†’  precipitation: number;\n   638â†’  windSpeed: number;\n   639â†’  windGust?: number;\n   640â†’  dewPoint?: number;\n   641â†’  weatherCode?: number;\n   642â†’  dampRiskCondition: boolean;\n   643â†’  source: 'open-meteo' | 'met-office' | 'simulated';\n   644â†’}\n   645â†’\n   646â†’export interface WeatherWarning {\n   647â†’  id: string;\n   648â†’  severity: 'red' | 'amber' | 'yellow';\n   649â†’  type: string;\n   650â†’  headline: string;\n   651â†’  validFrom: string;\n   652â†’  validTo: string;\n   653â†’  affectedAreas: string[];\n   654â†’  source: 'met-office' | 'simulated';\n   655â†’}\n   656â†’\n   657â†’// ---- External API: IoT Sensors (mock) ----\n   658â†’export interface SensorReading {\n   659â†’  sensorId: string;\n   660â†’  propertyId: string;\n   661â†’  timestamp: string;\n   662â†’  temperature: number;\n   663â†’  humidity: number;\n   664â†’  moisture: number;\n   665â†’  co2Level?: number;\n   666â†’  source: 'switchee' | 'aico' | 'homelync' | 'simulated';\n   667â†’}\n   668â†’\n   669â†’export interface SensorAlert {\n   670â†’  id: string;\n   671â†’  sensorId: string;\n   672â†’  propertyId: string;\n   673â†’  type: 'high-humidity' | 'high-moisture' | 'low-temperature' | 'smoke' | 'co';\n   674â†’  severity: 'critical' | 'warning' | 'info';\n   675â†’  value: number;\n   676â†’  threshold: number;\n   677â†’  timestamp: string;\n   678â†’  acknowledged: boolean;\n   679â†’}\n   680â†’\n   681â†’// ---- External API: DWP Universal Credit (mock) ----\n   682â†’export interface UcStatus {\n   683â†’  tenantId: string;\n   684â†’  ucStatus: 'claiming' | 'transitioning' | 'managed-migration' | 'none';\n   685â†’  claimStartDate?: string;\n   686â†’  nextPaymentDate?: string;\n   687â†’  estimatedAmount?: number;\n   688â†’  housingElement?: number;\n   689â†’  apaInPlace: boolean;\n   690â†’  managedPayment: boolean;\n   691â†’  source: 'dwp' | 'simulated';\n   692â†’}\n   693â†’\n   694â†’// ---- Composite: Damp Risk Breakdown ----\n   695â†’export interface DampRiskBreakdown {\n   696â†’  propertyId: string;\n   697â†’  overallScore: number;\n   698â†’  weatherFactor: number;\n   699â†’  buildingFactor: number;\n   700â†’  historyFactor: number;\n   701â†’  sensorFactor: number;\n   702â†’  occupancyFactor: number;\n   703â†’  calculatedAt: string;\n   704â†’  sources: string[];\n   705â†’}\n   706â†’\n   707â†’// ---- Composite: Vulnerability Assessment ----\n   708â†’export interface VulnerabilityAssessment {\n   709â†’  tenantId: string;\n   710â†’  overallScore: number;\n   711â†’  deprivationFactor: number;\n   712â†’  arrearsFactor: number;\n   713â†’  healthFactor: number;\n   714â†’  isolationFactor: number;\n   715â†’  ageFactor: number;\n   716â†’  dependentsFactor: number;\n   717â†’  ucTransitionFactor: number;\n   718â†’  autoFlags: string[];\n   719â†’  calculatedAt: string;\n   720â†’  sources: string[];\n   721â†’}\n   722â†’"}]},"uuid":"3e4e8861-336a-471f-bfc2-e90be99cb872","timestamp":"2026-02-24T10:42:37.815Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/app/src/types/index.ts","content":"// ============================================================\n// SocialHomes.Ai â€” Complete Type Definitions\n// ============================================================\n\n// ---- Personas ----\nexport type Persona = 'coo' | 'head-of-service' | 'manager' | 'housing-officer' | 'operative';\n\nexport interface User {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  persona: Persona;\n  avatar?: string;\n  team?: string;\n  patch?: string;\n}\n\n// ---- Geography / Hierarchy ----\nexport interface Region {\n  id: string;\n  name: string;\n  lat: number;\n  lng: number;\n  localAuthorities: string[];\n  totalUnits: number;\n  compliance: number;\n  arrears: number;\n  voids: number;\n}\n\nexport interface LocalAuthority {\n  id: string;\n  name: string;\n  regionId: string;\n  lat: number;\n  lng: number;\n  estates: string[];\n  totalUnits: number;\n  compliance: number;\n  lhaRates?: Record<string, number>;\n}\n\nexport interface Estate {\n  id: string;\n  name: string;\n  localAuthorityId: string;\n  postcode: string;\n  lat: number;\n  lng: number;\n  constructionEra: string;\n  totalUnits: number;\n  blocks: string[];\n  schemeType: 'general-needs' | 'sheltered' | 'extra-care' | 'supported' | 'mixed';\n  managingOfficer: string;\n  occupancy: number;\n  compliance: number;\n  dampCases: number;\n  arrears: number;\n  asbCases: number;\n  repairsBacklog: number;\n  // External API enrichment fields\n  lsoaCodes?: string[];\n  crimeCount30Days?: number;\n  crimeCountPrevious30Days?: number;\n  crimeTrend?: 'up' | 'down' | 'stable';\n}\n\nexport interface Block {\n  id: string;\n  name: string;\n  estateId: string;\n  address: string;\n  uprn: string;\n  lat: number;\n  lng: number;\n  constructionType: string;\n  constructionYear: number;\n  storeys: number;\n  totalUnits: number;\n  units: string[];\n  higherRisk: boolean;\n  fireRiskAssessment: {\n    date: string;\n    riskLevel: 'low' | 'medium' | 'substantial' | 'high' | 'very-high';\n    actionItems: { description: string; status: 'complete' | 'in-progress' | 'overdue'; }[];\n  };\n  asbestosManagement: {\n    surveyDate: string;\n    acmCount: number;\n    locations: string[];\n  };\n  legionellaAssessment: {\n    date: string;\n    waterSystem: string;\n    riskLevel: 'low' | 'medium' | 'high';\n  };\n  communalFire: {\n    detectionType: string;\n    zones: number;\n    serviceDate: string;\n    emergencyLighting: boolean;\n    compartmentation: 'good' | 'fair' | 'poor';\n    fireDoors: { total: number; compliant: number; };\n  };\n  lifts?: { id: string; lolerDate: string; status: 'compliant' | 'due' | 'overdue'; }[];\n}\n\n// ---- Properties / Units ----\nexport type TenureType = 'secure' | 'assured' | 'ast' | 'starter' | 'fixed-term' | 'flexible' | 'licence' | 'shared-ownership';\nexport type PropertyType = 'flat' | 'house' | 'maisonette' | 'bungalow' | 'bedsit' | 'studio';\nexport type HeatingType = 'gas-central' | 'electric' | 'district' | 'communal' | 'storage-heaters';\n\nexport interface Property {\n  id: string;\n  uprn: string;\n  address: string;\n  postcode: string;\n  blockId: string;\n  estateId: string;\n  localAuthorityId: string;\n  regionId: string;\n  lat: number;\n  lng: number;\n  type: PropertyType;\n  bedrooms: number;\n  floor?: number;\n  floorArea: number;\n  heatingType: HeatingType;\n  tenureType: TenureType;\n  currentTenancyId?: string;\n  isVoid: boolean;\n  voidSince?: string;\n  compliance: ComplianceStatus;\n  epc: {\n    rating: string;\n    sapScore: number;\n    expiryDate: string;\n    potentialRating?: string;\n    potentialScore?: number;\n    wallsDesc?: string;\n    roofDesc?: string;\n    windowsDesc?: string;\n    heatingDesc?: string;\n    co2Current?: number;\n    heatingCostAnnual?: number;\n    recommendations?: { description: string; estimatedSavings: number; indicativeCost: string; }[];\n  };\n  gasSafety?: { date: string; expiryDate: string; status: 'valid' | 'expiring' | 'expired'; engineer: string; };\n  eicr?: { date: string; expiryDate: string; status: 'valid' | 'expiring' | 'expired'; observations: number; };\n  asbestos?: { acms: number; lastSurvey: string; riskLevel: 'low' | 'medium' | 'high'; };\n  smokeAlarms?: { count: number; lastTest: string; compliant: boolean; };\n  coAlarms?: { count: number; lastTest: string; compliant: boolean; };\n  boiler?: { make: string; model: string; installYear: number; lastService: string; efficiency: number; };\n  stockCondition?: StockComponent[];\n  dampRisk: number; // 0-100 AI score\n  weeklyRent: number;\n  serviceCharge: number;\n  accessibility?: string[];\n  // External API enrichment fields\n  ward?: string;\n  lsoa?: string;\n  lsoaCode?: string;\n  constituency?: string;\n  imdDecile?: number;\n  imdScore?: number;\n  classificationCode?: string;\n  localCustodianCode?: string;\n  acquisitionPrice?: number;\n  acquisitionDate?: string;\n  floodRiskZone?: string;\n}\n\nexport interface ComplianceStatus {\n  overall: 'compliant' | 'expiring' | 'non-compliant';\n  gas: 'valid' | 'expiring' | 'expired' | 'na';\n  electrical: 'valid' | 'expiring' | 'expired';\n  fire: 'valid' | 'expiring' | 'expired';\n  asbestos: 'valid' | 'expiring' | 'expired';\n  legionella: 'valid' | 'expiring' | 'expired' | 'na';\n  lifts: 'valid' | 'expiring' | 'expired' | 'na';\n}\n\nexport interface StockComponent {\n  component: string;\n  type: string;\n  installYear: number;\n  condition: 1 | 2 | 3 | 4 | 5;\n  remainingLife: number;\n  replacementCost: number;\n}\n\n// ---- Tenants ----\nexport interface Tenant {\n  id: string;\n  title: string;\n  firstName: string;\n  lastName: string;\n  dob: string;\n  email: string;\n  phone: string;\n  mobile?: string;\n  propertyId: string;\n  tenancyId: string;\n  tenancyStartDate: string;\n  tenancyType: TenureType;\n  tenancyStatus: 'active' | 'notice' | 'former' | 'suspended' | 'evicted';\n  household: HouseholdMember[];\n  emergencyContact: { name: string; phone: string; relationship: string; };\n  assignedOfficer: string;\n  vulnerabilityFlags: VulnerabilityFlag[];\n  communicationPreference: 'email' | 'phone' | 'letter' | 'sms';\n  ucStatus?: 'claiming' | 'transitioning' | 'managed-migration' | 'none';\n  paymentMethod: 'dd' | 'uc' | 'so' | 'card' | 'cash' | 'hb';\n  rentBalance: number;\n  weeklyCharge: number;\n  arrearsRisk: number; // AI score 0-100\n  lastContact?: string;\n  contactCount30Days: number;\n  // External API enrichment fields\n  ucHousingElement?: number;\n  apaActive?: boolean;\n  managedPayment?: boolean;\n  ucNextPayment?: string;\n  vulnerabilityScore?: number;\n}\n\nexport interface HouseholdMember {\n  name: string;\n  relationship: string;\n  dob: string;\n  isDependent: boolean;\n}\n\nexport interface VulnerabilityFlag {\n  type: string;\n  severity: 'low' | 'medium' | 'high';\n  notes?: string;\n  dateIdentified: string;\n}\n\n// ---- Cases (unified) ----\nexport type CaseType = 'complaint' | 'repair' | 'asb' | 'enquiry' | 'financial' | 'safeguarding' | 'damp-mould';\n\nexport interface Case {\n  id: string;\n  reference: string;\n  type: CaseType;\n  tenantId: string;\n  propertyId: string;\n  subject: string;\n  description: string;\n  status: string;\n  priority: 'emergency' | 'urgent' | 'routine' | 'planned';\n  handler: string;\n  createdDate: string;\n  targetDate?: string;\n  closedDate?: string;\n  daysOpen: number;\n  slaStatus: 'within' | 'approaching' | 'breached';\n  activities: Activity[];\n  tasks: Task[];\n}\n\n// ---- Repairs ----\nexport interface Repair extends Case {\n  type: 'repair';\n  sorCode: string;\n  sorDescription: string;\n  trade: string;\n  operative?: string;\n  appointmentDate?: string;\n  appointmentSlot?: string;\n  completionDate?: string;\n  cost?: number;\n  materials?: string[];\n  photosBefore?: string[];\n  photosAfter?: string[];\n  satisfaction?: number;\n  firstTimeFix: boolean;\n  isAwaabsLaw: boolean;\n  awaabsLawCategory?: 'emergency' | 'significant';\n  awaabsLawTimers?: AwaabsLawTimers;\n  recurrenceRisk: number;\n}\n\nexport interface AwaabsLawTimers {\n  category: 'emergency' | 'significant';\n  startDate: string;\n  investigateDeadline?: string;\n  summaryDeadline?: string;\n  safetyWorksDeadline?: string;\n  fullRepairDeadline?: string;\n  emergencyDeadline?: string;\n}\n\n// ---- Complaints ----\nexport interface Complaint extends Case {\n  type: 'complaint';\n  stage: 1 | 2;\n  category: string;\n  acknowledgeDeadline: string;\n  responseDeadline: string;\n  acknowledgedDate?: string;\n  respondedDate?: string;\n  finding?: 'upheld' | 'partially-upheld' | 'not-upheld';\n  remedy?: string;\n  compensation?: number;\n  learningActions?: string[];\n  ombudsmanEscalation: boolean;\n  escalationRisk: number;\n}\n\n// ---- ASB ----\nexport type AsbSeverity = 'cat-1' | 'cat-2' | 'cat-3';\nexport type AsbEscalationStage = 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession' | 'closure';\n\nexport interface AsbCase extends Case {\n  type: 'asb';\n  category: string;\n  severity: AsbSeverity;\n  escalationStage: AsbEscalationStage;\n  evidenceCount: number;\n  multiAgencyPanel: boolean;\n  perpetratorId?: string;\n  communityTrigger: boolean;\n  legalActionProbability: number;\n}\n\n// ---- Financial / Arrears ----\nexport interface FinancialCase extends Case {\n  type: 'financial';\n  arrearsAmount: number;\n  arrearsReason: string;\n  escalationStage: 'pre-action' | 'nosp' | 'court' | 'possession';\n  paymentArrangement?: { amount: number; frequency: string; compliance: number; startDate: string; };\n  preActionChecklist: Record<string, boolean>;\n}\n\n// ---- Damp & Mould ----\nexport interface DampMouldCase extends Case {\n  type: 'damp-mould';\n  hazardClassification: 'emergency' | 'significant' | 'non-urgent';\n  dampRiskScore: number;\n  cause?: string;\n  awaabsLawTimers: AwaabsLawTimers;\n  environmentalData?: { humidity: number; temperature: number; moisture: number; };\n  linkedRepairs: string[];\n}\n\n// ---- Activities ----\nexport interface Activity {\n  id: string;\n  caseId?: string;\n  tenantId: string;\n  type: 'call' | 'visit' | 'letter' | 'email' | 'sms' | 'system' | 'note';\n  direction?: 'inbound' | 'outbound';\n  subject: string;\n  description: string;\n  date: string;\n  officer: string;\n  linkedCaseRef?: string;\n}\n\n// ---- Tasks ----\nexport interface Task {\n  id: string;\n  caseId?: string;\n  tenantId?: string;\n  propertyId?: string;\n  description: string;\n  dueDate: string;\n  priority: 'high' | 'medium' | 'low';\n  status: 'pending' | 'in-progress' | 'completed' | 'overdue';\n  assignedTo: string;\n  createdBy: string;\n  createdDate: string;\n  completedDate?: string;\n  linkedCaseRef?: string;\n}\n\n// ---- Rent / Financial ----\nexport interface RentTransaction {\n  id: string;\n  tenantId: string;\n  date: string;\n  week: number;\n  type: 'charge' | 'payment' | 'adjustment' | 'hb' | 'uc';\n  description: string;\n  debit: number;\n  credit: number;\n  balance: number;\n}\n\nexport interface ServiceCharge {\n  description: string;\n  weeklyAmount: number;\n  annualBudget: number;\n  apportionment: string;\n}\n\n// ---- Compliance ----\nexport interface ComplianceCertificate {\n  id: string;\n  propertyId: string;\n  type: 'gas' | 'electrical' | 'fire' | 'asbestos' | 'legionella' | 'lift';\n  issueDate: string;\n  expiryDate: string;\n  status: 'valid' | 'expiring' | 'expired';\n  contractor: string;\n  reference: string;\n  notes?: string;\n  contractorRegNo?: string;\n  contractorVerified?: boolean;\n  contractorQuals?: string[];\n  contractorRegExpiry?: string;\n}\n\n// ---- Allocations / Voids ----\nexport type VoidStage = 'notice' | 'keys' | 'inspection' | 'works' | 'quality' | 'ready' | 'offer' | 'let';\n\nexport interface VoidProperty {\n  id: string;\n  propertyId: string;\n  stage: VoidStage;\n  voidDate: string;\n  daysVoid: number;\n  estimatedCost: number;\n  weeklyRentLoss: number;\n  contractor?: string;\n  targetLetDate?: string;\n}\n\nexport interface Applicant {\n  id: string;\n  name: string;\n  band: 'A' | 'B' | 'C' | 'D';\n  bedroomNeed: number;\n  medicalPriority: boolean;\n  registrationDate: string;\n  localConnection: string;\n  status: 'active' | 'suspended' | 'housed' | 'withdrawn';\n}\n\n// ---- Communications ----\nexport interface Communication {\n  id: string;\n  tenantId?: string;\n  propertyId?: string;\n  caseRef?: string;\n  channel: 'email' | 'phone' | 'letter' | 'sms' | 'portal' | 'govuk-notify';\n  direction: 'inbound' | 'outbound';\n  subject: string;\n  content: string;\n  date: string;\n  status: 'new' | 'read' | 'actioned' | 'archived';\n  sentiment?: 'positive' | 'neutral' | 'negative' | 'urgent';\n  aiCategory?: string;\n  aiPriority?: 'high' | 'medium' | 'low';\n  externalId?: string;\n  deliveryStatus?: 'sending' | 'delivered' | 'permanent-failure' | 'temporary-failure';\n  templateId?: string;\n}\n\n// ---- AI ----\nexport interface AiInsight {\n  id: string;\n  type: 'prediction' | 'alert' | 'recommendation' | 'analysis';\n  severity: 'urgent' | 'attention' | 'info';\n  title: string;\n  description: string;\n  confidence: number;\n  affectedEntities: { type: string; id: string; name: string; }[];\n  action?: string;\n  date: string;\n  model?: string;\n}\n\nexport interface AiAction {\n  id: string;\n  icon: string;\n  label: string;\n  description: string;\n  entityType: string;\n  entityId: string;\n  prediction?: { probability: number; consequence: string; };\n  workflow: AiWorkflowStep[];\n}\n\nexport interface AiWorkflowStep {\n  type: 'preview' | 'edit' | 'confirm' | 'followup' | 'auto-create';\n  title: string;\n  content?: string;\n  options?: string[];\n}\n\n// ---- Admin ----\nexport interface AuditEntry {\n  id: string;\n  timestamp: string;\n  user: string;\n  entity: string;\n  entityId: string;\n  field: string;\n  oldValue: string;\n  newValue: string;\n  ip: string;\n  action: 'create' | 'update' | 'delete' | 'view' | 'login' | 'export';\n}\n\nexport interface WorkflowTemplate {\n  id: string;\n  name: string;\n  description: string;\n  trigger: string;\n  conditions: string[];\n  actions: string[];\n  isActive: boolean;\n}\n\nexport interface Integration {\n  id: string;\n  name: string;\n  description: string;\n  status: 'connected' | 'disconnected' | 'error';\n  lastSync?: string;\n  logo: string;\n  category: string;\n}\n\n// ---- Reports ----\nexport interface TsmMeasure {\n  id: string;\n  code: string;\n  name: string;\n  actual: number;\n  target: number;\n  sectorMedian: number;\n  upperQuartile: number;\n  lowerQuartile: number;\n  unit: string;\n  trend: 'up' | 'down' | 'stable';\n}\n\n// ---- KPIs ----\nexport interface KpiCard {\n  label: string;\n  value: string | number;\n  subValue?: string;\n  trend?: 'up' | 'down' | 'stable';\n  trendValue?: string;\n  colour: string;\n  icon: string;\n}\n\n// ---- Notification ----\nexport interface Notification {\n  id: string;\n  type: 'urgent' | 'warning' | 'info' | 'ai';\n  title: string;\n  message: string;\n  date: string;\n  read: boolean;\n  entityType?: string;\n  entityId?: string;\n}\n\n// ---- External API: Crime ----\nexport interface CrimeIncident {\n  externalId: string;\n  category: string;\n  lat: number;\n  lng: number;\n  streetName: string;\n  outcome?: string;\n  month: string;\n  source: 'police-api' | 'simulated';\n}\n\n// ---- External API: Deprivation ----\nexport interface DeprivationProfile {\n  lsoaCode: string;\n  imdScore: number;\n  imdRank: number;\n  imdDecile: number;\n  incomeScore: number;\n  employmentScore: number;\n  educationScore: number;\n  healthScore: number;\n  crimeScore: number;\n  housingScore: number;\n  livingEnvironmentScore: number;\n  source: 'ons' | 'simulated';\n}\n\n// ---- External API: Area Demographics (Census) ----\nexport interface AreaDemographics {\n  lsoaCode: string;\n  socialRentPct: number;\n  privateRentPct: number;\n  ownerOccupiedPct: number;\n  averageHouseholdSize: number;\n  over65Pct: number;\n  under18Pct: number;\n  limitedActivitiesPct: number;\n  source: 'census-2021' | 'simulated';\n}\n\n// ---- External API: Labour Market ----\nexport interface LabourMarket {\n  laCode: string;\n  claimantCount: number;\n  claimantRate: number;\n  employmentRate: number;\n  jobDensity: number;\n  oowBenefitsRate: number;\n  period: string;\n  source: 'nomis' | 'simulated';\n}\n\n// ---- External API: Flood Risk ----\nexport interface FloodAlert {\n  areaId: string;\n  severity: 'severe-warning' | 'warning' | 'alert' | 'none';\n  severityLevel: number;\n  description: string;\n  raisedAt: string;\n  message: string;\n  source: 'defra' | 'simulated';\n}\n\n// ---- External API: Weather (enhanced) ----\nexport interface WeatherDetail {\n  date: string;\n  temperature: number;\n  humidity: number;\n  precipitation: number;\n  windSpeed: number;\n  windGust?: number;\n  dewPoint?: number;\n  weatherCode?: number;\n  dampRiskCondition: boolean;\n  source: 'open-meteo' | 'met-office' | 'simulated';\n}\n\nexport interface WeatherWarning {\n  id: string;\n  severity: 'red' | 'amber' | 'yellow';\n  type: string;\n  headline: string;\n  validFrom: string;\n  validTo: string;\n  affectedAreas: string[];\n  source: 'met-office' | 'simulated';\n}\n\n// ---- External API: IoT Sensors (mock) ----\nexport interface SensorReading {\n  sensorId: string;\n  propertyId: string;\n  timestamp: string;\n  temperature: number;\n  humidity: number;\n  moisture: number;\n  co2Level?: number;\n  source: 'switchee' | 'aico' | 'homelync' | 'simulated';\n}\n\nexport interface SensorAlert {\n  id: string;\n  sensorId: string;\n  propertyId: string;\n  type: 'high-humidity' | 'high-moisture' | 'low-temperature' | 'smoke' | 'co';\n  severity: 'critical' | 'warning' | 'info';\n  value: number;\n  threshold: number;\n  timestamp: string;\n  acknowledged: boolean;\n}\n\n// ---- External API: DWP Universal Credit (mock) ----\nexport interface UcStatus {\n  tenantId: string;\n  ucStatus: 'claiming' | 'transitioning' | 'managed-migration' | 'none';\n  claimStartDate?: string;\n  nextPaymentDate?: string;\n  estimatedAmount?: number;\n  housingElement?: number;\n  apaInPlace: boolean;\n  managedPayment: boolean;\n  source: 'dwp' | 'simulated';\n}\n\n// ---- Composite: Damp Risk Breakdown ----\nexport interface DampRiskBreakdown {\n  propertyId: string;\n  overallScore: number;\n  weatherFactor: number;\n  buildingFactor: number;\n  historyFactor: number;\n  sensorFactor: number;\n  occupancyFactor: number;\n  calculatedAt: string;\n  sources: string[];\n}\n\n// ---- Composite: Vulnerability Assessment ----\nexport interface VulnerabilityAssessment {\n  tenantId: string;\n  overallScore: number;\n  deprivationFactor: number;\n  arrearsFactor: number;\n  healthFactor: number;\n  isolationFactor: number;\n  ageFactor: number;\n  dependentsFactor: number;\n  ucTransitionFactor: number;\n  autoFlags: string[];\n  calculatedAt: string;\n  sources: string[];\n}\n","numLines":722,"startLine":1,"totalLines":722}},"sourceToolAssistantUUID":"9e7ea0ee-352b-45bc-bb18-c79f1b971ff8"}
{"parentUuid":"3e4e8861-336a-471f-bfc2-e90be99cb872","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_01B9jYAiVeVQdAmzGQ8L8x7D","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have complete knowledge of the project. The existing v3.0 documents are very comprehensive. I'll create updated v4.0 documents that refine and enhance the content, then update the EXECUTION-PLAN.md. Let me write all the documents now."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10295,"cache_read_input_tokens":83308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10295},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjrvx2gcCeEn4SVAvv","type":"assistant","uuid":"edbb2a29-f72b-499a-b353-7fb260c21ec5","timestamp":"2026-02-24T10:42:42.760Z"}
{"parentUuid":"edbb2a29-f72b-499a-b353-7fb260c21ec5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_01B9jYAiVeVQdAmzGQ8L8x7D","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RHsjk5cM8VgwNVwgKDbmGo","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 â€” SocialHomes.Ai Base Specification\n  Version: 4.0  |  Date: 2026-02-24\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision â€” transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen â€” think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000â€“20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) â€” 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) â€” 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) â€” street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) â€” 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) â€” 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works â€” an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country â†’ Region â†’ Local Authority â†’ Estate â†’ Block â†’ Core â†’ Unit â†’ Tenant\n\n    Layout:\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚                                â”‚  CONTEXT PANEL (scrollable)     â”‚\n    â”‚      MAP / 3D VIEW (60%)       â”‚  - Entity name & summary        â”‚\n    â”‚                                â”‚  - Attribute cards               â”‚\n    â”‚      Interactive Leaflet map   â”‚  - Compliance status             â”‚\n    â”‚      OR Three.js 3D building   â”‚  - KPI metrics                   â”‚\n    â”‚      depending on zoom level   â”‚  - AI insights (purple section)  â”‚\n    â”‚                                â”‚  - Children list (next level)    â”‚\n    â”‚                                â”‚  - Quick actions                  â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ Bottom bar: Level summary stats | Toggle: Map/List/3D view       â”‚\n    â”‚ Data layer toggles: Crime / Damp Risk / Compliance               â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported â†’ Diagnosed â†’ Scheduled â†’ In Progress â†’ Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text â†’ AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10â€“12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning â†’ ABC â†’ CPW â†’ CPN â†’ Injunction â†’ Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice â†’ Keys â†’ Inspection â†’ Works â†’ Quality\n      â†’ Ready â†’ Offer â†’ Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) â€” 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day â†’] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles Ã— permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging â€” timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room â†’ problem â†’ photo â†’\n      appointment â†’ confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic â€” regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational â€” SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management â€” workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY â€” appointments, calls, tasks, cases needing action\n    AI Actions: Richest set â€” holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons â€” always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons â€” only appear when AI determines they're relevant\n    - Dynamic info cards â€” contextual information the system thinks user needs\n    - Dynamic prompts â€” questions AI asks user, answering triggers workflows\n    - Dynamic warnings â€” alerts about this entity needing attention\n    - Dynamic information fields â€” calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"âœ¦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - ðŸ”´ URGENT: Items needing immediate action\n    - ðŸŸ  ATTENTION: Items approaching deadlines\n    - ðŸ’¡ INSIGHTS: AI predictions & recommendations\n    - ðŸ“Š BRIEFING: Contextual summary & key stats\n    - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0â€“100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0â€“100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0â€“100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB â€” Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection â€” 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport â€” Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow â€” pre-drafted email â†’ edit â†’ send â†’ follow-up task\n    2. \"Inbound Email Triage\" â€” AI reads â†’ categorises â†’ creates case(s)\n    3. \"Proactive Damp Prevention\" â€” weather forecast â†’ risk cross-reference\n       â†’ preventive advice letters â†’ inspection tasks\n    4. \"Compliance Cascade\" â€” batch contractor booking â†’ letters â†’ calendar\n    5. \"Complaint Prevention\" â€” pattern detection â†’ prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) â€” address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) â€” name, contact, vulnerability, household, UC status\n    - Tenancy â€” propertyâ€“tenant link, start date, type, rent, balance\n    - Case (279+ records) â€” unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) â€” SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) â€” stage, deadlines, Ombudsman reference\n    - ASB (12 records) â€” severity, escalation level, evidence log\n    - Activity â€” timeline events for any entity\n    - Task â€” assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation â€” RCHA metadata, branding, settings\n    - Region (3) â€” London, South, Midlands\n    - Local Authority â€” Southwark, Lewisham, Lambeth\n    - Estate (5) â€” name, location, block count, manager\n    - Block â€” floors, cores, unit count\n    - User â€” auth profile, role, persona, team\n    - Team â€” name, manager, patch, members\n    - Integration â€” external service config (20 integrations)\n    - Report â€” template definitions (27 reports)\n    - ExternalDataCache â€” TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) â€” purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif â€” bold, technical\n    Body: \"Inter\", Arial, sans-serif â€” clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace â€” references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default â€” Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast â‰¥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout â€” staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP Â£\n\n6.6 Component Library\n    - KpiCard â€” metric display with trend sparkline\n    - StatusPill â€” status badge (green/amber/red)\n    - ActionModal â€” accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard â€” purple-bordered AI suggestion card\n    - CountdownTimer â€” deadline countdown with color urgency transitions\n      (green â†’ peach â†’ garnet â†’ pulsing garnet)\n    - PropertyMap â€” Leaflet map with markers\n    - HelpDrawer â€” full-screen contextual help (20 topics)\n    - DampIntelligencePanel â€” damp risk factor display with score badge\n    - VulnerabilityPanel â€” 7-factor vulnerability assessment\n    - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions\n    - ProtectedRoute â€” Firebase auth guard component\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio â‰¥ 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0â€“10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social Â£95-140/week, affordable Â£140-200/week\n    Service charges: Â£5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <Â£250, 10% Â£250-500, 5% Â£500-1k, 5% >Â£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35â€“39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        â€” DONE (10/10)\n    Phase 1: Foundation            â€” DONE (12/12)\n    Phase 2: Intelligence          â€” DONE (14/14)\n    Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)\n    Phase 4: Completion            â€” DONE (11/14, 3 deferred)\n    Phase 5: Evolution             â€” TODO (0/36)\n\n================================================================================\n  End of Doc1 â€” SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-24\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10295,"cache_read_input_tokens":83308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10295},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSkjrvx2gcCeEn4SVAvv","type":"assistant","uuid":"ce25f236-1a7e-4b3f-919e-96035c3da9c0","timestamp":"2026-02-24T10:46:22.244Z"}
{"parentUuid":"ce25f236-1a7e-4b3f-919e-96035c3da9c0","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RHsjk5cM8VgwNVwgKDbmGo","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt has been updated successfully."}]},"uuid":"57e26d52-3d31-43ad-830f-8a662509129f","timestamp":"2026-02-24T10:46:22.348Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 â€” SocialHomes.Ai Base Specification\n  Version: 4.0  |  Date: 2026-02-24\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision â€” transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen â€” think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000â€“20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) â€” 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) â€” 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) â€” street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) â€” 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) â€” 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works â€” an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country â†’ Region â†’ Local Authority â†’ Estate â†’ Block â†’ Core â†’ Unit â†’ Tenant\n\n    Layout:\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚                                â”‚  CONTEXT PANEL (scrollable)     â”‚\n    â”‚      MAP / 3D VIEW (60%)       â”‚  - Entity name & summary        â”‚\n    â”‚                                â”‚  - Attribute cards               â”‚\n    â”‚      Interactive Leaflet map   â”‚  - Compliance status             â”‚\n    â”‚      OR Three.js 3D building   â”‚  - KPI metrics                   â”‚\n    â”‚      depending on zoom level   â”‚  - AI insights (purple section)  â”‚\n    â”‚                                â”‚  - Children list (next level)    â”‚\n    â”‚                                â”‚  - Quick actions                  â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ Bottom bar: Level summary stats | Toggle: Map/List/3D view       â”‚\n    â”‚ Data layer toggles: Crime / Damp Risk / Compliance               â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported â†’ Diagnosed â†’ Scheduled â†’ In Progress â†’ Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text â†’ AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10â€“12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning â†’ ABC â†’ CPW â†’ CPN â†’ Injunction â†’ Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice â†’ Keys â†’ Inspection â†’ Works â†’ Quality\n      â†’ Ready â†’ Offer â†’ Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) â€” 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day â†’] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles Ã— permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging â€” timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room â†’ problem â†’ photo â†’\n      appointment â†’ confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic â€” regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational â€” SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management â€” workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY â€” appointments, calls, tasks, cases needing action\n    AI Actions: Richest set â€” holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons â€” always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons â€” only appear when AI determines they're relevant\n    - Dynamic info cards â€” contextual information the system thinks user needs\n    - Dynamic prompts â€” questions AI asks user, answering triggers workflows\n    - Dynamic warnings â€” alerts about this entity needing attention\n    - Dynamic information fields â€” calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"âœ¦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - ðŸ”´ URGENT: Items needing immediate action\n    - ðŸŸ  ATTENTION: Items approaching deadlines\n    - ðŸ’¡ INSIGHTS: AI predictions & recommendations\n    - ðŸ“Š BRIEFING: Contextual summary & key stats\n    - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0â€“100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0â€“100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0â€“100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB â€” Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection â€” 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport â€” Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow â€” pre-drafted email â†’ edit â†’ send â†’ follow-up task\n    2. \"Inbound Email Triage\" â€” AI reads â†’ categorises â†’ creates case(s)\n    3. \"Proactive Damp Prevention\" â€” weather forecast â†’ risk cross-reference\n       â†’ preventive advice letters â†’ inspection tasks\n    4. \"Compliance Cascade\" â€” batch contractor booking â†’ letters â†’ calendar\n    5. \"Complaint Prevention\" â€” pattern detection â†’ prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) â€” address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) â€” name, contact, vulnerability, household, UC status\n    - Tenancy â€” propertyâ€“tenant link, start date, type, rent, balance\n    - Case (279+ records) â€” unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) â€” SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) â€” stage, deadlines, Ombudsman reference\n    - ASB (12 records) â€” severity, escalation level, evidence log\n    - Activity â€” timeline events for any entity\n    - Task â€” assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation â€” RCHA metadata, branding, settings\n    - Region (3) â€” London, South, Midlands\n    - Local Authority â€” Southwark, Lewisham, Lambeth\n    - Estate (5) â€” name, location, block count, manager\n    - Block â€” floors, cores, unit count\n    - User â€” auth profile, role, persona, team\n    - Team â€” name, manager, patch, members\n    - Integration â€” external service config (20 integrations)\n    - Report â€” template definitions (27 reports)\n    - ExternalDataCache â€” TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) â€” purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif â€” bold, technical\n    Body: \"Inter\", Arial, sans-serif â€” clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace â€” references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default â€” Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast â‰¥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout â€” staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP Â£\n\n6.6 Component Library\n    - KpiCard â€” metric display with trend sparkline\n    - StatusPill â€” status badge (green/amber/red)\n    - ActionModal â€” accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard â€” purple-bordered AI suggestion card\n    - CountdownTimer â€” deadline countdown with color urgency transitions\n      (green â†’ peach â†’ garnet â†’ pulsing garnet)\n    - PropertyMap â€” Leaflet map with markers\n    - HelpDrawer â€” full-screen contextual help (20 topics)\n    - DampIntelligencePanel â€” damp risk factor display with score badge\n    - VulnerabilityPanel â€” 7-factor vulnerability assessment\n    - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions\n    - ProtectedRoute â€” Firebase auth guard component\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio â‰¥ 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0â€“10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social Â£95-140/week, affordable Â£140-200/week\n    Service charges: Â£5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <Â£250, 10% Â£250-500, 5% Â£500-1k, 5% >Â£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35â€“39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        â€” DONE (10/10)\n    Phase 1: Foundation            â€” DONE (12/12)\n    Phase 2: Intelligence          â€” DONE (14/14)\n    Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)\n    Phase 4: Completion            â€” DONE (11/14, 3 deferred)\n    Phase 5: Evolution             â€” TODO (0/36)\n\n================================================================================\n  End of Doc1 â€” SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-24\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc1 â€” SocialHomes.Ai Base Specification","-  Version: 3.0  |  Date: 2026-02-23","+  Version: 4.0  |  Date: 2026-02-24","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":55,"oldLines":7,"newStart":55,"newLines":7,"lines":["     Yantra Works â€” an AI-native development studio."," "," ","-2. CORE FUNCTIONAL MODULES (16 modules)","+2. CORE FUNCTIONAL MODULES (17 modules)"," ================================================================================"," "," 2.1 Dashboard"]},{"oldStart":432,"oldLines":6,"newStart":432,"newLines":8,"lines":["     - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context","     - [Ask Yantra...] chat input at bottom"," ","+    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)","+"," 4.4 Prediction Models (8 total)","     MODEL 1: Arrears Risk","       Input: Payment history, UC status, seasonal patterns, life events"]},{"oldStart":468,"oldLines":14,"newStart":470,"newLines":34,"lines":["       Input: Certificate expiry, contractor availability, building complexity","       Output: Failure probability, priority scheduling recommendations"," ","-4.5 Seven Killer Differentiators","+4.5 Seven Killer Differentiators (All Implemented)","     D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm","+        Service: server/src/services/damp-prediction.ts","+        Frontend: DampIntelligencePanel component on property detail","+","     D2: Live Crime Context for ASB â€” Police.uk data correlation","+        Service: server/src/services/crime-context.ts","+        Frontend: Crime data layer on Explore map, ASB detail page","+","     D3: Automatic Vulnerability Detection â€” 7-factor scoring","+        Service: server/src/services/vulnerability-detection.ts","+        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan","+","     D4: Property Passport â€” Multi-source property dossier","+        Service: server/src/services/property-passport.ts","+        Frontend: Property detail page aggregation","+","     D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules","+        Service: server/src/services/benefits-engine.ts","+        Frontend: BenefitsPanel on tenancy detail","+","     D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence","+        Service: server/src/services/neighbourhood-briefing.ts","+        Frontend: NeighbourhoodBriefingPanel on briefing page","+","     D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)","+        Service: server/src/services/mock-services.ts","+        Frontend: Property detail page (sensor data display)"," "," 4.6 AI-Augmented Workflows","     - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,"]},{"oldStart":542,"oldLines":7,"newStart":564,"newLines":20,"lines":["     | Safeguarding| SAF-YYYY-XXXXX   | Purple  |","     | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |"," ","+5.5 TypeScript Type System (721 lines)","+    Frontend types defined in app/src/types/index.ts covering:","+    - 6 persona/user types (Persona, User)","+    - 7 geography types (Region, LocalAuthority, Estate, Block)","+    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)","+    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)","+    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)","+    - 8 activity/task types (Activity, Task, RentTransaction, etc.)","+    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)","+    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)","+    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)","+    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)"," ","+"," 6. USER INTERFACE DESIGN"," ================================================================================"," "]},{"oldStart":607,"oldLines":6,"newStart":642,"newLines":7,"lines":["     - VulnerabilityPanel â€” 7-factor vulnerability assessment","     - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts","     - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions","+    - ProtectedRoute â€” Firebase auth guard component"," "," "," 7. REGULATORY COMPLIANCE"]},{"oldStart":635,"oldLines":23,"newStart":671,"newLines":23,"lines":["     - Data Processing Register"," "," 7.3 Accessibility (WCAG AA)","-    - Focus traps in modals","-    - Skip-to-content link","+    - Focus traps in modals (ActionModal)","+    - Skip-to-content link (Layout component)","     - Keyboard navigation (Tab, Escape)","     - ARIA labels, roles, described-by","     - Reduced-motion media query","     - Color contrast ratio â‰¥ 4.5:1","-    - Screen-reader-only text","-    - Focus-visible outlines","+    - Screen-reader-only text (.sr-only)","+    - Focus-visible outlines (*:focus-visible)"," "," "," 8. NON-FUNCTIONAL REQUIREMENTS"," ================================================================================"," "," 8.1 Performance","-    - API response time (P95): < 500ms","-    - Frontend bundle size: < 3MB","-    - Cloud Run cold start: < 3s","+    - API response time (P95): < 500ms (current ~200-300ms)","+    - Frontend bundle size: < 3MB (current ~2.5MB)","+    - Cloud Run cold start: < 3s (current < 2s)","     - Firestore query latency: < 200ms","     - AI response latency (target): < 3s for conversational queries"," "]},{"oldStart":738,"oldLines":7,"newStart":774,"newLines":10,"lines":["     | Seeded cases              | 279+            |","     | API endpoints             | 50+             |","     | Frontend routes           | 40+             |","-    | Lines of code             | 23,852          |","+    | Lines of code             | ~24,000         |","+    | Frontend TypeScript files | 73              |","+    | Backend TypeScript files  | 43              |","+    | Type definitions          | 721 lines       |"," "," 10.3 Phase Completion","     Phase 0: Infrastructure        â€” DONE (10/10)"]},{"oldStart":746,"oldLines":9,"newStart":785,"newLines":9,"lines":["     Phase 2: Intelligence          â€” DONE (14/14)","     Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)","     Phase 4: Completion            â€” DONE (11/14, 3 deferred)","-    Phase 5: Evolution             â€” TODO (0/32)","+    Phase 5: Evolution             â€” TODO (0/36)"," "," ================================================================================","   End of Doc1 â€” SocialHomes.Ai Base Specification","-  Yantra Works | 2026-02-23","+  Yantra Works | 2026-02-24"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc1 â€” SocialHomes.Ai Base Specification\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision â€” transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen â€” think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000â€“20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) â€” 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) â€” 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) â€” street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) â€” 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) â€” 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works â€” an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (16 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country â†’ Region â†’ Local Authority â†’ Estate â†’ Block â†’ Core â†’ Unit â†’ Tenant\n\n    Layout:\n    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n    â”‚                                â”‚  CONTEXT PANEL (scrollable)     â”‚\n    â”‚      MAP / 3D VIEW (60%)       â”‚  - Entity name & summary        â”‚\n    â”‚                                â”‚  - Attribute cards               â”‚\n    â”‚      Interactive Leaflet map   â”‚  - Compliance status             â”‚\n    â”‚      OR Three.js 3D building   â”‚  - KPI metrics                   â”‚\n    â”‚      depending on zoom level   â”‚  - AI insights (purple section)  â”‚\n    â”‚                                â”‚  - Children list (next level)    â”‚\n    â”‚                                â”‚  - Quick actions                  â”‚\n    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n    â”‚ Bottom bar: Level summary stats | Toggle: Map/List/3D view       â”‚\n    â”‚ Data layer toggles: Crime / Damp Risk / Compliance               â”‚\n    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported â†’ Diagnosed â†’ Scheduled â†’ In Progress â†’ Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text â†’ AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10â€“12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning â†’ ABC â†’ CPW â†’ CPN â†’ Injunction â†’ Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice â†’ Keys â†’ Inspection â†’ Works â†’ Quality\n      â†’ Ready â†’ Offer â†’ Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) â€” 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day â†’] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles Ã— permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging â€” timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room â†’ problem â†’ photo â†’\n      appointment â†’ confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic â€” regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational â€” SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management â€” workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY â€” appointments, calls, tasks, cases needing action\n    AI Actions: Richest set â€” holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons â€” always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons â€” only appear when AI determines they're relevant\n    - Dynamic info cards â€” contextual information the system thinks user needs\n    - Dynamic prompts â€” questions AI asks user, answering triggers workflows\n    - Dynamic warnings â€” alerts about this entity needing attention\n    - Dynamic information fields â€” calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"âœ¦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - ðŸ”´ URGENT: Items needing immediate action\n    - ðŸŸ  ATTENTION: Items approaching deadlines\n    - ðŸ’¡ INSIGHTS: AI predictions & recommendations\n    - ðŸ“Š BRIEFING: Contextual summary & key stats\n    - ðŸŒ¤ï¸ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0â€“100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0â€“100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0â€“100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence â€” 5-factor weighted algorithm\n    D2: Live Crime Context for ASB â€” Police.uk data correlation\n    D3: Automatic Vulnerability Detection â€” 7-factor scoring\n    D4: Property Passport â€” Multi-source property dossier\n    D5: Benefits Entitlement Engine â€” UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing â€” Per-estate daily intelligence\n    D7: IoT Sensor Integration â€” Switchee/Aico device support (mock)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue â†’ AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow â€” pre-drafted email â†’ edit â†’ send â†’ follow-up task\n    2. \"Inbound Email Triage\" â€” AI reads â†’ categorises â†’ creates case(s)\n    3. \"Proactive Damp Prevention\" â€” weather forecast â†’ risk cross-reference\n       â†’ preventive advice letters â†’ inspection tasks\n    4. \"Compliance Cascade\" â€” batch contractor booking â†’ letters â†’ calendar\n    5. \"Complaint Prevention\" â€” pattern detection â†’ prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) â€” address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) â€” name, contact, vulnerability, household, UC status\n    - Tenancy â€” propertyâ€“tenant link, start date, type, rent, balance\n    - Case (279+ records) â€” unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) â€” SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) â€” stage, deadlines, Ombudsman reference\n    - ASB (12 records) â€” severity, escalation level, evidence log\n    - Activity â€” timeline events for any entity\n    - Task â€” assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation â€” RCHA metadata, branding, settings\n    - Region (3) â€” London, South, Midlands\n    - Local Authority â€” Southwark, Lewisham, Lambeth\n    - Estate (5) â€” name, location, block count, manager\n    - Block â€” floors, cores, unit count\n    - User â€” auth profile, role, persona, team\n    - Team â€” name, manager, patch, members\n    - Integration â€” external service config (20 integrations)\n    - Report â€” template definitions (27 reports)\n    - ExternalDataCache â€” TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) â€” purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif â€” bold, technical\n    Body: \"Inter\", Arial, sans-serif â€” clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace â€” references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default â€” Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast â‰¥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout â€” staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP Â£\n\n6.6 Component Library\n    - KpiCard â€” metric display with trend sparkline\n    - StatusPill â€” status badge (green/amber/red)\n    - ActionModal â€” accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard â€” purple-bordered AI suggestion card\n    - CountdownTimer â€” deadline countdown with color urgency transitions\n      (green â†’ peach â†’ garnet â†’ pulsing garnet)\n    - PropertyMap â€” Leaflet map with markers\n    - HelpDrawer â€” full-screen contextual help (20 topics)\n    - DampIntelligencePanel â€” damp risk factor display with score badge\n    - VulnerabilityPanel â€” 7-factor vulnerability assessment\n    - BenefitsPanel â€” entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel â€” 6 summary cards, officer briefing, actions\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio â‰¥ 4.5:1\n    - Screen-reader-only text\n    - Focus-visible outlines\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0â€“10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social Â£95-140/week, affordable Â£140-200/week\n    Service charges: Â£5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <Â£250, 10% Â£250-500, 5% Â£500-1k, 5% >Â£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35â€“39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | 23,852          |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        â€” DONE (10/10)\n    Phase 1: Foundation            â€” DONE (12/12)\n    Phase 2: Intelligence          â€” DONE (14/14)\n    Phase 3: Enrichment            â€” DONE (14/17, 3 deferred)\n    Phase 4: Completion            â€” DONE (11/14, 3 deferred)\n    Phase 5: Evolution             â€” TODO (0/32)\n\n================================================================================\n  End of Doc1 â€” SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-23\n================================================================================\n"},"sourceToolAssistantUUID":"ce25f236-1a7e-4b3f-919e-96035c3da9c0"}
{"parentUuid":"57e26d52-3d31-43ad-830f-8a662509129f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","message":{"model":"claude-opus-4-6","id":"msg_017USjPkFtTwZu8jzWAu9oJJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WjW8vJLGNqbzmZKyHtiEVh","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v4.0)","status":"completed","activeForm":"Creating Doc1 - Base Specification (v4.0)"},{"content":"Create Doc2 - Technical Architecture (v4.0)","status":"in_progress","activeForm":"Creating Doc2 - Technical Architecture (v4.0)"},{"content":"Create Doc3 - API Requirements (v4.0)","status":"pending","activeForm":"Creating Doc3 - API Requirements (v4.0)"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v4.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases (v4.0)"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9723,"cache_read_input_tokens":93603,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9723},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYSm2RHaNT53CSkVupBsf","type":"assistant","uuid":"2b626cb3-f959-44ce-b4ed-d0ef0163186b","timestamp":"2026-02-24T10:46:29.287Z"}
{"parentUuid":"2b626cb3-f959-44ce-b4ed-d0ef0163186b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WjW8vJLGNqbzmZKyHtiEVh","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"e144a9e4-3a12-4251-9358-47f37e84ad47","timestamp":"2026-02-24T10:46:29.291Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v4.0)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification (v4.0)"},{"content":"Create Doc2 - Technical Architecture (v4.0)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture (v4.0)"},{"content":"Create Doc3 - API Requirements (v4.0)","status":"pending","activeForm":"Creating Doc3 - API Requirements (v4.0)"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v4.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases (v4.0)"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v4.0)","status":"completed","activeForm":"Creating Doc1 - Base Specification (v4.0)"},{"content":"Create Doc2 - Technical Architecture (v4.0)","status":"in_progress","activeForm":"Creating Doc2 - Technical Architecture (v4.0)"},{"content":"Create Doc3 - API Requirements (v4.0)","status":"pending","activeForm":"Creating Doc3 - API Requirements (v4.0)"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v4.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases (v4.0)"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"2b626cb3-f959-44ce-b4ed-d0ef0163186b"}
{"parentUuid":"e144a9e4-3a12-4251-9358-47f37e84ad47","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"8e0a3497-db1e-4904-aab3-67095b930c27","version":"2.1.52","gitBranch":"main","slug":"shimmying-mixing-popcorn","type":"assistant","uuid":"e5403f75-8d70-41ce-b2d3-e37752def739","timestamp":"2026-02-24T10:46:29.984Z","message":{"id":"4a0e55fc-0517-4e08-81b9-a14cd3a8d746","container":null,"model":"<synthetic>","role":"assistant","stop_reason":"stop_sequence","stop_sequence":"","type":"message","usage":{"input_tokens":0,"output_tokens":0,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":null,"cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":0},"inference_geo":null,"iterations":null,"speed":null},"content":[{"type":"text","text":"You've hit your limit Â· resets 2pm (Europe/London)"}],"context_management":null},"error":"rate_limit","isApiErrorMessage":true}
