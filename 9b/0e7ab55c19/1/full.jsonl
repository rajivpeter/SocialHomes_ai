{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-18T11:37:07.743Z","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"35e4d97f-6bce-4aa0-b377-f99ce593c953","toolUseID":"35e4d97f-6bce-4aa0-b377-f99ce593c953","timestamp":"2026-02-18T11:37:07.200Z","uuid":"4bb38136-32bc-46b2-be1b-9e75573b86a7"}
{"parentUuid":"4bb38136-32bc-46b2-be1b-9e75573b86a7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"2498f4b5-075b-4239-8227-b5721d10f4e2","timestamp":"2026-02-18T11:37:07.766Z","permissionMode":"bypassPermissions"}
{"parentUuid":"2498f4b5-075b-4239-8227-b5721d10f4e2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_0141DWk1YTcRH78H1CcnShE4","type":"message","role":"assistant","content":[{"type":"text","text":"\n\nI'll start by exploring the existing project structure, reading any existing specification documents, and understanding the codebase before creating the comprehensive specification documents and execution plan."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3873,"cache_read_input_tokens":14161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3873},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFUgVqD9m9spfJ3Lq2Cg","type":"assistant","uuid":"e2cc6688-8eb0-481c-9506-ebcabcb71612","timestamp":"2026-02-18T11:45:33.903Z"}
{"parentUuid":"e2cc6688-8eb0-481c-9506-ebcabcb71612","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_0141DWk1YTcRH78H1CcnShE4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SCfQZRjdc1xEUU3pHD7E2M","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"in_progress","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"pending","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3873,"cache_read_input_tokens":14161,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3873},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFUgVqD9m9spfJ3Lq2Cg","type":"assistant","uuid":"88066be8-1bf0-443a-bfb3-309de0de6836","timestamp":"2026-02-18T11:45:36.778Z"}
{"parentUuid":"88066be8-1bf0-443a-bfb3-309de0de6836","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SCfQZRjdc1xEUU3pHD7E2M","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"18425a81-c6e7-4fd1-9786-10a5004c3b2c","timestamp":"2026-02-18T11:45:36.783Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"in_progress","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"pending","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"88066be8-1bf0-443a-bfb3-309de0de6836"}
{"parentUuid":"18425a81-c6e7-4fd1-9786-10a5004c3b2c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01Pvz5EGgyVhGXbAqc3ZWTtf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BPXzVtBTxVvrVk6u4XQ887","name":"Task","input":{"description":"Explore full project structure","prompt":"Thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. The full directory structure (all top-level files and directories, and key subdirectories)\n2. Read ALL existing specification/requirements documents: Doc1-SocialHomesAi-Base-Specification.txt, Doc2-SocialHomesAi-AI-Native-Features.txt, Doc3-Public-API-Integration-Requirements.txt\n3. Read CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md if they exist\n4. Read package.json files (root, app/, server/) for dependencies and scripts\n5. Understand the app/ directory structure (pages, components, routes, data, hooks)\n6. Understand the server/ directory structure (routes, models, middleware)\n7. Read any existing EXECUTION-PLAN.md\n8. Read any existing docs/ directory content\n\nBe very thorough - read all the key files in full. Return a comprehensive summary of everything found.","subagent_type":"Explore","max_turns":40},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":360,"cache_read_input_tokens":18034,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":360},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFUgxFwMW5mRnGi61fHK","type":"assistant","uuid":"e39ba93a-d47f-404a-914b-697a4e9c9029","timestamp":"2026-02-18T11:45:44.023Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-18T11:48:37.172Z","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","content":"{\"task_id\":\"ae82711\",\"description\":\"Explore full project structure\",\"task_type\":\"local_agent\"}"}
{"parentUuid":"e39ba93a-d47f-404a-914b-697a4e9c9029","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BPXzVtBTxVvrVk6u4XQ887","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have a comprehensive understanding of the project. Let me compile the final summary.\n\n---\n\n## COMPREHENSIVE PROJECT SUMMARY: SocialHomes.Ai\n\n### PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an **AI-native housing management platform** for UK social housing providers (housing associations and local authorities). It manages 5,000-20,000 housing units across multiple regions with intelligent case management, compliance tracking, and predictive analytics.\n\n**Creator:** Yantra.Works\n**Status:** Production-ready, deployed on Google Cloud Run\n**Tech Stack:** React 19 + Express.js + Google Firestore + Cloud Run (europe-west2)\n**Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n## KEY SPECIFICATION DOCUMENTS\n\n### 1. **Doc1-SocialHomesAi-Base-Specification.txt** (28,633 lines)\n   - **Technical Stack:** React 19, Router v7, Tailwind CSS v4, Three.js (3D), Leaflet (maps), Recharts, D3.js\n   - **Branding:** Yantra.Works dark theme with teal/peach/garnet palette\n   - **Architecture:** 7-level visual drill-down hierarchy (Country → Region → LA → Estate → Block → Unit → Tenant)\n   - **Routes:** 40+ pages covering exploration, tenancies, properties, repairs, compliance, complaints, ASB, allocations, communications, reports, AI Centre, admin, tenant portal\n   - **Core Entities:** Properties (75), Tenancies (68), Repairs (200), Complaints (34), ASB Cases (12), Tenants with unified case timeline\n   - **Simulated Org:** Riverside Crescent Housing Association (RCHA) in Southwark/Lewisham/Lambeth\n\n### 2. **Doc2-SocialHomesAi-AI-Native-Features.txt** (32,377 lines)\n   - **Dynamic AI Interface Elements:** Purple-bordered AI-generated buttons, fields, and prompts that appear contextually\n   - **5 Personas:** COO, Head of Housing, Manager, Housing Officer, Repairs Operative (persona-scoped dashboards)\n   - **Yantra Assist:** Contextual AI panel with urgent items, insights, briefing, external factors\n   - **AI Morning Briefing (`/briefing`):** Personalized daily briefing with weather, tasks, predictions\n   - **8 Prediction Models:** Arrears Risk, Damp & Mould, Complaint Escalation, Void Duration, Repair Recurrence, Vulnerability Detection, ASB Escalation, Compliance Failure\n   - **3D Digital Twin:** Three.js building visualization with floor plans, color-coded units\n   - **Admin System:** Full management suite for users, teams, workflows, integrations, audit trails\n   - **AI Action Flows:** Present → Preview → Edit → Confirm → Follow-up → Auto-create pattern\n\n### 3. **Doc3-Public-API-Integration-Requirements.txt** (98,343 lines)\n   - **3-Tier Integration Architecture:**\n     - **Tier 1 (Free, No Key):** Police.uk, Open-Meteo, DEFRA Flood Risk\n     - **Tier 2 (Registration):** Postcodes.io, OS Places, EPC Open Data, NOMIS, Census 2021, Gas Safe, Electrical Safety\n     - **Tier 3 (Subscription):** DWP UC, IoT Sensors, GoCardless, Plentific, DocuSign, Land Registry, Experian\n   - **7 Killer Differentiators:**\n     1. Predictive Damp Intelligence (5-factor weighted algorithm)\n     2. Live Crime Context for ASB (Police data correlation)\n     3. Automatic Vulnerability Detection (7-factor scoring)\n     4. Property Passport (multi-source aggregation)\n     5. Benefits Entitlement Engine (UK 2025/26 rules)\n     6. AI Neighbourhood Briefing (per-estate daily intelligence)\n     7. IoT Sensor Integration (Switchee/Aico devices)\n   - **Server-side proxy pattern:** All external API calls via `/api/v1/public-data/*`\n   - **Caching:** Firestore `externalDataCache` collection with TTL (weather 1h, crime 24h, EPC 30d, Census 90d)\n   - **Rate Limiting:** Token bucket per API, 15 req/sec fair-use compliance\n   - **Graceful Degradation:** All APIs have simulated fallbacks\n\n### 4. **Doc4-UI-UX-Audit-Build-Guide.md** (15,588 lines)\n   - Frontend audit and build guidance (existing)\n\n---\n\n## PROJECT STRUCTURE\n\n### **ROOT LEVEL**\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                          (641 MB) — React frontend\n├── server/                        (128 MB) — Express backend\n├── docs/                          (6.1 MB) — Proposal, brochure, screenshots\n├── tests/                         (77 MB) — Selenium test suite\n├── .mission-control/              (untracked) — Entire.io monitoring\n│\n├── CLAUDE.md                      — Claude Code project instructions\n├── DEVOPS.md                      — Infrastructure & deployment guide\n├── DEV-FIX-LIST.md               — Bug/warning tracker (332 tests, 99.7% pass)\n├── SESSION-HISTORY.md             — Persistent conversation log (7 sessions)\n├── EXECUTION-PLAN.md              — Multi-phase build plan (Phases 0-4 complete)\n├── TEST-REPORT-V2.md              — Comprehensive Selenium test results\n│\n├── Doc1-SocialHomesAi-Base-Specification.txt\n├── Doc2-SocialHomesAi-AI-Native-Features.txt\n├── Doc3-Public-API-Integration-Requirements.txt\n│\n├── Dockerfile                     — Multi-stage: build client, build server, production\n├── cloudbuild.yaml               — Google Cloud Build CI/CD configuration\n├── firestore.indexes.json         — Firestore composite indexes\n├── firestore.rules                — Firestore security rules\n├── .mcp.json                      — Telegram MCP bot config (not committed)\n├── .gitignore                     — Excludes node_modules, .env, secrets\n└── README.md\n```\n\n### **FRONTEND: `/app/src/` (73 TypeScript files)**\n\n**Core Structure:**\n```\napp/src/\n├── App.tsx (152 lines)            — Main router with 40+ routes\n├── main.tsx                       — Entry point\n├── index.css                      — Global styles + animations\n│\n├── pages/ (19 directories)\n│   ├── admin/                     — AdminPage, IntegrationsPage\n│   ├── ai-centre/                 — AiCentrePage (insights, predictions, assistant)\n│   ├── allocations/               — AllocationsPage (housing register, void kanban)\n│   ├── asb/                       — AsbPage, AsbDetailPage\n│   ├── auth/                      — LoginPage (Firebase + Google sign-in)\n│   ├── briefing/                  — BriefingPage (AI morning briefing)\n│   ├── communications/            — CommunicationsPage (unified inbox)\n│   ├── complaints/                — ComplaintsPage, ComplaintDetailPage\n│   ├── compliance/                — CompliancePage, ComplianceTypePage, AwaabsLawPage\n│   ├── dashboard/                 — DashboardPage (8 KPIs, charts, activity)\n│   ├── explore/                   — ExplorePage (7-level visual drill-down)\n│   ├── properties/                — PropertiesPage, PropertyDetailPage, ApplicationPage, ViewingBookingPage\n│   ├── rent/                      — RentPage (arrears dashboard, worklist, UC tracking)\n│   ├── repairs/                   — RepairsPage, RepairDetailPage (kanban + timeline)\n│   ├── reports/                   — ReportsPage, DynamicReportPage, TsmReportPage\n│   ├── search/                    — SearchPage (global search results)\n│   ├── tenancies/                 — TenanciesPage, TenancyDetailPage\n│   ├── tenant-portal/             — TenantPortalPage (self-service)\n│   └── shared/                    — ComingSoonPage\n│\n├── components/\n│   ├── layout/\n│   │   ├── Layout.tsx             — Main layout wrapper\n│   │   ├── Header.tsx             — Logo, search, notifications, user menu\n│   │   ├── Sidebar.tsx            — 14 navigation items + persona switcher\n│   │   ├── Breadcrumbs.tsx        — Hierarchy breadcrumbs\n│   │   └── YantraAssist.tsx       — AI assistant panel (bottom-left trigger)\n│   │\n│   └── shared/\n│       ├── ActionModal.tsx        — Form modal with validation (accessibility)\n│       ├── AiActionCard.tsx       — AI-generated dynamic action display\n│       ├── BenefitsPanel.tsx      — Entitlement list with status icons\n│       ├── CountdownTimer.tsx     — Deadline countdown with color urgency\n│       ├── DampIntelligencePanel.tsx — Score badge, factor bars\n│       ├── HelpDrawer.tsx         — Full-screen contextual help (20 topics)\n│       ├── KpiCard.tsx            — Key metric card with trends\n│       ├── NeighbourhoodBriefingPanel.tsx — 6 summary cards per estate\n│       ├── PropertyMap.tsx        — Leaflet map with markers/layers\n│       ├── ProtectedRoute.tsx     — Auth guard\n│       ├── StatusPill.tsx         — Status badge (compliant/warning/critical)\n│       └── VulnerabilityPanel.tsx — 7-factor assessment display\n│\n├── data/ (10 files)\n│   ├── cases.ts                   — Mock complaint, repair, ASB, financial cases\n│   ├── estates.ts                 — 5 estates with full hierarchy\n│   ├── generated-cases.ts         — Generated case data (279 cases)\n│   ├── generated-repairs.ts       — Generated repair data (200 repairs)\n│   ├── help-content.ts            — 20 help topic definitions\n│   ├── organisation.ts            — Org metadata (RCHA)\n│   ├── properties.ts              — 75 properties with UPRNs, EPCs, compliance\n│   ├── regions.ts                 — 3 regions (London, South, Midlands)\n│   ├── tenants.ts                 — 68 tenants with household, vulnerability\n│   ├── supplementary.ts           — Contracts, compliance patterns\n│   └── index.ts                   — Data export index\n│\n├── hooks/ (3 files)\n│   ├── useApi.ts                  — React Query hooks for all API endpoints\n│   ├── useEntityIntelligence.ts   — AI scoring & predictions\n│   └── usePersonaScope.ts         — Persona-scoped data filtering\n│\n├── types/\n│   └── index.ts (721 lines)       — Complete type definitions\n│       ├── Persona (5 types)\n│       ├── User, Region, LocalAuthority, Estate, Block\n│       ├── Property, Block, Unit, Tenant, HouseholdMember\n│       ├── Case (unified), Repair, Complaint, AsbCase, FinancialCase, DampMouldCase\n│       ├── Activity, Task, RentTransaction, ServiceCharge\n│       ├── Integration, Report, CrimeIncident\n│       ├── DampRiskScore, VulnerabilityScore, BenefitsCheck, PropertyPassport\n│       └── NeighbourhoodBriefing, ExternalDataCache\n│\n├── services/\n│   ├── api-client.ts              — HTTP client with 70+ API methods\n│   └── public-data.ts             — Frontend fetch helpers for external APIs\n│\n├── contexts/ (2 files)\n│   └── Auth context, User context\n│\n├── utils/\n│   └── Utility helpers (date formatting, text safety, etc.)\n│\n├── assets/\n│   └── Images, fonts\n│\n└── package.json\n    ├── React 19, React Router v7, TypeScript 5.9\n    ├── @react-three/fiber (3D), Three.js\n    ├── @react-three/drei (3D helpers)\n    ├── React Leaflet (maps)\n    ├── Recharts (charts)\n    ├── D3.js, Lucide React (icons)\n    ├── @tanstack/react-query (data fetching)\n    ├── Firebase, FirebaseUI (auth)\n    ├── Tailwind CSS v4\n    └── Vite build tool\n```\n\n---\n\n### **BACKEND: `/server/src/` (43 TypeScript files, 2,971 lines)**\n\n**Core Structure:**\n```\nserver/src/\n├── index.ts (191 lines)           — Express server entry point, route registration\n│\n├── middleware/ (5 files)\n│   ├── auth.ts                    — Firebase token verification\n│   ├── error-handler.ts           — Structured JSON error logging\n│   ├── metrics.ts                 — Request/response metrics tracking\n│   ├── rate-limiter.ts            — Sliding window rate limiting (4 tiers)\n│   └── rbac.ts                    — Role-based access control\n│\n├── routes/ (16 files, 2,300+ lines)\n│   ├── admin.ts                   — /api/v1/admin/* (integrations, monitoring)\n│   ├── ai.ts                      — /api/v1/ai/* (14 AI endpoints: damp, crime, vulnerability, benefits, passport, briefing)\n│   ├── auth.ts                    — /api/v1/auth/* (login, register, logout)\n│   ├── briefing.ts                — /api/v1/briefing/* (personalised morning briefing)\n│   ├── booking.ts                 — /api/v1/booking/* (viewing bookings, applications)\n│   ├── cases.ts                   — /api/v1/cases/* (unified case CRUD + pagination)\n│   ├── compliance.ts              — /api/v1/compliance/* (Big 6 compliance)\n│   ├── explore.ts                 — /api/v1/explore/* (hierarchy drill-down data)\n│   ├── export.ts                  — /api/v1/export/* (CSV/PDF exports)\n│   ├── lettings.ts                — /api/v1/lettings/* (void management, allocations)\n│   ├── properties.ts              — /api/v1/properties/* (property list, detail)\n│   ├── public-data.ts (22KB)      — /api/v1/public-data/* (Tier 1-2 API proxy)\n│   ├── public-data.test.ts (29KB) — 66 unit tests for public data APIs\n│   ├── rent.ts                    — /api/v1/rent/* (arrears, statements, transactions)\n│   ├── reports.ts                 — /api/v1/reports/* (27 regulatory reports)\n│   └── tenants.ts                 — /api/v1/tenants/* (tenant list, detail)\n│\n├── services/ (20 files)\n│   ├── external-api.ts            — Cache-through, rate limiting, audit logging\n│   ├── firestore.ts               — Firestore connection + query helpers\n│   ├── firebase-admin.ts          — Firebase Admin initialization\n│   │\n│   ├── 7 KILLER DIFFERENTIATOR SERVICES:\n│   │   ├── damp-prediction.ts     — 5-factor damp risk algorithm (weather, building, history, sensors, occupancy)\n│   │   ├── crime-context.ts       — Police API correlation with ASB cases + hotspot analysis\n│   │   ├── vulnerability-detection.ts — 7-factor vulnerability scoring\n│   │   ├── benefits-engine.ts     — UK 2025/26 benefit rules (UC, PIP, AA, Pension Credit)\n│   │   ├── property-passport.ts   — Multi-source property dossier aggregation\n│   │   ├── neighbourhood-briefing.ts — Per-estate daily briefing combining all sources\n│   │   └── govuk-notify.ts        — 24 templates across 7 categories with personalisation\n│   │\n│   ├── census-nomis.ts            — Census 2021 + NOMIS labour market APIs\n│   ├── mock-services.ts           — 5 mock endpoints (repairs marketplace, regulatory, signing, referencing, land registry)\n│   ├── monitoring.ts              — Metrics singleton (request counts, latency, status codes)\n│   ├── hact-export.ts             — HACT reporting format\n│   ├── seed.ts, seed-data.ts      — Database seeding (75 properties, 68 tenants, 460+ docs)\n│   └── hact-codes.ts              — Repair SOR code definitions\n│\n├── models/\n│   ├── firestore-schemas.ts       — TypeScript schema definitions for Firestore collections\n│   └── hact-codes.ts\n│\n├── scripts/\n│   ├── seed-imd.ts                — IMD (Index of Multiple Deprivation) data loading\n│   └── seed.ts                    — Main seed runner\n│\n└── package.json\n    ├── Express 4, TypeScript 5.7, Node.js 20\n    ├── @google-cloud/firestore\n    ├── firebase-admin\n    ├── Helmet (security headers)\n    ├── CORS, Compression, Morgan (logging)\n    ├── Vitest (testing)\n    └── tsx, TSC (build tools)\n```\n\n**API Routes Summary (50+ endpoints):**\n- `/health` — Health check with Firestore connectivity\n- `/api/v1/auth/*` — Authentication (Firebase)\n- `/api/v1/briefing/*` — Personalised briefing\n- `/api/v1/cases/*` — Case CRUD (repair, complaint, ASB, financial, damp-mould)\n- `/api/v1/compliance/*` — Big 6 compliance data\n- `/api/v1/explore/*` — 7-level hierarchy data\n- `/api/v1/properties/*` — Property list/detail\n- `/api/v1/tenants/*` — Tenant list/detail\n- `/api/v1/rent/*` — Arrears, statements, transactions\n- `/api/v1/reports/*` — 27 regulatory reports\n- `/api/v1/ai/*` — Damp, crime, vulnerability, benefits, passport, briefing\n- `/api/v1/public-data/*` — Police, postcodes, EPC, NOMIS, Gas Safe, Electrical, weather\n- `/api/v1/admin/*` — Integrations, monitoring, audit logs\n- `/api/v1/booking/*` — Viewing bookings, applications\n\n**Firestore Collections (17 total):**\n- `users`, `properties`, `tenants`, `cases`, `activities`, `tasks`\n- `repairs`, `complaints`, `asb`, `financial`, `damp-mould`\n- `organisations`, `teams`, `integrations`, `auditLog`\n- `externalDataCache` — TTL-based external API cache\n\n---\n\n## CURRENT STATUS\n\n### **BUILD & DEPLOYMENT**\n- ✅ **TypeScript:** 0 errors (both app & server)\n- ✅ **Vite Build:** 3,397 modules, 35-39 seconds\n- ✅ **Docker:** Multi-stage Dockerfile (build client, build server, production)\n- ✅ **Cloud Run:** Deployed at `https://socialhomes-587984201316.europe-west2.run.app`\n- ✅ **Firestore:** Live database with 460+ documents across 17 collections\n- ✅ **CI/CD:** Cloud Build auto-triggers on `git push origin main`\n\n### **PHASES COMPLETED**\n1. **Phase 0 — Infrastructure** ✅ (7 sessions, Entire.io CLI, Telegram MCP, documentation)\n2. **Phase 1 — Foundation** ✅ (Tier 1 APIs, external data caching, IMD integration)\n3. **Phase 2 — Intelligence** ✅ (7 killer differentiators, AI services, frontend panels)\n4. **Phase 3 — Enrichment** ✅ (GOV.UK Notify templates, Census/NOMIS, accessibility fixes)\n5. **Phase 4 — Completion** ✅ (Mock services, admin dashboard, security hardening, monitoring)\n\n### **TEST RESULTS**\n- **Selenium:** 332 tests, 331 PASS (99.7% pass rate)\n- **Unit Tests:** 66 tests for public data APIs (external-api.test.ts, public-data.test.ts)\n- **All Warnings:** Resolved (WARN-001 through WARN-011)\n- **All Bugs:** Resolved (BUG-001 through BUG-004)\n\n### **PRODUCTION READINESS**\n- ✅ **Security:** CSP, CORS whitelist, rate limiting (4 tiers), security headers, no secrets in code\n- ✅ **Monitoring:** Metrics middleware, health checks, structured error logging\n- ✅ **Accessibility:** WCAG AA (focus traps, skip links, reduced motion, ARIA labels)\n- ✅ **Performance:** P95 response < 500ms, bundle < 3MB, cold start < 3s\n- ✅ **Data:** 75 properties, 68 tenants, 279 cases, realistic SE London postcodes\n\n### **UNTRACKED FILES** (not committed)\n- `.mission-control/` — Entire.io monitoring snapshots\n- `docs/Proposal-Content-Draft.md` — Draft proposal\n- `docs/ProposalSocialHomesAi.docx` — Formal proposal document\n\n---\n\n## KEY FEATURES IMPLEMENTED\n\n### **Visual Drill-Down Hierarchy** (7 levels)\n- Country → Region → LA → Estate → Block → Core → Unit → Tenant\n- Leaflet map + Three.js 3D building visualization\n- Context panel with attributes, KPIs, compliance, AI insights\n- Color-coded units (green/amber/red/purple by status)\n\n### **AI-Native Elements**\n- **Dynamic AI Actions:** Context-sensitive buttons on every entity\n- **Yantra Assist Panel:** Purple-bordered panel with urgent items, insights, briefing, external factors\n- **AI Morning Briefing:** Personalized daily greeting with weather, tasks, predictions\n- **Countdown Timers:** Awaab's Law, complaint deadlines, compliance expiry (color-coded urgency)\n- **Prediction Models:** 8 predictive algorithms (arrears, damp, complaints, voids, repairs, vulnerability, ASB, compliance)\n\n### **Case Management**\n- **Unified Case Timeline:** All case types (repair, complaint, ASB, financial, damp-mould, safeguarding, enquiry)\n- **Repair:** Priority-based SLA, appointment booking, operative notes, photos, satisfaction survey\n- **Complaint:** Two-stage timeline with 5WD/10WD/20WD deadlines, Ombudsman escalation\n- **ASB:** Escalation pipeline (warning → ABC → CPW → CPN → injunction → possession), evidence log\n- **Financial:** Arrears reason, payment arrangement, Pre-Action Protocol checklist\n- **Damp/Mould:** Awaab's Law compliance with emergency (24h) and significant (10-12 week) timers\n\n### **Compliance Management**\n- **Big 6 Dashboard:** Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n- **Awaab's Law:** Active cases with countdown timers, risk register, proactive inspection programme\n- **Certificates:** CP12 (gas), EICR (electrical), FRA (fire), asbestos register, EPC, lifts (LOLER)\n- **Building-Level:** Fire Risk Assessment, Building Safety Case, communal systems\n- **Unit-Level:** Gas Safety, EICR, EPC, smoke/CO alarms, boiler, Decent Homes, stock condition\n\n### **Tenant Management**\n- **Hierarchy:** Household members, emergency contact, vulnerability flags\n- **Rent Account:** Balance (color-coded), weekly charge, payment method, UC/HB status\n- **Transaction Ledger:** 52-week statement view, balance trend chart\n- **Cases Timeline:** Chronological log of all linked cases with SLA countdowns\n- **Vulnerability Detection:** 7-factor AI scoring (deprivation, arrears, health, isolation, age, dependents, UC)\n\n### **Admin System** (Complete)\n- **Organisation Management:** Profile, branding, operational parameters\n- **User Management:** RBAC with 10 default roles, 2FA, user impersonation\n- **Team & Patch Management:** Hierarchies, caseload balancing, cover/absence\n- **Workflow Engine:** Visual builder with triggers, conditions, actions (simulated)\n- **Integration Hub:** 20 integrations across 3 tiers with toggle, test, status\n- **Audit & Compliance:** Full audit trail, GDPR tools (SAR, erasure, retention)\n- **System Configuration:** Reference data, form builder, notification config, AI config\n\n### **External API Integrations**\n- **Tier 1 (Free, No Key):** Police.uk (crime/ASB), Open-Meteo (weather), DEFRA (flood risk)\n- **Tier 2 (Registration):** Postcodes.io, EPC Open Data, NOMIS (Census, labour market), Gas Safe, Electrical Safety\n- **Tier 3 (Subscription/Mock):** DWP UC, IoT Sensors, GoCardless, Plentific, DocuSign, Land Registry, Experian\n- **Caching:** Firestore `externalDataCache` with TTL (weather 1h, crime 24h, EPC 30d, Census 90d)\n- **Rate Limiting:** Token bucket per API, fair-use compliance\n- **Graceful Degradation:** Simulated fallbacks for all APIs\n\n### **Reports & Analytics**\n- **27 Reports:** TSM (22 measures), CORE lettings/sales, Consumer Standards, Ombudsman, BSA\n- **Dashboards:** Repairs, voids, arrears, complaints, ASB, compliance, financial\n- **Trending:** 12-month charts, band movement, payment method breakdown\n- **Benchmarking:** Targets, previous period, sector medians/quartiles\n\n### **Tenant Portal**\n- **Distinct UI:** Lighter/warmer theme, larger text, simple layout\n- **Self-Service:** Report repair (conversational wizard), check rent balance, make payment\n- **Active Repairs:** List with photos and status\n- **Contact:** Message housing officer, access documents\n\n---\n\n## TECHNOLOGY STACK\n\n| Component | Technology |\n|-----------|-----------|\n| **Frontend Framework** | React 19 with TypeScript 5.9 |\n| **Frontend Router** | React Router v7 with nested routes |\n| **Styling** | Tailwind CSS v4 (dark theme, Yantra.Works brand palette) |\n| **State Management** | React Context + useReducer (local state in components) |\n| **Data Fetching** | @tanstack/react-query (caching, polling, mutations) |\n| **3D Visualization** | Three.js r128 via @react-three/fiber |\n| **Maps** | Leaflet 1.9 + React Leaflet (OpenStreetMap tiles, no API key) |\n| **Charts** | Recharts (KPIs, trends), D3.js (Sankey, heatmaps) |\n| **Icons** | Lucide React (60+ icons) |\n| **Authentication** | Firebase Auth with FirebaseUI drop-in widget |\n| **Backend Framework** | Express.js 4 with TypeScript 5.7 |\n| **Database** | Google Firestore (NoSQL, 17 collections) |\n| **Hosting** | Google Cloud Run (europe-west2, min-instances=0, max=10) |\n| **Build Tool** | Vite 7.2 (frontend), tsc (backend) |\n| **CI/CD** | Google Cloud Build (auto-trigger on git push) |\n| **Testing** | Selenium (E2E), Vitest (unit), Jest (frontend) |\n| **Security** | Helmet, CORS whitelist, CSP, rate limiting, secret manager |\n| **Monitoring** | Custom metrics middleware, health checks, structured logging |\n| **Documentation** | 4 specification documents (6,200+ lines), session history |\n\n---\n\n## KEY FILES & LINE COUNTS\n\n| File/Module | Lines | Purpose |\n|------------|-------|---------|\n| `app/src/types/index.ts` | 721 | Complete type definitions (Persona, User, Property, Case, etc.) |\n| `server/src/routes/public-data.ts` | 700+ | Tier 1-2 API proxy (police, postcodes, EPC, weather, etc.) |\n| `server/src/routes/public-data.test.ts` | 850+ | 66 unit tests for public data APIs |\n| `server/src/routes/ai.ts` | 450+ | 14 AI endpoints (damp, crime, vulnerability, benefits, passport, briefing) |\n| `server/src/routes/admin.ts` | 380+ | Integration management, monitoring, audit |\n| `server/src/services/damp-prediction.ts` | 250+ | 5-factor damp risk algorithm |\n| `server/src/services/govuk-notify.ts` | 1,257 | 24 templates with personalisation |\n| `server/src/services/census-nomis.ts` | 493 | Census 2021 + NOMIS labour market |\n| `server/src/index.ts` | 191 | Express server entry point |\n| `app/src/App.tsx` | 152 | Main router with 40+ routes |\n| `app/src/pages/explore/ExplorePage.tsx` | 400+ | 7-level visual drill-down |\n| `app/src/pages/dashboard/DashboardPage.tsx` | 300+ | 8 KPIs, charts, activity feed |\n| `app/src/pages/admin/IntegrationsPage.tsx` | 329 | Integration dashboard |\n| `app/src/hooks/useApi.ts` | 200+ | 70+ React Query hooks |\n| `EXECUTION-PLAN.md` | 200 | 4-phase build plan (all complete) |\n| `SESSION-HISTORY.md` | 360 | 7 session conversation log |\n| `DEV-FIX-LIST.md` | 72 | Test results (332 tests, 99.7% pass) |\n| `DEVOPS.md` | 850+ | Infrastructure, CI/CD, security, monitoring |\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Actual |\n|--------|--------|--------|\n| **Selenium Test Pass Rate** | > 98% | 99.7% (331/332) |\n| **TypeScript Errors** | 0 | 0 ✅ |\n| **Vite Build Warnings** | 0 critical | 0 ✅ |\n| **API Response Time (P95)** | < 500ms | ~200-300ms |\n| **WCAG AA Compliance** | 100% | 100% (focus, contrast, keyboard, ARIA) ✅ |\n| **External API Uptime** | > 99.5% | 100% (with fallbacks) ✅ |\n| **Bundle Size** | < 3MB | 2.5-3MB ✅ |\n| **Cloud Run Cold Start** | < 3s | < 2s ✅ |\n| **Firestore Collections** | 17 | 17 ✅ |\n| **Live Properties** | 75 | 75 ✅ |\n| **Live Tenants** | 68 | 68 ✅ |\n| **Live Cases** | 279+ | 279+ ✅ |\n\n---\n\n## RECENT COMMITS (Last 20)\n\n```\ne023532 fix: make help drawer full-screen with centered content layout\n07d6845 fix: widen help drawer to half viewport for better readability\n9634838 feat: Phase 4 Completion — mock services, admin dashboard, security, monitoring\ne4aa674 feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility\n4ce6faa feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels\n8aae118 fix: resolve all 3 remaining warnings — search, map popups, API pagination\ne5054ac fix: solid opaque background for help drawer, expand first 3 topics\ne40f706 fix: update test suite for new Cloud Run URL and Firebase Auth login\ne777c4f feat: rebuild help system as left drawer with comprehensive user guide\nb4cdd4a feat: add end-to-end viewing bookings, applications, and property map\n0d1407e fix: tenancies search now matches name, address, and tenant ID\n4131b12 docs: add product brochure with page screenshots\n43ca6ac feat: complete Phase 1 — tests, help system, IMD seed, route fix\n6cdbcb2 feat: add Firestore database integration with seed script\n```\n\n---\n\n## NEXT STEPS (From EXECUTION-PLAN.md)\n\n**Deferred Tasks (optional enhancements):**\n- Met Office DataHub registration (Open-Meteo is sufficient)\n- OS Places/Maps PSGA registration (OpenStreetMap tiles are sufficient)\n- Twilio integration (GOV.UK Notify is preferred)\n- Full regression test suite (Phase 4+ task)\n- Load testing at 100 concurrent users (Phase 4+ task)\n- API reference documentation (Phase 4+ task)\n\n**All critical phases (0-4) are COMPLETE and PRODUCTION-READY.**\n\n---\n\nThis comprehensive summary covers the entire SocialHomes.Ai project from architecture to deployment. The application is fully functional, deployed on Cloud Run, integrated with Google Firestore, and ready for ongoing feature development and scaling."},{"type":"text","text":"agentId: ae82711 (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 77844\ntool_uses: 38\nduration_ms: 183985</usage>"}]}]},"uuid":"96a5a692-8f1d-4d0e-81b4-245e5fc3d82e","timestamp":"2026-02-18T11:51:41.155Z","toolUseResult":{"status":"completed","prompt":"Thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. The full directory structure (all top-level files and directories, and key subdirectories)\n2. Read ALL existing specification/requirements documents: Doc1-SocialHomesAi-Base-Specification.txt, Doc2-SocialHomesAi-AI-Native-Features.txt, Doc3-Public-API-Integration-Requirements.txt\n3. Read CLAUDE.md, SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md if they exist\n4. Read package.json files (root, app/, server/) for dependencies and scripts\n5. Understand the app/ directory structure (pages, components, routes, data, hooks)\n6. Understand the server/ directory structure (routes, models, middleware)\n7. Read any existing EXECUTION-PLAN.md\n8. Read any existing docs/ directory content\n\nBe very thorough - read all the key files in full. Return a comprehensive summary of everything found.","agentId":"ae82711","content":[{"type":"text","text":"Perfect! Now I have a comprehensive understanding of the project. Let me compile the final summary.\n\n---\n\n## COMPREHENSIVE PROJECT SUMMARY: SocialHomes.Ai\n\n### PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an **AI-native housing management platform** for UK social housing providers (housing associations and local authorities). It manages 5,000-20,000 housing units across multiple regions with intelligent case management, compliance tracking, and predictive analytics.\n\n**Creator:** Yantra.Works\n**Status:** Production-ready, deployed on Google Cloud Run\n**Tech Stack:** React 19 + Express.js + Google Firestore + Cloud Run (europe-west2)\n**Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n## KEY SPECIFICATION DOCUMENTS\n\n### 1. **Doc1-SocialHomesAi-Base-Specification.txt** (28,633 lines)\n   - **Technical Stack:** React 19, Router v7, Tailwind CSS v4, Three.js (3D), Leaflet (maps), Recharts, D3.js\n   - **Branding:** Yantra.Works dark theme with teal/peach/garnet palette\n   - **Architecture:** 7-level visual drill-down hierarchy (Country → Region → LA → Estate → Block → Unit → Tenant)\n   - **Routes:** 40+ pages covering exploration, tenancies, properties, repairs, compliance, complaints, ASB, allocations, communications, reports, AI Centre, admin, tenant portal\n   - **Core Entities:** Properties (75), Tenancies (68), Repairs (200), Complaints (34), ASB Cases (12), Tenants with unified case timeline\n   - **Simulated Org:** Riverside Crescent Housing Association (RCHA) in Southwark/Lewisham/Lambeth\n\n### 2. **Doc2-SocialHomesAi-AI-Native-Features.txt** (32,377 lines)\n   - **Dynamic AI Interface Elements:** Purple-bordered AI-generated buttons, fields, and prompts that appear contextually\n   - **5 Personas:** COO, Head of Housing, Manager, Housing Officer, Repairs Operative (persona-scoped dashboards)\n   - **Yantra Assist:** Contextual AI panel with urgent items, insights, briefing, external factors\n   - **AI Morning Briefing (`/briefing`):** Personalized daily briefing with weather, tasks, predictions\n   - **8 Prediction Models:** Arrears Risk, Damp & Mould, Complaint Escalation, Void Duration, Repair Recurrence, Vulnerability Detection, ASB Escalation, Compliance Failure\n   - **3D Digital Twin:** Three.js building visualization with floor plans, color-coded units\n   - **Admin System:** Full management suite for users, teams, workflows, integrations, audit trails\n   - **AI Action Flows:** Present → Preview → Edit → Confirm → Follow-up → Auto-create pattern\n\n### 3. **Doc3-Public-API-Integration-Requirements.txt** (98,343 lines)\n   - **3-Tier Integration Architecture:**\n     - **Tier 1 (Free, No Key):** Police.uk, Open-Meteo, DEFRA Flood Risk\n     - **Tier 2 (Registration):** Postcodes.io, OS Places, EPC Open Data, NOMIS, Census 2021, Gas Safe, Electrical Safety\n     - **Tier 3 (Subscription):** DWP UC, IoT Sensors, GoCardless, Plentific, DocuSign, Land Registry, Experian\n   - **7 Killer Differentiators:**\n     1. Predictive Damp Intelligence (5-factor weighted algorithm)\n     2. Live Crime Context for ASB (Police data correlation)\n     3. Automatic Vulnerability Detection (7-factor scoring)\n     4. Property Passport (multi-source aggregation)\n     5. Benefits Entitlement Engine (UK 2025/26 rules)\n     6. AI Neighbourhood Briefing (per-estate daily intelligence)\n     7. IoT Sensor Integration (Switchee/Aico devices)\n   - **Server-side proxy pattern:** All external API calls via `/api/v1/public-data/*`\n   - **Caching:** Firestore `externalDataCache` collection with TTL (weather 1h, crime 24h, EPC 30d, Census 90d)\n   - **Rate Limiting:** Token bucket per API, 15 req/sec fair-use compliance\n   - **Graceful Degradation:** All APIs have simulated fallbacks\n\n### 4. **Doc4-UI-UX-Audit-Build-Guide.md** (15,588 lines)\n   - Frontend audit and build guidance (existing)\n\n---\n\n## PROJECT STRUCTURE\n\n### **ROOT LEVEL**\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                          (641 MB) — React frontend\n├── server/                        (128 MB) — Express backend\n├── docs/                          (6.1 MB) — Proposal, brochure, screenshots\n├── tests/                         (77 MB) — Selenium test suite\n├── .mission-control/              (untracked) — Entire.io monitoring\n│\n├── CLAUDE.md                      — Claude Code project instructions\n├── DEVOPS.md                      — Infrastructure & deployment guide\n├── DEV-FIX-LIST.md               — Bug/warning tracker (332 tests, 99.7% pass)\n├── SESSION-HISTORY.md             — Persistent conversation log (7 sessions)\n├── EXECUTION-PLAN.md              — Multi-phase build plan (Phases 0-4 complete)\n├── TEST-REPORT-V2.md              — Comprehensive Selenium test results\n│\n├── Doc1-SocialHomesAi-Base-Specification.txt\n├── Doc2-SocialHomesAi-AI-Native-Features.txt\n├── Doc3-Public-API-Integration-Requirements.txt\n│\n├── Dockerfile                     — Multi-stage: build client, build server, production\n├── cloudbuild.yaml               — Google Cloud Build CI/CD configuration\n├── firestore.indexes.json         — Firestore composite indexes\n├── firestore.rules                — Firestore security rules\n├── .mcp.json                      — Telegram MCP bot config (not committed)\n├── .gitignore                     — Excludes node_modules, .env, secrets\n└── README.md\n```\n\n### **FRONTEND: `/app/src/` (73 TypeScript files)**\n\n**Core Structure:**\n```\napp/src/\n├── App.tsx (152 lines)            — Main router with 40+ routes\n├── main.tsx                       — Entry point\n├── index.css                      — Global styles + animations\n│\n├── pages/ (19 directories)\n│   ├── admin/                     — AdminPage, IntegrationsPage\n│   ├── ai-centre/                 — AiCentrePage (insights, predictions, assistant)\n│   ├── allocations/               — AllocationsPage (housing register, void kanban)\n│   ├── asb/                       — AsbPage, AsbDetailPage\n│   ├── auth/                      — LoginPage (Firebase + Google sign-in)\n│   ├── briefing/                  — BriefingPage (AI morning briefing)\n│   ├── communications/            — CommunicationsPage (unified inbox)\n│   ├── complaints/                — ComplaintsPage, ComplaintDetailPage\n│   ├── compliance/                — CompliancePage, ComplianceTypePage, AwaabsLawPage\n│   ├── dashboard/                 — DashboardPage (8 KPIs, charts, activity)\n│   ├── explore/                   — ExplorePage (7-level visual drill-down)\n│   ├── properties/                — PropertiesPage, PropertyDetailPage, ApplicationPage, ViewingBookingPage\n│   ├── rent/                      — RentPage (arrears dashboard, worklist, UC tracking)\n│   ├── repairs/                   — RepairsPage, RepairDetailPage (kanban + timeline)\n│   ├── reports/                   — ReportsPage, DynamicReportPage, TsmReportPage\n│   ├── search/                    — SearchPage (global search results)\n│   ├── tenancies/                 — TenanciesPage, TenancyDetailPage\n│   ├── tenant-portal/             — TenantPortalPage (self-service)\n│   └── shared/                    — ComingSoonPage\n│\n├── components/\n│   ├── layout/\n│   │   ├── Layout.tsx             — Main layout wrapper\n│   │   ├── Header.tsx             — Logo, search, notifications, user menu\n│   │   ├── Sidebar.tsx            — 14 navigation items + persona switcher\n│   │   ├── Breadcrumbs.tsx        — Hierarchy breadcrumbs\n│   │   └── YantraAssist.tsx       — AI assistant panel (bottom-left trigger)\n│   │\n│   └── shared/\n│       ├── ActionModal.tsx        — Form modal with validation (accessibility)\n│       ├── AiActionCard.tsx       — AI-generated dynamic action display\n│       ├── BenefitsPanel.tsx      — Entitlement list with status icons\n│       ├── CountdownTimer.tsx     — Deadline countdown with color urgency\n│       ├── DampIntelligencePanel.tsx — Score badge, factor bars\n│       ├── HelpDrawer.tsx         — Full-screen contextual help (20 topics)\n│       ├── KpiCard.tsx            — Key metric card with trends\n│       ├── NeighbourhoodBriefingPanel.tsx — 6 summary cards per estate\n│       ├── PropertyMap.tsx        — Leaflet map with markers/layers\n│       ├── ProtectedRoute.tsx     — Auth guard\n│       ├── StatusPill.tsx         — Status badge (compliant/warning/critical)\n│       └── VulnerabilityPanel.tsx — 7-factor assessment display\n│\n├── data/ (10 files)\n│   ├── cases.ts                   — Mock complaint, repair, ASB, financial cases\n│   ├── estates.ts                 — 5 estates with full hierarchy\n│   ├── generated-cases.ts         — Generated case data (279 cases)\n│   ├── generated-repairs.ts       — Generated repair data (200 repairs)\n│   ├── help-content.ts            — 20 help topic definitions\n│   ├── organisation.ts            — Org metadata (RCHA)\n│   ├── properties.ts              — 75 properties with UPRNs, EPCs, compliance\n│   ├── regions.ts                 — 3 regions (London, South, Midlands)\n│   ├── tenants.ts                 — 68 tenants with household, vulnerability\n│   ├── supplementary.ts           — Contracts, compliance patterns\n│   └── index.ts                   — Data export index\n│\n├── hooks/ (3 files)\n│   ├── useApi.ts                  — React Query hooks for all API endpoints\n│   ├── useEntityIntelligence.ts   — AI scoring & predictions\n│   └── usePersonaScope.ts         — Persona-scoped data filtering\n│\n├── types/\n│   └── index.ts (721 lines)       — Complete type definitions\n│       ├── Persona (5 types)\n│       ├── User, Region, LocalAuthority, Estate, Block\n│       ├── Property, Block, Unit, Tenant, HouseholdMember\n│       ├── Case (unified), Repair, Complaint, AsbCase, FinancialCase, DampMouldCase\n│       ├── Activity, Task, RentTransaction, ServiceCharge\n│       ├── Integration, Report, CrimeIncident\n│       ├── DampRiskScore, VulnerabilityScore, BenefitsCheck, PropertyPassport\n│       └── NeighbourhoodBriefing, ExternalDataCache\n│\n├── services/\n│   ├── api-client.ts              — HTTP client with 70+ API methods\n│   └── public-data.ts             — Frontend fetch helpers for external APIs\n│\n├── contexts/ (2 files)\n│   └── Auth context, User context\n│\n├── utils/\n│   └── Utility helpers (date formatting, text safety, etc.)\n│\n├── assets/\n│   └── Images, fonts\n│\n└── package.json\n    ├── React 19, React Router v7, TypeScript 5.9\n    ├── @react-three/fiber (3D), Three.js\n    ├── @react-three/drei (3D helpers)\n    ├── React Leaflet (maps)\n    ├── Recharts (charts)\n    ├── D3.js, Lucide React (icons)\n    ├── @tanstack/react-query (data fetching)\n    ├── Firebase, FirebaseUI (auth)\n    ├── Tailwind CSS v4\n    └── Vite build tool\n```\n\n---\n\n### **BACKEND: `/server/src/` (43 TypeScript files, 2,971 lines)**\n\n**Core Structure:**\n```\nserver/src/\n├── index.ts (191 lines)           — Express server entry point, route registration\n│\n├── middleware/ (5 files)\n│   ├── auth.ts                    — Firebase token verification\n│   ├── error-handler.ts           — Structured JSON error logging\n│   ├── metrics.ts                 — Request/response metrics tracking\n│   ├── rate-limiter.ts            — Sliding window rate limiting (4 tiers)\n│   └── rbac.ts                    — Role-based access control\n│\n├── routes/ (16 files, 2,300+ lines)\n│   ├── admin.ts                   — /api/v1/admin/* (integrations, monitoring)\n│   ├── ai.ts                      — /api/v1/ai/* (14 AI endpoints: damp, crime, vulnerability, benefits, passport, briefing)\n│   ├── auth.ts                    — /api/v1/auth/* (login, register, logout)\n│   ├── briefing.ts                — /api/v1/briefing/* (personalised morning briefing)\n│   ├── booking.ts                 — /api/v1/booking/* (viewing bookings, applications)\n│   ├── cases.ts                   — /api/v1/cases/* (unified case CRUD + pagination)\n│   ├── compliance.ts              — /api/v1/compliance/* (Big 6 compliance)\n│   ├── explore.ts                 — /api/v1/explore/* (hierarchy drill-down data)\n│   ├── export.ts                  — /api/v1/export/* (CSV/PDF exports)\n│   ├── lettings.ts                — /api/v1/lettings/* (void management, allocations)\n│   ├── properties.ts              — /api/v1/properties/* (property list, detail)\n│   ├── public-data.ts (22KB)      — /api/v1/public-data/* (Tier 1-2 API proxy)\n│   ├── public-data.test.ts (29KB) — 66 unit tests for public data APIs\n│   ├── rent.ts                    — /api/v1/rent/* (arrears, statements, transactions)\n│   ├── reports.ts                 — /api/v1/reports/* (27 regulatory reports)\n│   └── tenants.ts                 — /api/v1/tenants/* (tenant list, detail)\n│\n├── services/ (20 files)\n│   ├── external-api.ts            — Cache-through, rate limiting, audit logging\n│   ├── firestore.ts               — Firestore connection + query helpers\n│   ├── firebase-admin.ts          — Firebase Admin initialization\n│   │\n│   ├── 7 KILLER DIFFERENTIATOR SERVICES:\n│   │   ├── damp-prediction.ts     — 5-factor damp risk algorithm (weather, building, history, sensors, occupancy)\n│   │   ├── crime-context.ts       — Police API correlation with ASB cases + hotspot analysis\n│   │   ├── vulnerability-detection.ts — 7-factor vulnerability scoring\n│   │   ├── benefits-engine.ts     — UK 2025/26 benefit rules (UC, PIP, AA, Pension Credit)\n│   │   ├── property-passport.ts   — Multi-source property dossier aggregation\n│   │   ├── neighbourhood-briefing.ts — Per-estate daily briefing combining all sources\n│   │   └── govuk-notify.ts        — 24 templates across 7 categories with personalisation\n│   │\n│   ├── census-nomis.ts            — Census 2021 + NOMIS labour market APIs\n│   ├── mock-services.ts           — 5 mock endpoints (repairs marketplace, regulatory, signing, referencing, land registry)\n│   ├── monitoring.ts              — Metrics singleton (request counts, latency, status codes)\n│   ├── hact-export.ts             — HACT reporting format\n│   ├── seed.ts, seed-data.ts      — Database seeding (75 properties, 68 tenants, 460+ docs)\n│   └── hact-codes.ts              — Repair SOR code definitions\n│\n├── models/\n│   ├── firestore-schemas.ts       — TypeScript schema definitions for Firestore collections\n│   └── hact-codes.ts\n│\n├── scripts/\n│   ├── seed-imd.ts                — IMD (Index of Multiple Deprivation) data loading\n│   └── seed.ts                    — Main seed runner\n│\n└── package.json\n    ├── Express 4, TypeScript 5.7, Node.js 20\n    ├── @google-cloud/firestore\n    ├── firebase-admin\n    ├── Helmet (security headers)\n    ├── CORS, Compression, Morgan (logging)\n    ├── Vitest (testing)\n    └── tsx, TSC (build tools)\n```\n\n**API Routes Summary (50+ endpoints):**\n- `/health` — Health check with Firestore connectivity\n- `/api/v1/auth/*` — Authentication (Firebase)\n- `/api/v1/briefing/*` — Personalised briefing\n- `/api/v1/cases/*` — Case CRUD (repair, complaint, ASB, financial, damp-mould)\n- `/api/v1/compliance/*` — Big 6 compliance data\n- `/api/v1/explore/*` — 7-level hierarchy data\n- `/api/v1/properties/*` — Property list/detail\n- `/api/v1/tenants/*` — Tenant list/detail\n- `/api/v1/rent/*` — Arrears, statements, transactions\n- `/api/v1/reports/*` — 27 regulatory reports\n- `/api/v1/ai/*` — Damp, crime, vulnerability, benefits, passport, briefing\n- `/api/v1/public-data/*` — Police, postcodes, EPC, NOMIS, Gas Safe, Electrical, weather\n- `/api/v1/admin/*` — Integrations, monitoring, audit logs\n- `/api/v1/booking/*` — Viewing bookings, applications\n\n**Firestore Collections (17 total):**\n- `users`, `properties`, `tenants`, `cases`, `activities`, `tasks`\n- `repairs`, `complaints`, `asb`, `financial`, `damp-mould`\n- `organisations`, `teams`, `integrations`, `auditLog`\n- `externalDataCache` — TTL-based external API cache\n\n---\n\n## CURRENT STATUS\n\n### **BUILD & DEPLOYMENT**\n- ✅ **TypeScript:** 0 errors (both app & server)\n- ✅ **Vite Build:** 3,397 modules, 35-39 seconds\n- ✅ **Docker:** Multi-stage Dockerfile (build client, build server, production)\n- ✅ **Cloud Run:** Deployed at `https://socialhomes-587984201316.europe-west2.run.app`\n- ✅ **Firestore:** Live database with 460+ documents across 17 collections\n- ✅ **CI/CD:** Cloud Build auto-triggers on `git push origin main`\n\n### **PHASES COMPLETED**\n1. **Phase 0 — Infrastructure** ✅ (7 sessions, Entire.io CLI, Telegram MCP, documentation)\n2. **Phase 1 — Foundation** ✅ (Tier 1 APIs, external data caching, IMD integration)\n3. **Phase 2 — Intelligence** ✅ (7 killer differentiators, AI services, frontend panels)\n4. **Phase 3 — Enrichment** ✅ (GOV.UK Notify templates, Census/NOMIS, accessibility fixes)\n5. **Phase 4 — Completion** ✅ (Mock services, admin dashboard, security hardening, monitoring)\n\n### **TEST RESULTS**\n- **Selenium:** 332 tests, 331 PASS (99.7% pass rate)\n- **Unit Tests:** 66 tests for public data APIs (external-api.test.ts, public-data.test.ts)\n- **All Warnings:** Resolved (WARN-001 through WARN-011)\n- **All Bugs:** Resolved (BUG-001 through BUG-004)\n\n### **PRODUCTION READINESS**\n- ✅ **Security:** CSP, CORS whitelist, rate limiting (4 tiers), security headers, no secrets in code\n- ✅ **Monitoring:** Metrics middleware, health checks, structured error logging\n- ✅ **Accessibility:** WCAG AA (focus traps, skip links, reduced motion, ARIA labels)\n- ✅ **Performance:** P95 response < 500ms, bundle < 3MB, cold start < 3s\n- ✅ **Data:** 75 properties, 68 tenants, 279 cases, realistic SE London postcodes\n\n### **UNTRACKED FILES** (not committed)\n- `.mission-control/` — Entire.io monitoring snapshots\n- `docs/Proposal-Content-Draft.md` — Draft proposal\n- `docs/ProposalSocialHomesAi.docx` — Formal proposal document\n\n---\n\n## KEY FEATURES IMPLEMENTED\n\n### **Visual Drill-Down Hierarchy** (7 levels)\n- Country → Region → LA → Estate → Block → Core → Unit → Tenant\n- Leaflet map + Three.js 3D building visualization\n- Context panel with attributes, KPIs, compliance, AI insights\n- Color-coded units (green/amber/red/purple by status)\n\n### **AI-Native Elements**\n- **Dynamic AI Actions:** Context-sensitive buttons on every entity\n- **Yantra Assist Panel:** Purple-bordered panel with urgent items, insights, briefing, external factors\n- **AI Morning Briefing:** Personalized daily greeting with weather, tasks, predictions\n- **Countdown Timers:** Awaab's Law, complaint deadlines, compliance expiry (color-coded urgency)\n- **Prediction Models:** 8 predictive algorithms (arrears, damp, complaints, voids, repairs, vulnerability, ASB, compliance)\n\n### **Case Management**\n- **Unified Case Timeline:** All case types (repair, complaint, ASB, financial, damp-mould, safeguarding, enquiry)\n- **Repair:** Priority-based SLA, appointment booking, operative notes, photos, satisfaction survey\n- **Complaint:** Two-stage timeline with 5WD/10WD/20WD deadlines, Ombudsman escalation\n- **ASB:** Escalation pipeline (warning → ABC → CPW → CPN → injunction → possession), evidence log\n- **Financial:** Arrears reason, payment arrangement, Pre-Action Protocol checklist\n- **Damp/Mould:** Awaab's Law compliance with emergency (24h) and significant (10-12 week) timers\n\n### **Compliance Management**\n- **Big 6 Dashboard:** Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n- **Awaab's Law:** Active cases with countdown timers, risk register, proactive inspection programme\n- **Certificates:** CP12 (gas), EICR (electrical), FRA (fire), asbestos register, EPC, lifts (LOLER)\n- **Building-Level:** Fire Risk Assessment, Building Safety Case, communal systems\n- **Unit-Level:** Gas Safety, EICR, EPC, smoke/CO alarms, boiler, Decent Homes, stock condition\n\n### **Tenant Management**\n- **Hierarchy:** Household members, emergency contact, vulnerability flags\n- **Rent Account:** Balance (color-coded), weekly charge, payment method, UC/HB status\n- **Transaction Ledger:** 52-week statement view, balance trend chart\n- **Cases Timeline:** Chronological log of all linked cases with SLA countdowns\n- **Vulnerability Detection:** 7-factor AI scoring (deprivation, arrears, health, isolation, age, dependents, UC)\n\n### **Admin System** (Complete)\n- **Organisation Management:** Profile, branding, operational parameters\n- **User Management:** RBAC with 10 default roles, 2FA, user impersonation\n- **Team & Patch Management:** Hierarchies, caseload balancing, cover/absence\n- **Workflow Engine:** Visual builder with triggers, conditions, actions (simulated)\n- **Integration Hub:** 20 integrations across 3 tiers with toggle, test, status\n- **Audit & Compliance:** Full audit trail, GDPR tools (SAR, erasure, retention)\n- **System Configuration:** Reference data, form builder, notification config, AI config\n\n### **External API Integrations**\n- **Tier 1 (Free, No Key):** Police.uk (crime/ASB), Open-Meteo (weather), DEFRA (flood risk)\n- **Tier 2 (Registration):** Postcodes.io, EPC Open Data, NOMIS (Census, labour market), Gas Safe, Electrical Safety\n- **Tier 3 (Subscription/Mock):** DWP UC, IoT Sensors, GoCardless, Plentific, DocuSign, Land Registry, Experian\n- **Caching:** Firestore `externalDataCache` with TTL (weather 1h, crime 24h, EPC 30d, Census 90d)\n- **Rate Limiting:** Token bucket per API, fair-use compliance\n- **Graceful Degradation:** Simulated fallbacks for all APIs\n\n### **Reports & Analytics**\n- **27 Reports:** TSM (22 measures), CORE lettings/sales, Consumer Standards, Ombudsman, BSA\n- **Dashboards:** Repairs, voids, arrears, complaints, ASB, compliance, financial\n- **Trending:** 12-month charts, band movement, payment method breakdown\n- **Benchmarking:** Targets, previous period, sector medians/quartiles\n\n### **Tenant Portal**\n- **Distinct UI:** Lighter/warmer theme, larger text, simple layout\n- **Self-Service:** Report repair (conversational wizard), check rent balance, make payment\n- **Active Repairs:** List with photos and status\n- **Contact:** Message housing officer, access documents\n\n---\n\n## TECHNOLOGY STACK\n\n| Component | Technology |\n|-----------|-----------|\n| **Frontend Framework** | React 19 with TypeScript 5.9 |\n| **Frontend Router** | React Router v7 with nested routes |\n| **Styling** | Tailwind CSS v4 (dark theme, Yantra.Works brand palette) |\n| **State Management** | React Context + useReducer (local state in components) |\n| **Data Fetching** | @tanstack/react-query (caching, polling, mutations) |\n| **3D Visualization** | Three.js r128 via @react-three/fiber |\n| **Maps** | Leaflet 1.9 + React Leaflet (OpenStreetMap tiles, no API key) |\n| **Charts** | Recharts (KPIs, trends), D3.js (Sankey, heatmaps) |\n| **Icons** | Lucide React (60+ icons) |\n| **Authentication** | Firebase Auth with FirebaseUI drop-in widget |\n| **Backend Framework** | Express.js 4 with TypeScript 5.7 |\n| **Database** | Google Firestore (NoSQL, 17 collections) |\n| **Hosting** | Google Cloud Run (europe-west2, min-instances=0, max=10) |\n| **Build Tool** | Vite 7.2 (frontend), tsc (backend) |\n| **CI/CD** | Google Cloud Build (auto-trigger on git push) |\n| **Testing** | Selenium (E2E), Vitest (unit), Jest (frontend) |\n| **Security** | Helmet, CORS whitelist, CSP, rate limiting, secret manager |\n| **Monitoring** | Custom metrics middleware, health checks, structured logging |\n| **Documentation** | 4 specification documents (6,200+ lines), session history |\n\n---\n\n## KEY FILES & LINE COUNTS\n\n| File/Module | Lines | Purpose |\n|------------|-------|---------|\n| `app/src/types/index.ts` | 721 | Complete type definitions (Persona, User, Property, Case, etc.) |\n| `server/src/routes/public-data.ts` | 700+ | Tier 1-2 API proxy (police, postcodes, EPC, weather, etc.) |\n| `server/src/routes/public-data.test.ts` | 850+ | 66 unit tests for public data APIs |\n| `server/src/routes/ai.ts` | 450+ | 14 AI endpoints (damp, crime, vulnerability, benefits, passport, briefing) |\n| `server/src/routes/admin.ts` | 380+ | Integration management, monitoring, audit |\n| `server/src/services/damp-prediction.ts` | 250+ | 5-factor damp risk algorithm |\n| `server/src/services/govuk-notify.ts` | 1,257 | 24 templates with personalisation |\n| `server/src/services/census-nomis.ts` | 493 | Census 2021 + NOMIS labour market |\n| `server/src/index.ts` | 191 | Express server entry point |\n| `app/src/App.tsx` | 152 | Main router with 40+ routes |\n| `app/src/pages/explore/ExplorePage.tsx` | 400+ | 7-level visual drill-down |\n| `app/src/pages/dashboard/DashboardPage.tsx` | 300+ | 8 KPIs, charts, activity feed |\n| `app/src/pages/admin/IntegrationsPage.tsx` | 329 | Integration dashboard |\n| `app/src/hooks/useApi.ts` | 200+ | 70+ React Query hooks |\n| `EXECUTION-PLAN.md` | 200 | 4-phase build plan (all complete) |\n| `SESSION-HISTORY.md` | 360 | 7 session conversation log |\n| `DEV-FIX-LIST.md` | 72 | Test results (332 tests, 99.7% pass) |\n| `DEVOPS.md` | 850+ | Infrastructure, CI/CD, security, monitoring |\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Actual |\n|--------|--------|--------|\n| **Selenium Test Pass Rate** | > 98% | 99.7% (331/332) |\n| **TypeScript Errors** | 0 | 0 ✅ |\n| **Vite Build Warnings** | 0 critical | 0 ✅ |\n| **API Response Time (P95)** | < 500ms | ~200-300ms |\n| **WCAG AA Compliance** | 100% | 100% (focus, contrast, keyboard, ARIA) ✅ |\n| **External API Uptime** | > 99.5% | 100% (with fallbacks) ✅ |\n| **Bundle Size** | < 3MB | 2.5-3MB ✅ |\n| **Cloud Run Cold Start** | < 3s | < 2s ✅ |\n| **Firestore Collections** | 17 | 17 ✅ |\n| **Live Properties** | 75 | 75 ✅ |\n| **Live Tenants** | 68 | 68 ✅ |\n| **Live Cases** | 279+ | 279+ ✅ |\n\n---\n\n## RECENT COMMITS (Last 20)\n\n```\ne023532 fix: make help drawer full-screen with centered content layout\n07d6845 fix: widen help drawer to half viewport for better readability\n9634838 feat: Phase 4 Completion — mock services, admin dashboard, security, monitoring\ne4aa674 feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility\n4ce6faa feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels\n8aae118 fix: resolve all 3 remaining warnings — search, map popups, API pagination\ne5054ac fix: solid opaque background for help drawer, expand first 3 topics\ne40f706 fix: update test suite for new Cloud Run URL and Firebase Auth login\ne777c4f feat: rebuild help system as left drawer with comprehensive user guide\nb4cdd4a feat: add end-to-end viewing bookings, applications, and property map\n0d1407e fix: tenancies search now matches name, address, and tenant ID\n4131b12 docs: add product brochure with page screenshots\n43ca6ac feat: complete Phase 1 — tests, help system, IMD seed, route fix\n6cdbcb2 feat: add Firestore database integration with seed script\n```\n\n---\n\n## NEXT STEPS (From EXECUTION-PLAN.md)\n\n**Deferred Tasks (optional enhancements):**\n- Met Office DataHub registration (Open-Meteo is sufficient)\n- OS Places/Maps PSGA registration (OpenStreetMap tiles are sufficient)\n- Twilio integration (GOV.UK Notify is preferred)\n- Full regression test suite (Phase 4+ task)\n- Load testing at 100 concurrent users (Phase 4+ task)\n- API reference documentation (Phase 4+ task)\n\n**All critical phases (0-4) are COMPLETE and PRODUCTION-READY.**\n\n---\n\nThis comprehensive summary covers the entire SocialHomes.Ai project from architecture to deployment. The application is fully functional, deployed on Cloud Run, integrated with Google Firestore, and ready for ongoing feature development and scaling."}],"totalDurationMs":183985,"totalTokens":77844,"totalToolUseCount":38,"usage":{"input_tokens":6,"cache_creation_input_tokens":1133,"cache_read_input_tokens":68155,"output_tokens":8550,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":1133,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"e39ba93a-d47f-404a-914b-697a4e9c9029"}
{"parentUuid":"96a5a692-8f1d-4d0e-81b4-245e5fc3d82e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_011qoEMvLxHpZRLJNhEakfFk","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent! I now have a comprehensive understanding of the entire SocialHomes.Ai project. Let me now create the specification documents and execution plan."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8964,"cache_read_input_tokens":18394,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8964},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVNVYTcxAnh6Wcnh28H","type":"assistant","uuid":"4a2f9860-e682-4222-9d46-873e55c6b397","timestamp":"2026-02-18T11:54:36.282Z"}
{"parentUuid":"4a2f9860-e682-4222-9d46-873e55c6b397","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_011qoEMvLxHpZRLJNhEakfFk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PfAUGD5CCyykXsBnMJaZ31","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"in_progress","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8964,"cache_read_input_tokens":18394,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8964},"output_tokens":4,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVNVYTcxAnh6Wcnh28H","type":"assistant","uuid":"5c52a03a-ec46-4407-99bf-010d4d1a2ea5","timestamp":"2026-02-18T11:54:40.603Z"}
{"parentUuid":"5c52a03a-ec46-4407-99bf-010d4d1a2ea5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PfAUGD5CCyykXsBnMJaZ31","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"135f2b07-d59f-481c-a01a-be253e4118f7","timestamp":"2026-02-18T11:54:40.609Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"in_progress","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"pending","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"in_progress","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"5c52a03a-ec46-4407-99bf-010d4d1a2ea5"}
{"parentUuid":"135f2b07-d59f-481c-a01a-be253e4118f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01T9rpUfWUbtMphSMG7uU4Ef","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ADchUeWc6qrqEckT6PWxmd","name":"Bash","input":{"command":"mkdir -p /mnt/c/.netapps/socialhomes/docs/requirements","description":"Create docs/requirements directory"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":356,"cache_read_input_tokens":27358,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":356},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVP3HBBDA8c3aoXnQJQ","type":"assistant","uuid":"5b0c5868-3048-4119-9950-a5e2fce2a5ca","timestamp":"2026-02-18T11:54:43.952Z"}
{"parentUuid":"5b0c5868-3048-4119-9950-a5e2fce2a5ca","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ADchUeWc6qrqEckT6PWxmd","type":"tool_result","content":"","is_error":false}]},"uuid":"25c012f0-1537-4480-8bec-7f337130e2a7","timestamp":"2026-02-18T11:54:44.046Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":true},"sourceToolAssistantUUID":"5b0c5868-3048-4119-9950-a5e2fce2a5ca"}
{"parentUuid":"25c012f0-1537-4480-8bec-7f337130e2a7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BSjcLapaa4mrc9poFtdMyT","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the existing EXECUTION-PLAN.md and SESSION-HISTORY.md to understand current state before creating new documents:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":118,"cache_read_input_tokens":27714,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":118},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVPGtyr818ywxEZRBn2","type":"assistant","uuid":"3400e768-c9fc-4382-8763-183c5e510a27","timestamp":"2026-02-18T11:54:46.794Z"}
{"parentUuid":"3400e768-c9fc-4382-8763-183c5e510a27","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BSjcLapaa4mrc9poFtdMyT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EG5Upmc62GJGZs1x8MuYMH","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":118,"cache_read_input_tokens":27714,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":118},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVPGtyr818ywxEZRBn2","type":"assistant","uuid":"5435cfac-b7fe-440f-a39e-16da25210fca","timestamp":"2026-02-18T11:54:47.315Z"}
{"parentUuid":"5435cfac-b7fe-440f-a39e-16da25210fca","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EG5Upmc62GJGZs1x8MuYMH","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.\n     4→> Version 1.0 | 2026-02-14\n     5→\n     6→---\n     7→\n     8→## PHASE 0: INFRASTRUCTURE (Current Session — Complete)\n     9→\n    10→| # | Task | Status | Agent |\n    11→|---|------|--------|-------|\n    12→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    13→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    14→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    15→| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n    16→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    17→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    18→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    19→| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    20→| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    21→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    22→\n    23→---\n    24→\n    25→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)\n    26→\n    27→### Goal: Core external API infrastructure + free API integrations\n    28→\n    29→| # | Task | Priority | Complexity | Agent | Status |\n    30→|---|------|----------|------------|-------|--------|\n    31→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |\n    32→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |\n    33→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |\n    34→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |\n    35→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |\n    36→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |\n    37→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |\n    38→| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |\n    39→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |\n    40→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |\n    41→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |\n    42→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |\n    43→\n    44→### Deliverables:\n    45→- All Tier 1 (free, no-key) APIs live with real data\n    46→- Firestore cache layer operational\n    47→- Data model extended for external sources\n    48→- Crime heatmap visible on Explore page\n    49→\n    50→---\n    51→\n    52→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE\n    53→\n    54→### Goal: 7 killer differentiators + Tier 2 API registrations\n    55→\n    56→| # | Task | Priority | Complexity | Agent | Status |\n    57→|---|------|----------|------------|-------|--------|\n    58→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |\n    59→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |\n    60→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |\n    61→| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |\n    62→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |\n    63→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |\n    64→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |\n    65→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |\n    66→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |\n    67→| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |\n    68→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |\n    69→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |\n    70→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |\n    71→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |\n    72→\n    73→### Deliverables:\n    74→- All 6 differentiators live with API routes and frontend panels\n    75→- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS\n    76→- AI Centre Differentiators tab shows all 6 features + vulnerability scan\n    77→- TypeScript compiles clean, both builds pass\n    78→\n    79→---\n    80→\n    81→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE\n    82→\n    83→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    84→\n    85→| # | Task | Priority | Complexity | Agent | Status |\n    86→|---|------|----------|------------|-------|--------|\n    87→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |\n    88→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |\n    89→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |\n    90→| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    91→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |\n    92→| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |\n    93→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |\n    94→| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |\n    95→| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |\n    96→| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    97→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |\n    98→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |\n    99→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |\n   100→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |\n   101→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |\n   102→| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |\n   103→| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |\n   104→\n   105→### Deliverables:\n   106→- All 7 differentiators live\n   107→- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)\n   108→- Full GOV.UK Notify template library (24 templates, 7 categories)\n   109→- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)\n   110→- Form validation with inline errors on ActionModal\n   111→- Contractor verification badges on repair detail\n   112→- Data layer toggles (Crime/Damp/Compliance) on Explore map\n   113→\n   114→---\n   115→\n   116→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE\n   117→\n   118→### Goal: Mock services + polish + production hardening\n   119→\n   120→| # | Task | Priority | Complexity | Agent | Status |\n   121→|---|------|----------|------------|-------|--------|\n   122→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |\n   123→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |\n   124→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |\n   125→| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |\n   126→| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |\n   127→| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |\n   128→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |\n   129→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |\n   130→| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |\n   131→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |\n   132→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |\n   133→| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |\n   134→| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |\n   135→| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |\n   136→\n   137→### Deliverables:\n   138→- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)\n   139→- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test\n   140→- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging\n   141→- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint\n   142→- All TypeScript clean, both builds pass\n   143→\n   144→---\n   145→\n   146→## AGENT ROLES\n   147→\n   148→| Agent | Responsibility | Key Files |\n   149→|-------|---------------|-----------|\n   150→| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   151→| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   152→| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |\n   153→| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   154→| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |\n   155→\n   156→---\n   157→\n   158→## KEY DOCUMENTS\n   159→\n   160→| Document | Purpose |\n   161→|----------|---------|\n   162→| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |\n   163→| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |\n   164→| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |\n   165→| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |\n   166→| `CLAUDE.md` | Claude Code project instructions |\n   167→| `SESSION-HISTORY.md` | Persistent conversation history |\n   168→| `DEV-FIX-LIST.md` | Bug/warning tracker |\n   169→| `DEVOPS.md` | DevOps guide |\n   170→| `EXECUTION-PLAN.md` | This document |\n   171→\n   172→---\n   173→\n   174→## COMMUNICATION\n   175→\n   176→### Telegram (@SocialHomesBot)\n   177→- **Async notifications**: Build status, deployment confirmations, test results\n   178→- **Permission requests**: Routed via Telegram when user is away from desk\n   179→- **Progress updates**: Phase/sprint completion summaries\n   180→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   181→\n   182→### Session Continuity\n   183→- Update `SESSION-HISTORY.md` at end of every session\n   184→- `CLAUDE.md` provides context for new sessions\n   185→- Entire.io captures checkpoints on commits\n   186→\n   187→---\n   188→\n   189→## METRICS & SUCCESS CRITERIA\n   190→\n   191→| Metric | Target |\n   192→|--------|--------|\n   193→| Selenium test pass rate | > 98% |\n   194→| TypeScript errors | 0 |\n   195→| Vite build warnings | 0 critical |\n   196→| API response time (P95) | < 500ms |\n   197→| WCAG AA compliance | 100% (text contrast, focus, keyboard) |\n   198→| External API uptime | > 99.5% (with fallback to simulated) |\n   199→| Bundle size | < 3MB (gzipped < 800KB) |\n   200→| Cloud Run cold start | < 3s |\n   201→\n   202→---\n   203→\n   204→**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**\n   205→"}]},"uuid":"e9debd80-e197-4e0c-a85d-36fa1ac3f13a","timestamp":"2026-02-18T11:54:47.340Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.\n> Version 1.0 | 2026-02-14\n\n---\n\n## PHASE 0: INFRASTRUCTURE (Current Session — Complete)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |\n\n### Deliverables:\n- All Tier 1 (free, no-key) APIs live with real data\n- Firestore cache layer operational\n- Data model extended for external sources\n- Crime heatmap visible on Explore page\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |\n\n### Deliverables:\n- All 6 differentiators live with API routes and frontend panels\n- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS\n- AI Centre Differentiators tab shows all 6 features + vulnerability scan\n- TypeScript compiles clean, both builds pass\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |\n\n### Deliverables:\n- All 7 differentiators live\n- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)\n- Full GOV.UK Notify template library (24 templates, 7 categories)\n- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)\n- Form validation with inline errors on ActionModal\n- Contractor verification badges on repair detail\n- Data layer toggles (Crime/Damp/Compliance) on Explore map\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |\n| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |\n| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |\n\n### Deliverables:\n- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)\n- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test\n- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging\n- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint\n- All TypeScript clean, both builds pass\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |\n| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Purpose |\n|----------|---------|\n| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |\n| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |\n| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |\n| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |\n| `CLAUDE.md` | Claude Code project instructions |\n| `SESSION-HISTORY.md` | Persistent conversation history |\n| `DEV-FIX-LIST.md` | Bug/warning tracker |\n| `DEVOPS.md` | DevOps guide |\n| `EXECUTION-PLAN.md` | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target |\n|--------|--------|\n| Selenium test pass rate | > 98% |\n| TypeScript errors | 0 |\n| Vite build warnings | 0 critical |\n| API response time (P95) | < 500ms |\n| WCAG AA compliance | 100% (text contrast, focus, keyboard) |\n| External API uptime | > 99.5% (with fallback to simulated) |\n| Bundle size | < 3MB (gzipped < 800KB) |\n| Cloud Run cold start | < 3s |\n\n---\n\n**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**\n","numLines":205,"startLine":1,"totalLines":205}},"sourceToolAssistantUUID":"5435cfac-b7fe-440f-a39e-16da25210fca"}
{"parentUuid":"e9debd80-e197-4e0c-a85d-36fa1ac3f13a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BSjcLapaa4mrc9poFtdMyT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01M4JogYYS5P45rFyHnEA2n8","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":118,"cache_read_input_tokens":27714,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":118},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVPGtyr818ywxEZRBn2","type":"assistant","uuid":"92db93b8-6e97-431e-8346-6fe24e03b1ef","timestamp":"2026-02-18T11:54:47.643Z"}
{"parentUuid":"92db93b8-6e97-431e-8346-6fe24e03b1ef","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01M4JogYYS5P45rFyHnEA2n8","type":"tool_result","content":"     1→# SocialHomes.Ai — Session History\n     2→\n     3→> Persistent conversation log across all Claude Code sessions.\n     4→> Updated at the end of each session to preserve context.\n     5→\n     6→---\n     7→\n     8→## Session 1 — 2026-02-12 (Google Drive path)\n     9→**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10→**Agent:** Claude Opus 4.6\n    11→\n    12→### What happened:\n    13→- Initial project setup and exploration\n    14→- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15→- Comprehensive Selenium testing initiated (17 test classes)\n    16→- Project overview sent to Telegram\n    17→\n    18→### Key decisions:\n    19→- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20→- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21→- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22→\n    23→---\n    24→\n    25→## Session 2 — 2026-02-13 (Migrated to C: drive)\n    26→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27→**Agent:** Claude Opus 4.6\n    28→\n    29→### What happened:\n    30→- Security cleanup: removed all exposed API keys and secrets from codebase\n    31→- Added full workflow actions and cross-entity navigation\n    32→- Eliminated all React Error #310 instances\n    33→- Redesigned login page\n    34→- Polished dashboard\n    35→- Updated DEVOPS.md\n    36→\n    37→### Commits:\n    38→- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n    39→- `944e952` — feat: add full workflow actions & cross-entity navigation\n    40→- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n    41→- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42→- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n    43→\n    44→---\n    45→\n    46→## Session 3 — 2026-02-14\n    47→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48→**Agent:** Claude Opus 4.6\n    49→\n    50→### What happened:\n    51→\n    52→#### Task 1: Verified 4 previous bug fixes\n    53→- BUG-001: ComplaintDetailPage.tsx — null checks intact\n    54→- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n    55→- BUG-003: AsbPage.tsx — navigation handlers intact\n    56→- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n    57→\n    58→#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59→| Warning | File | Fix |\n    60→|---------|------|-----|\n    61→| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62→| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63→| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64→| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65→| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66→| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67→| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68→| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69→| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70→| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71→| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72→\n    73→#### Task 3: Installed Entire.io CLI\n    74→- Installed v0.4.4 at ~/.local/bin/entire\n    75→- Strategy: manual-commit\n    76→- Fixed all 4 git hooks with PATH export\n    77→\n    78→#### Task 4: Build and deploy\n    79→- TypeScript: 0 errors\n    80→- Vite build: 2,580.62 kB JS bundle\n    81→- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82→- Push: succeeded → Cloud Build triggered\n    83→\n    84→---\n    85→\n    86→## Session 4 — 2026-02-14 (current)\n    87→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88→**Agent:** Claude Opus 4.6\n    89→\n    90→### What happened:\n    91→\n    92→#### Task 5: Telegram notifications setup\n    93→- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94→- Created .mcp.json with telegram MCP server config\n    95→- Added .mcp.json to .gitignore (contains bot token)\n    96→- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97→\n    98→#### Task 6: Persistent conversation history\n    99→- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100→- Added to .gitignore (local dev reference only)\n   101→\n   102→#### Task 7: Entire.io repo\n   103→- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104→- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105→- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106→- Entire.io dashboard: https://app.entire.io (login required)\n   107→\n   108→#### Task 8: UI/UX Audit Document (in progress)\n   109→- Frontend UI engineer agent reviewing all pages, components, interactions\n   110→- Output: comprehensive audit for fullstack and tester agents\n   111→\n   112→#### Task 9: BA Requirements — Public API Integrations (in progress)\n   113→- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114→- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115→- 7 killer differentiators documented\n   116→\n   117→#### Task 10: Master Execution Plan (pending)\n   118→- Will be created after Tasks 8 and 9 complete\n   119→\n   120→---\n   121→\n   122→## Architecture Reference\n   123→\n   124→### Tech Stack\n   125→- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126→- **Backend:** Express.js + TypeScript\n   127→- **Database:** Google Firestore\n   128→- **Hosting:** Google Cloud Run (europe-west2)\n   129→- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n   130→- **Maps:** Leaflet.js + OpenStreetMap\n   131→- **3D:** Three.js\n   132→- **Charts:** Recharts\n   133→- **AI:** YantraAssist (contextual AI assistant)\n   134→\n   135→### Key URLs\n   136→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137→- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138→- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139→- **Firebase Project:** gen-lang-client-0146156913\n   140→- **Entire.io dashboard:** https://app.entire.io\n   141→\n   142→### Personas\n   143→1. COO — Organisation-wide view\n   144→2. Head of Housing — Regional oversight\n   145→3. Housing Manager — Estate/block management\n   146→4. Housing Officer — Frontline casework\n   147→5. Repairs Operative — Job-level repairs\n   148→\n   149→### Telegram Bot\n   150→- Bot: @SocialHomesBot\n   151→- Chat ID: socialhomes:8020560167\n   152→- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153→\n   154→---\n   155→\n   156→## Session 5 — 2026-02-15\n   157→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158→**Agent:** Claude Opus 4.6\n   159→\n   160→### What happened:\n   161→\n   162→#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163→\n   164→**Backend Services Created (7 new files):**\n   165→| Service | File | Description |\n   166→|---------|------|-------------|\n   167→| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168→| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169→| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170→| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171→| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172→| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173→| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174→\n   175→**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176→- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177→- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178→- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179→- D4: `GET /benefits-check/:tenantId`\n   180→- D5: `GET /property-passport/:propertyId`\n   181→- D6: `GET /briefing/:estateId`\n   182→- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183→\n   184→**Frontend Components Created (4 new panels):**\n   185→- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n   186→- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n   187→- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n   188→- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n   189→\n   190→**Frontend Pages Updated:**\n   191→- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n   192→- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n   193→- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n   194→- `api-client.ts` — 13 new AI API methods\n   195→- `useApi.ts` — 10 new React Query hooks\n   196→\n   197→### Build Results:\n   198→- TypeScript (server): 0 errors\n   199→- TypeScript (app): 0 errors\n   200→- Vite build: 3,395 modules, 38.43s\n   201→- All clean on first attempt\n   202→\n   203→### Commits:\n   204→- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205→\n   206→### EXECUTION-PLAN.md updated:\n   207→- Phase 2 marked as DONE (all 14 tasks)\n   208→\n   209→---\n   210→\n   211→## Session 6 — 2026-02-16\n   212→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213→**Agent:** Claude Opus 4.6\n   214→\n   215→### What happened:\n   216→\n   217→#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n   218→\n   219→**New Backend Services (2 files):**\n   220→| Service | File | Lines | Description |\n   221→|---------|------|-------|-------------|\n   222→| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223→| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n   224→\n   225→**API Routes Added (8 new endpoints):**\n   226→- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227→- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228→\n   229→**Frontend Enhancements (5 files modified):**\n   230→- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231→- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232→- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233→- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n   234→\n   235→**Accessibility Fixes (WCAG AA):**\n   236→- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237→- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238→- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239→- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240→\n   241→### Build Results:\n   242→- TypeScript (server): 0 errors\n   243→- TypeScript (app): 0 errors\n   244→- Vite build: 3,396 modules, 39.22s — all clean\n   245→- Server build: clean\n   246→\n   247→### Files Changed: 13 modified + 2 new (523 insertions)\n   248→\n   249→### Commits:\n   250→- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251→\n   252→### EXECUTION-PLAN.md updated:\n   253→- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254→\n   255→---\n   256→\n   257→#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n   258→\n   259→**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260→| Service | Function | Description |\n   261→|---------|----------|-------------|\n   262→| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263→| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264→| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n   265→| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266→| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267→\n   268→**Admin Integration Dashboard:**\n   269→- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270→- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271→- Toggle enable/disable + Test Connection buttons\n   272→- Summary bar: total, active, issues, avg response time\n   273→- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274→- Updated App.tsx routing to use IntegrationsPage\n   275→\n   276→**Security Hardening:**\n   277→- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278→- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279→- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280→- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281→- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282→- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283→- JSON body limit reduced from 10mb to 1mb\n   284→\n   285→**Production Monitoring:**\n   286→- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287→- New `server/src/middleware/metrics.ts` — records every request on res.finish\n   288→- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289→- New admin route: GET /api/v1/admin/monitoring\n   290→- Frontend API client: adminApi.monitoring()\n   291→\n   292→**API Routes Added (8 new):**\n   293→- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294→- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295→\n   296→### Build Results:\n   297→- TypeScript (server): 0 errors\n   298→- TypeScript (app): 0 errors\n   299→- Vite build: 3,397 modules, 35.59s — all clean\n   300→- Server build: clean\n   301→\n   302→### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303→### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304→\n   305→### EXECUTION-PLAN.md updated:\n   306→- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307→\n   308→---\n   309→\n   310→## Session 7 — 2026-02-16 (Cloud Run Deployment)\n   311→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312→**Agent:** Claude Opus 4.6\n   313→\n   314→### What happened:\n   315→\n   316→#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n   317→\n   318→**Problem:** Previous deployment attempts failed:\n   319→1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320→2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321→\n   322→**Resolution:**\n   323→1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324→2. Created 4 secrets in Secret Manager:\n   325→   | Secret | Value Source |\n   326→   |--------|-------------|\n   327→   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328→   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329→   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330→   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331→3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332→4. Deployed using pre-built image from Artifact Registry:\n   333→   ```\n   334→   gcloud run deploy socialhomes \\\n   335→     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336→     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337→     --min-instances=0 --max-instances=10 --port=8080 \\\n   338→     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339→   ```\n   340→\n   341→**Result:**\n   342→- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n   343→- Health check: `healthy`, Firestore connected (984ms latency)\n   344→- Firebase config endpoint: secrets injected correctly\n   345→- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346→\n   347→### Key Discoveries:\n   348→- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349→- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→"}]},"uuid":"39a7ef22-f8f6-4c6a-97f0-7b93391e5e5b","timestamp":"2026-02-18T11:54:47.670Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n","numLines":360,"startLine":1,"totalLines":360}},"sourceToolAssistantUUID":"92db93b8-6e97-431e-8346-6fe24e03b1ef"}
{"parentUuid":"39a7ef22-f8f6-4c6a-97f0-7b93391e5e5b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01PisR7hwH82XKKGqGYyqnKP","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have complete context. Let me create all three specification documents and the execution plan. I'll work on them in parallel:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11368,"cache_read_input_tokens":27832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVPYHwFqFr29V9TAARw","type":"assistant","uuid":"f3b446b0-afff-4037-9180-d9af88ad4ea8","timestamp":"2026-02-18T11:54:52.539Z"}
{"parentUuid":"f3b446b0-afff-4037-9180-d9af88ad4ea8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01PisR7hwH82XKKGqGYyqnKP","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HQxVSbvVfXjrSoyXYdrFGD","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)\n    - KPI trend sparklines (12 months)\n    - Activity feed with live updates\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    Features:\n    - Interactive Leaflet map with property markers\n    - Three.js 3D building visualization (digital twin)\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search, filter, sort\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n\n2.4 Properties Management\n    Route: /properties, /properties/:id\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page (/compliance/awaabs-law):\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: Fire Risk Assessment, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman code)\n    Features:\n    - Complaint list with status filtering\n    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM reporting integration\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - ASB case list with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with priority scoring\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management\n    - Void property kanban (keys received → inspection → works → ready → let)\n    - Void duration prediction (AI)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights\n    - Predictions tab: 8 predictive models dashboard\n    - Differentiators tab: 7 killer differentiator feature cards\n    - Vulnerability scan: Bulk tenant vulnerability assessment\n    - Assistant tab: Conversational AI interface\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting and summary\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles)\n    - Team and patch management\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging)\n    - GDPR tools (SAR, erasure, retention policies)\n    - System reference data configuration\n    - Notification configuration\n    - AI model configuration\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme\n    - Report repair (conversational wizard)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap\n    Access: Full read/write, admin settings, reports\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n\n    PERSONA 4: Housing Officer\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Dynamic AI Interface Elements\n    - Purple-bordered AI-generated buttons, fields, and prompts\n    - Appear contextually based on entity state and user role\n    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create\n\n4.2 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Features:\n    - Contextual urgent items panel\n    - AI-generated insights for current page\n    - Daily briefing summary\n    - External factors affecting current entity\n    - Natural language query interface\n\n4.3 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, household changes, employment\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.4 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: Dark (gray-900 / slate-900)\n    Accent: Brand teal (#14b8a6)\n    Secondary: Peach, garnet, purple (for AI elements)\n    Typography: System font stack, clean hierarchy\n\n6.2 Layout\n    - Fixed left sidebar (collapsible) with 14 navigation items\n    - Top header with logo, global search, notifications, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid\n    - Yantra Assist floating panel (bottom-left)\n\n6.3 Navigation Items (Sidebar)\n    1. Dashboard        8. Communications\n    2. Explore          9. Reports\n    3. Tenancies       10. AI Centre\n    4. Properties      11. Admin\n    5. Repairs         12. Tenant Portal\n    6. Compliance      13. ---\n    7. Complaints      14. Persona Switcher\n    + ASB, Rent, Allocations (sub-items)\n\n6.4 Design Principles\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n\n6.5 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with validation\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons\n    - NeighbourhoodBriefingPanel — estate-level daily briefing\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) support\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n\n8.5 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n\n8.6 Testing\n    - Selenium E2E: 332 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. CURRENT STATUS & METRICS\n================================================================================\n\n9.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n9.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 332             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-18\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11368,"cache_read_input_tokens":27832,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVPYHwFqFr29V9TAARw","type":"assistant","uuid":"b03dc768-22ad-487f-970f-5644c95c0816","timestamp":"2026-02-18T11:56:45.681Z"}
{"parentUuid":"b03dc768-22ad-487f-970f-5644c95c0816","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HQxVSbvVfXjrSoyXYdrFGD","type":"tool_result","content":"File created successfully at: /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt"}]},"uuid":"5efd5037-eeba-4062-9b43-a1cce4b5bb07","timestamp":"2026-02-18T11:56:45.849Z","toolUseResult":{"type":"create","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)\n    - KPI trend sparklines (12 months)\n    - Activity feed with live updates\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    Features:\n    - Interactive Leaflet map with property markers\n    - Three.js 3D building visualization (digital twin)\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search, filter, sort\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n\n2.4 Properties Management\n    Route: /properties, /properties/:id\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page (/compliance/awaabs-law):\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: Fire Risk Assessment, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman code)\n    Features:\n    - Complaint list with status filtering\n    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM reporting integration\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - ASB case list with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with priority scoring\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management\n    - Void property kanban (keys received → inspection → works → ready → let)\n    - Void duration prediction (AI)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights\n    - Predictions tab: 8 predictive models dashboard\n    - Differentiators tab: 7 killer differentiator feature cards\n    - Vulnerability scan: Bulk tenant vulnerability assessment\n    - Assistant tab: Conversational AI interface\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting and summary\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles)\n    - Team and patch management\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging)\n    - GDPR tools (SAR, erasure, retention policies)\n    - System reference data configuration\n    - Notification configuration\n    - AI model configuration\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme\n    - Report repair (conversational wizard)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap\n    Access: Full read/write, admin settings, reports\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n\n    PERSONA 4: Housing Officer\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Dynamic AI Interface Elements\n    - Purple-bordered AI-generated buttons, fields, and prompts\n    - Appear contextually based on entity state and user role\n    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create\n\n4.2 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Features:\n    - Contextual urgent items panel\n    - AI-generated insights for current page\n    - Daily briefing summary\n    - External factors affecting current entity\n    - Natural language query interface\n\n4.3 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, household changes, employment\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.4 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: Dark (gray-900 / slate-900)\n    Accent: Brand teal (#14b8a6)\n    Secondary: Peach, garnet, purple (for AI elements)\n    Typography: System font stack, clean hierarchy\n\n6.2 Layout\n    - Fixed left sidebar (collapsible) with 14 navigation items\n    - Top header with logo, global search, notifications, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid\n    - Yantra Assist floating panel (bottom-left)\n\n6.3 Navigation Items (Sidebar)\n    1. Dashboard        8. Communications\n    2. Explore          9. Reports\n    3. Tenancies       10. AI Centre\n    4. Properties      11. Admin\n    5. Repairs         12. Tenant Portal\n    6. Compliance      13. ---\n    7. Complaints      14. Persona Switcher\n    + ASB, Rent, Allocations (sub-items)\n\n6.4 Design Principles\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n\n6.5 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with validation\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons\n    - NeighbourhoodBriefingPanel — estate-level daily briefing\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) support\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n\n8.5 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n\n8.6 Testing\n    - Selenium E2E: 332 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. CURRENT STATUS & METRICS\n================================================================================\n\n9.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n9.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 332             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-18\n================================================================================\n","structuredPatch":[],"originalFile":null},"sourceToolAssistantUUID":"b03dc768-22ad-487f-970f-5644c95c0816"}
{"parentUuid":"5efd5037-eeba-4062-9b43-a1cce4b5bb07","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01B1R7AhuHbMjamVjLRyg197","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NFMMkTo6mr3c3pEVKy3keH","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"in_progress","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":5539,"cache_read_input_tokens":39200,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5539},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVYFXsaVNLDTWAmkznP","type":"assistant","uuid":"7f6323ca-5628-4da6-87e6-d3e543d5392f","timestamp":"2026-02-18T11:56:52.552Z"}
{"parentUuid":"7f6323ca-5628-4da6-87e6-d3e543d5392f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NFMMkTo6mr3c3pEVKy3keH","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"dd71c35f-335d-4084-bba7-a7e3ebcdd871","timestamp":"2026-02-18T11:56:52.555Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"in_progress","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"pending","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"in_progress","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"7f6323ca-5628-4da6-87e6-d3e543d5392f"}
{"parentUuid":"dd71c35f-335d-4084-bba7-a7e3ebcdd871","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_0164YDQJpTp5Lt9DegVpDy8q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01F8KRKeZSHS6e7aeZwjdGTT","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer                          │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19         |\n    | Language           | TypeScript              | 5.9        |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | v4         |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | latest     |\n    | 3D Visualization   | Three.js (@react-three) | r128       |\n    | Maps               | Leaflet + React Leaflet | 1.9        |\n    | Charts             | Recharts + D3.js        | latest     |\n    | Icons              | Lucide React            | latest     |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2        |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4          |\n    | Language           | TypeScript              | 5.7        |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | latest     |\n    | Auth               | Firebase Admin SDK      | latest     |\n    | Security           | Helmet                  | latest     |\n    | Logging            | Morgan + structured     | latest     |\n    | Testing            | Vitest                  | latest     |\n    | Build              | tsc + tsx               | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details            |\n    |--------------------|-------------------------|--------------------|\n    | Hosting            | Google Cloud Run        | europe-west2       |\n    | Container Registry | Artifact Registry       | europe-west2       |\n    | Database           | Google Firestore        | Native mode        |\n    | Authentication     | Firebase Auth           | Google SSO + email |\n    | Secrets            | Secret Manager          | 4 secrets          |\n    | CI/CD              | Cloud Build             | Auto on git push   |\n    | Source Control      | GitHub                  | rajivpeter repo    |\n    | Monitoring         | Custom metrics + health | In-app             |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage           |\n    |--------------------|-------------------------|--------------------|\n    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |\n    | Unit               | Vitest                  | 66 tests           |\n    | Type Checking      | TypeScript (strict)     | 0 errors           |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point\n    ├── index.css                — Global styles + animations\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage\n    │   ├── briefing/            — BriefingPage\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — Reusable components (12 files)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client, public data helpers\n    ├── contexts/                — Auth, User contexts\n    ├── utils/                   — Utility helpers\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within a BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API data caching, polling)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification\n    │   ├── error-handler.ts     — Structured JSON error handler\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 20 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical\n    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet → CORS → Compression\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses\n    - No stack traces leaked in production\n    - Error logging with request ID correlation\n    - Graceful degradation for external API failures\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                     │\n                                     ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                             │\n    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n      // See individual type schemas below\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root.\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (Unified)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    COMPLIANCE\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14 endpoints)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n\n    MOCK TIER 3 APIs\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title\n\n    EXTERNAL DATA PROXY\n    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather\n    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify\n\n    ADMIN\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    HEALTH\n    GET    /health                                        — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out, the system returns realistic simulated data\n    with a flag indicating the data source (live vs simulated).\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite)\n    Stage 2: Build server (tsc)\n    Stage 3: Production (Node.js 20 slim, copy built assets, start server)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Concurrency: 80 requests/instance\n    Timeout: 300 seconds\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs\n    - Error logging with full context (non-PII)\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-18\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":44739,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVYmXR5cHdpUU3UrncU","type":"assistant","uuid":"1c86c4ab-6a46-41ea-b6bb-8a0e012f4305","timestamp":"2026-02-18T11:59:32.522Z"}
{"parentUuid":"1c86c4ab-6a46-41ea-b6bb-8a0e012f4305","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01F8KRKeZSHS6e7aeZwjdGTT","type":"tool_result","content":"File created successfully at: /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt"}]},"uuid":"8dc3ffd5-b450-4da6-a578-f72b98915584","timestamp":"2026-02-18T11:59:32.548Z","toolUseResult":{"type":"create","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer                          │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19         |\n    | Language           | TypeScript              | 5.9        |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | v4         |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | latest     |\n    | 3D Visualization   | Three.js (@react-three) | r128       |\n    | Maps               | Leaflet + React Leaflet | 1.9        |\n    | Charts             | Recharts + D3.js        | latest     |\n    | Icons              | Lucide React            | latest     |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2        |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4          |\n    | Language           | TypeScript              | 5.7        |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | latest     |\n    | Auth               | Firebase Admin SDK      | latest     |\n    | Security           | Helmet                  | latest     |\n    | Logging            | Morgan + structured     | latest     |\n    | Testing            | Vitest                  | latest     |\n    | Build              | tsc + tsx               | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details            |\n    |--------------------|-------------------------|--------------------|\n    | Hosting            | Google Cloud Run        | europe-west2       |\n    | Container Registry | Artifact Registry       | europe-west2       |\n    | Database           | Google Firestore        | Native mode        |\n    | Authentication     | Firebase Auth           | Google SSO + email |\n    | Secrets            | Secret Manager          | 4 secrets          |\n    | CI/CD              | Cloud Build             | Auto on git push   |\n    | Source Control      | GitHub                  | rajivpeter repo    |\n    | Monitoring         | Custom metrics + health | In-app             |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage           |\n    |--------------------|-------------------------|--------------------|\n    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |\n    | Unit               | Vitest                  | 66 tests           |\n    | Type Checking      | TypeScript (strict)     | 0 errors           |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point\n    ├── index.css                — Global styles + animations\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage\n    │   ├── briefing/            — BriefingPage\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — Reusable components (12 files)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client, public data helpers\n    ├── contexts/                — Auth, User contexts\n    ├── utils/                   — Utility helpers\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within a BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API data caching, polling)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification\n    │   ├── error-handler.ts     — Structured JSON error handler\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 20 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical\n    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet → CORS → Compression\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses\n    - No stack traces leaked in production\n    - Error logging with request ID correlation\n    - Graceful degradation for external API failures\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                     │\n                                     ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                             │\n    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n      // See individual type schemas below\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root.\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (Unified)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    COMPLIANCE\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14 endpoints)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n\n    MOCK TIER 3 APIs\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title\n\n    EXTERNAL DATA PROXY\n    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather\n    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify\n\n    ADMIN\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    HEALTH\n    GET    /health                                        — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out, the system returns realistic simulated data\n    with a flag indicating the data source (live vs simulated).\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite)\n    Stage 2: Build server (tsc)\n    Stage 3: Production (Node.js 20 slim, copy built assets, start server)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Concurrency: 80 requests/instance\n    Timeout: 300 seconds\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs\n    - Error logging with full context (non-PII)\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-18\n================================================================================\n","structuredPatch":[],"originalFile":null},"sourceToolAssistantUUID":"1c86c4ab-6a46-41ea-b6bb-8a0e012f4305"}
{"parentUuid":"8dc3ffd5-b450-4da6-a578-f72b98915584","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_0181nhy44GN84SbPnkvEghrZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YZaJaWgBHg42TxkTZ3Liqm","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"in_progress","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9963,"cache_read_input_tokens":45062,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9963},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVkYRDQ1i5xDPgWtt7q","type":"assistant","uuid":"91d4bbae-fca5-4379-8b9f-f1133fb6732b","timestamp":"2026-02-18T11:59:39.421Z"}
{"parentUuid":"91d4bbae-fca5-4379-8b9f-f1133fb6732b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YZaJaWgBHg42TxkTZ3Liqm","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"7afca28c-3e70-4deb-83f9-8414a75b15ce","timestamp":"2026-02-18T11:59:39.423Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"in_progress","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"pending","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"in_progress","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"91d4bbae-fca5-4379-8b9f-f1133fb6732b"}
{"parentUuid":"7afca28c-3e70-4deb-83f9-8414a75b15ce","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BU9Bf9Xo1xwwt9tcexK88X","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Pvtz2doGfY83BpWP9944BH","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n    - Country, European electoral region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Endpoint Pattern:\n    - GET /engineer/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Endpoint Pattern:\n    - GET /contractor/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Not yet implemented (deferred)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |\n    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |\n    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |\n    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |\n    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |\n    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |\n    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |\n    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |\n    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |\n    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |\n    | Salesforce CRM        | P3       | High       | Tenant relationship management  |\n    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |\n    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |\n    | NHS Digital           | P3       | High       | Health data integration         |\n    | Companies House       | P3       | Low        | Contractor verification         |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-18\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":55025,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVm5QHhmmh5CKdHUBEe","type":"assistant","uuid":"9ff32e80-724d-4807-81bf-7e6f9cc73dee","timestamp":"2026-02-18T12:01:58.515Z"}
{"parentUuid":"9ff32e80-724d-4807-81bf-7e6f9cc73dee","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Pvtz2doGfY83BpWP9944BH","type":"tool_result","content":"File created successfully at: /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt"}]},"uuid":"400c9a73-db57-4d07-aa6f-8778d9af7f5a","timestamp":"2026-02-18T12:01:58.539Z","toolUseResult":{"type":"create","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n    - Country, European electoral region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Endpoint Pattern:\n    - GET /engineer/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Endpoint Pattern:\n    - GET /contractor/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Not yet implemented (deferred)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |\n    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |\n    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |\n    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |\n    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |\n    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |\n    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |\n    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |\n    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |\n    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |\n    | Salesforce CRM        | P3       | High       | Tenant relationship management  |\n    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |\n    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |\n    | NHS Digital           | P3       | High       | Health data integration         |\n    | Companies House       | P3       | Low        | Contractor verification         |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-18\n================================================================================\n","structuredPatch":[],"originalFile":null},"sourceToolAssistantUUID":"9ff32e80-724d-4807-81bf-7e6f9cc73dee"}
{"parentUuid":"400c9a73-db57-4d07-aa6f-8778d9af7f5a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01CWxqP6Z8bza365LUhzwwTQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YMpWcXwZj8EREfA3N2zXrP","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"in_progress","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8080,"cache_read_input_tokens":55348,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8080},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVwJbp2J4weGmMubVXu","type":"assistant","uuid":"40f0664a-a6ca-4236-b502-a35efb018012","timestamp":"2026-02-18T12:02:05.257Z"}
{"parentUuid":"40f0664a-a6ca-4236-b502-a35efb018012","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YMpWcXwZj8EREfA3N2zXrP","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"c2c983db-602c-4693-be99-dde5bbe27038","timestamp":"2026-02-18T12:02:05.259Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"in_progress","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"pending","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"in_progress","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"40f0664a-a6ca-4236-b502-a35efb018012"}
{"parentUuid":"c2c983db-602c-4693-be99-dde5bbe27038","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01HsmCM96C2gqkr681ssMX7o","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me create the comprehensive EXECUTION-PLAN.md. Since phases 0–4 are already DONE, I'll preserve them as completed history and add Phase 5 (next evolution) with detailed tasks:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":63428,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVwpinvYmT4mSy8iH8s","type":"assistant","uuid":"499943d6-3ff7-4144-9eca-2f175371ce3c","timestamp":"2026-02-18T12:02:09.266Z"}
{"parentUuid":"499943d6-3ff7-4144-9eca-2f175371ce3c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01HsmCM96C2gqkr681ssMX7o","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FQ5RFkeae1Hq4HY43GUmQi","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":63428,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVwpinvYmT4mSy8iH8s","type":"assistant","uuid":"221cdff2-4dd1-4a37-9ec6-e2fa2b9418a4","timestamp":"2026-02-18T12:02:09.772Z"}
{"parentUuid":"221cdff2-4dd1-4a37-9ec6-e2fa2b9418a4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FQ5RFkeae1Hq4HY43GUmQi","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.\n     4→> Version 1.0 | 2026-02-14\n     5→\n     6→---\n     7→\n     8→## PHASE 0: INFRASTRUCTURE (Current Session — Complete)\n     9→\n    10→| # | Task | Status | Agent |\n    11→|---|------|--------|-------|\n    12→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    13→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    14→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    15→| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n    16→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    17→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    18→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    19→| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    20→| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    21→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    22→\n    23→---\n    24→\n    25→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)\n    26→\n    27→### Goal: Core external API infrastructure + free API integrations\n    28→\n    29→| # | Task | Priority | Complexity | Agent | Status |\n    30→|---|------|----------|------------|-------|--------|\n    31→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |\n    32→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |\n    33→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |\n    34→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |\n    35→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |\n    36→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |\n    37→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |\n    38→| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |\n    39→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |\n    40→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |\n    41→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |\n    42→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |\n    43→\n    44→### Deliverables:\n    45→- All Tier 1 (free, no-key) APIs live with real data\n    46→- Firestore cache layer operational\n    47→- Data model extended for external sources\n    48→- Crime heatmap visible on Explore page\n    49→\n    50→---\n    51→\n    52→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE\n    53→\n    54→### Goal: 7 killer differentiators + Tier 2 API registrations\n    55→\n    56→| # | Task | Priority | Complexity | Agent | Status |\n    57→|---|------|----------|------------|-------|--------|\n    58→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |\n    59→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |\n    60→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |\n    61→| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |\n    62→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |\n    63→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |\n    64→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |\n    65→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |\n    66→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |\n    67→| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |\n    68→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |\n    69→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |\n    70→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |\n    71→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |\n    72→\n    73→### Deliverables:\n    74→- All 6 differentiators live with API routes and frontend panels\n    75→- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS\n    76→- AI Centre Differentiators tab shows all 6 features + vulnerability scan\n    77→- TypeScript compiles clean, both builds pass\n    78→\n    79→---\n    80→\n    81→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE\n    82→\n    83→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    84→\n    85→| # | Task | Priority | Complexity | Agent | Status |\n    86→|---|------|----------|------------|-------|--------|\n    87→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |\n    88→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |\n    89→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |\n    90→| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    91→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |\n    92→| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |\n    93→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |\n    94→| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |\n    95→| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |\n    96→| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    97→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |\n    98→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |\n    99→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |\n   100→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |\n   101→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |\n   102→| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |\n   103→| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |\n   104→\n   105→### Deliverables:\n   106→- All 7 differentiators live\n   107→- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)\n   108→- Full GOV.UK Notify template library (24 templates, 7 categories)\n   109→- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)\n   110→- Form validation with inline errors on ActionModal\n   111→- Contractor verification badges on repair detail\n   112→- Data layer toggles (Crime/Damp/Compliance) on Explore map\n   113→\n   114→---\n   115→\n   116→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE\n   117→\n   118→### Goal: Mock services + polish + production hardening\n   119→\n   120→| # | Task | Priority | Complexity | Agent | Status |\n   121→|---|------|----------|------------|-------|--------|\n   122→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |\n   123→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |\n   124→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |\n   125→| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |\n   126→| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |\n   127→| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |\n   128→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |\n   129→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |\n   130→| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |\n   131→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |\n   132→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |\n   133→| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |\n   134→| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |\n   135→| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |\n   136→\n   137→### Deliverables:\n   138→- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)\n   139→- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test\n   140→- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging\n   141→- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint\n   142→- All TypeScript clean, both builds pass\n   143→\n   144→---\n   145→\n   146→## AGENT ROLES\n   147→\n   148→| Agent | Responsibility | Key Files |\n   149→|-------|---------------|-----------|\n   150→| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   151→| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   152→| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |\n   153→| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   154→| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |\n   155→\n   156→---\n   157→\n   158→## KEY DOCUMENTS\n   159→\n   160→| Document | Purpose |\n   161→|----------|---------|\n   162→| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |\n   163→| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |\n   164→| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |\n   165→| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |\n   166→| `CLAUDE.md` | Claude Code project instructions |\n   167→| `SESSION-HISTORY.md` | Persistent conversation history |\n   168→| `DEV-FIX-LIST.md` | Bug/warning tracker |\n   169→| `DEVOPS.md` | DevOps guide |\n   170→| `EXECUTION-PLAN.md` | This document |\n   171→\n   172→---\n   173→\n   174→## COMMUNICATION\n   175→\n   176→### Telegram (@SocialHomesBot)\n   177→- **Async notifications**: Build status, deployment confirmations, test results\n   178→- **Permission requests**: Routed via Telegram when user is away from desk\n   179→- **Progress updates**: Phase/sprint completion summaries\n   180→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   181→\n   182→### Session Continuity\n   183→- Update `SESSION-HISTORY.md` at end of every session\n   184→- `CLAUDE.md` provides context for new sessions\n   185→- Entire.io captures checkpoints on commits\n   186→\n   187→---\n   188→\n   189→## METRICS & SUCCESS CRITERIA\n   190→\n   191→| Metric | Target |\n   192→|--------|--------|\n   193→| Selenium test pass rate | > 98% |\n   194→| TypeScript errors | 0 |\n   195→| Vite build warnings | 0 critical |\n   196→| API response time (P95) | < 500ms |\n   197→| WCAG AA compliance | 100% (text contrast, focus, keyboard) |\n   198→| External API uptime | > 99.5% (with fallback to simulated) |\n   199→| Bundle size | < 3MB (gzipped < 800KB) |\n   200→| Cloud Run cold start | < 3s |\n   201→\n   202→---\n   203→\n   204→**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**\n   205→"}]},"uuid":"2b343667-ac29-4337-8274-d68632d30e3d","timestamp":"2026-02-18T12:02:09.798Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.\n> Version 1.0 | 2026-02-14\n\n---\n\n## PHASE 0: INFRASTRUCTURE (Current Session — Complete)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |\n\n### Deliverables:\n- All Tier 1 (free, no-key) APIs live with real data\n- Firestore cache layer operational\n- Data model extended for external sources\n- Crime heatmap visible on Explore page\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |\n\n### Deliverables:\n- All 6 differentiators live with API routes and frontend panels\n- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS\n- AI Centre Differentiators tab shows all 6 features + vulnerability scan\n- TypeScript compiles clean, both builds pass\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |\n\n### Deliverables:\n- All 7 differentiators live\n- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)\n- Full GOV.UK Notify template library (24 templates, 7 categories)\n- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)\n- Form validation with inline errors on ActionModal\n- Contractor verification badges on repair detail\n- Data layer toggles (Crime/Damp/Compliance) on Explore map\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |\n| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |\n| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |\n\n### Deliverables:\n- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)\n- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test\n- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging\n- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint\n- All TypeScript clean, both builds pass\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |\n| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Purpose |\n|----------|---------|\n| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |\n| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |\n| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |\n| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |\n| `CLAUDE.md` | Claude Code project instructions |\n| `SESSION-HISTORY.md` | Persistent conversation history |\n| `DEV-FIX-LIST.md` | Bug/warning tracker |\n| `DEVOPS.md` | DevOps guide |\n| `EXECUTION-PLAN.md` | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target |\n|--------|--------|\n| Selenium test pass rate | > 98% |\n| TypeScript errors | 0 |\n| Vite build warnings | 0 critical |\n| API response time (P95) | < 500ms |\n| WCAG AA compliance | 100% (text contrast, focus, keyboard) |\n| External API uptime | > 99.5% (with fallback to simulated) |\n| Bundle size | < 3MB (gzipped < 800KB) |\n| Cloud Run cold start | < 3s |\n\n---\n\n**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**\n","numLines":205,"startLine":1,"totalLines":205}},"sourceToolAssistantUUID":"221cdff2-4dd1-4a37-9ec6-e2fa2b9418a4"}
{"parentUuid":"2b343667-ac29-4337-8274-d68632d30e3d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BD9EoU54YN7eR8c5cSWDsH","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll write the updated EXECUTION-PLAN.md with the new Phase 5 tasks:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4525,"cache_read_input_tokens":63751,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4525},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVx8f44fSWKG6ATLX5o","type":"assistant","uuid":"c77ae5af-33f7-4d20-94be-6fe77bba6cf2","timestamp":"2026-02-18T12:02:12.734Z"}
{"parentUuid":"c77ae5af-33f7-4d20-94be-6fe77bba6cf2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01BD9EoU54YN7eR8c5cSWDsH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015vQ5nbrnaV4aPbJjrzQFqk","name":"Write","input":{"file_path":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |\n| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4525,"cache_read_input_tokens":63751,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4525},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFVx8f44fSWKG6ATLX5o","type":"assistant","uuid":"7d5344ea-f6a1-46b9-8212-14a89f9a2e1e","timestamp":"2026-02-18T12:03:26.070Z"}
{"parentUuid":"7d5344ea-f6a1-46b9-8212-14a89f9a2e1e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015vQ5nbrnaV4aPbJjrzQFqk","type":"tool_result","content":"The file /mnt/c/.REDACTED.md has been overwritten successfully."}]},"uuid":"2d8120a0-13bb-475b-b738-6f3ec6ef2060","timestamp":"2026-02-18T12:03:26.123Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |\n| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**\n","structuredPatch":[{"oldStart":1,"oldLines":12,"newStart":1,"newLines":26,"lines":[" # SocialHomes.Ai — Master Execution Plan"," ","-> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.","-> Version 1.0 | 2026-02-14","+> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.","+> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent","+> Studio: Yantra Works"," "," ---"," ","-## PHASE 0: INFRASTRUCTURE (Current Session — Complete)","+## PLAN SUMMARY"," ","+| Phase | Name | Sprints | Status | Progress |","+|-------|------|---------|--------|----------|","+| 0 | Infrastructure | — | ✅ DONE | 10/10 |","+| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |","+| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |","+| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |","+| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |","+| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |","+","+---","+","+## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)","+"," | # | Task | Status | Agent |"," |---|------|--------|-------|"," | 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |"]},{"oldStart":22,"oldLines":152,"newStart":36,"newLines":210,"lines":[" "," ---"," ","-## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)","+## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)"," "," ### Goal: Core external API infrastructure + free API integrations"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |","-| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |","-| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |","-| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |","-| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |","-| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |","-| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |","-| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |","-| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |","-| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |","-| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |","-| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |","+| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |","+| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |","+| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |","+| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |","+| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |","+| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |","+| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |","+| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |","+| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |","+| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |","+| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |","+| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |"," ","-### Deliverables:","-- All Tier 1 (free, no-key) APIs live with real data","-- Firestore cache layer operational","-- Data model extended for external sources","-- Crime heatmap visible on Explore page","-"," ---"," ","-## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE","+## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)"," "," ### Goal: 7 killer differentiators + Tier 2 API registrations"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |","-| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |","-| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |","-| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |","-| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |","-| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |","-| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |","-| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |","-| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |","-| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |","-| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |","-| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |","-| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |","-| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |","+| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |","+| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |","+| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |","+| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |","+| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |","+| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |","+| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |","+| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |","+| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |","+| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |","+| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |","+| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |","+| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |","+| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |"," ","-### Deliverables:","-- All 6 differentiators live with API routes and frontend panels","-- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS","-- AI Centre Differentiators tab shows all 6 features + vulnerability scan","-- TypeScript compiles clean, both builds pass","-"," ---"," ","-## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE","+## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)"," "," ### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |","-| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |","-| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |","-| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |","-| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |","-| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |","-| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |","-| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |","-| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |","-| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |","-| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |","-| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |","-| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |","-| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |","-| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |","-| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |","-| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |","+| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |","+| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |","+| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |","+| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |","+| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |","+| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |","+| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |","+| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |","+| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |","+| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |","+| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |","+| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |","+| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |","+| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |","+| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |","+| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |","+| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |"," ","-### Deliverables:","-- All 7 differentiators live","-- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)","-- Full GOV.UK Notify template library (24 templates, 7 categories)","-- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)","-- Form validation with inline errors on ActionModal","-- Contractor verification badges on repair detail","-- Data layer toggles (Crime/Damp/Compliance) on Explore map","-"," ---"," ","-## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE","+## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)"," "," ### Goal: Mock services + polish + production hardening"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |","-| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |","-| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |","-| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |","-| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |","-| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |","-| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |","-| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |","-| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |","-| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |","-| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |","-| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |","-| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |","-| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |","+| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |","+| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |","+| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |","+| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |","+| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |","+| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |","+| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |","+| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |","+| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |","+| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |","+| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |","+| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |","+| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |","+| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |"," ","-### Deliverables:","-- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)","-- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test","-- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging","-- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint","-- All TypeScript clean, both builds pass","+---"," ","+## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)","+","+### Goal: Real AI, real-time features, advanced testing, production scaling","+","+Phase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.","+"," ---"," ","+### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)","+","+| # | Task | Priority | Complexity | Agent | Status |","+|---|------|----------|------------|-------|--------|","+| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |","+| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |","+| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |","+| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |","+| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |","+| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |","+| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |","+","+---","+","+### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)","+","+| # | Task | Priority | Complexity | Agent | Status |","+|---|------|----------|------------|-------|--------|","+| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |","+| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |","+| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |","+| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |","+| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |","+| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |","+| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |","+| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |","+| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |","+| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |","+","+---","+","+### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)","+","+| # | Task | Priority | Complexity | Agent | Status |","+|---|------|----------|------------|-------|--------|","+| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |","+| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |","+| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |","+| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |","+| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |","+| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |","+| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |","+| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |","+","+---","+","+### PHASE 5.4: TESTING & QA (Sprint 11)","+","+| # | Task | Priority | Complexity | Agent | Status |","+|---|------|----------|------------|-------|--------|","+| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |","+| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |","+| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |","+| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |","+| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |","+| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |","+| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |","+","+---","+","+### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)","+","+| # | Task | Priority | Complexity | Agent | Status |","+|---|------|----------|------------|-------|--------|","+| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |","+| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |","+| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |","+| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |","+| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |","+| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |","+| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |","+| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |","+","+---","+"," ## AGENT ROLES"," "," | Agent | Responsibility | Key Files |"," |-------|---------------|-----------|","-| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |","-| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |","-| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |","-| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |","-| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |","+| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |","+| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |","+| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |","+| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |","+| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |"," "," ---"," "," ## KEY DOCUMENTS"," ","-| Document | Purpose |","-|----------|---------|","-| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |","-| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |","-| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |","-| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |","-| `CLAUDE.md` | Claude Code project instructions |","-| `SESSION-HISTORY.md` | Persistent conversation history |","-| `DEV-FIX-LIST.md` | Bug/warning tracker |","-| `DEVOPS.md` | DevOps guide |","-| `EXECUTION-PLAN.md` | This document |","+| Document | Location | Purpose |","+|----------|----------|---------|","+| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |","+| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |","+| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |","+| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |","+| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |","+| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |","+| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |","+| CLAUDE.md | Project root | Claude Code project instructions |","+| SESSION-HISTORY.md | Project root | Persistent conversation history |","+| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |","+| DEVOPS.md | Project root | DevOps and deployment guide |","+| EXECUTION-PLAN.md | Project root | This document |"," "," ---"," "]},{"oldStart":188,"oldLines":17,"newStart":260,"newLines":44,"lines":[" "," ## METRICS & SUCCESS CRITERIA"," ","+| Metric | Target | Current |","+|--------|--------|---------|","+| Selenium test pass rate | > 98% | 99.7% ✅ |","+| TypeScript errors | 0 | 0 ✅ |","+| Vite build warnings | 0 critical | 0 ✅ |","+| API response time (P95) | < 500ms | ~200-300ms ✅ |","+| WCAG AA compliance | 100% | 100% ✅ |","+| External API uptime | > 99.5% (with fallback) | 100% ✅ |","+| Bundle size | < 3MB | ~2.5MB ✅ |","+| Cloud Run cold start | < 3s | < 2s ✅ |","+","+### Phase 5 Additional Targets","+"," | Metric | Target |"," |--------|--------|","-| Selenium test pass rate | > 98% |","-| TypeScript errors | 0 |","-| Vite build warnings | 0 critical |","-| API response time (P95) | < 500ms |","-| WCAG AA compliance | 100% (text contrast, focus, keyboard) |","-| External API uptime | > 99.5% (with fallback to simulated) |","-| Bundle size | < 3MB (gzipped < 800KB) |","-| Cloud Run cold start | < 3s |","+| AI response latency (Vertex AI) | < 3s for conversational queries |","+| WebSocket connection stability | > 99.9% uptime |","+| Load test (100 concurrent users) | P95 < 1s, 0 errors |","+| Selenium test coverage | > 95% of routes |","+| Unit test coverage (services) | > 80% line coverage |","+| Staging deployment frequency | Every PR |","+| Database backup frequency | Daily automated |","+| Lighthouse accessibility score | > 90 on all pages |"," "," ---"," ","-**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**","+## DEFERRED ITEMS (From Phases 3-4)","+","+Items deferred from earlier phases, now included in Phase 5:","+","+| Original ID | Task | New Phase 5 ID |","+|-------------|------|----------------|","+| 3.17 | E2E testing for all new features | 5.4.1 |","+| 4.12 | Full regression test suite | 5.4.1 |","+| 4.13 | Load testing (100 concurrent users) | 5.4.4 |","+| 4.14 | API reference documentation | 5.1.7 |","+| 4.9 | Cache warming, batch updates | 5.2.6 |","+","+---","+","+**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**"]}],"originalFile":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness.\n> Version 1.0 | 2026-02-14\n\n---\n\n## PHASE 0: INFRASTRUCTURE (Current Session — Complete)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | Medium | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | Medium | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | Low | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | Low | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | Medium | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | Low | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | Low | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | Medium | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | Medium | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | Medium | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | Medium | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | Medium | Documentation | DONE |\n\n### Deliverables:\n- All Tier 1 (free, no-key) APIs live with real data\n- Firestore cache layer operational\n- Data model extended for external sources\n- Crime heatmap visible on Explore page\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | High | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | High | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | High | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | High | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | High | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | High | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | Medium | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | Medium | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | Medium | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | Medium | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | High | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | Medium | Frontend | DONE |\n\n### Deliverables:\n- All 6 differentiators live with API routes and frontend panels\n- Mock endpoints ready for DWP UC, IoT, GoCardless, NOMIS\n- AI Centre Differentiators tab shows all 6 features + vulnerability scan\n- TypeScript compiles clean, both builds pass\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | High | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | High | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | Medium | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | Medium | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | Medium | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | Medium | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | Medium | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | Low | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | Low | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | Medium | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | Medium | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | Medium | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | Medium | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | Low | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | Medium | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | Medium | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | High | Tester | DEFERRED to Phase 4 |\n\n### Deliverables:\n- All 7 differentiators live\n- Tier 2 APIs integrated (Census, NOMIS, Gas Safe, Electrical Safety)\n- Full GOV.UK Notify template library (24 templates, 7 categories)\n- WCAG AA accessibility fixes (focus traps, skip links, reduced motion, ARIA)\n- Form validation with inline errors on ActionModal\n- Contractor verification badges on repair detail\n- Data layer toggles (Crime/Damp/Compliance) on Explore map\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | Medium | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | Medium | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | Medium | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | Medium | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | Medium | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | Low | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | Medium | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | Low | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | Medium | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | Medium | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | Medium | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | High | Tester | DEFERRED |\n| 4.13 | Load testing (100 concurrent users) | P2 | Medium | Tester | DEFERRED |\n| 4.14 | Documentation: API reference for integrations | P2 | Medium | BA | DEFERRED |\n\n### Deliverables:\n- 5 new mock service endpoints (Plentific, RSH/CORE, DocuSign, Experian, Land Registry)\n- Admin Integration Dashboard with 20 integrations across 3 tiers, toggle + test\n- Security hardened: CSP, CORS whitelist, rate limiting (4 tiers), security headers, structured error logging\n- Production monitoring: metrics middleware, health checks with Firestore ping, admin monitoring endpoint\n- All TypeScript clean, both builds pass\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium tests, unit tests, integration tests, load tests | `tests/`, `app/src/__tests__/` |\n| **BA** | Requirements, user stories, acceptance criteria | `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure | `cloudbuild.yaml`, `Dockerfile`, `.github/` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Purpose |\n|----------|---------|\n| `Doc1-SocialHomesAi-Base-Specification.txt` | Base product specification |\n| `Doc2-SocialHomesAi-AI-Native-Features.txt` | AI features specification |\n| `Doc3-Public-API-Integration-Requirements.txt` | Public API integration requirements (2,333 lines) |\n| `Doc4-UI-UX-Audit-Build-Guide.md` | Frontend UI/UX audit + build guide (441 lines) |\n| `CLAUDE.md` | Claude Code project instructions |\n| `SESSION-HISTORY.md` | Persistent conversation history |\n| `DEV-FIX-LIST.md` | Bug/warning tracker |\n| `DEVOPS.md` | DevOps guide |\n| `EXECUTION-PLAN.md` | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target |\n|--------|--------|\n| Selenium test pass rate | > 98% |\n| TypeScript errors | 0 |\n| Vite build warnings | 0 critical |\n| API response time (P95) | < 500ms |\n| WCAG AA compliance | 100% (text contrast, focus, keyboard) |\n| External API uptime | > 99.5% (with fallback to simulated) |\n| Bundle size | < 3MB (gzipped < 800KB) |\n| Cloud Run cold start | < 3s |\n\n---\n\n**Plan authored by Claude Opus 4.6 | SocialHomes.Ai | 2026-02-14**\n"},"sourceToolAssistantUUID":"7d5344ea-f6a1-46b9-8212-14a89f9a2e1e"}
{"parentUuid":"2d8120a0-13bb-475b-b738-6f3ec6ef2060","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01Nc4pT5xBqgHjE1BGuYCTdq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LsoM7i7nDCUbF77ZwtSTir","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"completed","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":6145,"cache_read_input_tokens":68276,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":6145},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW3m6g9Ph6uZc42yZjt","type":"assistant","uuid":"a0f25ad8-c4b1-478c-92ca-ab3c1275c13b","timestamp":"2026-02-18T12:03:31.879Z"}
{"parentUuid":"a0f25ad8-c4b1-478c-92ca-ab3c1275c13b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LsoM7i7nDCUbF77ZwtSTir","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"8614c7e5-9f4a-4562-8da5-b2d2b4f92915","timestamp":"2026-02-18T12:03:31.881Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"in_progress","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"completed","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"a0f25ad8-c4b1-478c-92ca-ab3c1275c13b"}
{"parentUuid":"8614c7e5-9f4a-4562-8da5-b2d2b4f92915","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01GKVRPFkNMHkX6jFq34foy4","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update SESSION-HISTORY.md:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":74421,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW4D3tZGdTNXdjEc17Y","type":"assistant","uuid":"51f223fc-34a6-4157-b355-f88ae8dd1c5e","timestamp":"2026-02-18T12:03:34.650Z"}
{"parentUuid":"51f223fc-34a6-4157-b355-f88ae8dd1c5e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01GKVRPFkNMHkX6jFq34foy4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AtVruwcN3Vm19Gzq3CRxA3","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","offset":350},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":323,"cache_read_input_tokens":74421,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":323},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW4D3tZGdTNXdjEc17Y","type":"assistant","uuid":"47ae3948-5012-4dd6-ab96-9edf00b64c5f","timestamp":"2026-02-18T12:03:35.310Z"}
{"parentUuid":"47ae3948-5012-4dd6-ab96-9edf00b64c5f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AtVruwcN3Vm19Gzq3CRxA3","type":"tool_result","content":"   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→"}]},"uuid":"790e8e08-c0fd-49f1-a194-c917a205e493","timestamp":"2026-02-18T12:03:35.339Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n","numLines":11,"startLine":350,"totalLines":360}},"sourceToolAssistantUUID":"47ae3948-5012-4dd6-ab96-9edf00b64c5f"}
{"parentUuid":"790e8e08-c0fd-49f1-a194-c917a205e493","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01424HJaP8PmiKJuKs6o9zRG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GPMbLH8T4sRTZHXw2rAoTV","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","old_string":"- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)","new_string":"- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":372,"cache_read_input_tokens":74744,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":372},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW4SU2hDJsLaBKciEHQ","type":"assistant","uuid":"6f12f085-436b-41e8-ae0d-e6c89ddc4c39","timestamp":"2026-02-18T12:04:05.068Z"}
{"parentUuid":"6f12f085-436b-41e8-ae0d-e6c89ddc4c39","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GPMbLH8T4sRTZHXw2rAoTV","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md has been updated successfully."}]},"uuid":"7491e757-c305-4052-a5b7-a84829a9033a","timestamp":"2026-02-18T12:04:05.119Z","toolUseResult":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","oldString":"- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)","newString":"- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)","originalFile":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n","structuredPatch":[{"oldStart":357,"oldLines":3,"newStart":357,"newLines":70,"lines":[" - **Firebase Project:** gen-lang-client-0146156913"," - **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`"," - **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)","+","+---","+","+## Session 8 — 2026-02-18 (Business Analyst Session)","+**Working directory:** `/mnt/c/.netapps/socialhomes`","+**Agent:** Business Analyst Agent (Claude Opus 4.6)","+","+### What happened:","+","+#### Task: Comprehensive Project Analysis & Specification Documents","+","+Performed full project analysis covering:","+- All 73 frontend TypeScript files across 19 page directories","+- All 43 backend TypeScript files (routes, services, middleware, models)","+- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)","+- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)","+- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs","+","+#### Created 3 Specification Documents in `docs/requirements/`:","+","+1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification","+   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status","+   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators","+   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance","+","+2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models","+   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring","+   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers","+   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)","+","+3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements","+   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap","+   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references","+","+#### Updated EXECUTION-PLAN.md (v2.0):","+","+- Preserved Phases 0–4 (all DONE) with progress counts","+- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):","+  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs","+  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling","+  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive","+  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline","+  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook","+- Added deferred items cross-reference table","+- Added Phase 5 metrics targets","+- Updated plan summary table","+","+### Files Changed:","+- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)","+- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)","+- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)","+- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)","+- `SESSION-HISTORY.md` (UPDATED — added Session 8)","+","+### Commits:","+- (pending — awaiting user instruction to commit)","+","+### Decisions Taken:","+- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root","+- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)","+- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)","+- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks","+- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder","+","+### Pending Work:","+- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)","+- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"6f12f085-436b-41e8-ae0d-e6c89ddc4c39"}
{"parentUuid":"7491e757-c305-4052-a5b7-a84829a9033a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_013ANEC6SKcT1WGQ9dnSXn7V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013to727MoyhEz4UUVpLZv6s","name":"TodoWrite","input":{"todos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"completed","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"completed","activeForm":"Updating session history"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1445,"cache_read_input_tokens":75116,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1445},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW6doxn5bXLEvGC6f21","type":"assistant","uuid":"0cef989b-8259-42ee-b0af-0876ee0278bf","timestamp":"2026-02-18T12:04:09.484Z"}
{"parentUuid":"0cef989b-8259-42ee-b0af-0876ee0278bf","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013to727MoyhEz4UUVpLZv6s","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"5cc432dd-d1c3-4aaf-acf9-7c8bee581d93","timestamp":"2026-02-18T12:04:09.486Z","toolUseResult":{"oldTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"completed","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating session history"}],"newTodos":[{"content":"Explore existing project structure and read all specification/requirement files","status":"completed","activeForm":"Exploring existing project structure and reading specification files"},{"content":"Create docs/requirements/ directory and Doc1-socialhomes-Base-Specification.txt","status":"completed","activeForm":"Creating base specification document"},{"content":"Create Doc2-socialhomes-Technical-Architecture.txt","status":"completed","activeForm":"Creating technical architecture document"},{"content":"Create Doc3-socialhomes-API-Requirements.txt","status":"completed","activeForm":"Creating API requirements document"},{"content":"Create/update EXECUTION-PLAN.md with detailed tasks for all 5 phases","status":"completed","activeForm":"Creating execution plan with phased tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"completed","activeForm":"Updating session history"}]},"sourceToolAssistantUUID":"0cef989b-8259-42ee-b0af-0876ee0278bf"}
{"parentUuid":"5cc432dd-d1c3-4aaf-acf9-7c8bee581d93","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01JHRnhD6AcjAW1sPUDa7t5o","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me send a Telegram notification:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":321,"cache_read_input_tokens":76561,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":321},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW6yfZSvRH94513kMKb","type":"assistant","uuid":"052d7d4f-1217-4517-a145-559c4029c300","timestamp":"2026-02-18T12:04:12.684Z"}
{"parentUuid":"052d7d4f-1217-4517-a145-559c4029c300","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01JHRnhD6AcjAW1sPUDa7t5o","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017kqs3Bc2nWLF5oZxDo2ZJ1","name":"mcp__telegram__notify_user","input":{"chat_id":"socialhomes:8020560167","message":"✅ BA Agent — Session 8 Complete\n\n📄 Created 3 specification docs in docs/requirements/:\n• Doc1: Base Specification (9 sections, 16 modules)\n• Doc2: Technical Architecture (10 sections, Firestore schemas, 50+ endpoints)  \n• Doc3: API Requirements (11 sections, 20 integrations, 3 tiers)\n\n📋 Updated EXECUTION-PLAN.md v2.0:\n• Phases 0–4: DONE (61 tasks completed)\n• Phase 5: EVOLUTION — 32 new tasks across 5 sub-phases\n  - 5.1 Architecture (7 tasks)\n  - 5.2 Backend (10 tasks)\n  - 5.3 Frontend (8 tasks)\n  - 5.4 Testing (7 tasks)\n  - 5.5 DevOps (8 tasks)\n\n📝 SESSION-HISTORY.md updated with Session 8 details."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":321,"cache_read_input_tokens":76561,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":321},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW6yfZSvRH94513kMKb","type":"assistant","uuid":"4e1c49f1-aa76-44ae-9061-afffd471bc78","timestamp":"2026-02-18T12:04:16.816Z"}
{"parentUuid":"4e1c49f1-aa76-44ae-9061-afffd471bc78","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017kqs3Bc2nWLF5oZxDo2ZJ1","type":"tool_result","content":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Session 8 Complete\n\n📄 Created 3 specification docs in docs/requirements/:\n• Doc1: Base Specification (9 sections, 16 modules)\n• Doc2: Technical Architecture (10 sections, Firestore schemas, 50+ endpoints)  \n• Doc3: API Requirements (11 sections, 20 integrations, 3 tiers)\n\n📋 Updated EXECUTION-PLAN.md v2.0:\n• Phases 0–4: DONE (61 tasks completed)\n• Phase 5: EVOLUTION — 32 new tasks across 5 sub-phases\n  - 5.1 Architecture (7 tasks)\n  - 5.2 Backend (10 tasks)\n  - 5.3 Frontend (8 tasks)\n  - 5.4 Testing (7 tasks)\n  - 5.5 DevOps (8 tasks)\n\n📝 SESSION-HISTORY.md updated with Session 8 details.\""}]}]},"uuid":"8639467c-96db-44b0-aa0d-7cf9f690eb9c","timestamp":"2026-02-18T12:04:17.026Z","toolUseResult":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Session 8 Complete\n\n📄 Created 3 specification docs in docs/requirements/:\n• Doc1: Base Specification (9 sections, 16 modules)\n• Doc2: Technical Architecture (10 sections, Firestore schemas, 50+ endpoints)  \n• Doc3: API Requirements (11 sections, 20 integrations, 3 tiers)\n\n📋 Updated EXECUTION-PLAN.md v2.0:\n• Phases 0–4: DONE (61 tasks completed)\n• Phase 5: EVOLUTION — 32 new tasks across 5 sub-phases\n  - 5.1 Architecture (7 tasks)\n  - 5.2 Backend (10 tasks)\n  - 5.3 Frontend (8 tasks)\n  - 5.4 Testing (7 tasks)\n  - 5.5 DevOps (8 tasks)\n\n📝 SESSION-HISTORY.md updated with Session 8 details.\""}],"sourceToolAssistantUUID":"4e1c49f1-aa76-44ae-9061-afffd471bc78"}
{"parentUuid":"8639467c-96db-44b0-aa0d-7cf9f690eb9c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","version":"2.1.45","gitBranch":"main","slug":"woolly-dancing-cherny","message":{"model":"claude-opus-4-6","id":"msg_01FX8TcWkk8618jN52zTSrT2","type":"message","role":"assistant","content":[{"type":"text","text":"All tasks are complete. Here's a summary of what was accomplished:\n\n---\n\n## ✅ Business Analyst Session Complete\n\n### Documents Created in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification covering:\n   - 16 functional modules (Dashboard, Explore, Tenancies, Properties, Repairs, Compliance, Complaints, ASB, Rent, Allocations, Communications, Reports, AI Centre, Briefing, Admin, Tenant Portal)\n   - 5 persona system with scoped data visibility\n   - 8 AI prediction models and 7 killer differentiators\n   - Regulatory compliance (Housing Ombudsman, Awaab's Law, Building Safety Act, TSM, CORE, GDPR)\n   - Non-functional requirements (performance, security, accessibility)\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture covering:\n   - Full system architecture diagram (Cloud Run → Express → Firestore → External APIs)\n   - Frontend architecture (React 19, 40+ routes, data fetching layer)\n   - Backend architecture (16 route modules, 20 services, 5 middleware)\n   - Complete Firestore data models (17 collections with field-level schemas)\n   - 50+ API endpoints documented\n   - Security, deployment, and monitoring architecture\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements covering:\n   - 3 Tier 1 APIs (Police.uk, Open-Meteo, DEFRA) — all LIVE\n   - 6 Tier 2 APIs (Postcodes.io, EPC, Census, NOMIS, Gas Safe, NICEIC) — LIVE with fallbacks\n   - 8 Tier 3 APIs (DWP UC, IoT, GoCardless, Plentific, DocuSign, Experian, Land Registry, RSH) — MOCK\n   - 7 killer differentiator service algorithms documented\n   - Caching architecture, rate limiting, error handling, future roadmap\n\n### EXECUTION-PLAN.md Updated to v2.0:\n- **Phases 0–4**: All preserved as DONE (61 tasks completed)\n- **Phase 5: Evolution** — 32 new tasks organized into 5 sub-phases:\n  - **5.1 Project Setup & Architecture** (7 tasks) — Vertex AI design, WebSocket, SaaS, API docs\n  - **5.2 Backend Development** (10 tasks) — Gemini AI, WebSocket, notifications, circuit breaker\n  - **5.3 Frontend Development** (8 tasks) — Chat UI, real-time, workflow builder, mobile\n  - **5.4 Testing & QA** (7 tasks) — Regression, unit tests, load testing, CI pipeline\n  - **5.5 DevOps & Deployment** (8 tasks) — Staging, monitoring, backups, CDN, custom domain"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":581,"cache_read_input_tokens":76882,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":581},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYFW7WYvjZaHMaxnsLRcM","type":"assistant","uuid":"fd428278-c624-408b-b09f-0718125dcd48","timestamp":"2026-02-18T12:04:31.586Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-18T12:07:57.409Z","sessionId":"95f52e30-6a79-4cc9-9eaf-4e193a7920a2","content":"{\"task_id\":\"ae82711\",\"description\":\"Explore full project structure\",\"task_type\":\"local_agent\"}"}
