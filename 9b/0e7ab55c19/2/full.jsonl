{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-26T07:33:25.627Z","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-26T07:33:25.628Z","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"6e7333d8-1b3a-4cb1-b42c-5f4c608b0501","toolUseID":"6e7333d8-1b3a-4cb1-b42c-5f4c608b0501","timestamp":"2026-02-26T07:33:23.834Z","uuid":"86bf2906-9818-450f-af57-102f7a41908f"}
{"parentUuid":"86bf2906-9818-450f-af57-102f7a41908f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"c9b046dd-f05c-49cd-b59c-146e3d395e93","timestamp":"2026-02-26T07:33:25.659Z","permissionMode":"bypassPermissions"}
{"parentUuid":"c9b046dd-f05c-49cd-b59c-146e3d395e93","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01PB1NGMwqvWPkicMrTBcgFF","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to analyze the \"socialhomes\" project and create comprehensive specification documents and an execution plan. Let me start by exploring the existing codebase, reading any existing documentation, and understanding the project structure.\n\nLet me do this systematically:\n1. First, explore the project structure\n2. Read existing specification documents and key files\n3. Create the docs/requirements/ directory and specification documents\n4. Create/update EXECUTION-PLAN.md","signature":"EosFCkYICxgCKkB40Mg6+JQtPg4F6mmPcqVW7hQhPjjBoVZKY/1kNbtHFEvHCnM0WayfHs5FeSwHpShkxAQ+w54izRs2C5gnjxigEgx+4hoGvguIml4w4JkaDIp5a77T8cCigGWfFSIwUxhVMwiVeVYJVAYCOYAgsqxWTp9JnIQ4U0GhX13Oy69PEhifhhENRHA1PLKcq8rDKvIDyJB9OiCY4dEga02hZzivCjj3xCJwg2I592S/oFxgElaPLnW1Bp3jAn2fnNiUDHAOBMKxqCEQIpJ2wBGuNy3MOzOC0PpQGK9dwgnqpi5Dt8/bczaBz43QKG0tYPZpX93vZV9+dcdyDp/cDi5YxMALRC08WSbj1RwLFXOBrMBENByVE1WMQRLUWQZP3q5KwELkyvTzujwGzmbMCZDxqHmoU6ANpTrwKRHVGyVKV4FImOkQLTqMk9Rx/xiDPEi3zVvW4wA5AfSnIfudjbeioWdPc70hEhZTuvVCSvU/ulW9bt6h1HVvRf1MC7RKgBt+5dbEMX4la8XDsoR54aXmgTKv1tGfipJ+FYCCb1I2oHtT9t88d/qwsEkY6Gq4eH5JjrmlrbaPm0K3kByMgReuC/lUFraXAm49l9WnZBv+mCtI6NS6ocmyNTJEpn3110lOmxVT8j9BQYVKD/2G/1J1tdScMd74JYyqZJwhi4Vg9uGTLARsw2ge/9x1Li+1ZK+zKLxdieiR7YuEC2j+UnVsTmWv3xL/mkztCizKDMrczXPDtzOlvV/wbFr6HGaowbvAWcMyJufzPlAimxSZC0ZP13pUz63zKL3qCqbv/mB8pDJwI9VLp7hIwCCdeRUYyjXCtzH7gXV7UXzN2q/dkuqrgElfkWSaGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJgQWsLp56bz1jAWEwD","type":"assistant","uuid":"74bafe60-a424-4cf7-ad93-4e2a544e7a87","timestamp":"2026-02-26T07:43:21.130Z"}
{"parentUuid":"74bafe60-a424-4cf7-ad93-4e2a544e7a87","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01PB1NGMwqvWPkicMrTBcgFF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XzDy586u4jTa6zc7ijBsTF","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"output_tokens":379,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":4835,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWJgQWsLp56bz1jAWEwD","type":"assistant","uuid":"7301f84c-ab75-4969-a33d-d44d22ae8447","timestamp":"2026-02-26T07:43:24.553Z"}
{"parentUuid":"7301f84c-ab75-4969-a33d-d44d22ae8447","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XzDy586u4jTa6zc7ijBsTF","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"6b6b9291-60a6-4d32-967f-4fb9ce254772","timestamp":"2026-02-26T07:43:24.562Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"7301f84c-ab75-4969-a33d-d44d22ae8447"}
{"parentUuid":"6b6b9291-60a6-4d32-967f-4fb9ce254772","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01HaAEHXBPHuk2gUPYyR8FPp","type":"message","role":"assistant","content":[{"type":"text","text":"Let me start by exploring the project structure and reading all existing documentation."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":420,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":420},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJh62eqt7D3nEJqPi1c","type":"assistant","uuid":"6033abd1-dfcf-4ca3-b37e-bbb9d81d770c","timestamp":"2026-02-26T07:43:27.916Z"}
{"parentUuid":"6033abd1-dfcf-4ca3-b37e-bbb9d81d770c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01HaAEHXBPHuk2gUPYyR8FPp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AC1q5BzwETTLbg2gy2SC3S","name":"Bash","input":{"command":"ls -la /mnt/c/.netapps/socialhomes/","description":"List project root files"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":420,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":420},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJh62eqt7D3nEJqPi1c","type":"assistant","uuid":"4fe81d04-e19f-480b-aeb7-1f56d0251432","timestamp":"2026-02-26T07:43:28.709Z"}
{"parentUuid":"4fe81d04-e19f-480b-aeb7-1f56d0251432","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01HaAEHXBPHuk2gUPYyR8FPp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016nDJUo4cPdQRjGft19KagD","name":"Bash","input":{"command":"find /mnt/c/.netapps/socialhomes -maxdepth 1 -type f -name \"*.md\" -o -name \"*.txt\" -o -name \"*.json\" | sort","description":"List root-level docs and config files"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":420,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":420},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJh62eqt7D3nEJqPi1c","type":"assistant","uuid":"f4c45f6b-3185-4c71-a588-cabdeb117f90","timestamp":"2026-02-26T07:43:29.759Z"}
{"parentUuid":"f4c45f6b-3185-4c71-a588-cabdeb117f90","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01HaAEHXBPHuk2gUPYyR8FPp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XTJTjodt8tAqTGJTdwT5Sm","name":"Bash","input":{"command":"find /mnt/c/.netapps/socialhomes -maxdepth 3 -type d | head -80","description":"List directory structure up to 3 levels"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":420,"cache_read_input_tokens":19143,"output_tokens":298,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":420,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWJh62eqt7D3nEJqPi1c","type":"assistant","uuid":"6d38ec8e-b9ff-4065-b19c-71599c92bbc2","timestamp":"2026-02-26T07:43:30.538Z"}
{"parentUuid":"f4c45f6b-3185-4c71-a588-cabdeb117f90","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016nDJUo4cPdQRjGft19KagD","type":"tool_result","content":"/mnt/c/.netapps/socialhomes/CLAUDE.md\n/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md\n/mnt/c/.netapps/socialhomes/DEVOPS.md\n/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt\n/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt\n/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt\n/mnt/c/.netapps/socialhomes/Doc4-UI-UX-Audit-Build-Guide.md\n/mnt/c/.REDACTED.md\n/mnt/c/.netapps/socialhomes/firestore.indexes.json\n/mnt/c/.netapps/socialhomes/.mcp.json\n/mnt/c/.netapps/socialhomes/README.md\n/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md\n/mnt/c/.netapps/socialhomes/TEST-REPORT.md\n/mnt/c/.netapps/socialhomes/TEST-REPORT-V2.md","is_error":false}]},"uuid":"d5a0c564-37b5-49ba-808a-e7e297e22558","timestamp":"2026-02-26T07:43:31.362Z","toolUseResult":{"stdout":"/mnt/c/.netapps/socialhomes/CLAUDE.md\n/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md\n/mnt/c/.netapps/socialhomes/DEVOPS.md\n/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt\n/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt\n/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt\n/mnt/c/.netapps/socialhomes/Doc4-UI-UX-Audit-Build-Guide.md\n/mnt/c/.REDACTED.md\n/mnt/c/.netapps/socialhomes/firestore.indexes.json\n/mnt/c/.netapps/socialhomes/.mcp.json\n/mnt/c/.netapps/socialhomes/README.md\n/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md\n/mnt/c/.netapps/socialhomes/TEST-REPORT.md\n/mnt/c/.netapps/socialhomes/TEST-REPORT-V2.md","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"f4c45f6b-3185-4c71-a588-cabdeb117f90"}
{"parentUuid":"4fe81d04-e19f-480b-aeb7-1f56d0251432","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AC1q5BzwETTLbg2gy2SC3S","type":"tool_result","content":"total 440\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 19:42 .\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 23 22:16 ..\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 23:41 app\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 14 04:54 .claude\n-rwxrwxrwx 1 rajiv rajiv  2218 Feb 14 03:13 CLAUDE.md\n-rwxrwxrwx 1 rajiv rajiv  2269 Feb 21 11:15 cloudbuild.yaml\n-rwxrwxrwx 1 rajiv rajiv  5173 Feb 21 11:15 DEV-FIX-LIST.md\n-rwxrwxrwx 1 rajiv rajiv 36150 Feb 16 03:40 DEVOPS.md\n-rwxrwxrwx 1 rajiv rajiv 28633 Feb  7 17:34 Doc1-SocialHomesAi-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 32377 Feb  7 17:34 Doc2-SocialHomesAi-AI-Native-Features.txt\n-rwxrwxrwx 1 rajiv rajiv 98343 Feb 14 03:20 Doc3-Public-API-Integration-Requirements.txt\n-rwxrwxrwx 1 rajiv rajiv 15588 Feb 14 03:21 Doc4-UI-UX-Audit-Build-Guide.md\n-rwxrwxrwx 1 rajiv rajiv  1421 Feb  9 01:12 Dockerfile\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 18 11:54 docs\n-rwxrwxrwx 1 rajiv rajiv  6148 Feb  7 18:29 .DS_Store\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 14 15:05 .entire\n-rwxrwxrwx 1 rajiv rajiv 31289 Feb 25 19:41 EXECUTION-PLAN.md\n-rwxrwxrwx 1 rajiv rajiv  3804 Feb  8 21:54 firestore.indexes.json\n-rwxrwxrwx 1 rajiv rajiv  4195 Feb  8 21:54 firestore.rules\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 26 07:37 .git\n-rwxrwxrwx 1 rajiv rajiv   876 Feb 16 03:29 .gitignore\n-rwxrwxrwx 1 rajiv rajiv   291 Feb 14 03:14 .mcp.json\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 00:44 .mission-control\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 18:48 node_modules\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 17:26 page-screenshots\n-rwxrwxrwx 1 rajiv rajiv    16 Feb  8 21:55 README.md\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 17:26 scripts\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 16 03:28 server\n-rwxrwxrwx 1 rajiv rajiv 28904 Feb 25 19:42 SESSION-HISTORY.md\n-rwxrwxrwx 1 rajiv rajiv 28905 Feb  8 23:26 TEST-REPORT.md\n-rwxrwxrwx 1 rajiv rajiv 86543 Feb  9 09:33 TEST-REPORT-V2.md\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 16 19:39 tests\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 18:15 UK Housing Data Standard Version 3.5","is_error":false}]},"uuid":"15b5d618-db78-40c2-83e4-ded50a6c8ed4","timestamp":"2026-02-26T07:43:31.408Z","toolUseResult":{"stdout":"total 440\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 19:42 .\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 23 22:16 ..\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 23:41 app\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 14 04:54 .claude\n-rwxrwxrwx 1 rajiv rajiv  2218 Feb 14 03:13 CLAUDE.md\n-rwxrwxrwx 1 rajiv rajiv  2269 Feb 21 11:15 cloudbuild.yaml\n-rwxrwxrwx 1 rajiv rajiv  5173 Feb 21 11:15 DEV-FIX-LIST.md\n-rwxrwxrwx 1 rajiv rajiv 36150 Feb 16 03:40 DEVOPS.md\n-rwxrwxrwx 1 rajiv rajiv 28633 Feb  7 17:34 Doc1-SocialHomesAi-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 32377 Feb  7 17:34 Doc2-SocialHomesAi-AI-Native-Features.txt\n-rwxrwxrwx 1 rajiv rajiv 98343 Feb 14 03:20 Doc3-Public-API-Integration-Requirements.txt\n-rwxrwxrwx 1 rajiv rajiv 15588 Feb 14 03:21 Doc4-UI-UX-Audit-Build-Guide.md\n-rwxrwxrwx 1 rajiv rajiv  1421 Feb  9 01:12 Dockerfile\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 18 11:54 docs\n-rwxrwxrwx 1 rajiv rajiv  6148 Feb  7 18:29 .DS_Store\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 14 15:05 .entire\n-rwxrwxrwx 1 rajiv rajiv 31289 Feb 25 19:41 EXECUTION-PLAN.md\n-rwxrwxrwx 1 rajiv rajiv  3804 Feb  8 21:54 firestore.indexes.json\n-rwxrwxrwx 1 rajiv rajiv  4195 Feb  8 21:54 firestore.rules\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 26 07:37 .git\n-rwxrwxrwx 1 rajiv rajiv   876 Feb 16 03:29 .gitignore\n-rwxrwxrwx 1 rajiv rajiv   291 Feb 14 03:14 .mcp.json\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 00:44 .mission-control\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 18:48 node_modules\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 17:26 page-screenshots\n-rwxrwxrwx 1 rajiv rajiv    16 Feb  8 21:55 README.md\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 17:26 scripts\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 16 03:28 server\n-rwxrwxrwx 1 rajiv rajiv 28904 Feb 25 19:42 SESSION-HISTORY.md\n-rwxrwxrwx 1 rajiv rajiv 28905 Feb  8 23:26 TEST-REPORT.md\n-rwxrwxrwx 1 rajiv rajiv 86543 Feb  9 09:33 TEST-REPORT-V2.md\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 16 19:39 tests\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 13 18:15 UK Housing Data Standard Version 3.5","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"4fe81d04-e19f-480b-aeb7-1f56d0251432"}
{"parentUuid":"6d38ec8e-b9ff-4065-b19c-71599c92bbc2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XTJTjodt8tAqTGJTdwT5Sm","type":"tool_result","content":"/mnt/c/.netapps/socialhomes\n/mnt/c/.netapps/socialhomes/.claude\n/mnt/c/.netapps/socialhomes/.entire\n/mnt/c/.netapps/socialhomes/.entire/logs\n/mnt/c/.netapps/socialhomes/.entire/metadata\n/mnt/c/.netapps/socialhomes/.entire/metadata/04e29004-abee-469c-be92-00aa04948dea\n/mnt/c/.netapps/socialhomes/.entire/metadata/2d01b0dc-c017-4e54-8211-edc595314a6c\n/mnt/c/.netapps/socialhomes/.entire/metadata/2e32e6fd-0190-41d1-84ac-f5552aab3107\n/mnt/c/.netapps/socialhomes/.entire/metadata/3074a5ea-56f9-4dba-889b-0cdb15c6b7a3\n/mnt/c/.netapps/socialhomes/.entire/metadata/549e3cf8-d48c-4a1f-9d35-3ca566450dd1\n/mnt/c/.netapps/socialhomes/.entire/metadata/581422cf-3f4d-48aa-b2f6-552d4ab11ae5\n/mnt/c/.netapps/socialhomes/.entire/metadata/8e0a3497-db1e-4904-aab3-67095b930c27\n/mnt/c/.netapps/socialhomes/.entire/metadata/95f52e30-6a79-4cc9-9eaf-4e193a7920a2\n/mnt/c/.netapps/socialhomes/.entire/metadata/a07abfb0-00fc-4cd7-9b2e-dd73fd03a6e8\n/mnt/c/.netapps/socialhomes/.entire/metadata/ba7d8c17-5512-40ee-b8be-8d66e8c531ce\n/mnt/c/.netapps/socialhomes/.entire/metadata/d8bc31f5-b604-4de4-a1b0-0ef95aad0049\n/mnt/c/.netapps/socialhomes/.entire/metadata/e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6\n/mnt/c/.netapps/socialhomes/.entire/tmp\n/mnt/c/.netapps/socialhomes/.git\n/mnt/c/.netapps/socialhomes/.git/entire-sessions\n/mnt/c/.netapps/socialhomes/.git/hooks\n/mnt/c/.netapps/socialhomes/.git/info\n/mnt/c/.netapps/socialhomes/.git/logs\n/mnt/c/.netapps/socialhomes/.git/logs/refs\n/mnt/c/.netapps/socialhomes/.git/objects\n/mnt/c/.netapps/socialhomes/.git/objects/00\n/mnt/c/.netapps/socialhomes/.git/objects/01\n/mnt/c/.netapps/socialhomes/.git/objects/02\n/mnt/c/.netapps/socialhomes/.git/objects/03\n/mnt/c/.netapps/socialhomes/.git/objects/04\n/mnt/c/.netapps/socialhomes/.git/objects/05\n/mnt/c/.netapps/socialhomes/.git/objects/06\n/mnt/c/.netapps/socialhomes/.git/objects/07\n/mnt/c/.netapps/socialhomes/.git/objects/08\n/mnt/c/.netapps/socialhomes/.git/objects/09\n/mnt/c/.netapps/socialhomes/.git/objects/0a\n/mnt/c/.netapps/socialhomes/.git/objects/0b\n/mnt/c/.netapps/socialhomes/.git/objects/0c\n/mnt/c/.netapps/socialhomes/.git/objects/0d\n/mnt/c/.netapps/socialhomes/.git/objects/0e\n/mnt/c/.netapps/socialhomes/.git/objects/0f\n/mnt/c/.netapps/socialhomes/.git/objects/10\n/mnt/c/.netapps/socialhomes/.git/objects/11\n/mnt/c/.netapps/socialhomes/.git/objects/12\n/mnt/c/.netapps/socialhomes/.git/objects/13\n/mnt/c/.netapps/socialhomes/.git/objects/14\n/mnt/c/.netapps/socialhomes/.git/objects/15\n/mnt/c/.netapps/socialhomes/.git/objects/16\n/mnt/c/.netapps/socialhomes/.git/objects/17\n/mnt/c/.netapps/socialhomes/.git/objects/18\n/mnt/c/.netapps/socialhomes/.git/objects/19\n/mnt/c/.netapps/socialhomes/.git/objects/1a\n/mnt/c/.netapps/socialhomes/.git/objects/1b\n/mnt/c/.netapps/socialhomes/.git/objects/1c\n/mnt/c/.netapps/socialhomes/.git/objects/1d\n/mnt/c/.netapps/socialhomes/.git/objects/1e\n/mnt/c/.netapps/socialhomes/.git/objects/1f\n/mnt/c/.netapps/socialhomes/.git/objects/20\n/mnt/c/.netapps/socialhomes/.git/objects/21\n/mnt/c/.netapps/socialhomes/.git/objects/22\n/mnt/c/.netapps/socialhomes/.git/objects/23\n/mnt/c/.netapps/socialhomes/.git/objects/24\n/mnt/c/.netapps/socialhomes/.git/objects/25\n/mnt/c/.netapps/socialhomes/.git/objects/26\n/mnt/c/.netapps/socialhomes/.git/objects/27\n/mnt/c/.netapps/socialhomes/.git/objects/28\n/mnt/c/.netapps/socialhomes/.git/objects/29\n/mnt/c/.netapps/socialhomes/.git/objects/2a\n/mnt/c/.netapps/socialhomes/.git/objects/2b\n/mnt/c/.netapps/socialhomes/.git/objects/2c\n/mnt/c/.netapps/socialhomes/.git/objects/2d\n/mnt/c/.netapps/socialhomes/.git/objects/2e\n/mnt/c/.netapps/socialhomes/.git/objects/2f\n/mnt/c/.netapps/socialhomes/.git/objects/30\n/mnt/c/.netapps/socialhomes/.git/objects/31\n/mnt/c/.netapps/socialhomes/.git/objects/32\n/mnt/c/.netapps/socialhomes/.git/objects/33\n/mnt/c/.netapps/socialhomes/.git/objects/35\n/mnt/c/.netapps/socialhomes/.git/objects/36\n/mnt/c/.netapps/socialhomes/.git/objects/37","is_error":false}]},"uuid":"5ec21ff7-b785-4584-ac69-a1375f8e7581","timestamp":"2026-02-26T07:43:31.477Z","toolUseResult":{"stdout":"/mnt/c/.netapps/socialhomes\n/mnt/c/.netapps/socialhomes/.claude\n/mnt/c/.netapps/socialhomes/.entire\n/mnt/c/.netapps/socialhomes/.entire/logs\n/mnt/c/.netapps/socialhomes/.entire/metadata\n/mnt/c/.netapps/socialhomes/.entire/metadata/04e29004-abee-469c-be92-00aa04948dea\n/mnt/c/.netapps/socialhomes/.entire/metadata/2d01b0dc-c017-4e54-8211-edc595314a6c\n/mnt/c/.netapps/socialhomes/.entire/metadata/2e32e6fd-0190-41d1-84ac-f5552aab3107\n/mnt/c/.netapps/socialhomes/.entire/metadata/3074a5ea-56f9-4dba-889b-0cdb15c6b7a3\n/mnt/c/.netapps/socialhomes/.entire/metadata/549e3cf8-d48c-4a1f-9d35-3ca566450dd1\n/mnt/c/.netapps/socialhomes/.entire/metadata/581422cf-3f4d-48aa-b2f6-552d4ab11ae5\n/mnt/c/.netapps/socialhomes/.entire/metadata/8e0a3497-db1e-4904-aab3-67095b930c27\n/mnt/c/.netapps/socialhomes/.entire/metadata/95f52e30-6a79-4cc9-9eaf-4e193a7920a2\n/mnt/c/.netapps/socialhomes/.entire/metadata/a07abfb0-00fc-4cd7-9b2e-dd73fd03a6e8\n/mnt/c/.netapps/socialhomes/.entire/metadata/ba7d8c17-5512-40ee-b8be-8d66e8c531ce\n/mnt/c/.netapps/socialhomes/.entire/metadata/d8bc31f5-b604-4de4-a1b0-0ef95aad0049\n/mnt/c/.netapps/socialhomes/.entire/metadata/e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6\n/mnt/c/.netapps/socialhomes/.entire/tmp\n/mnt/c/.netapps/socialhomes/.git\n/mnt/c/.netapps/socialhomes/.git/entire-sessions\n/mnt/c/.netapps/socialhomes/.git/hooks\n/mnt/c/.netapps/socialhomes/.git/info\n/mnt/c/.netapps/socialhomes/.git/logs\n/mnt/c/.netapps/socialhomes/.git/logs/refs\n/mnt/c/.netapps/socialhomes/.git/objects\n/mnt/c/.netapps/socialhomes/.git/objects/00\n/mnt/c/.netapps/socialhomes/.git/objects/01\n/mnt/c/.netapps/socialhomes/.git/objects/02\n/mnt/c/.netapps/socialhomes/.git/objects/03\n/mnt/c/.netapps/socialhomes/.git/objects/04\n/mnt/c/.netapps/socialhomes/.git/objects/05\n/mnt/c/.netapps/socialhomes/.git/objects/06\n/mnt/c/.netapps/socialhomes/.git/objects/07\n/mnt/c/.netapps/socialhomes/.git/objects/08\n/mnt/c/.netapps/socialhomes/.git/objects/09\n/mnt/c/.netapps/socialhomes/.git/objects/0a\n/mnt/c/.netapps/socialhomes/.git/objects/0b\n/mnt/c/.netapps/socialhomes/.git/objects/0c\n/mnt/c/.netapps/socialhomes/.git/objects/0d\n/mnt/c/.netapps/socialhomes/.git/objects/0e\n/mnt/c/.netapps/socialhomes/.git/objects/0f\n/mnt/c/.netapps/socialhomes/.git/objects/10\n/mnt/c/.netapps/socialhomes/.git/objects/11\n/mnt/c/.netapps/socialhomes/.git/objects/12\n/mnt/c/.netapps/socialhomes/.git/objects/13\n/mnt/c/.netapps/socialhomes/.git/objects/14\n/mnt/c/.netapps/socialhomes/.git/objects/15\n/mnt/c/.netapps/socialhomes/.git/objects/16\n/mnt/c/.netapps/socialhomes/.git/objects/17\n/mnt/c/.netapps/socialhomes/.git/objects/18\n/mnt/c/.netapps/socialhomes/.git/objects/19\n/mnt/c/.netapps/socialhomes/.git/objects/1a\n/mnt/c/.netapps/socialhomes/.git/objects/1b\n/mnt/c/.netapps/socialhomes/.git/objects/1c\n/mnt/c/.netapps/socialhomes/.git/objects/1d\n/mnt/c/.netapps/socialhomes/.git/objects/1e\n/mnt/c/.netapps/socialhomes/.git/objects/1f\n/mnt/c/.netapps/socialhomes/.git/objects/20\n/mnt/c/.netapps/socialhomes/.git/objects/21\n/mnt/c/.netapps/socialhomes/.git/objects/22\n/mnt/c/.netapps/socialhomes/.git/objects/23\n/mnt/c/.netapps/socialhomes/.git/objects/24\n/mnt/c/.netapps/socialhomes/.git/objects/25\n/mnt/c/.netapps/socialhomes/.git/objects/26\n/mnt/c/.netapps/socialhomes/.git/objects/27\n/mnt/c/.netapps/socialhomes/.git/objects/28\n/mnt/c/.netapps/socialhomes/.git/objects/29\n/mnt/c/.netapps/socialhomes/.git/objects/2a\n/mnt/c/.netapps/socialhomes/.git/objects/2b\n/mnt/c/.netapps/socialhomes/.git/objects/2c\n/mnt/c/.netapps/socialhomes/.git/objects/2d\n/mnt/c/.netapps/socialhomes/.git/objects/2e\n/mnt/c/.netapps/socialhomes/.git/objects/2f\n/mnt/c/.netapps/socialhomes/.git/objects/30\n/mnt/c/.netapps/socialhomes/.git/objects/31\n/mnt/c/.netapps/socialhomes/.git/objects/32\n/mnt/c/.netapps/socialhomes/.git/objects/33\n/mnt/c/.netapps/socialhomes/.git/objects/35\n/mnt/c/.netapps/socialhomes/.git/objects/36\n/mnt/c/.netapps/socialhomes/.git/objects/37","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"6d38ec8e-b9ff-4065-b19c-71599c92bbc2"}
{"parentUuid":"5ec21ff7-b785-4584-ac69-a1375f8e7581","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read all the existing specification documents and key files in parallel:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"8b7654f6-191b-43b8-ab6e-27bcee74253f","timestamp":"2026-02-26T07:43:34.012Z"}
{"parentUuid":"8b7654f6-191b-43b8-ab6e-27bcee74253f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01T9GwoedTUFPyMKM1Se6gSc","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"b18b59ef-4fb6-4984-9118-4b628e7d1834","timestamp":"2026-02-26T07:43:34.486Z"}
{"parentUuid":"b18b59ef-4fb6-4984-9118-4b628e7d1834","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01T9GwoedTUFPyMKM1Se6gSc","type":"tool_result","content":"     1→# DOCUMENT 1 OF 2: BASE APPLICATION SPECIFICATION\n     2→# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n     3→\n     4→## INSTRUCTION TO AI\n     5→\n     6→You are building **SocialHomes.Ai**, a comprehensive, open-source, AI-native housing management system for UK social housing providers (housing associations and local authorities) managing 5,000–20,000 units. Created by **Yantra.Works**.\n     7→\n     8→Build a complete, multi-page React application. This is NOT a legacy housing system with a fresh coat of paint. This must look and feel like nothing the social housing sector has ever seen — think Bloomberg Terminal meets Figma, not a government form. The sector is dominated by ugly, slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai is the opposite: dark, fast, visually stunning, animated, intelligent.\n     9→\n    10→There is a companion document (Document 2) that specifies all AI-native features, dynamic buttons/fields, personas, admin system, and prediction models. Build the base application first using this document, then apply Document 2's features.\n    11→\n    12→---\n    13→\n    14→## TECHNICAL STACK\n    15→\n    16→- **React 19** with functional components, hooks, Suspense\n    17→- **React Router v7** for client-side routing with nested routes\n    18→- **Tailwind CSS v4** via CDN — Yantra.Works dark-mode-first brand language\n    19→- **Three.js (r128)** via `https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js` — for 3D building visualisations in the drill-down\n    20→- **Leaflet 1.9** with OpenStreetMap tiles — for 2D map views (free, no API key)\n    21→- **Recharts** for dashboards and charts\n    22→- **D3.js** for advanced visualisations (Sankey diagrams, heatmaps)\n    23→- **Lucide React** for iconography\n    24→- **Animations**: CSS transitions and keyframe animations throughout — every page load has staggered reveals, every panel slides, every card fades in, status changes animate. The UI must feel ALIVE, not static.\n    25→- **State management**: React Context + useReducer\n    26→- Do NOT use localStorage or sessionStorage\n    27→\n    28→---\n    29→\n    30→## BRANDING\n    31→\n    32→### Logo\n    33→The product logo is the Yantra.Works geometric mark in teal. Embed this SVG inline:\n    34→\n    35→```svg\n    36→<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 751 772\" width=\"36\" height=\"37\">\n    37→  <path fill=\"#058995\" d=\"M745.51,390.8l-95.41-91.94-41.32,42.88,48.94,47.16-250.45,254.19-1.31-194.04,12.47-12.74-.31-.3,143.2-143.64.08.08,42.88-42.58-.29-.29,1-1-41.76-41.63-.79.79L377.89,21.94l-1.41,1.4-.43-.44L10.05,385.9l.67.67-2.57,2.54,325.25,328.97-.16.16,12.35,12.17,30.65,31,.41-.4,2.02,1.99,324.99-329.84.55.53,41.32-42.88ZM345.09,452.5l1.28,189.95-251.12-253.99,92.74-91.98,144.76,141.66-1.03,1.03,13.37,13.33ZM375.98,394.78l-144.51-141.42,146.65-145.45,141.65,142.63-143.79,144.23Z\"/>\n    38→</svg>\n    39→```\n    40→\n    41→- Header: Logo mark (36px) + **\"SocialHomes.Ai\"** (`--brand-teal`, with \".Ai\" in `--status-ai` purple) + **\"by Yantra.Works\"** (smaller, `--brand-soft`)\n    42→- Tagline: \"AI-native. Human-assured.\"\n    43→- Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n    44→\n    45→### Colour Palette — Yantra.Works Official Brand\n    46→\n    47→```css\n    48→/* Brand palette */\n    49→--brand-peach: #EFAC92;     /* Headings & Accents */\n    50→--brand-garnet: #BE3358;    /* Action & Signature — CTAs, critical alerts */\n    51→--brand-teal: #058995;      /* Logo & Labels — primary identity, links */\n    52→--brand-blue: #5BA4AA;      /* Atmospheric UI — charts, secondary highlights */\n    53→--brand-soft: #ACC0B5;      /* Metadata Text — secondary text, labels */\n    54→--brand-deep: #1A5A5E;      /* Core Surfaces — dark panels, sidebars */\n    55→\n    56→/* Dark theme surfaces */\n    57→--surface-dark: #0D1117;    /* Page background */\n    58→--surface-card: #151B23;    /* Card/panel backgrounds */\n    59→--surface-elevated: #1C2333;/* Modals, dropdowns, elevated panels */\n    60→--surface-hover: #222D3D;   /* Hover states */\n    61→\n    62→/* Text */\n    63→--text-primary: #E6EDF3;    /* Primary text */\n    64→--text-secondary: #ACC0B5;  /* Secondary text (= brand-soft) */\n    65→--text-muted: #6B7B8D;      /* Timestamps, IDs, low-priority text */\n    66→\n    67→/* Borders */\n    68→--border-default: #2A3545;\n    69→--border-focus: #EFAC92;    /* Focus ring — peach for visibility on dark */\n    70→\n    71→/* Semantic statuses */\n    72→--status-compliant: #2EA043;  /* Green */\n    73→--status-warning: #EFAC92;    /* Peach/amber */\n    74→--status-critical: #BE3358;   /* Garnet */\n    75→--status-info: #5BA4AA;       /* Blue */\n    76→--status-ai: #A371F7;         /* Purple — AI features */\n    77→--status-void: #6B7B8D;       /* Grey */\n    78→```\n    79→\n    80→### Typography\n    81→- Headings: `\"Space Grotesk\", sans-serif` — bold, technical\n    82→- Body: `\"Inter\", Arial, sans-serif` — clean, readable\n    83→- Monospace: `\"JetBrains Mono\", monospace` — references, codes\n    84→- Body size: 15px. Line height: 1.6 body, 1.2 headings\n    85→- Headings in `--brand-peach` on dark backgrounds\n    86→- Section labels: `--brand-teal`, uppercase, letter-spaced\n    87→\n    88→### Design Principles\n    89→- **Dark mode is default** — `--surface-dark` background with warm accent colours\n    90→- Max content width: 1400px (except full-bleed map views)\n    91→- Cards: `--surface-card` background, 4px left colour border for RAG, 8px rounded corners, subtle shadow\n    92→- Status tags: pill-shaped, semi-transparent background\n    93→- Countdown timers: large monospace digits, colour transitions green→peach→garnet→pulsing garnet\n    94→- Tables: `--surface-card` background, `--surface-hover` on hover, sortable columns\n    95→- Buttons: `--brand-teal` primary, `--surface-elevated` secondary, `--brand-garnet` destructive, `--status-ai` purple for AI actions\n    96→- Charts: teal primary, blue secondary, peach highlights, garnet alerts\n    97→- Subtle background grid/dot pattern at 3% opacity for texture\n    98→- UK date format DD/MM/YYYY, British English, GBP £\n    99→\n   100→---\n   101→\n   102→## APPLICATION SHELL\n   103→\n   104→### Navigation Structure\n   105→\n   106→**Persistent left sidebar** (280px, collapsible to 64px icons-only):\n   107→- Background: `--surface-card`\n   108→- Active item: `--brand-teal` left border + tinted background\n   109→- Sections with dividers:\n   110→  - NAVIGATE: Explore (map icon), Dashboard\n   111→  - MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance, Complaints, Allocations, ASB\n   112→  - COMMUNICATE: Communications\n   113→  - ANALYSE: Reports, AI Centre\n   114→  - SYSTEM: Admin, Settings\n   115→- Notification badges on items with outstanding actions (garnet dot)\n   116→\n   117→**Top header bar** (`--surface-dark`):\n   118→- Left: Yantra.Works logo + \"SocialHomes.Ai\" branding\n   119→- Centre: Global search bar (dark input, magnifying glass icon, `--border-default` border, placeholder: \"Search tenants, properties, cases...\")\n   120→- Right: Notification bell (garnet badge count), AI Assist button (Yantra mark with pulsing purple ring), User avatar + \"Sarah Mitchell\" dropdown with persona switcher\n   121→\n   122→**Breadcrumbs**: On every page, `--text-muted` with `--brand-teal` links, reflecting hierarchy path\n   123→\n   124→**Phase banner**: `--brand-garnet` \"BETA\" tag\n   125→\n   126→---\n   127→\n   128→## ROUTE STRUCTURE\n   129→\n   130→```\n   131→/ → /briefing (AI morning briefing — full-screen personalised)\n   132→/dashboard — Operational nerve centre\n   133→/explore — Visual drill-down hierarchy (Part 1)\n   134→  /explore/country\n   135→  /explore/region/:id\n   136→  /explore/region/:id/la/:id\n   137→  /explore/region/:id/la/:id/estate/:id\n   138→  /explore/region/:id/la/:id/estate/:id/block/:id\n   139→  /explore/region/:id/la/:id/estate/:id/block/:id/core/:id\n   140→  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id\n   141→  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id/tenant/:id\n   142→/search — Global search results\n   143→/tenancies — List (search, filter, sort)\n   144→/tenancies/:id — Tenancy detail (tabbed)\n   145→/tenancies/new — Create tenancy\n   146→/properties — Property list (map/list toggle)\n   147→/properties/:uprn — Property detail (tabbed)\n   148→/repairs — List with kanban toggle\n   149→/repairs/:id — Repair detail with timeline\n   150→/repairs/new — AI-assisted repair intake\n   151→/repairs/schedule — Workforce calendar\n   152→/rent — Arrears dashboard\n   153→/rent/accounts — Rent account list\n   154→/rent/accounts/:id — Individual rent account (statement)\n   155→/rent/arrears — AI-prioritised worklist\n   156→/compliance — Big 6 dashboard\n   157→/compliance/gas — Gas safety certificates\n   158→/compliance/electrical — EICRs\n   159→/compliance/fire — Fire risk assessments\n   160→/compliance/asbestos — Asbestos register\n   161→/compliance/legionella — Water safety\n   162→/compliance/lifts — Lift safety\n   163→/compliance/awaabs-law — Damp & mould tracker with AI risk\n   164→/complaints — Dashboard with Ombudsman KPIs\n   165→/complaints/:id — Complaint detail (two-stage timeline)\n   166→/complaints/new — AI-categorised complaint intake\n   167→/allocations — Housing register & lettings\n   168→/allocations/voids — Void management pipeline (kanban)\n   169→/allocations/lettings — Available properties\n   170→/asb — ASB case list\n   171→/asb/:id — ASB case detail\n   172→/communications — Unified inbox\n   173→/communications/templates — GOV.UK Notify template manager\n   174→/reports — Report hub\n   175→/reports/tsm — Tenant Satisfaction Measures (22 indicators)\n   176→/reports/core — CORE lettings/sales returns\n   177→/reports/regulatory — Consumer Standards compliance\n   178→/reports/ombudsman — Complaint Handling Code self-assessment\n   179→/reports/performance — Operational performance\n   180→/reports/financial — Financial reports\n   181→/reports/stock-condition — Stock condition & investment\n   182→/ai — AI command centre\n   183→/ai/insights — Cross-module AI insight feed\n   184→/ai/predictions — Active prediction models\n   185→/ai/assistant — Conversational AI chat\n   186→/admin — Full administration system (see Document 2)\n   187→/admin/organisation\n   188→/admin/users\n   189→/admin/teams\n   190→/admin/workflows\n   191→/admin/integrations\n   192→/admin/audit\n   193→/admin/system\n   194→/tenant-portal — Separate tenant-facing self-service (distinct, warmer UI)\n   195→/tenant-portal/repairs\n   196→/tenant-portal/rent\n   197→/tenant-portal/documents\n   198→/tenant-portal/contact\n   199→```\n   200→\n   201→---\n   202→\n   203→## PART 1: VISUAL DRILL-DOWN HIERARCHY\n   204→\n   205→The PRIMARY navigation experience. Users visually navigate from Country → Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every level, the right panel shows that level's attributes, KPIs, compliance, and AI insights.\n   206→\n   207→### Layout\n   208→\n   209→```\n   210→┌──────────────────────────────────────────────────────────────────┐\n   211→│ Header: SocialHomes.Ai | Search | Notifications | AI | User     │\n   212→├──────────────────────────────────────────────────────────────────┤\n   213→│ Breadcrumb: Country > Region > LA > Estate > Block > Unit > ... │\n   214→├────────────────────────────────┬─────────────────────────────────┤\n   215→│                                │  CONTEXT PANEL (scrollable)     │\n   216→│      MAP / 3D VIEW             │  - Entity name & summary        │\n   217→│      (60% width)               │  - Attribute cards               │\n   218→│                                │  - Compliance status             │\n   219→│      Interactive Leaflet map   │  - KPI metrics                   │\n   220→│      OR Three.js 3D building   │  - AI insights (purple section)  │\n   221→│      depending on zoom level   │  - AI dynamic actions (Doc 2)    │\n   222→│                                │  - Children list (next level)    │\n   223→│                                │  - Quick actions                  │\n   224→├────────────────────────────────┴─────────────────────────────────┤\n   225→│ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n   226→└──────────────────────────────────────────────────────────────────┘\n   227→```\n   228→\n   229→### LEVEL 0: Country (`/explore/country`)\n   230→- Map: England centred (~52.5°N, 1.5°W, zoom 6). 3 operational regions shown with property count badges.\n   231→- Panel: Organisation portfolio summary — total units, occupancy rate, overall compliance %, total arrears, collection rate, TSM headlines. Regional breakdown table. Regulatory status (G1/V1). Stock by tenure type (pie chart).\n   232→\n   233→### LEVEL 1: Region (`/explore/region/:id`)\n   234→- Map: Zooms to region (e.g., London, zoom 10). LA areas shown as markers sized by stock count, coloured by compliance.\n   235→- Panel: Region KPIs — compliance, arrears, voids, repairs backlog. LA breakdown table. Stock profile. Average EPC distribution.\n   236→\n   237→### LEVEL 2: Local Authority (`/explore/region/:id/la/:id`)\n   238→- Map: Zoom 13. Estates as clusters/polygons with mini-donut compliance indicators.\n   239→- Panel: Properties in LA, tenancies, voids. Compliance by Big 6. Estates list with click-through. LA context (housing market, LHA rates, nomination agreements).\n   240→\n   241→### LEVEL 3: Estate / Scheme (`/explore/.../estate/:id`)\n   242→- Map: Zoom 16-17. Individual buildings as footprints, colour-coded (green=compliant, amber=issues, red=critical).\n   243→- Panel: Estate name, postcode, construction era, total units. KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases. Buildings list. Estate management (officer, contractors, inspection score). Communal areas condition. External areas. Scheme type (general needs/sheltered/extra care/supported). Estate budget chart.\n   244→\n   245→### LEVEL 4: Block / Building (`/explore/.../block/:id`)\n   246→- **Transition to 3D view**: Map transitions to a Three.js 3D building visualisation (procedurally generated: extruded rectangle, floors shown as stacked layers, windows as grid pattern). Can toggle back to 2D map. Rotate, zoom, pan with OrbitControls.\n   247→- Panel: Building name, address, UPRN, construction details (type, year, storeys), higher-risk building flag (≥18m/≥7 storeys).\n   248→- **BUILDING-LEVEL ATTRIBUTES** (these attach to the building, NOT individual units):\n   249→  - Fire Risk Assessment: date, risk level, action plan items status\n   250→  - Building Safety Case (if higher-risk): accountable person, BSR registration, safety case status\n   251→  - Communal fire systems: detection type/zones/service date, emergency lighting, means of escape, compartmentation, fire doors\n   252→  - Asbestos management plan: building-level register, ACM count by location\n   253→  - Legionella risk assessment: water system, cold water tanks, TMVs, dead legs\n   254→  - Structural surveys, roof condition, communal boiler/heating, lifts (LOLER), entry systems, insurance\n   255→- Units list: number, floor, bedrooms, tenure, occupancy, tenant name, compliance RAG, rent RAG\n   256→\n   257→### LEVEL 4a: Core / Entrance (`/explore/.../core/:id`)\n   258→- For buildings with multiple cores (e.g., tower blocks with separate stairwells)\n   259→- Visual: schematic floor plan showing units per floor for this core\n   260→- Panel: Core ID, floors served, units, stairwell condition, lift, fire escape\n   261→\n   262→### LEVEL 5: Unit (`/explore/.../unit/:id`)\n   263→- 3D: Highlighted unit within the building model. Context map showing position.\n   264→- Panel (tabbed):\n   265→  - **Overview**: address, UPRN, type, bedrooms, floor area, heating, tenure, current tenancy or void status, photos, accessibility features\n   266→  - **Compliance** — UNIT-LEVEL ATTRIBUTES:\n   267→    - Gas Safety (CP12): annual, per-appliance breakdown with combustion readings, access history\n   268→    - EICR: 5-yearly, per-circuit observations with C1/C2/C3/FI classifications\n   269→    - EPC: rating band display, SAP score, costs, CO2, recommendations\n   270→    - Smoke & CO alarms: per-alarm type/location/test dates\n   271→    - Unit-specific asbestos: per-ACM records\n   272→    - Boiler: make/model/age/service history/efficiency\n   273→    - Decent Homes assessment: 5 criteria (A-E including new damp/mould)\n   274→  - **Stock Condition**: component lifecycle table (roof, windows, kitchen, bathroom, boiler, electrics, etc. with type, install year, condition 1-5, remaining life, replacement cost)\n   275→  - **Damp & Mould / Awaab's Law**: AI risk score 0-100, active cases with countdown timers, IoT sensor data (simulated)\n   276→  - **Works History**: all repairs/works with costs, annual spend trend\n   277→  - **Documents**: certificates, reports, photos\n   278→\n   279→### LEVEL 6: Tenant (`/explore/.../tenant/:id`)\n   280→- Panel (tabbed):\n   281→  - **Overview**: name, DOB, contact, household members table, emergency contact, assigned officers, vulnerability flags (with sensitivity controls), key dates, tenancy type/status\n   282→  - **Cases** — UNIFIED CASE TIMELINE (filterable by type):\n   283→    | Type | Format | Colour |\n   284→    |------|--------|--------|\n   285→    | Complaint | CMP-YYYY-XXXXX | Orange |\n   286→    | Repair | REP-YYYY-XXXXX | Blue |\n   287→    | ASB | ASB-YYYY-XXXXX | Red |\n   288→    | Enquiry | ENQ-YYYY-XXXXX | Grey |\n   289→    | Financial | FIN-YYYY-XXXXX | Amber |\n   290→    | Safeguarding | SAF-YYYY-XXXXX | Purple |\n   291→    | Damp/Mould | DAM-YYYY-XXXXX | Teal |\n   292→    Each card: type icon, reference, date, subject, status tag, handler, days open, SLA countdown, click to expand or navigate to full detail\n   293→  - **Activities**: chronological log — calls, visits, letters, emails, SMS, system events. Each linked to a case.\n   294→  - **Tasks**: outstanding/completed tasks — description, due date, priority, status, linked case\n   295→  - **Statement (Rent Account)**:\n   296→    - Balance (large, colour-coded), weekly charge, payment method, UC/HB status\n   297→    - Rent breakdown: base rent + itemised service charges\n   298→    - Transaction ledger: date, week, type, description, debit, credit, running balance\n   299→    - 52-week statement view (standard UK housing format)\n   300→    - Balance trend chart (12 months)\n   301→    - Payment arrangement: terms, compliance tracker\n   302→  - **Orders** — Financial/contractual instruments:\n   303→    | Order | Key Fields |\n   304→    |-------|-----------|\n   305→    | Rent Order | Amount, effective date, formula rent calculation, increase history, cap check |\n   306→    | Tenure Type | Secure/Assured/AST/Starter/Fixed Term/Flexible/Licence/Shared Ownership (equity %) |\n   307→    | Service Charge | Per-service: description, budget, apportionment, weekly amount, S20 status |\n   308→    | Garage/Parking | Location, charge, licence terms |\n   309→    | Rechargeable Repair | Repair ref, cost, payment plan, recovery status |\n   310→    | Court Order | Type, court, date, terms, compliance, review date |\n   311→    | Leaseholder | Equity %, staircasing history, ground rent, insurance share |\n   312→\n   313→### LEVEL 7: Case Detail\n   314→All cases share a common layout:\n   315→\n   316→```\n   317→┌─────────────────────────────────────────────────────────────┐\n   318→│ Case Header: Reference | Type Tag | Status Tag | Priority   │\n   319→│ Property: [link] | Tenant: [link] | Handler: name           │\n   320→├─────────────────────────────────────────────────────────────┤\n   321→│  STAGE TIMELINE (horizontal stepper with dates/countdowns)  │\n   322→├──────────────────────────┬──────────────────────────────────┤\n   323→│ Case Details (55%)       │ Activity Feed (45%, scrollable)  │\n   324→│ Description, category,   │ Chronological log of actions,    │\n   325→│ attachments, AI analysis │ notes, letters, status changes   │\n   326→├──────────────────────────┴──────────────────────────────────┤\n   327→│ Actions: [Assign] [Update] [Escalate] [Close] [AI Actions]  │\n   328→└─────────────────────────────────────────────────────────────┘\n   329→```\n   330→\n   331→**Complaint**: Two-stage timeline with countdown timers (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD). Category, findings (upheld/partial/not), remedy, learning log, Ombudsman escalation.\n   332→\n   333→**Repair**: Priority-based SLA timer. SOR code, trade, appointment, risk assessment, operative notes, photos before/during/after, materials, satisfaction survey, first-time fix, Awaab's Law compliance (if damp/mould).\n   334→\n   335→**ASB**: Category/severity (Cat 1-3). Evidence log. Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession → Closure. Multi-agency panel. Risk assessment. Community Trigger check.\n   336→\n   337→**Financial**: Arrears reason, payment arrangement, escalation stage (pre-action → NOSP → court → possession), Pre-Action Protocol checklist.\n   338→\n   339→**Damp/Mould (Awaab's Law)**: Hazard classification. **Countdown timers**: Emergency (24hrs all actions), Significant (investigate 10WD → summary 3WD → safety works 5WD → repairs begun 12 weeks). Cause assessment. Environmental data. Linked repairs.\n   340→\n   341→---\n   342→\n   343→## PART 2: TRADITIONAL NAVIGATION MODULES\n   344→\n   345→### Dashboard (`/dashboard`)\n   346→**8 KPI cards** (top row): Properties (12,847), Tenancies (12,103), Active Repairs (487), Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293), Compliance (98.7%), Open Complaints (34), AI Alerts (12).\n   347→\n   348→**Charts row**: Rent collection 12-month trend vs 97% target | Repairs monthly volume by priority with avg days line\n   349→\n   350→**Three panels**: Big 6 compliance heatmap (6 tiles, % + RAG) | Awaab's Law active cases with countdown timers | AI insights scrolling feed\n   351→\n   352→**Activity timeline**: Real-time system event feed with avatars, timestamps, entity links\n   353→\n   354→### Repairs (`/repairs`)\n   355→- List/Kanban toggle. Columns: ref, date, property, SOR category, priority, status, operative, target date, days elapsed\n   356→- Kanban: status columns, cards with priority colour borders\n   357→- New repair wizard: property lookup → free-text description → AI auto-suggests SOR code/priority/trade/Awaab's Law flags → appointment booking → risk assessment → confirm\n   358→- Schedule: weekly calendar, operative schedules, capacity indicators\n   359→\n   360→### Rent & Income (`/rent`)\n   361→- Arrears dashboard: total, by band (chart), collection rate gauge, payment method breakdown\n   362→- AI-prioritised worklist: each case with tenant details, arrears amount, 12-week sparkline, AI score (1-100), risk factors, recommended action, action buttons\n   363→\n   364→### Compliance (`/compliance`)\n   365→- Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n   366→- Awaab's Law: active cases with timers, risk register (all properties with AI scores), proactive inspection programme\n   367→- Each area page: certificate list, filters, no-access tracker, contractor performance\n   368→\n   369→### Complaints (`/complaints`)\n   370→- Dashboard: Stage 1/2 counts, response % vs timescale, TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n   371→- New: tenant selection → free-text → AI categorises/assigns severity/checks history → handler assignment → auto-acknowledgement\n   372→- Detail: two-stage timeline with countdowns\n   373→\n   374→### Allocations (`/allocations`)\n   375→- Housing register: applicants by band (A-D), bedroom need, medical priority\n   376→- Void kanban: Notice → Keys → Inspection → Works → Quality → Ready → Offer → Let. Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n   377→\n   378→### ASB (`/asb`)\n   379→- Case list: ref, location, category, severity, status, handler, days open\n   380→- Detail: escalation pipeline visual tracker, evidence log, multi-agency panel\n   381→\n   382→### Communications (`/communications`)\n   383→- Unified inbox: all channels linked to tenant/property/case. AI triage: auto-categorise, priority, sentiment, suggested response.\n   384→\n   385→### AI Centre (`/ai`)\n   386→- Insights feed: predictions, alerts, recommendations, analytics — with confidence %, affected entities, action buttons\n   387→- Predictions: Arrears (scatter + top 50 + feature importance), Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n   388→- Assistant: chat panel with natural language queries\n   389→\n   390→### Tenant Portal (`/tenant-portal`)\n   391→- **Visually distinct**: lighter/warmer theme option, simpler layout, larger text, no jargon, large touch targets\n   392→- Dashboard: welcome, quick actions (report repair, check balance, make payment, contact), active repairs, rent balance, appointments\n   393→- Report repair: conversational wizard — room → problem category tiles → sub-category → photo → appointment → confirm. AI urgency detection.\n   394→- Rent: clear balance, simple transactions, payment button\n   395→\n   396→---\n   397→\n   398→## PART 3: BASELINE REPORTING\n   399→\n   400→### Regulatory Returns\n   401→- TSM Annual Return (22 measures with actuals, targets, sector medians, quartiles)\n   402→- CORE Lettings/Sales Logs (field validation, CSV export)\n   403→- Consumer Standards Self-Assessment (4 standards, evidence mapping)\n   404→- Complaint Handling Code Self-Assessment (per-section compliance scoring)\n   405→- Building Safety Act Returns (higher-risk buildings)\n   406→- Statistical Data Return (SDR) for RSH\n   407→\n   408→### Operational Performance\n   409→- Repairs: volume, SLA %, first-time fix, satisfaction, spend, top costliest properties\n   410→- Voids: average relet days, rent loss, by stage, contractor performance\n   411→- Arrears: collection rate, band movement, payment methods, UC performance, court pipeline\n   412→- Complaints: volume, response %, findings, compensation, root causes, learning actions\n   413→- ASB: cases opened/closed, resolution days, enforcement actions\n   414→- Contact Centre: call volumes, wait times, channel usage, first contact resolution\n   415→\n   416→### Compliance Reports\n   417→- Big 6 dashboard (daily/weekly per area)\n   418→- Per-area: gas programme, electrical, fire, asbestos, legionella, lifts\n   419→- Awaab's Law compliance (weekly)\n   420→- Decent Homes (quarterly)\n   421→- Stock Condition (quarterly/annual)\n   422→- EPC / Energy (quarterly)\n   423→\n   424→### Financial Reports\n   425→- Rent setting summary, service charge report, repairs expenditure, bad debt provision, void loss\n   426→\n   427→### Governance\n   428→- Board performance pack (monthly/quarterly executive dashboard)\n   429→- Risk register, regulatory compliance summary, H&S summary\n   430→\n   431→### Tenant-Facing\n   432→- Annual report to tenants (TSM results, repairs, complaints, improvements)\n   433→- Estate reports (quarterly per-estate)\n   434→\n   435→### Report Features\n   436→Every report supports: date range, property group, tenure type, comparison period, CSV/PDF export, drill-down from aggregates, benchmarking vs targets/previous/sector, AI-generated narrative summary, scheduled email distribution.\n   437→\n   438→---\n   439→\n   440→## SIMULATED DATA\n   441→\n   442→**Organisation**: Riverside Crescent Housing Association (RCHA), RP 4567, G1/V1, HQ Southwark. Stock across Southwark, Lewisham, Lambeth.\n   443→\n   444→**5 Estates:**\n   445→1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n   446→2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n   447→3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n   448→4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n   449→5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n   450→\n   451→**50 properties, 45 active tenancies, 5 voids.** Realistic SE London postcodes, 12-digit UPRNs, diverse tenant names reflecting London demographics.\n   452→\n   453→Rents: social £95-140/week, affordable £140-200/week. Service charges £5-35/week.\n   454→Payment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%.\n   455→Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k.\n   456→\n   457→**200 repairs** (5% emergency, 15% urgent, 70% routine, 10% planned). 95% emergency <24hrs, 88% urgent <5 days, 82% routine <28 days. FTF: 78%. Satisfaction: mean 3.8/5.\n   458→\n   459→**34 open complaints** (28 Stage 1, 6 Stage 2). Response within timescale: 91%.\n   460→**12 ASB cases.** **8 damp/mould cases** (3 emergency, 5 significant). **25 financial cases.** **5 voids** at various stages.\n   461→\n   462→Compliance: Gas 99.4%, Electrical 97.8%, Fire 99.1%, Asbestos 98.5%, Legionella 99.0%, Lifts 100%.\n   463→\n   464→---\n   465→\n   466→## IMPLEMENTATION REQUIREMENTS\n   467→\n   468→1. **Every page fully functional** — no \"coming soon\" placeholders\n   469→2. **Visual drill-down is the flagship** — smooth map-to-3D transitions, each level shows correct attributes\n   470→3. **Data relationships consistent** — navigating hierarchy = same data as direct search\n   471→4. **Countdown timers prominent** — Awaab's Law and complaints deadlines with colour-coded urgency\n   472→5. **Dark mode default** — Yantra.Works brand palette throughout\n   473→6. **Attributes at correct level** — building-level (FRA, building safety) vs unit-level (gas, EICR, EPC)\n   474→7. **Tenant portal visually distinct** — simpler, warmer\n   475→8. **UK conventions** — DD/MM/YYYY, British English, GBP, \"flat\" not \"apartment\"\n   476→9. **Accessibility** — WCAG 2.2 AA contrast, keyboard navigation, aria-labels, visible focus states\n   477→10. **Animations throughout** — staggered reveals, sliding panels, smooth transitions, pulsing alerts. The UI must feel alive.\n   478→11. **Leave clear integration points** for Document 2's AI features: empty `<div id=\"ai-assist-panel\">` on every page, empty `<div id=\"ai-dynamic-actions\">` in every entity detail page, persona context in global state\n   479→12. **Build as single self-contained file** using CDN imports\n   480→\n   481→Now build the complete SocialHomes.Ai base application.\n   482→"}]},"uuid":"a00e7f30-de80-470b-b591-666e64cd2e9c","timestamp":"2026-02-26T07:43:34.723Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt","content":"# DOCUMENT 1 OF 2: BASE APPLICATION SPECIFICATION\n# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n\n## INSTRUCTION TO AI\n\nYou are building **SocialHomes.Ai**, a comprehensive, open-source, AI-native housing management system for UK social housing providers (housing associations and local authorities) managing 5,000–20,000 units. Created by **Yantra.Works**.\n\nBuild a complete, multi-page React application. This is NOT a legacy housing system with a fresh coat of paint. This must look and feel like nothing the social housing sector has ever seen — think Bloomberg Terminal meets Figma, not a government form. The sector is dominated by ugly, slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai is the opposite: dark, fast, visually stunning, animated, intelligent.\n\nThere is a companion document (Document 2) that specifies all AI-native features, dynamic buttons/fields, personas, admin system, and prediction models. Build the base application first using this document, then apply Document 2's features.\n\n---\n\n## TECHNICAL STACK\n\n- **React 19** with functional components, hooks, Suspense\n- **React Router v7** for client-side routing with nested routes\n- **Tailwind CSS v4** via CDN — Yantra.Works dark-mode-first brand language\n- **Three.js (r128)** via `https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js` — for 3D building visualisations in the drill-down\n- **Leaflet 1.9** with OpenStreetMap tiles — for 2D map views (free, no API key)\n- **Recharts** for dashboards and charts\n- **D3.js** for advanced visualisations (Sankey diagrams, heatmaps)\n- **Lucide React** for iconography\n- **Animations**: CSS transitions and keyframe animations throughout — every page load has staggered reveals, every panel slides, every card fades in, status changes animate. The UI must feel ALIVE, not static.\n- **State management**: React Context + useReducer\n- Do NOT use localStorage or sessionStorage\n\n---\n\n## BRANDING\n\n### Logo\nThe product logo is the Yantra.Works geometric mark in teal. Embed this SVG inline:\n\n```svg\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 751 772\" width=\"36\" height=\"37\">\n  <path fill=\"#058995\" d=\"M745.51,390.8l-95.41-91.94-41.32,42.88,48.94,47.16-250.45,254.19-1.31-194.04,12.47-12.74-.31-.3,143.2-143.64.08.08,42.88-42.58-.29-.29,1-1-41.76-41.63-.79.79L377.89,21.94l-1.41,1.4-.43-.44L10.05,385.9l.67.67-2.57,2.54,325.25,328.97-.16.16,12.35,12.17,30.65,31,.41-.4,2.02,1.99,324.99-329.84.55.53,41.32-42.88ZM345.09,452.5l1.28,189.95-251.12-253.99,92.74-91.98,144.76,141.66-1.03,1.03,13.37,13.33ZM375.98,394.78l-144.51-141.42,146.65-145.45,141.65,142.63-143.79,144.23Z\"/>\n</svg>\n```\n\n- Header: Logo mark (36px) + **\"SocialHomes.Ai\"** (`--brand-teal`, with \".Ai\" in `--status-ai` purple) + **\"by Yantra.Works\"** (smaller, `--brand-soft`)\n- Tagline: \"AI-native. Human-assured.\"\n- Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n\n### Colour Palette — Yantra.Works Official Brand\n\n```css\n/* Brand palette */\n--brand-peach: #EFAC92;     /* Headings & Accents */\n--brand-garnet: #BE3358;    /* Action & Signature — CTAs, critical alerts */\n--brand-teal: #058995;      /* Logo & Labels — primary identity, links */\n--brand-blue: #5BA4AA;      /* Atmospheric UI — charts, secondary highlights */\n--brand-soft: #ACC0B5;      /* Metadata Text — secondary text, labels */\n--brand-deep: #1A5A5E;      /* Core Surfaces — dark panels, sidebars */\n\n/* Dark theme surfaces */\n--surface-dark: #0D1117;    /* Page background */\n--surface-card: #151B23;    /* Card/panel backgrounds */\n--surface-elevated: #1C2333;/* Modals, dropdowns, elevated panels */\n--surface-hover: #222D3D;   /* Hover states */\n\n/* Text */\n--text-primary: #E6EDF3;    /* Primary text */\n--text-secondary: #ACC0B5;  /* Secondary text (= brand-soft) */\n--text-muted: #6B7B8D;      /* Timestamps, IDs, low-priority text */\n\n/* Borders */\n--border-default: #2A3545;\n--border-focus: #EFAC92;    /* Focus ring — peach for visibility on dark */\n\n/* Semantic statuses */\n--status-compliant: #2EA043;  /* Green */\n--status-warning: #EFAC92;    /* Peach/amber */\n--status-critical: #BE3358;   /* Garnet */\n--status-info: #5BA4AA;       /* Blue */\n--status-ai: #A371F7;         /* Purple — AI features */\n--status-void: #6B7B8D;       /* Grey */\n```\n\n### Typography\n- Headings: `\"Space Grotesk\", sans-serif` — bold, technical\n- Body: `\"Inter\", Arial, sans-serif` — clean, readable\n- Monospace: `\"JetBrains Mono\", monospace` — references, codes\n- Body size: 15px. Line height: 1.6 body, 1.2 headings\n- Headings in `--brand-peach` on dark backgrounds\n- Section labels: `--brand-teal`, uppercase, letter-spaced\n\n### Design Principles\n- **Dark mode is default** — `--surface-dark` background with warm accent colours\n- Max content width: 1400px (except full-bleed map views)\n- Cards: `--surface-card` background, 4px left colour border for RAG, 8px rounded corners, subtle shadow\n- Status tags: pill-shaped, semi-transparent background\n- Countdown timers: large monospace digits, colour transitions green→peach→garnet→pulsing garnet\n- Tables: `--surface-card` background, `--surface-hover` on hover, sortable columns\n- Buttons: `--brand-teal` primary, `--surface-elevated` secondary, `--brand-garnet` destructive, `--status-ai` purple for AI actions\n- Charts: teal primary, blue secondary, peach highlights, garnet alerts\n- Subtle background grid/dot pattern at 3% opacity for texture\n- UK date format DD/MM/YYYY, British English, GBP £\n\n---\n\n## APPLICATION SHELL\n\n### Navigation Structure\n\n**Persistent left sidebar** (280px, collapsible to 64px icons-only):\n- Background: `--surface-card`\n- Active item: `--brand-teal` left border + tinted background\n- Sections with dividers:\n  - NAVIGATE: Explore (map icon), Dashboard\n  - MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance, Complaints, Allocations, ASB\n  - COMMUNICATE: Communications\n  - ANALYSE: Reports, AI Centre\n  - SYSTEM: Admin, Settings\n- Notification badges on items with outstanding actions (garnet dot)\n\n**Top header bar** (`--surface-dark`):\n- Left: Yantra.Works logo + \"SocialHomes.Ai\" branding\n- Centre: Global search bar (dark input, magnifying glass icon, `--border-default` border, placeholder: \"Search tenants, properties, cases...\")\n- Right: Notification bell (garnet badge count), AI Assist button (Yantra mark with pulsing purple ring), User avatar + \"Sarah Mitchell\" dropdown with persona switcher\n\n**Breadcrumbs**: On every page, `--text-muted` with `--brand-teal` links, reflecting hierarchy path\n\n**Phase banner**: `--brand-garnet` \"BETA\" tag\n\n---\n\n## ROUTE STRUCTURE\n\n```\n/ → /briefing (AI morning briefing — full-screen personalised)\n/dashboard — Operational nerve centre\n/explore — Visual drill-down hierarchy (Part 1)\n  /explore/country\n  /explore/region/:id\n  /explore/region/:id/la/:id\n  /explore/region/:id/la/:id/estate/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/core/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id/tenant/:id\n/search — Global search results\n/tenancies — List (search, filter, sort)\n/tenancies/:id — Tenancy detail (tabbed)\n/tenancies/new — Create tenancy\n/properties — Property list (map/list toggle)\n/properties/:uprn — Property detail (tabbed)\n/repairs — List with kanban toggle\n/repairs/:id — Repair detail with timeline\n/repairs/new — AI-assisted repair intake\n/repairs/schedule — Workforce calendar\n/rent — Arrears dashboard\n/rent/accounts — Rent account list\n/rent/accounts/:id — Individual rent account (statement)\n/rent/arrears — AI-prioritised worklist\n/compliance — Big 6 dashboard\n/compliance/gas — Gas safety certificates\n/compliance/electrical — EICRs\n/compliance/fire — Fire risk assessments\n/compliance/asbestos — Asbestos register\n/compliance/legionella — Water safety\n/compliance/lifts — Lift safety\n/compliance/awaabs-law — Damp & mould tracker with AI risk\n/complaints — Dashboard with Ombudsman KPIs\n/complaints/:id — Complaint detail (two-stage timeline)\n/complaints/new — AI-categorised complaint intake\n/allocations — Housing register & lettings\n/allocations/voids — Void management pipeline (kanban)\n/allocations/lettings — Available properties\n/asb — ASB case list\n/asb/:id — ASB case detail\n/communications — Unified inbox\n/communications/templates — GOV.UK Notify template manager\n/reports — Report hub\n/reports/tsm — Tenant Satisfaction Measures (22 indicators)\n/reports/core — CORE lettings/sales returns\n/reports/regulatory — Consumer Standards compliance\n/reports/ombudsman — Complaint Handling Code self-assessment\n/reports/performance — Operational performance\n/reports/financial — Financial reports\n/reports/stock-condition — Stock condition & investment\n/ai — AI command centre\n/ai/insights — Cross-module AI insight feed\n/ai/predictions — Active prediction models\n/ai/assistant — Conversational AI chat\n/admin — Full administration system (see Document 2)\n/admin/organisation\n/admin/users\n/admin/teams\n/admin/workflows\n/admin/integrations\n/admin/audit\n/admin/system\n/tenant-portal — Separate tenant-facing self-service (distinct, warmer UI)\n/tenant-portal/repairs\n/tenant-portal/rent\n/tenant-portal/documents\n/tenant-portal/contact\n```\n\n---\n\n## PART 1: VISUAL DRILL-DOWN HIERARCHY\n\nThe PRIMARY navigation experience. Users visually navigate from Country → Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every level, the right panel shows that level's attributes, KPIs, compliance, and AI insights.\n\n### Layout\n\n```\n┌──────────────────────────────────────────────────────────────────┐\n│ Header: SocialHomes.Ai | Search | Notifications | AI | User     │\n├──────────────────────────────────────────────────────────────────┤\n│ Breadcrumb: Country > Region > LA > Estate > Block > Unit > ... │\n├────────────────────────────────┬─────────────────────────────────┤\n│                                │  CONTEXT PANEL (scrollable)     │\n│      MAP / 3D VIEW             │  - Entity name & summary        │\n│      (60% width)               │  - Attribute cards               │\n│                                │  - Compliance status             │\n│      Interactive Leaflet map   │  - KPI metrics                   │\n│      OR Three.js 3D building   │  - AI insights (purple section)  │\n│      depending on zoom level   │  - AI dynamic actions (Doc 2)    │\n│                                │  - Children list (next level)    │\n│                                │  - Quick actions                  │\n├────────────────────────────────┴─────────────────────────────────┤\n│ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n└──────────────────────────────────────────────────────────────────┘\n```\n\n### LEVEL 0: Country (`/explore/country`)\n- Map: England centred (~52.5°N, 1.5°W, zoom 6). 3 operational regions shown with property count badges.\n- Panel: Organisation portfolio summary — total units, occupancy rate, overall compliance %, total arrears, collection rate, TSM headlines. Regional breakdown table. Regulatory status (G1/V1). Stock by tenure type (pie chart).\n\n### LEVEL 1: Region (`/explore/region/:id`)\n- Map: Zooms to region (e.g., London, zoom 10). LA areas shown as markers sized by stock count, coloured by compliance.\n- Panel: Region KPIs — compliance, arrears, voids, repairs backlog. LA breakdown table. Stock profile. Average EPC distribution.\n\n### LEVEL 2: Local Authority (`/explore/region/:id/la/:id`)\n- Map: Zoom 13. Estates as clusters/polygons with mini-donut compliance indicators.\n- Panel: Properties in LA, tenancies, voids. Compliance by Big 6. Estates list with click-through. LA context (housing market, LHA rates, nomination agreements).\n\n### LEVEL 3: Estate / Scheme (`/explore/.../estate/:id`)\n- Map: Zoom 16-17. Individual buildings as footprints, colour-coded (green=compliant, amber=issues, red=critical).\n- Panel: Estate name, postcode, construction era, total units. KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases. Buildings list. Estate management (officer, contractors, inspection score). Communal areas condition. External areas. Scheme type (general needs/sheltered/extra care/supported). Estate budget chart.\n\n### LEVEL 4: Block / Building (`/explore/.../block/:id`)\n- **Transition to 3D view**: Map transitions to a Three.js 3D building visualisation (procedurally generated: extruded rectangle, floors shown as stacked layers, windows as grid pattern). Can toggle back to 2D map. Rotate, zoom, pan with OrbitControls.\n- Panel: Building name, address, UPRN, construction details (type, year, storeys), higher-risk building flag (≥18m/≥7 storeys).\n- **BUILDING-LEVEL ATTRIBUTES** (these attach to the building, NOT individual units):\n  - Fire Risk Assessment: date, risk level, action plan items status\n  - Building Safety Case (if higher-risk): accountable person, BSR registration, safety case status\n  - Communal fire systems: detection type/zones/service date, emergency lighting, means of escape, compartmentation, fire doors\n  - Asbestos management plan: building-level register, ACM count by location\n  - Legionella risk assessment: water system, cold water tanks, TMVs, dead legs\n  - Structural surveys, roof condition, communal boiler/heating, lifts (LOLER), entry systems, insurance\n- Units list: number, floor, bedrooms, tenure, occupancy, tenant name, compliance RAG, rent RAG\n\n### LEVEL 4a: Core / Entrance (`/explore/.../core/:id`)\n- For buildings with multiple cores (e.g., tower blocks with separate stairwells)\n- Visual: schematic floor plan showing units per floor for this core\n- Panel: Core ID, floors served, units, stairwell condition, lift, fire escape\n\n### LEVEL 5: Unit (`/explore/.../unit/:id`)\n- 3D: Highlighted unit within the building model. Context map showing position.\n- Panel (tabbed):\n  - **Overview**: address, UPRN, type, bedrooms, floor area, heating, tenure, current tenancy or void status, photos, accessibility features\n  - **Compliance** — UNIT-LEVEL ATTRIBUTES:\n    - Gas Safety (CP12): annual, per-appliance breakdown with combustion readings, access history\n    - EICR: 5-yearly, per-circuit observations with C1/C2/C3/FI classifications\n    - EPC: rating band display, SAP score, costs, CO2, recommendations\n    - Smoke & CO alarms: per-alarm type/location/test dates\n    - Unit-specific asbestos: per-ACM records\n    - Boiler: make/model/age/service history/efficiency\n    - Decent Homes assessment: 5 criteria (A-E including new damp/mould)\n  - **Stock Condition**: component lifecycle table (roof, windows, kitchen, bathroom, boiler, electrics, etc. with type, install year, condition 1-5, remaining life, replacement cost)\n  - **Damp & Mould / Awaab's Law**: AI risk score 0-100, active cases with countdown timers, IoT sensor data (simulated)\n  - **Works History**: all repairs/works with costs, annual spend trend\n  - **Documents**: certificates, reports, photos\n\n### LEVEL 6: Tenant (`/explore/.../tenant/:id`)\n- Panel (tabbed):\n  - **Overview**: name, DOB, contact, household members table, emergency contact, assigned officers, vulnerability flags (with sensitivity controls), key dates, tenancy type/status\n  - **Cases** — UNIFIED CASE TIMELINE (filterable by type):\n    | Type | Format | Colour |\n    |------|--------|--------|\n    | Complaint | CMP-YYYY-XXXXX | Orange |\n    | Repair | REP-YYYY-XXXXX | Blue |\n    | ASB | ASB-YYYY-XXXXX | Red |\n    | Enquiry | ENQ-YYYY-XXXXX | Grey |\n    | Financial | FIN-YYYY-XXXXX | Amber |\n    | Safeguarding | SAF-YYYY-XXXXX | Purple |\n    | Damp/Mould | DAM-YYYY-XXXXX | Teal |\n    Each card: type icon, reference, date, subject, status tag, handler, days open, SLA countdown, click to expand or navigate to full detail\n  - **Activities**: chronological log — calls, visits, letters, emails, SMS, system events. Each linked to a case.\n  - **Tasks**: outstanding/completed tasks — description, due date, priority, status, linked case\n  - **Statement (Rent Account)**:\n    - Balance (large, colour-coded), weekly charge, payment method, UC/HB status\n    - Rent breakdown: base rent + itemised service charges\n    - Transaction ledger: date, week, type, description, debit, credit, running balance\n    - 52-week statement view (standard UK housing format)\n    - Balance trend chart (12 months)\n    - Payment arrangement: terms, compliance tracker\n  - **Orders** — Financial/contractual instruments:\n    | Order | Key Fields |\n    |-------|-----------|\n    | Rent Order | Amount, effective date, formula rent calculation, increase history, cap check |\n    | Tenure Type | Secure/Assured/AST/Starter/Fixed Term/Flexible/Licence/Shared Ownership (equity %) |\n    | Service Charge | Per-service: description, budget, apportionment, weekly amount, S20 status |\n    | Garage/Parking | Location, charge, licence terms |\n    | Rechargeable Repair | Repair ref, cost, payment plan, recovery status |\n    | Court Order | Type, court, date, terms, compliance, review date |\n    | Leaseholder | Equity %, staircasing history, ground rent, insurance share |\n\n### LEVEL 7: Case Detail\nAll cases share a common layout:\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│ Case Header: Reference | Type Tag | Status Tag | Priority   │\n│ Property: [link] | Tenant: [link] | Handler: name           │\n├─────────────────────────────────────────────────────────────┤\n│  STAGE TIMELINE (horizontal stepper with dates/countdowns)  │\n├──────────────────────────┬──────────────────────────────────┤\n│ Case Details (55%)       │ Activity Feed (45%, scrollable)  │\n│ Description, category,   │ Chronological log of actions,    │\n│ attachments, AI analysis │ notes, letters, status changes   │\n├──────────────────────────┴──────────────────────────────────┤\n│ Actions: [Assign] [Update] [Escalate] [Close] [AI Actions]  │\n└─────────────────────────────────────────────────────────────┘\n```\n\n**Complaint**: Two-stage timeline with countdown timers (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD). Category, findings (upheld/partial/not), remedy, learning log, Ombudsman escalation.\n\n**Repair**: Priority-based SLA timer. SOR code, trade, appointment, risk assessment, operative notes, photos before/during/after, materials, satisfaction survey, first-time fix, Awaab's Law compliance (if damp/mould).\n\n**ASB**: Category/severity (Cat 1-3). Evidence log. Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession → Closure. Multi-agency panel. Risk assessment. Community Trigger check.\n\n**Financial**: Arrears reason, payment arrangement, escalation stage (pre-action → NOSP → court → possession), Pre-Action Protocol checklist.\n\n**Damp/Mould (Awaab's Law)**: Hazard classification. **Countdown timers**: Emergency (24hrs all actions), Significant (investigate 10WD → summary 3WD → safety works 5WD → repairs begun 12 weeks). Cause assessment. Environmental data. Linked repairs.\n\n---\n\n## PART 2: TRADITIONAL NAVIGATION MODULES\n\n### Dashboard (`/dashboard`)\n**8 KPI cards** (top row): Properties (12,847), Tenancies (12,103), Active Repairs (487), Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293), Compliance (98.7%), Open Complaints (34), AI Alerts (12).\n\n**Charts row**: Rent collection 12-month trend vs 97% target | Repairs monthly volume by priority with avg days line\n\n**Three panels**: Big 6 compliance heatmap (6 tiles, % + RAG) | Awaab's Law active cases with countdown timers | AI insights scrolling feed\n\n**Activity timeline**: Real-time system event feed with avatars, timestamps, entity links\n\n### Repairs (`/repairs`)\n- List/Kanban toggle. Columns: ref, date, property, SOR category, priority, status, operative, target date, days elapsed\n- Kanban: status columns, cards with priority colour borders\n- New repair wizard: property lookup → free-text description → AI auto-suggests SOR code/priority/trade/Awaab's Law flags → appointment booking → risk assessment → confirm\n- Schedule: weekly calendar, operative schedules, capacity indicators\n\n### Rent & Income (`/rent`)\n- Arrears dashboard: total, by band (chart), collection rate gauge, payment method breakdown\n- AI-prioritised worklist: each case with tenant details, arrears amount, 12-week sparkline, AI score (1-100), risk factors, recommended action, action buttons\n\n### Compliance (`/compliance`)\n- Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n- Awaab's Law: active cases with timers, risk register (all properties with AI scores), proactive inspection programme\n- Each area page: certificate list, filters, no-access tracker, contractor performance\n\n### Complaints (`/complaints`)\n- Dashboard: Stage 1/2 counts, response % vs timescale, TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n- New: tenant selection → free-text → AI categorises/assigns severity/checks history → handler assignment → auto-acknowledgement\n- Detail: two-stage timeline with countdowns\n\n### Allocations (`/allocations`)\n- Housing register: applicants by band (A-D), bedroom need, medical priority\n- Void kanban: Notice → Keys → Inspection → Works → Quality → Ready → Offer → Let. Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n\n### ASB (`/asb`)\n- Case list: ref, location, category, severity, status, handler, days open\n- Detail: escalation pipeline visual tracker, evidence log, multi-agency panel\n\n### Communications (`/communications`)\n- Unified inbox: all channels linked to tenant/property/case. AI triage: auto-categorise, priority, sentiment, suggested response.\n\n### AI Centre (`/ai`)\n- Insights feed: predictions, alerts, recommendations, analytics — with confidence %, affected entities, action buttons\n- Predictions: Arrears (scatter + top 50 + feature importance), Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n- Assistant: chat panel with natural language queries\n\n### Tenant Portal (`/tenant-portal`)\n- **Visually distinct**: lighter/warmer theme option, simpler layout, larger text, no jargon, large touch targets\n- Dashboard: welcome, quick actions (report repair, check balance, make payment, contact), active repairs, rent balance, appointments\n- Report repair: conversational wizard — room → problem category tiles → sub-category → photo → appointment → confirm. AI urgency detection.\n- Rent: clear balance, simple transactions, payment button\n\n---\n\n## PART 3: BASELINE REPORTING\n\n### Regulatory Returns\n- TSM Annual Return (22 measures with actuals, targets, sector medians, quartiles)\n- CORE Lettings/Sales Logs (field validation, CSV export)\n- Consumer Standards Self-Assessment (4 standards, evidence mapping)\n- Complaint Handling Code Self-Assessment (per-section compliance scoring)\n- Building Safety Act Returns (higher-risk buildings)\n- Statistical Data Return (SDR) for RSH\n\n### Operational Performance\n- Repairs: volume, SLA %, first-time fix, satisfaction, spend, top costliest properties\n- Voids: average relet days, rent loss, by stage, contractor performance\n- Arrears: collection rate, band movement, payment methods, UC performance, court pipeline\n- Complaints: volume, response %, findings, compensation, root causes, learning actions\n- ASB: cases opened/closed, resolution days, enforcement actions\n- Contact Centre: call volumes, wait times, channel usage, first contact resolution\n\n### Compliance Reports\n- Big 6 dashboard (daily/weekly per area)\n- Per-area: gas programme, electrical, fire, asbestos, legionella, lifts\n- Awaab's Law compliance (weekly)\n- Decent Homes (quarterly)\n- Stock Condition (quarterly/annual)\n- EPC / Energy (quarterly)\n\n### Financial Reports\n- Rent setting summary, service charge report, repairs expenditure, bad debt provision, void loss\n\n### Governance\n- Board performance pack (monthly/quarterly executive dashboard)\n- Risk register, regulatory compliance summary, H&S summary\n\n### Tenant-Facing\n- Annual report to tenants (TSM results, repairs, complaints, improvements)\n- Estate reports (quarterly per-estate)\n\n### Report Features\nEvery report supports: date range, property group, tenure type, comparison period, CSV/PDF export, drill-down from aggregates, benchmarking vs targets/previous/sector, AI-generated narrative summary, scheduled email distribution.\n\n---\n\n## SIMULATED DATA\n\n**Organisation**: Riverside Crescent Housing Association (RCHA), RP 4567, G1/V1, HQ Southwark. Stock across Southwark, Lewisham, Lambeth.\n\n**5 Estates:**\n1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n**50 properties, 45 active tenancies, 5 voids.** Realistic SE London postcodes, 12-digit UPRNs, diverse tenant names reflecting London demographics.\n\nRents: social £95-140/week, affordable £140-200/week. Service charges £5-35/week.\nPayment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%.\nArrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k.\n\n**200 repairs** (5% emergency, 15% urgent, 70% routine, 10% planned). 95% emergency <24hrs, 88% urgent <5 days, 82% routine <28 days. FTF: 78%. Satisfaction: mean 3.8/5.\n\n**34 open complaints** (28 Stage 1, 6 Stage 2). Response within timescale: 91%.\n**12 ASB cases.** **8 damp/mould cases** (3 emergency, 5 significant). **25 financial cases.** **5 voids** at various stages.\n\nCompliance: Gas 99.4%, Electrical 97.8%, Fire 99.1%, Asbestos 98.5%, Legionella 99.0%, Lifts 100%.\n\n---\n\n## IMPLEMENTATION REQUIREMENTS\n\n1. **Every page fully functional** — no \"coming soon\" placeholders\n2. **Visual drill-down is the flagship** — smooth map-to-3D transitions, each level shows correct attributes\n3. **Data relationships consistent** — navigating hierarchy = same data as direct search\n4. **Countdown timers prominent** — Awaab's Law and complaints deadlines with colour-coded urgency\n5. **Dark mode default** — Yantra.Works brand palette throughout\n6. **Attributes at correct level** — building-level (FRA, building safety) vs unit-level (gas, EICR, EPC)\n7. **Tenant portal visually distinct** — simpler, warmer\n8. **UK conventions** — DD/MM/YYYY, British English, GBP, \"flat\" not \"apartment\"\n9. **Accessibility** — WCAG 2.2 AA contrast, keyboard navigation, aria-labels, visible focus states\n10. **Animations throughout** — staggered reveals, sliding panels, smooth transitions, pulsing alerts. The UI must feel alive.\n11. **Leave clear integration points** for Document 2's AI features: empty `<div id=\"ai-assist-panel\">` on every page, empty `<div id=\"ai-dynamic-actions\">` in every entity detail page, persona context in global state\n12. **Build as single self-contained file** using CDN imports\n\nNow build the complete SocialHomes.Ai base application.\n","numLines":482,"startLine":1,"totalLines":482}},"sourceToolAssistantUUID":"b18b59ef-4fb6-4984-9118-4b628e7d1834"}
{"parentUuid":"a00e7f30-de80-470b-b591-666e64cd2e9c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017ZUGTo4R2NXEgfXrpHq7Px","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"08f3196e-75b5-4435-b820-b2135579a7af","timestamp":"2026-02-26T07:43:34.970Z"}
{"parentUuid":"08f3196e-75b5-4435-b820-b2135579a7af","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017ZUGTo4R2NXEgfXrpHq7Px","type":"tool_result","content":"     1→# DOCUMENT 2 OF 2: AI-NATIVE FEATURE REQUIREMENTS\n     2→# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n     3→\n     4→## INSTRUCTION TO AI\n     5→\n     6→This is the companion document to the Base Specification (Document 1). It defines what makes SocialHomes.Ai genuinely AI-NATIVE — not AI-bolted-on.\n     7→\n     8→**What \"AI-native\" means in SocialHomes.Ai:**\n     9→The AI doesn't just sit in a sidebar showing information. It dynamically reshapes the interface itself. Every page has standard fields, buttons, and layouts from Document 1 — but ALSO has **dynamic AI-generated buttons, fields, cards, and action prompts** that appear contextually based on the entity being viewed, the data about that entity, the user's persona, external factors, and predictive models. These dynamic elements don't exist in a static system — they are created by intelligence.\n    10→\n    11→Apply all features in this document to the base application built from Document 1.\n    12→\n    13→---\n    14→\n    15→## CORE PRINCIPLE: DYNAMIC AI INTERFACE ELEMENTS\n    16→\n    17→### How It Works\n    18→\n    19→Every entity page (tenant, property, building, case, etc.) has TWO zones:\n    20→\n    21→1. **Standard zone**: The fixed fields, tabs, buttons defined in Document 1 — always present, always in the same place\n    22→2. **AI Dynamic zone**: A clearly-marked section (subtle purple-tinted `--status-ai` left border, `--surface-elevated` background) that contains AI-generated elements that change based on context\n    23→\n    24→The AI Dynamic zone appears at the top of the right-side context panel (in drill-down view) or as a prominent card section at the top of entity detail pages (in traditional view). It contains:\n    25→\n    26→- **Dynamic action buttons** — actions that only appear when AI determines they're relevant\n    27→- **Dynamic info cards** — contextual information the system thinks the user needs NOW\n    28→- **Dynamic prompts** — questions the AI asks the user, where answering triggers automated workflows\n    29→- **Dynamic warnings** — alerts about this specific entity that require attention\n    30→\n    31→### Examples of Dynamic AI Elements by Entity Type\n    32→\n    33→**When viewing a TENANT who has been waiting 47 days for a repair:**\n    34→\n    35→```\n    36→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    37→│ ✦ Yantra has identified 3 actions for this tenant            │\n    38→│                                                               │\n    39→│ [📧 Send Holding Update]  [📞 Log Apology Call]              │\n    40→│  \"Mrs Chen has waited 47      \"AI has drafted a call         │\n    41→│   days for REP-2024-4521.      script acknowledging the      │\n    42→│   AI has drafted an update     delay with explanation and     │\n    43→│   email explaining the delay   compensation offer.\"           │\n    44→│   and new expected date.\"                                     │\n    45→│                                                               │\n    46→│ [⚠️ Escalate to Manager]                                     │\n    47→│  \"This repair has exceeded 2x the routine target.             │\n    48→│   Escalation recommended to prevent complaint.\"               │\n    49→│                                                               │\n    50→│ 🔮 PREDICTION: 72% probability this tenant will raise a      │\n    51→│    complaint within 14 days if repair not completed.          │\n    52→│    Estimated compensation liability: £150-£300.               │\n    53→└──────────────────────────────────────────────────────────────┘\n    54→```\n    55→\n    56→When the officer clicks **[Send Holding Update]**:\n    57→1. AI shows a pre-drafted email using the tenant's preferred communication method, referencing the specific repair, the delay reason (from contractor notes), and the new expected completion date (from schedule)\n    58→2. The officer can edit the draft or approve it\n    59→3. On sending, AI asks: **\"Would you like to create a follow-up task?\"** — Yes/No\n    60→4. If Yes: **\"When should the follow-up be?\"** — offers \"Day after expected completion\", \"3 working days\", \"1 week\", or custom date\n    61→5. AI auto-creates the task, assigns it to the officer, links it to the repair case, and sets a reminder\n    62→6. If the repair is STILL not done by the follow-up date, AI automatically escalates the priority and notifies the manager\n    63→\n    64→**When viewing a TENANT with arrears who just started a UC claim:**\n    65→\n    66→```\n    67→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    68→│ ✦ Context: UC claim started 3 weeks ago. First payment       │\n    69→│   expected in ~2 weeks. Current arrears: £487.                │\n    70→│                                                               │\n    71→│ [💬 Supportive Call Script]  [📋 Request APA]                 │\n    72→│  \"AI has drafted a call        \"Alternative Payment           │\n    73→│   script that acknowledges     Arrangement application        │\n    74→│   the UC transition, offers    pre-filled and ready to        │\n    75→│   reassurance, and checks      submit to DWP.\"                │\n    76→│   for income maximisation                                     │\n    77→│   opportunities.\"                                             │\n    78→│                                                               │\n    79→│ [🏦 Income Maximisation Check]  [📝 Create Payment Plan]     │\n    80→│  \"Run benefits entitlement      \"AI suggests: £15/week        │\n    81→│   estimate for this household   toward arrears based on       │\n    82→│   based on known composition    household income estimate     │\n    83→│   and tenure type.\"             and other commitments.\"       │\n    84→│                                                               │\n    85→│ ℹ️ DO NOT escalate to formal action — UC transition is a     │\n    86→│    recognised temporary cause. Pre-Action Protocol requires   │\n    87→│    verification of UC claim before any legal action.          │\n    88→└──────────────────────────────────────────────────────────────┘\n    89→```\n    90→\n    91→**When viewing a BUILDING with expiring compliance:**\n    92→\n    93→```\n    94→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    95→│ ✦ 3 compliance items need attention for this building        │\n    96→│                                                               │\n    97→│ [🔧 Book Contractor Visit]                                    │\n    98→│  \"2 EICRs expired (Unit 12, Unit 18). AI has checked          │\n    99→│   contractor availability — next slot: Thursday 10am.         │\n   100→│   Pre-filled job ticket attached.\"                            │\n   101→│                                                               │\n   102→│ [📋 Generate FRA Action Report]                               │\n   103→│  \"Fire risk assessment is due for review in 45 days.          │\n   104→│   2 outstanding action items. AI has generated a status       │\n   105→│   report for the building safety lead.\"                       │\n   106→│                                                               │\n   107→│ [📧 Send Access Letters]                                      │\n   108→│  \"Unit 12 — Mrs Williams has refused access twice.            │\n   109→│   AI suggests: accompanied visit with support worker          │\n   110→│   (vulnerability flag: hoarding). Letter 3 template ready.\"  │\n   111→│                                                               │\n   112→│ 🔮 Based on contractor workload, if EICRs are not booked     │\n   113→│    this week, they won't be completed before TSM reporting    │\n   114→│    deadline. Impact: BS03 drops from 97.8% to 97.6%.         │\n   115→└──────────────────────────────────────────────────────────────┘\n   116→```\n   117→\n   118→**When viewing an ASB CASE where evidence is building:**\n   119→\n   120→```\n   121→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n   122→│ ✦ Case analysis for ASB-2024-00034                            │\n   123→│                                                               │\n   124→│ [📋 Generate Evidence Bundle]                                 │\n   125→│  \"AI has compiled: 14 diary entries, 3 witness statements,    │\n   126→│   noise recordings (4), photos (7). Formatted for court       │\n   127→│   if injunction is pursued.\"                                  │\n   128→│                                                               │\n   129→│ [🤝 Refer to Mediation]                                      │\n   130→│  \"Before legal escalation, mediation has 65% success rate     │\n   131→│   for noise cases in this category. Local mediation service   │\n   132→│   has availability next Tuesday.\"                             │\n   133→│                                                               │\n   134→│ [📞 Multi-Agency Referral]                                    │\n   135→│  \"Perpetrator profile suggests mental health involvement.     │\n   136→│   AI has pre-filled referral forms for Community Mental        │\n   137→│   Health Team and Safer Neighbourhood Team.\"                  │\n   138→│                                                               │\n   139→│ 🔮 PREDICTION: Based on case pattern, 60% probability this   │\n   140→│    will require CPN within 8 weeks. Evidence quality is       │\n   141→│    currently GOOD for legal threshold.                        │\n   142→└──────────────────────────────────────────────────────────────┘\n   143→```\n   144→\n   145→**When viewing a REPAIR CASE that has been completed:**\n   146→\n   147→Even on CLOSED cases, AI adds value:\n   148→\n   149→```\n   150→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n   151→│ ✦ Post-completion analysis for REP-2024-03211                │\n   152→│                                                               │\n   153→│ [📊 Root Cause Analysis]                                      │\n   154→│  \"This is the 4th plumbing repair at this property in 12      │\n   155→│   months. Pattern: corroded supply pipe. Proactive            │\n   156→│   replacement cost: £800. Continued responsive cost:          │\n   157→│   projected £2,400/year.\"                                     │\n   158→│                                                               │\n   159→│ [📋 Create Capital Works Request]                             │\n   160→│  \"One click to create a planned works request for supply      │\n   161→│   pipe replacement, pre-filled with cost justification        │\n   162→│   from repair history analysis.\"                              │\n   163→│                                                               │\n   164→│ [📧 Send Satisfaction Follow-Up]                              │\n   165→│  \"Tenant rated this repair 2/5. AI has drafted a follow-up   │\n   166→│   message acknowledging the poor experience and explaining    │\n   167→│   what's being done to prevent recurrence.\"                   │\n   168→└──────────────────────────────────────────────────────────────┘\n   169→```\n   170→\n   171→### The AI Action Flow Pattern\n   172→\n   173→Every AI dynamic button follows this pattern:\n   174→\n   175→1. **PRESENT**: AI shows the button with a brief explanation of WHY it's suggesting this action\n   176→2. **PREVIEW**: Clicking the button shows a preview of what will happen — the drafted email, the pre-filled form, the suggested schedule\n   177→3. **EDIT**: The user can edit anything in the preview\n   178→4. **CONFIRM**: User approves the action\n   179→5. **FOLLOW-UP**: AI asks if the user wants to create follow-up tasks, linked cases, or notifications\n   180→6. **AUTO-CREATE**: If user says yes, AI asks only for genuinely missing information (not anything it already knows), then auto-creates everything — tasks, cases, calendar entries, reminders\n   181→7. **LEARN**: The system records whether the user accepted/modified/rejected the AI suggestion, feeding back into the model\n   182→\n   183→### Dynamic Fields\n   184→\n   185→In addition to dynamic buttons, AI also adds dynamic INFORMATION FIELDS that don't exist in the standard layout:\n   186→\n   187→- On a tenant page: \"Estimated household income: £24,000/year\" (derived from tenure type + bedroom size + UC status + employment indicators — used for affordability assessment)\n   188→- On a property page: \"Carbon emission estimate: 4.2 tonnes/year\" (derived from EPC + heating type + floor area — not stored, calculated live)\n   189→- On a repair page: \"Similar repair average cost: £385\" (from historical data — helps identify outlier costs)\n   190→- On a complaint page: \"Ombudsman determination risk: HIGH\" (based on category, delay, and comparison to published Ombudsman decisions)\n   191→- On a building page: \"Estimated retrofit cost to EPC C: £8,200/unit\" (derived from current EPC data + standard improvement measures)\n   192→\n   193→These appear as subtle cards with a `--status-ai` purple left border and a small \"✦ AI estimate\" label.\n   194→\n   195→---\n   196→\n   197→## YANTRA ASSIST — CONTEXTUAL AI PANEL\n   198→\n   199→### Appearance\n   200→- **Trigger**: Fixed button, bottom-left corner — Yantra.Works diamond mark at 32px with pulsing `--status-ai` purple glow when insights are available. Badge count for actionable items.\n   201→- **Panel**: Slides in from left (400px wide), overlaying sidebar. `--surface-elevated` background, `--status-ai` purple top border. Close button and pin button.\n   202→- **Content changes completely** based on (a) current page/entity and (b) user persona.\n   203→\n   204→### Panel Structure (every page)\n   205→\n   206→```\n   207→┌──────────────────────────────────────┐\n   208→│ ✦ Yantra Assist                      │\n   209→│ [Persona] • [Current page context]   │\n   210→├──────────────────────────────────────┤\n   211→│ 🔴 URGENT                            │\n   212→│ Items needing immediate action        │\n   213→│                                       │\n   214→│ 🟠 ATTENTION                          │\n   215→│ Items approaching deadlines           │\n   216→│                                       │\n   217→│ 💡 INSIGHTS                           │\n   218→│ AI predictions & recommendations      │\n   219→│                                       │\n   220→│ 📊 BRIEFING                           │\n   221→│ Contextual summary & key stats        │\n   222→│                                       │\n   223→│ 🌤️ EXTERNAL FACTORS                   │\n   224→│ Weather, UC changes, local context    │\n   225→├──────────────────────────────────────┤\n   226→│ [Ask Yantra...] chat input            │\n   227→└──────────────────────────────────────┘\n   228→```\n   229→\n   230→Each item is clickable — navigates to the relevant entity.\n   231→\n   232→### External Data Sources (simulated)\n   233→- Met Office weather: rain/temperature forecasts affecting damp risk and outdoor works\n   234→- DWP/UC: benefit changes, managed migration, impact on tenant income\n   235→- Regulator of Social Housing: inspection programme updates, sector benchmarks\n   236→- Housing Ombudsman: recent determinations, Code updates\n   237→- Energy prices: fuel poverty risk, tenant heating behaviour predictions\n   238→- Local authority: planning, roadworks, school terms (ASB patterns)\n   239→\n   240→### Chat Interface\n   241→At panel bottom — natural language queries:\n   242→- \"Which tenants haven't been contacted in 6 months?\"\n   243→- \"Total repair costs for 23 Maple Lane this year?\"\n   244→- \"Draft an arrears letter for Mrs Patel\"\n   245→- \"What if we don't complete the 12 overdue EICRs this month?\"\n   246→\n   247→---\n   248→\n   249→## PERSONA SYSTEM\n   250→\n   251→5 personas determine what Yantra Assist shows and which AI dynamic actions appear. User selects at login or switches via the user menu.\n   252→\n   253→### Persona 1: Chief Operating Officer / Director\n   254→- **Dashboard scope**: Entire organisation\n   255→- **Yantra Assist focus**: Strategic — regulatory risk, portfolio compliance trends, financial performance, TSM trajectory, Regulator inspection readiness\n   256→- **AI dynamic actions**: \"Generate board report\", \"Model rent increase scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n   257→- **Example insight**: \"AI predicts 15% increase in damp reports next month — weather + construction profile. Recommend: activate proactive inspection programme. Cost: £12K. Estimated saving in responsive repairs: £45K.\"\n   258→\n   259→### Persona 2: Head of Housing / Head of Service\n   260→- **Dashboard scope**: Their service area\n   261→- **Yantra Assist focus**: Operational — SLA performance, team capacity, complaint trends, void turnaround, allocations throughput\n   262→- **AI dynamic actions**: \"Rebalance team caseloads\", \"Generate team performance review\", \"Identify training needs from complaint patterns\"\n   263→- **Example insight**: \"8 'silent tenants' identified — no contact in 12+ months. Recommend: welfare check visits this week.\"\n   264→\n   265→### Persona 3: Team Manager / Patch Manager\n   266→- **Dashboard scope**: Their patch/team\n   267→- **Yantra Assist focus**: Team management — individual officer workload, case overdue list, skill gaps, cover arrangements\n   268→- **AI dynamic actions**: \"Reassign cases for officer on leave\", \"Generate patch briefing\", \"Schedule team catch-up based on workload gaps\"\n   269→- **Example insight**: \"Sarah has 47 open cases (average: 32). 3 cases are >30 days overdue. Rebalance recommended.\"\n   270→\n   271→### Persona 4: Housing Officer / Colleague (frontline) ← THE MOST IMPORTANT\n   272→- **Dashboard scope**: Their personal caseload/patch\n   273→- **Yantra Assist shows**: What to do TODAY — appointments, calls, tasks, cases needing action\n   274→- **AI dynamic actions**: The richest set — every tenant page has holding reply buttons, follow-up task creators, referral generators, communication drafters. Every property has booking buttons for contractor visits. Every case has escalation and resolution aids.\n   275→- **Morning briefing**: \"You have 3 urgent items, 12 tasks due, 2 tenancies predicted to enter arrears. Heavy rain Thursday — 4 properties at damp risk.\"\n   276→- **Example on a tenant page**: \"Mrs Chen called 3 times last week. Repair 47 days outstanding. AI suggests: [Send Holding Email] [Escalate Repair] [Log Compensation Offer]. Prediction: 72% complaint risk within 14 days.\"\n   277→\n   278→### Persona 5: Repairs Operative / Contractor\n   279→- **View**: Simplified mobile-optimised layout\n   280→- **Yantra Assist shows**: Today's jobs, access codes, risk alerts, vulnerability flags, previous repair history\n   281→- **AI dynamic actions**: \"Mark complete + take photo\", \"Order follow-on materials\", \"Flag as requiring follow-up inspection\"\n   282→- **No access to**: financial data, personal tenant details beyond what's needed for the job\n   283→\n   284→---\n   285→\n   286→## AI MORNING BRIEFING (`/briefing`)\n   287→\n   288→Full-screen, personalised briefing on login. Animated intro with Yantra mark, then:\n   289→\n   290→- Weather and environmental context for the day\n   291→- **URGENT**: Items needing immediate action (with countdown timers where applicable)\n   292→- **TODAY'S TASKS**: Appointments, calls, letters, case reviews — with count\n   293→- **AI PREDICTIONS**: What the model expects this week for the user's scope\n   294→- **PATCH/PORTFOLIO SNAPSHOT**: Key numbers with trend arrows\n   295→- **[Start my day →]** button → navigates to dashboard\n   296→- **[Skip briefing]** option (can be disabled in settings)\n   297→\n   298→Each item in the briefing is clickable, navigating directly to the relevant entity.\n   299→\n   300→---\n   301→\n   302→## AI-AUGMENTED WORKFLOWS\n   303→\n   304→### Logging a Repair (AI-augmented)\n   305→1. Tenant/operative describes issue (text or simulated voice input)\n   306→2. AI INSTANTLY: categorises (SOR code), assigns priority, identifies trade, checks asbestos register, checks vulnerability flags, checks for recurring pattern, estimates cost, suggests appointment, drafts access instructions, flags Awaab's Law if applicable\n   307→3. AI shows: \"Similar repair done 3 months ago at this property. Recurring issue? [Yes — create investigation case] [No — proceed as new]\"\n   308→4. On completion, AI asks: \"Create follow-up satisfaction call task in 48 hours? [Yes] [No]\"\n   309→\n   310→### Handling Inbound Contact (AI-augmented)\n   311→1. Officer receives email/call from tenant\n   312→2. AI reads/summarises the contact, categorises it:\n   313→   - Repair request → \"Create repair case? [Yes]\" (pre-filled from description)\n   314→   - Complaint → \"This sounds like a complaint. Create Stage 1 complaint? [Yes]\" (pre-categorised)\n   315→   - Arrears query → Shows rent account summary, suggests response\n   316→   - General enquiry → Suggests response from knowledge base\n   317→3. After handling, AI asks: \"Create follow-up task? What's the follow-up action?\"\n   318→4. If user says \"Call back in 3 days to check\", AI creates task, links it, sets reminder\n   319→\n   320→### Sending Any Communication (AI-augmented)\n   321→1. User triggers \"Send letter/email/SMS\" on any entity\n   322→2. AI generates draft using: correct template, tenant's name and details, plain English at appropriate reading level, legally required wording (for notices), correct dates and amounts\n   323→3. Tone options: [Supportive] [Formal] [Urgent] [Legally required] — AI adjusts language\n   324→4. After sending: \"Create follow-up task? [Yes — when?]\" and \"Link to an existing case? [Select case / Create new]\"\n   325→\n   326→### Reviewing Compliance (AI-augmented)\n   327→1. Officer views compliance page\n   328→2. AI doesn't just show expired certs — it shows:\n   329→   - What WILL expire (with timeline)\n   330→   - Impact on TSM scores if not resolved\n   331→   - Pre-drafted contractor instruction for each overdue item\n   332→   - Pre-booked appointment slot (from contractor availability)\n   333→   - No-access risk prediction per property (based on history)\n   334→3. One click: \"Send all appointment letters for gas safety programme this month\" → AI generates personalised letters for each property, queues via Notify\n   335→\n   336→---\n   337→\n   338→## PREDICTIVE INTELLIGENCE ENGINE\n   339→\n   340→8 prediction models, each with real-time scoring:\n   341→\n   342→| Model | Predicts | Inputs | Output | Action |\n   343→|-------|---------|--------|--------|--------|\n   344→| Arrears Risk | Tenancy enters arrears in 30/60/90 days | Payment history, UC status, seasonal patterns, life events | Risk score 0-100 per tenancy | Prioritised worklist + recommended intervention |\n   345→| Damp & Mould | Property develops damp/mould | Construction, orientation, EPC, weather, heating, historical repairs, sensors | Risk score 0-100 per property | Proactive inspection programme |\n   346→| Complaint Escalation | Complaint reaches Stage 2 or Ombudsman | Response time, category, tenant history, handler workload | Escalation probability % | Manager alert + resource reallocation |\n   347→| Void Duration | How long a void will take | Property age, condition survey, previous voids, works backlog | Estimated days | Realistic timeline + contractor pre-booking |\n   348→| Repair Recurrence | Repair will recur; root cause | Repair history, component age, weather, contractor quality | Recurrence probability + cause | Capital investment recommendation |\n   349→| Vulnerability | Tenant may be vulnerable but unidentified | Contact frequency, repair patterns, payment changes, household | Risk flags + evidence | Welfare check recommendation |\n   350→| ASB Escalation | Case requires legal action | Category, perpetrator history, evidence quality, location | Legal action probability | Evidence gathering checklist |\n   351→| Compliance Failure | Property fails compliance before cert expiry | Access history, tenant engagement, contractor availability | Failure probability | Pre-emptive access campaign |\n   352→\n   353→Each model shows on the AI Predictions page (`/ai/predictions`) with: scatter plot of scored entities, top-50 table, feature importance chart, model accuracy metrics (precision/recall/F1 as gauges), last trained date.\n   354→\n   355→---\n   356→\n   357→## 3D DIGITAL TWIN\n   358→\n   359→When drilling into a BUILDING in the visual hierarchy (Level 4), the 2D map transitions to a Three.js 3D building:\n   360→\n   361→- **Exterior**: Procedurally generated from metadata (storeys, footprint, construction type). Colour-coded facade by compliance. Rotate/zoom/pan with OrbitControls.\n   362→- **Exploded view**: Click to separate floors vertically\n   363→- **Floor plan**: Click a floor → units shown as coloured boxes:\n   364→  - Green: occupied, compliant, no issues\n   365→  - Blue: repair in progress\n   366→  - Amber: compliance approaching deadline\n   367→  - Red: overdue, active Awaab's Law, void >28 days\n   368→  - Purple: AI-flagged\n   369→  - Grey: void\n   370→- **Hover unit**: mini-card (tenant name, rent status, compliance, AI score)\n   371→- **Click unit**: navigates to full unit detail\n   372→\n   373→Built with Three.js r128, `<Canvas>` from React Three Fiber, `OrbitControls` and `Text` from drei. Geometry: `BoxGeometry` for building and units, `LineBasicMaterial` for floor separators. Not photorealistic — informative, interactive, visually striking.\n   374→\n   375→---\n   376→\n   377→## ADMINISTRATOR SYSTEM (`/admin`)\n   378→\n   379→### Admin Dashboard (`/admin`)\n   380→- System health: API response times, error rates, active users, storage usage (live charts)\n   381→- User activity: who's logged in, what they're viewing, last actions\n   382→- Data quality score: overall completeness % with drill-down by entity type\n   383→- Integration status: live connection indicators per external system\n   384→- AI model health: accuracy metrics, last training, drift alerts\n   385→\n   386→### Organisation Management (`/admin/organisation`)\n   387→- Profile: name, RP number, address, regulatory status, charity/company numbers\n   388→- Branding: logo, colours, email footer, letter header template\n   389→- Operational parameters (all editable, audit-trailed):\n   390→  - Repair targets per priority, void target, arrears bands, complaint targets, rent increase policy\n   391→  - Working day calendar (bank holidays, closedowns)\n   392→  - Financial year, rent week pattern\n   393→- Multi-organisation: parent/subsidiary group structures\n   394→\n   395→### User Management (`/admin/users`)\n   396→- RBAC with 10 default roles × permissions matrix (view/create/edit/delete/approve per module)\n   397→- Custom role builder\n   398→- User invitation flow, 2FA management, session control\n   399→- User impersonation (\"view as\") — fully audited\n   400→- Patch assignment, team assignment, caseload caps\n   401→\n   402→### Team & Patch Management (`/admin/teams`)\n   403→- Team hierarchies (Director → HoS → Manager → Officers)\n   404→- Patch definition: draw on map or assign by postcode/estate/ward\n   405→- Caseload balancing tool: visual workload distribution with rebalancing recommendations\n   406→- Cover/absence management: auto-reassign cases during leave\n   407→\n   408→### Workflow Engine (`/admin/workflows`)\n   409→- Visual builder (simulated drag-and-drop):\n   410→  - Triggers: system events (repair created, arrears threshold crossed, complaint Day 8, cert expires in 30 days)\n   411→  - Conditions: IF-THEN rules with entity attributes\n   412→  - Actions: send notification, create task, assign, escalate, send letter (Notify), create case, trigger AI analysis\n   413→  - SLA timers, approval gates\n   414→- Pre-built templates: arrears escalation, complaint handling, Awaab's Law, gas access programme, void pipeline, ASB escalation, new tenancy onboarding\n   415→\n   416→### Integration Hub (`/admin/integrations`)\n   417→Cards with logo, status, last sync, configuration:\n   418→- GOV.UK Notify (email/SMS/letters), OS Places API, EPC Open Data, DWP Landlord Portal, Open Banking, GOV.UK Pay, Companies House, HM Land Registry, Met Office, Contractor portals, CORE (MHCLG), HouseMark\n   419→- Webhook manager, API key management, data import/export wizard\n   420→\n   421→### Audit & Compliance (`/admin/audit`)\n   422→- Full audit trail: timestamp, user, entity, field, old value, new value, IP\n   423→- GDPR tools: Subject Access Request processor, Right to Erasure workflow, data retention policies, consent management, Data Processing Register\n   424→- Security log: failed logins, password changes, permission changes, admin actions\n   425→\n   426→### System Configuration (`/admin/system`)\n   427→- Reference data: editable lookup tables for all codelists (repair categories, SOR codes, complaint categories, vulnerability types, property types, tenure types, payment methods, etc.)\n   428→- Form builder (simulated): customise fields on key forms — drag, set required/optional, add validation\n   429→- Notification config: which events trigger email/SMS/push per role\n   430→- Reporting config: KPI targets, RAG thresholds, benchmarking peer group\n   431→- AI config: toggle models on/off, confidence thresholds, data source selection, prediction frequency\n   432→- White-label: for multi-HA deployment — each HA gets own branding overlaid on Yantra design\n   433→\n   434→---\n   435→\n   436→## KEY INTERACTIONS TO IMPLEMENT\n   437→\n   438→These are the signature moments that demonstrate the AI-native paradigm:\n   439→\n   440→### 1. The \"Holding Reply\" Flow\n   441→User views tenant with overdue repair → AI dynamic button \"Send Holding Update\" → pre-drafted email shown → user edits/approves → sent via Notify → AI asks \"Create follow-up task?\" → user says \"3 days\" → task auto-created linked to repair → if repair still not done at follow-up, auto-escalate\n   442→\n   443→### 2. The \"Inbound Email Triage\" Flow\n   444→Email arrives in unified inbox → AI reads it → categorises as repair request → shows \"Create repair? [Yes]\" with pre-filled SOR code and priority → officer confirms → repair case created, appointment suggested, confirmation sent to tenant → AI asks \"Anything else from this email?\" → officer says \"They also mentioned a leak in the hallway\" → AI creates second repair case linked to same contact\n   445→\n   446→### 3. The \"Proactive Damp Prevention\" Flow\n   447→Weather API shows heavy rain forecast → AI cross-references with building data (1960s concrete, north-facing, known penetrating damp history) → generates alert: \"4 properties at high damp risk this week\" → officer views → each property has dynamic button \"Send preventive advice letter\" → pre-drafted letter about ventilation, heating, reporting → sent to all 4 tenants in one click → follow-up inspection tasks auto-created for 2 weeks later\n   448→\n   449→### 4. The \"Compliance Cascade\" Flow\n   450→Admin views compliance dashboard → AI highlights: \"12 EICRs overdue, contractor available Thursday\" → [Book All] button → AI generates 12 job tickets, sends tenant appointment letters, creates calendar entries for contractor, sets follow-up reminders → if any tenant has no-access history, automatically generates escalated access letter instead of standard appointment\n   451→\n   452→### 5. The \"Complaint Prevention\" Flow\n   453→AI detects: tenant called 3 times about same repair, satisfaction declining, case open 42 days → generates Yantra Assist urgent item: \"Complaint likely within 14 days. Recommend: resolve repair this week + proactive apology call + goodwill gesture £50\" → officer clicks \"Execute prevention plan\" → AI: creates urgent repair escalation, drafts apology call script, prepares compensation authorisation for manager → tracks whether complaint was prevented (feeds back to model)\n   454→\n   455→---\n   456→\n   457→## IMPLEMENTATION NOTES FOR DOCUMENT 2\n   458→\n   459→1. **AI dynamic sections should be clearly visually distinct** — purple-tinted border, `--surface-elevated` background, \"✦\" symbol prefix on AI-generated content\n   460→2. **Every AI action button must explain WHY** — not just \"Send Email\" but \"Send holding update — tenant has waited 47 days, 72% complaint risk\"\n   461→3. **The follow-up prompt pattern is essential** — after EVERY action, ask about follow-ups and auto-create if confirmed\n   462→4. **AI elements must appear on EVERY entity page** — tenants, properties, buildings, cases, even closed cases\n   463→5. **Persona switching must immediately change** what's shown in Yantra Assist and what dynamic buttons appear\n   464→6. **Predictions should feel USEFUL, not creepy** — always explain WHY the AI is making a prediction with contributing factors visible\n   465→7. **The admin system must be COMPLETE** — not a settings page, but a full system management suite\n   466→8. **Closed cases still get AI analysis** — recurrence prediction, root cause analysis, trend identification\n   467→9. **External data (weather, DWP, regulator) should feel natural** — woven into insights, not shown as a separate section\n   468→10. **The morning briefing should feel personalised and warm** — not a data dump, but \"Good morning Sarah, here's what needs your attention today\"\n   469→\n   470→Now apply all of these AI-native features, dynamic interface elements, the persona system, admin system, and prediction models to the base application from Document 1. Every page should have both its standard layout AND the AI dynamic zone with contextually relevant buttons, fields, and prompts.\n   471→"}]},"uuid":"979f8248-4b19-4f3f-aa29-f91f83dfa09a","timestamp":"2026-02-26T07:43:35.161Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt","content":"# DOCUMENT 2 OF 2: AI-NATIVE FEATURE REQUIREMENTS\n# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n\n## INSTRUCTION TO AI\n\nThis is the companion document to the Base Specification (Document 1). It defines what makes SocialHomes.Ai genuinely AI-NATIVE — not AI-bolted-on.\n\n**What \"AI-native\" means in SocialHomes.Ai:**\nThe AI doesn't just sit in a sidebar showing information. It dynamically reshapes the interface itself. Every page has standard fields, buttons, and layouts from Document 1 — but ALSO has **dynamic AI-generated buttons, fields, cards, and action prompts** that appear contextually based on the entity being viewed, the data about that entity, the user's persona, external factors, and predictive models. These dynamic elements don't exist in a static system — they are created by intelligence.\n\nApply all features in this document to the base application built from Document 1.\n\n---\n\n## CORE PRINCIPLE: DYNAMIC AI INTERFACE ELEMENTS\n\n### How It Works\n\nEvery entity page (tenant, property, building, case, etc.) has TWO zones:\n\n1. **Standard zone**: The fixed fields, tabs, buttons defined in Document 1 — always present, always in the same place\n2. **AI Dynamic zone**: A clearly-marked section (subtle purple-tinted `--status-ai` left border, `--surface-elevated` background) that contains AI-generated elements that change based on context\n\nThe AI Dynamic zone appears at the top of the right-side context panel (in drill-down view) or as a prominent card section at the top of entity detail pages (in traditional view). It contains:\n\n- **Dynamic action buttons** — actions that only appear when AI determines they're relevant\n- **Dynamic info cards** — contextual information the system thinks the user needs NOW\n- **Dynamic prompts** — questions the AI asks the user, where answering triggers automated workflows\n- **Dynamic warnings** — alerts about this specific entity that require attention\n\n### Examples of Dynamic AI Elements by Entity Type\n\n**When viewing a TENANT who has been waiting 47 days for a repair:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Yantra has identified 3 actions for this tenant            │\n│                                                               │\n│ [📧 Send Holding Update]  [📞 Log Apology Call]              │\n│  \"Mrs Chen has waited 47      \"AI has drafted a call         │\n│   days for REP-2024-4521.      script acknowledging the      │\n│   AI has drafted an update     delay with explanation and     │\n│   email explaining the delay   compensation offer.\"           │\n│   and new expected date.\"                                     │\n│                                                               │\n│ [⚠️ Escalate to Manager]                                     │\n│  \"This repair has exceeded 2x the routine target.             │\n│   Escalation recommended to prevent complaint.\"               │\n│                                                               │\n│ 🔮 PREDICTION: 72% probability this tenant will raise a      │\n│    complaint within 14 days if repair not completed.          │\n│    Estimated compensation liability: £150-£300.               │\n└──────────────────────────────────────────────────────────────┘\n```\n\nWhen the officer clicks **[Send Holding Update]**:\n1. AI shows a pre-drafted email using the tenant's preferred communication method, referencing the specific repair, the delay reason (from contractor notes), and the new expected completion date (from schedule)\n2. The officer can edit the draft or approve it\n3. On sending, AI asks: **\"Would you like to create a follow-up task?\"** — Yes/No\n4. If Yes: **\"When should the follow-up be?\"** — offers \"Day after expected completion\", \"3 working days\", \"1 week\", or custom date\n5. AI auto-creates the task, assigns it to the officer, links it to the repair case, and sets a reminder\n6. If the repair is STILL not done by the follow-up date, AI automatically escalates the priority and notifies the manager\n\n**When viewing a TENANT with arrears who just started a UC claim:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Context: UC claim started 3 weeks ago. First payment       │\n│   expected in ~2 weeks. Current arrears: £487.                │\n│                                                               │\n│ [💬 Supportive Call Script]  [📋 Request APA]                 │\n│  \"AI has drafted a call        \"Alternative Payment           │\n│   script that acknowledges     Arrangement application        │\n│   the UC transition, offers    pre-filled and ready to        │\n│   reassurance, and checks      submit to DWP.\"                │\n│   for income maximisation                                     │\n│   opportunities.\"                                             │\n│                                                               │\n│ [🏦 Income Maximisation Check]  [📝 Create Payment Plan]     │\n│  \"Run benefits entitlement      \"AI suggests: £15/week        │\n│   estimate for this household   toward arrears based on       │\n│   based on known composition    household income estimate     │\n│   and tenure type.\"             and other commitments.\"       │\n│                                                               │\n│ ℹ️ DO NOT escalate to formal action — UC transition is a     │\n│    recognised temporary cause. Pre-Action Protocol requires   │\n│    verification of UC claim before any legal action.          │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing a BUILDING with expiring compliance:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ 3 compliance items need attention for this building        │\n│                                                               │\n│ [🔧 Book Contractor Visit]                                    │\n│  \"2 EICRs expired (Unit 12, Unit 18). AI has checked          │\n│   contractor availability — next slot: Thursday 10am.         │\n│   Pre-filled job ticket attached.\"                            │\n│                                                               │\n│ [📋 Generate FRA Action Report]                               │\n│  \"Fire risk assessment is due for review in 45 days.          │\n│   2 outstanding action items. AI has generated a status       │\n│   report for the building safety lead.\"                       │\n│                                                               │\n│ [📧 Send Access Letters]                                      │\n│  \"Unit 12 — Mrs Williams has refused access twice.            │\n│   AI suggests: accompanied visit with support worker          │\n│   (vulnerability flag: hoarding). Letter 3 template ready.\"  │\n│                                                               │\n│ 🔮 Based on contractor workload, if EICRs are not booked     │\n│    this week, they won't be completed before TSM reporting    │\n│    deadline. Impact: BS03 drops from 97.8% to 97.6%.         │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing an ASB CASE where evidence is building:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Case analysis for ASB-2024-00034                            │\n│                                                               │\n│ [📋 Generate Evidence Bundle]                                 │\n│  \"AI has compiled: 14 diary entries, 3 witness statements,    │\n│   noise recordings (4), photos (7). Formatted for court       │\n│   if injunction is pursued.\"                                  │\n│                                                               │\n│ [🤝 Refer to Mediation]                                      │\n│  \"Before legal escalation, mediation has 65% success rate     │\n│   for noise cases in this category. Local mediation service   │\n│   has availability next Tuesday.\"                             │\n│                                                               │\n│ [📞 Multi-Agency Referral]                                    │\n│  \"Perpetrator profile suggests mental health involvement.     │\n│   AI has pre-filled referral forms for Community Mental        │\n│   Health Team and Safer Neighbourhood Team.\"                  │\n│                                                               │\n│ 🔮 PREDICTION: Based on case pattern, 60% probability this   │\n│    will require CPN within 8 weeks. Evidence quality is       │\n│    currently GOOD for legal threshold.                        │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing a REPAIR CASE that has been completed:**\n\nEven on CLOSED cases, AI adds value:\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Post-completion analysis for REP-2024-03211                │\n│                                                               │\n│ [📊 Root Cause Analysis]                                      │\n│  \"This is the 4th plumbing repair at this property in 12      │\n│   months. Pattern: corroded supply pipe. Proactive            │\n│   replacement cost: £800. Continued responsive cost:          │\n│   projected £2,400/year.\"                                     │\n│                                                               │\n│ [📋 Create Capital Works Request]                             │\n│  \"One click to create a planned works request for supply      │\n│   pipe replacement, pre-filled with cost justification        │\n│   from repair history analysis.\"                              │\n│                                                               │\n│ [📧 Send Satisfaction Follow-Up]                              │\n│  \"Tenant rated this repair 2/5. AI has drafted a follow-up   │\n│   message acknowledging the poor experience and explaining    │\n│   what's being done to prevent recurrence.\"                   │\n└──────────────────────────────────────────────────────────────┘\n```\n\n### The AI Action Flow Pattern\n\nEvery AI dynamic button follows this pattern:\n\n1. **PRESENT**: AI shows the button with a brief explanation of WHY it's suggesting this action\n2. **PREVIEW**: Clicking the button shows a preview of what will happen — the drafted email, the pre-filled form, the suggested schedule\n3. **EDIT**: The user can edit anything in the preview\n4. **CONFIRM**: User approves the action\n5. **FOLLOW-UP**: AI asks if the user wants to create follow-up tasks, linked cases, or notifications\n6. **AUTO-CREATE**: If user says yes, AI asks only for genuinely missing information (not anything it already knows), then auto-creates everything — tasks, cases, calendar entries, reminders\n7. **LEARN**: The system records whether the user accepted/modified/rejected the AI suggestion, feeding back into the model\n\n### Dynamic Fields\n\nIn addition to dynamic buttons, AI also adds dynamic INFORMATION FIELDS that don't exist in the standard layout:\n\n- On a tenant page: \"Estimated household income: £24,000/year\" (derived from tenure type + bedroom size + UC status + employment indicators — used for affordability assessment)\n- On a property page: \"Carbon emission estimate: 4.2 tonnes/year\" (derived from EPC + heating type + floor area — not stored, calculated live)\n- On a repair page: \"Similar repair average cost: £385\" (from historical data — helps identify outlier costs)\n- On a complaint page: \"Ombudsman determination risk: HIGH\" (based on category, delay, and comparison to published Ombudsman decisions)\n- On a building page: \"Estimated retrofit cost to EPC C: £8,200/unit\" (derived from current EPC data + standard improvement measures)\n\nThese appear as subtle cards with a `--status-ai` purple left border and a small \"✦ AI estimate\" label.\n\n---\n\n## YANTRA ASSIST — CONTEXTUAL AI PANEL\n\n### Appearance\n- **Trigger**: Fixed button, bottom-left corner — Yantra.Works diamond mark at 32px with pulsing `--status-ai` purple glow when insights are available. Badge count for actionable items.\n- **Panel**: Slides in from left (400px wide), overlaying sidebar. `--surface-elevated` background, `--status-ai` purple top border. Close button and pin button.\n- **Content changes completely** based on (a) current page/entity and (b) user persona.\n\n### Panel Structure (every page)\n\n```\n┌──────────────────────────────────────┐\n│ ✦ Yantra Assist                      │\n│ [Persona] • [Current page context]   │\n├──────────────────────────────────────┤\n│ 🔴 URGENT                            │\n│ Items needing immediate action        │\n│                                       │\n│ 🟠 ATTENTION                          │\n│ Items approaching deadlines           │\n│                                       │\n│ 💡 INSIGHTS                           │\n│ AI predictions & recommendations      │\n│                                       │\n│ 📊 BRIEFING                           │\n│ Contextual summary & key stats        │\n│                                       │\n│ 🌤️ EXTERNAL FACTORS                   │\n│ Weather, UC changes, local context    │\n├──────────────────────────────────────┤\n│ [Ask Yantra...] chat input            │\n└──────────────────────────────────────┘\n```\n\nEach item is clickable — navigates to the relevant entity.\n\n### External Data Sources (simulated)\n- Met Office weather: rain/temperature forecasts affecting damp risk and outdoor works\n- DWP/UC: benefit changes, managed migration, impact on tenant income\n- Regulator of Social Housing: inspection programme updates, sector benchmarks\n- Housing Ombudsman: recent determinations, Code updates\n- Energy prices: fuel poverty risk, tenant heating behaviour predictions\n- Local authority: planning, roadworks, school terms (ASB patterns)\n\n### Chat Interface\nAt panel bottom — natural language queries:\n- \"Which tenants haven't been contacted in 6 months?\"\n- \"Total repair costs for 23 Maple Lane this year?\"\n- \"Draft an arrears letter for Mrs Patel\"\n- \"What if we don't complete the 12 overdue EICRs this month?\"\n\n---\n\n## PERSONA SYSTEM\n\n5 personas determine what Yantra Assist shows and which AI dynamic actions appear. User selects at login or switches via the user menu.\n\n### Persona 1: Chief Operating Officer / Director\n- **Dashboard scope**: Entire organisation\n- **Yantra Assist focus**: Strategic — regulatory risk, portfolio compliance trends, financial performance, TSM trajectory, Regulator inspection readiness\n- **AI dynamic actions**: \"Generate board report\", \"Model rent increase scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n- **Example insight**: \"AI predicts 15% increase in damp reports next month — weather + construction profile. Recommend: activate proactive inspection programme. Cost: £12K. Estimated saving in responsive repairs: £45K.\"\n\n### Persona 2: Head of Housing / Head of Service\n- **Dashboard scope**: Their service area\n- **Yantra Assist focus**: Operational — SLA performance, team capacity, complaint trends, void turnaround, allocations throughput\n- **AI dynamic actions**: \"Rebalance team caseloads\", \"Generate team performance review\", \"Identify training needs from complaint patterns\"\n- **Example insight**: \"8 'silent tenants' identified — no contact in 12+ months. Recommend: welfare check visits this week.\"\n\n### Persona 3: Team Manager / Patch Manager\n- **Dashboard scope**: Their patch/team\n- **Yantra Assist focus**: Team management — individual officer workload, case overdue list, skill gaps, cover arrangements\n- **AI dynamic actions**: \"Reassign cases for officer on leave\", \"Generate patch briefing\", \"Schedule team catch-up based on workload gaps\"\n- **Example insight**: \"Sarah has 47 open cases (average: 32). 3 cases are >30 days overdue. Rebalance recommended.\"\n\n### Persona 4: Housing Officer / Colleague (frontline) ← THE MOST IMPORTANT\n- **Dashboard scope**: Their personal caseload/patch\n- **Yantra Assist shows**: What to do TODAY — appointments, calls, tasks, cases needing action\n- **AI dynamic actions**: The richest set — every tenant page has holding reply buttons, follow-up task creators, referral generators, communication drafters. Every property has booking buttons for contractor visits. Every case has escalation and resolution aids.\n- **Morning briefing**: \"You have 3 urgent items, 12 tasks due, 2 tenancies predicted to enter arrears. Heavy rain Thursday — 4 properties at damp risk.\"\n- **Example on a tenant page**: \"Mrs Chen called 3 times last week. Repair 47 days outstanding. AI suggests: [Send Holding Email] [Escalate Repair] [Log Compensation Offer]. Prediction: 72% complaint risk within 14 days.\"\n\n### Persona 5: Repairs Operative / Contractor\n- **View**: Simplified mobile-optimised layout\n- **Yantra Assist shows**: Today's jobs, access codes, risk alerts, vulnerability flags, previous repair history\n- **AI dynamic actions**: \"Mark complete + take photo\", \"Order follow-on materials\", \"Flag as requiring follow-up inspection\"\n- **No access to**: financial data, personal tenant details beyond what's needed for the job\n\n---\n\n## AI MORNING BRIEFING (`/briefing`)\n\nFull-screen, personalised briefing on login. Animated intro with Yantra mark, then:\n\n- Weather and environmental context for the day\n- **URGENT**: Items needing immediate action (with countdown timers where applicable)\n- **TODAY'S TASKS**: Appointments, calls, letters, case reviews — with count\n- **AI PREDICTIONS**: What the model expects this week for the user's scope\n- **PATCH/PORTFOLIO SNAPSHOT**: Key numbers with trend arrows\n- **[Start my day →]** button → navigates to dashboard\n- **[Skip briefing]** option (can be disabled in settings)\n\nEach item in the briefing is clickable, navigating directly to the relevant entity.\n\n---\n\n## AI-AUGMENTED WORKFLOWS\n\n### Logging a Repair (AI-augmented)\n1. Tenant/operative describes issue (text or simulated voice input)\n2. AI INSTANTLY: categorises (SOR code), assigns priority, identifies trade, checks asbestos register, checks vulnerability flags, checks for recurring pattern, estimates cost, suggests appointment, drafts access instructions, flags Awaab's Law if applicable\n3. AI shows: \"Similar repair done 3 months ago at this property. Recurring issue? [Yes — create investigation case] [No — proceed as new]\"\n4. On completion, AI asks: \"Create follow-up satisfaction call task in 48 hours? [Yes] [No]\"\n\n### Handling Inbound Contact (AI-augmented)\n1. Officer receives email/call from tenant\n2. AI reads/summarises the contact, categorises it:\n   - Repair request → \"Create repair case? [Yes]\" (pre-filled from description)\n   - Complaint → \"This sounds like a complaint. Create Stage 1 complaint? [Yes]\" (pre-categorised)\n   - Arrears query → Shows rent account summary, suggests response\n   - General enquiry → Suggests response from knowledge base\n3. After handling, AI asks: \"Create follow-up task? What's the follow-up action?\"\n4. If user says \"Call back in 3 days to check\", AI creates task, links it, sets reminder\n\n### Sending Any Communication (AI-augmented)\n1. User triggers \"Send letter/email/SMS\" on any entity\n2. AI generates draft using: correct template, tenant's name and details, plain English at appropriate reading level, legally required wording (for notices), correct dates and amounts\n3. Tone options: [Supportive] [Formal] [Urgent] [Legally required] — AI adjusts language\n4. After sending: \"Create follow-up task? [Yes — when?]\" and \"Link to an existing case? [Select case / Create new]\"\n\n### Reviewing Compliance (AI-augmented)\n1. Officer views compliance page\n2. AI doesn't just show expired certs — it shows:\n   - What WILL expire (with timeline)\n   - Impact on TSM scores if not resolved\n   - Pre-drafted contractor instruction for each overdue item\n   - Pre-booked appointment slot (from contractor availability)\n   - No-access risk prediction per property (based on history)\n3. One click: \"Send all appointment letters for gas safety programme this month\" → AI generates personalised letters for each property, queues via Notify\n\n---\n\n## PREDICTIVE INTELLIGENCE ENGINE\n\n8 prediction models, each with real-time scoring:\n\n| Model | Predicts | Inputs | Output | Action |\n|-------|---------|--------|--------|--------|\n| Arrears Risk | Tenancy enters arrears in 30/60/90 days | Payment history, UC status, seasonal patterns, life events | Risk score 0-100 per tenancy | Prioritised worklist + recommended intervention |\n| Damp & Mould | Property develops damp/mould | Construction, orientation, EPC, weather, heating, historical repairs, sensors | Risk score 0-100 per property | Proactive inspection programme |\n| Complaint Escalation | Complaint reaches Stage 2 or Ombudsman | Response time, category, tenant history, handler workload | Escalation probability % | Manager alert + resource reallocation |\n| Void Duration | How long a void will take | Property age, condition survey, previous voids, works backlog | Estimated days | Realistic timeline + contractor pre-booking |\n| Repair Recurrence | Repair will recur; root cause | Repair history, component age, weather, contractor quality | Recurrence probability + cause | Capital investment recommendation |\n| Vulnerability | Tenant may be vulnerable but unidentified | Contact frequency, repair patterns, payment changes, household | Risk flags + evidence | Welfare check recommendation |\n| ASB Escalation | Case requires legal action | Category, perpetrator history, evidence quality, location | Legal action probability | Evidence gathering checklist |\n| Compliance Failure | Property fails compliance before cert expiry | Access history, tenant engagement, contractor availability | Failure probability | Pre-emptive access campaign |\n\nEach model shows on the AI Predictions page (`/ai/predictions`) with: scatter plot of scored entities, top-50 table, feature importance chart, model accuracy metrics (precision/recall/F1 as gauges), last trained date.\n\n---\n\n## 3D DIGITAL TWIN\n\nWhen drilling into a BUILDING in the visual hierarchy (Level 4), the 2D map transitions to a Three.js 3D building:\n\n- **Exterior**: Procedurally generated from metadata (storeys, footprint, construction type). Colour-coded facade by compliance. Rotate/zoom/pan with OrbitControls.\n- **Exploded view**: Click to separate floors vertically\n- **Floor plan**: Click a floor → units shown as coloured boxes:\n  - Green: occupied, compliant, no issues\n  - Blue: repair in progress\n  - Amber: compliance approaching deadline\n  - Red: overdue, active Awaab's Law, void >28 days\n  - Purple: AI-flagged\n  - Grey: void\n- **Hover unit**: mini-card (tenant name, rent status, compliance, AI score)\n- **Click unit**: navigates to full unit detail\n\nBuilt with Three.js r128, `<Canvas>` from React Three Fiber, `OrbitControls` and `Text` from drei. Geometry: `BoxGeometry` for building and units, `LineBasicMaterial` for floor separators. Not photorealistic — informative, interactive, visually striking.\n\n---\n\n## ADMINISTRATOR SYSTEM (`/admin`)\n\n### Admin Dashboard (`/admin`)\n- System health: API response times, error rates, active users, storage usage (live charts)\n- User activity: who's logged in, what they're viewing, last actions\n- Data quality score: overall completeness % with drill-down by entity type\n- Integration status: live connection indicators per external system\n- AI model health: accuracy metrics, last training, drift alerts\n\n### Organisation Management (`/admin/organisation`)\n- Profile: name, RP number, address, regulatory status, charity/company numbers\n- Branding: logo, colours, email footer, letter header template\n- Operational parameters (all editable, audit-trailed):\n  - Repair targets per priority, void target, arrears bands, complaint targets, rent increase policy\n  - Working day calendar (bank holidays, closedowns)\n  - Financial year, rent week pattern\n- Multi-organisation: parent/subsidiary group structures\n\n### User Management (`/admin/users`)\n- RBAC with 10 default roles × permissions matrix (view/create/edit/delete/approve per module)\n- Custom role builder\n- User invitation flow, 2FA management, session control\n- User impersonation (\"view as\") — fully audited\n- Patch assignment, team assignment, caseload caps\n\n### Team & Patch Management (`/admin/teams`)\n- Team hierarchies (Director → HoS → Manager → Officers)\n- Patch definition: draw on map or assign by postcode/estate/ward\n- Caseload balancing tool: visual workload distribution with rebalancing recommendations\n- Cover/absence management: auto-reassign cases during leave\n\n### Workflow Engine (`/admin/workflows`)\n- Visual builder (simulated drag-and-drop):\n  - Triggers: system events (repair created, arrears threshold crossed, complaint Day 8, cert expires in 30 days)\n  - Conditions: IF-THEN rules with entity attributes\n  - Actions: send notification, create task, assign, escalate, send letter (Notify), create case, trigger AI analysis\n  - SLA timers, approval gates\n- Pre-built templates: arrears escalation, complaint handling, Awaab's Law, gas access programme, void pipeline, ASB escalation, new tenancy onboarding\n\n### Integration Hub (`/admin/integrations`)\nCards with logo, status, last sync, configuration:\n- GOV.UK Notify (email/SMS/letters), OS Places API, EPC Open Data, DWP Landlord Portal, Open Banking, GOV.UK Pay, Companies House, HM Land Registry, Met Office, Contractor portals, CORE (MHCLG), HouseMark\n- Webhook manager, API key management, data import/export wizard\n\n### Audit & Compliance (`/admin/audit`)\n- Full audit trail: timestamp, user, entity, field, old value, new value, IP\n- GDPR tools: Subject Access Request processor, Right to Erasure workflow, data retention policies, consent management, Data Processing Register\n- Security log: failed logins, password changes, permission changes, admin actions\n\n### System Configuration (`/admin/system`)\n- Reference data: editable lookup tables for all codelists (repair categories, SOR codes, complaint categories, vulnerability types, property types, tenure types, payment methods, etc.)\n- Form builder (simulated): customise fields on key forms — drag, set required/optional, add validation\n- Notification config: which events trigger email/SMS/push per role\n- Reporting config: KPI targets, RAG thresholds, benchmarking peer group\n- AI config: toggle models on/off, confidence thresholds, data source selection, prediction frequency\n- White-label: for multi-HA deployment — each HA gets own branding overlaid on Yantra design\n\n---\n\n## KEY INTERACTIONS TO IMPLEMENT\n\nThese are the signature moments that demonstrate the AI-native paradigm:\n\n### 1. The \"Holding Reply\" Flow\nUser views tenant with overdue repair → AI dynamic button \"Send Holding Update\" → pre-drafted email shown → user edits/approves → sent via Notify → AI asks \"Create follow-up task?\" → user says \"3 days\" → task auto-created linked to repair → if repair still not done at follow-up, auto-escalate\n\n### 2. The \"Inbound Email Triage\" Flow\nEmail arrives in unified inbox → AI reads it → categorises as repair request → shows \"Create repair? [Yes]\" with pre-filled SOR code and priority → officer confirms → repair case created, appointment suggested, confirmation sent to tenant → AI asks \"Anything else from this email?\" → officer says \"They also mentioned a leak in the hallway\" → AI creates second repair case linked to same contact\n\n### 3. The \"Proactive Damp Prevention\" Flow\nWeather API shows heavy rain forecast → AI cross-references with building data (1960s concrete, north-facing, known penetrating damp history) → generates alert: \"4 properties at high damp risk this week\" → officer views → each property has dynamic button \"Send preventive advice letter\" → pre-drafted letter about ventilation, heating, reporting → sent to all 4 tenants in one click → follow-up inspection tasks auto-created for 2 weeks later\n\n### 4. The \"Compliance Cascade\" Flow\nAdmin views compliance dashboard → AI highlights: \"12 EICRs overdue, contractor available Thursday\" → [Book All] button → AI generates 12 job tickets, sends tenant appointment letters, creates calendar entries for contractor, sets follow-up reminders → if any tenant has no-access history, automatically generates escalated access letter instead of standard appointment\n\n### 5. The \"Complaint Prevention\" Flow\nAI detects: tenant called 3 times about same repair, satisfaction declining, case open 42 days → generates Yantra Assist urgent item: \"Complaint likely within 14 days. Recommend: resolve repair this week + proactive apology call + goodwill gesture £50\" → officer clicks \"Execute prevention plan\" → AI: creates urgent repair escalation, drafts apology call script, prepares compensation authorisation for manager → tracks whether complaint was prevented (feeds back to model)\n\n---\n\n## IMPLEMENTATION NOTES FOR DOCUMENT 2\n\n1. **AI dynamic sections should be clearly visually distinct** — purple-tinted border, `--surface-elevated` background, \"✦\" symbol prefix on AI-generated content\n2. **Every AI action button must explain WHY** — not just \"Send Email\" but \"Send holding update — tenant has waited 47 days, 72% complaint risk\"\n3. **The follow-up prompt pattern is essential** — after EVERY action, ask about follow-ups and auto-create if confirmed\n4. **AI elements must appear on EVERY entity page** — tenants, properties, buildings, cases, even closed cases\n5. **Persona switching must immediately change** what's shown in Yantra Assist and what dynamic buttons appear\n6. **Predictions should feel USEFUL, not creepy** — always explain WHY the AI is making a prediction with contributing factors visible\n7. **The admin system must be COMPLETE** — not a settings page, but a full system management suite\n8. **Closed cases still get AI analysis** — recurrence prediction, root cause analysis, trend identification\n9. **External data (weather, DWP, regulator) should feel natural** — woven into insights, not shown as a separate section\n10. **The morning briefing should feel personalised and warm** — not a data dump, but \"Good morning Sarah, here's what needs your attention today\"\n\nNow apply all of these AI-native features, dynamic interface elements, the persona system, admin system, and prediction models to the base application from Document 1. Every page should have both its standard layout AND the AI dynamic zone with contextually relevant buttons, fields, and prompts.\n","numLines":471,"startLine":1,"totalLines":471}},"sourceToolAssistantUUID":"08f3196e-75b5-4435-b820-b2135579a7af"}
{"parentUuid":"979f8248-4b19-4f3f-aa29-f91f83dfa09a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YZRsz1CXuhaHNQqw8uLHhN","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"01f8fd82-02eb-44b3-b8a1-7187b2fd69da","timestamp":"2026-02-26T07:43:35.354Z"}
{"parentUuid":"01f8fd82-02eb-44b3-b8a1-7187b2fd69da","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (27477 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_01YZRsz1CXuhaHNQqw8uLHhN"}]},"uuid":"eee2d432-e0ac-4d01-937a-1190eb4d2d6a","timestamp":"2026-02-26T07:43:35.558Z","toolUseResult":"Error: File content (27477 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","sourceToolAssistantUUID":"01f8fd82-02eb-44b3-b8a1-7187b2fd69da"}
{"parentUuid":"eee2d432-e0ac-4d01-937a-1190eb4d2d6a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QyWJf67piZy8gJdD23kJAe","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc4-UI-UX-Audit-Build-Guide.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"0b748b8d-a8f7-431e-8e81-face8a5eb109","timestamp":"2026-02-26T07:43:35.803Z"}
{"parentUuid":"0b748b8d-a8f7-431e-8e81-face8a5eb109","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01QyWJf67piZy8gJdD23kJAe"}]},"uuid":"f28ad720-0ac9-4e1b-8221-53e2e8e78a64","timestamp":"2026-02-26T07:43:35.804Z","toolUseResult":"Sibling tool call errored","sourceToolAssistantUUID":"0b748b8d-a8f7-431e-8e81-face8a5eb109"}
{"parentUuid":"f28ad720-0ac9-4e1b-8221-53e2e8e78a64","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FbMiK2zsg9SoDFPaxNKSYo","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":3715},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"db5ff668-e580-479c-88a9-1cd01fc708e1","timestamp":"2026-02-26T07:43:36.187Z"}
{"parentUuid":"db5ff668-e580-479c-88a9-1cd01fc708e1","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01FbMiK2zsg9SoDFPaxNKSYo"}]},"uuid":"e9b92d45-13b5-4c27-82ed-09fe8eae66c3","timestamp":"2026-02-26T07:43:36.187Z","toolUseResult":"Sibling tool call errored","sourceToolAssistantUUID":"db5ff668-e580-479c-88a9-1cd01fc708e1"}
{"parentUuid":"e9b92d45-13b5-4c27-82ed-09fe8eae66c3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01DZ2YTCsV1P57vuP314UJZv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EYzygDJ9BCCt53ha6Ha9zu","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3715,"cache_read_input_tokens":19563,"output_tokens":401,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":3715,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWJhYDVvbRUUYuN4vWTs","type":"assistant","uuid":"7d3d81e1-dee6-4ac4-8cd2-873805402d5e","timestamp":"2026-02-26T07:43:36.644Z"}
{"parentUuid":"7d3d81e1-dee6-4ac4-8cd2-873805402d5e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01EYzygDJ9BCCt53ha6Ha9zu"}]},"uuid":"9ef04d77-5231-4b5f-b1e4-366841e0dae1","timestamp":"2026-02-26T07:43:36.645Z","toolUseResult":"Sibling tool call errored","sourceToolAssistantUUID":"7d3d81e1-dee6-4ac4-8cd2-873805402d5e"}
{"parentUuid":"9ef04d77-5231-4b5f-b1e4-366841e0dae1","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01BpokFr2LY32wTMsfSoD17T","type":"message","role":"assistant","content":[{"type":"text","text":"Let me read the remaining files with pagination:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":19329,"cache_read_input_tokens":23278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":19329},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhv7d6CNG2jZsh5VxM","type":"assistant","uuid":"42f46597-67c2-4cae-9ba9-66a4891bcfb5","timestamp":"2026-02-26T07:43:39.335Z"}
{"parentUuid":"42f46597-67c2-4cae-9ba9-66a4891bcfb5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01BpokFr2LY32wTMsfSoD17T","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XAsnfCNFZHFqmqrvbXJjEZ","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt","limit":500},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":19329,"cache_read_input_tokens":23278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":19329},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhv7d6CNG2jZsh5VxM","type":"assistant","uuid":"9e40f9ea-852c-494d-9c8c-9e5bd9c472e8","timestamp":"2026-02-26T07:43:40.730Z"}
{"parentUuid":"9e40f9ea-852c-494d-9c8c-9e5bd9c472e8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XAsnfCNFZHFqmqrvbXJjEZ","type":"tool_result","content":"     1→# DOCUMENT 3 OF 3: PUBLIC API INTEGRATION REQUIREMENTS\n     2→# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n     3→# Business Analyst Requirements Specification\n     4→# Version 1.0 — 14 February 2026\n     5→\n     6→## TABLE OF CONTENTS\n     7→\n     8→1.  Executive Summary\n     9→2.  Integration Architecture\n    10→3.  Tier 1: Free APIs (No API Key)\n    11→4.  Tier 2: Free APIs (Registration Required)\n    12→5.  Tier 3: Mock Now, Wire Later\n    13→6.  Seven Killer Differentiators — Composite Feature Specifications\n    14→7.  Data Model Extensions\n    15→8.  Server Route Summary\n    16→9.  Environment Variable Registry\n    17→10. Implementation Roadmap\n    18→11. Appendix: Affected Pages Matrix\n    19→\n    20→---\n    21→\n    22→## 1. EXECUTIVE SUMMARY\n    23→\n    24→SocialHomes.Ai currently operates with rich internal data (properties, tenants, cases,\n    25→compliance, rent) stored in Firestore and served through an Express API on Cloud Run.\n    26→The existing server/src/routes/public-data.ts has three starter integrations:\n    27→\n    28→  - EPC Register API (simulated fallback when no key)\n    29→  - IMD data (fully simulated)\n    30→  - Open-Meteo weather (live, no key required)\n    31→\n    32→This document specifies the full integration of 25+ external public service APIs across\n    33→three tiers, culminating in seven composite \"Killer Differentiator\" features that combine\n    34→internal and external data to produce intelligence no competitor can match.\n    35→\n    36→### Guiding Principles\n    37→\n    38→  GP-1  Server-side proxy only — the React client NEVER calls external APIs directly.\n    39→        All external calls route through /api/v1/public-data/* endpoints.\n    40→  GP-2  Graceful degradation — every external call has a simulated fallback. If an API\n    41→        is down or unregistered, the system continues with synthetic data marked\n    42→        source: \"simulated\".\n    43→  GP-3  Caching — external data is cached in Firestore subcollections with TTL metadata.\n    44→        Weather: 1 hour. Crime: 24 hours. EPC: 30 days. IMD/Census: 90 days.\n    45→  GP-4  Audit trail — every external API call is logged to the auditLog collection with\n    46→        action: \"external-api-call\", including source, endpoint, response status, and\n    47→        latency.\n    48→  GP-5  Rate limiting — server-side rate limiting per API. Never exceed published\n    49→        fair-use limits. Use token bucket pattern in memory.\n    50→  GP-6  Cost control — Tier 1 and Tier 2 APIs are free. No paid API calls without\n    51→        explicit admin opt-in via /admin/integrations.\n    52→\n    53→---\n    54→\n    55→## 2. INTEGRATION ARCHITECTURE\n    56→\n    57→### 2.1 Server-Side Proxy Pattern\n    58→\n    59→All external API calls follow this pattern:\n    60→\n    61→  Client (React)\n    62→    --> GET /api/v1/public-data/{source}/{params}\n    63→    --> Express route handler (server/src/routes/public-data.ts)\n    64→      --> Check Firestore cache (collection: externalDataCache)\n    65→      --> If cache valid: return cached data with source: \"cached\"\n    66→      --> If cache expired or missing:\n    67→        --> Call external API\n    68→        --> Transform response to internal schema\n    69→        --> Write to Firestore cache with TTL\n    70→        --> Return data with source: \"{api-name}\"\n    71→      --> If external call fails:\n    72→        --> Return simulated data with source: \"simulated\"\n    73→        --> Log error to auditLog\n    74→\n    75→### 2.2 New Firestore Collection: externalDataCache\n    76→\n    77→  Document ID: {source}:{lookup-key}  (e.g., \"police-crime:SE15-4QN\")\n    78→  Fields:\n    79→    source        string    — API identifier\n    80→    lookupKey     string    — postcode, UPRN, lat/lng, LSOA code\n    81→    data          map       — the cached response payload\n    82→    fetchedAt     timestamp — when the data was retrieved\n    83→    ttlSeconds    number    — cache duration\n    84→    expiresAt     timestamp — fetchedAt + ttlSeconds\n    85→    httpStatus    number    — response status from external API\n    86→    latencyMs     number    — round-trip time\n    87→\n    88→### 2.3 New Server Service: server/src/services/external-api.ts\n    89→\n    90→Shared utility module providing:\n    91→  - fetchWithCache(source, key, ttl, fetchFn) — cache-through helper\n    92→  - rateLimiter(source, maxPerMinute) — token bucket\n    93→  - buildAuditEntry(source, endpoint, status, latency) — audit logging\n    94→  - simulatedFallback(source, key) — returns synthetic data\n    95→\n    96→### 2.4 Admin Integration Management\n    97→\n    98→The existing Integration type (app/src/types/index.ts) maps directly to the\n    99→/admin/integrations page. Each API below gets an Integration record:\n   100→\n   101→  { id, name, description, status, lastSync, logo, category }\n   102→\n   103→Admin users can toggle integrations on/off, view last sync status, and manage\n   104→API keys through Secret Manager references.\n   105→\n   106→---\n   107→\n   108→## 3. TIER 1: FREE APIs — NO API KEY REQUIRED\n   109→\n   110→========================================================================\n   111→### 3.1 data.police.uk — Street-Level Crime & ASB\n   112→========================================================================\n   113→\n   114→Base URL:         https://data.police.uk/api/\n   115→Auth:             None (completely open, no key)\n   116→Rate Limit:       15 requests/second (fair use)\n   117→Documentation:    https://data.police.uk/docs/\n   118→\n   119→Key Endpoints:\n   120→  GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n   121→  GET /crimes-street/anti-social-behaviour?lat={lat}&lng={lng}&date={YYYY-MM}\n   122→  GET /crimes-at-location?location_id={id}&date={YYYY-MM}\n   123→  GET /outcomes-at-location?lat={lat}&lng={lng}&date={YYYY-MM}\n   124→  GET /crime-categories?date={YYYY-MM}\n   125→\n   126→Response Shape (crimes-street):\n   127→  [\n   128→    {\n   129→      \"category\": \"anti-social-behaviour\",\n   130→      \"location_type\": \"Force\",\n   131→      \"location\": { \"latitude\": \"51.5\", \"longitude\": \"-0.09\", \"street\": { \"id\": 123, \"name\": \"On or near...\" } },\n   132→      \"context\": \"\",\n   133→      \"outcome_status\": { \"category\": \"...\", \"date\": \"2026-01\" },\n   134→      \"persistent_id\": \"abc123\",\n   135→      \"id\": 12345678,\n   136→      \"month\": \"2026-01\"\n   137→    }\n   138→  ]\n   139→\n   140→Data Mapping to SocialHomes.Ai:\n   141→  Police API field         --> Internal model / usage\n   142→  ---------------------------------------------------------------\n   143→  category                 --> CrimeIncident.category (new type)\n   144→  location.latitude        --> CrimeIncident.lat\n   145→  location.longitude       --> CrimeIncident.lng\n   146→  location.street.name     --> CrimeIncident.streetName\n   147→  outcome_status.category  --> CrimeIncident.outcome\n   148→  month                    --> CrimeIncident.month\n   149→  persistent_id            --> CrimeIncident.externalId\n   150→\n   151→  Aggregate by estate postcode to enrich:\n   152→    Estate.asbCases         — correlate police ASB with internal ASB cases\n   153→    AsbCase (context panel)  — show nearby police-reported incidents\n   154→    BriefingPage             — \"X police-reported ASB incidents near your estates this month\"\n   155→\n   156→New Server Route:\n   157→  GET /api/v1/public-data/crime/:lat/:lng?date=YYYY-MM&category=anti-social-behaviour\n   158→  GET /api/v1/public-data/crime/postcode/:postcode?months=3\n   159→\n   160→  Implementation: Geocode postcode via postcodes.io, then call police API with lat/lng.\n   161→  Cache TTL: 24 hours per postcode per month.\n   162→\n   163→Affected Pages:\n   164→  - /asb (AsbPage.tsx) — crime heatmap overlay on estate map\n   165→  - /asb/:id (AsbDetailPage.tsx) — \"Nearby police incidents\" context card\n   166→  - /explore/.../estate/:id — crime overlay on estate drill-down map\n   167→  - /briefing (BriefingPage.tsx) — estate-level crime summary\n   168→  - /dashboard (DashboardPage.tsx) — ASB KPI enrichment\n   169→\n   170→Priority: P1\n   171→Complexity: Medium\n   172→Dependencies: postcodes.io (for postcode-to-latlong conversion)\n   173→\n   174→User Stories:\n   175→  US-CRIME-01: As a housing officer viewing an ASB case, I want to see police-reported\n   176→    crime incidents near the property on a map, so I can assess the wider pattern of\n   177→    antisocial behaviour and determine whether multi-agency referral is warranted.\n   178→    Acceptance: ASB detail page shows a Leaflet map with markers for police-reported\n   179→    incidents within 500m, colour-coded by category, for the last 3 months.\n   180→\n   181→  US-CRIME-02: As a neighbourhood manager, I want to see a crime heatmap overlaid on\n   182→    my estate maps in the Explore view, so I can identify hotspots and allocate\n   183→    resources accordingly.\n   184→    Acceptance: Explore estate-level map shows translucent heatmap layer with crime\n   185→    density. Toggle for ASB-only vs all crime. Date range selector (last 1/3/6 months).\n   186→\n   187→  US-CRIME-03: As a COO reading the morning briefing, I want to see a summary of\n   188→    police-reported ASB incidents across all estates this month compared to last month,\n   189→    so I can spot emerging patterns requiring strategic intervention.\n   190→    Acceptance: Briefing page includes \"Crime Context\" section with month-on-month\n   191→    comparison per estate. Trend arrows (up/down/stable). Click-through to estate view.\n   192→\n   193→  US-CRIME-04: As a housing officer, I want the AI to automatically correlate internal\n   194→    ASB cases with police data, so I can identify cases where tenants have also reported\n   195→    to the police and build stronger evidence bundles.\n   196→    Acceptance: AI dynamic zone on ASB case detail shows \"Police reports matching this\n   197→    location and timeframe: X incidents\" with link to details.\n   198→\n   199→========================================================================\n   200→### 3.2 postcodes.io — Postcode Lookup, LSOA, Ward, Geography\n   201→========================================================================\n   202→\n   203→Base URL:         https://api.postcodes.io/\n   204→Auth:             None\n   205→Rate Limit:       No published limit (fair use)\n   206→Documentation:    https://postcodes.io/docs\n   207→\n   208→Key Endpoints:\n   209→  GET /postcodes/:postcode\n   210→  POST /postcodes (bulk lookup, max 100)\n   211→  GET /postcodes/:postcode/validate\n   212→  GET /postcodes?lon={lng}&lat={lat} (reverse geocode)\n   213→  GET /outcodes/:outcode\n   214→\n   215→Response Shape (postcode lookup):\n   216→  {\n   217→    \"result\": {\n   218→      \"postcode\": \"SE15 4QN\",\n   219→      \"longitude\": -0.059,\n   220→      \"latitude\": 51.472,\n   221→      \"admin_district\": \"Southwark\",\n   222→      \"admin_ward\": \"Peckham\",\n   223→      \"parish\": null,\n   224→      \"parliamentary_constituency\": \"Camberwell and Peckham\",\n   225→      \"lsoa\": \"Southwark 026A\",\n   226→      \"msoa\": \"Southwark 026\",\n   227→      \"codes\": {\n   228→        \"admin_district\": \"E09000028\",\n   229→        \"admin_ward\": \"E05000535\",\n   230→        \"lsoa\": \"E01003968\",\n   231→        \"msoa\": \"E02000818\"\n   232→      }\n   233→    }\n   234→  }\n   235→\n   236→Data Mapping to SocialHomes.Ai:\n   237→  postcodes.io field          --> Internal model / usage\n   238→  ---------------------------------------------------------------\n   239→  result.latitude             --> Property.lat (validation/enrichment)\n   240→  result.longitude            --> Property.lng (validation/enrichment)\n   241→  result.admin_district       --> LocalAuthority.name (cross-ref)\n   242→  result.admin_ward           --> Property.ward (new field)\n   243→  result.lsoa                 --> Property.lsoa (new field)\n   244→  result.codes.lsoa           --> Property.lsoaCode (new field) — used for IMD lookup\n   245→  result.parliamentary_constituency --> Property.constituency (new field)\n   246→  result.codes.admin_district --> LocalAuthority.onsCode (new field)\n   247→\n   248→  Used as prerequisite for:\n   249→    - Police API (needs lat/lng from postcode)\n   250→    - IMD lookup (needs LSOA code)\n   251→    - Census API (needs LSOA/MSOA codes)\n   252→    - Flood risk API (needs lat/lng)\n   253→    - Geographic grouping in reports\n   254→\n   255→New Server Route:\n   256→  GET /api/v1/public-data/postcode/:postcode\n   257→  POST /api/v1/public-data/postcodes/bulk (body: { postcodes: [...] })\n   258→  GET /api/v1/public-data/postcode/validate/:postcode\n   259→\n   260→  Cache TTL: 90 days (postcodes rarely change).\n   261→\n   262→Affected Pages:\n   263→  - /properties (PropertiesPage.tsx) — address validation on create/edit\n   264→  - /properties/:uprn (PropertyDetailPage.tsx) — geographic context card\n   265→  - /tenancies/new — postcode validation in tenancy creation\n   266→  - /explore (ExplorePage.tsx) — geographic hierarchy enrichment\n   267→  - /reports (ReportsPage.tsx) — grouping by ward/constituency\n   268→  - /allocations (AllocationsPage.tsx) — local connection verification\n   269→\n   270→Priority: P1\n   271→Complexity: Low\n   272→Dependencies: None (this is itself a dependency for many other APIs)\n   273→\n   274→User Stories:\n   275→  US-POST-01: As a housing officer creating a new tenancy, I want the system to\n   276→    validate the postcode and auto-populate latitude, longitude, ward, and LSOA data,\n   277→    so I do not need to manually look up geographic information.\n   278→    Acceptance: On postcode entry, system calls postcodes.io, validates the postcode,\n   279→    and populates lat/lng/ward/lsoa fields. Invalid postcodes show inline error.\n   280→\n   281→  US-POST-02: As a data analyst, I want all properties enriched with LSOA codes, so I\n   282→    can link them to IMD deprivation data and Census demographics for vulnerability\n   283→    analysis.\n   284→    Acceptance: A batch enrichment job (admin-triggered) calls postcodes.io for all\n   285→    properties without LSOA codes and updates their records.\n   286→\n   287→  US-POST-03: As a head of service, I want to group properties and KPIs by ward and\n   288→    parliamentary constituency in reports, so I can produce place-based intelligence\n   289→    for council partnerships.\n   290→    Acceptance: Reports page includes ward/constituency grouping options. Data sourced\n   291→    from postcodes.io-enriched property records.\n   292→\n   293→========================================================================\n   294→### 3.3 Open UPRN (uprn.uk) — UPRN Lookup\n   295→========================================================================\n   296→\n   297→Base URL:         https://uprn.uk/\n   298→Auth:             None (open data under OGL)\n   299→Rate Limit:       Fair use\n   300→Documentation:    https://uprn.uk/\n   301→\n   302→Key Endpoints:\n   303→  GET /postcode/{postcode}.json\n   304→  GET /{uprn}.json\n   305→\n   306→Response Shape (UPRN lookup):\n   307→  {\n   308→    \"uprn\": \"10091553414\",\n   309→    \"postcode\": \"SE15 4QN\",\n   310→    \"latitude\": 51.472,\n   311→    \"longitude\": -0.059,\n   312→    \"x\": 534123.4,\n   313→    \"y\": 176543.2,\n   314→    \"country\": \"England\",\n   315→    \"class_desc\": \"Residential\",\n   316→    \"type_desc\": \"Flat\"\n   317→  }\n   318→\n   319→Data Mapping to SocialHomes.Ai:\n   320→  uprn.uk field        --> Internal model / usage\n   321→  ---------------------------------------------------------------\n   322→  uprn                 --> Property.uprn (validation)\n   323→  postcode             --> Property.postcode (cross-check)\n   324→  latitude/longitude   --> Property.lat/lng (authoritative coordinates)\n   325→  class_desc           --> Property.classificationDesc (new field)\n   326→  type_desc            --> Property.uprnTypeDesc (new field)\n   327→\n   328→  Used to:\n   329→    - Validate UPRNs on property creation\n   330→    - Match EPC certificates to properties by UPRN\n   331→    - Link Gas Safe and EICR records to specific addresses\n   332→    - Support the Property Passport feature (Differentiator 5)\n   333→\n   334→New Server Route:\n   335→  GET /api/v1/public-data/uprn/:uprn\n   336→  GET /api/v1/public-data/uprn/postcode/:postcode\n   337→\n   338→  Cache TTL: 90 days.\n   339→\n   340→Affected Pages:\n   341→  - /properties/:uprn (PropertyDetailPage.tsx) — UPRN validation badge\n   342→  - /properties (PropertiesPage.tsx) — UPRN search/match\n   343→  - /compliance (CompliancePage.tsx) — linking certs to verified UPRNs\n   344→  - /admin/integrations — UPRN match status dashboard\n   345→\n   346→Priority: P1\n   347→Complexity: Low\n   348→Dependencies: None\n   349→\n   350→User Stories:\n   351→  US-UPRN-01: As a data steward, I want to validate all property UPRNs against the\n   352→    national UPRN register, so I can ensure our asset data is accurate and linkable\n   353→    to external datasets (EPC, Gas Safe, Land Registry).\n   354→    Acceptance: Property detail page shows a green \"UPRN Verified\" badge when the UPRN\n   355→    matches uprn.uk data, or a yellow \"UPRN Unverified\" badge when not checked.\n   356→\n   357→  US-UPRN-02: As a system administrator, I want to run a batch UPRN validation job that\n   358→    checks all properties and flags mismatches, so I can maintain data quality.\n   359→    Acceptance: Admin page provides \"Validate All UPRNs\" button. Progress bar shown.\n   360→    Results summary: X verified, Y mismatched, Z not found.\n   361→\n   362→========================================================================\n   363→### 3.4 Open-Meteo API — Weather Forecasts & Historical Data\n   364→========================================================================\n   365→\n   366→Base URL:         https://api.open-meteo.com/v1/\n   367→Auth:             None\n   368→Rate Limit:       10,000 requests/day (non-commercial)\n   369→Documentation:    https://open-meteo.com/en/docs\n   370→\n   371→Key Endpoints (extending existing implementation):\n   372→  GET /forecast?latitude={lat}&longitude={lng}\n   373→      &daily=temperature_2m_max,temperature_2m_min,precipitation_sum,\n   374→             relative_humidity_2m_mean,wind_speed_10m_max\n   375→      &hourly=temperature_2m,relative_humidity_2m,dew_point_2m,\n   376→              surface_pressure,precipitation\n   377→      &timezone=Europe/London\n   378→      &forecast_days=7\n   379→\n   380→  GET /archive?latitude={lat}&longitude={lng}\n   381→      &start_date={YYYY-MM-DD}&end_date={YYYY-MM-DD}\n   382→      &daily=temperature_2m_mean,precipitation_sum,relative_humidity_2m_mean\n   383→      &timezone=Europe/London\n   384→\n   385→Response Shape (forecast):\n   386→  {\n   387→    \"daily\": {\n   388→      \"time\": [\"2026-02-14\", ...],\n   389→      \"temperature_2m_max\": [8.2, ...],\n   390→      \"temperature_2m_min\": [2.1, ...],\n   391→      \"precipitation_sum\": [12.5, ...],\n   392→      \"relative_humidity_2m_mean\": [85, ...]\n   393→    }\n   394→  }\n   395→\n   396→Data Mapping to SocialHomes.Ai:\n   397→  Open-Meteo field                --> Internal model / usage\n   398→  ---------------------------------------------------------------\n   399→  daily.temperature_2m_min        --> DampRiskInput.externalTemp\n   400→  daily.relative_humidity_2m_mean --> DampRiskInput.externalHumidity\n   401→  daily.precipitation_sum         --> DampRiskInput.precipitation\n   402→  hourly.dew_point_2m             --> DampRiskInput.dewPoint (new)\n   403→  archive data (90 days)          --> DampRiskInput.historicalProfile\n   404→\n   405→  Feeds into:\n   406→    - Damp Risk Score calculation (Property.dampRisk)\n   407→    - Awaab's Law risk assessment\n   408→    - Predictive Damp Intelligence (Differentiator 1)\n   409→    - AI Neighbourhood Briefing (Differentiator 6)\n   410→\n   411→New Server Route (extend existing /api/v1/public-data/weather):\n   412→  GET /api/v1/public-data/weather/:lat/:lng (EXISTING — enhance with hourly data)\n   413→  GET /api/v1/public-data/weather/history/:lat/:lng?days=90\n   414→\n   415→  Cache TTL: 1 hour (forecast), 7 days (historical).\n   416→\n   417→Affected Pages:\n   418→  - /compliance/awaabs-law (AwaabsLawPage.tsx) — weather context for damp risk\n   419→  - /properties/:uprn (PropertyDetailPage.tsx) — weather widget, damp risk factors\n   420→  - /briefing (BriefingPage.tsx) — weather summary, damp risk alerts\n   421→  - /dashboard (DashboardPage.tsx) — weather-linked damp risk KPI\n   422→  - /explore/.../estate/:id — weather overlay on estate maps\n   423→\n   424→Priority: P1\n   425→Complexity: Low (existing route, needs enhancement)\n   426→Dependencies: postcodes.io (for lat/lng if only postcode known)\n   427→\n   428→User Stories:\n   429→  US-WEATHER-01: As a property manager, I want to see a 7-day weather forecast for\n   430→    each estate, so I can anticipate conditions that increase damp and mould risk\n   431→    (sustained cold, high humidity, heavy rainfall).\n   432→    Acceptance: Estate detail and property detail pages show a compact weather widget.\n   433→    Days with damp-risk conditions (temp <5C + humidity >80% + precipitation) are\n   434→    highlighted in amber/red.\n   435→\n   436→  US-WEATHER-02: As the AI system, I want 90-day historical weather data for each\n   437→    property location, so I can correlate weather patterns with reported damp/mould\n   438→    cases and improve the predictive damp model.\n   439→    Acceptance: Historical weather data is fetched and cached. Damp risk score\n   440→    calculation incorporates 90-day average humidity and precipitation totals.\n   441→\n   442→  US-WEATHER-03: As a COO reading the morning briefing, I want weather warnings\n   443→    relevant to my estates, so I can proactively prepare for conditions that will\n   444→    generate repair demand (frost, storms, heavy rain).\n   445→    Acceptance: Briefing page shows \"Weather Outlook\" section with 3-day summary.\n   446→    Properties at elevated damp risk due to weather are listed.\n   447→\n   448→========================================================================\n   449→### 3.5 DEFRA Flood Risk API — Flood Warnings & Risk Zones\n   450→========================================================================\n   451→\n   452→Base URL:         https://environment.data.gov.uk/flood-monitoring/\n   453→Auth:             None\n   454→Rate Limit:       Fair use\n   455→Documentation:    https://environment.data.gov.uk/flood-monitoring/doc/reference\n   456→\n   457→Key Endpoints:\n   458→  GET /id/floods?lat={lat}&long={lng}&dist=5\n   459→  GET /id/floodAreas?lat={lat}&long={lng}&dist=3\n   460→  GET /id/stations?lat={lat}&long={lng}&dist=5\n   461→  GET /id/stations/{id}/readings?since=48h\n   462→\n   463→Response Shape (flood warnings):\n   464→  {\n   465→    \"items\": [\n   466→      {\n   467→        \"floodAreaID\": \"062WAF945\",\n   468→        \"severity\": \"Flood alert\",      // \"Severe flood warning\" | \"Flood warning\" | \"Flood alert\" | \"No longer in force\"\n   469→        \"severityLevel\": 3,\n   470→        \"description\": \"River Thames at Southwark\",\n   471→        \"timeRaised\": \"2026-02-14T08:00:00Z\",\n   472→        \"timeSeverityChanged\": \"2026-02-14T08:00:00Z\",\n   473→        \"message\": \"...\"\n   474→      }\n   475→    ]\n   476→  }\n   477→\n   478→Data Mapping to SocialHomes.Ai:\n   479→  DEFRA field           --> Internal model / usage\n   480→  ---------------------------------------------------------------\n   481→  severity              --> FloodAlert.severity (new type)\n   482→  severityLevel         --> FloodAlert.severityLevel\n   483→  description           --> FloodAlert.description\n   484→  timeRaised            --> FloodAlert.raisedAt\n   485→  message               --> FloodAlert.message\n   486→  floodAreaID           --> FloodAlert.areaId\n   487→\n   488→  Feeds into:\n   489→    - Property risk assessment\n   490→    - Briefing page alerts\n   491→    - Insurance and stock condition planning\n   492→\n   493→New Server Route:\n   494→  GET /api/v1/public-data/flood/:lat/:lng?dist=5\n   495→  GET /api/v1/public-data/flood/postcode/:postcode\n   496→\n   497→  Cache TTL: 1 hour (active warnings change frequently).\n   498→\n   499→Affected Pages:\n   500→  - /properties/:uprn (PropertyDetailPage.tsx) — flood risk badge"}]},"uuid":"55324193-e42f-43f7-ae57-f23eae49a516","timestamp":"2026-02-26T07:43:40.754Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt","content":"# DOCUMENT 3 OF 3: PUBLIC API INTEGRATION REQUIREMENTS\n# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n# Business Analyst Requirements Specification\n# Version 1.0 — 14 February 2026\n\n## TABLE OF CONTENTS\n\n1.  Executive Summary\n2.  Integration Architecture\n3.  Tier 1: Free APIs (No API Key)\n4.  Tier 2: Free APIs (Registration Required)\n5.  Tier 3: Mock Now, Wire Later\n6.  Seven Killer Differentiators — Composite Feature Specifications\n7.  Data Model Extensions\n8.  Server Route Summary\n9.  Environment Variable Registry\n10. Implementation Roadmap\n11. Appendix: Affected Pages Matrix\n\n---\n\n## 1. EXECUTIVE SUMMARY\n\nSocialHomes.Ai currently operates with rich internal data (properties, tenants, cases,\ncompliance, rent) stored in Firestore and served through an Express API on Cloud Run.\nThe existing server/src/routes/public-data.ts has three starter integrations:\n\n  - EPC Register API (simulated fallback when no key)\n  - IMD data (fully simulated)\n  - Open-Meteo weather (live, no key required)\n\nThis document specifies the full integration of 25+ external public service APIs across\nthree tiers, culminating in seven composite \"Killer Differentiator\" features that combine\ninternal and external data to produce intelligence no competitor can match.\n\n### Guiding Principles\n\n  GP-1  Server-side proxy only — the React client NEVER calls external APIs directly.\n        All external calls route through /api/v1/public-data/* endpoints.\n  GP-2  Graceful degradation — every external call has a simulated fallback. If an API\n        is down or unregistered, the system continues with synthetic data marked\n        source: \"simulated\".\n  GP-3  Caching — external data is cached in Firestore subcollections with TTL metadata.\n        Weather: 1 hour. Crime: 24 hours. EPC: 30 days. IMD/Census: 90 days.\n  GP-4  Audit trail — every external API call is logged to the auditLog collection with\n        action: \"external-api-call\", including source, endpoint, response status, and\n        latency.\n  GP-5  Rate limiting — server-side rate limiting per API. Never exceed published\n        fair-use limits. Use token bucket pattern in memory.\n  GP-6  Cost control — Tier 1 and Tier 2 APIs are free. No paid API calls without\n        explicit admin opt-in via /admin/integrations.\n\n---\n\n## 2. INTEGRATION ARCHITECTURE\n\n### 2.1 Server-Side Proxy Pattern\n\nAll external API calls follow this pattern:\n\n  Client (React)\n    --> GET /api/v1/public-data/{source}/{params}\n    --> Express route handler (server/src/routes/public-data.ts)\n      --> Check Firestore cache (collection: externalDataCache)\n      --> If cache valid: return cached data with source: \"cached\"\n      --> If cache expired or missing:\n        --> Call external API\n        --> Transform response to internal schema\n        --> Write to Firestore cache with TTL\n        --> Return data with source: \"{api-name}\"\n      --> If external call fails:\n        --> Return simulated data with source: \"simulated\"\n        --> Log error to auditLog\n\n### 2.2 New Firestore Collection: externalDataCache\n\n  Document ID: {source}:{lookup-key}  (e.g., \"police-crime:SE15-4QN\")\n  Fields:\n    source        string    — API identifier\n    lookupKey     string    — postcode, UPRN, lat/lng, LSOA code\n    data          map       — the cached response payload\n    fetchedAt     timestamp — when the data was retrieved\n    ttlSeconds    number    — cache duration\n    expiresAt     timestamp — fetchedAt + ttlSeconds\n    httpStatus    number    — response status from external API\n    latencyMs     number    — round-trip time\n\n### 2.3 New Server Service: server/src/services/external-api.ts\n\nShared utility module providing:\n  - fetchWithCache(source, key, ttl, fetchFn) — cache-through helper\n  - rateLimiter(source, maxPerMinute) — token bucket\n  - buildAuditEntry(source, endpoint, status, latency) — audit logging\n  - simulatedFallback(source, key) — returns synthetic data\n\n### 2.4 Admin Integration Management\n\nThe existing Integration type (app/src/types/index.ts) maps directly to the\n/admin/integrations page. Each API below gets an Integration record:\n\n  { id, name, description, status, lastSync, logo, category }\n\nAdmin users can toggle integrations on/off, view last sync status, and manage\nAPI keys through Secret Manager references.\n\n---\n\n## 3. TIER 1: FREE APIs — NO API KEY REQUIRED\n\n========================================================================\n### 3.1 data.police.uk — Street-Level Crime & ASB\n========================================================================\n\nBase URL:         https://data.police.uk/api/\nAuth:             None (completely open, no key)\nRate Limit:       15 requests/second (fair use)\nDocumentation:    https://data.police.uk/docs/\n\nKey Endpoints:\n  GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n  GET /crimes-street/anti-social-behaviour?lat={lat}&lng={lng}&date={YYYY-MM}\n  GET /crimes-at-location?location_id={id}&date={YYYY-MM}\n  GET /outcomes-at-location?lat={lat}&lng={lng}&date={YYYY-MM}\n  GET /crime-categories?date={YYYY-MM}\n\nResponse Shape (crimes-street):\n  [\n    {\n      \"category\": \"anti-social-behaviour\",\n      \"location_type\": \"Force\",\n      \"location\": { \"latitude\": \"51.5\", \"longitude\": \"-0.09\", \"street\": { \"id\": 123, \"name\": \"On or near...\" } },\n      \"context\": \"\",\n      \"outcome_status\": { \"category\": \"...\", \"date\": \"2026-01\" },\n      \"persistent_id\": \"abc123\",\n      \"id\": 12345678,\n      \"month\": \"2026-01\"\n    }\n  ]\n\nData Mapping to SocialHomes.Ai:\n  Police API field         --> Internal model / usage\n  ---------------------------------------------------------------\n  category                 --> CrimeIncident.category (new type)\n  location.latitude        --> CrimeIncident.lat\n  location.longitude       --> CrimeIncident.lng\n  location.street.name     --> CrimeIncident.streetName\n  outcome_status.category  --> CrimeIncident.outcome\n  month                    --> CrimeIncident.month\n  persistent_id            --> CrimeIncident.externalId\n\n  Aggregate by estate postcode to enrich:\n    Estate.asbCases         — correlate police ASB with internal ASB cases\n    AsbCase (context panel)  — show nearby police-reported incidents\n    BriefingPage             — \"X police-reported ASB incidents near your estates this month\"\n\nNew Server Route:\n  GET /api/v1/public-data/crime/:lat/:lng?date=YYYY-MM&category=anti-social-behaviour\n  GET /api/v1/public-data/crime/postcode/:postcode?months=3\n\n  Implementation: Geocode postcode via postcodes.io, then call police API with lat/lng.\n  Cache TTL: 24 hours per postcode per month.\n\nAffected Pages:\n  - /asb (AsbPage.tsx) — crime heatmap overlay on estate map\n  - /asb/:id (AsbDetailPage.tsx) — \"Nearby police incidents\" context card\n  - /explore/.../estate/:id — crime overlay on estate drill-down map\n  - /briefing (BriefingPage.tsx) — estate-level crime summary\n  - /dashboard (DashboardPage.tsx) — ASB KPI enrichment\n\nPriority: P1\nComplexity: Medium\nDependencies: postcodes.io (for postcode-to-latlong conversion)\n\nUser Stories:\n  US-CRIME-01: As a housing officer viewing an ASB case, I want to see police-reported\n    crime incidents near the property on a map, so I can assess the wider pattern of\n    antisocial behaviour and determine whether multi-agency referral is warranted.\n    Acceptance: ASB detail page shows a Leaflet map with markers for police-reported\n    incidents within 500m, colour-coded by category, for the last 3 months.\n\n  US-CRIME-02: As a neighbourhood manager, I want to see a crime heatmap overlaid on\n    my estate maps in the Explore view, so I can identify hotspots and allocate\n    resources accordingly.\n    Acceptance: Explore estate-level map shows translucent heatmap layer with crime\n    density. Toggle for ASB-only vs all crime. Date range selector (last 1/3/6 months).\n\n  US-CRIME-03: As a COO reading the morning briefing, I want to see a summary of\n    police-reported ASB incidents across all estates this month compared to last month,\n    so I can spot emerging patterns requiring strategic intervention.\n    Acceptance: Briefing page includes \"Crime Context\" section with month-on-month\n    comparison per estate. Trend arrows (up/down/stable). Click-through to estate view.\n\n  US-CRIME-04: As a housing officer, I want the AI to automatically correlate internal\n    ASB cases with police data, so I can identify cases where tenants have also reported\n    to the police and build stronger evidence bundles.\n    Acceptance: AI dynamic zone on ASB case detail shows \"Police reports matching this\n    location and timeframe: X incidents\" with link to details.\n\n========================================================================\n### 3.2 postcodes.io — Postcode Lookup, LSOA, Ward, Geography\n========================================================================\n\nBase URL:         https://api.postcodes.io/\nAuth:             None\nRate Limit:       No published limit (fair use)\nDocumentation:    https://postcodes.io/docs\n\nKey Endpoints:\n  GET /postcodes/:postcode\n  POST /postcodes (bulk lookup, max 100)\n  GET /postcodes/:postcode/validate\n  GET /postcodes?lon={lng}&lat={lat} (reverse geocode)\n  GET /outcodes/:outcode\n\nResponse Shape (postcode lookup):\n  {\n    \"result\": {\n      \"postcode\": \"SE15 4QN\",\n      \"longitude\": -0.059,\n      \"latitude\": 51.472,\n      \"admin_district\": \"Southwark\",\n      \"admin_ward\": \"Peckham\",\n      \"parish\": null,\n      \"parliamentary_constituency\": \"Camberwell and Peckham\",\n      \"lsoa\": \"Southwark 026A\",\n      \"msoa\": \"Southwark 026\",\n      \"codes\": {\n        \"admin_district\": \"E09000028\",\n        \"admin_ward\": \"E05000535\",\n        \"lsoa\": \"E01003968\",\n        \"msoa\": \"E02000818\"\n      }\n    }\n  }\n\nData Mapping to SocialHomes.Ai:\n  postcodes.io field          --> Internal model / usage\n  ---------------------------------------------------------------\n  result.latitude             --> Property.lat (validation/enrichment)\n  result.longitude            --> Property.lng (validation/enrichment)\n  result.admin_district       --> LocalAuthority.name (cross-ref)\n  result.admin_ward           --> Property.ward (new field)\n  result.lsoa                 --> Property.lsoa (new field)\n  result.codes.lsoa           --> Property.lsoaCode (new field) — used for IMD lookup\n  result.parliamentary_constituency --> Property.constituency (new field)\n  result.codes.admin_district --> LocalAuthority.onsCode (new field)\n\n  Used as prerequisite for:\n    - Police API (needs lat/lng from postcode)\n    - IMD lookup (needs LSOA code)\n    - Census API (needs LSOA/MSOA codes)\n    - Flood risk API (needs lat/lng)\n    - Geographic grouping in reports\n\nNew Server Route:\n  GET /api/v1/public-data/postcode/:postcode\n  POST /api/v1/public-data/postcodes/bulk (body: { postcodes: [...] })\n  GET /api/v1/public-data/postcode/validate/:postcode\n\n  Cache TTL: 90 days (postcodes rarely change).\n\nAffected Pages:\n  - /properties (PropertiesPage.tsx) — address validation on create/edit\n  - /properties/:uprn (PropertyDetailPage.tsx) — geographic context card\n  - /tenancies/new — postcode validation in tenancy creation\n  - /explore (ExplorePage.tsx) — geographic hierarchy enrichment\n  - /reports (ReportsPage.tsx) — grouping by ward/constituency\n  - /allocations (AllocationsPage.tsx) — local connection verification\n\nPriority: P1\nComplexity: Low\nDependencies: None (this is itself a dependency for many other APIs)\n\nUser Stories:\n  US-POST-01: As a housing officer creating a new tenancy, I want the system to\n    validate the postcode and auto-populate latitude, longitude, ward, and LSOA data,\n    so I do not need to manually look up geographic information.\n    Acceptance: On postcode entry, system calls postcodes.io, validates the postcode,\n    and populates lat/lng/ward/lsoa fields. Invalid postcodes show inline error.\n\n  US-POST-02: As a data analyst, I want all properties enriched with LSOA codes, so I\n    can link them to IMD deprivation data and Census demographics for vulnerability\n    analysis.\n    Acceptance: A batch enrichment job (admin-triggered) calls postcodes.io for all\n    properties without LSOA codes and updates their records.\n\n  US-POST-03: As a head of service, I want to group properties and KPIs by ward and\n    parliamentary constituency in reports, so I can produce place-based intelligence\n    for council partnerships.\n    Acceptance: Reports page includes ward/constituency grouping options. Data sourced\n    from postcodes.io-enriched property records.\n\n========================================================================\n### 3.3 Open UPRN (uprn.uk) — UPRN Lookup\n========================================================================\n\nBase URL:         https://uprn.uk/\nAuth:             None (open data under OGL)\nRate Limit:       Fair use\nDocumentation:    https://uprn.uk/\n\nKey Endpoints:\n  GET /postcode/{postcode}.json\n  GET /{uprn}.json\n\nResponse Shape (UPRN lookup):\n  {\n    \"uprn\": \"10091553414\",\n    \"postcode\": \"SE15 4QN\",\n    \"latitude\": 51.472,\n    \"longitude\": -0.059,\n    \"x\": 534123.4,\n    \"y\": 176543.2,\n    \"country\": \"England\",\n    \"class_desc\": \"Residential\",\n    \"type_desc\": \"Flat\"\n  }\n\nData Mapping to SocialHomes.Ai:\n  uprn.uk field        --> Internal model / usage\n  ---------------------------------------------------------------\n  uprn                 --> Property.uprn (validation)\n  postcode             --> Property.postcode (cross-check)\n  latitude/longitude   --> Property.lat/lng (authoritative coordinates)\n  class_desc           --> Property.classificationDesc (new field)\n  type_desc            --> Property.uprnTypeDesc (new field)\n\n  Used to:\n    - Validate UPRNs on property creation\n    - Match EPC certificates to properties by UPRN\n    - Link Gas Safe and EICR records to specific addresses\n    - Support the Property Passport feature (Differentiator 5)\n\nNew Server Route:\n  GET /api/v1/public-data/uprn/:uprn\n  GET /api/v1/public-data/uprn/postcode/:postcode\n\n  Cache TTL: 90 days.\n\nAffected Pages:\n  - /properties/:uprn (PropertyDetailPage.tsx) — UPRN validation badge\n  - /properties (PropertiesPage.tsx) — UPRN search/match\n  - /compliance (CompliancePage.tsx) — linking certs to verified UPRNs\n  - /admin/integrations — UPRN match status dashboard\n\nPriority: P1\nComplexity: Low\nDependencies: None\n\nUser Stories:\n  US-UPRN-01: As a data steward, I want to validate all property UPRNs against the\n    national UPRN register, so I can ensure our asset data is accurate and linkable\n    to external datasets (EPC, Gas Safe, Land Registry).\n    Acceptance: Property detail page shows a green \"UPRN Verified\" badge when the UPRN\n    matches uprn.uk data, or a yellow \"UPRN Unverified\" badge when not checked.\n\n  US-UPRN-02: As a system administrator, I want to run a batch UPRN validation job that\n    checks all properties and flags mismatches, so I can maintain data quality.\n    Acceptance: Admin page provides \"Validate All UPRNs\" button. Progress bar shown.\n    Results summary: X verified, Y mismatched, Z not found.\n\n========================================================================\n### 3.4 Open-Meteo API — Weather Forecasts & Historical Data\n========================================================================\n\nBase URL:         https://api.open-meteo.com/v1/\nAuth:             None\nRate Limit:       10,000 requests/day (non-commercial)\nDocumentation:    https://open-meteo.com/en/docs\n\nKey Endpoints (extending existing implementation):\n  GET /forecast?latitude={lat}&longitude={lng}\n      &daily=temperature_2m_max,temperature_2m_min,precipitation_sum,\n             relative_humidity_2m_mean,wind_speed_10m_max\n      &hourly=temperature_2m,relative_humidity_2m,dew_point_2m,\n              surface_pressure,precipitation\n      &timezone=Europe/London\n      &forecast_days=7\n\n  GET /archive?latitude={lat}&longitude={lng}\n      &start_date={YYYY-MM-DD}&end_date={YYYY-MM-DD}\n      &daily=temperature_2m_mean,precipitation_sum,relative_humidity_2m_mean\n      &timezone=Europe/London\n\nResponse Shape (forecast):\n  {\n    \"daily\": {\n      \"time\": [\"2026-02-14\", ...],\n      \"temperature_2m_max\": [8.2, ...],\n      \"temperature_2m_min\": [2.1, ...],\n      \"precipitation_sum\": [12.5, ...],\n      \"relative_humidity_2m_mean\": [85, ...]\n    }\n  }\n\nData Mapping to SocialHomes.Ai:\n  Open-Meteo field                --> Internal model / usage\n  ---------------------------------------------------------------\n  daily.temperature_2m_min        --> DampRiskInput.externalTemp\n  daily.relative_humidity_2m_mean --> DampRiskInput.externalHumidity\n  daily.precipitation_sum         --> DampRiskInput.precipitation\n  hourly.dew_point_2m             --> DampRiskInput.dewPoint (new)\n  archive data (90 days)          --> DampRiskInput.historicalProfile\n\n  Feeds into:\n    - Damp Risk Score calculation (Property.dampRisk)\n    - Awaab's Law risk assessment\n    - Predictive Damp Intelligence (Differentiator 1)\n    - AI Neighbourhood Briefing (Differentiator 6)\n\nNew Server Route (extend existing /api/v1/public-data/weather):\n  GET /api/v1/public-data/weather/:lat/:lng (EXISTING — enhance with hourly data)\n  GET /api/v1/public-data/weather/history/:lat/:lng?days=90\n\n  Cache TTL: 1 hour (forecast), 7 days (historical).\n\nAffected Pages:\n  - /compliance/awaabs-law (AwaabsLawPage.tsx) — weather context for damp risk\n  - /properties/:uprn (PropertyDetailPage.tsx) — weather widget, damp risk factors\n  - /briefing (BriefingPage.tsx) — weather summary, damp risk alerts\n  - /dashboard (DashboardPage.tsx) — weather-linked damp risk KPI\n  - /explore/.../estate/:id — weather overlay on estate maps\n\nPriority: P1\nComplexity: Low (existing route, needs enhancement)\nDependencies: postcodes.io (for lat/lng if only postcode known)\n\nUser Stories:\n  US-WEATHER-01: As a property manager, I want to see a 7-day weather forecast for\n    each estate, so I can anticipate conditions that increase damp and mould risk\n    (sustained cold, high humidity, heavy rainfall).\n    Acceptance: Estate detail and property detail pages show a compact weather widget.\n    Days with damp-risk conditions (temp <5C + humidity >80% + precipitation) are\n    highlighted in amber/red.\n\n  US-WEATHER-02: As the AI system, I want 90-day historical weather data for each\n    property location, so I can correlate weather patterns with reported damp/mould\n    cases and improve the predictive damp model.\n    Acceptance: Historical weather data is fetched and cached. Damp risk score\n    calculation incorporates 90-day average humidity and precipitation totals.\n\n  US-WEATHER-03: As a COO reading the morning briefing, I want weather warnings\n    relevant to my estates, so I can proactively prepare for conditions that will\n    generate repair demand (frost, storms, heavy rain).\n    Acceptance: Briefing page shows \"Weather Outlook\" section with 3-day summary.\n    Properties at elevated damp risk due to weather are listed.\n\n========================================================================\n### 3.5 DEFRA Flood Risk API — Flood Warnings & Risk Zones\n========================================================================\n\nBase URL:         https://environment.data.gov.uk/flood-monitoring/\nAuth:             None\nRate Limit:       Fair use\nDocumentation:    https://environment.data.gov.uk/flood-monitoring/doc/reference\n\nKey Endpoints:\n  GET /id/floods?lat={lat}&long={lng}&dist=5\n  GET /id/floodAreas?lat={lat}&long={lng}&dist=3\n  GET /id/stations?lat={lat}&long={lng}&dist=5\n  GET /id/stations/{id}/readings?since=48h\n\nResponse Shape (flood warnings):\n  {\n    \"items\": [\n      {\n        \"floodAreaID\": \"062WAF945\",\n        \"severity\": \"Flood alert\",      // \"Severe flood warning\" | \"Flood warning\" | \"Flood alert\" | \"No longer in force\"\n        \"severityLevel\": 3,\n        \"description\": \"River Thames at Southwark\",\n        \"timeRaised\": \"2026-02-14T08:00:00Z\",\n        \"timeSeverityChanged\": \"2026-02-14T08:00:00Z\",\n        \"message\": \"...\"\n      }\n    ]\n  }\n\nData Mapping to SocialHomes.Ai:\n  DEFRA field           --> Internal model / usage\n  ---------------------------------------------------------------\n  severity              --> FloodAlert.severity (new type)\n  severityLevel         --> FloodAlert.severityLevel\n  description           --> FloodAlert.description\n  timeRaised            --> FloodAlert.raisedAt\n  message               --> FloodAlert.message\n  floodAreaID           --> FloodAlert.areaId\n\n  Feeds into:\n    - Property risk assessment\n    - Briefing page alerts\n    - Insurance and stock condition planning\n\nNew Server Route:\n  GET /api/v1/public-data/flood/:lat/:lng?dist=5\n  GET /api/v1/public-data/flood/postcode/:postcode\n\n  Cache TTL: 1 hour (active warnings change frequently).\n\nAffected Pages:\n  - /properties/:uprn (PropertyDetailPage.tsx) — flood risk badge","numLines":500,"startLine":1,"totalLines":2334}},"sourceToolAssistantUUID":"9e40f9ea-852c-494d-9c8c-9e5bd9c472e8"}
{"parentUuid":"55324193-e42f-43f7-ae57-f23eae49a516","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01BpokFr2LY32wTMsfSoD17T","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PnAFuGLrKkbEnmaq3aixTT","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md","limit":500},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":19329,"cache_read_input_tokens":23278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":19329},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhv7d6CNG2jZsh5VxM","type":"assistant","uuid":"f7774f86-0ee1-43db-b254-e2ce172e9a35","timestamp":"2026-02-26T07:43:41.168Z"}
{"parentUuid":"f7774f86-0ee1-43db-b254-e2ce172e9a35","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PnAFuGLrKkbEnmaq3aixTT","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n     4→> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent\n     5→> Studio: Yantra Works\n     6→\n     7→---\n     8→\n     9→## PLAN SUMMARY\n    10→\n    11→| Phase | Name | Sprints | Status | Progress |\n    12→|-------|------|---------|--------|----------|\n    13→| 0 | Infrastructure | — | DONE | 10/10 |\n    14→| 1 | Foundation | 1-2 | DONE | 12/12 |\n    15→| 2 | Intelligence | 3-4 | DONE | 14/14 |\n    16→| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n    17→| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n    18→| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |\n    19→\n    20→---\n    21→\n    22→## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n    23→\n    24→| # | Task | Status | Agent |\n    25→|---|------|--------|-------|\n    26→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    27→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    28→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    29→| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n    30→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    31→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    32→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    33→| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    34→| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    35→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    36→\n    37→---\n    38→\n    39→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n    40→\n    41→### Goal: Core external API infrastructure + free API integrations\n    42→\n    43→| # | Task | Priority | Complexity | Agent | Status |\n    44→|---|------|----------|------------|-------|--------|\n    45→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n    46→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n    47→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n    48→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n    49→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n    50→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n    51→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n    52→| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n    53→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n    54→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n    55→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n    56→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n    57→\n    58→---\n    59→\n    60→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n    61→\n    62→### Goal: 7 killer differentiators + Tier 2 API registrations\n    63→\n    64→| # | Task | Priority | Complexity | Agent | Status |\n    65→|---|------|----------|------------|-------|--------|\n    66→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n    67→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n    68→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n    69→| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n    70→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n    71→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n    72→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n    73→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n    74→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n    75→| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n    76→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n    77→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n    78→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n    79→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n    80→\n    81→---\n    82→\n    83→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n    84→\n    85→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    86→\n    87→| # | Task | Priority | Complexity | Agent | Status |\n    88→|---|------|----------|------------|-------|--------|\n    89→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n    90→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n    91→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n    92→| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    93→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n    94→| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n    95→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n    96→| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n    97→| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n    98→| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    99→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n   100→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n   101→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n   102→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n   103→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n   104→| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n   105→| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n   106→\n   107→---\n   108→\n   109→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n   110→\n   111→### Goal: Mock services + polish + production hardening\n   112→\n   113→| # | Task | Priority | Complexity | Agent | Status |\n   114→|---|------|----------|------------|-------|--------|\n   115→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n   116→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n   117→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n   118→| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n   119→| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n   120→| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n   121→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n   122→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n   123→| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n   124→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n   125→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n   126→| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n   127→| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n   128→| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n   129→\n   130→---\n   131→\n   132→## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)\n   133→\n   134→### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n   135→\n   136→Phase 5 is organized into 5 sub-phases matching the required agent structure:\n   137→Project Setup & Architecture, Backend Development, Frontend Development,\n   138→Testing & QA, and DevOps & Deployment.\n   139→\n   140→---\n   141→\n   142→### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n   143→\n   144→| # | Task | Priority | Complexity | Agent | Status |\n   145→|---|------|----------|------------|-------|--------|\n   146→| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |\n   147→| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |\n   148→| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n   149→| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n   150→| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n   151→| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n   152→| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n   153→| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n   154→| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n   155→\n   156→---\n   157→\n   158→### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n   159→\n   160→| # | Task | Priority | Complexity | Agent | Status |\n   161→|---|------|----------|------------|-------|--------|\n   162→| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n   163→| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n   164→| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n   165→| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n   166→| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n   167→| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n   168→| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n   169→| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n   170→| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n   171→| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n   172→| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n   173→| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n   174→| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n   175→| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n   176→| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n   177→| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n   178→\n   179→---\n   180→\n   181→### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n   182→\n   183→| # | Task | Priority | Complexity | Agent | Status |\n   184→|---|------|----------|------------|-------|--------|\n   185→| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n   186→| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n   187→| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n   188→| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n   189→| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n   190→| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n   191→| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n   192→| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n   193→| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n   194→| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n   195→| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n   196→| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n   197→\n   198→---\n   199→\n   200→### PHASE 5.4: TESTING & QA (Sprints 12-13)\n   201→\n   202→| # | Task | Priority | Complexity | Agent | Status |\n   203→|---|------|----------|------------|-------|--------|\n   204→| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n   205→| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n   206→| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n   207→| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n   208→| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n   209→| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n   210→| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n   211→| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n   212→\n   213→---\n   214→\n   215→### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n   216→\n   217→| # | Task | Priority | Complexity | Agent | Status |\n   218→|---|------|----------|------------|-------|--------|\n   219→| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n   220→| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n   221→| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n   222→| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n   223→| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n   224→| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n   225→| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n   226→| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n   227→| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n   228→\n   229→---\n   230→\n   231→## AGENT ROLES\n   232→\n   233→| Agent | Responsibility | Key Files |\n   234→|-------|---------------|-----------|\n   235→| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   236→| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   237→| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n   238→| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   239→| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n   240→\n   241→---\n   242→\n   243→## KEY DOCUMENTS\n   244→\n   245→| Document | Location | Purpose |\n   246→|----------|----------|---------|\n   247→| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |\n   248→| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |\n   249→| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |\n   250→| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n   251→| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n   252→| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n   253→| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n   254→| CLAUDE.md | Project root | Claude Code project instructions |\n   255→| SESSION-HISTORY.md | Project root | Persistent conversation history |\n   256→| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n   257→| DEVOPS.md | Project root | DevOps and deployment guide |\n   258→| EXECUTION-PLAN.md | Project root | This document |\n   259→\n   260→---\n   261→\n   262→## COMMUNICATION\n   263→\n   264→### Telegram (@SocialHomesBot)\n   265→- **Async notifications**: Build status, deployment confirmations, test results\n   266→- **Permission requests**: Routed via Telegram when user is away from desk\n   267→- **Progress updates**: Phase/sprint completion summaries\n   268→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   269→\n   270→### Session Continuity\n   271→- Update `SESSION-HISTORY.md` at end of every session\n   272→- `CLAUDE.md` provides context for new sessions\n   273→- Entire.io captures checkpoints on commits\n   274→\n   275→---\n   276→\n   277→## METRICS & SUCCESS CRITERIA\n   278→\n   279→| Metric | Target | Current |\n   280→|--------|--------|---------|\n   281→| Selenium test pass rate | > 98% | 99.7% |\n   282→| TypeScript errors | 0 | 0 |\n   283→| Vite build warnings | 0 critical | 0 |\n   284→| API response time (P95) | < 500ms | ~200-300ms |\n   285→| WCAG AA compliance | 100% | 100% |\n   286→| External API uptime | > 99.5% (with fallback) | 100% |\n   287→| Bundle size | < 3MB | ~2.5MB |\n   288→| Cloud Run cold start | < 3s | < 2s |\n   289→\n   290→### Phase 5 Additional Targets\n   291→\n   292→| Metric | Target |\n   293→|--------|--------|\n   294→| AI response latency (Vertex AI) | < 3s for conversational queries |\n   295→| AI response latency (streaming first token) | < 500ms |\n   296→| WebSocket connection stability | > 99.9% uptime |\n   297→| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n   298→| Selenium test coverage | > 95% of routes |\n   299→| Unit test coverage (services) | > 80% line coverage |\n   300→| Staging deployment frequency | Every PR |\n   301→| Database backup frequency | Daily automated |\n   302→| Lighthouse accessibility score | > 90 on all pages |\n   303→| Lighthouse performance score | > 80 on all pages |\n   304→\n   305→---\n   306→\n   307→## DEFERRED ITEMS (From Phases 3-4)\n   308→\n   309→Items deferred from earlier phases, now included in Phase 5:\n   310→\n   311→| Original ID | Task | New Phase 5 ID |\n   312→|-------------|------|----------------|\n   313→| 3.17 | E2E testing for all new features | 5.4.1 |\n   314→| 4.12 | Full regression test suite | 5.4.1 |\n   315→| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n   316→| 4.14 | API reference documentation | 5.1.7 |\n   317→| 4.9 | Cache warming, batch updates | 5.2.6 |\n   318→\n   319→---\n   320→\n   321→## PHASE 5 TASK SUMMARY BY AGENT\n   322→\n   323→| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n   324→|-------|-------------|----|----|----|----|\n   325→| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n   326→| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n   327→| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n   328→| **Tester** | 8 | 0 | 4 | 4 | 0 |\n   329→| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n   330→| **TOTAL** | **50** (DONE: 2, TODO: 48) |\n   331→\n   332→### Recommended Execution Order (Critical Path)\n   333→\n   334→**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n   335→1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n   336→2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n   337→3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n   338→4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n   339→\n   340→**Sprint 10 (Weeks 19-20): Backend Features**\n   341→5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n   342→6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n   343→7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n   344→8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n   345→\n   346→**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n   347→9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n   348→10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n   349→11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n   350→12. 5.3.2 (Notification bell — depends on WebSocket backend)\n   351→13. 5.5.2 (Staging environment — enables test pipeline)\n   352→\n   353→**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n   354→14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n   355→15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n   356→16. 5.4.6 (CI test pipeline — enables automated testing)\n   357→17. 5.4.7 (Test data factory — enables isolated testing)\n   358→\n   359→**Sprint 13 (Weeks 25-26): Testing + QA**\n   360→18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n   361→19. 5.4.8 (Security testing)\n   362→20. 5.5.4 (Cloud Monitoring alerts)\n   363→21. 5.5.5 (Database backup strategy)\n   364→\n   365→**Sprint 14 (Weeks 27-28): DevOps + Polish**\n   366→22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n   367→23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n   368→24. 5.1.7 (API documentation — after all endpoints stable)\n   369→25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n   370→26. Final regression testing and production deploy\n   371→\n   372→---\n   373→\n   374→## DEPENDENCY GRAPH (Key Chains)\n   375→\n   376→```\n   377→Vertex AI Chain:\n   378→  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n   379→    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n   380→    -> 5.2.14 (AI repair intake)\n   381→\n   382→WebSocket Chain:\n   383→  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n   384→    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n   385→    -> 5.2.8 (Firestore listeners)\n   386→\n   387→Testing Chain:\n   388→  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n   389→    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n   390→\n   391→DevOps Chain:\n   392→  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n   393→    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n   394→\n   395→File/Data Chain:\n   396→  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n   397→  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n   398→  5.2.10 (audit log API) -> 5.3.11 (user management)\n   399→```\n   400→\n   401→---\n   402→\n   403→**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n   404→"}]},"uuid":"eb5f7f55-1a61-4c44-8285-aa0118b843de","timestamp":"2026-02-26T07:43:41.404Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 2, TODO: 48) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n","numLines":404,"startLine":1,"totalLines":404}},"sourceToolAssistantUUID":"f7774f86-0ee1-43db-b254-e2ce172e9a35"}
{"parentUuid":"eb5f7f55-1a61-4c44-8285-aa0118b843de","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01BpokFr2LY32wTMsfSoD17T","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FVejp5XnBnXHngn9Gp7SWv","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","limit":500},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":19329,"cache_read_input_tokens":23278,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":19329},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJhv7d6CNG2jZsh5VxM","type":"assistant","uuid":"68ff8d3d-a8e8-4812-bd41-58602196554d","timestamp":"2026-02-26T07:43:41.671Z"}
{"parentUuid":"68ff8d3d-a8e8-4812-bd41-58602196554d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FVejp5XnBnXHngn9Gp7SWv","type":"tool_result","content":"     1→# SocialHomes.Ai — Session History\n     2→\n     3→> Persistent conversation log across all Claude Code sessions.\n     4→> Updated at the end of each session to preserve context.\n     5→\n     6→---\n     7→\n     8→## Session 1 — 2026-02-12 (Google Drive path)\n     9→**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10→**Agent:** Claude Opus 4.6\n    11→\n    12→### What happened:\n    13→- Initial project setup and exploration\n    14→- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15→- Comprehensive Selenium testing initiated (17 test classes)\n    16→- Project overview sent to Telegram\n    17→\n    18→### Key decisions:\n    19→- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20→- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21→- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22→\n    23→---\n    24→\n    25→## Session 2 — 2026-02-13 (Migrated to C: drive)\n    26→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27→**Agent:** Claude Opus 4.6\n    28→\n    29→### What happened:\n    30→- Security cleanup: removed all exposed API keys and secrets from codebase\n    31→- Added full workflow actions and cross-entity navigation\n    32→- Eliminated all React Error #310 instances\n    33→- Redesigned login page\n    34→- Polished dashboard\n    35→- Updated DEVOPS.md\n    36→\n    37→### Commits:\n    38→- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n    39→- `944e952` — feat: add full workflow actions & cross-entity navigation\n    40→- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n    41→- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42→- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n    43→\n    44→---\n    45→\n    46→## Session 3 — 2026-02-14\n    47→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48→**Agent:** Claude Opus 4.6\n    49→\n    50→### What happened:\n    51→\n    52→#### Task 1: Verified 4 previous bug fixes\n    53→- BUG-001: ComplaintDetailPage.tsx — null checks intact\n    54→- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n    55→- BUG-003: AsbPage.tsx — navigation handlers intact\n    56→- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n    57→\n    58→#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59→| Warning | File | Fix |\n    60→|---------|------|-----|\n    61→| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62→| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63→| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64→| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65→| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66→| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67→| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68→| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69→| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70→| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71→| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72→\n    73→#### Task 3: Installed Entire.io CLI\n    74→- Installed v0.4.4 at ~/.local/bin/entire\n    75→- Strategy: manual-commit\n    76→- Fixed all 4 git hooks with PATH export\n    77→\n    78→#### Task 4: Build and deploy\n    79→- TypeScript: 0 errors\n    80→- Vite build: 2,580.62 kB JS bundle\n    81→- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82→- Push: succeeded → Cloud Build triggered\n    83→\n    84→---\n    85→\n    86→## Session 4 — 2026-02-14 (current)\n    87→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88→**Agent:** Claude Opus 4.6\n    89→\n    90→### What happened:\n    91→\n    92→#### Task 5: Telegram notifications setup\n    93→- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94→- Created .mcp.json with telegram MCP server config\n    95→- Added .mcp.json to .gitignore (contains bot token)\n    96→- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97→\n    98→#### Task 6: Persistent conversation history\n    99→- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100→- Added to .gitignore (local dev reference only)\n   101→\n   102→#### Task 7: Entire.io repo\n   103→- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104→- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105→- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106→- Entire.io dashboard: https://app.entire.io (login required)\n   107→\n   108→#### Task 8: UI/UX Audit Document (in progress)\n   109→- Frontend UI engineer agent reviewing all pages, components, interactions\n   110→- Output: comprehensive audit for fullstack and tester agents\n   111→\n   112→#### Task 9: BA Requirements — Public API Integrations (in progress)\n   113→- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114→- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115→- 7 killer differentiators documented\n   116→\n   117→#### Task 10: Master Execution Plan (pending)\n   118→- Will be created after Tasks 8 and 9 complete\n   119→\n   120→---\n   121→\n   122→## Architecture Reference\n   123→\n   124→### Tech Stack\n   125→- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126→- **Backend:** Express.js + TypeScript\n   127→- **Database:** Google Firestore\n   128→- **Hosting:** Google Cloud Run (europe-west2)\n   129→- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n   130→- **Maps:** Leaflet.js + OpenStreetMap\n   131→- **3D:** Three.js\n   132→- **Charts:** Recharts\n   133→- **AI:** YantraAssist (contextual AI assistant)\n   134→\n   135→### Key URLs\n   136→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137→- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138→- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139→- **Firebase Project:** gen-lang-client-0146156913\n   140→- **Entire.io dashboard:** https://app.entire.io\n   141→\n   142→### Personas\n   143→1. COO — Organisation-wide view\n   144→2. Head of Housing — Regional oversight\n   145→3. Housing Manager — Estate/block management\n   146→4. Housing Officer — Frontline casework\n   147→5. Repairs Operative — Job-level repairs\n   148→\n   149→### Telegram Bot\n   150→- Bot: @SocialHomesBot\n   151→- Chat ID: socialhomes:8020560167\n   152→- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153→\n   154→---\n   155→\n   156→## Session 5 — 2026-02-15\n   157→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158→**Agent:** Claude Opus 4.6\n   159→\n   160→### What happened:\n   161→\n   162→#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163→\n   164→**Backend Services Created (7 new files):**\n   165→| Service | File | Description |\n   166→|---------|------|-------------|\n   167→| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168→| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169→| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170→| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171→| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172→| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173→| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174→\n   175→**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176→- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177→- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178→- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179→- D4: `GET /benefits-check/:tenantId`\n   180→- D5: `GET /property-passport/:propertyId`\n   181→- D6: `GET /briefing/:estateId`\n   182→- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183→\n   184→**Frontend Components Created (4 new panels):**\n   185→- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n   186→- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n   187→- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n   188→- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n   189→\n   190→**Frontend Pages Updated:**\n   191→- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n   192→- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n   193→- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n   194→- `api-client.ts` — 13 new AI API methods\n   195→- `useApi.ts` — 10 new React Query hooks\n   196→\n   197→### Build Results:\n   198→- TypeScript (server): 0 errors\n   199→- TypeScript (app): 0 errors\n   200→- Vite build: 3,395 modules, 38.43s\n   201→- All clean on first attempt\n   202→\n   203→### Commits:\n   204→- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205→\n   206→### EXECUTION-PLAN.md updated:\n   207→- Phase 2 marked as DONE (all 14 tasks)\n   208→\n   209→---\n   210→\n   211→## Session 6 — 2026-02-16\n   212→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213→**Agent:** Claude Opus 4.6\n   214→\n   215→### What happened:\n   216→\n   217→#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n   218→\n   219→**New Backend Services (2 files):**\n   220→| Service | File | Lines | Description |\n   221→|---------|------|-------|-------------|\n   222→| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223→| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n   224→\n   225→**API Routes Added (8 new endpoints):**\n   226→- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227→- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228→\n   229→**Frontend Enhancements (5 files modified):**\n   230→- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231→- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232→- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233→- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n   234→\n   235→**Accessibility Fixes (WCAG AA):**\n   236→- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237→- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238→- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239→- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240→\n   241→### Build Results:\n   242→- TypeScript (server): 0 errors\n   243→- TypeScript (app): 0 errors\n   244→- Vite build: 3,396 modules, 39.22s — all clean\n   245→- Server build: clean\n   246→\n   247→### Files Changed: 13 modified + 2 new (523 insertions)\n   248→\n   249→### Commits:\n   250→- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251→\n   252→### EXECUTION-PLAN.md updated:\n   253→- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254→\n   255→---\n   256→\n   257→#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n   258→\n   259→**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260→| Service | Function | Description |\n   261→|---------|----------|-------------|\n   262→| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263→| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264→| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n   265→| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266→| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267→\n   268→**Admin Integration Dashboard:**\n   269→- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270→- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271→- Toggle enable/disable + Test Connection buttons\n   272→- Summary bar: total, active, issues, avg response time\n   273→- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274→- Updated App.tsx routing to use IntegrationsPage\n   275→\n   276→**Security Hardening:**\n   277→- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278→- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279→- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280→- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281→- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282→- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283→- JSON body limit reduced from 10mb to 1mb\n   284→\n   285→**Production Monitoring:**\n   286→- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287→- New `server/src/middleware/metrics.ts` — records every request on res.finish\n   288→- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289→- New admin route: GET /api/v1/admin/monitoring\n   290→- Frontend API client: adminApi.monitoring()\n   291→\n   292→**API Routes Added (8 new):**\n   293→- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294→- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295→\n   296→### Build Results:\n   297→- TypeScript (server): 0 errors\n   298→- TypeScript (app): 0 errors\n   299→- Vite build: 3,397 modules, 35.59s — all clean\n   300→- Server build: clean\n   301→\n   302→### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303→### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304→\n   305→### EXECUTION-PLAN.md updated:\n   306→- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307→\n   308→---\n   309→\n   310→## Session 7 — 2026-02-16 (Cloud Run Deployment)\n   311→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312→**Agent:** Claude Opus 4.6\n   313→\n   314→### What happened:\n   315→\n   316→#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n   317→\n   318→**Problem:** Previous deployment attempts failed:\n   319→1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320→2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321→\n   322→**Resolution:**\n   323→1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324→2. Created 4 secrets in Secret Manager:\n   325→   | Secret | Value Source |\n   326→   |--------|-------------|\n   327→   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328→   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329→   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330→   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331→3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332→4. Deployed using pre-built image from Artifact Registry:\n   333→   ```\n   334→   gcloud run deploy socialhomes \\\n   335→     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336→     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337→     --min-instances=0 --max-instances=10 --port=8080 \\\n   338→     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339→   ```\n   340→\n   341→**Result:**\n   342→- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n   343→- Health check: `healthy`, Firestore connected (984ms latency)\n   344→- Firebase config endpoint: secrets injected correctly\n   345→- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346→\n   347→### Key Discoveries:\n   348→- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349→- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→\n   361→---\n   362→\n   363→## Session 8 — 2026-02-18 (Business Analyst Session)\n   364→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366→\n   367→### What happened:\n   368→\n   369→#### Task: Comprehensive Project Analysis & Specification Documents\n   370→\n   371→Performed full project analysis covering:\n   372→- All 73 frontend TypeScript files across 19 page directories\n   373→- All 43 backend TypeScript files (routes, services, middleware, models)\n   374→- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375→- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376→- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377→\n   378→#### Created 3 Specification Documents in `docs/requirements/`:\n   379→\n   380→1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   381→   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382→   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383→   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384→\n   385→2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   386→   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387→   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388→   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389→\n   390→3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   391→   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392→   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393→\n   394→#### Updated EXECUTION-PLAN.md (v2.0):\n   395→\n   396→- Preserved Phases 0–4 (all DONE) with progress counts\n   397→- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398→  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399→  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400→  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401→  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402→  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403→- Added deferred items cross-reference table\n   404→- Added Phase 5 metrics targets\n   405→- Updated plan summary table\n   406→\n   407→### Files Changed:\n   408→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411→- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n   412→- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n   413→\n   414→### Commits:\n   415→- (pending — awaiting user instruction to commit)\n   416→\n   417→### Decisions Taken:\n   418→- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n   419→- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420→- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421→- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n   422→- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423→\n   424→### Pending Work:\n   425→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n   426→- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427→\n   428→---\n   429→\n   430→## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n   431→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   432→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   433→\n   434→### What happened:\n   435→\n   436→#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n   437→\n   438→Performed full project re-analysis and updated all specification documents to v3.0.\n   439→This session built upon Session 8's initial docs with significantly enhanced content.\n   440→\n   441→#### Updated 3 Specification Documents in `docs/requirements/`:\n   442→\n   443→1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   444→   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   445→   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n   446→     (added Global Search), Persona System (with AI focus per persona), AI-Native\n   447→     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n   448→     7 differentiators, AI-augmented workflows, signature interactions),\n   449→     Data Model, UI Design (full colour palette, typography, component library),\n   450→     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   451→   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n   452→\n   453→2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   454→   - Enhanced with precise version numbers from package.json files\n   455→   - Added request flow diagram, middleware pipeline detail\n   456→   - Added accessibility implementation section\n   457→   - Added Firestore security rules and indexes references\n   458→   - Added infrastructure references (GCP project IDs, URLs)\n   459→   - Added Entire.io to infrastructure table\n   460→\n   461→3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   462→   - Cleaned up and made consistent with Doc2 endpoint registry\n   463→   - Added NOMIS Labour Market extended mock (4.9)\n   464→   - Enhanced future roadmap with Phase 6 enterprise integrations\n   465→   - Added GOV.UK Notify API endpoints section (6.4)\n   466→\n   467→#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n   468→\n   469→- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n   470→  - 5.1.8: Firestore data migration strategy\n   471→  - 5.2.11: AI communication drafting with Vertex AI\n   472→  - 5.2.12: Tenant activity scoring\n   473→  - 5.3.9: Real-time case status indicators\n   474→  - (Renumbered existing tasks for consistency)\n   475→- Added detailed task descriptions with specific implementation details\n   476→- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n   477→- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n   478→- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n   479→\n   480→### Files Changed:\n   481→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n   482→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n   483→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n   484→- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n   485→- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n   486→\n   487→### Commits:\n   488→- (pending — awaiting user instruction to commit)\n   489→\n   490→### Decisions Taken:\n   491→- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n   492→- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n   493→- Created sprint-by-sprint critical path execution order\n   494→- Added agent task summary with priority breakdown\n   495→- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n   496→- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n   497→\n   498→### Pending Work:\n   499→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n   500→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)"}]},"uuid":"4f5b066e-bd0a-4c54-9a91-6bf02222e390","timestamp":"2026-02-26T07:43:41.868Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)","numLines":500,"startLine":1,"totalLines":570}},"sourceToolAssistantUUID":"68ff8d3d-a8e8-4812-bd41-58602196554d"}
{"parentUuid":"4f5b066e-bd0a-4c54-9a91-6bf02222e390","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01BpokFr2LY32wTMsfSoD17T","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CHt3XGSPmKxA92kaxWXFqE","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":19329,"cache_read_input_tokens":23278,"output_tokens":309,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":19329,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWJhv7d6CNG2jZsh5VxM","type":"assistant","uuid":"558a30ca-050b-4dbc-b139-74cf45c91815","timestamp":"2026-02-26T07:43:42.235Z"}
{"parentUuid":"558a30ca-050b-4dbc-b139-74cf45c91815","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CHt3XGSPmKxA92kaxWXFqE","type":"tool_result","content":"     1→# SocialHomes.Ai — Dev Fix List\n     2→## Updated: 2026-02-21\n     3→\n     4→**Test Summary:** 331 tests | 330 PASS | 0 FAIL | 1 WARN | 99.7% pass rate\n     5→\n     6→---\n     7→\n     8→## CRITICAL BUGS — ALL RESOLVED\n     9→\n    10→### ~~BUG-001: Complaint Detail Page Crashes (React Error)~~ FIXED\n    11→- **Status:** RESOLVED — CM-10 passes, detail page loads correctly\n    12→- **Verified:** Screenshot shows full complaint detail with timeline, AI actions, action buttons\n    13→\n    14→### ~~BUG-002: Tenant Detail Crashes from Rent Worklist~~ FIXED\n    15→- **Status:** RESOLVED — All tenant detail tests pass including from rent navigation\n    16→\n    17→### ~~BUG-003: ASB Case Detail Not Navigating~~ FIXED\n    18→- **Status:** RESOLVED — ASB-10 passes, navigates to `/asb/asb-001`\n    19→\n    20→### ~~BUG-004: Dashboard Missing \"Void\" KPI~~ FIXED\n    21→- **Status:** RESOLVED — DASH-KPI-Void passes, 'Void' found in dashboard text\n    22→\n    23→---\n    24→\n    25→## WARNINGS — ALL RESOLVED\n    26→\n    27→### ~~WARN-001: Explore Map - Marker Popups Not Working~~ FIXED\n    28→- **Status:** RESOLVED — Popups now show on hover (mouseover/mouseout), click still drills down\n    29→- **Fix:** Changed popup trigger from click to mouseover; added dark-mode popup CSS overrides\n    30→- **Files:** `ExplorePage.tsx` (marker events), `index.css` (popup styles)\n    31→- **Note:** EX-05 test still uses click (WARN) — popup works correctly via hover in production\n    32→\n    33→### ~~WARN-002: Tenancies Search Not Filtering~~ FIXED\n    34→- **Status:** RESOLVED — Search now matches name, address, tenant ID, AND assigned officer\n    35→- **Fix:** Added `assignedOfficer` field to search filter; \"Mitchell\" now correctly filters results\n    36→- **Files:** `TenanciesPage.tsx` (search filter logic + placeholder text)\n    37→\n    38→### ~~WARN-003: API Cases Endpoint - Large Response~~ FIXED\n    39→- **Status:** RESOLVED — Added proper pagination with offset, page, pageSize, totalPages\n    40→- **Fix:** Default limit reduced from 200 to 50; added `offset` query parameter; response includes pagination metadata\n    41→- **Files:** `server/src/routes/cases.ts`\n    42→\n    43→---\n    44→\n    45→## UI IMPROVEMENTS\n    46→\n    47→### Help/Guide Drawer — Full-Screen Layout\n    48→- **Status:** COMPLETE — Guides now open full-screen for easier reading\n    49→- **Fix:** Changed drawer from half-width (`md:w-1/2`) to `fixed inset-0`; added `max-w-4xl mx-auto` content wrapper; TOC and Related Guides moved into scroll area; all topics collapsed by default\n    50→- **Files:** `HelpDrawer.tsx`\n    51→\n    52→---\n    53→\n    54→## WHAT'S WORKING WELL (330/331 tests passing)\n    55→\n    56→- Login/Authentication: Flawless (Firebase email + Google sign-in)\n    57→- All 14 sidebar navigation links: Present and clickable (29/29 tests)\n    58→- Header: Logo, persona, search, notifications all present (4/4)\n    59→- Dashboard: All KPIs (Properties, Tenancies, Repairs, Compliance, Arrears, Void), charts, activity, compliance overview (12/12)\n    60→- Briefing: Personalized greeting, AI alerts, action buttons, all sections (8/8)\n    61→- Tenancies: 68 rows, all headers, row click → detail works, all tabs, AI features (16/16)\n    62→- Properties: 75 rows, map, detail page with EPC/rent/type/beds/AI, tabs (14/14)\n    63→- Repairs: 200 rows, all stats, detail with full workflow, action buttons, filters (113/113)\n    64→- Complaints: 34 complaints, detail page with timeline, AI actions, deadlines, ombudsman (12/12)\n    65→- ASB: 12 cases, detail page with workflow elements (6/6)\n    66→- Rent & Income: Financial data, charts, worklist, UC tracking, tenant link navigation, sub-routes (11/11)\n    67→- Compliance: All Big 6 types, percentages, detail pages, Awaab's Law (15/15)\n    68→- Communications: 5 messages, AI analysis, actions (Reply/Forward/Archive), templates (13/13)\n    69→- Reports: All 27 reports load with data, TSM report works (30/30)\n    70→- AI Centre: Insights, Predictions, Assistant — all sub-routes work (7/7)\n    71→- Admin: All 7 sub-pages load with content (8/8)\n    72→- Tenant Portal: Self-service landing with action buttons, form inputs (4/4)\n    73→- Yantra Assist: AI chat trigger visible, panel opens with input (2/2)\n    74→- Mobile responsive: Dashboard renders on mobile viewport\n    75→- Breadcrumbs: Present and functional\n    76→- **Firestore Database:** All data served from live Firestore (15 collections, 460+ documents)\n    77→- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n    78→\n    79→---\n    80→\n    81→## USER-REPORTED ISSUES — ALL RESOLVED\n    82→\n    83→### ~~BUG-005: Property Detail Page Crashes (React Error #310)~~ FIXED\n    84→- **Status:** RESOLVED — `/properties/100023456001` renders fully with map, details, EPC, all tabs\n    85→- **Root Cause:** React Rules of Hooks violation — `usePropertyIntelligence()` hook was called AFTER a conditional `if (!property) return` early exit, causing React to see different hook counts on re-renders\n    86→- **Fix:** Moved `usePropertyIntelligence(property)` call before the early return guard\n    87→- **Files:** `app/src/pages/properties/PropertyDetailPage.tsx`\n    88→\n    89→### ~~BUG-006: Repair Detail Page Crashes (React Error #310)~~ FIXED\n    90→- **Status:** RESOLVED — `/repairs/rep-001` renders fully with AI estimates, timeline, case details, activity feed\n    91→- **Root Cause:** Same Rules of Hooks violation — `useRepairIntelligence()` and `useState()` called after conditional early return\n    92→- **Fix:** Moved `useRepairIntelligence(repair)` and `useState` calls before the `if (!repair) return` guard\n    93→- **Files:** `app/src/pages/repairs/RepairDetailPage.tsx`\n    94→\n    95→---\n    96→\n    97→## ALL AUTOMATED TESTS PASSING — 99.7%\n    98→"}]},"uuid":"b02f3d33-0b51-49e2-b9af-6666e93a2acf","timestamp":"2026-02-26T07:43:42.261Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md","content":"# SocialHomes.Ai — Dev Fix List\n## Updated: 2026-02-21\n\n**Test Summary:** 331 tests | 330 PASS | 0 FAIL | 1 WARN | 99.7% pass rate\n\n---\n\n## CRITICAL BUGS — ALL RESOLVED\n\n### ~~BUG-001: Complaint Detail Page Crashes (React Error)~~ FIXED\n- **Status:** RESOLVED — CM-10 passes, detail page loads correctly\n- **Verified:** Screenshot shows full complaint detail with timeline, AI actions, action buttons\n\n### ~~BUG-002: Tenant Detail Crashes from Rent Worklist~~ FIXED\n- **Status:** RESOLVED — All tenant detail tests pass including from rent navigation\n\n### ~~BUG-003: ASB Case Detail Not Navigating~~ FIXED\n- **Status:** RESOLVED — ASB-10 passes, navigates to `/asb/asb-001`\n\n### ~~BUG-004: Dashboard Missing \"Void\" KPI~~ FIXED\n- **Status:** RESOLVED — DASH-KPI-Void passes, 'Void' found in dashboard text\n\n---\n\n## WARNINGS — ALL RESOLVED\n\n### ~~WARN-001: Explore Map - Marker Popups Not Working~~ FIXED\n- **Status:** RESOLVED — Popups now show on hover (mouseover/mouseout), click still drills down\n- **Fix:** Changed popup trigger from click to mouseover; added dark-mode popup CSS overrides\n- **Files:** `ExplorePage.tsx` (marker events), `index.css` (popup styles)\n- **Note:** EX-05 test still uses click (WARN) — popup works correctly via hover in production\n\n### ~~WARN-002: Tenancies Search Not Filtering~~ FIXED\n- **Status:** RESOLVED — Search now matches name, address, tenant ID, AND assigned officer\n- **Fix:** Added `assignedOfficer` field to search filter; \"Mitchell\" now correctly filters results\n- **Files:** `TenanciesPage.tsx` (search filter logic + placeholder text)\n\n### ~~WARN-003: API Cases Endpoint - Large Response~~ FIXED\n- **Status:** RESOLVED — Added proper pagination with offset, page, pageSize, totalPages\n- **Fix:** Default limit reduced from 200 to 50; added `offset` query parameter; response includes pagination metadata\n- **Files:** `server/src/routes/cases.ts`\n\n---\n\n## UI IMPROVEMENTS\n\n### Help/Guide Drawer — Full-Screen Layout\n- **Status:** COMPLETE — Guides now open full-screen for easier reading\n- **Fix:** Changed drawer from half-width (`md:w-1/2`) to `fixed inset-0`; added `max-w-4xl mx-auto` content wrapper; TOC and Related Guides moved into scroll area; all topics collapsed by default\n- **Files:** `HelpDrawer.tsx`\n\n---\n\n## WHAT'S WORKING WELL (330/331 tests passing)\n\n- Login/Authentication: Flawless (Firebase email + Google sign-in)\n- All 14 sidebar navigation links: Present and clickable (29/29 tests)\n- Header: Logo, persona, search, notifications all present (4/4)\n- Dashboard: All KPIs (Properties, Tenancies, Repairs, Compliance, Arrears, Void), charts, activity, compliance overview (12/12)\n- Briefing: Personalized greeting, AI alerts, action buttons, all sections (8/8)\n- Tenancies: 68 rows, all headers, row click → detail works, all tabs, AI features (16/16)\n- Properties: 75 rows, map, detail page with EPC/rent/type/beds/AI, tabs (14/14)\n- Repairs: 200 rows, all stats, detail with full workflow, action buttons, filters (113/113)\n- Complaints: 34 complaints, detail page with timeline, AI actions, deadlines, ombudsman (12/12)\n- ASB: 12 cases, detail page with workflow elements (6/6)\n- Rent & Income: Financial data, charts, worklist, UC tracking, tenant link navigation, sub-routes (11/11)\n- Compliance: All Big 6 types, percentages, detail pages, Awaab's Law (15/15)\n- Communications: 5 messages, AI analysis, actions (Reply/Forward/Archive), templates (13/13)\n- Reports: All 27 reports load with data, TSM report works (30/30)\n- AI Centre: Insights, Predictions, Assistant — all sub-routes work (7/7)\n- Admin: All 7 sub-pages load with content (8/8)\n- Tenant Portal: Self-service landing with action buttons, form inputs (4/4)\n- Yantra Assist: AI chat trigger visible, panel opens with input (2/2)\n- Mobile responsive: Dashboard renders on mobile viewport\n- Breadcrumbs: Present and functional\n- **Firestore Database:** All data served from live Firestore (15 collections, 460+ documents)\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n## USER-REPORTED ISSUES — ALL RESOLVED\n\n### ~~BUG-005: Property Detail Page Crashes (React Error #310)~~ FIXED\n- **Status:** RESOLVED — `/properties/100023456001` renders fully with map, details, EPC, all tabs\n- **Root Cause:** React Rules of Hooks violation — `usePropertyIntelligence()` hook was called AFTER a conditional `if (!property) return` early exit, causing React to see different hook counts on re-renders\n- **Fix:** Moved `usePropertyIntelligence(property)` call before the early return guard\n- **Files:** `app/src/pages/properties/PropertyDetailPage.tsx`\n\n### ~~BUG-006: Repair Detail Page Crashes (React Error #310)~~ FIXED\n- **Status:** RESOLVED — `/repairs/rep-001` renders fully with AI estimates, timeline, case details, activity feed\n- **Root Cause:** Same Rules of Hooks violation — `useRepairIntelligence()` and `useState()` called after conditional early return\n- **Fix:** Moved `useRepairIntelligence(repair)` and `useState` calls before the `if (!repair) return` guard\n- **Files:** `app/src/pages/repairs/RepairDetailPage.tsx`\n\n---\n\n## ALL AUTOMATED TESTS PASSING — 99.7%\n","numLines":98,"startLine":1,"totalLines":98}},"sourceToolAssistantUUID":"558a30ca-050b-4dbc-b139-74cf45c91815"}
{"parentUuid":"b02f3d33-0b51-49e2-b9af-6666e93a2acf","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01JGRKix2exwSgFRa6VJBf6d","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the remaining parts of Doc3 and explore the actual codebase structure:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30425,"cache_read_input_tokens":42607,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30425},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJiL5me97Vg5NVVG4KA","type":"assistant","uuid":"445b60b2-b81b-4c1a-add1-80ec76dbc620","timestamp":"2026-02-26T07:43:45.797Z"}
{"parentUuid":"445b60b2-b81b-4c1a-add1-80ec76dbc620","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01JGRKix2exwSgFRa6VJBf6d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UmW5XjuW1UHQoRgq8Q7RCY","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt","offset":500,"limit":500},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30425,"cache_read_input_tokens":42607,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30425},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJiL5me97Vg5NVVG4KA","type":"assistant","uuid":"b3349aca-1329-4808-aacf-d60e6fbfd8b0","timestamp":"2026-02-26T07:43:46.863Z"}
{"parentUuid":"b3349aca-1329-4808-aacf-d60e6fbfd8b0","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UmW5XjuW1UHQoRgq8Q7RCY","type":"tool_result","content":"   500→  - /properties/:uprn (PropertyDetailPage.tsx) — flood risk badge\n   501→  - /explore (ExplorePage.tsx) — flood zone overlay on maps\n   502→  - /briefing (BriefingPage.tsx) — active flood warnings\n   503→  - /dashboard (DashboardPage.tsx) — flood warning KPI\n   504→  - /reports (ReportsPage.tsx) — flood risk analysis\n   505→\n   506→Priority: P2\n   507→Complexity: Low\n   508→Dependencies: postcodes.io (for lat/lng)\n   509→\n   510→User Stories:\n   511→  US-FLOOD-01: As a property manager, I want to see active flood warnings for\n   512→    properties in my patch, so I can contact vulnerable tenants proactively and\n   513→    prepare for potential emergency repairs.\n   514→    Acceptance: Properties within active flood warning areas show a red \"Flood\n   515→    Warning\" banner on their detail page. Briefing page lists all affected properties.\n   516→\n   517→  US-FLOOD-02: As a stock investment planner, I want to see which properties are\n   518→    in flood risk zones, so I can factor flood resilience into planned works programmes.\n   519→    Acceptance: Property detail page shows flood risk zone classification. Reports\n   520→    page allows filtering properties by flood risk level.\n   521→\n   522→========================================================================\n   523→### 3.6 IMD — Index of Multiple Deprivation (ONS Open Data)\n   524→========================================================================\n   525→\n   526→Base URL:         https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/\n   527→                  (ArcGIS REST API for ONS geographies)\n   528→Alt URL:          https://assets.publishing.service.gov.uk/media/\n   529→                  (Static CSV downloads for IMD 2019)\n   530→Auth:             None\n   531→Rate Limit:       Fair use\n   532→Documentation:    https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019\n   533→\n   534→Key Endpoints:\n   535→  GET IMD_2019/FeatureServer/0/query?where=lsoa11cd='{lsoaCode}'\n   536→      &outFields=*&f=json\n   537→\n   538→  Alternatively, pre-load the IMD CSV (32,844 LSOAs) into Firestore on deployment.\n   539→\n   540→Response Fields:\n   541→  lsoa11cd                          — LSOA code\n   542→  IMDScore                          — Overall IMD score (0-100)\n   543→  IMDRank                           — Rank (1 = most deprived, 32844 = least)\n   544→  IMDDecile                         — Decile (1 = most deprived 10%)\n   545→  IncScore, IncRank                 — Income domain\n   546→  EmpScore, EmpRank                 — Employment domain\n   547→  EduScore, EduRank                 — Education domain\n   548→  HeaScore, HeaRank                 — Health and disability domain\n   549→  CriScore, CriRank                 — Crime domain\n   550→  HouScore, HouRank                 — Housing and services barriers\n   551→  LivScore, LivRank                 — Living environment domain\n   552→\n   553→Data Mapping to SocialHomes.Ai:\n   554→  IMD field        --> Internal model / usage\n   555→  ---------------------------------------------------------------\n   556→  IMDDecile        --> Property.imdDecile (new field)\n   557→  IMDScore         --> Property.imdScore (new field)\n   558→  IMDRank          --> Property.imdRank (new field)\n   559→  IncScore         --> DeprivationProfile.incomeScore (new type)\n   560→  EmpScore         --> DeprivationProfile.employmentScore\n   561→  HeaScore         --> DeprivationProfile.healthScore\n   562→  CriScore         --> DeprivationProfile.crimeScore\n   563→  HouScore         --> DeprivationProfile.housingScore\n   564→  LivScore         --> DeprivationProfile.livingEnvironmentScore\n   565→\n   566→  Feeds into:\n   567→    - Automatic Vulnerability Detection (Differentiator 3)\n   568→    - Benefits Entitlement Engine (Differentiator 4)\n   569→    - AI Neighbourhood Briefing (Differentiator 6)\n   570→    - Tenant vulnerability scoring\n   571→    - Allocations prioritisation\n   572→\n   573→New Server Route (replace existing simulated /api/v1/public-data/imd):\n   574→  GET /api/v1/public-data/imd/:lsoaCode\n   575→  GET /api/v1/public-data/imd/summary/:estateId (aggregate for all LSOAs in estate)\n   576→\n   577→  Recommended: Pre-load IMD dataset into Firestore collection \"imdData\" at deployment.\n   578→  Cache TTL: 90 days (IMD data is updated infrequently — roughly every 4-5 years).\n   579→\n   580→Affected Pages:\n   581→  - /properties/:uprn (PropertyDetailPage.tsx) — deprivation context card\n   582→  - /tenancies/:id (TenancyDetailPage.tsx) — vulnerability context\n   583→  - /explore/.../estate/:id — deprivation heatmap\n   584→  - /reports (ReportsPage.tsx) — deprivation analysis\n   585→  - /allocations (AllocationsPage.tsx) — needs-based allocation\n   586→  - /briefing (BriefingPage.tsx) — deprivation context\n   587→  - /dashboard (DashboardPage.tsx) — vulnerability KPI\n   588→\n   589→Priority: P1\n   590→Complexity: Medium (recommend pre-loading CSV to Firestore)\n   591→Dependencies: postcodes.io (for LSOA code derivation)\n   592→\n   593→User Stories:\n   594→  US-IMD-01: As a housing officer, I want to see the deprivation profile (overall\n   595→    decile and domain scores) for the area around a tenant's property, so I can\n   596→    understand the socioeconomic context when assessing vulnerability and support needs.\n   597→    Acceptance: Tenant and property detail pages show a compact \"Area Deprivation\"\n   598→    card with IMD decile (colour-coded 1=red to 10=green), income, employment, health,\n   599→    and crime domain scores.\n   600→\n   601→  US-IMD-02: As a head of service, I want to overlay IMD deprivation data on estate\n   602→    maps, so I can identify which estates are in the most deprived areas and allocate\n   603→    services accordingly.\n   604→    Acceptance: Explore estate view shows deprivation heatmap. Estates in deciles\n   605→    1-3 are highlighted. Dashboard shows \"X% of stock in decile 1-3 areas\".\n   606→\n   607→  US-IMD-03: As the AI system, I want to use IMD data as an input to the automatic\n   608→    vulnerability detection model, so I can flag tenants in highly deprived areas who\n   609→    may need proactive support even before they ask for it.\n   610→    Acceptance: Vulnerability scoring model incorporates IMD decile. Tenants in\n   611→    decile 1-2 areas receive an automatic +15 to their vulnerability score.\n   612→\n   613→========================================================================\n   614→### 3.7 Census 2021 API (ONS) — Demographics & Housing Tenure\n   615→========================================================================\n   616→\n   617→Base URL:         https://api.beta.ons.gov.uk/v1/\n   618→Alt URL:          https://www.nomisweb.co.uk/api/v01/ (NOMIS access to Census tables)\n   619→Auth:             None\n   620→Rate Limit:       Fair use\n   621→Documentation:    https://developer.ons.gov.uk/\n   622→\n   623→Key Endpoints:\n   624→  GET /datasets/TS054/editions/2021/versions/1/observations?geography={lsoaCode}\n   625→      (Tenure by household — owner/social/private rent)\n   626→  GET /datasets/TS011/editions/2021/versions/1/observations?geography={lsoaCode}\n   627→      (Household size)\n   628→  GET /datasets/TS009/editions/2021/versions/1/observations?geography={lsoaCode}\n   629→      (Age structure)\n   630→  GET /datasets/TS021/editions/2021/versions/1/observations?geography={lsoaCode}\n   631→      (Ethnic group)\n   632→  GET /datasets/TS038/editions/2021/versions/1/observations?geography={lsoaCode}\n   633→      (Disability)\n   634→\n   635→Data Mapping to SocialHomes.Ai:\n   636→  Census field                --> Internal model / usage\n   637→  ---------------------------------------------------------------\n   638→  TS054 (Tenure)              --> AreaDemographics.socialRentPct (new type)\n   639→  TS054 (Tenure)              --> AreaDemographics.privateRentPct\n   640→  TS054 (Tenure)              --> AreaDemographics.ownerOccupiedPct\n   641→  TS011 (Household size)      --> AreaDemographics.averageHouseholdSize\n   642→  TS009 (Age structure)       --> AreaDemographics.over65Pct\n   643→  TS009 (Age structure)       --> AreaDemographics.under18Pct\n   644→  TS038 (Disability)          --> AreaDemographics.limitedActivitiesPct\n   645→\n   646→  Feeds into:\n   647→    - Allocations planning (understanding local housing demand)\n   648→    - Vulnerability detection (high elderly %, high disability %)\n   649→    - AI Neighbourhood Briefing (Differentiator 6)\n   650→    - Reports — community profiling\n   651→\n   652→New Server Route:\n   653→  GET /api/v1/public-data/census/:lsoaCode?tables=TS054,TS011,TS009\n   654→  GET /api/v1/public-data/census/summary/:estateId\n   655→\n   656→  Recommended: Pre-load key Census tables for relevant LSOAs into Firestore.\n   657→  Cache TTL: 90 days (Census data does not change between Census years).\n   658→\n   659→Affected Pages:\n   660→  - /explore/.../estate/:id — community demographics panel\n   661→  - /allocations (AllocationsPage.tsx) — demand analysis\n   662→  - /reports (ReportsPage.tsx) — community profiling\n   663→  - /briefing (BriefingPage.tsx) — demographic context\n   664→\n   665→Priority: P2\n   666→Complexity: Medium\n   667→Dependencies: postcodes.io (for LSOA codes)\n   668→\n   669→User Stories:\n   670→  US-CENSUS-01: As an allocations manager, I want to see Census demographics for\n   671→    areas where we have stock, so I can understand local housing demand patterns\n   672→    and plan lettings accordingly.\n   673→    Acceptance: Allocations page shows an \"Area Profile\" panel with tenure mix,\n   674→    household size distribution, age profile, and disability prevalence for the\n   675→    selected estate's LSOA.\n   676→\n   677→  US-CENSUS-02: As the AI system, I want Census data about elderly and disabled\n   678→    populations in each LSOA, so I can flag estates where adapted property demand\n   679→    is likely to be high.\n   680→    Acceptance: Estates in LSOAs with >25% over-65 or >20% activity-limited\n   681→    population generate an AI insight: \"High demand for adapted/sheltered housing\n   682→    in this area.\"\n   683→\n   684→========================================================================\n   685→### 3.8 NOMIS API — Labour Market Statistics\n   686→========================================================================\n   687→\n   688→Base URL:         https://www.nomisweb.co.uk/api/v01/\n   689→Auth:             None (API key optional for higher limits)\n   690→Rate Limit:       Fair use\n   691→Documentation:    https://www.nomisweb.co.uk/api/v01/help\n   692→\n   693→Key Endpoints:\n   694→  GET /dataset/NM_17_5.data.json?geography={laCode}\n   695→      &variable=45&measures=20100  (Claimant count by LA)\n   696→  GET /dataset/NM_1_1.data.json?geography={laCode}\n   697→      &variable=18&measures=20100  (Employment rate by LA)\n   698→  GET /dataset/NM_30_1.data.json?geography={laCode}\n   699→      &measures=20100  (Job density)\n   700→\n   701→Data Mapping to SocialHomes.Ai:\n   702→  NOMIS field            --> Internal model / usage\n   703→  ---------------------------------------------------------------\n   704→  Claimant count         --> LabourMarket.claimantCount (new type)\n   705→  Employment rate        --> LabourMarket.employmentRate\n   706→  Job density            --> LabourMarket.jobDensity\n   707→  Out-of-work benefits   --> LabourMarket.oowBenefitsRate\n   708→\n   709→  Feeds into:\n   710→    - Benefits Entitlement Engine (Differentiator 4)\n   711→    - Vulnerability detection\n   712→    - Arrears prediction (unemployment correlation)\n   713→    - AI Neighbourhood Briefing (Differentiator 6)\n   714→\n   715→New Server Route:\n   716→  GET /api/v1/public-data/labour/:laCode\n   717→\n   718→  Cache TTL: 7 days (monthly releases).\n   719→\n   720→Affected Pages:\n   721→  - /rent (RentPage.tsx) — economic context for arrears\n   722→  - /tenancies/:id (TenancyDetailPage.tsx) — employment context\n   723→  - /reports (ReportsPage.tsx) — economic analysis\n   724→  - /briefing (BriefingPage.tsx) — economic summary\n   725→\n   726→Priority: P2\n   727→Complexity: Low\n   728→Dependencies: None (uses LA code from existing LocalAuthority model)\n   729→\n   730→User Stories:\n   731→  US-NOMIS-01: As a rent recovery officer, I want to see the local unemployment rate\n   732→    and claimant count for the area where a tenant lives, so I can assess whether\n   733→    arrears are likely related to local economic conditions and adjust my approach\n   734→    accordingly.\n   735→    Acceptance: Tenant detail and rent account pages show a compact \"Local Economy\"\n   736→    card with employment rate, claimant count, and trend vs national average.\n   737→\n   738→  US-NOMIS-02: As the AI system, I want labour market data to improve arrears risk\n   739→    prediction, so tenants in areas with rising unemployment are flagged for proactive\n   740→    support before they fall into arrears.\n   741→    Acceptance: Arrears risk model incorporates local claimant count trend. A rising\n   742→    claimant count in the tenant's LA adds +10 to arrearsRisk score.\n   743→\n   744→---\n   745→\n   746→## 4. TIER 2: FREE APIs — REGISTRATION REQUIRED\n   747→\n   748→========================================================================\n   749→### 4.1 Met Office DataHub — Weather Warnings & Detailed Forecasts\n   750→========================================================================\n   751→\n   752→Base URL:         https://data.hub.api.metoffice.gov.uk/sitespecific/v0/\n   753→Auth:             API key (free registration at MetOffice DataHub)\n   754→Rate Limit:       360 requests/hour (free tier)\n   755→Env Variable:     MET_OFFICE_API_KEY\n   756→Documentation:    https://datahub.metoffice.gov.uk/\n   757→\n   758→Key Endpoints:\n   759→  GET /point/hourly?latitude={lat}&longitude={lng}\n   760→  GET /point/daily?latitude={lat}&longitude={lng}\n   761→  GET /point/three-hourly?latitude={lat}&longitude={lng}\n   762→\n   763→  Weather Warnings:\n   764→  https://data.hub.api.metoffice.gov.uk/atmospheric/v0/\n   765→  GET /warnings (national weather warnings)\n   766→\n   767→Data Mapping to SocialHomes.Ai:\n   768→  Met Office field         --> Internal model / usage\n   769→  ---------------------------------------------------------------\n   770→  screenTemperature        --> WeatherDetail.temperature\n   771→  screenRelativeHumidity   --> WeatherDetail.humidity\n   772→  totalPrecipAmount        --> WeatherDetail.precipitation\n   773→  windSpeed10m             --> WeatherDetail.windSpeed\n   774→  windGustSpeed            --> WeatherDetail.windGust\n   775→  significantWeatherCode   --> WeatherDetail.weatherCode\n   776→  Warning severity/type    --> WeatherWarning.severity (new type)\n   777→\n   778→  Feeds into:\n   779→    - Predictive Damp Intelligence (Differentiator 1) — more granular than Open-Meteo\n   780→    - AI Neighbourhood Briefing (Differentiator 6)\n   781→    - Storm damage prediction for repairs\n   782→    - Frost alerts for burst pipe prevention\n   783→\n   784→New Server Route:\n   785→  GET /api/v1/public-data/metoffice/forecast/:lat/:lng\n   786→  GET /api/v1/public-data/metoffice/warnings\n   787→\n   788→  Cache TTL: 1 hour (forecast), 30 minutes (warnings).\n   789→\n   790→Affected Pages:\n   791→  - /compliance/awaabs-law (AwaabsLawPage.tsx) — enhanced damp prediction\n   792→  - /properties/:uprn (PropertyDetailPage.tsx) — detailed weather\n   793→  - /briefing (BriefingPage.tsx) — Met Office warnings\n   794→  - /dashboard (DashboardPage.tsx) — weather warning alerts\n   795→  - /repairs (RepairsPage.tsx) — storm damage preparedness\n   796→\n   797→Priority: P2\n   798→Complexity: Medium\n   799→Dependencies: None (uses lat/lng from property records)\n   800→\n   801→User Stories:\n   802→  US-MET-01: As a repairs manager, I want Met Office weather warnings displayed on\n   803→    the briefing and dashboard pages, so I can prepare for increased repair demand\n   804→    from storms, frost, or heavy rainfall.\n   805→    Acceptance: Active Met Office warnings (amber/red) for areas containing our stock\n   806→    appear as prominent alert cards on briefing and dashboard. Yellow warnings shown\n   807→    in a secondary section.\n   808→\n   809→  US-MET-02: As the predictive damp model, I want hourly temperature, humidity, and\n   810→    dew point data from Met Office (higher resolution than Open-Meteo), so I can\n   811→    calculate condensation risk more accurately.\n   812→    Acceptance: When MET_OFFICE_API_KEY is configured, the damp risk calculation\n   813→    uses Met Office hourly data instead of Open-Meteo. Fallback to Open-Meteo if\n   814→    Met Office is unavailable.\n   815→\n   816→========================================================================\n   817→### 4.2 EPC Register API — Energy Performance Certificates\n   818→========================================================================\n   819→\n   820→Base URL:         https://epc.opendatacommunities.org/api/v1/\n   821→Auth:             Basic auth with registered API key\n   822→Registration:     https://epc.opendatacommunities.org/login\n   823→Env Variable:     EPC_API_KEY\n   824→Rate Limit:       No published limit (fair use)\n   825→Documentation:    https://epc.opendatacommunities.org/docs/api\n   826→\n   827→Key Endpoints:\n   828→  GET /domestic/search?postcode={postcode}&size=100\n   829→  GET /domestic/search?uprn={uprn}\n   830→  GET /domestic/certificate/{lmk-key}\n   831→  GET /domestic/recommendations/{lmk-key}\n   832→\n   833→Response Shape:\n   834→  {\n   835→    \"rows\": [\n   836→      {\n   837→        \"lmk-key\": \"abc123\",\n   838→        \"address\": \"1 Example Road\",\n   839→        \"postcode\": \"SE15 4QN\",\n   840→        \"uprn\": \"10091553414\",\n   841→        \"current-energy-rating\": \"D\",\n   842→        \"potential-energy-rating\": \"B\",\n   843→        \"current-energy-efficiency\": \"58\",\n   844→        \"potential-energy-efficiency\": \"82\",\n   845→        \"property-type\": \"Flat\",\n   846→        \"built-form\": \"Mid-Terrace\",\n   847→        \"floor-area\": \"62\",\n   848→        \"heating-cost-current\": \"1120\",\n   849→        \"hot-water-cost-current\": \"280\",\n   850→        \"lighting-cost-current\": \"110\",\n   851→        \"co2-emissions-current\": \"3.8\",\n   852→        \"walls-description\": \"Solid brick, no insulation\",\n   853→        \"roof-description\": \"Flat roof, limited insulation\",\n   854→        \"windows-description\": \"Single glazed\",\n   855→        \"main-heating-description\": \"Gas central heating\",\n   856→        \"lodgement-date\": \"2023-11-15\",\n   857→        \"transaction-type\": \"rental (social)\"\n   858→      }\n   859→    ]\n   860→  }\n   861→\n   862→Data Mapping to SocialHomes.Ai:\n   863→  EPC API field                 --> Internal model / usage\n   864→  ---------------------------------------------------------------\n   865→  current-energy-rating         --> Property.epc.rating\n   866→  current-energy-efficiency     --> Property.epc.sapScore\n   867→  potential-energy-rating       --> Property.epc.potentialRating (new)\n   868→  potential-energy-efficiency   --> Property.epc.potentialScore (new)\n   869→  lodgement-date                --> Property.epc.expiryDate (+ 10 years)\n   870→  floor-area                    --> Property.floorArea (validation)\n   871→  walls-description             --> Property.epc.wallsDesc (new)\n   872→  roof-description              --> Property.epc.roofDesc (new)\n   873→  windows-description           --> Property.epc.windowsDesc (new)\n   874→  main-heating-description      --> Property.epc.heatingDesc (new)\n   875→  co2-emissions-current         --> Property.epc.co2Current (new)\n   876→  heating-cost-current          --> Property.epc.heatingCostAnnual (new)\n   877→  recommendations (sub-endpoint)--> Property.epc.recommendations[] (new)\n   878→\n   879→  NOTE: Existing Property.epc has { rating, sapScore, expiryDate }.\n   880→  This integration enriches it significantly.\n   881→\n   882→  Feeds into:\n   883→    - Predictive Damp Intelligence (Differentiator 1) — wall/roof/window insulation\n   884→    - Property Passport (Differentiator 5) — authoritative EPC data\n   885→    - Stock condition / retrofit planning\n   886→    - Carbon emissions reporting\n   887→    - TSM measure BS06 (energy efficiency compliance)\n   888→\n   889→New Server Route (extend existing /api/v1/public-data/epc):\n   890→  GET /api/v1/public-data/epc/:postcode (EXISTING — enhance response)\n   891→  GET /api/v1/public-data/epc/uprn/:uprn (NEW — lookup by UPRN)\n   892→  GET /api/v1/public-data/epc/certificate/:lmkKey (NEW — full cert)\n   893→  GET /api/v1/public-data/epc/recommendations/:lmkKey (NEW — improvement recs)\n   894→\n   895→  Cache TTL: 30 days (EPCs change only on re-lodgement).\n   896→\n   897→Affected Pages:\n   898→  - /properties/:uprn (PropertyDetailPage.tsx) — full EPC data panel\n   899→  - /compliance (CompliancePage.tsx) — EPC compliance summary\n   900→  - /compliance/awaabs-law (AwaabsLawPage.tsx) — building fabric data for damp\n   901→  - /reports/stock-condition — retrofit planning\n   902→  - /reports (ReportsPage.tsx) — carbon emissions, energy cost analysis\n   903→\n   904→Priority: P1\n   905→Complexity: Medium (existing route, significant enhancement)\n   906→Dependencies: Open UPRN (for UPRN-based lookup)\n   907→\n   908→User Stories:\n   909→  US-EPC-01: As a property manager, I want to see the full EPC certificate data\n   910→    for each property (not just the rating), including wall, roof, window, and\n   911→    heating descriptions, so I can understand the building fabric and identify\n   912→    properties at risk of damp due to poor insulation.\n   913→    Acceptance: Property detail page shows an expanded \"Energy Performance\" panel\n   914→    with current/potential ratings, fabric descriptions, heating costs, CO2 emissions,\n   915→    and improvement recommendations with estimated savings.\n   916→\n   917→  US-EPC-02: As a stock investment planner, I want to see aggregated EPC data across\n   918→    all properties, so I can prioritise retrofit programmes by cost-benefit analysis.\n   919→    Acceptance: Reports page shows EPC distribution chart (A-G), estimated total\n   920→    retrofit cost to reach EPC C for all properties below C, and a prioritised list\n   921→    by potential savings per pound invested.\n   922→\n   923→  US-EPC-03: As the predictive damp model, I want building fabric data from EPC\n   924→    certificates (wall type, insulation, window glazing), so I can identify\n   925→    properties where poor thermal performance increases condensation risk.\n   926→    Acceptance: Damp risk model incorporates EPC building fabric data. Properties\n   927→    with solid walls + no insulation + single glazing receive +20 damp risk score.\n   928→\n   929→========================================================================\n   930→### 4.3 GOV.UK Notify — Government Communications Platform\n   931→========================================================================\n   932→\n   933→Base URL:         https://api.notifications.service.gov.uk/\n   934→Auth:             API key (free registration for public sector)\n   935→Registration:     https://www.notifications.service.gov.uk/\n   936→Env Variable:     GOVUK_NOTIFY_API_KEY\n   937→Rate Limit:       3,000 messages/minute\n   938→Documentation:    https://docs.notifications.service.gov.uk/\n   939→\n   940→Key Endpoints:\n   941→  POST /v2/notifications/email\n   942→    Body: { email_address, template_id, personalisation: { name, ref, ... } }\n   943→  POST /v2/notifications/sms\n   944→    Body: { phone_number, template_id, personalisation: { ... } }\n   945→  POST /v2/notifications/letter\n   946→    Body: { template_id, personalisation: { address_line_1, ..., postcode, ... } }\n   947→  GET  /v2/notifications/{id} — check delivery status\n   948→  GET  /v2/notifications?reference={caseRef} — get by reference\n   949→\n   950→Response Shape:\n   951→  {\n   952→    \"id\": \"notify-uuid\",\n   953→    \"reference\": \"COMP-2026-00012\",\n   954→    \"content\": { \"body\": \"...\", \"subject\": \"...\" },\n   955→    \"template\": { \"id\": \"...\", \"version\": 1 },\n   956→    \"uri\": \"https://api.notifications.service.gov.uk/v2/notifications/...\",\n   957→    \"status\": \"sending\" | \"delivered\" | \"permanent-failure\" | \"temporary-failure\"\n   958→  }\n   959→\n   960→Data Mapping to SocialHomes.Ai:\n   961→  GOV.UK Notify field     --> Internal model / usage\n   962→  ---------------------------------------------------------------\n   963→  id                      --> Communication.externalId (new field)\n   964→  status                  --> Communication.deliveryStatus (new field)\n   965→  reference               --> Communication.caseRef (existing)\n   966→  template.id             --> Communication.templateId (new field)\n   967→\n   968→  Integrates with:\n   969→    - Communication model (existing)\n   970→    - AI draft communications (existing /api/v1/ai/draft-communication)\n   971→    - Activity logging (existing ActivityDoc)\n   972→    - Tenant notification preferences (existing communicationPreference)\n   973→\n   974→New Server Route:\n   975→  POST /api/v1/public-data/notify/email\n   976→  POST /api/v1/public-data/notify/sms\n   977→  POST /api/v1/public-data/notify/letter\n   978→  GET  /api/v1/public-data/notify/status/:notificationId\n   979→  GET  /api/v1/public-data/notify/templates\n   980→\n   981→  Recommended: Create a dedicated route file server/src/routes/notify.ts\n   982→\n   983→Affected Pages:\n   984→  - /communications (CommunicationsPage.tsx) — send via GOV.UK Notify\n   985→  - /communications/templates — template management synced with Notify\n   986→  - /tenancies/:id (TenancyDetailPage.tsx) — send communication from tenant page\n   987→  - /complaints/:id (ComplaintDetailPage.tsx) — send acknowledgement/response\n   988→  - /repairs/:id (RepairDetailPage.tsx) — send appointment confirmation\n   989→  - /asb/:id (AsbDetailPage.tsx) — send warning letters\n   990→  - /rent (RentPage.tsx) — send arrears letters\n   991→  - /tenant-portal (TenantPortalPage.tsx) — notification delivery tracking\n   992→\n   993→Priority: P1\n   994→Complexity: High (template management, delivery tracking, multi-channel)\n   995→Dependencies: None\n   996→\n   997→User Stories:\n   998→  US-NOTIFY-01: As a housing officer, I want to send AI-drafted communications to\n   999→    tenants via GOV.UK Notify (email, SMS, or letter based on their preference),"}]},"uuid":"9a515563-9f6c-4592-9c6e-d0ab95bf107c","timestamp":"2026-02-26T07:43:46.909Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt","content":"  - /properties/:uprn (PropertyDetailPage.tsx) — flood risk badge\n  - /explore (ExplorePage.tsx) — flood zone overlay on maps\n  - /briefing (BriefingPage.tsx) — active flood warnings\n  - /dashboard (DashboardPage.tsx) — flood warning KPI\n  - /reports (ReportsPage.tsx) — flood risk analysis\n\nPriority: P2\nComplexity: Low\nDependencies: postcodes.io (for lat/lng)\n\nUser Stories:\n  US-FLOOD-01: As a property manager, I want to see active flood warnings for\n    properties in my patch, so I can contact vulnerable tenants proactively and\n    prepare for potential emergency repairs.\n    Acceptance: Properties within active flood warning areas show a red \"Flood\n    Warning\" banner on their detail page. Briefing page lists all affected properties.\n\n  US-FLOOD-02: As a stock investment planner, I want to see which properties are\n    in flood risk zones, so I can factor flood resilience into planned works programmes.\n    Acceptance: Property detail page shows flood risk zone classification. Reports\n    page allows filtering properties by flood risk level.\n\n========================================================================\n### 3.6 IMD — Index of Multiple Deprivation (ONS Open Data)\n========================================================================\n\nBase URL:         https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/\n                  (ArcGIS REST API for ONS geographies)\nAlt URL:          https://assets.publishing.service.gov.uk/media/\n                  (Static CSV downloads for IMD 2019)\nAuth:             None\nRate Limit:       Fair use\nDocumentation:    https://www.gov.uk/government/statistics/english-indices-of-deprivation-2019\n\nKey Endpoints:\n  GET IMD_2019/FeatureServer/0/query?where=lsoa11cd='{lsoaCode}'\n      &outFields=*&f=json\n\n  Alternatively, pre-load the IMD CSV (32,844 LSOAs) into Firestore on deployment.\n\nResponse Fields:\n  lsoa11cd                          — LSOA code\n  IMDScore                          — Overall IMD score (0-100)\n  IMDRank                           — Rank (1 = most deprived, 32844 = least)\n  IMDDecile                         — Decile (1 = most deprived 10%)\n  IncScore, IncRank                 — Income domain\n  EmpScore, EmpRank                 — Employment domain\n  EduScore, EduRank                 — Education domain\n  HeaScore, HeaRank                 — Health and disability domain\n  CriScore, CriRank                 — Crime domain\n  HouScore, HouRank                 — Housing and services barriers\n  LivScore, LivRank                 — Living environment domain\n\nData Mapping to SocialHomes.Ai:\n  IMD field        --> Internal model / usage\n  ---------------------------------------------------------------\n  IMDDecile        --> Property.imdDecile (new field)\n  IMDScore         --> Property.imdScore (new field)\n  IMDRank          --> Property.imdRank (new field)\n  IncScore         --> DeprivationProfile.incomeScore (new type)\n  EmpScore         --> DeprivationProfile.employmentScore\n  HeaScore         --> DeprivationProfile.healthScore\n  CriScore         --> DeprivationProfile.crimeScore\n  HouScore         --> DeprivationProfile.housingScore\n  LivScore         --> DeprivationProfile.livingEnvironmentScore\n\n  Feeds into:\n    - Automatic Vulnerability Detection (Differentiator 3)\n    - Benefits Entitlement Engine (Differentiator 4)\n    - AI Neighbourhood Briefing (Differentiator 6)\n    - Tenant vulnerability scoring\n    - Allocations prioritisation\n\nNew Server Route (replace existing simulated /api/v1/public-data/imd):\n  GET /api/v1/public-data/imd/:lsoaCode\n  GET /api/v1/public-data/imd/summary/:estateId (aggregate for all LSOAs in estate)\n\n  Recommended: Pre-load IMD dataset into Firestore collection \"imdData\" at deployment.\n  Cache TTL: 90 days (IMD data is updated infrequently — roughly every 4-5 years).\n\nAffected Pages:\n  - /properties/:uprn (PropertyDetailPage.tsx) — deprivation context card\n  - /tenancies/:id (TenancyDetailPage.tsx) — vulnerability context\n  - /explore/.../estate/:id — deprivation heatmap\n  - /reports (ReportsPage.tsx) — deprivation analysis\n  - /allocations (AllocationsPage.tsx) — needs-based allocation\n  - /briefing (BriefingPage.tsx) — deprivation context\n  - /dashboard (DashboardPage.tsx) — vulnerability KPI\n\nPriority: P1\nComplexity: Medium (recommend pre-loading CSV to Firestore)\nDependencies: postcodes.io (for LSOA code derivation)\n\nUser Stories:\n  US-IMD-01: As a housing officer, I want to see the deprivation profile (overall\n    decile and domain scores) for the area around a tenant's property, so I can\n    understand the socioeconomic context when assessing vulnerability and support needs.\n    Acceptance: Tenant and property detail pages show a compact \"Area Deprivation\"\n    card with IMD decile (colour-coded 1=red to 10=green), income, employment, health,\n    and crime domain scores.\n\n  US-IMD-02: As a head of service, I want to overlay IMD deprivation data on estate\n    maps, so I can identify which estates are in the most deprived areas and allocate\n    services accordingly.\n    Acceptance: Explore estate view shows deprivation heatmap. Estates in deciles\n    1-3 are highlighted. Dashboard shows \"X% of stock in decile 1-3 areas\".\n\n  US-IMD-03: As the AI system, I want to use IMD data as an input to the automatic\n    vulnerability detection model, so I can flag tenants in highly deprived areas who\n    may need proactive support even before they ask for it.\n    Acceptance: Vulnerability scoring model incorporates IMD decile. Tenants in\n    decile 1-2 areas receive an automatic +15 to their vulnerability score.\n\n========================================================================\n### 3.7 Census 2021 API (ONS) — Demographics & Housing Tenure\n========================================================================\n\nBase URL:         https://api.beta.ons.gov.uk/v1/\nAlt URL:          https://www.nomisweb.co.uk/api/v01/ (NOMIS access to Census tables)\nAuth:             None\nRate Limit:       Fair use\nDocumentation:    https://developer.ons.gov.uk/\n\nKey Endpoints:\n  GET /datasets/TS054/editions/2021/versions/1/observations?geography={lsoaCode}\n      (Tenure by household — owner/social/private rent)\n  GET /datasets/TS011/editions/2021/versions/1/observations?geography={lsoaCode}\n      (Household size)\n  GET /datasets/TS009/editions/2021/versions/1/observations?geography={lsoaCode}\n      (Age structure)\n  GET /datasets/TS021/editions/2021/versions/1/observations?geography={lsoaCode}\n      (Ethnic group)\n  GET /datasets/TS038/editions/2021/versions/1/observations?geography={lsoaCode}\n      (Disability)\n\nData Mapping to SocialHomes.Ai:\n  Census field                --> Internal model / usage\n  ---------------------------------------------------------------\n  TS054 (Tenure)              --> AreaDemographics.socialRentPct (new type)\n  TS054 (Tenure)              --> AreaDemographics.privateRentPct\n  TS054 (Tenure)              --> AreaDemographics.ownerOccupiedPct\n  TS011 (Household size)      --> AreaDemographics.averageHouseholdSize\n  TS009 (Age structure)       --> AreaDemographics.over65Pct\n  TS009 (Age structure)       --> AreaDemographics.under18Pct\n  TS038 (Disability)          --> AreaDemographics.limitedActivitiesPct\n\n  Feeds into:\n    - Allocations planning (understanding local housing demand)\n    - Vulnerability detection (high elderly %, high disability %)\n    - AI Neighbourhood Briefing (Differentiator 6)\n    - Reports — community profiling\n\nNew Server Route:\n  GET /api/v1/public-data/census/:lsoaCode?tables=TS054,TS011,TS009\n  GET /api/v1/public-data/census/summary/:estateId\n\n  Recommended: Pre-load key Census tables for relevant LSOAs into Firestore.\n  Cache TTL: 90 days (Census data does not change between Census years).\n\nAffected Pages:\n  - /explore/.../estate/:id — community demographics panel\n  - /allocations (AllocationsPage.tsx) — demand analysis\n  - /reports (ReportsPage.tsx) — community profiling\n  - /briefing (BriefingPage.tsx) — demographic context\n\nPriority: P2\nComplexity: Medium\nDependencies: postcodes.io (for LSOA codes)\n\nUser Stories:\n  US-CENSUS-01: As an allocations manager, I want to see Census demographics for\n    areas where we have stock, so I can understand local housing demand patterns\n    and plan lettings accordingly.\n    Acceptance: Allocations page shows an \"Area Profile\" panel with tenure mix,\n    household size distribution, age profile, and disability prevalence for the\n    selected estate's LSOA.\n\n  US-CENSUS-02: As the AI system, I want Census data about elderly and disabled\n    populations in each LSOA, so I can flag estates where adapted property demand\n    is likely to be high.\n    Acceptance: Estates in LSOAs with >25% over-65 or >20% activity-limited\n    population generate an AI insight: \"High demand for adapted/sheltered housing\n    in this area.\"\n\n========================================================================\n### 3.8 NOMIS API — Labour Market Statistics\n========================================================================\n\nBase URL:         https://www.nomisweb.co.uk/api/v01/\nAuth:             None (API key optional for higher limits)\nRate Limit:       Fair use\nDocumentation:    https://www.nomisweb.co.uk/api/v01/help\n\nKey Endpoints:\n  GET /dataset/NM_17_5.data.json?geography={laCode}\n      &variable=45&measures=20100  (Claimant count by LA)\n  GET /dataset/NM_1_1.data.json?geography={laCode}\n      &variable=18&measures=20100  (Employment rate by LA)\n  GET /dataset/NM_30_1.data.json?geography={laCode}\n      &measures=20100  (Job density)\n\nData Mapping to SocialHomes.Ai:\n  NOMIS field            --> Internal model / usage\n  ---------------------------------------------------------------\n  Claimant count         --> LabourMarket.claimantCount (new type)\n  Employment rate        --> LabourMarket.employmentRate\n  Job density            --> LabourMarket.jobDensity\n  Out-of-work benefits   --> LabourMarket.oowBenefitsRate\n\n  Feeds into:\n    - Benefits Entitlement Engine (Differentiator 4)\n    - Vulnerability detection\n    - Arrears prediction (unemployment correlation)\n    - AI Neighbourhood Briefing (Differentiator 6)\n\nNew Server Route:\n  GET /api/v1/public-data/labour/:laCode\n\n  Cache TTL: 7 days (monthly releases).\n\nAffected Pages:\n  - /rent (RentPage.tsx) — economic context for arrears\n  - /tenancies/:id (TenancyDetailPage.tsx) — employment context\n  - /reports (ReportsPage.tsx) — economic analysis\n  - /briefing (BriefingPage.tsx) — economic summary\n\nPriority: P2\nComplexity: Low\nDependencies: None (uses LA code from existing LocalAuthority model)\n\nUser Stories:\n  US-NOMIS-01: As a rent recovery officer, I want to see the local unemployment rate\n    and claimant count for the area where a tenant lives, so I can assess whether\n    arrears are likely related to local economic conditions and adjust my approach\n    accordingly.\n    Acceptance: Tenant detail and rent account pages show a compact \"Local Economy\"\n    card with employment rate, claimant count, and trend vs national average.\n\n  US-NOMIS-02: As the AI system, I want labour market data to improve arrears risk\n    prediction, so tenants in areas with rising unemployment are flagged for proactive\n    support before they fall into arrears.\n    Acceptance: Arrears risk model incorporates local claimant count trend. A rising\n    claimant count in the tenant's LA adds +10 to arrearsRisk score.\n\n---\n\n## 4. TIER 2: FREE APIs — REGISTRATION REQUIRED\n\n========================================================================\n### 4.1 Met Office DataHub — Weather Warnings & Detailed Forecasts\n========================================================================\n\nBase URL:         https://data.hub.api.metoffice.gov.uk/sitespecific/v0/\nAuth:             API key (free registration at MetOffice DataHub)\nRate Limit:       360 requests/hour (free tier)\nEnv Variable:     MET_OFFICE_API_KEY\nDocumentation:    https://datahub.metoffice.gov.uk/\n\nKey Endpoints:\n  GET /point/hourly?latitude={lat}&longitude={lng}\n  GET /point/daily?latitude={lat}&longitude={lng}\n  GET /point/three-hourly?latitude={lat}&longitude={lng}\n\n  Weather Warnings:\n  https://data.hub.api.metoffice.gov.uk/atmospheric/v0/\n  GET /warnings (national weather warnings)\n\nData Mapping to SocialHomes.Ai:\n  Met Office field         --> Internal model / usage\n  ---------------------------------------------------------------\n  screenTemperature        --> WeatherDetail.temperature\n  screenRelativeHumidity   --> WeatherDetail.humidity\n  totalPrecipAmount        --> WeatherDetail.precipitation\n  windSpeed10m             --> WeatherDetail.windSpeed\n  windGustSpeed            --> WeatherDetail.windGust\n  significantWeatherCode   --> WeatherDetail.weatherCode\n  Warning severity/type    --> WeatherWarning.severity (new type)\n\n  Feeds into:\n    - Predictive Damp Intelligence (Differentiator 1) — more granular than Open-Meteo\n    - AI Neighbourhood Briefing (Differentiator 6)\n    - Storm damage prediction for repairs\n    - Frost alerts for burst pipe prevention\n\nNew Server Route:\n  GET /api/v1/public-data/metoffice/forecast/:lat/:lng\n  GET /api/v1/public-data/metoffice/warnings\n\n  Cache TTL: 1 hour (forecast), 30 minutes (warnings).\n\nAffected Pages:\n  - /compliance/awaabs-law (AwaabsLawPage.tsx) — enhanced damp prediction\n  - /properties/:uprn (PropertyDetailPage.tsx) — detailed weather\n  - /briefing (BriefingPage.tsx) — Met Office warnings\n  - /dashboard (DashboardPage.tsx) — weather warning alerts\n  - /repairs (RepairsPage.tsx) — storm damage preparedness\n\nPriority: P2\nComplexity: Medium\nDependencies: None (uses lat/lng from property records)\n\nUser Stories:\n  US-MET-01: As a repairs manager, I want Met Office weather warnings displayed on\n    the briefing and dashboard pages, so I can prepare for increased repair demand\n    from storms, frost, or heavy rainfall.\n    Acceptance: Active Met Office warnings (amber/red) for areas containing our stock\n    appear as prominent alert cards on briefing and dashboard. Yellow warnings shown\n    in a secondary section.\n\n  US-MET-02: As the predictive damp model, I want hourly temperature, humidity, and\n    dew point data from Met Office (higher resolution than Open-Meteo), so I can\n    calculate condensation risk more accurately.\n    Acceptance: When MET_OFFICE_API_KEY is configured, the damp risk calculation\n    uses Met Office hourly data instead of Open-Meteo. Fallback to Open-Meteo if\n    Met Office is unavailable.\n\n========================================================================\n### 4.2 EPC Register API — Energy Performance Certificates\n========================================================================\n\nBase URL:         https://epc.opendatacommunities.org/api/v1/\nAuth:             Basic auth with registered API key\nRegistration:     https://epc.opendatacommunities.org/login\nEnv Variable:     EPC_API_KEY\nRate Limit:       No published limit (fair use)\nDocumentation:    https://epc.opendatacommunities.org/docs/api\n\nKey Endpoints:\n  GET /domestic/search?postcode={postcode}&size=100\n  GET /domestic/search?uprn={uprn}\n  GET /domestic/certificate/{lmk-key}\n  GET /domestic/recommendations/{lmk-key}\n\nResponse Shape:\n  {\n    \"rows\": [\n      {\n        \"lmk-key\": \"abc123\",\n        \"address\": \"1 Example Road\",\n        \"postcode\": \"SE15 4QN\",\n        \"uprn\": \"10091553414\",\n        \"current-energy-rating\": \"D\",\n        \"potential-energy-rating\": \"B\",\n        \"current-energy-efficiency\": \"58\",\n        \"potential-energy-efficiency\": \"82\",\n        \"property-type\": \"Flat\",\n        \"built-form\": \"Mid-Terrace\",\n        \"floor-area\": \"62\",\n        \"heating-cost-current\": \"1120\",\n        \"hot-water-cost-current\": \"280\",\n        \"lighting-cost-current\": \"110\",\n        \"co2-emissions-current\": \"3.8\",\n        \"walls-description\": \"Solid brick, no insulation\",\n        \"roof-description\": \"Flat roof, limited insulation\",\n        \"windows-description\": \"Single glazed\",\n        \"main-heating-description\": \"Gas central heating\",\n        \"lodgement-date\": \"2023-11-15\",\n        \"transaction-type\": \"rental (social)\"\n      }\n    ]\n  }\n\nData Mapping to SocialHomes.Ai:\n  EPC API field                 --> Internal model / usage\n  ---------------------------------------------------------------\n  current-energy-rating         --> Property.epc.rating\n  current-energy-efficiency     --> Property.epc.sapScore\n  potential-energy-rating       --> Property.epc.potentialRating (new)\n  potential-energy-efficiency   --> Property.epc.potentialScore (new)\n  lodgement-date                --> Property.epc.expiryDate (+ 10 years)\n  floor-area                    --> Property.floorArea (validation)\n  walls-description             --> Property.epc.wallsDesc (new)\n  roof-description              --> Property.epc.roofDesc (new)\n  windows-description           --> Property.epc.windowsDesc (new)\n  main-heating-description      --> Property.epc.heatingDesc (new)\n  co2-emissions-current         --> Property.epc.co2Current (new)\n  heating-cost-current          --> Property.epc.heatingCostAnnual (new)\n  recommendations (sub-endpoint)--> Property.epc.recommendations[] (new)\n\n  NOTE: Existing Property.epc has { rating, sapScore, expiryDate }.\n  This integration enriches it significantly.\n\n  Feeds into:\n    - Predictive Damp Intelligence (Differentiator 1) — wall/roof/window insulation\n    - Property Passport (Differentiator 5) — authoritative EPC data\n    - Stock condition / retrofit planning\n    - Carbon emissions reporting\n    - TSM measure BS06 (energy efficiency compliance)\n\nNew Server Route (extend existing /api/v1/public-data/epc):\n  GET /api/v1/public-data/epc/:postcode (EXISTING — enhance response)\n  GET /api/v1/public-data/epc/uprn/:uprn (NEW — lookup by UPRN)\n  GET /api/v1/public-data/epc/certificate/:lmkKey (NEW — full cert)\n  GET /api/v1/public-data/epc/recommendations/:lmkKey (NEW — improvement recs)\n\n  Cache TTL: 30 days (EPCs change only on re-lodgement).\n\nAffected Pages:\n  - /properties/:uprn (PropertyDetailPage.tsx) — full EPC data panel\n  - /compliance (CompliancePage.tsx) — EPC compliance summary\n  - /compliance/awaabs-law (AwaabsLawPage.tsx) — building fabric data for damp\n  - /reports/stock-condition — retrofit planning\n  - /reports (ReportsPage.tsx) — carbon emissions, energy cost analysis\n\nPriority: P1\nComplexity: Medium (existing route, significant enhancement)\nDependencies: Open UPRN (for UPRN-based lookup)\n\nUser Stories:\n  US-EPC-01: As a property manager, I want to see the full EPC certificate data\n    for each property (not just the rating), including wall, roof, window, and\n    heating descriptions, so I can understand the building fabric and identify\n    properties at risk of damp due to poor insulation.\n    Acceptance: Property detail page shows an expanded \"Energy Performance\" panel\n    with current/potential ratings, fabric descriptions, heating costs, CO2 emissions,\n    and improvement recommendations with estimated savings.\n\n  US-EPC-02: As a stock investment planner, I want to see aggregated EPC data across\n    all properties, so I can prioritise retrofit programmes by cost-benefit analysis.\n    Acceptance: Reports page shows EPC distribution chart (A-G), estimated total\n    retrofit cost to reach EPC C for all properties below C, and a prioritised list\n    by potential savings per pound invested.\n\n  US-EPC-03: As the predictive damp model, I want building fabric data from EPC\n    certificates (wall type, insulation, window glazing), so I can identify\n    properties where poor thermal performance increases condensation risk.\n    Acceptance: Damp risk model incorporates EPC building fabric data. Properties\n    with solid walls + no insulation + single glazing receive +20 damp risk score.\n\n========================================================================\n### 4.3 GOV.UK Notify — Government Communications Platform\n========================================================================\n\nBase URL:         https://api.notifications.service.gov.uk/\nAuth:             API key (free registration for public sector)\nRegistration:     https://www.notifications.service.gov.uk/\nEnv Variable:     GOVUK_NOTIFY_API_KEY\nRate Limit:       3,000 messages/minute\nDocumentation:    https://docs.notifications.service.gov.uk/\n\nKey Endpoints:\n  POST /v2/notifications/email\n    Body: { email_address, template_id, personalisation: { name, ref, ... } }\n  POST /v2/notifications/sms\n    Body: { phone_number, template_id, personalisation: { ... } }\n  POST /v2/notifications/letter\n    Body: { template_id, personalisation: { address_line_1, ..., postcode, ... } }\n  GET  /v2/notifications/{id} — check delivery status\n  GET  /v2/notifications?reference={caseRef} — get by reference\n\nResponse Shape:\n  {\n    \"id\": \"notify-uuid\",\n    \"reference\": \"COMP-2026-00012\",\n    \"content\": { \"body\": \"...\", \"subject\": \"...\" },\n    \"template\": { \"id\": \"...\", \"version\": 1 },\n    \"uri\": \"https://api.notifications.service.gov.uk/v2/notifications/...\",\n    \"status\": \"sending\" | \"delivered\" | \"permanent-failure\" | \"temporary-failure\"\n  }\n\nData Mapping to SocialHomes.Ai:\n  GOV.UK Notify field     --> Internal model / usage\n  ---------------------------------------------------------------\n  id                      --> Communication.externalId (new field)\n  status                  --> Communication.deliveryStatus (new field)\n  reference               --> Communication.caseRef (existing)\n  template.id             --> Communication.templateId (new field)\n\n  Integrates with:\n    - Communication model (existing)\n    - AI draft communications (existing /api/v1/ai/draft-communication)\n    - Activity logging (existing ActivityDoc)\n    - Tenant notification preferences (existing communicationPreference)\n\nNew Server Route:\n  POST /api/v1/public-data/notify/email\n  POST /api/v1/public-data/notify/sms\n  POST /api/v1/public-data/notify/letter\n  GET  /api/v1/public-data/notify/status/:notificationId\n  GET  /api/v1/public-data/notify/templates\n\n  Recommended: Create a dedicated route file server/src/routes/notify.ts\n\nAffected Pages:\n  - /communications (CommunicationsPage.tsx) — send via GOV.UK Notify\n  - /communications/templates — template management synced with Notify\n  - /tenancies/:id (TenancyDetailPage.tsx) — send communication from tenant page\n  - /complaints/:id (ComplaintDetailPage.tsx) — send acknowledgement/response\n  - /repairs/:id (RepairDetailPage.tsx) — send appointment confirmation\n  - /asb/:id (AsbDetailPage.tsx) — send warning letters\n  - /rent (RentPage.tsx) — send arrears letters\n  - /tenant-portal (TenantPortalPage.tsx) — notification delivery tracking\n\nPriority: P1\nComplexity: High (template management, delivery tracking, multi-channel)\nDependencies: None\n\nUser Stories:\n  US-NOTIFY-01: As a housing officer, I want to send AI-drafted communications to\n    tenants via GOV.UK Notify (email, SMS, or letter based on their preference),","numLines":500,"startLine":500,"totalLines":2334}},"sourceToolAssistantUUID":"b3349aca-1329-4808-aacf-d60e6fbfd8b0"}
{"parentUuid":"9a515563-9f6c-4592-9c6e-d0ab95bf107c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01JGRKix2exwSgFRa6VJBf6d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ebm76GyxTDSJ9GiaQ6AyZy","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","offset":500,"limit":300},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30425,"cache_read_input_tokens":42607,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":30425},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWJiL5me97Vg5NVVG4KA","type":"assistant","uuid":"721f833a-f5e3-4e65-b4d1-f5355095fe0c","timestamp":"2026-02-26T07:43:47.640Z"}
{"parentUuid":"721f833a-f5e3-4e65-b4d1-f5355095fe0c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ebm76GyxTDSJ9GiaQ6AyZy","type":"tool_result","content":"   500→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   501→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   502→\n   503→---\n   504→\n   505→## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)\n   506→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   507→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   508→\n   509→### What happened:\n   510→\n   511→#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)\n   512→\n   513→Performed full project re-analysis with deep codebase exploration (40 tool calls\n   514→across all 116+ TypeScript files) and updated all specification documents to v6.0.\n   515→\n   516→#### Updated 3 Specification Documents in `docs/requirements/`:\n   517→\n   518→1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification\n   519→   - Refreshed and validated all 17 functional modules against codebase\n   520→   - Updated Phase 5 task count to 50 (from 44)\n   521→   - Confirmed all 7 AI differentiators implemented and documented\n   522→   - Validated 5 persona definitions with AI focus areas\n   523→\n   524→2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture\n   525→   - Validated all version numbers against package.json files\n   526→   - Confirmed 50+ API endpoints across 16 route modules\n   527→   - Validated all Firestore schemas against firestore-schemas.ts\n   528→   - Confirmed 17 composite indexes and security rules\n   529→\n   530→3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements\n   531→   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)\n   532→   - 7 killer differentiator services fully specified with algorithms\n   533→   - 24 GOV.UK Notify templates across 7 categories\n   534→   - Cache TTL, rate limiting, and fallback strategies documented\n   535→\n   536→#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):\n   537→\n   538→- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):\n   539→  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)\n   540→  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)\n   541→  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)\n   542→  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)\n   543→  - Added new dependency chains for File/Data workflows\n   544→- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9\n   545→- All doc version references updated to v6.0\n   546→- Refreshed critical path execution order with new tasks\n   547→\n   548→### Files Changed:\n   549→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)\n   550→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)\n   551→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)\n   552→- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)\n   553→- `SESSION-HISTORY.md` (UPDATED — added Session 10)\n   554→\n   555→### Commits:\n   556→- (pending — awaiting user instruction to commit)\n   557→\n   558→### Decisions Taken:\n   559→- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management\n   560→- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n   561→- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n   562→- All documents validated against actual codebase (no stale references)\n   563→- Maintained backward compatibility with all existing task IDs\n   564→\n   565→### Pending Work:\n   566→- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n   567→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   568→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   569→- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n   570→"}]},"uuid":"693e6d5d-0741-408b-ae0c-eb38cbd701ef","timestamp":"2026-02-26T07:43:47.665Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n\n---\n\n## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)\n\nPerformed full project re-analysis with deep codebase exploration (40 tool calls\nacross all 116+ TypeScript files) and updated all specification documents to v6.0.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification\n   - Refreshed and validated all 17 functional modules against codebase\n   - Updated Phase 5 task count to 50 (from 44)\n   - Confirmed all 7 AI differentiators implemented and documented\n   - Validated 5 persona definitions with AI focus areas\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture\n   - Validated all version numbers against package.json files\n   - Confirmed 50+ API endpoints across 16 route modules\n   - Validated all Firestore schemas against firestore-schemas.ts\n   - Confirmed 17 composite indexes and security rules\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements\n   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)\n   - 7 killer differentiator services fully specified with algorithms\n   - 24 GOV.UK Notify templates across 7 categories\n   - Cache TTL, rate limiting, and fallback strategies documented\n\n#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):\n\n- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):\n  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)\n  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)\n  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)\n  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)\n  - Added new dependency chains for File/Data workflows\n- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9\n- All doc version references updated to v6.0\n- Refreshed critical path execution order with new tasks\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)\n- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)\n- `SESSION-HISTORY.md` (UPDATED — added Session 10)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management\n- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n- All documents validated against actual codebase (no stale references)\n- Maintained backward compatibility with all existing task IDs\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n","numLines":71,"startLine":500,"totalLines":570}},"sourceToolAssistantUUID":"721f833a-f5e3-4e65-b4d1-f5355095fe0c"}
{"parentUuid":"693e6d5d-0741-408b-ae0c-eb38cbd701ef","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01JGRKix2exwSgFRa6VJBf6d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AgKCmRoBt9HjP7hX4yKgon","name":"Task","input":{"description":"Explore codebase structure","prompt":"Explore the socialhomes project at /mnt/c/.netapps/socialhomes thoroughly. I need:\n\n1. Full directory listing of app/src/ (pages, components, hooks, data, types)\n2. Full directory listing of server/src/ (routes, services, middleware, models)\n3. Contents of app/src/types/index.ts (data model types)\n4. Contents of server/src/routes/ - list all route files and the endpoints they serve\n5. The existing docs/requirements/ folder contents\n6. package.json files (root, app, server) - just the dependencies sections\n7. The Dockerfile contents\n8. firestore.rules and firestore.indexes.json\n\nGive me comprehensive output for each item. This is a research task - do NOT write any code.","subagent_type":"Explore"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":30425,"cache_read_input_tokens":42607,"output_tokens":478,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":30425,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWJiL5me97Vg5NVVG4KA","type":"assistant","uuid":"8e3cb291-01e8-4b62-945f-004556fa4a67","timestamp":"2026-02-26T07:43:52.625Z"}
{"parentUuid":"8e3cb291-01e8-4b62-945f-004556fa4a67","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AgKCmRoBt9HjP7hX4yKgon","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have all the information needed. Let me compile the comprehensive research report:\n\n## COMPREHENSIVE SOCIALHOMES.AI PROJECT EXPLORATION REPORT\n\n---\n\n## 1. PROJECT OVERVIEW\n\n**Project:** SocialHomes.Ai  \n**Type:** AI-native social housing management platform for UK housing associations  \n**Tech Stack:** React 19 + Express + Firestore (Google Cloud Run)  \n**Region:** europe-west2 (London)  \n**Status:** LIVE and operational  \n\n---\n\n## 2. FULL DIRECTORY STRUCTURE\n\n### 2.1 Frontend Directory Structure (`/mnt/c/.netapps/socialhomes/app/src/`)\n\n```\napp/src/\n├── App.tsx                          [Main app component]\n├── App.css\n├── index.css\n├── main.tsx\n├── assets/\n├── components/\n│   ├── layout/\n│   │   ├── Breadcrumbs.tsx\n│   │   ├── Header.tsx\n│   │   ├── Layout.tsx\n│   │   ├── Sidebar.tsx\n│   │   └── YantraAssist.tsx\n│   └── shared/\n│       ├── ActionModal.tsx\n│       ├── AiActionCard.tsx\n│       ├── BenefitsPanel.tsx\n│       ├── CountdownTimer.tsx\n│       ├── DampIntelligencePanel.tsx\n│       ├── HelpDrawer.tsx\n│       ├── KpiCard.tsx\n│       ├── NeighbourhoodBriefingPanel.tsx\n│       ├── PropertyMap.tsx\n│       ├── ProtectedRoute.tsx\n│       ├── StatusPill.tsx\n│       └── VulnerabilityPanel.tsx\n├── context/\n│   └── AppContext.tsx\n├── contexts/\n│   └── AuthContext.tsx\n├── data/                            [Mock/seed data]\n│   ├── cases.ts\n│   ├── estates.ts\n│   ├── expanded-regions.ts\n│   ├── generated-cases.ts\n│   ├── generated-repairs.ts\n│   ├── help-content.ts\n│   ├── index.ts\n│   ├── organisation.ts\n│   ├── properties.ts\n│   ├── regions.ts\n│   ├── supplementary.ts\n│   └── tenants.ts\n├── hooks/\n│   ├── useApi.ts\n│   ├── useEntityIntelligence.ts\n│   └── usePersonaScope.ts\n├── pages/\n│   ├── admin/\n│   │   ├── AdminPage.tsx\n│   │   └── IntegrationsPage.tsx\n│   ├── ai-centre/\n│   │   └── AiCentrePage.tsx\n│   ├── allocations/\n│   │   └── AllocationsPage.tsx\n│   ├── asb/\n│   │   ├── AsbDetailPage.tsx\n│   │   └── AsbPage.tsx\n│   ├── auth/\n│   │   └── LoginPage.tsx\n│   ├── briefing/\n│   │   └── BriefingPage.tsx\n│   ├── communications/\n│   │   └── CommunicationsPage.tsx\n│   ├── complaints/\n│   │   ├── ComplaintDetailPage.tsx\n│   │   └── ComplaintsPage.tsx\n│   ├── compliance/\n│   │   ├── AwaabsLawPage.tsx\n│   │   ├── CompliancePage.tsx\n│   │   └── ComplianceTypePage.tsx\n│   ├── dashboard/\n│   │   └── DashboardPage.tsx\n│   ├── explore/\n│   │   └── ExplorePage.tsx\n│   ├── properties/\n│   │   ├── ApplicationPage.tsx\n│   │   ├── PropertiesPage.tsx\n│   │   ├── PropertyDetailPage.tsx\n│   │   └── ViewingBookingPage.tsx\n│   ├── rent/\n│   │   └── RentPage.tsx\n│   ├── repairs/\n│   │   ├── RepairDetailPage.tsx\n│   │   └── RepairsPage.tsx\n│   ├── reports/\n│   │   ├── DynamicReportPage.tsx\n│   │   ├── ReportsPage.tsx\n│   │   └── TsmReportPage.tsx\n│   ├── search/\n│   │   └── SearchPage.tsx\n│   ├── shared/\n│   │   └── ComingSoonPage.tsx\n│   ├── tenancies/\n│   │   ├── TenanciesPage.tsx\n│   │   └── TenancyDetailPage.tsx\n│   └── tenant-portal/\n│       └── TenantPortalPage.tsx\n├── services/\n│   ├── ai-drafting.ts              [18 KB]\n│   ├── api-client.ts               [13 KB]\n│   ├── firebase.ts                 [2.6 KB]\n│   └── public-data.ts              [69 KB]\n├── types/\n│   └── index.ts                    [Complete type definitions]\n└── utils/\n    └── format.ts\n```\n\n### 2.2 Backend Directory Structure (`/mnt/c/.netapps/socialhomes/server/src/`)\n\n```\nserver/src/\n├── index.ts                         [Main server entry point]\n├── middleware/\n│   ├── auth.ts                      [Authentication & authorization]\n│   ├── error-handler.ts\n│   ├── metrics.ts\n│   ├── rate-limiter.ts\n│   └── rbac.ts                      [Role-based access control]\n├── models/\n│   ├── firestore-schemas.ts\n│   └── hact-codes.ts               [Housing standards reference data]\n├── routes/\n│   ├── admin.ts\n│   ├── ai.ts                        [17 KB - AI services]\n│   ├── auth.ts\n│   ├── booking.ts\n│   ├── briefing.ts\n│   ├── cases.ts                     [Unified case management]\n│   ├── compliance.ts\n│   ├── explore.ts\n│   ├── export.ts\n│   ├── lettings.ts\n│   ├── properties.ts\n│   ├── public-data.ts               [22 KB - Public API proxy]\n│   ├── public-data.test.ts          [29 KB - Test suite]\n│   ├── rent.ts\n│   ├── reports.ts\n│   └── tenants.ts\n├── scripts/\n│   └── seed-imd.ts\n├── services/\n│   ├── benefits-engine.ts           [11 KB - DWP integration]\n│   ├── census-nomis.ts              [17 KB - Labour market data]\n│   ├── crime-context.ts             [11 KB - Police.uk crime data]\n│   ├── damp-prediction.ts           [17 KB - Predictive AI]\n│   ├── external-api.ts              [5.1 KB]\n│   ├── external-api.test.ts         [12 KB]\n│   ├── firebase-admin.ts            [1.7 KB]\n│   ├── firestore.ts                 [4.9 KB - Core DB operations]\n│   ├── firestore.test.ts            [6.7 KB]\n│   ├── govuk-notify.ts              [45 KB - Notification templates]\n│   ├── hact-export.ts               [5.5 KB]\n│   ├── mock-services.ts             [23 KB - Simulated APIs]\n│   ├── monitoring.ts                [4.4 KB]\n│   ├── neighbourhood-briefing.ts    [14 KB - Context synthesis]\n│   ├── property-passport.ts         [11 KB - Property analytics]\n│   ├── seed-data.ts                 [28 KB]\n│   ├── seed.ts                      [9.1 KB]\n│   └── vulnerability-detection.ts   [16 KB - Tenant risk scoring]\n```\n\n---\n\n## 3. FRONTEND: app/src/types/index.ts (Complete Data Model)\n\nThe complete type system defines all domain entities:\n\n### Core Entity Types:\n\n**Personas:** COO, Head of Service, Manager, Housing Officer, Operative\n\n**Geography Hierarchy:**\n- Region (lat/lng, local authorities, compliance metrics)\n- LocalAuthority (lat/lng, estates, LHA rates)\n- Estate (scheme type, managing officer, KPIs)\n- Block (fire safety, asbestos, legionella, communal fire systems, lifts)\n\n**Properties:**\n- Type: flat, house, maisonette, bungalow, bedsit, studio\n- Tenure: secure, assured, AST, starter, fixed-term, flexible, licence, shared-ownership\n- Compliance: gas safety, electrical (EICR), fire, asbestos, legionella, lifts\n- EPC data with SAP scores and recommendations\n- Heating types, floor area, bedrooms, dampness risk scores\n- Stock condition components with life expectancy\n\n**Tenants:**\n- Demographics (title, DOB, household members, dependents)\n- Financial (rent balance, arrears risk score 0-100, weekly charge, payment methods)\n- UC status (claiming, transitioning, managed-migration)\n- Vulnerability flags (type, severity, notes)\n- Communication preferences\n\n**Unified Case System:**\n- CaseType: complaint, repair, ASB, enquiry, financial, safeguarding, damp-mould\n- Priority: emergency, urgent, routine, planned\n- SLA tracking (within, approaching, breached)\n- Activities (call, visit, letter, email, SMS, note) with direction (inbound/outbound)\n- Tasks (pending, in-progress, completed, overdue)\n\n**Specialized Case Types:**\n\n*Repair:*\n- SOR code/description, trade, operative assignment\n- Appointment scheduling with slots\n- First-time fix tracking, satisfaction scores\n- Awaab's Law timers (emergency/significant deadlines)\n- Recurrence risk scoring\n\n*Complaint:*\n- Stage 1/2 with acknowledgement and response deadlines\n- Finding (upheld/partially-upheld/not-upheld)\n- Ombudsman escalation tracking\n\n*ASB (Anti-Social Behaviour):*\n- Severity: cat-1, cat-2, cat-3\n- Escalation: warning, ABC, CPW, CPN, injunction, possession, closure\n- Evidence count, multi-agency panel flag\n- Legal action probability\n\n*Damp & Mould:*\n- Hazard classification (emergency/significant/non-urgent)\n- Moisture, humidity, temperature environmental data\n- Linked repairs tracking\n- Awaab's Law timers\n\n**Financial:**\n- RentTransaction (charge, payment, adjustment, HB, UC)\n- ServiceCharge (weekly amount, annual budget, apportionment)\n- FinancialCase (arrears tracking, payment arrangements, pre-action checklists)\n\n**Compliance Certificates:**\n- Type: gas, electrical, fire, asbestos, legionella, lift\n- Contractor verification with registration numbers\n\n**Allocations & Lettings:**\n- VoidProperty (stage, daysVoid, rent loss, target let date)\n- Applicant (band A-D, bedroom need, local connection)\n\n**Communications:**\n- Channel: email, phone, letter, SMS, portal, govuk-notify\n- Direction: inbound/outbound\n- AI categorization with sentiment analysis\n- Delivery tracking (sending, delivered, permanent-failure, temporary-failure)\n\n**AI Entities:**\n- AiInsight (prediction, alert, recommendation, analysis with confidence scores)\n- AiAction (workflow steps with preview/edit/confirm/followup)\n- AuditEntry (comprehensive access logging)\n\n**External API Data Structures:**\n- CrimeIncident (Police.uk)\n- DeprivationProfile (IMD deciles, income, employment, education, health, crime, housing, living environment)\n- AreaDemographics (Census 2021 - housing tenure, household size, age breakdowns)\n- LabourMarket (NOMIS - claimant count, employment rate, job density, OOW benefits)\n- FloodAlert (DEFRA - severity zones)\n- WeatherDetail & WeatherWarning (Open-Meteo + Met Office)\n- SensorReading & SensorAlert (IoT - Switchee, Aico, HomeLync)\n- UcStatus (DWP Universal Credit)\n\n**Composite Intelligence:**\n- DampRiskBreakdown (weather factor 0.25, building factor, history factor, sensor factor, occupancy factor, overall score 0-100)\n- VulnerabilityAssessment (overall score, deprivation, arrears, health, isolation, age, dependents, UC transition factors)\n\n---\n\n## 4. API ROUTES & ENDPOINTS\n\n### 4.1 Route Registration (`server/src/index.ts`)\n\nAll API routes are registered under `/api/v1/` with authentication and rate limiting:\n\n```\n/api/v1/auth         → Auth routes (seed users, profile creation, login)\n/api/v1/ai           → AI services (drafting, intelligence, chat)\n/api/v1/admin        → Admin functions\n/api/v1/properties   → Property CRUD and queries\n/api/v1/tenants      → Tenant management\n/api/v1/cases        → Unified case management\n/api/v1/explore      → Exploratory queries\n/api/v1/briefing     → AI briefing generation\n/api/v1/compliance   → Compliance tracking\n/api/v1/rent         → Rent/financial tracking\n/api/v1/reports      → Report generation\n/api/v1/public-data  → External API proxy\n/api/v1/export       → Data export\n/api/v1/lettings     → Lettings/allocations\n/api/v1/booking      → Viewing/appointment booking\n```\n\n### 4.2 Detailed Endpoints\n\n**Auth Routes** (`/api/v1/auth`):\n```\nPOST /seed-users        → Create demo Firebase users (idempotent)\nPOST /profile           → Create user profile on first registration\nGET  /me                → Get authenticated user profile\n```\n\n**Properties Routes** (`/api/v1/properties`):\n```\nGET  /                  → List properties with filters\n                          ?regionId, ?estateId, ?blockId, ?type, ?isVoid, ?limit\nGET  /available         → Get void properties available for letting\nGET  /:id               → Get single property by ID\nPATCH /:id              → Update property\n```\n\n**Cases Routes** (`/api/v1/cases`):\n```\nGET  /                  → List cases with filters\n                          ?type, ?status, ?handler, ?priority, ?propertyId, ?tenantId\n                          ?limit (default 50), ?offset\nGET  /:id               → Get case with related activities\nPOST /                  → Create new case\nPATCH /:id              → Update case\nGET  /:id/activities    → Get activities for a case\n```\n\n**AI Routes** (`/api/v1/ai`):\n```\nPOST /draft-communication     → Generate AI communication drafts\nPOST /entity-intelligence     → Get AI predictions/alerts\nPOST /neighbourhood-context   → Neighbourhood briefing\nPOST /property-intelligence   → Property analysis\nPOST /tenant-context          → Tenant risk assessment\nPOST /chat                    → Conversational AI queries\n```\n\n**Public Data Routes** (`/api/v1/public-data`):\n- Crime data (Police.uk)\n- Weather forecasts (Open-Meteo)\n- Flood risk (DEFRA)\n- Postcode lookup (Postcodes.io)\n- IMD/deprivation data\n- Census demographics (NOMIS)\n\n---\n\n## 5. PACKAGE DEPENDENCIES\n\n### 5.1 Frontend Dependencies (`app/package.json`)\n\n**React Stack:**\n- react 19.2.0\n- react-dom 19.2.0\n- react-router-dom 6.30.3\n\n**UI & Styling:**\n- tailwindcss 4.1.18\n- @tailwindcss/vite 4.1.18\n- lucide-react 0.563.0\n\n**Data Visualization:**\n- d3 7.9.0\n- recharts 3.7.0\n- @react-three/fiber 9.5.0\n- @react-three/drei 10.7.7\n- three 0.182.0\n\n**Mapping:**\n- leaflet 1.9.4\n- react-leaflet 5.0.0\n- @types/leaflet 1.9.21\n\n**Data Management:**\n- @tanstack/react-query 5.90.20\n\n**Firebase:**\n- firebase 12.9.0\n- firebaseui 6.1.0 (requires --legacy-peer-deps)\n\n**Utilities:**\n- date-fns 4.1.0\n- clsx 2.1.1\n\n**DevDependencies:**\n- TypeScript 5.9.3\n- Vite 7.2.4\n- ESLint 9.39.1\n- React TypeScript types\n\n### 5.2 Backend Dependencies (`server/package.json`)\n\n**Core:**\n- express 4.21.2\n- node 20.17.0 (runtime)\n\n**Firebase & Firestore:**\n- firebase-admin 13.6.1\n- @google-cloud/firestore 7.11.0\n\n**Middleware:**\n- helmet 8.1.0 (security headers)\n- cors 2.8.5\n- compression 1.8.0\n- morgan 1.10.0 (HTTP request logging)\n\n**DevDependencies:**\n- TypeScript 5.7.0\n- tsx 4.19.4 (TypeScript executor)\n- Vitest 4.0.18 (test framework)\n\n---\n\n## 6. DOCUMENTATION STRUCTURE\n\n### 6.1 Requirements Documents (`/mnt/c/.netapps/socialhomes/docs/requirements/`)\n\n1. **Doc1-socialhomes-Base-Specification.txt** (35,933 bytes)\n   - Product overview\n   - 17 core functional modules\n   - Simulated organization (RCHA with 75 properties, 68 tenants, 279+ cases)\n   - 5 estates with real SE London postcodes\n   - Vision: \"Bloomberg Terminal meets Figma for social housing\"\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (40,504 bytes)\n   - System architecture\n   - Technology choices\n   - Security model\n   - Scaling considerations\n\n3. **Doc3-socialhomes-API-Requirements.txt** (28,508 bytes)\n   - 20 total integrations\n   - Tier 1 (3 free): Police.uk, Open-Meteo, DEFRA\n   - Tier 2 (6 registration): Postcodes.io, EPC Open Data, etc.\n   - Tier 3 (5+ mock): DWP, Land Registry, GoCardless, Nomis, etc.\n   - Server-side proxy pattern for ALL external APIs\n   - Cache strategies and rate limits\n\n### 6.2 Other Key Documentation\n\n- **CLAUDE.md** — Project conventions and instructions\n- **DEV-FIX-LIST.md** — Bug/warning tracker from Selenium tests\n- **DEVOPS.md** — DevOps and Cloud Run deployment guide\n- **EXECUTION-PLAN.md** — Current development priorities\n- **SESSION-HISTORY.md** — Persistent session context\n- **cloudbuild.yaml** — Cloud Build CI/CD configuration\n\n---\n\n## 7. FIRESTORE CONFIGURATION\n\n### 7.1 Firestore Security Rules (`firestore.rules`)\n\n**Authentication & Authorization:**\n- Persona-based RBAC (COO, Head of Service, Manager, Housing Officer, Operative)\n- Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n\n**Collections & Access Control:**\n```\norganisations        → read: authenticated | write: admin\nregions              → read: authenticated | write: admin\nlocalAuthorities     → read: authenticated | write: admin\nestates              → read: authenticated | write: manager+\nblocks               → read: authenticated | write: manager+\nproperties           → read: authenticated | create/update: manager+ | delete: admin\ntenants              → read: authenticated | create/update: manager+ | delete: admin\ncases                → read: authenticated | create/update: authenticated | delete: admin\nactivities           → read: authenticated | create/update: authenticated | delete: admin\ncommunications       → read: authenticated | create/update: authenticated | delete: manager+\nrentTransactions     → read: authenticated | write: manager+\nusers                → read: authenticated | create/update/delete: admin (+ self-update)\nauditLog             → read: manager+ | create: authenticated | (append-only)\nhactCodes            → read: authenticated | write: admin\nnotifications        → read: authenticated | create/update: authenticated | delete: manager+\nvoidProperties       → read: authenticated | write: manager+\napplicants           → read: authenticated | write: manager+\ntsmMeasures          → read: authenticated | write: admin\n```\n\n### 7.2 Firestore Indexes (`firestore.indexes.json`)\n\n17 composite indexes optimized for common queries:\n\n**Cases Indexes** (5):\n- type + status + createdDate\n- type + handler + createdDate\n- tenantId + createdDate\n- propertyId + createdDate\n- type + priority + createdDate\n\n**Properties Indexes** (3):\n- regionId + type\n- estateId + isVoid\n- blockId + type\n\n**Tenants Indexes** (2):\n- assignedOfficer + tenancyStatus\n- arrearsRisk (descending)\n\n**Activities Indexes** (2):\n- tenantId + date\n- caseId + date\n\n**Other Collections** (5):\n- rentTransactions: tenantId + date\n- auditLog: timestamp\n- localAuthorities: regionId\n- estates: localAuthorityId\n- blocks: estateId\n\n---\n\n## 8. DOCKER & DEPLOYMENT\n\n### 8.1 Dockerfile Structure\n\nThree-stage build for optimized production image:\n\n**Stage 1 — Build Client:**\n- Node 20 slim image\n- npm ci --legacy-peer-deps (firebaseui peer dep issue)\n- React/Vite build to dist/\n\n**Stage 2 — Build Server:**\n- Node 20 slim image\n- npm ci\n- TypeScript compilation to dist/\n\n**Stage 3 — Production:**\n- Node 20 slim base\n- Copy production dependencies only (--omit=dev)\n- Copy built client and server artifacts\n- curl for health checks\n- PORT env var (Cloud Run default 8080)\n- NODE_ENV=production\n- Starts with: `node server/dist/index.js`\n\n---\n\n## 9. SERVICES & INTEGRATIONS\n\n### 9.1 Frontend Services\n\n**ai-drafting.ts** (18 KB)\n- Template-based letter/communication generation\n- Tone/persona-aware drafting\n\n**api-client.ts** (13 KB)\n- Centralized HTTP client for all backend API calls\n- Auth token management\n- Error handling\n\n**firebase.ts** (2.6 KB)\n- Firebase client initialization\n- Auth setup\n\n**public-data.ts** (69 KB)\n- Complex public data aggregation\n- Caching logic\n- Fallback handling\n\n### 9.2 Backend Services\n\n**AI & Intelligence:**\n- **damp-prediction.ts** — ML-based damp risk scoring (weather, building, history, sensor, occupancy factors)\n- **vulnerability-detection.ts** — Tenant vulnerability scoring (deprivation, arrears, health, isolation, dependents, UC)\n- **crime-context.ts** — Police.uk crime data integration and correlation\n- **neighbourhood-briefing.ts** — Contextual briefing synthesis\n- **property-passport.ts** — Property analytics and insights\n\n**Benefits & Financial:**\n- **benefits-engine.ts** — DWP benefits eligibility assessment\n- **census-nomis.ts** — Labour market and census data aggregation\n\n**External APIs:**\n- **public-data.ts** — Server-side proxy for all external APIs\n- **govuk-notify.ts** — 45 KB template library for UK gov notifications\n- **external-api.ts** — API management and orchestration\n\n**Data & Persistence:**\n- **firestore.ts** — Core Firestore operations (getDocs, setDoc, updateDoc, etc.)\n- **firebase-admin.ts** — Firebase Admin SDK initialization\n- **hact-export.ts** — Housing Act compliance export\n\n**Mock/Simulation:**\n- **mock-services.ts** — Realistic simulated data for Tier 3 APIs (UC, GoCardless, Land Registry, etc.)\n- **seed-data.ts** — 28 KB dataset generation\n- **seed.ts** — Database seeding\n\n**Monitoring:**\n- **monitoring.ts** — Metrics collection\n\n---\n\n## 10. KEY ARCHITECTURAL PATTERNS\n\n1. **Server-Side Proxy Pattern** — All external APIs called from Express backend, frontend communicates only with own backend\n\n2. **Persona-Based RBAC** — Every operation gated by persona level (COO > Head of Service > Manager > Housing Officer > Operative)\n\n3. **Unified Case System** — Repairs, complaints, ASB, damp, financial all use same Case model with specialized subtypes\n\n4. **Layered Intelligence** — Damp, vulnerability, crime risk calculated from multiple weighted factors (environmental, historical, sensor, contextual)\n\n5. **Simulated Fallback** — All Tier 3 (paid) APIs have mock implementations returning realistic data when real API unavailable\n\n6. **Firestore Optimization** — In-memory filtering/sorting for small datasets (<1000 docs) to avoid composite index complexity\n\n---\n\n## 11. SUMMARY STATISTICS\n\n- **Frontend Pages:** 20 main pages across 17 feature areas\n- **Shared Components:** 12 reusable UI components\n- **Backend Routes:** 13 route files with ~40+ endpoints\n- **Backend Services:** 19 specialized services\n- **Total Integrations:** 20 (3 live free + 6 live registration + 11+ mock)\n- **Data Model:** 40+ TypeScript types covering all domain entities\n- **Firestore Collections:** 18 collections with 17 composite indexes\n- **Demo Data:** 75 properties, 68 tenants, 279+ cases across 5 estates\n\n---\n\nThis comprehensive exploration captures the complete architecture, data model, API surface, deployment configuration, and integration landscape of the SocialHomes.Ai platform. The project is a sophisticated, production-ready social housing management system with advanced AI capabilities, real external data integrations, and professional-grade infrastructure."},{"type":"text","text":"agentId: a67b03872c1ff280f (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 59481\ntool_uses: 35\nduration_ms: 87816</usage>"}]}]},"uuid":"db8c2660-816a-4a99-a4eb-4ce12907ba6f","timestamp":"2026-02-26T07:48:37.128Z","toolUseResult":{"status":"completed","prompt":"Explore the socialhomes project at /mnt/c/.netapps/socialhomes thoroughly. I need:\n\n1. Full directory listing of app/src/ (pages, components, hooks, data, types)\n2. Full directory listing of server/src/ (routes, services, middleware, models)\n3. Contents of app/src/types/index.ts (data model types)\n4. Contents of server/src/routes/ - list all route files and the endpoints they serve\n5. The existing docs/requirements/ folder contents\n6. package.json files (root, app, server) - just the dependencies sections\n7. The Dockerfile contents\n8. firestore.rules and firestore.indexes.json\n\nGive me comprehensive output for each item. This is a research task - do NOT write any code.","agentId":"a67b03872c1ff280f","content":[{"type":"text","text":"Perfect! Now I have all the information needed. Let me compile the comprehensive research report:\n\n## COMPREHENSIVE SOCIALHOMES.AI PROJECT EXPLORATION REPORT\n\n---\n\n## 1. PROJECT OVERVIEW\n\n**Project:** SocialHomes.Ai  \n**Type:** AI-native social housing management platform for UK housing associations  \n**Tech Stack:** React 19 + Express + Firestore (Google Cloud Run)  \n**Region:** europe-west2 (London)  \n**Status:** LIVE and operational  \n\n---\n\n## 2. FULL DIRECTORY STRUCTURE\n\n### 2.1 Frontend Directory Structure (`/mnt/c/.netapps/socialhomes/app/src/`)\n\n```\napp/src/\n├── App.tsx                          [Main app component]\n├── App.css\n├── index.css\n├── main.tsx\n├── assets/\n├── components/\n│   ├── layout/\n│   │   ├── Breadcrumbs.tsx\n│   │   ├── Header.tsx\n│   │   ├── Layout.tsx\n│   │   ├── Sidebar.tsx\n│   │   └── YantraAssist.tsx\n│   └── shared/\n│       ├── ActionModal.tsx\n│       ├── AiActionCard.tsx\n│       ├── BenefitsPanel.tsx\n│       ├── CountdownTimer.tsx\n│       ├── DampIntelligencePanel.tsx\n│       ├── HelpDrawer.tsx\n│       ├── KpiCard.tsx\n│       ├── NeighbourhoodBriefingPanel.tsx\n│       ├── PropertyMap.tsx\n│       ├── ProtectedRoute.tsx\n│       ├── StatusPill.tsx\n│       └── VulnerabilityPanel.tsx\n├── context/\n│   └── AppContext.tsx\n├── contexts/\n│   └── AuthContext.tsx\n├── data/                            [Mock/seed data]\n│   ├── cases.ts\n│   ├── estates.ts\n│   ├── expanded-regions.ts\n│   ├── generated-cases.ts\n│   ├── generated-repairs.ts\n│   ├── help-content.ts\n│   ├── index.ts\n│   ├── organisation.ts\n│   ├── properties.ts\n│   ├── regions.ts\n│   ├── supplementary.ts\n│   └── tenants.ts\n├── hooks/\n│   ├── useApi.ts\n│   ├── useEntityIntelligence.ts\n│   └── usePersonaScope.ts\n├── pages/\n│   ├── admin/\n│   │   ├── AdminPage.tsx\n│   │   └── IntegrationsPage.tsx\n│   ├── ai-centre/\n│   │   └── AiCentrePage.tsx\n│   ├── allocations/\n│   │   └── AllocationsPage.tsx\n│   ├── asb/\n│   │   ├── AsbDetailPage.tsx\n│   │   └── AsbPage.tsx\n│   ├── auth/\n│   │   └── LoginPage.tsx\n│   ├── briefing/\n│   │   └── BriefingPage.tsx\n│   ├── communications/\n│   │   └── CommunicationsPage.tsx\n│   ├── complaints/\n│   │   ├── ComplaintDetailPage.tsx\n│   │   └── ComplaintsPage.tsx\n│   ├── compliance/\n│   │   ├── AwaabsLawPage.tsx\n│   │   ├── CompliancePage.tsx\n│   │   └── ComplianceTypePage.tsx\n│   ├── dashboard/\n│   │   └── DashboardPage.tsx\n│   ├── explore/\n│   │   └── ExplorePage.tsx\n│   ├── properties/\n│   │   ├── ApplicationPage.tsx\n│   │   ├── PropertiesPage.tsx\n│   │   ├── PropertyDetailPage.tsx\n│   │   └── ViewingBookingPage.tsx\n│   ├── rent/\n│   │   └── RentPage.tsx\n│   ├── repairs/\n│   │   ├── RepairDetailPage.tsx\n│   │   └── RepairsPage.tsx\n│   ├── reports/\n│   │   ├── DynamicReportPage.tsx\n│   │   ├── ReportsPage.tsx\n│   │   └── TsmReportPage.tsx\n│   ├── search/\n│   │   └── SearchPage.tsx\n│   ├── shared/\n│   │   └── ComingSoonPage.tsx\n│   ├── tenancies/\n│   │   ├── TenanciesPage.tsx\n│   │   └── TenancyDetailPage.tsx\n│   └── tenant-portal/\n│       └── TenantPortalPage.tsx\n├── services/\n│   ├── ai-drafting.ts              [18 KB]\n│   ├── api-client.ts               [13 KB]\n│   ├── firebase.ts                 [2.6 KB]\n│   └── public-data.ts              [69 KB]\n├── types/\n│   └── index.ts                    [Complete type definitions]\n└── utils/\n    └── format.ts\n```\n\n### 2.2 Backend Directory Structure (`/mnt/c/.netapps/socialhomes/server/src/`)\n\n```\nserver/src/\n├── index.ts                         [Main server entry point]\n├── middleware/\n│   ├── auth.ts                      [Authentication & authorization]\n│   ├── error-handler.ts\n│   ├── metrics.ts\n│   ├── rate-limiter.ts\n│   └── rbac.ts                      [Role-based access control]\n├── models/\n│   ├── firestore-schemas.ts\n│   └── hact-codes.ts               [Housing standards reference data]\n├── routes/\n│   ├── admin.ts\n│   ├── ai.ts                        [17 KB - AI services]\n│   ├── auth.ts\n│   ├── booking.ts\n│   ├── briefing.ts\n│   ├── cases.ts                     [Unified case management]\n│   ├── compliance.ts\n│   ├── explore.ts\n│   ├── export.ts\n│   ├── lettings.ts\n│   ├── properties.ts\n│   ├── public-data.ts               [22 KB - Public API proxy]\n│   ├── public-data.test.ts          [29 KB - Test suite]\n│   ├── rent.ts\n│   ├── reports.ts\n│   └── tenants.ts\n├── scripts/\n│   └── seed-imd.ts\n├── services/\n│   ├── benefits-engine.ts           [11 KB - DWP integration]\n│   ├── census-nomis.ts              [17 KB - Labour market data]\n│   ├── crime-context.ts             [11 KB - Police.uk crime data]\n│   ├── damp-prediction.ts           [17 KB - Predictive AI]\n│   ├── external-api.ts              [5.1 KB]\n│   ├── external-api.test.ts         [12 KB]\n│   ├── firebase-admin.ts            [1.7 KB]\n│   ├── firestore.ts                 [4.9 KB - Core DB operations]\n│   ├── firestore.test.ts            [6.7 KB]\n│   ├── govuk-notify.ts              [45 KB - Notification templates]\n│   ├── hact-export.ts               [5.5 KB]\n│   ├── mock-services.ts             [23 KB - Simulated APIs]\n│   ├── monitoring.ts                [4.4 KB]\n│   ├── neighbourhood-briefing.ts    [14 KB - Context synthesis]\n│   ├── property-passport.ts         [11 KB - Property analytics]\n│   ├── seed-data.ts                 [28 KB]\n│   ├── seed.ts                      [9.1 KB]\n│   └── vulnerability-detection.ts   [16 KB - Tenant risk scoring]\n```\n\n---\n\n## 3. FRONTEND: app/src/types/index.ts (Complete Data Model)\n\nThe complete type system defines all domain entities:\n\n### Core Entity Types:\n\n**Personas:** COO, Head of Service, Manager, Housing Officer, Operative\n\n**Geography Hierarchy:**\n- Region (lat/lng, local authorities, compliance metrics)\n- LocalAuthority (lat/lng, estates, LHA rates)\n- Estate (scheme type, managing officer, KPIs)\n- Block (fire safety, asbestos, legionella, communal fire systems, lifts)\n\n**Properties:**\n- Type: flat, house, maisonette, bungalow, bedsit, studio\n- Tenure: secure, assured, AST, starter, fixed-term, flexible, licence, shared-ownership\n- Compliance: gas safety, electrical (EICR), fire, asbestos, legionella, lifts\n- EPC data with SAP scores and recommendations\n- Heating types, floor area, bedrooms, dampness risk scores\n- Stock condition components with life expectancy\n\n**Tenants:**\n- Demographics (title, DOB, household members, dependents)\n- Financial (rent balance, arrears risk score 0-100, weekly charge, payment methods)\n- UC status (claiming, transitioning, managed-migration)\n- Vulnerability flags (type, severity, notes)\n- Communication preferences\n\n**Unified Case System:**\n- CaseType: complaint, repair, ASB, enquiry, financial, safeguarding, damp-mould\n- Priority: emergency, urgent, routine, planned\n- SLA tracking (within, approaching, breached)\n- Activities (call, visit, letter, email, SMS, note) with direction (inbound/outbound)\n- Tasks (pending, in-progress, completed, overdue)\n\n**Specialized Case Types:**\n\n*Repair:*\n- SOR code/description, trade, operative assignment\n- Appointment scheduling with slots\n- First-time fix tracking, satisfaction scores\n- Awaab's Law timers (emergency/significant deadlines)\n- Recurrence risk scoring\n\n*Complaint:*\n- Stage 1/2 with acknowledgement and response deadlines\n- Finding (upheld/partially-upheld/not-upheld)\n- Ombudsman escalation tracking\n\n*ASB (Anti-Social Behaviour):*\n- Severity: cat-1, cat-2, cat-3\n- Escalation: warning, ABC, CPW, CPN, injunction, possession, closure\n- Evidence count, multi-agency panel flag\n- Legal action probability\n\n*Damp & Mould:*\n- Hazard classification (emergency/significant/non-urgent)\n- Moisture, humidity, temperature environmental data\n- Linked repairs tracking\n- Awaab's Law timers\n\n**Financial:**\n- RentTransaction (charge, payment, adjustment, HB, UC)\n- ServiceCharge (weekly amount, annual budget, apportionment)\n- FinancialCase (arrears tracking, payment arrangements, pre-action checklists)\n\n**Compliance Certificates:**\n- Type: gas, electrical, fire, asbestos, legionella, lift\n- Contractor verification with registration numbers\n\n**Allocations & Lettings:**\n- VoidProperty (stage, daysVoid, rent loss, target let date)\n- Applicant (band A-D, bedroom need, local connection)\n\n**Communications:**\n- Channel: email, phone, letter, SMS, portal, govuk-notify\n- Direction: inbound/outbound\n- AI categorization with sentiment analysis\n- Delivery tracking (sending, delivered, permanent-failure, temporary-failure)\n\n**AI Entities:**\n- AiInsight (prediction, alert, recommendation, analysis with confidence scores)\n- AiAction (workflow steps with preview/edit/confirm/followup)\n- AuditEntry (comprehensive access logging)\n\n**External API Data Structures:**\n- CrimeIncident (Police.uk)\n- DeprivationProfile (IMD deciles, income, employment, education, health, crime, housing, living environment)\n- AreaDemographics (Census 2021 - housing tenure, household size, age breakdowns)\n- LabourMarket (NOMIS - claimant count, employment rate, job density, OOW benefits)\n- FloodAlert (DEFRA - severity zones)\n- WeatherDetail & WeatherWarning (Open-Meteo + Met Office)\n- SensorReading & SensorAlert (IoT - Switchee, Aico, HomeLync)\n- UcStatus (DWP Universal Credit)\n\n**Composite Intelligence:**\n- DampRiskBreakdown (weather factor 0.25, building factor, history factor, sensor factor, occupancy factor, overall score 0-100)\n- VulnerabilityAssessment (overall score, deprivation, arrears, health, isolation, age, dependents, UC transition factors)\n\n---\n\n## 4. API ROUTES & ENDPOINTS\n\n### 4.1 Route Registration (`server/src/index.ts`)\n\nAll API routes are registered under `/api/v1/` with authentication and rate limiting:\n\n```\n/api/v1/auth         → Auth routes (seed users, profile creation, login)\n/api/v1/ai           → AI services (drafting, intelligence, chat)\n/api/v1/admin        → Admin functions\n/api/v1/properties   → Property CRUD and queries\n/api/v1/tenants      → Tenant management\n/api/v1/cases        → Unified case management\n/api/v1/explore      → Exploratory queries\n/api/v1/briefing     → AI briefing generation\n/api/v1/compliance   → Compliance tracking\n/api/v1/rent         → Rent/financial tracking\n/api/v1/reports      → Report generation\n/api/v1/public-data  → External API proxy\n/api/v1/export       → Data export\n/api/v1/lettings     → Lettings/allocations\n/api/v1/booking      → Viewing/appointment booking\n```\n\n### 4.2 Detailed Endpoints\n\n**Auth Routes** (`/api/v1/auth`):\n```\nPOST /seed-users        → Create demo Firebase users (idempotent)\nPOST /profile           → Create user profile on first registration\nGET  /me                → Get authenticated user profile\n```\n\n**Properties Routes** (`/api/v1/properties`):\n```\nGET  /                  → List properties with filters\n                          ?regionId, ?estateId, ?blockId, ?type, ?isVoid, ?limit\nGET  /available         → Get void properties available for letting\nGET  /:id               → Get single property by ID\nPATCH /:id              → Update property\n```\n\n**Cases Routes** (`/api/v1/cases`):\n```\nGET  /                  → List cases with filters\n                          ?type, ?status, ?handler, ?priority, ?propertyId, ?tenantId\n                          ?limit (default 50), ?offset\nGET  /:id               → Get case with related activities\nPOST /                  → Create new case\nPATCH /:id              → Update case\nGET  /:id/activities    → Get activities for a case\n```\n\n**AI Routes** (`/api/v1/ai`):\n```\nPOST /draft-communication     → Generate AI communication drafts\nPOST /entity-intelligence     → Get AI predictions/alerts\nPOST /neighbourhood-context   → Neighbourhood briefing\nPOST /property-intelligence   → Property analysis\nPOST /tenant-context          → Tenant risk assessment\nPOST /chat                    → Conversational AI queries\n```\n\n**Public Data Routes** (`/api/v1/public-data`):\n- Crime data (Police.uk)\n- Weather forecasts (Open-Meteo)\n- Flood risk (DEFRA)\n- Postcode lookup (Postcodes.io)\n- IMD/deprivation data\n- Census demographics (NOMIS)\n\n---\n\n## 5. PACKAGE DEPENDENCIES\n\n### 5.1 Frontend Dependencies (`app/package.json`)\n\n**React Stack:**\n- react 19.2.0\n- react-dom 19.2.0\n- react-router-dom 6.30.3\n\n**UI & Styling:**\n- tailwindcss 4.1.18\n- @tailwindcss/vite 4.1.18\n- lucide-react 0.563.0\n\n**Data Visualization:**\n- d3 7.9.0\n- recharts 3.7.0\n- @react-three/fiber 9.5.0\n- @react-three/drei 10.7.7\n- three 0.182.0\n\n**Mapping:**\n- leaflet 1.9.4\n- react-leaflet 5.0.0\n- @types/leaflet 1.9.21\n\n**Data Management:**\n- @tanstack/react-query 5.90.20\n\n**Firebase:**\n- firebase 12.9.0\n- firebaseui 6.1.0 (requires --legacy-peer-deps)\n\n**Utilities:**\n- date-fns 4.1.0\n- clsx 2.1.1\n\n**DevDependencies:**\n- TypeScript 5.9.3\n- Vite 7.2.4\n- ESLint 9.39.1\n- React TypeScript types\n\n### 5.2 Backend Dependencies (`server/package.json`)\n\n**Core:**\n- express 4.21.2\n- node 20.17.0 (runtime)\n\n**Firebase & Firestore:**\n- firebase-admin 13.6.1\n- @google-cloud/firestore 7.11.0\n\n**Middleware:**\n- helmet 8.1.0 (security headers)\n- cors 2.8.5\n- compression 1.8.0\n- morgan 1.10.0 (HTTP request logging)\n\n**DevDependencies:**\n- TypeScript 5.7.0\n- tsx 4.19.4 (TypeScript executor)\n- Vitest 4.0.18 (test framework)\n\n---\n\n## 6. DOCUMENTATION STRUCTURE\n\n### 6.1 Requirements Documents (`/mnt/c/.netapps/socialhomes/docs/requirements/`)\n\n1. **Doc1-socialhomes-Base-Specification.txt** (35,933 bytes)\n   - Product overview\n   - 17 core functional modules\n   - Simulated organization (RCHA with 75 properties, 68 tenants, 279+ cases)\n   - 5 estates with real SE London postcodes\n   - Vision: \"Bloomberg Terminal meets Figma for social housing\"\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (40,504 bytes)\n   - System architecture\n   - Technology choices\n   - Security model\n   - Scaling considerations\n\n3. **Doc3-socialhomes-API-Requirements.txt** (28,508 bytes)\n   - 20 total integrations\n   - Tier 1 (3 free): Police.uk, Open-Meteo, DEFRA\n   - Tier 2 (6 registration): Postcodes.io, EPC Open Data, etc.\n   - Tier 3 (5+ mock): DWP, Land Registry, GoCardless, Nomis, etc.\n   - Server-side proxy pattern for ALL external APIs\n   - Cache strategies and rate limits\n\n### 6.2 Other Key Documentation\n\n- **CLAUDE.md** — Project conventions and instructions\n- **DEV-FIX-LIST.md** — Bug/warning tracker from Selenium tests\n- **DEVOPS.md** — DevOps and Cloud Run deployment guide\n- **EXECUTION-PLAN.md** — Current development priorities\n- **SESSION-HISTORY.md** — Persistent session context\n- **cloudbuild.yaml** — Cloud Build CI/CD configuration\n\n---\n\n## 7. FIRESTORE CONFIGURATION\n\n### 7.1 Firestore Security Rules (`firestore.rules`)\n\n**Authentication & Authorization:**\n- Persona-based RBAC (COO, Head of Service, Manager, Housing Officer, Operative)\n- Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n\n**Collections & Access Control:**\n```\norganisations        → read: authenticated | write: admin\nregions              → read: authenticated | write: admin\nlocalAuthorities     → read: authenticated | write: admin\nestates              → read: authenticated | write: manager+\nblocks               → read: authenticated | write: manager+\nproperties           → read: authenticated | create/update: manager+ | delete: admin\ntenants              → read: authenticated | create/update: manager+ | delete: admin\ncases                → read: authenticated | create/update: authenticated | delete: admin\nactivities           → read: authenticated | create/update: authenticated | delete: admin\ncommunications       → read: authenticated | create/update: authenticated | delete: manager+\nrentTransactions     → read: authenticated | write: manager+\nusers                → read: authenticated | create/update/delete: admin (+ self-update)\nauditLog             → read: manager+ | create: authenticated | (append-only)\nhactCodes            → read: authenticated | write: admin\nnotifications        → read: authenticated | create/update: authenticated | delete: manager+\nvoidProperties       → read: authenticated | write: manager+\napplicants           → read: authenticated | write: manager+\ntsmMeasures          → read: authenticated | write: admin\n```\n\n### 7.2 Firestore Indexes (`firestore.indexes.json`)\n\n17 composite indexes optimized for common queries:\n\n**Cases Indexes** (5):\n- type + status + createdDate\n- type + handler + createdDate\n- tenantId + createdDate\n- propertyId + createdDate\n- type + priority + createdDate\n\n**Properties Indexes** (3):\n- regionId + type\n- estateId + isVoid\n- blockId + type\n\n**Tenants Indexes** (2):\n- assignedOfficer + tenancyStatus\n- arrearsRisk (descending)\n\n**Activities Indexes** (2):\n- tenantId + date\n- caseId + date\n\n**Other Collections** (5):\n- rentTransactions: tenantId + date\n- auditLog: timestamp\n- localAuthorities: regionId\n- estates: localAuthorityId\n- blocks: estateId\n\n---\n\n## 8. DOCKER & DEPLOYMENT\n\n### 8.1 Dockerfile Structure\n\nThree-stage build for optimized production image:\n\n**Stage 1 — Build Client:**\n- Node 20 slim image\n- npm ci --legacy-peer-deps (firebaseui peer dep issue)\n- React/Vite build to dist/\n\n**Stage 2 — Build Server:**\n- Node 20 slim image\n- npm ci\n- TypeScript compilation to dist/\n\n**Stage 3 — Production:**\n- Node 20 slim base\n- Copy production dependencies only (--omit=dev)\n- Copy built client and server artifacts\n- curl for health checks\n- PORT env var (Cloud Run default 8080)\n- NODE_ENV=production\n- Starts with: `node server/dist/index.js`\n\n---\n\n## 9. SERVICES & INTEGRATIONS\n\n### 9.1 Frontend Services\n\n**ai-drafting.ts** (18 KB)\n- Template-based letter/communication generation\n- Tone/persona-aware drafting\n\n**api-client.ts** (13 KB)\n- Centralized HTTP client for all backend API calls\n- Auth token management\n- Error handling\n\n**firebase.ts** (2.6 KB)\n- Firebase client initialization\n- Auth setup\n\n**public-data.ts** (69 KB)\n- Complex public data aggregation\n- Caching logic\n- Fallback handling\n\n### 9.2 Backend Services\n\n**AI & Intelligence:**\n- **damp-prediction.ts** — ML-based damp risk scoring (weather, building, history, sensor, occupancy factors)\n- **vulnerability-detection.ts** — Tenant vulnerability scoring (deprivation, arrears, health, isolation, dependents, UC)\n- **crime-context.ts** — Police.uk crime data integration and correlation\n- **neighbourhood-briefing.ts** — Contextual briefing synthesis\n- **property-passport.ts** — Property analytics and insights\n\n**Benefits & Financial:**\n- **benefits-engine.ts** — DWP benefits eligibility assessment\n- **census-nomis.ts** — Labour market and census data aggregation\n\n**External APIs:**\n- **public-data.ts** — Server-side proxy for all external APIs\n- **govuk-notify.ts** — 45 KB template library for UK gov notifications\n- **external-api.ts** — API management and orchestration\n\n**Data & Persistence:**\n- **firestore.ts** — Core Firestore operations (getDocs, setDoc, updateDoc, etc.)\n- **firebase-admin.ts** — Firebase Admin SDK initialization\n- **hact-export.ts** — Housing Act compliance export\n\n**Mock/Simulation:**\n- **mock-services.ts** — Realistic simulated data for Tier 3 APIs (UC, GoCardless, Land Registry, etc.)\n- **seed-data.ts** — 28 KB dataset generation\n- **seed.ts** — Database seeding\n\n**Monitoring:**\n- **monitoring.ts** — Metrics collection\n\n---\n\n## 10. KEY ARCHITECTURAL PATTERNS\n\n1. **Server-Side Proxy Pattern** — All external APIs called from Express backend, frontend communicates only with own backend\n\n2. **Persona-Based RBAC** — Every operation gated by persona level (COO > Head of Service > Manager > Housing Officer > Operative)\n\n3. **Unified Case System** — Repairs, complaints, ASB, damp, financial all use same Case model with specialized subtypes\n\n4. **Layered Intelligence** — Damp, vulnerability, crime risk calculated from multiple weighted factors (environmental, historical, sensor, contextual)\n\n5. **Simulated Fallback** — All Tier 3 (paid) APIs have mock implementations returning realistic data when real API unavailable\n\n6. **Firestore Optimization** — In-memory filtering/sorting for small datasets (<1000 docs) to avoid composite index complexity\n\n---\n\n## 11. SUMMARY STATISTICS\n\n- **Frontend Pages:** 20 main pages across 17 feature areas\n- **Shared Components:** 12 reusable UI components\n- **Backend Routes:** 13 route files with ~40+ endpoints\n- **Backend Services:** 19 specialized services\n- **Total Integrations:** 20 (3 live free + 6 live registration + 11+ mock)\n- **Data Model:** 40+ TypeScript types covering all domain entities\n- **Firestore Collections:** 18 collections with 17 composite indexes\n- **Demo Data:** 75 properties, 68 tenants, 279+ cases across 5 estates\n\n---\n\nThis comprehensive exploration captures the complete architecture, data model, API surface, deployment configuration, and integration landscape of the SocialHomes.Ai platform. The project is a sophisticated, production-ready social housing management system with advanced AI capabilities, real external data integrations, and professional-grade infrastructure."}],"totalDurationMs":87816,"totalTokens":59481,"totalToolUseCount":35,"usage":{"input_tokens":7,"cache_creation_input_tokens":2653,"cache_read_input_tokens":50221,"output_tokens":6600,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2653,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"8e3cb291-01e8-4b62-945f-004556fa4a67"}
{"parentUuid":"db8c2660-816a-4a99-a4eb-4ce12907ba6f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01Ccn9XwmX2mgaRAK7GDvCKZ","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the existing docs/requirements files to understand what was already created:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":16579,"cache_read_input_tokens":73032,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":16579},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKLDyfZsFKDZhCFHtVq","type":"assistant","uuid":"0edbafaa-538c-4f37-b2a1-9e76dcb06c4e","timestamp":"2026-02-26T07:51:51.984Z"}
{"parentUuid":"0edbafaa-538c-4f37-b2a1-9e76dcb06c4e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01Ccn9XwmX2mgaRAK7GDvCKZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01U7NcEYX3meLY4vV4RpGYiC","name":"Bash","input":{"command":"ls -la /mnt/c/.netapps/socialhomes/docs/requirements/ 2>/dev/null && wc -l /mnt/c/.netapps/socialhomes/docs/requirements/*.txt 2>/dev/null || echo \"Directory does not exist or is empty\"","description":"Check existing docs/requirements directory"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":16579,"cache_read_input_tokens":73032,"output_tokens":159,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":16579,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWKLDyfZsFKDZhCFHtVq","type":"assistant","uuid":"598ca9c2-2e17-4020-837d-1e777d41df13","timestamp":"2026-02-26T07:51:53.241Z"}
{"parentUuid":"598ca9c2-2e17-4020-837d-1e777d41df13","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01U7NcEYX3meLY4vV4RpGYiC","type":"tool_result","content":"total 104\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 19:38 .\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 18 11:54 ..\n-rwxrwxrwx 1 rajiv rajiv 35933 Feb 25 19:32 Doc1-socialhomes-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 40504 Feb 25 19:35 Doc2-socialhomes-Technical-Architecture.txt\n-rwxrwxrwx 1 rajiv rajiv 28508 Feb 25 19:38 Doc3-socialhomes-API-Requirements.txt\n   802 /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt\n   966 /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt\n   775 /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt\n  2543 total","is_error":false}]},"uuid":"3cbb2304-8a25-43e9-8d8f-f585cb5afe75","timestamp":"2026-02-26T07:51:53.446Z","toolUseResult":{"stdout":"total 104\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 25 19:38 .\ndrwxrwxrwx 1 rajiv rajiv  4096 Feb 18 11:54 ..\n-rwxrwxrwx 1 rajiv rajiv 35933 Feb 25 19:32 Doc1-socialhomes-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 40504 Feb 25 19:35 Doc2-socialhomes-Technical-Architecture.txt\n-rwxrwxrwx 1 rajiv rajiv 28508 Feb 25 19:38 Doc3-socialhomes-API-Requirements.txt\n   802 /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt\n   966 /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt\n   775 /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt\n  2543 total","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"598ca9c2-2e17-4020-837d-1e777d41df13"}
{"parentUuid":"3cbb2304-8a25-43e9-8d8f-f585cb5afe75","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01Nbj5DohdhFpVdqytPeusQD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AatQ2vN8ufwmvE4nokV5DG","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","limit":100},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":672,"cache_read_input_tokens":89611,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":672},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKLYHFSjZJYDU31Sbd5","type":"assistant","uuid":"1ad984a1-89a2-4a0b-89f0-ab9a705d4c15","timestamp":"2026-02-26T07:51:56.656Z"}
{"parentUuid":"1ad984a1-89a2-4a0b-89f0-ab9a705d4c15","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AatQ2vN8ufwmvE4nokV5DG","type":"tool_result","content":"     1→================================================================================\n     2→  Doc1 — SocialHomes.Ai Base Specification\n     3→  Version: 6.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. PRODUCT OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Product Name\n    11→    SocialHomes.Ai\n    12→\n    13→1.2 Tagline\n    14→    AI-native social housing management for UK housing associations.\n    15→    Secondary: \"AI-native. Human-assured.\"\n    16→\n    17→1.3 Vision\n    18→    To be the first truly AI-native housing management system that embeds\n    19→    predictive intelligence, automation, and contextual assistance into every\n    20→    screen, workflow, and decision — transforming reactive housing operations\n    21→    into proactive, data-driven housing management.\n    22→\n    23→    This is NOT a legacy system with a fresh coat of paint. This must look and\n    24→    feel like nothing the social housing sector has ever seen — think Bloomberg\n    25→    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    26→    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    27→    is the opposite: dark, fast, visually stunning, animated, intelligent.\n    28→\n    29→1.4 Target Market\n    30→    UK Social Housing Providers:\n    31→    - Housing Associations (Registered Providers)\n    32→    - Local Authority housing departments\n    33→    - ALMOs (Arms Length Management Organisations)\n    34→    Typical scale: 5,000-20,000 housing units across multiple regions.\n    35→\n    36→1.5 Simulated Organisation\n    37→    Name:           Riverside Crescent Housing Association (RCHA)\n    38→    RP Number:      4567\n    39→    Regulatory:     G1/V1\n    40→    HQ:             Southwark\n    41→    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    42→    Stock:          75 properties, 68 tenants, 279+ cases\n    43→    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    44→    UPRNs:          Realistic 12-digit references\n    45→    EPCs:           Mapped to real certificates where available\n    46→\n    47→    5 Estates:\n    48→    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    49→    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    50→    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    51→    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    52→    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n    53→\n    54→1.6 Built By\n    55→    Yantra Works — an AI-native development studio.\n    56→\n    57→1.7 Live Deployment\n    58→    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    59→    Region:         europe-west2 (London)\n    60→    Status:         LIVE and operational\n    61→    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n    62→\n    63→\n    64→2. CORE FUNCTIONAL MODULES (17 modules)\n    65→================================================================================\n    66→\n    67→2.1 Dashboard\n    68→    Route: /dashboard\n    69→    Purpose: Real-time operational overview with persona-scoped KPIs\n    70→    Features:\n    71→    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n    72→      arrears, compliance %, open complaints, AI alerts)\n    73→    - KPI trend sparklines (12 months)\n    74→    - Charts row: rent collection 12-month trend vs 97% target;\n    75→      repairs monthly volume by priority with avg days line\n    76→    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n    77→      with countdown timers | AI insights scrolling feed\n    78→    - Activity timeline with real-time system event feed\n    79→    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    80→    - Quick action buttons for common tasks\n    81→\n    82→2.2 Visual Drill-Down Explorer (Flagship Feature)\n    83→    Route: /explore\n    84→    Purpose: 7-level spatial hierarchy navigation\n    85→    Hierarchy:\n    86→      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n    87→\n    88→    Layout:\n    89→    +--------------------------------+---------------------------------+\n    90→    |                                |  CONTEXT PANEL (scrollable)     |\n    91→    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    92→    |                                |  - Attribute cards               |\n    93→    |      Interactive Leaflet map   |  - Compliance status             |\n    94→    |      OR Three.js 3D building   |  - KPI metrics                   |\n    95→    |      depending on zoom level   |  - AI insights (purple section)  |\n    96→    |                                |  - Children list (next level)    |\n    97→    |                                |  - Quick actions                  |\n    98→    +--------------------------------+---------------------------------+\n    99→    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n   100→    | Data layer toggles: Crime / Damp Risk / Compliance               |"}]},"uuid":"8fc8d910-f9e9-4e5b-b9eb-8d2d295ce56f","timestamp":"2026-02-26T07:51:56.710Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |","numLines":100,"startLine":1,"totalLines":803}},"sourceToolAssistantUUID":"1ad984a1-89a2-4a0b-89f0-ab9a705d4c15"}
{"parentUuid":"8fc8d910-f9e9-4e5b-b9eb-8d2d295ce56f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01Nbj5DohdhFpVdqytPeusQD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015uiqPq9Rx5dtzjRLvkWJLV","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","limit":100},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":672,"cache_read_input_tokens":89611,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":672},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKLYHFSjZJYDU31Sbd5","type":"assistant","uuid":"62acbdb6-a936-4ca1-9f33-ef8a1d0e01f7","timestamp":"2026-02-26T07:51:57.278Z"}
{"parentUuid":"62acbdb6-a936-4ca1-9f33-ef8a1d0e01f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015uiqPq9Rx5dtzjRLvkWJLV","type":"tool_result","content":"     1→================================================================================\n     2→  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n     3→  Version: 6.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. SYSTEM ARCHITECTURE OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Architecture Style\n    11→    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    12→    deployed as a single container on Google Cloud Run. The Express server\n    13→    serves both the API and the built React static assets.\n    14→\n    15→1.2 High-Level Architecture Diagram (ASCII)\n    16→\n    17→    +-------------------------------------------------------------+\n    18→    |                        CLOUD RUN (europe-west2)              |\n    19→    |  +-----------------------------------------------------------+\n    20→    |  |                    Express.js Server                      |\n    21→    |  |  +--------------+  +--------------+  +---------------+   |\n    22→    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    23→    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    24→    |  |  |              |  |              |  | Rate Limit/   |   |\n    25→    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    26→    |  |  | Output       |  | modules      |  |               |   |\n    27→    |  |  +--------------+  +------+-------+  +---------------+   |\n    28→    |  +---------------------------+-------------------------------+\n    29→    |                              |                                |\n    30→    |  +---------------------------+-------------------------------+\n    31→    |  |                    Service Layer (25 modules)             |\n    32→    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    33→    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    34→    |  |  | Services| | API      | | Notify   | | Services    |   |\n    35→    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    36→    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    37→    |  +---------------------------+-------------------------------+\n    38→    +------------------------------+--------------------------------+\n    39→                                   |\n    40→              +--------------------+--------------------+\n    41→              |                    |                     |\n    42→    +---------v------+  +---------v------+  +----------v-----+\n    43→    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    44→    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    45→    +----------------+  +----------------+  +----------------+\n    46→              |\n    47→    +---------v--------------------------------------------+\n    48→    |              External APIs (3 Tiers)                 |\n    49→    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    50→    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    51→    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    52→    +------------------------------------------------------+\n    53→\n    54→1.3 Request Flow Diagram\n    55→\n    56→    Browser -> React SPA -> api-client.ts -> HTTP Request\n    57→                                              |\n    58→                                              v\n    59→    Express Server <- Middleware Pipeline <- Route Handler\n    60→         |               |\n    61→         |     +-------------------------------------------+\n    62→         |     | Morgan -> Helmet -> CORS -> Compression   |\n    63→         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n    64→         |     | -> Rate Limiter -> Metrics -> Handler     |\n    65→         |     | -> Error Handler -> Response               |\n    66→         |     +-------------------------------------------+\n    67→         |\n    68→         +---> Firestore (read/write)\n    69→         +---> External API Proxy (with cache)\n    70→         +---> AI Service (computation)\n    71→\n    72→\n    73→2. TECHNOLOGY STACK\n    74→================================================================================\n    75→\n    76→2.1 Frontend Stack\n    77→\n    78→    | Component          | Technology              | Version    |\n    79→    |--------------------|-------------------------|------------|\n    80→    | Framework          | React                   | 19.2.0     |\n    81→    | Language           | TypeScript              | 5.9.3      |\n    82→    | Router             | React Router            | v7         |\n    83→    | Styling            | Tailwind CSS            | 4.1.18     |\n    84→    | State Management   | React Context + Hooks   | --         |\n    85→    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    86→    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    87→    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    88→    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    89→    | Icons              | Lucide React            | 0.563.0    |\n    90→    | Auth UI            | FirebaseUI              | latest     |\n    91→    | Build Tool         | Vite                    | 7.2.4      |\n    92→\n    93→2.2 Backend Stack\n    94→\n    95→    | Component          | Technology              | Version    |\n    96→    |--------------------|-------------------------|------------|\n    97→    | Framework          | Express.js              | 4.21.2     |\n    98→    | Language           | TypeScript              | 5.7.0      |\n    99→    | Runtime            | Node.js                 | 20.17.0    |\n   100→    | Database           | Google Firestore        | Native     |"}]},"uuid":"48ddd674-0afc-4ec9-ae9c-ff1ac8ea8258","timestamp":"2026-02-26T07:51:57.345Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |","numLines":100,"startLine":1,"totalLines":967}},"sourceToolAssistantUUID":"62acbdb6-a936-4ca1-9f33-ef8a1d0e01f7"}
{"parentUuid":"48ddd674-0afc-4ec9-ae9c-ff1ac8ea8258","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01Nbj5DohdhFpVdqytPeusQD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VZi2XQL98tAU42w8yreYq5","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","limit":100},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":672,"cache_read_input_tokens":89611,"output_tokens":264,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":672,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWKLYHFSjZJYDU31Sbd5","type":"assistant","uuid":"73b78091-e788-4ddc-bf9f-be3261ea2795","timestamp":"2026-02-26T07:51:57.849Z"}
{"parentUuid":"73b78091-e788-4ddc-bf9f-be3261ea2795","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VZi2XQL98tAU42w8yreYq5","type":"tool_result","content":"     1→================================================================================\n     2→  Doc3 — SocialHomes.Ai API & Integration Requirements\n     3→  Version: 6.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. API OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 API Strategy\n    11→    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    12→    integrations. The React frontend communicates exclusively with the Express\n    13→    backend, which handles external calls, caching, rate limiting, and\n    14→    graceful degradation.\n    15→\n    16→1.2 Integration Tiers\n    17→\n    18→    TIER 1 — Free, No API Key Required\n    19→    Publicly available APIs with no registration needed.\n    20→    Status: LIVE with real data\n    21→\n    22→    TIER 2 — Free, Registration Required\n    23→    APIs requiring account creation or key registration.\n    24→    Status: LIVE with real data (where keys available) + simulated fallbacks\n    25→\n    26→    TIER 3 — Subscription/Paid APIs\n    27→    Commercial APIs requiring contracts or paid subscriptions.\n    28→    Status: MOCK endpoints with realistic simulated data\n    29→\n    30→1.3 Current Integration Count\n    31→    Total: 20 integrations\n    32→    - Tier 1: 3 live\n    33→    - Tier 2: 6 live (with simulated fallbacks)\n    34→    - Tier 3: 5 mock services + 6 planned\n    35→\n    36→\n    37→2. TIER 1 INTEGRATIONS (Free, No Key)\n    38→================================================================================\n    39→\n    40→2.1 Police.uk — Street-Level Crime Data\n    41→    Status: LIVE\n    42→    Base URL: https://data.police.uk/api\n    43→    Documentation: https://data.police.uk/docs/\n    44→\n    45→    Endpoints Used:\n    46→    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    47→    - GET /crimes-at-location?location_id={id}\n    48→    - GET /outcomes-at-location?location_id={id}\n    49→\n    50→    Server Route: GET /api/v1/public-data/police/:postcode\n    51→    Cache TTL: 24 hours\n    52→    Rate Limit: 15 req/sec (fair-use)\n    53→    Fallback: Simulated crime data matching postcode area\n    54→\n    55→    Used By:\n    56→    - D2: Live Crime Context for ASB (crime-context.ts)\n    57→    - Explore page crime data layer\n    58→    - ASB case correlation\n    59→    - Neighbourhood Briefing crime section\n    60→\n    61→    Data Returned:\n    62→    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    63→    - Month, location (lat/lng), outcome status\n    64→    - 12-month historical data per location\n    65→\n    66→2.2 Open-Meteo — Weather Forecasting\n    67→    Status: LIVE\n    68→    Base URL: https://api.open-meteo.com/v1\n    69→    Documentation: https://open-meteo.com/en/docs\n    70→\n    71→    Endpoints Used:\n    72→    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n    73→          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n    74→          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n    75→          &timezone=Europe/London\n    76→\n    77→    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    78→    Cache TTL: 1 hour\n    79→    Rate Limit: 10,000 req/day (no key needed)\n    80→    Fallback: Static weather for London SE\n    81→\n    82→    Used By:\n    83→    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    84→    - AI Morning Briefing (weather section)\n    85→    - Neighbourhood Briefing (environmental context)\n    86→    - Property impact assessment\n    87→\n    88→    Data Returned:\n    89→    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    90→    - Daily: max/min temperature, precipitation sum\n    91→    - 7-day forecast + current conditions\n    92→\n    93→2.3 DEFRA Flood Risk API\n    94→    Status: LIVE\n    95→    Base URL: https://environment.data.gov.uk/flood-monitoring\n    96→    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n    97→\n    98→    Endpoints Used:\n    99→    - GET /id/floods?lat={lat}&long={lng}&dist=3\n   100→    - GET /id/stations?lat={lat}&long={lng}&dist=3"}]},"uuid":"0b7aef19-431b-493b-867a-725f38bfeb62","timestamp":"2026-02-26T07:51:57.909Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3","numLines":100,"startLine":1,"totalLines":776}},"sourceToolAssistantUUID":"73b78091-e788-4ddc-bf9f-be3261ea2795"}
{"parentUuid":"0b7aef19-431b-493b-867a-725f38bfeb62","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01F5s2y35ekhTgowD5F725Ug","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01G3kpCuDdCEhRjnySPLEaMp","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4930,"cache_read_input_tokens":90283,"output_tokens":304,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":4930,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWKLsFGUgsWKkQgV5afm","type":"assistant","uuid":"9c07751e-0683-489f-bcb2-7257039b8d76","timestamp":"2026-02-26T07:52:04.187Z"}
{"parentUuid":"9c07751e-0683-489f-bcb2-7257039b8d76","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01G3kpCuDdCEhRjnySPLEaMp","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"2500a477-016f-4285-9694-5589e2e2d8cc","timestamp":"2026-02-26T07:52:04.195Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"in_progress","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification","status":"pending","activeForm":"Creating Doc1 - Base Specification"},{"content":"Create Doc2 - Technical Architecture","status":"pending","activeForm":"Creating Doc2 - Technical Architecture"},{"content":"Create Doc3 - API Requirements","status":"pending","activeForm":"Creating Doc3 - API Requirements"},{"content":"Create EXECUTION-PLAN.md with all 5 phases","status":"pending","activeForm":"Creating EXECUTION-PLAN.md with all 5 phases"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"9c07751e-0683-489f-bcb2-7257039b8d76"}
{"parentUuid":"2500a477-016f-4285-9694-5589e2e2d8cc","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01VUsmfTSM9uq3RMM6tNyWdZ","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent. I've now completed a thorough analysis of the entire project. I have full context from:\n- 3 original specification docs at project root (Doc1, Doc2, Doc3)\n- Doc4 UI/UX Audit\n- Existing docs/requirements/ v6.0 specs\n- Full codebase exploration (types, routes, services, middleware, models)\n- EXECUTION-PLAN.md v6.0 with Phases 0-5\n- SESSION-HISTORY.md (10 sessions)\n- DEV-FIX-LIST.md (all resolved)\n- DEVOPS.md, Dockerfile, firestore configs\n\nNow I'll create the comprehensive v7.0 specification documents. Let me write all three docs in parallel:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":95213,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKMPMkVWiPmdExmAySL","type":"assistant","uuid":"2268f59f-03a8-4afc-8d17-e75c42466de5","timestamp":"2026-02-26T07:52:11.648Z"}
{"parentUuid":"2268f59f-03a8-4afc-8d17-e75c42466de5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01VUsmfTSM9uq3RMM6tNyWdZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BaH5B2xQSit2TZ1KKWJnq7","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  Product Overview\n  2.  Core Functional Modules (17)\n  3.  Visual Drill-Down Explorer (Flagship)\n  4.  Persona System (5 Personas)\n  5.  AI-Native Features\n  6.  Predictive Intelligence Engine (8 Models)\n  7.  Seven Killer Differentiators\n  8.  Data Model Summary\n  9.  UI/UX Design Language\n  10. Regulatory & Compliance Framework\n  11. Non-Functional Requirements\n  12. Simulated Data & Demo Environment\n  13. Current Implementation Status\n  14. Future Roadmap (Phase 5+)\n\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15)\n       - 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1)\n       - 2 blocks, 48 flats, 2005 new build, higher-risk building (≥18m)\n    3. Elm Gardens (SE13)\n       - Street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6)\n       - 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24)\n       - 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n    GCP Project:    gen-lang-client-0878518473 (number: 587984201316)\n    Firebase:       gen-lang-client-0146156913\n\n1.8 Open Source\n    SocialHomes.Ai is an open-source project by Yantra Works.\n    Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard (/dashboard)\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards: Properties (12,847), Tenancies (12,103), Active Repairs (487),\n      Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293),\n      Compliance (98.7%), Open Complaints (34), AI Alerts (12)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap (6 tiles, % + RAG) |\n      Awaab's Law active cases with countdown timers |\n      AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (/explore) — FLAGSHIP\n    See Section 3 for full specification.\n\n2.3 AI Morning Briefing (/briefing)\n    Purpose: Personalised daily briefing on login\n    Features:\n    - Full-screen animated intro with Yantra mark\n    - Weather and environmental context for the day\n    - URGENT items with countdown timers\n    - TODAY'S TASKS: appointments, calls, letters, case reviews\n    - AI PREDICTIONS: what the model expects this week\n    - PATCH/PORTFOLIO SNAPSHOT: key numbers with trend arrows\n    - Estate selector with Neighbourhood Briefing panel\n    - [Start my day →] button to dashboard\n    - [Skip briefing] option\n\n2.4 Tenancies (/tenancies, /tenancies/:id, /tenancies/new)\n    Purpose: Full tenancy lifecycle management\n    Features:\n    - List view: search, filter (status, tenure, officer), sort, pagination\n    - Detail page (tabbed):\n      * Overview: tenant name, DOB, contact, household, emergency contact,\n        assigned officers, vulnerability flags, key dates, tenure type/status\n      * Cases: unified case timeline (filterable by type) — Complaint (CMP),\n        Repair (REP), ASB (ASB), Enquiry (ENQ), Financial (FIN),\n        Safeguarding (SAF), Damp/Mould (DAM)\n      * Activities: chronological log — calls, visits, letters, emails, SMS\n      * Tasks: outstanding/completed with due date, priority, linked case\n      * Statement (Rent Account): balance, weekly charge, payment method,\n        UC/HB status, rent breakdown, transaction ledger, 52-week statement,\n        balance trend chart, payment arrangement tracker\n      * Orders: Rent Order, Tenure Type, Service Charge, Garage/Parking,\n        Rechargeable Repair, Court Order, Leaseholder\n    - Vulnerability Panel (AI: 7-factor assessment)\n    - Benefits Panel (AI: UK entitlement analysis)\n    - AI dynamic actions zone\n\n2.5 Properties (/properties, /properties/:uprn)\n    Purpose: Asset management with spatial awareness\n    Features:\n    - List/map toggle view\n    - Mini Leaflet map in list view\n    - Detail page (tabbed):\n      * Overview: address, UPRN, type, bedrooms, floor area, heating, tenure,\n        current tenancy or void status, photos, accessibility features\n      * Compliance (unit-level): Gas Safety (CP12), EICR, EPC, Smoke & CO,\n        unit-specific asbestos, boiler details, Decent Homes assessment\n      * Stock Condition: component lifecycle table (roof, windows, kitchen,\n        bathroom, boiler, electrics — install year, condition 1-5, remaining\n        life, replacement cost)\n      * Damp & Mould / Awaab's Law: AI risk score 0-100, active cases with\n        countdown timers, IoT sensor data (simulated)\n      * Works History: all repairs/works with costs, annual spend trend\n      * Documents: certificates, reports, photos\n    - Damp Intelligence Panel (AI: 5-factor weighted algorithm)\n    - Property Passport (AI: multi-source aggregation)\n\n2.6 Repairs (/repairs, /repairs/:id, /repairs/new, /repairs/schedule)\n    Purpose: Full repairs management lifecycle\n    Features:\n    - List/Kanban toggle view\n    - Columns: ref, date, property, SOR category, priority, status,\n      operative, target date, days elapsed\n    - Kanban: status columns with priority colour borders\n    - New repair wizard: property lookup → free-text description →\n      AI auto-suggests SOR code/priority/trade/Awaab's Law flags →\n      appointment booking → risk assessment → confirm\n    - Detail page: priority-based SLA timer, SOR code, trade, appointment,\n      risk assessment, operative notes, photos before/during/after,\n      materials, satisfaction survey, first-time fix, Awaab's Law compliance\n    - Schedule: weekly calendar, operative schedules, capacity indicators\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - AI: root cause analysis, recurrence prediction, cost comparison\n\n2.7 Rent & Income (/rent, /rent/accounts, /rent/accounts/:id, /rent/arrears)\n    Purpose: Financial management and arrears recovery\n    Features:\n    - Arrears dashboard: total, by band (chart), collection rate gauge,\n      payment method breakdown\n    - AI-prioritised worklist: tenant details, arrears amount, 12-week\n      sparkline, AI score (1-100), risk factors, recommended action\n    - Account detail: statement view, transaction ledger\n    - UC tracking integration\n    - Sub-routes: accounts list, individual statements, arrears worklist\n\n2.8 Compliance (/compliance, /compliance/gas, /compliance/electrical,\n    /compliance/fire, /compliance/asbestos, /compliance/legionella,\n    /compliance/lifts, /compliance/awaabs-law)\n    Purpose: Big 6 regulatory compliance management\n    Features:\n    - Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n    - Per-area pages: certificate list, filters, no-access tracker,\n      contractor performance\n    - Awaab's Law page: active cases with timers, risk register (all\n      properties with AI scores), proactive inspection programme\n    - Data layer toggles on Explore map\n\n2.9 Complaints (/complaints, /complaints/:id, /complaints/new)\n    Purpose: Two-stage complaint handling per Housing Ombudsman Code\n    Features:\n    - Dashboard: Stage 1/2 counts, response % vs timescale,\n      TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n    - New: tenant selection → free-text → AI categorises/assigns severity →\n      handler assignment → auto-acknowledgement\n    - Detail: two-stage timeline with countdown timers\n      (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD)\n    - Category, findings (upheld/partial/not), remedy, learning log,\n      Ombudsman escalation tracking\n\n2.10 Allocations (/allocations, /allocations/voids, /allocations/lettings)\n    Purpose: Housing register & lettings management\n    Features:\n    - Housing register: applicants by band (A-D), bedroom need, medical priority\n    - Void kanban: Notice → Keys → Inspection → Works → Quality → Ready →\n      Offer → Let\n    - Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n    - Lettings: available properties with viewing booking\n\n2.11 ASB (/asb, /asb/:id)\n    Purpose: Anti-social behaviour case management\n    Features:\n    - Case list: ref, location, category, severity, status, handler, days open\n    - Detail: escalation pipeline visual tracker\n      (Warning → ABC → CPW → CPN → Injunction → Possession → Closure)\n    - Evidence log, multi-agency panel, risk assessment, Community Trigger check\n    - Crime context overlay from Police.uk data\n\n2.12 Communications (/communications, /communications/templates)\n    Purpose: Unified multi-channel communications hub\n    Features:\n    - Unified inbox: all channels linked to tenant/property/case\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - 5 message types with action buttons (Reply/Forward/Archive)\n    - GOV.UK Notify template manager (24 templates, 7 categories)\n    - Channels: email, phone, letter, SMS, portal, GOV.UK Notify\n\n2.13 Reports (/reports, /reports/tsm, /reports/core, /reports/regulatory,\n    /reports/ombudsman, /reports/performance, /reports/financial,\n    /reports/stock-condition)\n    Purpose: Comprehensive reporting and regulatory returns\n    Sub-pages:\n    - TSM Annual Return (22 measures with actuals, targets, sector medians)\n    - CORE Lettings/Sales Logs (field validation, CSV export)\n    - Consumer Standards Self-Assessment (4 standards, evidence mapping)\n    - Complaint Handling Code Self-Assessment\n    - Building Safety Act Returns (higher-risk buildings)\n    - SDR for RSH\n    - Operational Performance (repairs, voids, arrears, complaints, ASB, contact)\n    - Financial (rent setting, service charge, repairs expenditure, bad debt, void loss)\n    - Stock Condition (quarterly/annual)\n    - Dynamic report page with 27+ reports\n    Features:\n    - Date range, property group, tenure type, comparison period\n    - CSV/PDF export\n    - Drill-down from aggregates\n    - Benchmarking vs targets/previous/sector\n    - AI-generated narrative summary\n    - Scheduled email distribution\n\n2.14 AI Centre (/ai, /ai/insights, /ai/predictions, /ai/assistant)\n    Purpose: Central hub for AI capabilities\n    Features:\n    - Insights feed: predictions, alerts, recommendations, analytics\n      with confidence %, affected entities, action buttons\n    - Predictions dashboard: Arrears (scatter + top 50 + feature importance),\n      Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n    - Differentiators tab: 6 feature cards + vulnerability scan\n    - Assistant: chat panel with natural language queries\n\n2.15 Admin (/admin, /admin/organisation, /admin/users, /admin/teams,\n    /admin/workflows, /admin/integrations, /admin/audit, /admin/system)\n    Purpose: Full system administration suite\n    Sub-pages:\n    - Dashboard: system health, user activity, data quality, integration\n      status, AI model health\n    - Organisation: profile, branding, operational parameters\n    - Users: RBAC with 10 roles × permissions, custom roles, 2FA, sessions\n    - Teams: hierarchies, patch definition (map/postcode), caseload balancing\n    - Workflows: visual builder with triggers/conditions/actions/SLA timers,\n      pre-built templates\n    - Integrations: 20 integration cards with status, last sync, toggle,\n      test connection, tier badges, cache hit rate bars\n    - Audit: full trail, GDPR tools (SAR, erasure, retention, consent)\n    - System: reference data, form builder, notification config, AI config\n\n2.16 Tenant Portal (/tenant-portal, /tenant-portal/repairs,\n    /tenant-portal/rent, /tenant-portal/documents, /tenant-portal/contact)\n    Purpose: Tenant self-service with distinct warmer UI\n    Features:\n    - Visually distinct: lighter/warmer theme, simpler layout, larger text,\n      no jargon, large touch targets\n    - Dashboard: welcome, quick actions (report repair, check balance,\n      make payment, contact), active repairs, rent balance, appointments\n    - Report repair: conversational wizard — room → problem → sub-category →\n      photo → appointment → confirm. AI urgency detection.\n    - Rent: clear balance, simple transactions, payment button\n    - Quick message form with select/textarea\n\n2.17 Global Search (/search)\n    Purpose: Cross-entity search with instant results\n    Features:\n    - Search bar: dark input, magnifying glass, placeholder text\n    - Results grouped by entity type (tenant, property, case)\n    - Click-through to entity detail\n    - AI-enhanced relevance ranking\n\n\n3. VISUAL DRILL-DOWN EXPLORER (Flagship Feature)\n================================================================================\n\n3.1 Concept\n    The PRIMARY navigation experience. Users visually navigate from Country →\n    Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every\n    level, the right panel shows that level's attributes, KPIs, compliance,\n    and AI insights.\n\n3.2 Layout\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - AI dynamic actions (Doc 2)    |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n3.3 Hierarchy Levels\n\n    Level 0: Country (/explore/country)\n    - Map: England centred (~52.5°N, 1.5°W, zoom 6)\n    - 3 operational regions with property count badges\n    - Panel: portfolio summary — total units, occupancy, compliance %,\n      total arrears, collection rate, TSM headlines, regional breakdown,\n      regulatory status (G1/V1), stock by tenure type (pie chart)\n\n    Level 1: Region (/explore/region/:id)\n    - Map: zoomed to region (e.g. London, zoom 10)\n    - LA areas as markers sized by stock count, coloured by compliance\n    - Panel: compliance, arrears, voids, repairs backlog, LA breakdown,\n      stock profile, average EPC distribution\n\n    Level 2: Local Authority (/explore/region/:id/la/:id)\n    - Map: zoom 13, estates as clusters/polygons with mini-donut compliance\n    - Panel: properties, tenancies, voids, Big 6 compliance, estates list,\n      LA context (housing market, LHA rates, nomination agreements)\n\n    Level 3: Estate (/explore/.../estate/:id)\n    - Map: zoom 16-17, individual buildings as footprints (green/amber/red)\n    - Panel: estate name, postcode, construction era, total units\n    - KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases\n    - Buildings list, estate management, communal areas, scheme type\n    - Neighbourhood Briefing Panel integrated\n\n    Level 4: Block / Building (/explore/.../block/:id)\n    - TRANSITION TO 3D VIEW: Three.js procedurally generated building\n    - Rotate/zoom/pan with OrbitControls\n    - BUILDING-LEVEL ATTRIBUTES (not unit-level):\n      * Fire Risk Assessment: date, risk level, action plan status\n      * Building Safety Case (if higher-risk): accountable person, BSR\n      * Communal fire systems: detection, emergency lighting, compartmentation\n      * Asbestos management plan: building-level register\n      * Legionella risk assessment: water system, tanks, TMVs\n      * Structural surveys, roof, communal heating, lifts (LOLER), entry\n    - Units list: number, floor, bedrooms, tenure, occupancy, RAG\n\n    Level 4a: Core / Entrance (/explore/.../core/:id)\n    - For buildings with multiple cores (e.g. tower blocks)\n    - Schematic floor plan showing units per floor for this core\n    - Panel: core ID, floors served, units, stairwell, lift, fire escape\n\n    Level 5: Unit (/explore/.../unit/:id)\n    - 3D: highlighted unit within building model\n    - Panel (tabbed): Overview, Compliance (unit-level), Stock Condition,\n      Damp & Mould / Awaab's Law, Works History, Documents\n\n    Level 6: Tenant (/explore/.../tenant/:id)\n    - Panel (tabbed): Overview, Cases (unified timeline), Activities,\n      Tasks, Statement (Rent Account), Orders\n    - Case types with colour-coded references:\n      | Complaint  | CMP-YYYY-XXXXX | Orange |\n      | Repair     | REP-YYYY-XXXXX | Blue   |\n      | ASB        | ASB-YYYY-XXXXX | Red    |\n      | Enquiry    | ENQ-YYYY-XXXXX | Grey   |\n      | Financial  | FIN-YYYY-XXXXX | Amber  |\n      | Safeguarding | SAF-YYYY-XXXXX | Purple |\n      | Damp/Mould | DAM-YYYY-XXXXX | Teal   |\n\n    Level 7: Case Detail\n    - Common layout for all case types:\n      +----------------------------------------------------------+\n      | Case Header: Reference | Type Tag | Status | Priority     |\n      | Property: [link] | Tenant: [link] | Handler: name         |\n      +----------------------------------------------------------+\n      | STAGE TIMELINE (horizontal stepper with dates/countdowns) |\n      +---------------------------+------------------------------+\n      | Case Details (55%)        | Activity Feed (45%, scroll)  |\n      | Description, category,    | Chronological log of actions |\n      | attachments, AI analysis  | notes, letters, status       |\n      +---------------------------+------------------------------+\n      | Actions: [Assign] [Update] [Escalate] [Close] [AI]      |\n      +----------------------------------------------------------+\n\n\n4. PERSONA SYSTEM\n================================================================================\n\n    5 personas determine what Yantra Assist shows and which AI dynamic\n    actions appear. User selects at login or switches via user menu.\n\n4.1 Persona 1: Chief Operating Officer / Director\n    Dashboard scope: Entire organisation\n    Yantra Assist focus: Strategic — regulatory risk, portfolio compliance\n      trends, financial performance, TSM trajectory, inspection readiness\n    AI dynamic actions: \"Generate board report\", \"Model rent increase\n      scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n\n4.2 Persona 2: Head of Housing / Head of Service\n    Dashboard scope: Their service area\n    Yantra Assist focus: Operational — SLA performance, team capacity,\n      complaint trends, void turnaround, allocations throughput\n    AI dynamic actions: \"Rebalance team caseloads\", \"Generate team performance\n      review\", \"Identify training needs from complaint patterns\"\n\n4.3 Persona 3: Team Manager / Patch Manager\n    Dashboard scope: Their patch/team\n    Yantra Assist focus: Team management — officer workload, overdue cases,\n      skill gaps, cover arrangements\n    AI dynamic actions: \"Reassign cases for officer on leave\", \"Generate\n      patch briefing\", \"Schedule team catch-up\"\n\n4.4 Persona 4: Housing Officer / Colleague (THE MOST IMPORTANT)\n    Dashboard scope: Personal caseload/patch\n    Yantra Assist shows: What to do TODAY — appointments, calls, tasks, cases\n    AI dynamic actions: Richest set — holding reply buttons, follow-up task\n      creators, referral generators, communication drafters, contractor\n      booking, escalation aids, resolution suggestions\n    Morning briefing: \"You have 3 urgent items, 12 tasks due, 2 tenancies\n      predicted to enter arrears. Heavy rain Thursday — 4 properties at\n      damp risk.\"\n\n4.5 Persona 5: Repairs Operative / Contractor\n    Dashboard scope: Simplified mobile-optimised layout\n    Yantra Assist shows: Today's jobs, access codes, risk alerts,\n      vulnerability flags, previous repair history\n    AI dynamic actions: \"Mark complete + take photo\", \"Order follow-on\n      materials\", \"Flag as requiring follow-up inspection\"\n    Restrictions: No financial data, limited personal tenant details\n\n\n5. AI-NATIVE FEATURES\n================================================================================\n\n5.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: clearly-marked section with purple-tinted border\n       (--status-ai left border, --surface-elevated background) that\n       contains AI-generated elements that change based on context\n\n    AI Dynamic zone contents:\n    - Dynamic action buttons (only appear when AI determines relevance)\n    - Dynamic info cards (contextual information for NOW)\n    - Dynamic prompts (AI questions that trigger automated workflows)\n    - Dynamic warnings (entity-specific alerts)\n\n5.2 Dynamic AI Fields\n    Not just buttons — AI adds information fields that don't exist in\n    the standard layout:\n    - Tenant page: \"Estimated household income: £24,000/year\"\n    - Property page: \"Carbon emission estimate: 4.2 tonnes/year\"\n    - Repair page: \"Similar repair average cost: £385\"\n    - Complaint page: \"Ombudsman determination risk: HIGH\"\n    - Building page: \"Estimated retrofit cost to EPC C: £8,200/unit\"\n    Displayed as subtle cards with --status-ai purple left border and\n    \"✦ AI estimate\" label.\n\n5.3 The AI Action Flow Pattern\n    Every AI dynamic button follows this 7-step pattern:\n    1. PRESENT: Show button with explanation of WHY this action\n    2. PREVIEW: Click shows preview of what will happen\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks/cases/notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything automatically\n    7. LEARN: System records accept/modify/reject for model feedback\n\n5.4 Yantra Assist — Contextual AI Panel\n    Trigger: Fixed button bottom-left, Yantra diamond mark 32px with\n      pulsing --status-ai purple glow. Badge count for actionable items.\n    Panel: Slides in from left (400px), overlaying sidebar.\n    Content changes based on (a) current page/entity and (b) persona.\n    Structure:\n    - 🔴 URGENT: items needing immediate action\n    - 🟠 ATTENTION: items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: weather, UC changes, local context\n    - Chat input: \"Ask Yantra...\" natural language queries\n\n5.5 AI-Augmented Workflows\n    a) Logging a Repair:\n       Describe issue → AI categorises (SOR code), assigns priority,\n       identifies trade, checks asbestos, checks vulnerability, detects\n       recurring pattern, estimates cost, suggests appointment, drafts\n       access instructions, flags Awaab's Law\n    b) Handling Inbound Contact:\n       AI reads/summarises → categorises → suggests action → auto-creates\n       case if confirmed → asks about follow-ups\n    c) Sending Communication:\n       User triggers → AI generates draft → tone options → after sending,\n       asks about follow-up task → links to case\n    d) Reviewing Compliance:\n       AI shows what WILL expire, TSM score impact, pre-drafted contractor\n       instructions, pre-booked slots, no-access risk predictions\n\n5.6 Signature Interactions\n    1. \"Holding Reply\" Flow — overdue repair → AI drafts update → send →\n       create follow-up → auto-escalate if still not done\n    2. \"Inbound Email Triage\" Flow — email → AI categorises → create case →\n       appointment → tenant confirmation\n    3. \"Proactive Damp Prevention\" Flow — weather forecast → building risk →\n       preventive advice letters → follow-up inspections\n    4. \"Compliance Cascade\" Flow — overdue certs → book all → letters →\n       calendar → no-access escalation\n    5. \"Complaint Prevention\" Flow — multiple calls + declining satisfaction →\n       prevention plan → urgent repair + apology + goodwill\n\n5.7 External Data Sources (simulated)\n    - Met Office weather: rain/temperature affecting damp and outdoor works\n    - DWP/UC: benefit changes, managed migration, income impact\n    - Regulator of Social Housing: inspection updates, sector benchmarks\n    - Housing Ombudsman: recent determinations, Code updates\n    - Energy prices: fuel poverty risk, heating behaviour predictions\n    - Local authority: planning, roadworks, school terms (ASB patterns)\n\n\n6. PREDICTIVE INTELLIGENCE ENGINE\n================================================================================\n\n    8 prediction models with real-time scoring:\n\n    | Model                | Predicts                              | Score   |\n    |----------------------|---------------------------------------|---------|\n    | Arrears Risk         | Tenancy enters arrears in 30/60/90d   | 0-100   |\n    | Damp & Mould         | Property develops damp/mould           | 0-100   |\n    | Complaint Escalation | Complaint reaches Stage 2/Ombudsman    | % prob  |\n    | Void Duration        | How long a void will take              | Days    |\n    | Repair Recurrence    | Repair will recur; root cause          | % prob  |\n    | Vulnerability        | Tenant may be vulnerable (unidentified)| Flags   |\n    | ASB Escalation       | Case requires legal action             | % prob  |\n    | Compliance Failure   | Property fails before cert expiry      | % prob  |\n\n    Each model shows on /ai/predictions with: scatter plot, top-50 table,\n    feature importance chart, accuracy metrics (precision/recall/F1 gauges),\n    last trained date.\n\n\n7. SEVEN KILLER DIFFERENTIATORS\n================================================================================\n\n    These composite features combine internal data with external public APIs\n    to produce intelligence no competitor can match.\n\n7.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    Algorithm: 5-factor weighted scoring\n      - Weather factor (0.25): temperature, humidity, precipitation, dew point\n      - Building factor (0.25): construction type, EPC, insulation, orientation\n      - History factor (0.20): previous damp repairs, frequency, severity\n      - Sensor factor (0.20): IoT data (humidity, temperature, moisture)\n      - Occupancy factor (0.10): household size, ventilation behaviour\n    Output: Risk score 0-100 per property with factor breakdown\n    Frontend: DampIntelligencePanel component on property detail\n    Data sources: Open-Meteo, EPC, internal repairs, IoT mock\n\n7.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    Algorithm: Police.uk data correlation with internal ASB cases\n    Features: Crime heatmap overlay, hotspot analysis, multi-agency referral\n    Frontend: Crime data layer on Explore map, ASB case context card\n    Data sources: Police.uk, internal ASB cases\n\n7.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    Algorithm: 7-factor scoring\n      - Deprivation (IMD decile)\n      - Arrears pattern\n      - Health indicators\n      - Isolation (contact frequency)\n      - Age (elderly, young)\n      - Dependents\n      - UC transition\n    Output: Overall score + individual factor scores + detected flags + actions\n    Frontend: VulnerabilityPanel on tenancy detail\n    Data sources: IMD, Census, NOMIS, internal data\n\n7.4 D4: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    Algorithm: UK 2025/26 benefit rules analysis\n    Benefits checked: UC, Housing Benefit, PIP, Attendance Allowance,\n      Pension Credit, Council Tax Reduction, Warm Home Discount, Winter\n      Fuel Payment, Free School Meals\n    Output: Entitlement list with status, amounts, unclaimed totals\n    Frontend: BenefitsPanel on tenancy detail\n    Data sources: DWP mock, NOMIS, household composition\n\n7.5 D5: Property Passport\n    Service: server/src/services/property-passport.ts\n    Algorithm: Multi-source property dossier aggregation\n    Sources: EPC, Gas Safe, EICR, UPRN, flood risk, IMD, crime, weather\n    Output: Comprehensive property intelligence document\n\n7.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    Algorithm: Per-estate daily intelligence combining all data sources\n    Sections: 6 summary cards + officer briefing + action items\n    Frontend: NeighbourhoodBriefingPanel on briefing page and estate detail\n\n7.7 D7: GOV.UK Notify Integration\n    Service: server/src/services/govuk-notify.ts\n    Templates: 24 templates across 7 categories\n    Categories: rent-arrears (5), repairs (4), asb (3), compliance (3),\n      tenancy (3), damp-mould (3), general (3)\n    Features: Personalisation rendering, multi-channel (email/SMS/letter),\n      delivery tracking, tone selection\n\n\n8. DATA MODEL SUMMARY\n================================================================================\n\n    Full TypeScript type definitions in app/src/types/index.ts\n\n8.1 Core Entity Types\n    - Region, LocalAuthority, Estate, Block (geography hierarchy)\n    - Property (type, tenure, compliance, EPC, heating, dampness)\n    - Tenant (demographics, financial, UC status, vulnerability)\n    - Case (unified: complaint, repair, ASB, financial, damp-mould, etc.)\n    - Activity (call, visit, letter, email, SMS, note)\n    - Task (pending, in-progress, completed, overdue)\n    - Communication (multi-channel with sentiment, delivery tracking)\n\n8.2 Financial Types\n    - RentTransaction (charge, payment, adjustment, HB, UC)\n    - ServiceCharge (weekly, annual, apportionment)\n    - FinancialCase (arrears tracking, payment arrangements)\n\n8.3 Compliance Types\n    - ComplianceCertificate (gas, electrical, fire, asbestos, legionella, lift)\n    - Per-certificate detail (readings, observations, classifications)\n    - Contractor verification (registration numbers)\n\n8.4 Allocations Types\n    - VoidProperty (stage pipeline, days void, rent loss)\n    - Applicant (band A-D, bedroom need, local connection)\n\n8.5 AI Types\n    - AiInsight (prediction, alert, recommendation, analysis)\n    - AiAction (workflow steps with preview/edit/confirm/followup)\n    - DampRiskBreakdown (5 weighted factors, overall score)\n    - VulnerabilityAssessment (7 factors, overall score)\n    - AuditEntry (timestamp, user, entity, field, old/new values, IP)\n\n8.6 External Data Types\n    - CrimeIncident, DeprivationProfile, AreaDemographics\n    - LabourMarket, FloodAlert, WeatherDetail, WeatherWarning\n    - SensorReading, SensorAlert, UcStatus\n    - Integration (20 external system records)\n\n\n9. UI/UX DESIGN LANGUAGE\n================================================================================\n\n9.1 Colour Palette — Yantra Works Official Brand\n\n    Brand:\n    --brand-peach: #EFAC92     (headings & accents)\n    --brand-garnet: #BE3358    (CTAs, critical alerts)\n    --brand-teal: #058995      (logo, labels, primary identity, links)\n    --brand-blue: #5BA4AA      (charts, secondary highlights)\n    --brand-soft: #ACC0B5      (metadata text, secondary text)\n    --brand-deep: #1A5A5E      (dark panels, sidebars)\n\n    Dark Theme Surfaces:\n    --surface-dark: #0D1117    (page background)\n    --surface-card: #151B23    (card/panel backgrounds)\n    --surface-elevated: #1C2333 (modals, dropdowns, elevated)\n    --surface-hover: #222D3D   (hover states)\n\n    Text:\n    --text-primary: #E6EDF3    (primary text)\n    --text-secondary: #ACC0B5  (secondary = brand-soft)\n    --text-muted: #6B7B8D      (timestamps, IDs, low-priority)\n\n    Borders:\n    --border-default: #2A3545\n    --border-focus: #EFAC92    (focus ring — peach on dark)\n\n    Semantic Statuses:\n    --status-compliant: #2EA043 (green)\n    --status-warning: #EFAC92   (peach/amber)\n    --status-critical: #BE3358  (garnet)\n    --status-info: #5BA4AA      (blue)\n    --status-ai: #A371F7        (purple — AI features)\n    --status-void: #6B7B8D      (grey)\n\n9.2 Typography\n    - Headings: \"Space Grotesk\", sans-serif — bold, technical\n    - Body: \"Inter\", Arial, sans-serif — clean, readable\n    - Monospace: \"JetBrains Mono\", monospace — references, codes\n    - Body size: 15px. Line height: 1.6 body, 1.2 headings\n    - Headings in --brand-peach on dark backgrounds\n    - Section labels: --brand-teal, uppercase, letter-spaced\n\n9.3 Design Principles\n    - Dark mode is default (--surface-dark background)\n    - Max content width: 1400px (except full-bleed maps)\n    - Cards: --surface-card, 4px left colour border for RAG, 8px rounded\n    - Status tags: pill-shaped, semi-transparent\n    - Countdown timers: large monospace digits, colour transitions\n      green → peach → garnet → pulsing garnet\n    - Tables: --surface-card, --surface-hover on hover, sortable\n    - Buttons: --brand-teal primary, --surface-elevated secondary,\n      --brand-garnet destructive, --status-ai purple for AI\n    - Charts: teal primary, blue secondary, peach highlights, garnet alerts\n    - Subtle background grid/dot pattern at 3% opacity\n    - UK date format DD/MM/YYYY, British English, GBP £\n    - Animations throughout: staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts — UI must feel ALIVE\n\n9.4 Navigation Structure\n    Persistent left sidebar (280px, collapsible to 64px icons-only):\n    - Background: --surface-card\n    - Active: --brand-teal left border + tinted background\n    - Sections: NAVIGATE, MANAGE, COMMUNICATE, ANALYSE, SYSTEM\n\n    Top header bar (--surface-dark):\n    - Left: Yantra logo + \"SocialHomes.Ai\" branding\n    - Centre: Global search bar\n    - Right: Notification bell, AI Assist button, User avatar + persona\n\n    Breadcrumbs on every page\n    Phase banner: --brand-garnet \"BETA\" tag\n\n9.5 Accessibility (WCAG 2.2 AA)\n    - Focus trap on modals (Tab wrapping, Escape key)\n    - ARIA labels: role=\"dialog\", aria-modal, aria-labelledby, aria-describedby\n    - Form validation: noValidate + custom, aria-required, aria-invalid\n    - Skip-to-content link + id=\"main-content\" on <main>\n    - Nav: aria-label=\"Main navigation\"\n    - Focus-visible outline styles\n    - @media (prefers-reduced-motion: reduce) disables animations\n    - .sr-only screen reader class\n    - Keyboard navigation throughout\n\n\n10. REGULATORY & COMPLIANCE FRAMEWORK\n================================================================================\n\n10.1 UK Housing Regulation\n    - Regulator of Social Housing (RSH): Consumer Standards 2024\n    - Housing Ombudsman: Complaint Handling Code\n    - Building Safety Act 2022: higher-risk buildings (≥18m/≥7 storeys)\n    - Decent Homes Standard (including new damp/mould criterion)\n    - Awaab's Law: mandatory timescales for damp/mould\n    - Social Housing (Regulation) Act 2023\n\n10.2 Awaab's Law Compliance\n    Emergency cases (24hrs for all actions):\n    - Investigate, hazard summary, make safe, begin repair\n    Significant hazard cases:\n    - Investigate within 10 working days\n    - Provide hazard summary within 3 working days of investigation\n    - Complete safety works within 5 working days\n    - Begin repair works within 12 weeks\n    Countdown timers displayed prominently with colour transitions.\n\n10.3 Tenant Satisfaction Measures (TSM)\n    22 indicators reported annually to RSH:\n    - 12 Tenant Perception measures (survey-based)\n    - 10 Management Information measures (system-generated)\n    - CH01/CH02: Complaints handling\n    - BS01-BS06: Building safety (gas, electrical, fire, etc.)\n    - RP01/RP02: Repairs performance\n    - NM01: Anti-social behaviour\n    - TSM report page with actuals, targets, sector medians, quartiles\n\n10.4 GDPR / Data Protection\n    - Subject Access Request processing\n    - Right to Erasure workflow\n    - Data retention policies\n    - Consent management\n    - Data Processing Register\n    - PII sensitivity controls on vulnerability data\n\n\n11. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n11.1 Performance\n    - API response time (P95): < 500ms (current: ~200-300ms)\n    - AI response latency (Vertex AI target): < 3s conversational\n    - Streaming first token: < 500ms\n    - Bundle size: < 3MB (current: ~2.5MB)\n    - Cloud Run cold start: < 3s (current: < 2s)\n\n11.2 Reliability\n    - External API uptime: > 99.5% with fallback (current: 100%)\n    - WebSocket stability target: > 99.9%\n    - Graceful degradation: all external calls have simulated fallbacks\n\n11.3 Security\n    - Firebase Authentication (Google SSO + email/password)\n    - Persona-based RBAC (5 levels × per-module permissions)\n    - CSP headers (whitelist for Google APIs, Firebase, OSM, Fonts)\n    - CORS tightened to allowed origins\n    - Rate limiting: 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n    - Request correlation IDs (X-Request-ID)\n    - JSON body limit: 1MB\n    - Secret Manager for all credentials\n\n11.4 Testing\n    - Selenium test pass rate: 99.7% (330/331)\n    - TypeScript errors: 0\n    - Target unit test coverage: > 80%\n    - Target Selenium route coverage: > 95%\n    - Target Lighthouse accessibility: > 90\n\n11.5 Scalability\n    - Cloud Run auto-scaling: 0-10 instances\n    - Firestore: serverless, auto-scaling\n    - Target: 100 concurrent users with P95 < 1s\n\n11.6 Monitoring\n    - Health endpoint: /health (Firestore connectivity, memory, uptime)\n    - Admin monitoring endpoint: /api/v1/admin/monitoring\n    - Metrics: request counts, response times, status codes, cache stats\n    - Telegram notifications via @SocialHomesBot\n\n\n12. SIMULATED DATA & DEMO ENVIRONMENT\n================================================================================\n\n12.1 Data Volume\n    - 75 properties across 5 estates\n    - 68 active tenants (diverse SE London demographics)\n    - 279+ cases (repairs, complaints, ASB, financial, damp/mould)\n    - 200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    - 34 open complaints (28 Stage 1, 6 Stage 2)\n    - 12 ASB cases\n    - 8 damp/mould cases (3 emergency, 5 significant)\n    - 25 financial cases\n    - 5 voids at various stages\n\n12.2 Financial Profile\n    - Rents: social £95-140/week, affordable £140-200/week\n    - Service charges: £5-35/week\n    - Payment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    - Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n12.3 Compliance Profile\n    - Gas: 99.4%, Electrical: 97.8%, Fire: 99.1%\n    - Asbestos: 98.5%, Legionella: 99.0%, Lifts: 100%\n    - Repairs SLA: Emergency 95%<24hrs, Urgent 88%<5d, Routine 82%<28d\n    - First-time fix: 78%, Satisfaction: 3.8/5\n    - Complaint response within timescale: 91%\n\n12.4 Demo Users\n    - Sarah Mitchell (Housing Officer) — default login persona\n    - Additional personas available via persona switcher\n\n\n13. CURRENT IMPLEMENTATION STATUS\n================================================================================\n\n    Phase 0: Infrastructure — DONE (10/10)\n    Phase 1: Foundation — DONE (12/12)\n    Phase 2: Intelligence — DONE (14/14)\n    Phase 3: Enrichment — DONE (14/17, 3 deferred)\n    Phase 4: Completion — DONE (11/14, 3 deferred)\n    Phase 5: Evolution — TODO (2/50 done, 48 remaining)\n\n    All 40+ frontend pages functional — no \"coming soon\" placeholders\n    331 Selenium tests | 330 PASS | 1 WARN | 99.7% pass rate\n    20 external API integrations (9 live, 11 mock)\n    7 AI differentiator services operational\n    24 GOV.UK Notify templates\n    Full RBAC, rate limiting, CSP, monitoring in place\n\n\n14. FUTURE ROADMAP (Phase 5+)\n================================================================================\n\n14.1 Phase 5: Evolution (Sprints 9-14, 50 tasks)\n    - Vertex AI / Gemini integration for Yantra Assist\n    - WebSocket real-time notifications\n    - AI communication drafting with LLM\n    - Workflow builder UI\n    - Mobile responsive layout\n    - Comprehensive test suites (Selenium, unit, integration, load)\n    - Staging environment + CI/CD pipeline\n    - Cloud Monitoring + database backups\n    - Custom domain + CDN\n    - GDPR compliance dashboard\n    - Multi-tenant SaaS architecture design\n\n14.2 Phase 6: Enterprise (planned)\n    - Real DWP/UC API integration\n    - Real GOV.UK Notify sending\n    - Real IoT sensor integration (Switchee, Aico)\n    - Payment processing (GoCardless, Allpay)\n    - Regulatory submission APIs (RSH, CORE, Ombudsman)\n\n\n================================================================================\n  End of Document\n  Doc1 — SocialHomes.Ai Base Specification v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":95213,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKMPMkVWiPmdExmAySL","type":"assistant","uuid":"cb156c48-b849-47df-94e8-1d87d78a4945","timestamp":"2026-02-26T07:56:48.453Z"}
{"parentUuid":"cb156c48-b849-47df-94e8-1d87d78a4945","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BaH5B2xQSit2TZ1KKWJnq7","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt has been updated successfully."}]},"uuid":"5f53af93-c0c3-4dcf-833b-02425b1fda31","timestamp":"2026-02-26T07:56:48.620Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  Product Overview\n  2.  Core Functional Modules (17)\n  3.  Visual Drill-Down Explorer (Flagship)\n  4.  Persona System (5 Personas)\n  5.  AI-Native Features\n  6.  Predictive Intelligence Engine (8 Models)\n  7.  Seven Killer Differentiators\n  8.  Data Model Summary\n  9.  UI/UX Design Language\n  10. Regulatory & Compliance Framework\n  11. Non-Functional Requirements\n  12. Simulated Data & Demo Environment\n  13. Current Implementation Status\n  14. Future Roadmap (Phase 5+)\n\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15)\n       - 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1)\n       - 2 blocks, 48 flats, 2005 new build, higher-risk building (≥18m)\n    3. Elm Gardens (SE13)\n       - Street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6)\n       - 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24)\n       - 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n    GCP Project:    gen-lang-client-0878518473 (number: 587984201316)\n    Firebase:       gen-lang-client-0146156913\n\n1.8 Open Source\n    SocialHomes.Ai is an open-source project by Yantra Works.\n    Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard (/dashboard)\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards: Properties (12,847), Tenancies (12,103), Active Repairs (487),\n      Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293),\n      Compliance (98.7%), Open Complaints (34), AI Alerts (12)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap (6 tiles, % + RAG) |\n      Awaab's Law active cases with countdown timers |\n      AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (/explore) — FLAGSHIP\n    See Section 3 for full specification.\n\n2.3 AI Morning Briefing (/briefing)\n    Purpose: Personalised daily briefing on login\n    Features:\n    - Full-screen animated intro with Yantra mark\n    - Weather and environmental context for the day\n    - URGENT items with countdown timers\n    - TODAY'S TASKS: appointments, calls, letters, case reviews\n    - AI PREDICTIONS: what the model expects this week\n    - PATCH/PORTFOLIO SNAPSHOT: key numbers with trend arrows\n    - Estate selector with Neighbourhood Briefing panel\n    - [Start my day →] button to dashboard\n    - [Skip briefing] option\n\n2.4 Tenancies (/tenancies, /tenancies/:id, /tenancies/new)\n    Purpose: Full tenancy lifecycle management\n    Features:\n    - List view: search, filter (status, tenure, officer), sort, pagination\n    - Detail page (tabbed):\n      * Overview: tenant name, DOB, contact, household, emergency contact,\n        assigned officers, vulnerability flags, key dates, tenure type/status\n      * Cases: unified case timeline (filterable by type) — Complaint (CMP),\n        Repair (REP), ASB (ASB), Enquiry (ENQ), Financial (FIN),\n        Safeguarding (SAF), Damp/Mould (DAM)\n      * Activities: chronological log — calls, visits, letters, emails, SMS\n      * Tasks: outstanding/completed with due date, priority, linked case\n      * Statement (Rent Account): balance, weekly charge, payment method,\n        UC/HB status, rent breakdown, transaction ledger, 52-week statement,\n        balance trend chart, payment arrangement tracker\n      * Orders: Rent Order, Tenure Type, Service Charge, Garage/Parking,\n        Rechargeable Repair, Court Order, Leaseholder\n    - Vulnerability Panel (AI: 7-factor assessment)\n    - Benefits Panel (AI: UK entitlement analysis)\n    - AI dynamic actions zone\n\n2.5 Properties (/properties, /properties/:uprn)\n    Purpose: Asset management with spatial awareness\n    Features:\n    - List/map toggle view\n    - Mini Leaflet map in list view\n    - Detail page (tabbed):\n      * Overview: address, UPRN, type, bedrooms, floor area, heating, tenure,\n        current tenancy or void status, photos, accessibility features\n      * Compliance (unit-level): Gas Safety (CP12), EICR, EPC, Smoke & CO,\n        unit-specific asbestos, boiler details, Decent Homes assessment\n      * Stock Condition: component lifecycle table (roof, windows, kitchen,\n        bathroom, boiler, electrics — install year, condition 1-5, remaining\n        life, replacement cost)\n      * Damp & Mould / Awaab's Law: AI risk score 0-100, active cases with\n        countdown timers, IoT sensor data (simulated)\n      * Works History: all repairs/works with costs, annual spend trend\n      * Documents: certificates, reports, photos\n    - Damp Intelligence Panel (AI: 5-factor weighted algorithm)\n    - Property Passport (AI: multi-source aggregation)\n\n2.6 Repairs (/repairs, /repairs/:id, /repairs/new, /repairs/schedule)\n    Purpose: Full repairs management lifecycle\n    Features:\n    - List/Kanban toggle view\n    - Columns: ref, date, property, SOR category, priority, status,\n      operative, target date, days elapsed\n    - Kanban: status columns with priority colour borders\n    - New repair wizard: property lookup → free-text description →\n      AI auto-suggests SOR code/priority/trade/Awaab's Law flags →\n      appointment booking → risk assessment → confirm\n    - Detail page: priority-based SLA timer, SOR code, trade, appointment,\n      risk assessment, operative notes, photos before/during/after,\n      materials, satisfaction survey, first-time fix, Awaab's Law compliance\n    - Schedule: weekly calendar, operative schedules, capacity indicators\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - AI: root cause analysis, recurrence prediction, cost comparison\n\n2.7 Rent & Income (/rent, /rent/accounts, /rent/accounts/:id, /rent/arrears)\n    Purpose: Financial management and arrears recovery\n    Features:\n    - Arrears dashboard: total, by band (chart), collection rate gauge,\n      payment method breakdown\n    - AI-prioritised worklist: tenant details, arrears amount, 12-week\n      sparkline, AI score (1-100), risk factors, recommended action\n    - Account detail: statement view, transaction ledger\n    - UC tracking integration\n    - Sub-routes: accounts list, individual statements, arrears worklist\n\n2.8 Compliance (/compliance, /compliance/gas, /compliance/electrical,\n    /compliance/fire, /compliance/asbestos, /compliance/legionella,\n    /compliance/lifts, /compliance/awaabs-law)\n    Purpose: Big 6 regulatory compliance management\n    Features:\n    - Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n    - Per-area pages: certificate list, filters, no-access tracker,\n      contractor performance\n    - Awaab's Law page: active cases with timers, risk register (all\n      properties with AI scores), proactive inspection programme\n    - Data layer toggles on Explore map\n\n2.9 Complaints (/complaints, /complaints/:id, /complaints/new)\n    Purpose: Two-stage complaint handling per Housing Ombudsman Code\n    Features:\n    - Dashboard: Stage 1/2 counts, response % vs timescale,\n      TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n    - New: tenant selection → free-text → AI categorises/assigns severity →\n      handler assignment → auto-acknowledgement\n    - Detail: two-stage timeline with countdown timers\n      (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD)\n    - Category, findings (upheld/partial/not), remedy, learning log,\n      Ombudsman escalation tracking\n\n2.10 Allocations (/allocations, /allocations/voids, /allocations/lettings)\n    Purpose: Housing register & lettings management\n    Features:\n    - Housing register: applicants by band (A-D), bedroom need, medical priority\n    - Void kanban: Notice → Keys → Inspection → Works → Quality → Ready →\n      Offer → Let\n    - Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n    - Lettings: available properties with viewing booking\n\n2.11 ASB (/asb, /asb/:id)\n    Purpose: Anti-social behaviour case management\n    Features:\n    - Case list: ref, location, category, severity, status, handler, days open\n    - Detail: escalation pipeline visual tracker\n      (Warning → ABC → CPW → CPN → Injunction → Possession → Closure)\n    - Evidence log, multi-agency panel, risk assessment, Community Trigger check\n    - Crime context overlay from Police.uk data\n\n2.12 Communications (/communications, /communications/templates)\n    Purpose: Unified multi-channel communications hub\n    Features:\n    - Unified inbox: all channels linked to tenant/property/case\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - 5 message types with action buttons (Reply/Forward/Archive)\n    - GOV.UK Notify template manager (24 templates, 7 categories)\n    - Channels: email, phone, letter, SMS, portal, GOV.UK Notify\n\n2.13 Reports (/reports, /reports/tsm, /reports/core, /reports/regulatory,\n    /reports/ombudsman, /reports/performance, /reports/financial,\n    /reports/stock-condition)\n    Purpose: Comprehensive reporting and regulatory returns\n    Sub-pages:\n    - TSM Annual Return (22 measures with actuals, targets, sector medians)\n    - CORE Lettings/Sales Logs (field validation, CSV export)\n    - Consumer Standards Self-Assessment (4 standards, evidence mapping)\n    - Complaint Handling Code Self-Assessment\n    - Building Safety Act Returns (higher-risk buildings)\n    - SDR for RSH\n    - Operational Performance (repairs, voids, arrears, complaints, ASB, contact)\n    - Financial (rent setting, service charge, repairs expenditure, bad debt, void loss)\n    - Stock Condition (quarterly/annual)\n    - Dynamic report page with 27+ reports\n    Features:\n    - Date range, property group, tenure type, comparison period\n    - CSV/PDF export\n    - Drill-down from aggregates\n    - Benchmarking vs targets/previous/sector\n    - AI-generated narrative summary\n    - Scheduled email distribution\n\n2.14 AI Centre (/ai, /ai/insights, /ai/predictions, /ai/assistant)\n    Purpose: Central hub for AI capabilities\n    Features:\n    - Insights feed: predictions, alerts, recommendations, analytics\n      with confidence %, affected entities, action buttons\n    - Predictions dashboard: Arrears (scatter + top 50 + feature importance),\n      Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n    - Differentiators tab: 6 feature cards + vulnerability scan\n    - Assistant: chat panel with natural language queries\n\n2.15 Admin (/admin, /admin/organisation, /admin/users, /admin/teams,\n    /admin/workflows, /admin/integrations, /admin/audit, /admin/system)\n    Purpose: Full system administration suite\n    Sub-pages:\n    - Dashboard: system health, user activity, data quality, integration\n      status, AI model health\n    - Organisation: profile, branding, operational parameters\n    - Users: RBAC with 10 roles × permissions, custom roles, 2FA, sessions\n    - Teams: hierarchies, patch definition (map/postcode), caseload balancing\n    - Workflows: visual builder with triggers/conditions/actions/SLA timers,\n      pre-built templates\n    - Integrations: 20 integration cards with status, last sync, toggle,\n      test connection, tier badges, cache hit rate bars\n    - Audit: full trail, GDPR tools (SAR, erasure, retention, consent)\n    - System: reference data, form builder, notification config, AI config\n\n2.16 Tenant Portal (/tenant-portal, /tenant-portal/repairs,\n    /tenant-portal/rent, /tenant-portal/documents, /tenant-portal/contact)\n    Purpose: Tenant self-service with distinct warmer UI\n    Features:\n    - Visually distinct: lighter/warmer theme, simpler layout, larger text,\n      no jargon, large touch targets\n    - Dashboard: welcome, quick actions (report repair, check balance,\n      make payment, contact), active repairs, rent balance, appointments\n    - Report repair: conversational wizard — room → problem → sub-category →\n      photo → appointment → confirm. AI urgency detection.\n    - Rent: clear balance, simple transactions, payment button\n    - Quick message form with select/textarea\n\n2.17 Global Search (/search)\n    Purpose: Cross-entity search with instant results\n    Features:\n    - Search bar: dark input, magnifying glass, placeholder text\n    - Results grouped by entity type (tenant, property, case)\n    - Click-through to entity detail\n    - AI-enhanced relevance ranking\n\n\n3. VISUAL DRILL-DOWN EXPLORER (Flagship Feature)\n================================================================================\n\n3.1 Concept\n    The PRIMARY navigation experience. Users visually navigate from Country →\n    Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every\n    level, the right panel shows that level's attributes, KPIs, compliance,\n    and AI insights.\n\n3.2 Layout\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - AI dynamic actions (Doc 2)    |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n3.3 Hierarchy Levels\n\n    Level 0: Country (/explore/country)\n    - Map: England centred (~52.5°N, 1.5°W, zoom 6)\n    - 3 operational regions with property count badges\n    - Panel: portfolio summary — total units, occupancy, compliance %,\n      total arrears, collection rate, TSM headlines, regional breakdown,\n      regulatory status (G1/V1), stock by tenure type (pie chart)\n\n    Level 1: Region (/explore/region/:id)\n    - Map: zoomed to region (e.g. London, zoom 10)\n    - LA areas as markers sized by stock count, coloured by compliance\n    - Panel: compliance, arrears, voids, repairs backlog, LA breakdown,\n      stock profile, average EPC distribution\n\n    Level 2: Local Authority (/explore/region/:id/la/:id)\n    - Map: zoom 13, estates as clusters/polygons with mini-donut compliance\n    - Panel: properties, tenancies, voids, Big 6 compliance, estates list,\n      LA context (housing market, LHA rates, nomination agreements)\n\n    Level 3: Estate (/explore/.../estate/:id)\n    - Map: zoom 16-17, individual buildings as footprints (green/amber/red)\n    - Panel: estate name, postcode, construction era, total units\n    - KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases\n    - Buildings list, estate management, communal areas, scheme type\n    - Neighbourhood Briefing Panel integrated\n\n    Level 4: Block / Building (/explore/.../block/:id)\n    - TRANSITION TO 3D VIEW: Three.js procedurally generated building\n    - Rotate/zoom/pan with OrbitControls\n    - BUILDING-LEVEL ATTRIBUTES (not unit-level):\n      * Fire Risk Assessment: date, risk level, action plan status\n      * Building Safety Case (if higher-risk): accountable person, BSR\n      * Communal fire systems: detection, emergency lighting, compartmentation\n      * Asbestos management plan: building-level register\n      * Legionella risk assessment: water system, tanks, TMVs\n      * Structural surveys, roof, communal heating, lifts (LOLER), entry\n    - Units list: number, floor, bedrooms, tenure, occupancy, RAG\n\n    Level 4a: Core / Entrance (/explore/.../core/:id)\n    - For buildings with multiple cores (e.g. tower blocks)\n    - Schematic floor plan showing units per floor for this core\n    - Panel: core ID, floors served, units, stairwell, lift, fire escape\n\n    Level 5: Unit (/explore/.../unit/:id)\n    - 3D: highlighted unit within building model\n    - Panel (tabbed): Overview, Compliance (unit-level), Stock Condition,\n      Damp & Mould / Awaab's Law, Works History, Documents\n\n    Level 6: Tenant (/explore/.../tenant/:id)\n    - Panel (tabbed): Overview, Cases (unified timeline), Activities,\n      Tasks, Statement (Rent Account), Orders\n    - Case types with colour-coded references:\n      | Complaint  | CMP-YYYY-XXXXX | Orange |\n      | Repair     | REP-YYYY-XXXXX | Blue   |\n      | ASB        | ASB-YYYY-XXXXX | Red    |\n      | Enquiry    | ENQ-YYYY-XXXXX | Grey   |\n      | Financial  | FIN-YYYY-XXXXX | Amber  |\n      | Safeguarding | SAF-YYYY-XXXXX | Purple |\n      | Damp/Mould | DAM-YYYY-XXXXX | Teal   |\n\n    Level 7: Case Detail\n    - Common layout for all case types:\n      +----------------------------------------------------------+\n      | Case Header: Reference | Type Tag | Status | Priority     |\n      | Property: [link] | Tenant: [link] | Handler: name         |\n      +----------------------------------------------------------+\n      | STAGE TIMELINE (horizontal stepper with dates/countdowns) |\n      +---------------------------+------------------------------+\n      | Case Details (55%)        | Activity Feed (45%, scroll)  |\n      | Description, category,    | Chronological log of actions |\n      | attachments, AI analysis  | notes, letters, status       |\n      +---------------------------+------------------------------+\n      | Actions: [Assign] [Update] [Escalate] [Close] [AI]      |\n      +----------------------------------------------------------+\n\n\n4. PERSONA SYSTEM\n================================================================================\n\n    5 personas determine what Yantra Assist shows and which AI dynamic\n    actions appear. User selects at login or switches via user menu.\n\n4.1 Persona 1: Chief Operating Officer / Director\n    Dashboard scope: Entire organisation\n    Yantra Assist focus: Strategic — regulatory risk, portfolio compliance\n      trends, financial performance, TSM trajectory, inspection readiness\n    AI dynamic actions: \"Generate board report\", \"Model rent increase\n      scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n\n4.2 Persona 2: Head of Housing / Head of Service\n    Dashboard scope: Their service area\n    Yantra Assist focus: Operational — SLA performance, team capacity,\n      complaint trends, void turnaround, allocations throughput\n    AI dynamic actions: \"Rebalance team caseloads\", \"Generate team performance\n      review\", \"Identify training needs from complaint patterns\"\n\n4.3 Persona 3: Team Manager / Patch Manager\n    Dashboard scope: Their patch/team\n    Yantra Assist focus: Team management — officer workload, overdue cases,\n      skill gaps, cover arrangements\n    AI dynamic actions: \"Reassign cases for officer on leave\", \"Generate\n      patch briefing\", \"Schedule team catch-up\"\n\n4.4 Persona 4: Housing Officer / Colleague (THE MOST IMPORTANT)\n    Dashboard scope: Personal caseload/patch\n    Yantra Assist shows: What to do TODAY — appointments, calls, tasks, cases\n    AI dynamic actions: Richest set — holding reply buttons, follow-up task\n      creators, referral generators, communication drafters, contractor\n      booking, escalation aids, resolution suggestions\n    Morning briefing: \"You have 3 urgent items, 12 tasks due, 2 tenancies\n      predicted to enter arrears. Heavy rain Thursday — 4 properties at\n      damp risk.\"\n\n4.5 Persona 5: Repairs Operative / Contractor\n    Dashboard scope: Simplified mobile-optimised layout\n    Yantra Assist shows: Today's jobs, access codes, risk alerts,\n      vulnerability flags, previous repair history\n    AI dynamic actions: \"Mark complete + take photo\", \"Order follow-on\n      materials\", \"Flag as requiring follow-up inspection\"\n    Restrictions: No financial data, limited personal tenant details\n\n\n5. AI-NATIVE FEATURES\n================================================================================\n\n5.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: clearly-marked section with purple-tinted border\n       (--status-ai left border, --surface-elevated background) that\n       contains AI-generated elements that change based on context\n\n    AI Dynamic zone contents:\n    - Dynamic action buttons (only appear when AI determines relevance)\n    - Dynamic info cards (contextual information for NOW)\n    - Dynamic prompts (AI questions that trigger automated workflows)\n    - Dynamic warnings (entity-specific alerts)\n\n5.2 Dynamic AI Fields\n    Not just buttons — AI adds information fields that don't exist in\n    the standard layout:\n    - Tenant page: \"Estimated household income: £24,000/year\"\n    - Property page: \"Carbon emission estimate: 4.2 tonnes/year\"\n    - Repair page: \"Similar repair average cost: £385\"\n    - Complaint page: \"Ombudsman determination risk: HIGH\"\n    - Building page: \"Estimated retrofit cost to EPC C: £8,200/unit\"\n    Displayed as subtle cards with --status-ai purple left border and\n    \"✦ AI estimate\" label.\n\n5.3 The AI Action Flow Pattern\n    Every AI dynamic button follows this 7-step pattern:\n    1. PRESENT: Show button with explanation of WHY this action\n    2. PREVIEW: Click shows preview of what will happen\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks/cases/notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything automatically\n    7. LEARN: System records accept/modify/reject for model feedback\n\n5.4 Yantra Assist — Contextual AI Panel\n    Trigger: Fixed button bottom-left, Yantra diamond mark 32px with\n      pulsing --status-ai purple glow. Badge count for actionable items.\n    Panel: Slides in from left (400px), overlaying sidebar.\n    Content changes based on (a) current page/entity and (b) persona.\n    Structure:\n    - 🔴 URGENT: items needing immediate action\n    - 🟠 ATTENTION: items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: weather, UC changes, local context\n    - Chat input: \"Ask Yantra...\" natural language queries\n\n5.5 AI-Augmented Workflows\n    a) Logging a Repair:\n       Describe issue → AI categorises (SOR code), assigns priority,\n       identifies trade, checks asbestos, checks vulnerability, detects\n       recurring pattern, estimates cost, suggests appointment, drafts\n       access instructions, flags Awaab's Law\n    b) Handling Inbound Contact:\n       AI reads/summarises → categorises → suggests action → auto-creates\n       case if confirmed → asks about follow-ups\n    c) Sending Communication:\n       User triggers → AI generates draft → tone options → after sending,\n       asks about follow-up task → links to case\n    d) Reviewing Compliance:\n       AI shows what WILL expire, TSM score impact, pre-drafted contractor\n       instructions, pre-booked slots, no-access risk predictions\n\n5.6 Signature Interactions\n    1. \"Holding Reply\" Flow — overdue repair → AI drafts update → send →\n       create follow-up → auto-escalate if still not done\n    2. \"Inbound Email Triage\" Flow — email → AI categorises → create case →\n       appointment → tenant confirmation\n    3. \"Proactive Damp Prevention\" Flow — weather forecast → building risk →\n       preventive advice letters → follow-up inspections\n    4. \"Compliance Cascade\" Flow — overdue certs → book all → letters →\n       calendar → no-access escalation\n    5. \"Complaint Prevention\" Flow — multiple calls + declining satisfaction →\n       prevention plan → urgent repair + apology + goodwill\n\n5.7 External Data Sources (simulated)\n    - Met Office weather: rain/temperature affecting damp and outdoor works\n    - DWP/UC: benefit changes, managed migration, income impact\n    - Regulator of Social Housing: inspection updates, sector benchmarks\n    - Housing Ombudsman: recent determinations, Code updates\n    - Energy prices: fuel poverty risk, heating behaviour predictions\n    - Local authority: planning, roadworks, school terms (ASB patterns)\n\n\n6. PREDICTIVE INTELLIGENCE ENGINE\n================================================================================\n\n    8 prediction models with real-time scoring:\n\n    | Model                | Predicts                              | Score   |\n    |----------------------|---------------------------------------|---------|\n    | Arrears Risk         | Tenancy enters arrears in 30/60/90d   | 0-100   |\n    | Damp & Mould         | Property develops damp/mould           | 0-100   |\n    | Complaint Escalation | Complaint reaches Stage 2/Ombudsman    | % prob  |\n    | Void Duration        | How long a void will take              | Days    |\n    | Repair Recurrence    | Repair will recur; root cause          | % prob  |\n    | Vulnerability        | Tenant may be vulnerable (unidentified)| Flags   |\n    | ASB Escalation       | Case requires legal action             | % prob  |\n    | Compliance Failure   | Property fails before cert expiry      | % prob  |\n\n    Each model shows on /ai/predictions with: scatter plot, top-50 table,\n    feature importance chart, accuracy metrics (precision/recall/F1 gauges),\n    last trained date.\n\n\n7. SEVEN KILLER DIFFERENTIATORS\n================================================================================\n\n    These composite features combine internal data with external public APIs\n    to produce intelligence no competitor can match.\n\n7.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    Algorithm: 5-factor weighted scoring\n      - Weather factor (0.25): temperature, humidity, precipitation, dew point\n      - Building factor (0.25): construction type, EPC, insulation, orientation\n      - History factor (0.20): previous damp repairs, frequency, severity\n      - Sensor factor (0.20): IoT data (humidity, temperature, moisture)\n      - Occupancy factor (0.10): household size, ventilation behaviour\n    Output: Risk score 0-100 per property with factor breakdown\n    Frontend: DampIntelligencePanel component on property detail\n    Data sources: Open-Meteo, EPC, internal repairs, IoT mock\n\n7.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    Algorithm: Police.uk data correlation with internal ASB cases\n    Features: Crime heatmap overlay, hotspot analysis, multi-agency referral\n    Frontend: Crime data layer on Explore map, ASB case context card\n    Data sources: Police.uk, internal ASB cases\n\n7.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    Algorithm: 7-factor scoring\n      - Deprivation (IMD decile)\n      - Arrears pattern\n      - Health indicators\n      - Isolation (contact frequency)\n      - Age (elderly, young)\n      - Dependents\n      - UC transition\n    Output: Overall score + individual factor scores + detected flags + actions\n    Frontend: VulnerabilityPanel on tenancy detail\n    Data sources: IMD, Census, NOMIS, internal data\n\n7.4 D4: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    Algorithm: UK 2025/26 benefit rules analysis\n    Benefits checked: UC, Housing Benefit, PIP, Attendance Allowance,\n      Pension Credit, Council Tax Reduction, Warm Home Discount, Winter\n      Fuel Payment, Free School Meals\n    Output: Entitlement list with status, amounts, unclaimed totals\n    Frontend: BenefitsPanel on tenancy detail\n    Data sources: DWP mock, NOMIS, household composition\n\n7.5 D5: Property Passport\n    Service: server/src/services/property-passport.ts\n    Algorithm: Multi-source property dossier aggregation\n    Sources: EPC, Gas Safe, EICR, UPRN, flood risk, IMD, crime, weather\n    Output: Comprehensive property intelligence document\n\n7.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    Algorithm: Per-estate daily intelligence combining all data sources\n    Sections: 6 summary cards + officer briefing + action items\n    Frontend: NeighbourhoodBriefingPanel on briefing page and estate detail\n\n7.7 D7: GOV.UK Notify Integration\n    Service: server/src/services/govuk-notify.ts\n    Templates: 24 templates across 7 categories\n    Categories: rent-arrears (5), repairs (4), asb (3), compliance (3),\n      tenancy (3), damp-mould (3), general (3)\n    Features: Personalisation rendering, multi-channel (email/SMS/letter),\n      delivery tracking, tone selection\n\n\n8. DATA MODEL SUMMARY\n================================================================================\n\n    Full TypeScript type definitions in app/src/types/index.ts\n\n8.1 Core Entity Types\n    - Region, LocalAuthority, Estate, Block (geography hierarchy)\n    - Property (type, tenure, compliance, EPC, heating, dampness)\n    - Tenant (demographics, financial, UC status, vulnerability)\n    - Case (unified: complaint, repair, ASB, financial, damp-mould, etc.)\n    - Activity (call, visit, letter, email, SMS, note)\n    - Task (pending, in-progress, completed, overdue)\n    - Communication (multi-channel with sentiment, delivery tracking)\n\n8.2 Financial Types\n    - RentTransaction (charge, payment, adjustment, HB, UC)\n    - ServiceCharge (weekly, annual, apportionment)\n    - FinancialCase (arrears tracking, payment arrangements)\n\n8.3 Compliance Types\n    - ComplianceCertificate (gas, electrical, fire, asbestos, legionella, lift)\n    - Per-certificate detail (readings, observations, classifications)\n    - Contractor verification (registration numbers)\n\n8.4 Allocations Types\n    - VoidProperty (stage pipeline, days void, rent loss)\n    - Applicant (band A-D, bedroom need, local connection)\n\n8.5 AI Types\n    - AiInsight (prediction, alert, recommendation, analysis)\n    - AiAction (workflow steps with preview/edit/confirm/followup)\n    - DampRiskBreakdown (5 weighted factors, overall score)\n    - VulnerabilityAssessment (7 factors, overall score)\n    - AuditEntry (timestamp, user, entity, field, old/new values, IP)\n\n8.6 External Data Types\n    - CrimeIncident, DeprivationProfile, AreaDemographics\n    - LabourMarket, FloodAlert, WeatherDetail, WeatherWarning\n    - SensorReading, SensorAlert, UcStatus\n    - Integration (20 external system records)\n\n\n9. UI/UX DESIGN LANGUAGE\n================================================================================\n\n9.1 Colour Palette — Yantra Works Official Brand\n\n    Brand:\n    --brand-peach: #EFAC92     (headings & accents)\n    --brand-garnet: #BE3358    (CTAs, critical alerts)\n    --brand-teal: #058995      (logo, labels, primary identity, links)\n    --brand-blue: #5BA4AA      (charts, secondary highlights)\n    --brand-soft: #ACC0B5      (metadata text, secondary text)\n    --brand-deep: #1A5A5E      (dark panels, sidebars)\n\n    Dark Theme Surfaces:\n    --surface-dark: #0D1117    (page background)\n    --surface-card: #151B23    (card/panel backgrounds)\n    --surface-elevated: #1C2333 (modals, dropdowns, elevated)\n    --surface-hover: #222D3D   (hover states)\n\n    Text:\n    --text-primary: #E6EDF3    (primary text)\n    --text-secondary: #ACC0B5  (secondary = brand-soft)\n    --text-muted: #6B7B8D      (timestamps, IDs, low-priority)\n\n    Borders:\n    --border-default: #2A3545\n    --border-focus: #EFAC92    (focus ring — peach on dark)\n\n    Semantic Statuses:\n    --status-compliant: #2EA043 (green)\n    --status-warning: #EFAC92   (peach/amber)\n    --status-critical: #BE3358  (garnet)\n    --status-info: #5BA4AA      (blue)\n    --status-ai: #A371F7        (purple — AI features)\n    --status-void: #6B7B8D      (grey)\n\n9.2 Typography\n    - Headings: \"Space Grotesk\", sans-serif — bold, technical\n    - Body: \"Inter\", Arial, sans-serif — clean, readable\n    - Monospace: \"JetBrains Mono\", monospace — references, codes\n    - Body size: 15px. Line height: 1.6 body, 1.2 headings\n    - Headings in --brand-peach on dark backgrounds\n    - Section labels: --brand-teal, uppercase, letter-spaced\n\n9.3 Design Principles\n    - Dark mode is default (--surface-dark background)\n    - Max content width: 1400px (except full-bleed maps)\n    - Cards: --surface-card, 4px left colour border for RAG, 8px rounded\n    - Status tags: pill-shaped, semi-transparent\n    - Countdown timers: large monospace digits, colour transitions\n      green → peach → garnet → pulsing garnet\n    - Tables: --surface-card, --surface-hover on hover, sortable\n    - Buttons: --brand-teal primary, --surface-elevated secondary,\n      --brand-garnet destructive, --status-ai purple for AI\n    - Charts: teal primary, blue secondary, peach highlights, garnet alerts\n    - Subtle background grid/dot pattern at 3% opacity\n    - UK date format DD/MM/YYYY, British English, GBP £\n    - Animations throughout: staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts — UI must feel ALIVE\n\n9.4 Navigation Structure\n    Persistent left sidebar (280px, collapsible to 64px icons-only):\n    - Background: --surface-card\n    - Active: --brand-teal left border + tinted background\n    - Sections: NAVIGATE, MANAGE, COMMUNICATE, ANALYSE, SYSTEM\n\n    Top header bar (--surface-dark):\n    - Left: Yantra logo + \"SocialHomes.Ai\" branding\n    - Centre: Global search bar\n    - Right: Notification bell, AI Assist button, User avatar + persona\n\n    Breadcrumbs on every page\n    Phase banner: --brand-garnet \"BETA\" tag\n\n9.5 Accessibility (WCAG 2.2 AA)\n    - Focus trap on modals (Tab wrapping, Escape key)\n    - ARIA labels: role=\"dialog\", aria-modal, aria-labelledby, aria-describedby\n    - Form validation: noValidate + custom, aria-required, aria-invalid\n    - Skip-to-content link + id=\"main-content\" on <main>\n    - Nav: aria-label=\"Main navigation\"\n    - Focus-visible outline styles\n    - @media (prefers-reduced-motion: reduce) disables animations\n    - .sr-only screen reader class\n    - Keyboard navigation throughout\n\n\n10. REGULATORY & COMPLIANCE FRAMEWORK\n================================================================================\n\n10.1 UK Housing Regulation\n    - Regulator of Social Housing (RSH): Consumer Standards 2024\n    - Housing Ombudsman: Complaint Handling Code\n    - Building Safety Act 2022: higher-risk buildings (≥18m/≥7 storeys)\n    - Decent Homes Standard (including new damp/mould criterion)\n    - Awaab's Law: mandatory timescales for damp/mould\n    - Social Housing (Regulation) Act 2023\n\n10.2 Awaab's Law Compliance\n    Emergency cases (24hrs for all actions):\n    - Investigate, hazard summary, make safe, begin repair\n    Significant hazard cases:\n    - Investigate within 10 working days\n    - Provide hazard summary within 3 working days of investigation\n    - Complete safety works within 5 working days\n    - Begin repair works within 12 weeks\n    Countdown timers displayed prominently with colour transitions.\n\n10.3 Tenant Satisfaction Measures (TSM)\n    22 indicators reported annually to RSH:\n    - 12 Tenant Perception measures (survey-based)\n    - 10 Management Information measures (system-generated)\n    - CH01/CH02: Complaints handling\n    - BS01-BS06: Building safety (gas, electrical, fire, etc.)\n    - RP01/RP02: Repairs performance\n    - NM01: Anti-social behaviour\n    - TSM report page with actuals, targets, sector medians, quartiles\n\n10.4 GDPR / Data Protection\n    - Subject Access Request processing\n    - Right to Erasure workflow\n    - Data retention policies\n    - Consent management\n    - Data Processing Register\n    - PII sensitivity controls on vulnerability data\n\n\n11. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n11.1 Performance\n    - API response time (P95): < 500ms (current: ~200-300ms)\n    - AI response latency (Vertex AI target): < 3s conversational\n    - Streaming first token: < 500ms\n    - Bundle size: < 3MB (current: ~2.5MB)\n    - Cloud Run cold start: < 3s (current: < 2s)\n\n11.2 Reliability\n    - External API uptime: > 99.5% with fallback (current: 100%)\n    - WebSocket stability target: > 99.9%\n    - Graceful degradation: all external calls have simulated fallbacks\n\n11.3 Security\n    - Firebase Authentication (Google SSO + email/password)\n    - Persona-based RBAC (5 levels × per-module permissions)\n    - CSP headers (whitelist for Google APIs, Firebase, OSM, Fonts)\n    - CORS tightened to allowed origins\n    - Rate limiting: 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n    - Request correlation IDs (X-Request-ID)\n    - JSON body limit: 1MB\n    - Secret Manager for all credentials\n\n11.4 Testing\n    - Selenium test pass rate: 99.7% (330/331)\n    - TypeScript errors: 0\n    - Target unit test coverage: > 80%\n    - Target Selenium route coverage: > 95%\n    - Target Lighthouse accessibility: > 90\n\n11.5 Scalability\n    - Cloud Run auto-scaling: 0-10 instances\n    - Firestore: serverless, auto-scaling\n    - Target: 100 concurrent users with P95 < 1s\n\n11.6 Monitoring\n    - Health endpoint: /health (Firestore connectivity, memory, uptime)\n    - Admin monitoring endpoint: /api/v1/admin/monitoring\n    - Metrics: request counts, response times, status codes, cache stats\n    - Telegram notifications via @SocialHomesBot\n\n\n12. SIMULATED DATA & DEMO ENVIRONMENT\n================================================================================\n\n12.1 Data Volume\n    - 75 properties across 5 estates\n    - 68 active tenants (diverse SE London demographics)\n    - 279+ cases (repairs, complaints, ASB, financial, damp/mould)\n    - 200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    - 34 open complaints (28 Stage 1, 6 Stage 2)\n    - 12 ASB cases\n    - 8 damp/mould cases (3 emergency, 5 significant)\n    - 25 financial cases\n    - 5 voids at various stages\n\n12.2 Financial Profile\n    - Rents: social £95-140/week, affordable £140-200/week\n    - Service charges: £5-35/week\n    - Payment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    - Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n12.3 Compliance Profile\n    - Gas: 99.4%, Electrical: 97.8%, Fire: 99.1%\n    - Asbestos: 98.5%, Legionella: 99.0%, Lifts: 100%\n    - Repairs SLA: Emergency 95%<24hrs, Urgent 88%<5d, Routine 82%<28d\n    - First-time fix: 78%, Satisfaction: 3.8/5\n    - Complaint response within timescale: 91%\n\n12.4 Demo Users\n    - Sarah Mitchell (Housing Officer) — default login persona\n    - Additional personas available via persona switcher\n\n\n13. CURRENT IMPLEMENTATION STATUS\n================================================================================\n\n    Phase 0: Infrastructure — DONE (10/10)\n    Phase 1: Foundation — DONE (12/12)\n    Phase 2: Intelligence — DONE (14/14)\n    Phase 3: Enrichment — DONE (14/17, 3 deferred)\n    Phase 4: Completion — DONE (11/14, 3 deferred)\n    Phase 5: Evolution — TODO (2/50 done, 48 remaining)\n\n    All 40+ frontend pages functional — no \"coming soon\" placeholders\n    331 Selenium tests | 330 PASS | 1 WARN | 99.7% pass rate\n    20 external API integrations (9 live, 11 mock)\n    7 AI differentiator services operational\n    24 GOV.UK Notify templates\n    Full RBAC, rate limiting, CSP, monitoring in place\n\n\n14. FUTURE ROADMAP (Phase 5+)\n================================================================================\n\n14.1 Phase 5: Evolution (Sprints 9-14, 50 tasks)\n    - Vertex AI / Gemini integration for Yantra Assist\n    - WebSocket real-time notifications\n    - AI communication drafting with LLM\n    - Workflow builder UI\n    - Mobile responsive layout\n    - Comprehensive test suites (Selenium, unit, integration, load)\n    - Staging environment + CI/CD pipeline\n    - Cloud Monitoring + database backups\n    - Custom domain + CDN\n    - GDPR compliance dashboard\n    - Multi-tenant SaaS architecture design\n\n14.2 Phase 6: Enterprise (planned)\n    - Real DWP/UC API integration\n    - Real GOV.UK Notify sending\n    - Real IoT sensor integration (Switchee, Aico)\n    - Payment processing (GoCardless, Allpay)\n    - Regulatory submission APIs (RSH, CORE, Ombudsman)\n\n\n================================================================================\n  End of Document\n  Doc1 — SocialHomes.Ai Base Specification v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":9,"newStart":1,"newLines":27,"lines":[" ================================================================================","   Doc1 — SocialHomes.Ai Base Specification","-  Version: 6.0  |  Date: 2026-02-25","+  Version: 7.0  |  Date: 2026-02-26","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," ","+TABLE OF CONTENTS","+================================================================================","+  1.  Product Overview","+  2.  Core Functional Modules (17)","+  3.  Visual Drill-Down Explorer (Flagship)","+  4.  Persona System (5 Personas)","+  5.  AI-Native Features","+  6.  Predictive Intelligence Engine (8 Models)","+  7.  Seven Killer Differentiators","+  8.  Data Model Summary","+  9.  UI/UX Design Language","+  10. Regulatory & Compliance Framework","+  11. Non-Functional Requirements","+  12. Simulated Data & Demo Environment","+  13. Current Implementation Status","+  14. Future Roadmap (Phase 5+)","+","+"," 1. PRODUCT OVERVIEW"," ================================================================================"," "]},{"oldStart":11,"oldLines":8,"newStart":29,"newLines":7,"lines":["     SocialHomes.Ai"," "," 1.2 Tagline","-    AI-native social housing management for UK housing associations.","-    Secondary: \"AI-native. Human-assured.\"","+    \"AI-native. Human-assured.\""," "," 1.3 Vision","     To be the first truly AI-native housing management system that embeds"]},{"oldStart":45,"oldLines":11,"newStart":62,"newLines":16,"lines":["     EPCs:           Mapped to real certificates where available"," ","     5 Estates:","-    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues","-    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building","-    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces","-    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme","-    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s","+    1. Oak Park Estate (SE15)","+       - 3 blocks, 96 flats, 1960s concrete panel, known damp issues","+    2. Riverside Crescent (SE1)","+       - 2 blocks, 48 flats, 2005 new build, higher-risk building (≥18m)","+    3. Elm Gardens (SE13)","+       - Street properties, 35 houses/maisonettes, 1930s terraces","+    4. Birch Court (SE6)","+       - 1 block 24 flats + 8 bungalows, 1970s sheltered scheme","+    5. Maple Lane (SE24)","+       - 1 block 20 flats + 12 houses, mixed 1980s-90s"," "," 1.6 Built By","     Yantra Works — an AI-native development studio."]},{"oldStart":59,"oldLines":744,"newStart":81,"newLines":855,"lines":["     Region:         europe-west2 (London)","     Status:         LIVE and operational","     GitHub:         https://github.com/rajivpeter/SocialHomes_ai","+    GCP Project:    gen-lang-client-0878518473 (number: 587984201316)","+    Firebase:       gen-lang-client-0146156913"," ","+1.8 Open Source","+    SocialHomes.Ai is an open-source project by Yantra Works.","+    Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\""," ","+"," 2. CORE FUNCTIONAL MODULES (17 modules)"," ================================================================================"," ","-2.1 Dashboard","-    Route: /dashboard","+2.1 Dashboard (/dashboard)","     Purpose: Real-time operational overview with persona-scoped KPIs","     Features:","-    - 8 KPI cards (properties, tenancies, active repairs, rent collected,","-      arrears, compliance %, open complaints, AI alerts)","+    - 8 KPI cards: Properties (12,847), Tenancies (12,103), Active Repairs (487),","+      Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293),","+      Compliance (98.7%), Open Complaints (34), AI Alerts (12)","     - KPI trend sparklines (12 months)","     - Charts row: rent collection 12-month trend vs 97% target;","       repairs monthly volume by priority with avg days line","-    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases","-      with countdown timers | AI insights scrolling feed","+    - Three panels: Big 6 compliance heatmap (6 tiles, % + RAG) |","+      Awaab's Law active cases with countdown timers |","+      AI insights scrolling feed","     - Activity timeline with real-time system event feed","-    - Persona-scoped views (COO sees org-wide; Officer sees their patch)","+    - Persona-scoped views (COO sees org-wide; Officer sees patch)","     - Quick action buttons for common tasks"," ","-2.2 Visual Drill-Down Explorer (Flagship Feature)","-    Route: /explore","-    Purpose: 7-level spatial hierarchy navigation","-    Hierarchy:","-      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant","+2.2 Visual Drill-Down Explorer (/explore) — FLAGSHIP","+    See Section 3 for full specification."," ","-    Layout:","-    +--------------------------------+---------------------------------+","-    |                                |  CONTEXT PANEL (scrollable)     |","-    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |","-    |                                |  - Attribute cards               |","-    |      Interactive Leaflet map   |  - Compliance status             |","-    |      OR Three.js 3D building   |  - KPI metrics                   |","-    |      depending on zoom level   |  - AI insights (purple section)  |","-    |                                |  - Children list (next level)    |","-    |                                |  - Quick actions                  |","-    +--------------------------------+---------------------------------+","-    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |","-    | Data layer toggles: Crime / Damp Risk / Compliance               |","-    +------------------------------------------------------------------+","-","+2.3 AI Morning Briefing (/briefing)","+    Purpose: Personalised daily briefing on login","     Features:","-    - Interactive Leaflet map with property markers (OpenStreetMap tiles)","-    - Three.js 3D building visualization (digital twin) at block level","-    - Context panel with attributes, KPIs, compliance, AI insights","-    - Color-coded units: green (compliant), amber (warning), red (critical),","-      purple (AI flag), grey (void)","-    - Data layer toggles: Crime, Damp Risk, Compliance","-    - Click-through navigation from any level","+    - Full-screen animated intro with Yantra mark","+    - Weather and environmental context for the day","+    - URGENT items with countdown timers","+    - TODAY'S TASKS: appointments, calls, letters, case reviews","+    - AI PREDICTIONS: what the model expects this week","+    - PATCH/PORTFOLIO SNAPSHOT: key numbers with trend arrows","+    - Estate selector with Neighbourhood Briefing panel","+    - [Start my day →] button to dashboard","+    - [Skip briefing] option"," ","-    Level Details:","-    L0 Country:     England centred, 3 regions, portfolio summary","-    L1 Region:      Zoomed to region, LA areas as markers","-    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts","-    L3 Estate:      Zoom 16-17, individual buildings as footprints","-    L4 Block:       Transition to 3D view (Three.js), building-level attributes","-                    (FRA, Building Safety Case, communal systems, asbestos plan,","-                    legionella, structural surveys)","-    L4a Core:       For multi-core buildings, schematic floor plan","-    L5 Unit:        Highlighted unit in building model, tabbed detail","-                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,","-                    Works History, Documents)","-    L6 Tenant:      Full tenant record with tabbed view","-    L7 Case:        Case detail with timeline","-","-2.3 Tenancies Management","-    Route: /tenancies, /tenancies/:id","-    Purpose: Tenancy lifecycle management","+2.4 Tenancies (/tenancies, /tenancies/:id, /tenancies/new)","+    Purpose: Full tenancy lifecycle management","     Features:","-    - Tenancy list with search (name, address, ID, officer), filter, sort","-    - 68 tenants with dynamic count subtitle","-    - Tenancy detail: household composition, rent account, case timeline","-    - Vulnerability detection (AI 7-factor scoring)","-    - Benefits entitlement check","-    - Arrears status with color-coded balance","-    - 52-week transaction ledger with balance trend chart","-    - Action workflows: arrears action, schedule visit, create case","-    - AI Dynamic Zone: holding reply buttons, follow-up task creators,","-      referral generators, communication drafters","+    - List view: search, filter (status, tenure, officer), sort, pagination","+    - Detail page (tabbed):","+      * Overview: tenant name, DOB, contact, household, emergency contact,","+        assigned officers, vulnerability flags, key dates, tenure type/status","+      * Cases: unified case timeline (filterable by type) — Complaint (CMP),","+        Repair (REP), ASB (ASB), Enquiry (ENQ), Financial (FIN),","+        Safeguarding (SAF), Damp/Mould (DAM)","+      * Activities: chronological log — calls, visits, letters, emails, SMS","+      * Tasks: outstanding/completed with due date, priority, linked case","+      * Statement (Rent Account): balance, weekly charge, payment method,","+        UC/HB status, rent breakdown, transaction ledger, 52-week statement,","+        balance trend chart, payment arrangement tracker","+      * Orders: Rent Order, Tenure Type, Service Charge, Garage/Parking,","+        Rechargeable Repair, Court Order, Leaseholder","+    - Vulnerability Panel (AI: 7-factor assessment)","+    - Benefits Panel (AI: UK entitlement analysis)","+    - AI dynamic actions zone"," ","-2.4 Properties Management","-    Route: /properties, /properties/:id, /properties/:id/apply,","-           /properties/:id/book-viewing","-    Purpose: Property and asset data management","+2.5 Properties (/properties, /properties/:uprn)","+    Purpose: Asset management with spatial awareness","     Features:","-    - Property list with mini Leaflet map in list view","-    - 75 properties with pagination","-    - Property detail: building attributes, compliance certificates, case history","-    - Property Passport (multi-source AI aggregation)","-    - Damp Intelligence Panel (5-factor predictive score)","-    - Compliance timeline (Big 6 certificates)","-    - Viewing bookings and allocation workflow","-    - Digital twin (3D block visualization)","-    - Application page for void properties","+    - List/map toggle view","+    - Mini Leaflet map in list view","+    - Detail page (tabbed):","+      * Overview: address, UPRN, type, bedrooms, floor area, heating, tenure,","+        current tenancy or void status, photos, accessibility features","+      * Compliance (unit-level): Gas Safety (CP12), EICR, EPC, Smoke & CO,","+        unit-specific asbestos, boiler details, Decent Homes assessment","+      * Stock Condition: component lifecycle table (roof, windows, kitchen,","+        bathroom, boiler, electrics — install year, condition 1-5, remaining","+        life, replacement cost)","+      * Damp & Mould / Awaab's Law: AI risk score 0-100, active cases with","+        countdown timers, IoT sensor data (simulated)","+      * Works History: all repairs/works with costs, annual spend trend","+      * Documents: certificates, reports, photos","+    - Damp Intelligence Panel (AI: 5-factor weighted algorithm)","+    - Property Passport (AI: multi-source aggregation)"," ","-2.5 Repairs Management","-    Route: /repairs, /repairs/:id","-    Purpose: Responsive and planned repairs case management","+2.6 Repairs (/repairs, /repairs/:id, /repairs/new, /repairs/schedule)","+    Purpose: Full repairs management lifecycle","     Features:","-    - 200+ repair cases with list/kanban toggle","-    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete","-    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)","-    - Appointment booking with time slots","-    - Operative notes, before/after photos","-    - Contractor verification badges (Gas Safe green, NICEIC blue)","-    - Satisfaction survey (post-completion)","-    - Recurrence prediction (AI)","-    - Cost tracking and authorisation workflow","-    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,","-      priority, trade, Awaab's Law flags","+    - List/Kanban toggle view","+    - Columns: ref, date, property, SOR category, priority, status,","+      operative, target date, days elapsed","+    - Kanban: status columns with priority colour borders","+    - New repair wizard: property lookup → free-text description →","+      AI auto-suggests SOR code/priority/trade/Awaab's Law flags →","+      appointment booking → risk assessment → confirm","+    - Detail page: priority-based SLA timer, SOR code, trade, appointment,","+      risk assessment, operative notes, photos before/during/after,","+      materials, satisfaction survey, first-time fix, Awaab's Law compliance","+    - Schedule: weekly calendar, operative schedules, capacity indicators","+    - Contractor verification badges (Gas Safe, NICEIC)","+    - AI: root cause analysis, recurrence prediction, cost comparison"," ","-2.6 Compliance Management","-    Route: /compliance, /compliance/:type, /compliance/awaabs-law","-    Purpose: Regulatory compliance tracking and Awaab's Law","+2.7 Rent & Income (/rent, /rent/accounts, /rent/accounts/:id, /rent/arrears)","+    Purpose: Financial management and arrears recovery","     Features:","-    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts","-    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER","-    - Awaab's Law dedicated page:","-      - Emergency hazard response: 24-hour countdown timer","-      - Significant hazard repair: 10-12 week countdown timer","-      - Risk register with property-level assessments","-      - Proactive inspection programme tracking","-    - Building-level compliance: FRA, Building Safety Case","-    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors","-    - Compliance failure prediction (AI)","-    - No-access tracker, contractor performance","+    - Arrears dashboard: total, by band (chart), collection rate gauge,","+      payment method breakdown","+    - AI-prioritised worklist: tenant details, arrears amount, 12-week","+      sparkline, AI score (1-100), risk factors, recommended action","+    - Account detail: statement view, transaction ledger","+    - UC tracking integration","+    - Sub-routes: accounts list, individual statements, arrears worklist"," ","-2.7 Complaints Management","-    Route: /complaints, /complaints/:id","-    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)","+2.8 Compliance (/compliance, /compliance/gas, /compliance/electrical,","+    /compliance/fire, /compliance/asbestos, /compliance/legionella,","+    /compliance/lifts, /compliance/awaabs-law)","+    Purpose: Big 6 regulatory compliance management","     Features:","-    - 34 complaints with status filtering","-    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)","-    - Deadline countdown timers with color-coded urgency","-    - Ombudsman escalation pathway","-    - Complaint escalation prediction (AI)","-    - Linked cases and evidence log","-    - TSM CH01/CH02 reporting integration","-    - Categories pie chart, findings breakdown, learning tracker","+    - Dashboard: 6 Big 6 cards with %, counts, trends, RAG","+    - Per-area pages: certificate list, filters, no-access tracker,","+      contractor performance","+    - Awaab's Law page: active cases with timers, risk register (all","+      properties with AI scores), proactive inspection programme","+    - Data layer toggles on Explore map"," ","-2.8 Anti-Social Behaviour (ASB)","-    Route: /asb, /asb/:id","-    Purpose: ASB case management with escalation pipeline","+2.9 Complaints (/complaints, /complaints/:id, /complaints/new)","+    Purpose: Two-stage complaint handling per Housing Ombudsman Code","     Features:","-    - 12 ASB cases with severity indicators","-    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession","-    - Evidence log with timestamps and categories","-    - Live Crime Context (Police.uk data correlation)","-    - ASB hotspot analysis per estate","-    - ASB escalation prediction (AI)","-    - Witness/victim support tracking","-    - Community Trigger threshold monitoring","-    - Multi-agency panel and referral forms","+    - Dashboard: Stage 1/2 counts, response % vs timescale,","+      TSM CH01/CH02, categories pie, findings breakdown, learning tracker","+    - New: tenant selection → free-text → AI categorises/assigns severity →","+      handler assignment → auto-acknowledgement","+    - Detail: two-stage timeline with countdown timers","+      (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD)","+    - Category, findings (upheld/partial/not), remedy, learning log,","+      Ombudsman escalation tracking"," ","-2.9 Rent & Arrears","-    Route: /rent","-    Purpose: Rent management and arrears recovery","+2.10 Allocations (/allocations, /allocations/voids, /allocations/lettings)","+    Purpose: Housing register & lettings management","     Features:","-    - Arrears dashboard with band analysis","-    - Pre-Action Protocol (PAP) checklist","-    - Arrears worklist with AI-prioritised scoring (1-100)","-    - Universal Credit tracking and verification","-    - Payment arrangement management","-    - Direct debit integration (GoCardless mock)","-    - HB/UC transition tracking","-    - Arrears risk prediction (AI)","-    - 12-month payment trend analysis","-    - Collection rate gauge, payment method breakdown","+    - Housing register: applicants by band (A-D), bedroom need, medical priority","+    - Void kanban: Notice → Keys → Inspection → Works → Quality → Ready →","+      Offer → Let","+    - Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss","+    - Lettings: available properties with viewing booking"," ","-2.10 Allocations & Lettings","-    Route: /allocations","-    Purpose: Void management and lettings workflow","+2.11 ASB (/asb, /asb/:id)","+    Purpose: Anti-social behaviour case management","     Features:","-    - Housing register management (Band A-D, bedroom need, medical priority)","-    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality","-      -> Ready -> Offer -> Let","-    - Void duration prediction (AI)","-    - Days void RAG indicators (green <14, amber 14-28, red >28)","-    - Applicant shortlisting and matching","-    - Viewing booking system","-    - Tenancy sign-up workflow","-    - CORE lettings/sales reporting","+    - Case list: ref, location, category, severity, status, handler, days open","+    - Detail: escalation pipeline visual tracker","+      (Warning → ABC → CPW → CPN → Injunction → Possession → Closure)","+    - Evidence log, multi-agency panel, risk assessment, Community Trigger check","+    - Crime context overlay from Police.uk data"," ","-2.11 Communications","-    Route: /communications","-    Purpose: Unified multi-channel inbox","+2.12 Communications (/communications, /communications/templates)","+    Purpose: Unified multi-channel communications hub","     Features:","-    - Unified inbox (email, SMS, letter, portal message)","-    - GOV.UK Notify template integration (24 templates, 7 categories)","-    - Template rendering with ((field)) personalisation","-    - Message history per tenant","-    - Bulk communications","-    - Auto-triggered notifications (repair booked, arrears warning, etc.)","+    - Unified inbox: all channels linked to tenant/property/case","     - AI triage: auto-categorise, priority, sentiment, suggested response","-    - Tone options: Supportive / Formal / Urgent / Legally required","+    - 5 message types with action buttons (Reply/Forward/Archive)","+    - GOV.UK Notify template manager (24 templates, 7 categories)","+    - Channels: email, phone, letter, SMS, portal, GOV.UK Notify"," ","-2.12 Reports & Analytics","-    Route: /reports, /reports/:type, /reports/tsm","-    Purpose: Regulatory reporting and operational analytics","+2.13 Reports (/reports, /reports/tsm, /reports/core, /reports/regulatory,","+    /reports/ombudsman, /reports/performance, /reports/financial,","+    /reports/stock-condition)","+    Purpose: Comprehensive reporting and regulatory returns","+    Sub-pages:","+    - TSM Annual Return (22 measures with actuals, targets, sector medians)","+    - CORE Lettings/Sales Logs (field validation, CSV export)","+    - Consumer Standards Self-Assessment (4 standards, evidence mapping)","+    - Complaint Handling Code Self-Assessment","+    - Building Safety Act Returns (higher-risk buildings)","+    - SDR for RSH","+    - Operational Performance (repairs, voids, arrears, complaints, ASB, contact)","+    - Financial (rent setting, service charge, repairs expenditure, bad debt, void loss)","+    - Stock Condition (quarterly/annual)","+    - Dynamic report page with 27+ reports","     Features:","-    - 27 regulatory reports","-    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking","-    - CORE lettings and sales returns","-    - Consumer Standards compliance scorecard","-    - Housing Ombudsman reporting","-    - Building Safety Act compliance reporting","-    - Dynamic report builder with filters","-    - CSV/PDF export capability","-    - Trend charts, sector median/quartile benchmarking","-    - AI-generated narrative summary per report","-    Report Categories:","-    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR","-    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre","-    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,","-      EPC/Energy","-    - Financial: Rent setting, service charge, repairs expenditure, bad debt,","-      void loss","-    - Governance: Board pack, risk register, H&S summary","-    - Tenant-facing: Annual report, estate reports","+    - Date range, property group, tenure type, comparison period","+    - CSV/PDF export","+    - Drill-down from aggregates","+    - Benchmarking vs targets/previous/sector","+    - AI-generated narrative summary","+    - Scheduled email distribution"," ","-2.13 AI Centre","-    Route: /ai-centre","-    Purpose: AI capabilities hub and differentiator showcase","+2.14 AI Centre (/ai, /ai/insights, /ai/predictions, /ai/assistant)","+    Purpose: Central hub for AI capabilities","     Features:","-    - Insights tab: AI-generated operational insights with confidence %,","-      affected entities, action buttons","-    - Predictions tab: 8 predictive models dashboard with scatter plots,","-      top-50 table, feature importance, accuracy gauges","-    - Differentiators tab: 7 killer differentiator feature cards with","-      vulnerability scan","-    - Assistant tab: Conversational AI interface (Yantra Assist)","+    - Insights feed: predictions, alerts, recommendations, analytics","+      with confidence %, affected entities, action buttons","+    - Predictions dashboard: Arrears (scatter + top 50 + feature importance),","+      Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)","+    - Differentiators tab: 6 feature cards + vulnerability scan","+    - Assistant: chat panel with natural language queries"," ","-2.14 AI Morning Briefing","-    Route: /briefing","-    Purpose: Personalised daily operational briefing","-    Features:","-    - Persona-aware greeting (\"Good morning Sarah, here's what needs your","-      attention today\")","-    - Weather forecast with property impact assessment","-    - Today's tasks with priority indicators and action buttons","-    - AI predictions and alerts","-    - Estate-level neighbourhood briefing accordion","-    - Compliance section with Big 6 stats","-    - [Start my day ->] and [Skip briefing] buttons","+2.15 Admin (/admin, /admin/organisation, /admin/users, /admin/teams,","+    /admin/workflows, /admin/integrations, /admin/audit, /admin/system)","+    Purpose: Full system administration suite","+    Sub-pages:","+    - Dashboard: system health, user activity, data quality, integration","+      status, AI model health","+    - Organisation: profile, branding, operational parameters","+    - Users: RBAC with 10 roles × permissions, custom roles, 2FA, sessions","+    - Teams: hierarchies, patch definition (map/postcode), caseload balancing","+    - Workflows: visual builder with triggers/conditions/actions/SLA timers,","+      pre-built templates","+    - Integrations: 20 integration cards with status, last sync, toggle,","+      test connection, tier badges, cache hit rate bars","+    - Audit: full trail, GDPR tools (SAR, erasure, retention, consent)","+    - System: reference data, form builder, notification config, AI config"," ","-2.15 Admin System","-    Route: /admin, /admin/integrations","-    Purpose: System configuration and management","+2.16 Tenant Portal (/tenant-portal, /tenant-portal/repairs,","+    /tenant-portal/rent, /tenant-portal/documents, /tenant-portal/contact)","+    Purpose: Tenant self-service with distinct warmer UI","     Features:","-    - Organisation profile and branding","-    - User management with RBAC (10 default roles x permission matrix)","-    - Team and patch management with caseload balancing","-    - Workflow engine (visual builder with triggers/conditions/actions)","-    - Integration hub (20 integrations across 3 tiers)","-    - Integration toggle, test connection, status monitoring","-    - Audit trail (full CRUD logging — timestamp, user, entity, field,","-      old/new value, IP)","-    - GDPR tools (SAR processor, right to erasure, retention policies,","-      consent management, Data Processing Register)","-    - System reference data configuration (editable lookup tables)","-    - Notification configuration","-    - AI model configuration (toggle on/off, confidence thresholds)","-    - White-label: multi-HA deployment support","+    - Visually distinct: lighter/warmer theme, simpler layout, larger text,","+      no jargon, large touch targets","+    - Dashboard: welcome, quick actions (report repair, check balance,","+      make payment, contact), active repairs, rent balance, appointments","+    - Report repair: conversational wizard — room → problem → sub-category →","+      photo → appointment → confirm. AI urgency detection.","+    - Rent: clear balance, simple transactions, payment button","+    - Quick message form with select/textarea"," ","-2.16 Tenant Portal","-    Route: /tenant-portal","-    Purpose: Tenant self-service interface","+2.17 Global Search (/search)","+    Purpose: Cross-entity search with instant results","     Features:","-    - Distinct lighter/warmer UI theme (visually separate from staff system)","-    - Report repair (conversational wizard: room -> problem -> photo ->","-      appointment -> confirm)","-    - Check rent balance and make payment","-    - View active repairs with photos and status","-    - Quick message to housing officer","-    - Document access","-    - Larger text, no jargon, large touch targets","+    - Search bar: dark input, magnifying glass, placeholder text","+    - Results grouped by entity type (tenant, property, case)","+    - Click-through to entity detail","+    - AI-enhanced relevance ranking"," ","-2.17 Global Search","-    Route: /search","-    Purpose: Cross-entity full-text search","-    Features:","-    - Global search bar in header","-    - Searches across tenants, properties, cases, communications","-    - Results grouped by entity type","-    - Direct navigation to entity detail"," ","-","-3. PERSONA SYSTEM","+3. VISUAL DRILL-DOWN EXPLORER (Flagship Feature)"," ================================================================================"," ","-3.1 Overview","-    5 operational personas with scoped data visibility and dashboard layout.","-    Persona selection via sidebar switcher. Persisted per session.","+3.1 Concept","+    The PRIMARY navigation experience. Users visually navigate from Country →","+    Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every","+    level, the right panel shows that level's attributes, KPIs, compliance,","+    and AI insights."," ","-3.2 Persona Definitions","+3.2 Layout","+    +--------------------------------+---------------------------------+","+    |                                |  CONTEXT PANEL (scrollable)     |","+    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |","+    |                                |  - Attribute cards               |","+    |      Interactive Leaflet map   |  - Compliance status             |","+    |      OR Three.js 3D building   |  - KPI metrics                   |","+    |      depending on zoom level   |  - AI insights (purple section)  |","+    |                                |  - AI dynamic actions (Doc 2)    |","+    |                                |  - Children list (next level)    |","+    |                                |  - Quick actions                  |","+    +--------------------------------+---------------------------------+","+    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |","+    | Data layer toggles: Crime / Damp Risk / Compliance               |","+    +------------------------------------------------------------------+"," ","-    PERSONA 1: Chief Operating Officer (COO)","-    Scope: Organisation-wide","-    Dashboard: High-level KPIs, financial summary, compliance overview,","-              risk heatmap","-    Access: Full read/write, admin settings, reports","-    AI Focus: Strategic — regulatory risk, portfolio compliance trends,","-              financial performance, TSM trajectory","-    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",","-                \"Benchmark against sector\"","+3.3 Hierarchy Levels"," ","-    PERSONA 2: Head of Housing","-    Scope: Regional (multiple Local Authorities)","-    Dashboard: Regional performance, team metrics, escalated cases","-    Access: Team management, regional reports, case oversight","-    AI Focus: Operational — SLA performance, team capacity, complaint trends","-    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"","+    Level 0: Country (/explore/country)","+    - Map: England centred (~52.5°N, 1.5°W, zoom 6)","+    - 3 operational regions with property count badges","+    - Panel: portfolio summary — total units, occupancy, compliance %,","+      total arrears, collection rate, TSM headlines, regional breakdown,","+      regulatory status (G1/V1), stock by tenure type (pie chart)"," ","-    PERSONA 3: Housing Manager","-    Scope: Estate/Block level","-    Dashboard: Estate KPIs, staff workload, compliance deadlines","-    Access: Case assignment, approval workflows, local reports","-    AI Focus: Team management — workload, case overdue, skill gaps","-    AI Actions: \"Reassign cases\", \"Generate patch briefing\"","+    Level 1: Region (/explore/region/:id)","+    - Map: zoomed to region (e.g. London, zoom 10)","+    - LA areas as markers sized by stock count, coloured by compliance","+    - Panel: compliance, arrears, voids, repairs backlog, LA breakdown,","+      stock profile, average EPC distribution"," ","-    PERSONA 4: Housing Officer (THE MOST IMPORTANT)","-    Scope: Assigned patch (specific estates/blocks)","-    Dashboard: Caseload worklist, today's visits, tenant alerts","-    Access: Case CRUD, tenant interactions, notes","-    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action","-    AI Actions: Richest set — holding reply buttons, follow-up task creators,","-                referral generators, communication drafters on every page","+    Level 2: Local Authority (/explore/region/:id/la/:id)","+    - Map: zoom 13, estates as clusters/polygons with mini-donut compliance","+    - Panel: properties, tenancies, voids, Big 6 compliance, estates list,","+      LA context (housing market, LHA rates, nomination agreements)"," ","-    PERSONA 5: Repairs Operative","-    Scope: Assigned jobs","-    Dashboard: Today's job list, materials, access notes","-    Access: Repair status updates, photos, completion notes","-    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags","-    No access to: Financial data, personal tenant details beyond job needs","+    Level 3: Estate (/explore/.../estate/:id)","+    - Map: zoom 16-17, individual buildings as footprints (green/amber/red)","+    - Panel: estate name, postcode, construction era, total units","+    - KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases","+    - Buildings list, estate management, communal areas, scheme type","+    - Neighbourhood Briefing Panel integrated"," ","+    Level 4: Block / Building (/explore/.../block/:id)","+    - TRANSITION TO 3D VIEW: Three.js procedurally generated building","+    - Rotate/zoom/pan with OrbitControls","+    - BUILDING-LEVEL ATTRIBUTES (not unit-level):","+      * Fire Risk Assessment: date, risk level, action plan status","+      * Building Safety Case (if higher-risk): accountable person, BSR","+      * Communal fire systems: detection, emergency lighting, compartmentation","+      * Asbestos management plan: building-level register","+      * Legionella risk assessment: water system, tanks, TMVs","+      * Structural surveys, roof, communal heating, lifts (LOLER), entry","+    - Units list: number, floor, bedrooms, tenure, occupancy, RAG"," ","-4. AI-NATIVE FEATURES","+    Level 4a: Core / Entrance (/explore/.../core/:id)","+    - For buildings with multiple cores (e.g. tower blocks)","+    - Schematic floor plan showing units per floor for this core","+    - Panel: core ID, floors served, units, stairwell, lift, fire escape","+","+    Level 5: Unit (/explore/.../unit/:id)","+    - 3D: highlighted unit within building model","+    - Panel (tabbed): Overview, Compliance (unit-level), Stock Condition,","+      Damp & Mould / Awaab's Law, Works History, Documents","+","+    Level 6: Tenant (/explore/.../tenant/:id)","+    - Panel (tabbed): Overview, Cases (unified timeline), Activities,","+      Tasks, Statement (Rent Account), Orders","+    - Case types with colour-coded references:","+      | Complaint  | CMP-YYYY-XXXXX | Orange |","+      | Repair     | REP-YYYY-XXXXX | Blue   |","+      | ASB        | ASB-YYYY-XXXXX | Red    |","+      | Enquiry    | ENQ-YYYY-XXXXX | Grey   |","+      | Financial  | FIN-YYYY-XXXXX | Amber  |","+      | Safeguarding | SAF-YYYY-XXXXX | Purple |","+      | Damp/Mould | DAM-YYYY-XXXXX | Teal   |","+","+    Level 7: Case Detail","+    - Common layout for all case types:","+      +----------------------------------------------------------+","+      | Case Header: Reference | Type Tag | Status | Priority     |","+      | Property: [link] | Tenant: [link] | Handler: name         |","+      +----------------------------------------------------------+","+      | STAGE TIMELINE (horizontal stepper with dates/countdowns) |","+      +---------------------------+------------------------------+","+      | Case Details (55%)        | Activity Feed (45%, scroll)  |","+      | Description, category,    | Chronological log of actions |","+      | attachments, AI analysis  | notes, letters, status       |","+      +---------------------------+------------------------------+","+      | Actions: [Assign] [Update] [Escalate] [Close] [AI]      |","+      +----------------------------------------------------------+","+","+","+4. PERSONA SYSTEM"," ================================================================================"," ","-4.1 Core Principle: Dynamic AI Interface Elements","+    5 personas determine what Yantra Assist shows and which AI dynamic","+    actions appear. User selects at login or switches via user menu.","+","+4.1 Persona 1: Chief Operating Officer / Director","+    Dashboard scope: Entire organisation","+    Yantra Assist focus: Strategic — regulatory risk, portfolio compliance","+      trends, financial performance, TSM trajectory, inspection readiness","+    AI dynamic actions: \"Generate board report\", \"Model rent increase","+      scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"","+","+4.2 Persona 2: Head of Housing / Head of Service","+    Dashboard scope: Their service area","+    Yantra Assist focus: Operational — SLA performance, team capacity,","+      complaint trends, void turnaround, allocations throughput","+    AI dynamic actions: \"Rebalance team caseloads\", \"Generate team performance","+      review\", \"Identify training needs from complaint patterns\"","+","+4.3 Persona 3: Team Manager / Patch Manager","+    Dashboard scope: Their patch/team","+    Yantra Assist focus: Team management — officer workload, overdue cases,","+      skill gaps, cover arrangements","+    AI dynamic actions: \"Reassign cases for officer on leave\", \"Generate","+      patch briefing\", \"Schedule team catch-up\"","+","+4.4 Persona 4: Housing Officer / Colleague (THE MOST IMPORTANT)","+    Dashboard scope: Personal caseload/patch","+    Yantra Assist shows: What to do TODAY — appointments, calls, tasks, cases","+    AI dynamic actions: Richest set — holding reply buttons, follow-up task","+      creators, referral generators, communication drafters, contractor","+      booking, escalation aids, resolution suggestions","+    Morning briefing: \"You have 3 urgent items, 12 tasks due, 2 tenancies","+      predicted to enter arrears. Heavy rain Thursday — 4 properties at","+      damp risk.\"","+","+4.5 Persona 5: Repairs Operative / Contractor","+    Dashboard scope: Simplified mobile-optimised layout","+    Yantra Assist shows: Today's jobs, access codes, risk alerts,","+      vulnerability flags, previous repair history","+    AI dynamic actions: \"Mark complete + take photo\", \"Order follow-on","+      materials\", \"Flag as requiring follow-up inspection\"","+    Restrictions: No financial data, limited personal tenant details","+","+","+5. AI-NATIVE FEATURES","+================================================================================","+","+5.1 Core Principle: Dynamic AI Interface Elements","     Every entity page has TWO zones:","-    1. Standard zone: Fixed fields, tabs, buttons — always present","-    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that","-       change based on context","+    1. Standard zone: fixed fields, tabs, buttons — always present","+    2. AI Dynamic zone: clearly-marked section with purple-tinted border","+       (--status-ai left border, --surface-elevated background) that","+       contains AI-generated elements that change based on context"," ","-    Dynamic elements include:","-    - Dynamic action buttons — only appear when AI determines they're relevant","-    - Dynamic info cards — contextual information the system thinks user needs","-    - Dynamic prompts — questions AI asks user, answering triggers workflows","-    - Dynamic warnings — alerts about this entity needing attention","-    - Dynamic information fields — calculated data not in standard layout","+    AI Dynamic zone contents:","+    - Dynamic action buttons (only appear when AI determines relevance)","+    - Dynamic info cards (contextual information for NOW)","+    - Dynamic prompts (AI questions that trigger automated workflows)","+    - Dynamic warnings (entity-specific alerts)"," ","-    Styling: Purple left border (--status-ai), --surface-elevated background,","-    \"*\" symbol prefix on AI-generated content","+5.2 Dynamic AI Fields","+    Not just buttons — AI adds information fields that don't exist in","+    the standard layout:","+    - Tenant page: \"Estimated household income: £24,000/year\"","+    - Property page: \"Carbon emission estimate: 4.2 tonnes/year\"","+    - Repair page: \"Similar repair average cost: £385\"","+    - Complaint page: \"Ombudsman determination risk: HIGH\"","+    - Building page: \"Estimated retrofit cost to EPC C: £8,200/unit\"","+    Displayed as subtle cards with --status-ai purple left border and","+    \"✦ AI estimate\" label."," ","-4.2 The AI Action Flow Pattern","-    Every AI dynamic button follows this pattern:","-    1. PRESENT: Button with brief explanation of WHY it's suggesting the action","-    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)","+5.3 The AI Action Flow Pattern","+    Every AI dynamic button follows this 7-step pattern:","+    1. PRESENT: Show button with explanation of WHY this action","+    2. PREVIEW: Click shows preview of what will happen","     3. EDIT: User can edit anything in the preview","     4. CONFIRM: User approves the action","-    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications","-    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input","-    7. LEARN: System records accept/modify/reject for model improvement","+    5. FOLLOW-UP: AI asks about follow-up tasks/cases/notifications","+    6. AUTO-CREATE: If confirmed, AI creates everything automatically","+    7. LEARN: System records accept/modify/reject for model feedback"," ","-4.3 Yantra Assist","-    Location: Bottom-left floating trigger (all pages)","-    Trigger: Yantra diamond mark at 32px with pulsing purple glow","-    Panel: 400px, slides from left, overlaying sidebar","-    Content changes based on current page/entity AND user persona","+5.4 Yantra Assist — Contextual AI Panel","+    Trigger: Fixed button bottom-left, Yantra diamond mark 32px with","+      pulsing --status-ai purple glow. Badge count for actionable items.","+    Panel: Slides in from left (400px), overlaying sidebar.","+    Content changes based on (a) current page/entity and (b) persona.","+    Structure:","+    - 🔴 URGENT: items needing immediate action","+    - 🟠 ATTENTION: items approaching deadlines","+    - 💡 INSIGHTS: AI predictions & recommendations","+    - 📊 BRIEFING: contextual summary & key stats","+    - 🌤️ EXTERNAL FACTORS: weather, UC changes, local context","+    - Chat input: \"Ask Yantra...\" natural language queries"," ","-    Panel Structure:","-    - RED URGENT: Items needing immediate action","-    - ORANGE ATTENTION: Items approaching deadlines","-    - INSIGHTS: AI predictions & recommendations","-    - BRIEFING: Contextual summary & key stats","-    - EXTERNAL FACTORS: Weather, UC changes, local context","-    - [Ask Yantra...] chat input at bottom","+5.5 AI-Augmented Workflows","+    a) Logging a Repair:","+       Describe issue → AI categorises (SOR code), assigns priority,","+       identifies trade, checks asbestos, checks vulnerability, detects","+       recurring pattern, estimates cost, suggests appointment, drafts","+       access instructions, flags Awaab's Law","+    b) Handling Inbound Contact:","+       AI reads/summarises → categorises → suggests action → auto-creates","+       case if confirmed → asks about follow-ups","+    c) Sending Communication:","+       User triggers → AI generates draft → tone options → after sending,","+       asks about follow-up task → links to case","+    d) Reviewing Compliance:","+       AI shows what WILL expire, TSM score impact, pre-drafted contractor","+       instructions, pre-booked slots, no-access risk predictions"," ","-    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)","+5.6 Signature Interactions","+    1. \"Holding Reply\" Flow — overdue repair → AI drafts update → send →","+       create follow-up → auto-escalate if still not done","+    2. \"Inbound Email Triage\" Flow — email → AI categorises → create case →","+       appointment → tenant confirmation","+    3. \"Proactive Damp Prevention\" Flow — weather forecast → building risk →","+       preventive advice letters → follow-up inspections","+    4. \"Compliance Cascade\" Flow — overdue certs → book all → letters →","+       calendar → no-access escalation","+    5. \"Complaint Prevention\" Flow — multiple calls + declining satisfaction →","+       prevention plan → urgent repair + apology + goodwill"," ","-4.4 Prediction Models (8 total)","-    MODEL 1: Arrears Risk","-      Input: Payment history, UC status, seasonal patterns, life events","-      Output: Risk score (0-100), predicted arrears amount, recommended actions","+5.7 External Data Sources (simulated)","+    - Met Office weather: rain/temperature affecting damp and outdoor works","+    - DWP/UC: benefit changes, managed migration, income impact","+    - Regulator of Social Housing: inspection updates, sector benchmarks","+    - Housing Ombudsman: recent determinations, Code updates","+    - Energy prices: fuel poverty risk, heating behaviour predictions","+    - Local authority: planning, roadworks, school terms (ASB patterns)"," ","-    MODEL 2: Damp & Mould Risk","-      Input: Weather (0.25), building age/type (0.25), repair history (0.20),","-             IoT sensors (0.20), occupancy (0.10)","-      Output: Risk score (0-100), factor breakdown, proactive recommendations"," ","-    MODEL 3: Complaint Escalation","-      Input: Response times, complaint category, tenant history, complexity","-      Output: Escalation probability, recommended priority, deadline warnings","+6. PREDICTIVE INTELLIGENCE ENGINE","+================================================================================"," ","-    MODEL 4: Void Duration","-      Input: Property type, condition, location, market demand, works needed","-      Output: Predicted void days, optimal marketing strategy","+    8 prediction models with real-time scoring:"," ","-    MODEL 5: Repair Recurrence","-      Input: Component age, repair history, building type, contractor quality","-      Output: Recurrence probability, recommended planned maintenance","+    | Model                | Predicts                              | Score   |","+    |----------------------|---------------------------------------|---------|","+    | Arrears Risk         | Tenancy enters arrears in 30/60/90d   | 0-100   |","+    | Damp & Mould         | Property develops damp/mould           | 0-100   |","+    | Complaint Escalation | Complaint reaches Stage 2/Ombudsman    | % prob  |","+    | Void Duration        | How long a void will take              | Days    |","+    | Repair Recurrence    | Repair will recur; root cause          | % prob  |","+    | Vulnerability        | Tenant may be vulnerable (unidentified)| Flags   |","+    | ASB Escalation       | Case requires legal action             | % prob  |","+    | Compliance Failure   | Property fails before cert expiry      | % prob  |"," ","-    MODEL 6: Vulnerability Detection","-      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),","-             social isolation (0.15), age risk (0.10), dependents (0.10),","-             UC transition (0.10)","-      Output: Vulnerability score (0-100), detected flags, recommended support","+    Each model shows on /ai/predictions with: scatter plot, top-50 table,","+    feature importance chart, accuracy metrics (precision/recall/F1 gauges),","+    last trained date."," ","-    MODEL 7: ASB Escalation","-      Input: Case history, estate context, crime data, tenant profile","-      Output: Escalation risk, recommended intervention level"," ","-    MODEL 8: Compliance Failure","-      Input: Certificate expiry, contractor availability, building complexity","-      Output: Failure probability, priority scheduling recommendations","+7. SEVEN KILLER DIFFERENTIATORS","+================================================================================"," ","-4.5 Seven Killer Differentiators (All Implemented)","-    D1: Predictive Damp Intelligence — 5-factor weighted algorithm","-        Service: server/src/services/damp-prediction.ts","-        Frontend: DampIntelligencePanel component on property detail","+    These composite features combine internal data with external public APIs","+    to produce intelligence no competitor can match."," ","-    D2: Live Crime Context for ASB — Police.uk data correlation","-        Service: server/src/services/crime-context.ts","-        Frontend: Crime data layer on Explore map, ASB detail page","+7.1 D1: Predictive Damp Intelligence","+    Service: server/src/services/damp-prediction.ts","+    Algorithm: 5-factor weighted scoring","+      - Weather factor (0.25): temperature, humidity, precipitation, dew point","+      - Building factor (0.25): construction type, EPC, insulation, orientation","+      - History factor (0.20): previous damp repairs, frequency, severity","+      - Sensor factor (0.20): IoT data (humidity, temperature, moisture)","+      - Occupancy factor (0.10): household size, ventilation behaviour","+    Output: Risk score 0-100 per property with factor breakdown","+    Frontend: DampIntelligencePanel component on property detail","+    Data sources: Open-Meteo, EPC, internal repairs, IoT mock"," ","-    D3: Automatic Vulnerability Detection — 7-factor scoring","-        Service: server/src/services/vulnerability-detection.ts","-        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan","+7.2 D2: Live Crime Context for ASB","+    Service: server/src/services/crime-context.ts","+    Algorithm: Police.uk data correlation with internal ASB cases","+    Features: Crime heatmap overlay, hotspot analysis, multi-agency referral","+    Frontend: Crime data layer on Explore map, ASB case context card","+    Data sources: Police.uk, internal ASB cases"," ","-    D4: Property Passport — Multi-source property dossier","-        Service: server/src/services/property-passport.ts","-        Frontend: Property detail page aggregation","+7.3 D3: Automatic Vulnerability Detection","+    Service: server/src/services/vulnerability-detection.ts","+    Algorithm: 7-factor scoring","+      - Deprivation (IMD decile)","+      - Arrears pattern","+      - Health indicators","+      - Isolation (contact frequency)","+      - Age (elderly, young)","+      - Dependents","+      - UC transition","+    Output: Overall score + individual factor scores + detected flags + actions","+    Frontend: VulnerabilityPanel on tenancy detail","+    Data sources: IMD, Census, NOMIS, internal data"," ","-    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules","-        Service: server/src/services/benefits-engine.ts","-        Frontend: BenefitsPanel on tenancy detail","+7.4 D4: Benefits Entitlement Engine","+    Service: server/src/services/benefits-engine.ts","+    Algorithm: UK 2025/26 benefit rules analysis","+    Benefits checked: UC, Housing Benefit, PIP, Attendance Allowance,","+      Pension Credit, Council Tax Reduction, Warm Home Discount, Winter","+      Fuel Payment, Free School Meals","+    Output: Entitlement list with status, amounts, unclaimed totals","+    Frontend: BenefitsPanel on tenancy detail","+    Data sources: DWP mock, NOMIS, household composition"," ","-    D6: AI Neighbourhood Briefing — Per-estate daily intelligence","-        Service: server/src/services/neighbourhood-briefing.ts","-        Frontend: NeighbourhoodBriefingPanel on briefing page","+7.5 D5: Property Passport","+    Service: server/src/services/property-passport.ts","+    Algorithm: Multi-source property dossier aggregation","+    Sources: EPC, Gas Safe, EICR, UPRN, flood risk, IMD, crime, weather","+    Output: Comprehensive property intelligence document"," ","-    D7: IoT Sensor Integration — Switchee/Aico device support (mock)","-        Service: server/src/services/mock-services.ts","-        Frontend: Property detail page (sensor data display)","+7.6 D6: AI Neighbourhood Briefing","+    Service: server/src/services/neighbourhood-briefing.ts","+    Algorithm: Per-estate daily intelligence combining all data sources","+    Sections: 6 summary cards + officer briefing + action items","+    Frontend: NeighbourhoodBriefingPanel on briefing page and estate detail"," ","-4.6 AI-Augmented Workflows","-    - Repair Logging: Tenant describes issue -> AI categorises SOR code,","-      assigns priority, identifies trade, checks asbestos, checks vulnerability,","-      checks recurring pattern, estimates cost, flags Awaab's Law","-    - Inbound Contact Triage: AI reads/summarises contact, categorises,","-      suggests appropriate case type, pre-fills forms","-    - Communication Sending: AI generates drafts using correct templates,","-      tenant details, plain English, legally required wording, tone options","-    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted","-      contractor instructions, pre-booked appointments","-    - Complaint Prevention: AI detects patterns (multiple calls, declining","-      satisfaction), generates prevention plan","+7.7 D7: GOV.UK Notify Integration","+    Service: server/src/services/govuk-notify.ts","+    Templates: 24 templates across 7 categories","+    Categories: rent-arrears (5), repairs (4), asb (3), compliance (3),","+      tenancy (3), damp-mould (3), general (3)","+    Features: Personalisation rendering, multi-channel (email/SMS/letter),","+      delivery tracking, tone selection"," ","-4.7 Signature AI Interactions","-    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task","-    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)","-    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference","-       -> preventive advice letters -> inspection tasks","-    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar","-    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution"," ","-","-5. DATA MODEL (SUMMARY)","+8. DATA MODEL SUMMARY"," ================================================================================"," ","-5.1 Core Entities","-    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance","-    - Tenant (68 records) — name, contact, vulnerability, household, UC status","-    - Tenancy — property-tenant link, start date, type, rent, balance","-    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould","-    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor","-    - Complaint (34 records) — stage, deadlines, Ombudsman reference","-    - ASB (12 records) — severity, escalation level, evidence log","-    - Activity — timeline events for any entity","-    - Task — assigned work items with due dates","+    Full TypeScript type definitions in app/src/types/index.ts"," ","-5.2 Supporting Entities","-    - Organisation — RCHA metadata, branding, settings","-    - Region (5 seeded) — London, South, Midlands, etc.","-    - Local Authority — Southwark, Lewisham, Lambeth","-    - Estate (5) — name, location, block count, manager","-    - Block (8) — floors, cores, unit count","-    - User — auth profile, role, persona, team","-    - Team — name, manager, patch, members","-    - Integration — external service config (20 integrations)","-    - Report — template definitions (27 reports)","-    - ExternalDataCache — TTL-based cache for API responses","+8.1 Core Entity Types","+    - Region, LocalAuthority, Estate, Block (geography hierarchy)","+    - Property (type, tenure, compliance, EPC, heating, dampness)","+    - Tenant (demographics, financial, UC status, vulnerability)","+    - Case (unified: complaint, repair, ASB, financial, damp-mould, etc.)","+    - Activity (call, visit, letter, email, SMS, note)","+    - Task (pending, in-progress, completed, overdue)","+    - Communication (multi-channel with sentiment, delivery tracking)"," ","-5.3 Firestore Collections (17+)","-    organisations, regions, localAuthorities, estates, blocks,","-    properties, tenants, cases, activities, communications,","-    rentTransactions, users, auditLog, notifications,","-    voidProperties, applicants, tsmMeasures, externalDataCache,","-    hactCodes, imdData","+8.2 Financial Types","+    - RentTransaction (charge, payment, adjustment, HB, UC)","+    - ServiceCharge (weekly, annual, apportionment)","+    - FinancialCase (arrears tracking, payment arrangements)"," ","-5.4 Case Reference Formats","-    | Type        | Format           | Colour  |","-    |-------------|------------------|---------|","-    | Complaint   | CMP-YYYY-XXXXX   | Orange  |","-    | Repair      | REP-YYYY-XXXXX   | Blue    |","-    | ASB         | ASB-YYYY-XXXXX   | Red     |","-    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |","-    | Financial   | FIN-YYYY-XXXXX   | Amber   |","-    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |","-    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |","+8.3 Compliance Types","+    - ComplianceCertificate (gas, electrical, fire, asbestos, legionella, lift)","+    - Per-certificate detail (readings, observations, classifications)","+    - Contractor verification (registration numbers)"," ","-5.5 TypeScript Type System (721 lines)","-    Frontend types defined in app/src/types/index.ts covering:","-    - 6 persona/user types (Persona, User)","-    - 7 geography types (Region, LocalAuthority, Estate, Block)","-    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)","-    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)","-    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)","-    - 8 activity/task types (Activity, Task, RentTransaction, etc.)","-    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)","-    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)","-    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)","-    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)","+8.4 Allocations Types","+    - VoidProperty (stage pipeline, days void, rent loss)","+    - Applicant (band A-D, bedroom need, local connection)"," ","+8.5 AI Types","+    - AiInsight (prediction, alert, recommendation, analysis)","+    - AiAction (workflow steps with preview/edit/confirm/followup)","+    - DampRiskBreakdown (5 weighted factors, overall score)","+    - VulnerabilityAssessment (7 factors, overall score)","+    - AuditEntry (timestamp, user, entity, field, old/new values, IP)"," ","-6. USER INTERFACE DESIGN","+8.6 External Data Types","+    - CrimeIncident, DeprivationProfile, AreaDemographics","+    - LabourMarket, FloodAlert, WeatherDetail, WeatherWarning","+    - SensorReading, SensorAlert, UcStatus","+    - Integration (20 external system records)","+","+","+9. UI/UX DESIGN LANGUAGE"," ================================================================================"," ","-6.1 Theme","-    Brand: Yantra Works dark theme","-    Primary Background: --surface-dark (#0D1117)","-    Card Background: --surface-card (#151B23)","-    Elevated: --surface-elevated (#1C2333)","-    Hover: --surface-hover (#222D3D)","-    Accent: --brand-teal (#058995)","-    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)","-    AI Colour: --status-ai (#A371F7) — purple for all AI elements","-    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)","+9.1 Colour Palette — Yantra Works Official Brand"," ","-6.2 Typography","-    Headings: \"Space Grotesk\", sans-serif — bold, technical","-    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)","-    Monospace: \"JetBrains Mono\", monospace — references, codes","-    Headings in --brand-peach on dark backgrounds","-    Section labels: --brand-teal, uppercase, letter-spaced","+    Brand:","+    --brand-peach: #EFAC92     (headings & accents)","+    --brand-garnet: #BE3358    (CTAs, critical alerts)","+    --brand-teal: #058995      (logo, labels, primary identity, links)","+    --brand-blue: #5BA4AA      (charts, secondary highlights)","+    --brand-soft: #ACC0B5      (metadata text, secondary text)","+    --brand-deep: #1A5A5E      (dark panels, sidebars)"," ","-6.3 Layout","-    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items","-    - Top header with logo, global search, notifications, AI trigger, user menu","-    - Breadcrumb navigation reflecting hierarchy","-    - Main content area with responsive grid (max 1400px)","-    - Yantra Assist floating panel (bottom-left)","-    - Phase banner: garnet \"BETA\" tag","+    Dark Theme Surfaces:","+    --surface-dark: #0D1117    (page background)","+    --surface-card: #151B23    (card/panel backgrounds)","+    --surface-elevated: #1C2333 (modals, dropdowns, elevated)","+    --surface-hover: #222D3D   (hover states)"," ","-6.4 Navigation Items (Sidebar)","-    NAVIGATE: Explore, Dashboard","-    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,","-            Complaints, Allocations, ASB","-    COMMUNICATE: Communications","-    ANALYSE: Reports, AI Centre","-    SYSTEM: Admin, Settings","-    + Persona Switcher","+    Text:","+    --text-primary: #E6EDF3    (primary text)","+    --text-secondary: #ACC0B5  (secondary = brand-soft)","+    --text-muted: #6B7B8D      (timestamps, IDs, low-priority)"," ","-6.5 Design Principles","-    - Dark mode is default — Yantra Works brand palette throughout","-    - Mobile-aware responsive design","-    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)","-    - Skip-to-content link","-    - Reduced-motion support (@media prefers-reduced-motion)","-    - Focus-visible outlines on all interactive elements","-    - Screen-reader-only (.sr-only) text for context","-    - Animations throughout — staggered reveals, sliding panels, smooth","-      transitions, pulsing alerts. UI must feel ALIVE, not static.","-    - UK conventions: DD/MM/YYYY, British English, GBP","+    Borders:","+    --border-default: #2A3545","+    --border-focus: #EFAC92    (focus ring — peach on dark)"," ","-6.6 Component Library (16 shared components)","-    - KpiCard — metric display with trend sparkline","-    - StatusPill — status badge (green/amber/red)","-    - ActionModal — accessible form modal with focus trap, Escape handler,","-      aria attributes, form validation, previous focus restoration","-    - AiActionCard — purple-bordered AI suggestion card","-    - CountdownTimer — deadline countdown with color urgency transitions","-      (green -> peach -> garnet -> pulsing garnet)","-    - PropertyMap — Leaflet map with markers","-    - HelpDrawer — full-screen contextual help (20 topics)","-    - DampIntelligencePanel — damp risk factor display with score badge","-    - VulnerabilityPanel — 7-factor vulnerability assessment","-    - BenefitsPanel — entitlement list with status icons, unclaimed amounts","-    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions","-    - ProtectedRoute — Firebase auth guard component","-    - YantraAssist — slide-in panel (320px from right) with context-aware","-      content, chat interface, urgency sections","+    Semantic Statuses:","+    --status-compliant: #2EA043 (green)","+    --status-warning: #EFAC92   (peach/amber)","+    --status-critical: #BE3358  (garnet)","+    --status-info: #5BA4AA      (blue)","+    --status-ai: #A371F7        (purple — AI features)","+    --status-void: #6B7B8D      (grey)"," ","+9.2 Typography","+    - Headings: \"Space Grotesk\", sans-serif — bold, technical","+    - Body: \"Inter\", Arial, sans-serif — clean, readable","+    - Monospace: \"JetBrains Mono\", monospace — references, codes","+    - Body size: 15px. Line height: 1.6 body, 1.2 headings","+    - Headings in --brand-peach on dark backgrounds","+    - Section labels: --brand-teal, uppercase, letter-spaced"," ","-7. REGULATORY COMPLIANCE","+9.3 Design Principles","+    - Dark mode is default (--surface-dark background)","+    - Max content width: 1400px (except full-bleed maps)","+    - Cards: --surface-card, 4px left colour border for RAG, 8px rounded","+    - Status tags: pill-shaped, semi-transparent","+    - Countdown timers: large monospace digits, colour transitions","+      green → peach → garnet → pulsing garnet","+    - Tables: --surface-card, --surface-hover on hover, sortable","+    - Buttons: --brand-teal primary, --surface-elevated secondary,","+      --brand-garnet destructive, --status-ai purple for AI","+    - Charts: teal primary, blue secondary, peach highlights, garnet alerts","+    - Subtle background grid/dot pattern at 3% opacity","+    - UK date format DD/MM/YYYY, British English, GBP £","+    - Animations throughout: staggered reveals, sliding panels, smooth","+      transitions, pulsing alerts — UI must feel ALIVE","+","+9.4 Navigation Structure","+    Persistent left sidebar (280px, collapsible to 64px icons-only):","+    - Background: --surface-card","+    - Active: --brand-teal left border + tinted background","+    - Sections: NAVIGATE, MANAGE, COMMUNICATE, ANALYSE, SYSTEM","+","+    Top header bar (--surface-dark):","+    - Left: Yantra logo + \"SocialHomes.Ai\" branding","+    - Centre: Global search bar","+    - Right: Notification bell, AI Assist button, User avatar + persona","+","+    Breadcrumbs on every page","+    Phase banner: --brand-garnet \"BETA\" tag","+","+9.5 Accessibility (WCAG 2.2 AA)","+    - Focus trap on modals (Tab wrapping, Escape key)","+    - ARIA labels: role=\"dialog\", aria-modal, aria-labelledby, aria-describedby","+    - Form validation: noValidate + custom, aria-required, aria-invalid","+    - Skip-to-content link + id=\"main-content\" on <main>","+    - Nav: aria-label=\"Main navigation\"","+    - Focus-visible outline styles","+    - @media (prefers-reduced-motion: reduce) disables animations","+    - .sr-only screen reader class","+    - Keyboard navigation throughout","+","+","+10. REGULATORY & COMPLIANCE FRAMEWORK"," ================================================================================"," ","-7.1 Housing Regulations Supported","-    - Housing Ombudsman Complaint Handling Code (2024)","-    - Awaab's Law (Social Housing Regulation Act 2023)","-    - Building Safety Act 2022","-    - Regulator of Social Housing (RSH) Consumer Standards","-    - Tenant Satisfaction Measures (TSM) Standard","-    - CORE lettings and sales data collection","-    - Gas Safety (Installation and Use) Regulations 1998","-    - Electrical Safety Standards in the Private Rented Sector","-    - Regulatory Reform (Fire Safety) Order 2005","-    - Control of Asbestos Regulations 2012","-    - Legionella risk assessment (HSE ACoP L8)","-    - LOLER (Lifting Operations and Lifting Equipment Regulations)","+10.1 UK Housing Regulation","+    - Regulator of Social Housing (RSH): Consumer Standards 2024","+    - Housing Ombudsman: Complaint Handling Code","+    - Building Safety Act 2022: higher-risk buildings (≥18m/≥7 storeys)","+    - Decent Homes Standard (including new damp/mould criterion)","+    - Awaab's Law: mandatory timescales for damp/mould","+    - Social Housing (Regulation) Act 2023"," ","-7.2 GDPR Compliance","-    - Full audit trail on all data operations","-    - Subject Access Request (SAR) processor","-    - Right to erasure workflow","-    - Data retention policy configuration","+10.2 Awaab's Law Compliance","+    Emergency cases (24hrs for all actions):","+    - Investigate, hazard summary, make safe, begin repair","+    Significant hazard cases:","+    - Investigate within 10 working days","+    - Provide hazard summary within 3 working days of investigation","+    - Complete safety works within 5 working days","+    - Begin repair works within 12 weeks","+    Countdown timers displayed prominently with colour transitions.","+","+10.3 Tenant Satisfaction Measures (TSM)","+    22 indicators reported annually to RSH:","+    - 12 Tenant Perception measures (survey-based)","+    - 10 Management Information measures (system-generated)","+    - CH01/CH02: Complaints handling","+    - BS01-BS06: Building safety (gas, electrical, fire, etc.)","+    - RP01/RP02: Repairs performance","+    - NM01: Anti-social behaviour","+    - TSM report page with actuals, targets, sector medians, quartiles","+","+10.4 GDPR / Data Protection","+    - Subject Access Request processing","+    - Right to Erasure workflow","+    - Data retention policies","     - Consent management","     - Data Processing Register","+    - PII sensitivity controls on vulnerability data"," ","-7.3 Accessibility (WCAG AA)","-    - Focus traps in modals (ActionModal)","-    - Skip-to-content link (Layout component)","-    - Keyboard navigation (Tab, Escape)","-    - ARIA labels, roles, described-by","-    - Reduced-motion media query","-    - Color contrast ratio >= 4.5:1","-    - Screen-reader-only text (.sr-only)","-    - Focus-visible outlines (*:focus-visible)"," ","-","-8. NON-FUNCTIONAL REQUIREMENTS","+11. NON-FUNCTIONAL REQUIREMENTS"," ================================================================================"," ","-8.1 Performance","-    - API response time (P95): < 500ms (current ~200-300ms)","-    - Frontend bundle size: < 3MB (current ~2.5MB)","-    - Cloud Run cold start: < 3s (current < 2s)","-    - Firestore query latency: < 200ms","-    - AI response latency (target): < 3s for conversational queries","+11.1 Performance","+    - API response time (P95): < 500ms (current: ~200-300ms)","+    - AI response latency (Vertex AI target): < 3s conversational","+    - Streaming first token: < 500ms","+    - Bundle size: < 3MB (current: ~2.5MB)","+    - Cloud Run cold start: < 3s (current: < 2s)"," ","-8.2 Security","-    - Firebase Authentication with Google sign-in","-    - RBAC with 10 default roles (super-admin through read-only)","-    - CSP headers with whitelist","-    - CORS restricted to allowed origins","-    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)","-    - Security headers (Permissions-Policy, X-Content-Type-Options,","-      X-Frame-Options, Referrer-Policy, HSTS)","-    - Secret Manager for all credentials (no secrets in code)","-    - JSON body limit 1MB","-    - Request correlation via X-Request-ID","+11.2 Reliability","+    - External API uptime: > 99.5% with fallback (current: 100%)","+    - WebSocket stability target: > 99.9%","+    - Graceful degradation: all external calls have simulated fallbacks"," ","-8.3 Scalability","-    - Cloud Run: 0-10 instances (auto-scaling)","-    - Firestore: NoSQL, horizontally scalable","-    - External API caching reduces load","-    - Concurrency: 80 requests/instance","+11.3 Security","+    - Firebase Authentication (Google SSO + email/password)","+    - Persona-based RBAC (5 levels × per-module permissions)","+    - CSP headers (whitelist for Google APIs, Firebase, OSM, Fonts)","+    - CORS tightened to allowed origins","+    - Rate limiting: 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)","+    - Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy","+    - Request correlation IDs (X-Request-ID)","+    - JSON body limit: 1MB","+    - Secret Manager for all credentials"," ","-8.4 Availability","-    - Cloud Run SLA: 99.95%","-    - External API fallbacks (simulated data on failure)","-    - Health check with Firestore connectivity monitoring","-    - States: healthy / degraded / unhealthy","+11.4 Testing","+    - Selenium test pass rate: 99.7% (330/331)","+    - TypeScript errors: 0","+    - Target unit test coverage: > 80%","+    - Target Selenium route coverage: > 95%","+    - Target Lighthouse accessibility: > 90"," ","-8.5 Testing","-    - Selenium E2E: 331 tests, 99.7% pass rate","-    - Unit tests: 66 tests for public data APIs","-    - TypeScript: 0 errors (strict mode)","-    - Vite build: 0 critical warnings","+11.5 Scalability","+    - Cloud Run auto-scaling: 0-10 instances","+    - Firestore: serverless, auto-scaling","+    - Target: 100 concurrent users with P95 < 1s"," ","+11.6 Monitoring","+    - Health endpoint: /health (Firestore connectivity, memory, uptime)","+    - Admin monitoring endpoint: /api/v1/admin/monitoring","+    - Metrics: request counts, response times, status codes, cache stats","+    - Telegram notifications via @SocialHomesBot"," ","-9. SIMULATED DATA","+","+12. SIMULATED DATA & DEMO ENVIRONMENT"," ================================================================================"," ","-9.1 Scale","-    75 properties, 68 active tenancies, 5 voids","-    Realistic SE London postcodes, 12-digit UPRNs","-    Diverse tenant names reflecting London demographics","+12.1 Data Volume","+    - 75 properties across 5 estates","+    - 68 active tenants (diverse SE London demographics)","+    - 279+ cases (repairs, complaints, ASB, financial, damp/mould)","+    - 200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)","+    - 34 open complaints (28 Stage 1, 6 Stage 2)","+    - 12 ASB cases","+    - 8 damp/mould cases (3 emergency, 5 significant)","+    - 25 financial cases","+    - 5 voids at various stages"," ","-9.2 Financial Profile","-    Rents: social GBP 95-140/week, affordable GBP 140-200/week","-    Service charges: GBP 5-35/week","-    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%","-    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k","+12.2 Financial Profile","+    - Rents: social £95-140/week, affordable £140-200/week","+    - Service charges: £5-35/week","+    - Payment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%","+    - Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k"," ","-9.3 Cases","-    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)","-    34 open complaints (28 Stage 1, 6 Stage 2)","-    12 ASB cases","-    8 damp/mould cases (3 emergency, 5 significant)","-    25 financial cases","-    5 voids at various pipeline stages","+12.3 Compliance Profile","+    - Gas: 99.4%, Electrical: 97.8%, Fire: 99.1%","+    - Asbestos: 98.5%, Legionella: 99.0%, Lifts: 100%","+    - Repairs SLA: Emergency 95%<24hrs, Urgent 88%<5d, Routine 82%<28d","+    - First-time fix: 78%, Satisfaction: 3.8/5","+    - Complaint response within timescale: 91%"," ","-9.4 Compliance","-    Gas 99.4%, Electrical 97.8%, Fire 99.1%","-    Asbestos 98.5%, Legionella 99.0%, Lifts 100%","+12.4 Demo Users","+    - Sarah Mitchell (Housing Officer) — default login persona","+    - Additional personas available via persona switcher"," "," ","-10. CURRENT STATUS & METRICS","+13. CURRENT IMPLEMENTATION STATUS"," ================================================================================"," ","-10.1 Production Deployment","-    URL: https://socialhomes-587984201316.europe-west2.run.app","-    Region: europe-west2 (London)","-    Status: LIVE and operational","-    Database: 460+ documents across 17+ Firestore collections","+    Phase 0: Infrastructure — DONE (10/10)","+    Phase 1: Foundation — DONE (12/12)","+    Phase 2: Intelligence — DONE (14/14)","+    Phase 3: Enrichment — DONE (14/17, 3 deferred)","+    Phase 4: Completion — DONE (11/14, 3 deferred)","+    Phase 5: Evolution — TODO (2/50 done, 48 remaining)"," ","-10.2 Build Metrics","-    | Metric                    | Value           |","-    |---------------------------|-----------------|","-    | Frontend modules          | 3,397           |","-    | Frontend build time       | ~35-39 seconds  |","-    | Backend TypeScript errors | 0               |","-    | Frontend TypeScript errors| 0               |","-    | Selenium tests            | 331             |","-    | Selenium pass rate        | 99.7%           |","-    | Unit tests (public data)  | 66              |","-    | Firestore collections     | 17+             |","-    | Seeded properties         | 75              |","-    | Seeded tenants            | 68              |","-    | Seeded cases              | 279+            |","-    | API endpoints             | 50+             |","-    | Frontend routes           | 40+             |","-    | Lines of code             | ~24,000         |","-    | Frontend TypeScript files | 73              |","-    | Backend TypeScript files  | 43              |","-    | Type definitions          | 721 lines       |","+    All 40+ frontend pages functional — no \"coming soon\" placeholders","+    331 Selenium tests | 330 PASS | 1 WARN | 99.7% pass rate","+    20 external API integrations (9 live, 11 mock)","+    7 AI differentiator services operational","+    24 GOV.UK Notify templates","+    Full RBAC, rate limiting, CSP, monitoring in place"," ","-10.3 Phase Completion","-    Phase 0: Infrastructure        — DONE (10/10)","-    Phase 1: Foundation            — DONE (12/12)","-    Phase 2: Intelligence          — DONE (14/14)","-    Phase 3: Enrichment            — DONE (14/17, 3 deferred)","-    Phase 4: Completion            — DONE (11/14, 3 deferred)","-    Phase 5: Evolution             — TODO (0/50)"," ","+14. FUTURE ROADMAP (Phase 5+)"," ================================================================================","-  End of Doc1 — SocialHomes.Ai Base Specification","-  Yantra Works | 2026-02-25","+","+14.1 Phase 5: Evolution (Sprints 9-14, 50 tasks)","+    - Vertex AI / Gemini integration for Yantra Assist","+    - WebSocket real-time notifications","+    - AI communication drafting with LLM","+    - Workflow builder UI","+    - Mobile responsive layout","+    - Comprehensive test suites (Selenium, unit, integration, load)","+    - Staging environment + CI/CD pipeline","+    - Cloud Monitoring + database backups","+    - Custom domain + CDN","+    - GDPR compliance dashboard","+    - Multi-tenant SaaS architecture design","+","+14.2 Phase 6: Enterprise (planned)","+    - Real DWP/UC API integration","+    - Real GOV.UK Notify sending","+    - Real IoT sensor integration (Switchee, Aico)","+    - Payment processing (GoCardless, Allpay)","+    - Regulatory submission APIs (RSH, CORE, Ombudsman)","+","+"," ================================================================================","+  End of Document","+  Doc1 — SocialHomes.Ai Base Specification v7.0","+  Yantra Works | 2026-02-26","+================================================================================"]}],"originalFile":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/50)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"cb156c48-b849-47df-94e8-1d87d78a4945"}
{"parentUuid":"5f53af93-c0c3-4dcf-833b-02425b1fda31","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01PC3TADChFdFQe7MT8PDbu4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CdpEVmwGSjG1niujVCT9za","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":12193,"cache_read_input_tokens":95559,"output_tokens":304,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":12193,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWKiK7793dTrCy1ZnXN5","type":"assistant","uuid":"4ac259b8-d86f-4227-8cc0-73822c3ac9d5","timestamp":"2026-02-26T07:56:55.416Z"}
{"parentUuid":"4ac259b8-d86f-4227-8cc0-73822c3ac9d5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CdpEVmwGSjG1niujVCT9za","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"08d7c2c0-3ac7-4dc5-9787-6fc263b84da2","timestamp":"2026-02-26T07:56:55.420Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"4ac259b8-d86f-4227-8cc0-73822c3ac9d5"}
{"parentUuid":"08d7c2c0-3ac7-4dc5-9787-6fc263b84da2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_0187tuS8Nst6rcsZbtKqbxsr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JmnHgoP1Bsj7G1pg8BVxN9","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  System Architecture Overview\n  2.  Technology Stack (with versions)\n  3.  Frontend Architecture\n  4.  Backend Architecture\n  5.  Data Models (Firestore Schemas)\n  6.  API Architecture (50+ Endpoints)\n  7.  External API Integration Layer\n  8.  Security Architecture\n  9.  Deployment & Infrastructure\n  10. Monitoring & Observability\n  11. Accessibility Implementation\n  12. Phase 5 Architecture Targets\n\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram\n\n    +-------------------------------------------------------------+\n    |                    CLOUD RUN (europe-west2)                  |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+-------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n1.4 Monorepo Structure\n\n    socialhomes/\n    ├── app/                    # React frontend\n    │   ├── src/\n    │   │   ├── components/     # Shared + layout components\n    │   │   ├── context/        # AppContext (state management)\n    │   │   ├── contexts/       # AuthContext (Firebase auth)\n    │   │   ├── data/           # Mock/seed data files\n    │   │   ├── hooks/          # Custom React hooks\n    │   │   ├── pages/          # 20+ page components (19 directories)\n    │   │   ├── services/       # API client, Firebase, AI drafting\n    │   │   ├── types/          # TypeScript type definitions\n    │   │   └── utils/          # Format utilities\n    │   ├── package.json\n    │   └── vite.config.ts\n    ├── server/                 # Express backend\n    │   ├── src/\n    │   │   ├── middleware/      # Auth, RBAC, rate limit, metrics, errors\n    │   │   ├── models/         # Firestore schemas, HACT codes\n    │   │   ├── routes/         # 16 route modules\n    │   │   ├── scripts/        # Data seeding scripts\n    │   │   └── services/       # 19 service modules\n    │   ├── package.json\n    │   └── tsconfig.json\n    ├── tests/                  # Selenium test suites\n    ├── docs/                   # Documentation\n    │   └── requirements/       # Specification documents (this file)\n    ├── Dockerfile              # 3-stage production build\n    ├── cloudbuild.yaml         # Cloud Build CI/CD\n    ├── firestore.rules         # Firestore security rules\n    └── firestore.indexes.json  # Composite indexes (17)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router DOM        | 6.30.3     |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | Tailwind Vite      | @tailwindcss/vite       | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualisation   | Three.js                | 0.182.0    |\n    | 3D React Binding   | @react-three/fiber      | 9.5.0      |\n    | 3D Helpers         | @react-three/drei       | 10.7.7     |\n    | Maps               | Leaflet                 | 1.9.4      |\n    | React Maps         | React Leaflet           | 5.0.0      |\n    | Charts             | Recharts                | 3.7.0      |\n    | Advanced Charts    | D3.js                   | 7.9.0      |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | 6.1.0      |\n    | Firebase Client    | Firebase                | 12.9.0     |\n    | Date Utilities     | date-fns                | 4.1.0      |\n    | Class Names        | clsx                    | 2.1.1      |\n    | Build Tool         | Vite                    | 7.2.4      |\n    | Linter             | ESLint                  | 9.39.1     |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Firebase Admin     | firebase-admin          | 13.6.1     |\n    | Firestore SDK      | @google-cloud/firestore | 7.11.0     |\n    | Security Headers   | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Compression        | compression             | 1.8.0      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | TS Runner          | tsx                     | 4.19.4     |\n    | Test Framework     | Vitest                  | 4.0.18     |\n\n2.3 Infrastructure Stack\n\n    | Component          | Technology              | Details          |\n    |--------------------|-------------------------|------------------|\n    | Container Platform | Google Cloud Run        | europe-west2     |\n    | Database           | Google Firestore        | Native mode      |\n    | Authentication     | Firebase Auth           | Google SSO       |\n    | Secrets            | Secret Manager          | 4 secrets        |\n    | Container Registry | Artifact Registry       | europe-west2     |\n    | CI/CD              | Cloud Build             | On git push      |\n    | Source Control      | GitHub                  | rajivpeter/      |\n    | Session Tracking   | Entire.io               | v0.4.4           |\n    | Notifications      | Telegram MCP            | @SocialHomesBot  |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Component Hierarchy\n\n    App.tsx (root)\n    └── AuthProvider (Firebase auth context)\n        └── AppProvider (global state: persona, theme)\n            └── QueryClientProvider (React Query)\n                └── BrowserRouter\n                    └── Routes\n                        ├── LoginPage (unauthenticated)\n                        └── Layout (authenticated shell)\n                            ├── Sidebar (persistent left nav)\n                            ├── Header (top bar)\n                            ├── Breadcrumbs\n                            ├── YantraAssist (AI panel)\n                            └── <Page> (content area)\n\n3.2 Layout Components (app/src/components/layout/)\n    - Layout.tsx: main shell with sidebar, header, content area\n    - Sidebar.tsx: persistent left nav (280px, collapsible to 64px)\n    - Header.tsx: top bar with search, notifications, persona, AI trigger\n    - Breadcrumbs.tsx: hierarchical path navigation\n    - YantraAssist.tsx: contextual AI assistant panel\n\n3.3 Shared Components (app/src/components/shared/)\n    - ActionModal.tsx: modal with focus trap, ARIA, validation\n    - AiActionCard.tsx: AI dynamic action display\n    - BenefitsPanel.tsx: UK benefits entitlement analysis\n    - CountdownTimer.tsx: SLA/deadline countdown with colour transitions\n    - DampIntelligencePanel.tsx: 5-factor damp risk display\n    - HelpDrawer.tsx: contextual help system (20 pages)\n    - KpiCard.tsx: metric display with trend sparklines\n    - NeighbourhoodBriefingPanel.tsx: estate-level AI briefing\n    - PropertyMap.tsx: Leaflet map for property location\n    - ProtectedRoute.tsx: auth guard with role checking\n    - StatusPill.tsx: status indicator pills\n    - VulnerabilityPanel.tsx: 7-factor vulnerability display\n\n3.4 Pages (app/src/pages/ — 19 directories, 30+ page components)\n    admin/          AdminPage.tsx, IntegrationsPage.tsx\n    ai-centre/      AiCentrePage.tsx\n    allocations/    AllocationsPage.tsx\n    asb/            AsbPage.tsx, AsbDetailPage.tsx\n    auth/           LoginPage.tsx\n    briefing/       BriefingPage.tsx\n    communications/ CommunicationsPage.tsx\n    complaints/     ComplaintsPage.tsx, ComplaintDetailPage.tsx\n    compliance/     CompliancePage.tsx, ComplianceTypePage.tsx, AwaabsLawPage.tsx\n    dashboard/      DashboardPage.tsx\n    explore/        ExplorePage.tsx\n    properties/     PropertiesPage.tsx, PropertyDetailPage.tsx,\n                    ApplicationPage.tsx, ViewingBookingPage.tsx\n    rent/           RentPage.tsx\n    repairs/        RepairsPage.tsx, RepairDetailPage.tsx\n    reports/        ReportsPage.tsx, TsmReportPage.tsx, DynamicReportPage.tsx\n    search/         SearchPage.tsx\n    tenancies/      TenanciesPage.tsx, TenancyDetailPage.tsx\n    tenant-portal/  TenantPortalPage.tsx\n\n3.5 State Management\n    - AppContext.tsx: persona, theme, navigation state\n    - AuthContext.tsx: Firebase auth state, user profile\n    - React Query: server state management with caching\n    - No localStorage or sessionStorage (per spec)\n\n3.6 Hooks (app/src/hooks/)\n    - useApi.ts: 10+ React Query hooks for data fetching\n    - useEntityIntelligence.ts: AI context for entity pages\n    - usePersonaScope.ts: persona-scoped data filtering\n\n3.7 Services (app/src/services/)\n    - api-client.ts (13KB): centralised HTTP client, auth token injection\n    - firebase.ts (2.6KB): Firebase client initialisation\n    - ai-drafting.ts (18KB): template-based communication generation\n    - public-data.ts (69KB): complex public data aggregation + fallbacks\n\n3.8 Data (app/src/data/)\n    - Seed/mock data files for all entity types\n    - estates.ts, properties.ts, tenants.ts, cases.ts, regions.ts\n    - help-content.ts: 20-page contextual help system\n    - organisation.ts: RCHA organisation profile\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Server Entry Point (server/src/index.ts)\n    Express application with middleware pipeline:\n    1. Morgan (HTTP logging)\n    2. Helmet (security headers)\n    3. CORS (allowed origins)\n    4. Compression (gzip/brotli)\n    5. JSON parser (1MB limit)\n    6. X-Request-ID (correlation)\n    7. Rate limiter (4 tiers)\n    8. Metrics recorder\n    9. Route handlers\n    10. Error handler (structured, no stack leaks in production)\n\n    Static file serving: Vite build output from app/dist/\n    Health endpoint: GET /health\n\n4.2 Middleware (server/src/middleware/)\n    - auth.ts: Firebase token verification, user context injection\n    - rbac.ts: role-based access control by persona level\n    - rate-limiter.ts: sliding window rate limiter\n      * API: 100/minute\n      * Auth: 10/minute\n      * AI: 30/minute\n      * Admin: 20/minute\n    - metrics.ts: request/response metrics on res.finish\n    - error-handler.ts: structured JSON errors, correlation IDs\n\n4.3 Route Modules (server/src/routes/ — 16 modules)\n    | Route Module      | Mount Path               | Purpose                    |\n    |-------------------|--------------------------|----------------------------|\n    | auth.ts           | /api/v1/auth             | Authentication, profiles   |\n    | ai.ts             | /api/v1/ai               | AI services (17KB)         |\n    | admin.ts          | /api/v1/admin            | Admin functions             |\n    | properties.ts     | /api/v1/properties       | Property CRUD & queries    |\n    | tenants.ts        | /api/v1/tenants          | Tenant management          |\n    | cases.ts          | /api/v1/cases            | Unified case management    |\n    | explore.ts        | /api/v1/explore          | Drill-down hierarchy       |\n    | briefing.ts       | /api/v1/briefing         | AI briefing generation     |\n    | compliance.ts     | /api/v1/compliance       | Compliance tracking        |\n    | rent.ts           | /api/v1/rent             | Financial tracking         |\n    | reports.ts        | /api/v1/reports          | Report generation          |\n    | public-data.ts    | /api/v1/public-data      | External API proxy (22KB)  |\n    | export.ts         | /api/v1/export           | Data export (HACT)         |\n    | lettings.ts       | /api/v1/lettings         | Lettings & allocations     |\n    | booking.ts        | /api/v1/booking          | Viewing/appointment        |\n    | public-data.test  | (test file)              | 66 tests (29KB)            |\n\n4.4 Service Modules (server/src/services/ — 19 modules)\n\n    AI & Intelligence Services:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | Damp Prediction             | damp-prediction.ts            | 17KB   |\n    | Crime Context               | crime-context.ts              | 11KB   |\n    | Vulnerability Detection     | vulnerability-detection.ts    | 16KB   |\n    | Benefits Engine             | benefits-engine.ts            | 11KB   |\n    | Property Passport           | property-passport.ts          | 11KB   |\n    | Neighbourhood Briefing      | neighbourhood-briefing.ts     | 14KB   |\n    | GOV.UK Notify               | govuk-notify.ts               | 45KB   |\n\n    Data & Integration Services:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | External API Client         | external-api.ts               | 5.1KB  |\n    | Census/NOMIS                | census-nomis.ts               | 17KB   |\n    | Mock Services               | mock-services.ts              | 23KB   |\n    | HACT Export                  | hact-export.ts                | 5.5KB  |\n\n    Core Infrastructure:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | Firebase Admin              | firebase-admin.ts             | 1.7KB  |\n    | Firestore Operations        | firestore.ts                  | 4.9KB  |\n    | Seed Data                   | seed-data.ts                  | 28KB   |\n    | Seed Runner                 | seed.ts                       | 9.1KB  |\n    | Monitoring                  | monitoring.ts                 | 4.4KB  |\n\n    Test Files:\n    | Test                        | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | External API Tests          | external-api.test.ts          | 12KB   |\n    | Firestore Tests             | firestore.test.ts             | 6.7KB  |\n    | Public Data Tests           | public-data.test.ts           | 29KB   |\n\n4.5 Models (server/src/models/)\n    - firestore-schemas.ts: Firestore collection schemas and validation\n    - hact-codes.ts: HACT Housing Data Standard reference codes\n\n\n5. DATA MODELS (Firestore Schemas)\n================================================================================\n\n5.1 Firestore Collections\n\n    | Collection         | Doc Count | Document ID Format   | Purpose              |\n    |--------------------|-----------|-----------------------|----------------------|\n    | organisations      | 1         | org-{id}              | Organisation profile |\n    | regions            | 3         | region-{id}           | Geographic regions   |\n    | localAuthorities   | ~5        | la-{id}               | Local authorities    |\n    | estates            | 5         | estate-{id}           | Housing estates      |\n    | blocks             | ~12       | block-{id}            | Building blocks      |\n    | properties         | 75        | {id}                  | Housing units        |\n    | tenants            | 68        | {id}                  | Tenant records       |\n    | cases              | 279+      | {type-prefix}-{num}   | All case types       |\n    | activities         | varies    | auto-id               | Case activity log    |\n    | communications     | varies    | auto-id               | Multi-channel comms  |\n    | rentTransactions   | varies    | auto-id               | Financial records    |\n    | users              | varies    | uid                   | User profiles        |\n    | auditLog           | varies    | auto-id               | Access audit trail   |\n    | hactCodes          | varies    | code                  | HACT reference data  |\n    | notifications      | varies    | auto-id               | User notifications   |\n    | voidProperties     | 5         | void-{id}             | Void pipeline        |\n    | applicants         | varies    | app-{id}              | Housing register     |\n    | tsmMeasures        | 22        | tsm-{code}            | TSM indicators       |\n    | externalDataCache  | varies    | {source}:{key}        | API response cache   |\n    | imdData            | varies    | {lsoaCode}            | IMD deprivation      |\n\n5.2 Property Schema\n\n    {\n      id: string                    // Unique property ID\n      uprn: string                  // 12-digit UPRN\n      address: string               // Full address\n      postcode: string              // UK postcode\n      lat: number                   // Latitude\n      lng: number                   // Longitude\n      ward: string                  // Electoral ward (from postcodes.io)\n      lsoa: string                  // LSOA name\n      lsoaCode: string              // LSOA code (E01xxxxxx)\n      constituency: string          // Parliamentary constituency\n      type: 'flat'|'house'|'maisonette'|'bungalow'|'bedsit'|'studio'\n      tenure: 'secure'|'assured'|'AST'|'starter'|'fixed-term'|\n              'flexible'|'licence'|'shared-ownership'\n      bedrooms: number              // 0-5\n      floorArea: number             // Square metres\n      floor: number                 // For flats\n      construction: {\n        yearBuilt: number\n        type: string                // e.g. 'concrete panel', 'brick'\n        storeys: number\n        higherRisk: boolean         // ≥18m or ≥7 storeys\n      }\n      heating: {\n        type: string                // Gas central, electric, communal\n        boilerMake: string\n        boilerModel: string\n        boilerAge: number\n        lastService: string\n        efficiency: string\n      }\n      epc: {\n        rating: string              // A-G\n        sapScore: number            // 0-100\n        expiryDate: string\n        potentialRating: string\n        potentialScore: number\n        wallsDesc: string\n        roofDesc: string\n        windowsDesc: string\n        heatingDesc: string\n        co2Current: number\n        heatingCostAnnual: number\n        recommendations: string[]\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, contractor }\n        electrical: { status, expiryDate, contractor }\n        fire: { status, riskLevel, nextReview }\n        asbestos: { status, acmCount, managementPlan }\n        legionella: { status, nextReview, waterSystem }\n        lifts: { status, nextInspection }\n      }\n      stockCondition: {\n        components: [{\n          name, type, installYear, condition, remainingLife, replacementCost\n        }]\n      }\n      dampRisk: number              // 0-100 (AI-calculated)\n      isVoid: boolean\n      currentTenantId: string\n      estateId: string\n      blockId: string\n      regionId: string\n      localAuthorityId: string\n      accessibility: string[]       // Features list\n      photos: string[]\n      imdDecile: number             // 1-10 (from ONS)\n      imdScore: number\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile: string\n      householdMembers: [{\n        name, relationship, dateOfBirth, isDependent\n      }]\n      emergencyContact: {\n        name, relationship, phone\n      }\n      assignedOfficer: string\n      tenancyStatus: 'active'|'former'|'pending'|'suspended'\n      tenancyStartDate: string\n      tenureType: string\n      propertyId: string\n      weeklyRent: number\n      weeklyServiceCharge: number\n      weeklyTotalCharge: number\n      rentBalance: number           // Negative = arrears\n      paymentMethod: 'DD'|'UC'|'SO'|'Card'|'Cash'|'HB'\n      arrearsRisk: number           // 0-100 (AI-calculated)\n      ucStatus: 'not-claiming'|'claiming'|'transitioning'|'managed-migration'\n      ucManagedPayment: boolean\n      vulnerabilityFlags: [{\n        type, severity, notes, identifiedDate\n      }]\n      communicationPreference: 'email'|'phone'|'letter'|'sms'|'portal'\n      dependentsCount: number\n      employmentStatus: string\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string                    // e.g. REP-2025-00123\n      type: 'complaint'|'repair'|'asb'|'enquiry'|'financial'|\n            'safeguarding'|'damp-mould'\n      status: string                // Varies by type\n      priority: 'emergency'|'urgent'|'routine'|'planned'\n      subject: string\n      description: string\n      propertyId: string\n      tenantId: string\n      handler: string\n      createdDate: string\n      updatedDate: string\n      closedDate: string\n      slaTarget: string\n      slaStatus: 'within'|'approaching'|'breached'\n      daysOpen: number\n\n      // Repair-specific fields\n      sorCode: string\n      sorDescription: string\n      trade: string\n      operative: string\n      appointment: { date, slot, confirmed }\n      firstTimeFix: boolean\n      satisfaction: number           // 1-5\n      recurrenceRisk: number\n      awaabsLaw: {\n        applicable: boolean\n        hazardType: string\n        deadlines: { investigate, summary, safetyWorks, repairsBegun }\n      }\n\n      // Complaint-specific fields\n      stage: 'stage-1'|'stage-2'\n      acknowledgementDate: string\n      acknowledgementDeadline: string\n      responseDeadline: string\n      finding: 'upheld'|'partially-upheld'|'not-upheld'\n      remedy: string\n      learningLog: string\n      ombudsmanEscalation: boolean\n\n      // ASB-specific fields\n      asbCategory: string\n      severity: 'cat-1'|'cat-2'|'cat-3'\n      escalation: 'warning'|'ABC'|'CPW'|'CPN'|'injunction'|\n                  'possession'|'closure'\n      evidenceCount: number\n      multiAgencyPanel: boolean\n      legalActionProbability: number\n\n      // Financial-specific fields\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement: { amount, frequency, compliance }\n      escalationStage: 'pre-action'|'NOSP'|'court'|'possession'\n      preActionChecklist: object\n\n      // Damp-specific fields\n      hazardClassification: 'emergency'|'significant'|'non-urgent'\n      moistureLevel: number\n      humidityLevel: number\n      temperatureLevel: number\n      linkedRepairs: string[]\n    }\n\n5.5 External Data Cache Schema\n\n    {\n      // Document ID: {source}:{lookupKey}\n      source: string                // API identifier\n      lookupKey: string             // postcode, UPRN, lat/lng, LSOA\n      data: object                  // Cached response payload\n      fetchedAt: Timestamp\n      ttlSeconds: number\n      expiresAt: Timestamp\n      httpStatus: number\n      latencyMs: number\n    }\n\n5.6 Composite Indexes (17 defined in firestore.indexes.json)\n\n    Cases (5 indexes):\n    - type + status + createdDate (desc)\n    - type + handler + createdDate (desc)\n    - tenantId + createdDate (desc)\n    - propertyId + createdDate (desc)\n    - type + priority + createdDate (desc)\n\n    Properties (3 indexes):\n    - regionId + type\n    - estateId + isVoid\n    - blockId + type\n\n    Tenants (2 indexes):\n    - assignedOfficer + tenancyStatus\n    - arrearsRisk (desc)\n\n    Activities (2 indexes):\n    - tenantId + date (desc)\n    - caseId + date (desc)\n\n    Other (5 indexes):\n    - rentTransactions: tenantId + date (desc)\n    - auditLog: timestamp (desc)\n    - localAuthorities: regionId\n    - estates: localAuthorityId\n    - blocks: estateId\n\n5.7 Firestore Security Rules Summary\n\n    Rule helpers:\n    - isAuthenticated(): request.auth != null\n    - hasPersona(p): user doc has matching persona\n    - isManager(): persona in [coo, head-of-service, manager]\n    - isAdmin(): persona == 'coo'\n\n    Access patterns:\n    | Collection       | Read         | Create       | Update       | Delete   |\n    |------------------|-------------|-------------|-------------|----------|\n    | organisations    | auth        | admin       | admin       | admin    |\n    | regions          | auth        | admin       | admin       | admin    |\n    | localAuthorities | auth        | admin       | admin       | admin    |\n    | estates          | auth        | manager+    | manager+    | admin    |\n    | blocks           | auth        | manager+    | manager+    | admin    |\n    | properties       | auth        | manager+    | manager+    | admin    |\n    | tenants          | auth        | manager+    | manager+    | admin    |\n    | cases            | auth        | auth        | auth        | admin    |\n    | activities       | auth        | auth        | auth        | admin    |\n    | communications   | auth        | auth        | auth        | manager+ |\n    | rentTransactions | auth        | manager+    | manager+    | manager+ |\n    | users            | auth        | admin       | admin/self  | admin    |\n    | auditLog         | manager+    | auth        | never       | never    |\n\n\n6. API ARCHITECTURE (50+ Endpoints)\n================================================================================\n\n6.1 Auth Routes (/api/v1/auth)\n    POST  /seed-users              Create demo Firebase users (idempotent)\n    POST  /profile                 Create user profile on first registration\n    GET   /me                      Get authenticated user profile\n\n6.2 Properties Routes (/api/v1/properties)\n    GET   /                        List with filters (?regionId, ?estateId, ?blockId,\n                                     ?type, ?isVoid, ?limit)\n    GET   /available               Void properties for letting\n    GET   /:id                     Single property by ID\n    PATCH /:id                     Update property\n\n6.3 Tenants Routes (/api/v1/tenants)\n    GET   /                        List with filters\n    GET   /:id                     Single tenant by ID\n    PATCH /:id                     Update tenant\n\n6.4 Cases Routes (/api/v1/cases)\n    GET   /                        List with filters (?type, ?status, ?handler,\n                                     ?priority, ?propertyId, ?tenantId,\n                                     ?limit=50, ?offset)\n    GET   /:id                     Case with related activities\n    POST  /                        Create new case\n    PATCH /:id                     Update case\n    GET   /:id/activities          Activities for a case\n\n6.5 AI Routes (/api/v1/ai)\n    POST  /draft-communication     AI communication drafts\n    POST  /entity-intelligence     AI predictions/alerts per entity\n    POST  /neighbourhood-context   Neighbourhood briefing\n    POST  /property-intelligence   Property analysis\n    POST  /tenant-context          Tenant risk assessment\n    POST  /chat                    Conversational AI queries\n    GET   /damp-risk/:propertyId   Damp risk score\n    GET   /damp-risk/estate/:id    Estate-wide damp risk\n    GET   /crime-context/:estateId Crime correlation\n    GET   /crime-context/case/:id  Case crime context\n    GET   /vulnerability/:tenantId Vulnerability assessment\n    POST  /vulnerability/scan      Org-wide vulnerability scan\n    GET   /benefits-check/:id      Benefits entitlement check\n    GET   /property-passport/:id   Property passport\n    GET   /briefing/:estateId      Neighbourhood briefing\n    GET   /notify/templates        All GOV.UK Notify templates\n    GET   /notify/templates/:cat   Templates by category\n    GET   /notify/template/:id     Single template\n    POST  /notify/render           Render template with personalisation\n    GET   /mock/uc-verification/:id   DWP UC verification (mock)\n    GET   /mock/iot-sensors/:id       IoT sensor readings (mock)\n    GET   /mock/direct-debit/:id      GoCardless status (mock)\n    GET   /mock/labour-market/:code   NOMIS labour market (mock)\n    GET   /mock/repairs-marketplace/:id  Plentific/Fixflo (mock)\n    GET   /mock/regulatory/:type/:ref    RSH/CORE/Ombudsman (mock)\n    GET   /mock/signing/:type/:id        DocuSign (mock)\n    GET   /mock/referencing/:id          Experian/TransUnion (mock)\n    GET   /mock/land-registry/:id        Land Registry (mock)\n\n6.6 Public Data Routes (/api/v1/public-data)\n    GET   /police/:postcode        Street-level crime data\n    GET   /weather/:lat/:lng       Weather forecast\n    GET   /flood/:lat/:lng         Flood warnings\n    GET   /postcode/:postcode      Postcode lookup (geocoding, LSOA)\n    POST  /postcodes/bulk          Bulk postcode lookup\n    GET   /epc/:postcode           EPC certificates\n    GET   /imd/:lsoaCode           Index of Multiple Deprivation\n    GET   /census/:lsoaCode        Census 2021 demographics\n    GET   /nomis/:lsoaCode         NOMIS labour market\n    GET   /gas-safe/:regNo         Gas Safe Register verification\n    GET   /electrical-safety/:regNo  NICEIC verification\n\n6.7 Admin Routes (/api/v1/admin)\n    GET   /integrations            All 20 integration statuses\n    POST  /integrations/:id/toggle Toggle integration on/off\n    POST  /integrations/:id/test   Test integration connection\n    GET   /monitoring              System metrics & health\n\n6.8 Other Routes\n    GET   /api/v1/explore/*        Drill-down hierarchy queries\n    GET   /api/v1/briefing/*       AI briefing generation\n    GET   /api/v1/compliance/*     Compliance tracking\n    GET   /api/v1/rent/*           Financial tracking\n    GET   /api/v1/reports/*        Report generation\n    GET   /api/v1/export/*         HACT data export\n    GET   /api/v1/lettings/*       Lettings & allocations\n    POST  /api/v1/booking/*        Viewing/appointment booking\n    GET   /health                  Health check (Firestore, memory, uptime)\n\n\n7. EXTERNAL API INTEGRATION LAYER\n================================================================================\n\n7.1 Integration Pattern: Server-Side Proxy\n    All external API calls follow:\n    Client → Express route → Check Firestore cache → If valid: return cached →\n    If expired: Call external API → Transform → Cache in Firestore → Return →\n    If fail: Return simulated data with source: \"simulated\"\n\n7.2 Shared Service: external-api.ts\n    - fetchWithCache(source, key, ttl, fetchFn): cache-through helper\n    - rateLimiter(source, maxPerMinute): token bucket\n    - buildAuditEntry(source, endpoint, status, latency): audit logging\n    - simulatedFallback(source, key): synthetic data generator\n\n7.3 Integration Summary\n\n    TIER 1 — Live, No Key:\n    | API              | Base URL                          | Cache TTL | Rate Limit    |\n    |------------------|-----------------------------------|-----------|---------------|\n    | Police.uk        | data.police.uk/api                | 24 hours  | 15 req/sec    |\n    | Open-Meteo       | api.open-meteo.com/v1             | 1 hour    | 10,000/day    |\n    | DEFRA Flood      | environment.data.gov.uk/flood-*   | 1 hour    | Fair use      |\n\n    TIER 2 — Live, Key Required:\n    | API              | Base URL                          | Cache TTL | Status         |\n    |------------------|-----------------------------------|-----------|----------------|\n    | Postcodes.io     | api.postcodes.io                  | 90 days   | Live           |\n    | Open UPRN        | uprn.uk                           | 90 days   | Live           |\n    | EPC Register     | epc.opendatacommunities.org/api   | 30 days   | Live+fallback  |\n    | NOMIS/Census     | nomisweb.co.uk/api/v01            | 7 days    | Live           |\n    | Gas Safe         | (verification endpoint)           | 30 days   | Live+fallback  |\n    | Electrical Safety| (verification endpoint)           | 30 days   | Live+fallback  |\n\n    TIER 3 — Mock Services:\n    | API              | Service Function                  | Purpose                 |\n    |------------------|------------------------------------|-------------------------|\n    | DWP/UC           | mockUcVerification()              | UC status, APA          |\n    | IoT Sensors      | mockIotSensors()                  | Switchee, Aico, HomeLync|\n    | GoCardless       | mockDirectDebit()                 | DD payments             |\n    | Plentific/Fixflo | mockRepairsMarketplace()          | Contractor dispatch     |\n    | RSH/CORE         | mockRegulatorySubmission()        | Regulatory returns      |\n    | DocuSign         | mockSigningEnvelope()             | Digital signing         |\n    | Experian         | mockReferencingResult()           | Tenant referencing      |\n    | Land Registry    | mockLandRegistryTitle()           | Title/ownership data    |\n    | NOMIS Extended   | mockLabourMarket()                | Labour market stats     |\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication\n    - Firebase Authentication (Google SSO + email/password)\n    - JWT tokens verified on every API request\n    - Token injection via api-client.ts Authorization header\n    - Demo users seeded via /api/v1/auth/seed-users\n\n8.2 Authorisation (RBAC)\n    - 5 persona levels: COO > Head of Service > Manager > Officer > Operative\n    - Per-module permissions: view, create, edit, delete, approve\n    - Firestore security rules enforce at database level\n    - Express middleware enforces at API level\n\n8.3 Transport Security\n    - HTTPS enforced by Cloud Run (managed SSL)\n    - CSP headers whitelist: Google APIs, Firebase, OSM tiles, Google Fonts\n    - CORS restricted to allowed origins (localhost:5173, Cloud Run URL)\n    - Helmet middleware for security headers\n\n8.4 Data Security\n    - Secret Manager for all credentials (4 secrets)\n    - No API keys in codebase (removed in Session 2)\n    - .mcp.json in .gitignore (contains Telegram bot token)\n    - .env files never committed\n    - JSON body limit: 1MB\n    - Structured error responses (no stack traces in production)\n    - Request correlation IDs for audit trail\n\n8.5 Rate Limiting\n    - Sliding window rate limiter (token bucket pattern)\n    - 4 tiers: API (100/min), Auth (10/min), AI (30/min), Admin (20/min)\n    - Per-source rate limiting for external APIs\n\n\n9. DEPLOYMENT & INFRASTRUCTURE\n================================================================================\n\n9.1 Docker Build (3-Stage)\n    Stage 1 — Build Client:\n    - Node 20 slim → npm ci --legacy-peer-deps → Vite build → dist/\n    Stage 2 — Build Server:\n    - Node 20 slim → npm ci → TypeScript compile → dist/\n    Stage 3 — Production:\n    - Node 20 slim → production deps only → copy artifacts\n    - curl for health checks\n    - PORT=8080, NODE_ENV=production\n    - CMD: node server/dist/index.js\n\n9.2 Cloud Run Configuration\n    - Service: socialhomes\n    - Region: europe-west2 (London)\n    - Memory: 1Gi\n    - CPU: 1\n    - Min instances: 0\n    - Max instances: 10\n    - Port: 8080\n    - Secrets: 4 from Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN,\n      FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n9.3 Cloud Build (CI/CD)\n    - Trigger: git push to main\n    - Config: cloudbuild.yaml\n    - Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n      cloud-run-source-deploy/socialhomes\n    - NOTE: cloudbuild.yaml needs updating for correct Artifact Registry path\n      (task 5.5.1 in EXECUTION-PLAN.md)\n\n9.4 Infrastructure References\n    - GCP Project ID: gen-lang-client-0878518473\n    - GCP Project Number: 587984201316\n    - Firebase Project: gen-lang-client-0146156913\n    - Service URL: https://socialhomes-587984201316.europe-west2.run.app\n    - GitHub: https://github.com/rajivpeter/SocialHomes_ai\n    - Service Account: 587984201316-compute@developer.gserviceaccount.com\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Health Endpoint (GET /health)\n    Returns:\n    - status: 'healthy' | 'degraded' | 'unhealthy'\n    - firestore: connectivity check with latency\n    - memory: RSS, heap used/total\n    - uptime: seconds\n\n10.2 Metrics Service (monitoring.ts)\n    Tracks:\n    - Request counts by route\n    - Response times (P50, P95, P99)\n    - Status code distribution\n    - Endpoint hit counts\n    - Cache hit/miss ratios\n\n10.3 Admin Monitoring (GET /api/v1/admin/monitoring)\n    Aggregated metrics dashboard for admin users.\n\n10.4 Audit Trail\n    Every significant action logged to auditLog collection:\n    - timestamp, user, entity, field, old value, new value, IP\n    - External API calls logged with source, endpoint, status, latency\n\n10.5 Telegram Notifications\n    Bot: @SocialHomesBot (MCP integration)\n    - Build status, deployment confirmations\n    - Test results, error alerts\n    - Progress updates\n\n\n11. ACCESSIBILITY IMPLEMENTATION\n================================================================================\n\n11.1 WCAG 2.2 AA Compliance\n    - Focus traps on modals (Tab wrapping, Escape key handler)\n    - ARIA attributes: role=\"dialog\", aria-modal, aria-labelledby,\n      aria-describedby, aria-required, aria-invalid\n    - Form validation: noValidate + custom with inline errors\n    - Skip-to-content link with id=\"main-content\" on <main>\n    - Navigation: aria-label=\"Main navigation\" on <nav>\n    - Focus-visible outline styles on *:focus-visible\n    - Reduced motion: @media (prefers-reduced-motion: reduce)\n    - Screen reader: .sr-only class\n    - Keyboard navigation throughout all workflows\n    - htmlFor on all form labels\n\n\n12. PHASE 5 ARCHITECTURE TARGETS\n================================================================================\n\n12.1 Vertex AI / Gemini Integration\n    - Server-side Vertex AI SDK with streaming responses (SSE)\n    - Context-aware system prompts per entity type\n    - Conversation history persistence in Firestore\n    - Token counting and budget enforcement\n    - PII masking and hallucination prevention guardrails\n\n12.2 WebSocket (Socket.io)\n    - Real-time notifications via Socket.io\n    - Authentication handshake with Firebase JWT\n    - Room-based subscriptions (per-user, per-estate, per-org)\n    - Cloud Run sticky sessions configuration\n\n12.3 Event-Driven Architecture\n    - Cloud Pub/Sub for async workflows\n    - Topics: case-created, compliance-expiring, arrears-threshold, damp-alert\n    - Dead letter queues for failed processing\n\n12.4 Multi-Tenant SaaS\n    - Organisation-scoped Firestore queries\n    - Tenant context middleware\n    - Per-org branding customisation\n    - Data partitioning strategy\n\n\n================================================================================\n  End of Document\n  Doc2 — SocialHomes.Ai Technical Architecture v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":107752,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWKirbwFMzPav7dDedyA","type":"assistant","uuid":"54e8b35f-beae-4fa6-a58e-b63aafe7229e","timestamp":"2026-02-26T08:00:27.827Z"}
{"parentUuid":"54e8b35f-beae-4fa6-a58e-b63aafe7229e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JmnHgoP1Bsj7G1pg8BVxN9","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt has been updated successfully."}]},"uuid":"8d143af4-b023-46b4-93bb-86e9cdb76efd","timestamp":"2026-02-26T08:00:27.993Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  System Architecture Overview\n  2.  Technology Stack (with versions)\n  3.  Frontend Architecture\n  4.  Backend Architecture\n  5.  Data Models (Firestore Schemas)\n  6.  API Architecture (50+ Endpoints)\n  7.  External API Integration Layer\n  8.  Security Architecture\n  9.  Deployment & Infrastructure\n  10. Monitoring & Observability\n  11. Accessibility Implementation\n  12. Phase 5 Architecture Targets\n\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram\n\n    +-------------------------------------------------------------+\n    |                    CLOUD RUN (europe-west2)                  |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+-------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n1.4 Monorepo Structure\n\n    socialhomes/\n    ├── app/                    # React frontend\n    │   ├── src/\n    │   │   ├── components/     # Shared + layout components\n    │   │   ├── context/        # AppContext (state management)\n    │   │   ├── contexts/       # AuthContext (Firebase auth)\n    │   │   ├── data/           # Mock/seed data files\n    │   │   ├── hooks/          # Custom React hooks\n    │   │   ├── pages/          # 20+ page components (19 directories)\n    │   │   ├── services/       # API client, Firebase, AI drafting\n    │   │   ├── types/          # TypeScript type definitions\n    │   │   └── utils/          # Format utilities\n    │   ├── package.json\n    │   └── vite.config.ts\n    ├── server/                 # Express backend\n    │   ├── src/\n    │   │   ├── middleware/      # Auth, RBAC, rate limit, metrics, errors\n    │   │   ├── models/         # Firestore schemas, HACT codes\n    │   │   ├── routes/         # 16 route modules\n    │   │   ├── scripts/        # Data seeding scripts\n    │   │   └── services/       # 19 service modules\n    │   ├── package.json\n    │   └── tsconfig.json\n    ├── tests/                  # Selenium test suites\n    ├── docs/                   # Documentation\n    │   └── requirements/       # Specification documents (this file)\n    ├── Dockerfile              # 3-stage production build\n    ├── cloudbuild.yaml         # Cloud Build CI/CD\n    ├── firestore.rules         # Firestore security rules\n    └── firestore.indexes.json  # Composite indexes (17)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router DOM        | 6.30.3     |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | Tailwind Vite      | @tailwindcss/vite       | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualisation   | Three.js                | 0.182.0    |\n    | 3D React Binding   | @react-three/fiber      | 9.5.0      |\n    | 3D Helpers         | @react-three/drei       | 10.7.7     |\n    | Maps               | Leaflet                 | 1.9.4      |\n    | React Maps         | React Leaflet           | 5.0.0      |\n    | Charts             | Recharts                | 3.7.0      |\n    | Advanced Charts    | D3.js                   | 7.9.0      |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | 6.1.0      |\n    | Firebase Client    | Firebase                | 12.9.0     |\n    | Date Utilities     | date-fns                | 4.1.0      |\n    | Class Names        | clsx                    | 2.1.1      |\n    | Build Tool         | Vite                    | 7.2.4      |\n    | Linter             | ESLint                  | 9.39.1     |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Firebase Admin     | firebase-admin          | 13.6.1     |\n    | Firestore SDK      | @google-cloud/firestore | 7.11.0     |\n    | Security Headers   | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Compression        | compression             | 1.8.0      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | TS Runner          | tsx                     | 4.19.4     |\n    | Test Framework     | Vitest                  | 4.0.18     |\n\n2.3 Infrastructure Stack\n\n    | Component          | Technology              | Details          |\n    |--------------------|-------------------------|------------------|\n    | Container Platform | Google Cloud Run        | europe-west2     |\n    | Database           | Google Firestore        | Native mode      |\n    | Authentication     | Firebase Auth           | Google SSO       |\n    | Secrets            | Secret Manager          | 4 secrets        |\n    | Container Registry | Artifact Registry       | europe-west2     |\n    | CI/CD              | Cloud Build             | On git push      |\n    | Source Control      | GitHub                  | rajivpeter/      |\n    | Session Tracking   | Entire.io               | v0.4.4           |\n    | Notifications      | Telegram MCP            | @SocialHomesBot  |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Component Hierarchy\n\n    App.tsx (root)\n    └── AuthProvider (Firebase auth context)\n        └── AppProvider (global state: persona, theme)\n            └── QueryClientProvider (React Query)\n                └── BrowserRouter\n                    └── Routes\n                        ├── LoginPage (unauthenticated)\n                        └── Layout (authenticated shell)\n                            ├── Sidebar (persistent left nav)\n                            ├── Header (top bar)\n                            ├── Breadcrumbs\n                            ├── YantraAssist (AI panel)\n                            └── <Page> (content area)\n\n3.2 Layout Components (app/src/components/layout/)\n    - Layout.tsx: main shell with sidebar, header, content area\n    - Sidebar.tsx: persistent left nav (280px, collapsible to 64px)\n    - Header.tsx: top bar with search, notifications, persona, AI trigger\n    - Breadcrumbs.tsx: hierarchical path navigation\n    - YantraAssist.tsx: contextual AI assistant panel\n\n3.3 Shared Components (app/src/components/shared/)\n    - ActionModal.tsx: modal with focus trap, ARIA, validation\n    - AiActionCard.tsx: AI dynamic action display\n    - BenefitsPanel.tsx: UK benefits entitlement analysis\n    - CountdownTimer.tsx: SLA/deadline countdown with colour transitions\n    - DampIntelligencePanel.tsx: 5-factor damp risk display\n    - HelpDrawer.tsx: contextual help system (20 pages)\n    - KpiCard.tsx: metric display with trend sparklines\n    - NeighbourhoodBriefingPanel.tsx: estate-level AI briefing\n    - PropertyMap.tsx: Leaflet map for property location\n    - ProtectedRoute.tsx: auth guard with role checking\n    - StatusPill.tsx: status indicator pills\n    - VulnerabilityPanel.tsx: 7-factor vulnerability display\n\n3.4 Pages (app/src/pages/ — 19 directories, 30+ page components)\n    admin/          AdminPage.tsx, IntegrationsPage.tsx\n    ai-centre/      AiCentrePage.tsx\n    allocations/    AllocationsPage.tsx\n    asb/            AsbPage.tsx, AsbDetailPage.tsx\n    auth/           LoginPage.tsx\n    briefing/       BriefingPage.tsx\n    communications/ CommunicationsPage.tsx\n    complaints/     ComplaintsPage.tsx, ComplaintDetailPage.tsx\n    compliance/     CompliancePage.tsx, ComplianceTypePage.tsx, AwaabsLawPage.tsx\n    dashboard/      DashboardPage.tsx\n    explore/        ExplorePage.tsx\n    properties/     PropertiesPage.tsx, PropertyDetailPage.tsx,\n                    ApplicationPage.tsx, ViewingBookingPage.tsx\n    rent/           RentPage.tsx\n    repairs/        RepairsPage.tsx, RepairDetailPage.tsx\n    reports/        ReportsPage.tsx, TsmReportPage.tsx, DynamicReportPage.tsx\n    search/         SearchPage.tsx\n    tenancies/      TenanciesPage.tsx, TenancyDetailPage.tsx\n    tenant-portal/  TenantPortalPage.tsx\n\n3.5 State Management\n    - AppContext.tsx: persona, theme, navigation state\n    - AuthContext.tsx: Firebase auth state, user profile\n    - React Query: server state management with caching\n    - No localStorage or sessionStorage (per spec)\n\n3.6 Hooks (app/src/hooks/)\n    - useApi.ts: 10+ React Query hooks for data fetching\n    - useEntityIntelligence.ts: AI context for entity pages\n    - usePersonaScope.ts: persona-scoped data filtering\n\n3.7 Services (app/src/services/)\n    - api-client.ts (13KB): centralised HTTP client, auth token injection\n    - firebase.ts (2.6KB): Firebase client initialisation\n    - ai-drafting.ts (18KB): template-based communication generation\n    - public-data.ts (69KB): complex public data aggregation + fallbacks\n\n3.8 Data (app/src/data/)\n    - Seed/mock data files for all entity types\n    - estates.ts, properties.ts, tenants.ts, cases.ts, regions.ts\n    - help-content.ts: 20-page contextual help system\n    - organisation.ts: RCHA organisation profile\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Server Entry Point (server/src/index.ts)\n    Express application with middleware pipeline:\n    1. Morgan (HTTP logging)\n    2. Helmet (security headers)\n    3. CORS (allowed origins)\n    4. Compression (gzip/brotli)\n    5. JSON parser (1MB limit)\n    6. X-Request-ID (correlation)\n    7. Rate limiter (4 tiers)\n    8. Metrics recorder\n    9. Route handlers\n    10. Error handler (structured, no stack leaks in production)\n\n    Static file serving: Vite build output from app/dist/\n    Health endpoint: GET /health\n\n4.2 Middleware (server/src/middleware/)\n    - auth.ts: Firebase token verification, user context injection\n    - rbac.ts: role-based access control by persona level\n    - rate-limiter.ts: sliding window rate limiter\n      * API: 100/minute\n      * Auth: 10/minute\n      * AI: 30/minute\n      * Admin: 20/minute\n    - metrics.ts: request/response metrics on res.finish\n    - error-handler.ts: structured JSON errors, correlation IDs\n\n4.3 Route Modules (server/src/routes/ — 16 modules)\n    | Route Module      | Mount Path               | Purpose                    |\n    |-------------------|--------------------------|----------------------------|\n    | auth.ts           | /api/v1/auth             | Authentication, profiles   |\n    | ai.ts             | /api/v1/ai               | AI services (17KB)         |\n    | admin.ts          | /api/v1/admin            | Admin functions             |\n    | properties.ts     | /api/v1/properties       | Property CRUD & queries    |\n    | tenants.ts        | /api/v1/tenants          | Tenant management          |\n    | cases.ts          | /api/v1/cases            | Unified case management    |\n    | explore.ts        | /api/v1/explore          | Drill-down hierarchy       |\n    | briefing.ts       | /api/v1/briefing         | AI briefing generation     |\n    | compliance.ts     | /api/v1/compliance       | Compliance tracking        |\n    | rent.ts           | /api/v1/rent             | Financial tracking         |\n    | reports.ts        | /api/v1/reports          | Report generation          |\n    | public-data.ts    | /api/v1/public-data      | External API proxy (22KB)  |\n    | export.ts         | /api/v1/export           | Data export (HACT)         |\n    | lettings.ts       | /api/v1/lettings         | Lettings & allocations     |\n    | booking.ts        | /api/v1/booking          | Viewing/appointment        |\n    | public-data.test  | (test file)              | 66 tests (29KB)            |\n\n4.4 Service Modules (server/src/services/ — 19 modules)\n\n    AI & Intelligence Services:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | Damp Prediction             | damp-prediction.ts            | 17KB   |\n    | Crime Context               | crime-context.ts              | 11KB   |\n    | Vulnerability Detection     | vulnerability-detection.ts    | 16KB   |\n    | Benefits Engine             | benefits-engine.ts            | 11KB   |\n    | Property Passport           | property-passport.ts          | 11KB   |\n    | Neighbourhood Briefing      | neighbourhood-briefing.ts     | 14KB   |\n    | GOV.UK Notify               | govuk-notify.ts               | 45KB   |\n\n    Data & Integration Services:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | External API Client         | external-api.ts               | 5.1KB  |\n    | Census/NOMIS                | census-nomis.ts               | 17KB   |\n    | Mock Services               | mock-services.ts              | 23KB   |\n    | HACT Export                  | hact-export.ts                | 5.5KB  |\n\n    Core Infrastructure:\n    | Service                     | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | Firebase Admin              | firebase-admin.ts             | 1.7KB  |\n    | Firestore Operations        | firestore.ts                  | 4.9KB  |\n    | Seed Data                   | seed-data.ts                  | 28KB   |\n    | Seed Runner                 | seed.ts                       | 9.1KB  |\n    | Monitoring                  | monitoring.ts                 | 4.4KB  |\n\n    Test Files:\n    | Test                        | File                          | Size   |\n    |-----------------------------|-------------------------------|--------|\n    | External API Tests          | external-api.test.ts          | 12KB   |\n    | Firestore Tests             | firestore.test.ts             | 6.7KB  |\n    | Public Data Tests           | public-data.test.ts           | 29KB   |\n\n4.5 Models (server/src/models/)\n    - firestore-schemas.ts: Firestore collection schemas and validation\n    - hact-codes.ts: HACT Housing Data Standard reference codes\n\n\n5. DATA MODELS (Firestore Schemas)\n================================================================================\n\n5.1 Firestore Collections\n\n    | Collection         | Doc Count | Document ID Format   | Purpose              |\n    |--------------------|-----------|-----------------------|----------------------|\n    | organisations      | 1         | org-{id}              | Organisation profile |\n    | regions            | 3         | region-{id}           | Geographic regions   |\n    | localAuthorities   | ~5        | la-{id}               | Local authorities    |\n    | estates            | 5         | estate-{id}           | Housing estates      |\n    | blocks             | ~12       | block-{id}            | Building blocks      |\n    | properties         | 75        | {id}                  | Housing units        |\n    | tenants            | 68        | {id}                  | Tenant records       |\n    | cases              | 279+      | {type-prefix}-{num}   | All case types       |\n    | activities         | varies    | auto-id               | Case activity log    |\n    | communications     | varies    | auto-id               | Multi-channel comms  |\n    | rentTransactions   | varies    | auto-id               | Financial records    |\n    | users              | varies    | uid                   | User profiles        |\n    | auditLog           | varies    | auto-id               | Access audit trail   |\n    | hactCodes          | varies    | code                  | HACT reference data  |\n    | notifications      | varies    | auto-id               | User notifications   |\n    | voidProperties     | 5         | void-{id}             | Void pipeline        |\n    | applicants         | varies    | app-{id}              | Housing register     |\n    | tsmMeasures        | 22        | tsm-{code}            | TSM indicators       |\n    | externalDataCache  | varies    | {source}:{key}        | API response cache   |\n    | imdData            | varies    | {lsoaCode}            | IMD deprivation      |\n\n5.2 Property Schema\n\n    {\n      id: string                    // Unique property ID\n      uprn: string                  // 12-digit UPRN\n      address: string               // Full address\n      postcode: string              // UK postcode\n      lat: number                   // Latitude\n      lng: number                   // Longitude\n      ward: string                  // Electoral ward (from postcodes.io)\n      lsoa: string                  // LSOA name\n      lsoaCode: string              // LSOA code (E01xxxxxx)\n      constituency: string          // Parliamentary constituency\n      type: 'flat'|'house'|'maisonette'|'bungalow'|'bedsit'|'studio'\n      tenure: 'secure'|'assured'|'AST'|'starter'|'fixed-term'|\n              'flexible'|'licence'|'shared-ownership'\n      bedrooms: number              // 0-5\n      floorArea: number             // Square metres\n      floor: number                 // For flats\n      construction: {\n        yearBuilt: number\n        type: string                // e.g. 'concrete panel', 'brick'\n        storeys: number\n        higherRisk: boolean         // ≥18m or ≥7 storeys\n      }\n      heating: {\n        type: string                // Gas central, electric, communal\n        boilerMake: string\n        boilerModel: string\n        boilerAge: number\n        lastService: string\n        efficiency: string\n      }\n      epc: {\n        rating: string              // A-G\n        sapScore: number            // 0-100\n        expiryDate: string\n        potentialRating: string\n        potentialScore: number\n        wallsDesc: string\n        roofDesc: string\n        windowsDesc: string\n        heatingDesc: string\n        co2Current: number\n        heatingCostAnnual: number\n        recommendations: string[]\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, contractor }\n        electrical: { status, expiryDate, contractor }\n        fire: { status, riskLevel, nextReview }\n        asbestos: { status, acmCount, managementPlan }\n        legionella: { status, nextReview, waterSystem }\n        lifts: { status, nextInspection }\n      }\n      stockCondition: {\n        components: [{\n          name, type, installYear, condition, remainingLife, replacementCost\n        }]\n      }\n      dampRisk: number              // 0-100 (AI-calculated)\n      isVoid: boolean\n      currentTenantId: string\n      estateId: string\n      blockId: string\n      regionId: string\n      localAuthorityId: string\n      accessibility: string[]       // Features list\n      photos: string[]\n      imdDecile: number             // 1-10 (from ONS)\n      imdScore: number\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile: string\n      householdMembers: [{\n        name, relationship, dateOfBirth, isDependent\n      }]\n      emergencyContact: {\n        name, relationship, phone\n      }\n      assignedOfficer: string\n      tenancyStatus: 'active'|'former'|'pending'|'suspended'\n      tenancyStartDate: string\n      tenureType: string\n      propertyId: string\n      weeklyRent: number\n      weeklyServiceCharge: number\n      weeklyTotalCharge: number\n      rentBalance: number           // Negative = arrears\n      paymentMethod: 'DD'|'UC'|'SO'|'Card'|'Cash'|'HB'\n      arrearsRisk: number           // 0-100 (AI-calculated)\n      ucStatus: 'not-claiming'|'claiming'|'transitioning'|'managed-migration'\n      ucManagedPayment: boolean\n      vulnerabilityFlags: [{\n        type, severity, notes, identifiedDate\n      }]\n      communicationPreference: 'email'|'phone'|'letter'|'sms'|'portal'\n      dependentsCount: number\n      employmentStatus: string\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string                    // e.g. REP-2025-00123\n      type: 'complaint'|'repair'|'asb'|'enquiry'|'financial'|\n            'safeguarding'|'damp-mould'\n      status: string                // Varies by type\n      priority: 'emergency'|'urgent'|'routine'|'planned'\n      subject: string\n      description: string\n      propertyId: string\n      tenantId: string\n      handler: string\n      createdDate: string\n      updatedDate: string\n      closedDate: string\n      slaTarget: string\n      slaStatus: 'within'|'approaching'|'breached'\n      daysOpen: number\n\n      // Repair-specific fields\n      sorCode: string\n      sorDescription: string\n      trade: string\n      operative: string\n      appointment: { date, slot, confirmed }\n      firstTimeFix: boolean\n      satisfaction: number           // 1-5\n      recurrenceRisk: number\n      awaabsLaw: {\n        applicable: boolean\n        hazardType: string\n        deadlines: { investigate, summary, safetyWorks, repairsBegun }\n      }\n\n      // Complaint-specific fields\n      stage: 'stage-1'|'stage-2'\n      acknowledgementDate: string\n      acknowledgementDeadline: string\n      responseDeadline: string\n      finding: 'upheld'|'partially-upheld'|'not-upheld'\n      remedy: string\n      learningLog: string\n      ombudsmanEscalation: boolean\n\n      // ASB-specific fields\n      asbCategory: string\n      severity: 'cat-1'|'cat-2'|'cat-3'\n      escalation: 'warning'|'ABC'|'CPW'|'CPN'|'injunction'|\n                  'possession'|'closure'\n      evidenceCount: number\n      multiAgencyPanel: boolean\n      legalActionProbability: number\n\n      // Financial-specific fields\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement: { amount, frequency, compliance }\n      escalationStage: 'pre-action'|'NOSP'|'court'|'possession'\n      preActionChecklist: object\n\n      // Damp-specific fields\n      hazardClassification: 'emergency'|'significant'|'non-urgent'\n      moistureLevel: number\n      humidityLevel: number\n      temperatureLevel: number\n      linkedRepairs: string[]\n    }\n\n5.5 External Data Cache Schema\n\n    {\n      // Document ID: {source}:{lookupKey}\n      source: string                // API identifier\n      lookupKey: string             // postcode, UPRN, lat/lng, LSOA\n      data: object                  // Cached response payload\n      fetchedAt: Timestamp\n      ttlSeconds: number\n      expiresAt: Timestamp\n      httpStatus: number\n      latencyMs: number\n    }\n\n5.6 Composite Indexes (17 defined in firestore.indexes.json)\n\n    Cases (5 indexes):\n    - type + status + createdDate (desc)\n    - type + handler + createdDate (desc)\n    - tenantId + createdDate (desc)\n    - propertyId + createdDate (desc)\n    - type + priority + createdDate (desc)\n\n    Properties (3 indexes):\n    - regionId + type\n    - estateId + isVoid\n    - blockId + type\n\n    Tenants (2 indexes):\n    - assignedOfficer + tenancyStatus\n    - arrearsRisk (desc)\n\n    Activities (2 indexes):\n    - tenantId + date (desc)\n    - caseId + date (desc)\n\n    Other (5 indexes):\n    - rentTransactions: tenantId + date (desc)\n    - auditLog: timestamp (desc)\n    - localAuthorities: regionId\n    - estates: localAuthorityId\n    - blocks: estateId\n\n5.7 Firestore Security Rules Summary\n\n    Rule helpers:\n    - isAuthenticated(): request.auth != null\n    - hasPersona(p): user doc has matching persona\n    - isManager(): persona in [coo, head-of-service, manager]\n    - isAdmin(): persona == 'coo'\n\n    Access patterns:\n    | Collection       | Read         | Create       | Update       | Delete   |\n    |------------------|-------------|-------------|-------------|----------|\n    | organisations    | auth        | admin       | admin       | admin    |\n    | regions          | auth        | admin       | admin       | admin    |\n    | localAuthorities | auth        | admin       | admin       | admin    |\n    | estates          | auth        | manager+    | manager+    | admin    |\n    | blocks           | auth        | manager+    | manager+    | admin    |\n    | properties       | auth        | manager+    | manager+    | admin    |\n    | tenants          | auth        | manager+    | manager+    | admin    |\n    | cases            | auth        | auth        | auth        | admin    |\n    | activities       | auth        | auth        | auth        | admin    |\n    | communications   | auth        | auth        | auth        | manager+ |\n    | rentTransactions | auth        | manager+    | manager+    | manager+ |\n    | users            | auth        | admin       | admin/self  | admin    |\n    | auditLog         | manager+    | auth        | never       | never    |\n\n\n6. API ARCHITECTURE (50+ Endpoints)\n================================================================================\n\n6.1 Auth Routes (/api/v1/auth)\n    POST  /seed-users              Create demo Firebase users (idempotent)\n    POST  /profile                 Create user profile on first registration\n    GET   /me                      Get authenticated user profile\n\n6.2 Properties Routes (/api/v1/properties)\n    GET   /                        List with filters (?regionId, ?estateId, ?blockId,\n                                     ?type, ?isVoid, ?limit)\n    GET   /available               Void properties for letting\n    GET   /:id                     Single property by ID\n    PATCH /:id                     Update property\n\n6.3 Tenants Routes (/api/v1/tenants)\n    GET   /                        List with filters\n    GET   /:id                     Single tenant by ID\n    PATCH /:id                     Update tenant\n\n6.4 Cases Routes (/api/v1/cases)\n    GET   /                        List with filters (?type, ?status, ?handler,\n                                     ?priority, ?propertyId, ?tenantId,\n                                     ?limit=50, ?offset)\n    GET   /:id                     Case with related activities\n    POST  /                        Create new case\n    PATCH /:id                     Update case\n    GET   /:id/activities          Activities for a case\n\n6.5 AI Routes (/api/v1/ai)\n    POST  /draft-communication     AI communication drafts\n    POST  /entity-intelligence     AI predictions/alerts per entity\n    POST  /neighbourhood-context   Neighbourhood briefing\n    POST  /property-intelligence   Property analysis\n    POST  /tenant-context          Tenant risk assessment\n    POST  /chat                    Conversational AI queries\n    GET   /damp-risk/:propertyId   Damp risk score\n    GET   /damp-risk/estate/:id    Estate-wide damp risk\n    GET   /crime-context/:estateId Crime correlation\n    GET   /crime-context/case/:id  Case crime context\n    GET   /vulnerability/:tenantId Vulnerability assessment\n    POST  /vulnerability/scan      Org-wide vulnerability scan\n    GET   /benefits-check/:id      Benefits entitlement check\n    GET   /property-passport/:id   Property passport\n    GET   /briefing/:estateId      Neighbourhood briefing\n    GET   /notify/templates        All GOV.UK Notify templates\n    GET   /notify/templates/:cat   Templates by category\n    GET   /notify/template/:id     Single template\n    POST  /notify/render           Render template with personalisation\n    GET   /mock/uc-verification/:id   DWP UC verification (mock)\n    GET   /mock/iot-sensors/:id       IoT sensor readings (mock)\n    GET   /mock/direct-debit/:id      GoCardless status (mock)\n    GET   /mock/labour-market/:code   NOMIS labour market (mock)\n    GET   /mock/repairs-marketplace/:id  Plentific/Fixflo (mock)\n    GET   /mock/regulatory/:type/:ref    RSH/CORE/Ombudsman (mock)\n    GET   /mock/signing/:type/:id        DocuSign (mock)\n    GET   /mock/referencing/:id          Experian/TransUnion (mock)\n    GET   /mock/land-registry/:id        Land Registry (mock)\n\n6.6 Public Data Routes (/api/v1/public-data)\n    GET   /police/:postcode        Street-level crime data\n    GET   /weather/:lat/:lng       Weather forecast\n    GET   /flood/:lat/:lng         Flood warnings\n    GET   /postcode/:postcode      Postcode lookup (geocoding, LSOA)\n    POST  /postcodes/bulk          Bulk postcode lookup\n    GET   /epc/:postcode           EPC certificates\n    GET   /imd/:lsoaCode           Index of Multiple Deprivation\n    GET   /census/:lsoaCode        Census 2021 demographics\n    GET   /nomis/:lsoaCode         NOMIS labour market\n    GET   /gas-safe/:regNo         Gas Safe Register verification\n    GET   /electrical-safety/:regNo  NICEIC verification\n\n6.7 Admin Routes (/api/v1/admin)\n    GET   /integrations            All 20 integration statuses\n    POST  /integrations/:id/toggle Toggle integration on/off\n    POST  /integrations/:id/test   Test integration connection\n    GET   /monitoring              System metrics & health\n\n6.8 Other Routes\n    GET   /api/v1/explore/*        Drill-down hierarchy queries\n    GET   /api/v1/briefing/*       AI briefing generation\n    GET   /api/v1/compliance/*     Compliance tracking\n    GET   /api/v1/rent/*           Financial tracking\n    GET   /api/v1/reports/*        Report generation\n    GET   /api/v1/export/*         HACT data export\n    GET   /api/v1/lettings/*       Lettings & allocations\n    POST  /api/v1/booking/*        Viewing/appointment booking\n    GET   /health                  Health check (Firestore, memory, uptime)\n\n\n7. EXTERNAL API INTEGRATION LAYER\n================================================================================\n\n7.1 Integration Pattern: Server-Side Proxy\n    All external API calls follow:\n    Client → Express route → Check Firestore cache → If valid: return cached →\n    If expired: Call external API → Transform → Cache in Firestore → Return →\n    If fail: Return simulated data with source: \"simulated\"\n\n7.2 Shared Service: external-api.ts\n    - fetchWithCache(source, key, ttl, fetchFn): cache-through helper\n    - rateLimiter(source, maxPerMinute): token bucket\n    - buildAuditEntry(source, endpoint, status, latency): audit logging\n    - simulatedFallback(source, key): synthetic data generator\n\n7.3 Integration Summary\n\n    TIER 1 — Live, No Key:\n    | API              | Base URL                          | Cache TTL | Rate Limit    |\n    |------------------|-----------------------------------|-----------|---------------|\n    | Police.uk        | data.police.uk/api                | 24 hours  | 15 req/sec    |\n    | Open-Meteo       | api.open-meteo.com/v1             | 1 hour    | 10,000/day    |\n    | DEFRA Flood      | environment.data.gov.uk/flood-*   | 1 hour    | Fair use      |\n\n    TIER 2 — Live, Key Required:\n    | API              | Base URL                          | Cache TTL | Status         |\n    |------------------|-----------------------------------|-----------|----------------|\n    | Postcodes.io     | api.postcodes.io                  | 90 days   | Live           |\n    | Open UPRN        | uprn.uk                           | 90 days   | Live           |\n    | EPC Register     | epc.opendatacommunities.org/api   | 30 days   | Live+fallback  |\n    | NOMIS/Census     | nomisweb.co.uk/api/v01            | 7 days    | Live           |\n    | Gas Safe         | (verification endpoint)           | 30 days   | Live+fallback  |\n    | Electrical Safety| (verification endpoint)           | 30 days   | Live+fallback  |\n\n    TIER 3 — Mock Services:\n    | API              | Service Function                  | Purpose                 |\n    |------------------|------------------------------------|-------------------------|\n    | DWP/UC           | mockUcVerification()              | UC status, APA          |\n    | IoT Sensors      | mockIotSensors()                  | Switchee, Aico, HomeLync|\n    | GoCardless       | mockDirectDebit()                 | DD payments             |\n    | Plentific/Fixflo | mockRepairsMarketplace()          | Contractor dispatch     |\n    | RSH/CORE         | mockRegulatorySubmission()        | Regulatory returns      |\n    | DocuSign         | mockSigningEnvelope()             | Digital signing         |\n    | Experian         | mockReferencingResult()           | Tenant referencing      |\n    | Land Registry    | mockLandRegistryTitle()           | Title/ownership data    |\n    | NOMIS Extended   | mockLabourMarket()                | Labour market stats     |\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication\n    - Firebase Authentication (Google SSO + email/password)\n    - JWT tokens verified on every API request\n    - Token injection via api-client.ts Authorization header\n    - Demo users seeded via /api/v1/auth/seed-users\n\n8.2 Authorisation (RBAC)\n    - 5 persona levels: COO > Head of Service > Manager > Officer > Operative\n    - Per-module permissions: view, create, edit, delete, approve\n    - Firestore security rules enforce at database level\n    - Express middleware enforces at API level\n\n8.3 Transport Security\n    - HTTPS enforced by Cloud Run (managed SSL)\n    - CSP headers whitelist: Google APIs, Firebase, OSM tiles, Google Fonts\n    - CORS restricted to allowed origins (localhost:5173, Cloud Run URL)\n    - Helmet middleware for security headers\n\n8.4 Data Security\n    - Secret Manager for all credentials (4 secrets)\n    - No API keys in codebase (removed in Session 2)\n    - .mcp.json in .gitignore (contains Telegram bot token)\n    - .env files never committed\n    - JSON body limit: 1MB\n    - Structured error responses (no stack traces in production)\n    - Request correlation IDs for audit trail\n\n8.5 Rate Limiting\n    - Sliding window rate limiter (token bucket pattern)\n    - 4 tiers: API (100/min), Auth (10/min), AI (30/min), Admin (20/min)\n    - Per-source rate limiting for external APIs\n\n\n9. DEPLOYMENT & INFRASTRUCTURE\n================================================================================\n\n9.1 Docker Build (3-Stage)\n    Stage 1 — Build Client:\n    - Node 20 slim → npm ci --legacy-peer-deps → Vite build → dist/\n    Stage 2 — Build Server:\n    - Node 20 slim → npm ci → TypeScript compile → dist/\n    Stage 3 — Production:\n    - Node 20 slim → production deps only → copy artifacts\n    - curl for health checks\n    - PORT=8080, NODE_ENV=production\n    - CMD: node server/dist/index.js\n\n9.2 Cloud Run Configuration\n    - Service: socialhomes\n    - Region: europe-west2 (London)\n    - Memory: 1Gi\n    - CPU: 1\n    - Min instances: 0\n    - Max instances: 10\n    - Port: 8080\n    - Secrets: 4 from Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN,\n      FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n9.3 Cloud Build (CI/CD)\n    - Trigger: git push to main\n    - Config: cloudbuild.yaml\n    - Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n      cloud-run-source-deploy/socialhomes\n    - NOTE: cloudbuild.yaml needs updating for correct Artifact Registry path\n      (task 5.5.1 in EXECUTION-PLAN.md)\n\n9.4 Infrastructure References\n    - GCP Project ID: gen-lang-client-0878518473\n    - GCP Project Number: 587984201316\n    - Firebase Project: gen-lang-client-0146156913\n    - Service URL: https://socialhomes-587984201316.europe-west2.run.app\n    - GitHub: https://github.com/rajivpeter/SocialHomes_ai\n    - Service Account: 587984201316-compute@developer.gserviceaccount.com\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Health Endpoint (GET /health)\n    Returns:\n    - status: 'healthy' | 'degraded' | 'unhealthy'\n    - firestore: connectivity check with latency\n    - memory: RSS, heap used/total\n    - uptime: seconds\n\n10.2 Metrics Service (monitoring.ts)\n    Tracks:\n    - Request counts by route\n    - Response times (P50, P95, P99)\n    - Status code distribution\n    - Endpoint hit counts\n    - Cache hit/miss ratios\n\n10.3 Admin Monitoring (GET /api/v1/admin/monitoring)\n    Aggregated metrics dashboard for admin users.\n\n10.4 Audit Trail\n    Every significant action logged to auditLog collection:\n    - timestamp, user, entity, field, old value, new value, IP\n    - External API calls logged with source, endpoint, status, latency\n\n10.5 Telegram Notifications\n    Bot: @SocialHomesBot (MCP integration)\n    - Build status, deployment confirmations\n    - Test results, error alerts\n    - Progress updates\n\n\n11. ACCESSIBILITY IMPLEMENTATION\n================================================================================\n\n11.1 WCAG 2.2 AA Compliance\n    - Focus traps on modals (Tab wrapping, Escape key handler)\n    - ARIA attributes: role=\"dialog\", aria-modal, aria-labelledby,\n      aria-describedby, aria-required, aria-invalid\n    - Form validation: noValidate + custom with inline errors\n    - Skip-to-content link with id=\"main-content\" on <main>\n    - Navigation: aria-label=\"Main navigation\" on <nav>\n    - Focus-visible outline styles on *:focus-visible\n    - Reduced motion: @media (prefers-reduced-motion: reduce)\n    - Screen reader: .sr-only class\n    - Keyboard navigation throughout all workflows\n    - htmlFor on all form labels\n\n\n12. PHASE 5 ARCHITECTURE TARGETS\n================================================================================\n\n12.1 Vertex AI / Gemini Integration\n    - Server-side Vertex AI SDK with streaming responses (SSE)\n    - Context-aware system prompts per entity type\n    - Conversation history persistence in Firestore\n    - Token counting and budget enforcement\n    - PII masking and hallucination prevention guardrails\n\n12.2 WebSocket (Socket.io)\n    - Real-time notifications via Socket.io\n    - Authentication handshake with Firebase JWT\n    - Room-based subscriptions (per-user, per-estate, per-org)\n    - Cloud Run sticky sessions configuration\n\n12.3 Event-Driven Architecture\n    - Cloud Pub/Sub for async workflows\n    - Topics: case-created, compliance-expiring, arrears-threshold, damp-alert\n    - Dead letter queues for failed processing\n\n12.4 Multi-Tenant SaaS\n    - Organisation-scoped Firestore queries\n    - Tenant context middleware\n    - Per-org branding customisation\n    - Data partitioning strategy\n\n\n================================================================================\n  End of Document\n  Doc2 — SocialHomes.Ai Technical Architecture v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":9,"newStart":1,"newLines":25,"lines":[" ================================================================================","   Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Version: 6.0  |  Date: 2026-02-25","+  Version: 7.0  |  Date: 2026-02-26","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," ","+TABLE OF CONTENTS","+================================================================================","+  1.  System Architecture Overview","+  2.  Technology Stack (with versions)","+  3.  Frontend Architecture","+  4.  Backend Architecture","+  5.  Data Models (Firestore Schemas)","+  6.  API Architecture (50+ Endpoints)","+  7.  External API Integration Layer","+  8.  Security Architecture","+  9.  Deployment & Infrastructure","+  10. Monitoring & Observability","+  11. Accessibility Implementation","+  12. Phase 5 Architecture Targets","+","+"," 1. SYSTEM ARCHITECTURE OVERVIEW"," ================================================================================"," "]},{"oldStart":12,"oldLines":10,"newStart":28,"newLines":10,"lines":["     deployed as a single container on Google Cloud Run. The Express server","     serves both the API and the built React static assets."," ","-1.2 High-Level Architecture Diagram (ASCII)","+1.2 High-Level Architecture Diagram"," ","     +-------------------------------------------------------------+","-    |                        CLOUD RUN (europe-west2)              |","+    |                    CLOUD RUN (europe-west2)                  |","     |  +-----------------------------------------------------------+","     |  |                    Express.js Server                      |","     |  |  +--------------+  +--------------+  +---------------+   |"]},{"oldStart":35,"oldLines":7,"newStart":51,"newLines":7,"lines":["     |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |","     |  |  +---------+ +----------+ +----------+ +-------------+   |","     |  +---------------------------+-------------------------------+","-    +------------------------------+--------------------------------+","+    +------------------------------+-------------------------------+","                                    |","               +--------------------+--------------------+","               |                    |                     |"]},{"oldStart":69,"oldLines":7,"newStart":85,"newLines":40,"lines":["          +---> External API Proxy (with cache)","          +---> AI Service (computation)"," ","+1.4 Monorepo Structure"," ","+    socialhomes/","+    ├── app/                    # React frontend","+    │   ├── src/","+    │   │   ├── components/     # Shared + layout components","+    │   │   ├── context/        # AppContext (state management)","+    │   │   ├── contexts/       # AuthContext (Firebase auth)","+    │   │   ├── data/           # Mock/seed data files","+    │   │   ├── hooks/          # Custom React hooks","+    │   │   ├── pages/          # 20+ page components (19 directories)","+    │   │   ├── services/       # API client, Firebase, AI drafting","+    │   │   ├── types/          # TypeScript type definitions","+    │   │   └── utils/          # Format utilities","+    │   ├── package.json","+    │   └── vite.config.ts","+    ├── server/                 # Express backend","+    │   ├── src/","+    │   │   ├── middleware/      # Auth, RBAC, rate limit, metrics, errors","+    │   │   ├── models/         # Firestore schemas, HACT codes","+    │   │   ├── routes/         # 16 route modules","+    │   │   ├── scripts/        # Data seeding scripts","+    │   │   └── services/       # 19 service modules","+    │   ├── package.json","+    │   └── tsconfig.json","+    ├── tests/                  # Selenium test suites","+    ├── docs/                   # Documentation","+    │   └── requirements/       # Specification documents (this file)","+    ├── Dockerfile              # 3-stage production build","+    ├── cloudbuild.yaml         # Cloud Build CI/CD","+    ├── firestore.rules         # Firestore security rules","+    └── firestore.indexes.json  # Composite indexes (17)","+","+"," 2. TECHNOLOGY STACK"," ================================================================================"," "]},{"oldStart":79,"oldLines":16,"newStart":128,"newLines":25,"lines":["     |--------------------|-------------------------|------------|","     | Framework          | React                   | 19.2.0     |","     | Language           | TypeScript              | 5.9.3      |","-    | Router             | React Router            | v7         |","+    | Router             | React Router DOM        | 6.30.3     |","     | Styling            | Tailwind CSS            | 4.1.18     |","+    | Tailwind Vite      | @tailwindcss/vite       | 4.1.18     |","     | State Management   | React Context + Hooks   | --         |","     | Data Fetching      | @tanstack/react-query   | 5.90.20    |","-    | 3D Visualization   | Three.js + React Three  | 0.182.0    |","-    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |","-    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |","+    | 3D Visualisation   | Three.js                | 0.182.0    |","+    | 3D React Binding   | @react-three/fiber      | 9.5.0      |","+    | 3D Helpers         | @react-three/drei       | 10.7.7     |","+    | Maps               | Leaflet                 | 1.9.4      |","+    | React Maps         | React Leaflet           | 5.0.0      |","+    | Charts             | Recharts                | 3.7.0      |","+    | Advanced Charts    | D3.js                   | 7.9.0      |","     | Icons              | Lucide React            | 0.563.0    |","-    | Auth UI            | FirebaseUI              | latest     |","+    | Auth UI            | FirebaseUI              | 6.1.0      |","+    | Firebase Client    | Firebase                | 12.9.0     |","+    | Date Utilities     | date-fns                | 4.1.0      |","+    | Class Names        | clsx                    | 2.1.1      |","     | Build Tool         | Vite                    | 7.2.4      |","+    | Linter             | ESLint                  | 9.39.1     |"," "," 2.2 Backend Stack"," "]},{"oldStart":98,"oldLines":343,"newStart":156,"newLines":306,"lines":["     | Language           | TypeScript              | 5.7.0      |","     | Runtime            | Node.js                 | 20.17.0    |","     | Database           | Google Firestore        | Native     |","-    | Auth               | Firebase Admin SDK      | 13.6.1     |","-    | Security           | Helmet                  | 8.1.0      |","+    | Firebase Admin     | firebase-admin          | 13.6.1     |","+    | Firestore SDK      | @google-cloud/firestore | 7.11.0     |","+    | Security Headers   | Helmet                  | 8.1.0      |","     | CORS               | cors                    | 2.8.5      |","-    | Logging            | Morgan                  | 1.10.0     |","     | Compression        | compression             | 1.8.0      |","-    | Testing            | Vitest                  | 4.0.18     |","-    | Build              | tsc + tsx                | latest     |","+    | Logging            | Morgan                  | 1.10.0     |","+    | TS Runner          | tsx                     | 4.19.4     |","+    | Test Framework     | Vitest                  | 4.0.18     |"," ","-2.3 Infrastructure","+2.3 Infrastructure Stack"," ","-    | Component          | Technology              | Details              |","-    |--------------------|-------------------------|----------------------|","-    | Hosting            | Google Cloud Run        | europe-west2         |","-    | Container Registry | Artifact Registry       | europe-west2         |","-    | Database           | Google Firestore        | Native mode          |","-    | Authentication     | Firebase Auth           | Google SSO + email   |","-    | Secrets            | Secret Manager          | 4 secrets            |","-    | CI/CD              | Cloud Build             | Auto on git push     |","-    | Source Control     | GitHub                  | rajivpeter repo      |","-    | Monitoring         | Custom metrics + health | In-app               |","-    | Session Capture    | Entire.io               | Manual commit        |","+    | Component          | Technology              | Details          |","+    |--------------------|-------------------------|------------------|","+    | Container Platform | Google Cloud Run        | europe-west2     |","+    | Database           | Google Firestore        | Native mode      |","+    | Authentication     | Firebase Auth           | Google SSO       |","+    | Secrets            | Secret Manager          | 4 secrets        |","+    | Container Registry | Artifact Registry       | europe-west2     |","+    | CI/CD              | Cloud Build             | On git push      |","+    | Source Control      | GitHub                  | rajivpeter/      |","+    | Session Tracking   | Entire.io               | v0.4.4           |","+    | Notifications      | Telegram MCP            | @SocialHomesBot  |"," ","-2.4 Testing Stack"," ","-    | Component          | Technology              | Coverage             |","-    |--------------------|-------------------------|----------------------|","-    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |","-    | Unit               | Vitest                  | 66 tests             |","-    | Type Checking      | TypeScript (strict)     | 0 errors             |","-","-"," 3. FRONTEND ARCHITECTURE"," ================================================================================"," ","-3.1 Directory Structure","+3.1 Component Hierarchy"," ","-    app/src/","-    +-- App.tsx                  -- Router with 40+ routes","-    +-- main.tsx                 -- React DOM entry point (QueryClient)","-    +-- index.css                -- Global styles, animations, accessibility","-    |","-    +-- pages/                   -- 19 page directories","-    |   +-- admin/               -- AdminPage, IntegrationsPage","-    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)","-    |   +-- allocations/         -- AllocationsPage","-    |   +-- asb/                 -- AsbPage, AsbDetailPage","-    |   +-- auth/                -- LoginPage (Firebase + Google)","-    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)","-    |   +-- communications/      -- CommunicationsPage","-    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage","-    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage","-    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)","-    |   +-- explore/             -- ExplorePage (7-level drill-down)","-    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,","-    |   |                          ApplicationPage, ViewingBookingPage","-    |   +-- rent/                -- RentPage","-    |   +-- repairs/             -- RepairsPage, RepairDetailPage","-    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage","-    |   +-- search/              -- SearchPage","-    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage","-    |   +-- tenant-portal/       -- TenantPortalPage","-    |   +-- shared/              -- ComingSoonPage","-    |","-    +-- components/","-    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist","-    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,","-    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,","-    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,","-    |                              PropertyMap, StatusPill, VulnerabilityPanel)","-    |","-    +-- data/                    -- Mock/seed data (10 files)","-    +-- hooks/                   -- Custom hooks (3 files)","-    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods","-    |   +-- useEntityIntelligence.ts  -- AI scoring hooks","-    |   +-- usePersonaScope.ts   -- Persona-based data filtering","-    +-- types/                   -- TypeScript definitions (721 lines)","-    +-- services/                -- API client (70+ methods), Firebase, AI drafting,","-    |                              public data helpers","-    +-- contexts/                -- AuthContext, AppContext","-    +-- utils/                   -- Formatting utilities (safeText, etc.)","-    +-- assets/                  -- Images, fonts","+    App.tsx (root)","+    └── AuthProvider (Firebase auth context)","+        └── AppProvider (global state: persona, theme)","+            └── QueryClientProvider (React Query)","+                └── BrowserRouter","+                    └── Routes","+                        ├── LoginPage (unauthenticated)","+                        └── Layout (authenticated shell)","+                            ├── Sidebar (persistent left nav)","+                            ├── Header (top bar)","+                            ├── Breadcrumbs","+                            ├── YantraAssist (AI panel)","+                            └── <Page> (content area)"," ","-3.2 Routing Architecture (React Router v7)","-    All routes defined in App.tsx within BrowserRouter.","-    Routes wrapped in Layout component (sidebar + header).","-    Protected routes use ProtectedRoute component (Firebase auth guard).","+3.2 Layout Components (app/src/components/layout/)","+    - Layout.tsx: main shell with sidebar, header, content area","+    - Sidebar.tsx: persistent left nav (280px, collapsible to 64px)","+    - Header.tsx: top bar with search, notifications, persona, AI trigger","+    - Breadcrumbs.tsx: hierarchical path navigation","+    - YantraAssist.tsx: contextual AI assistant panel"," ","-    Key Route Groups:","-    /                            -> Redirect to /dashboard","-    /login                       -> LoginPage (public)","-    /dashboard                   -> DashboardPage","-    /explore                     -> ExplorePage","-    /tenancies                   -> TenanciesPage","-    /tenancies/:id               -> TenancyDetailPage","-    /properties                  -> PropertiesPage","-    /properties/:id              -> PropertyDetailPage","-    /properties/:id/apply        -> ApplicationPage","-    /properties/:id/book-viewing -> ViewingBookingPage","-    /repairs                     -> RepairsPage","-    /repairs/:id                 -> RepairDetailPage","-    /compliance                  -> CompliancePage","-    /compliance/:type            -> ComplianceTypePage","-    /compliance/awaabs-law       -> AwaabsLawPage","-    /complaints                  -> ComplaintsPage","-    /complaints/:id              -> ComplaintDetailPage","-    /asb                         -> AsbPage","-    /asb/:id                     -> AsbDetailPage","-    /rent                        -> RentPage","-    /allocations                 -> AllocationsPage","-    /communications              -> CommunicationsPage","-    /reports                     -> ReportsPage","-    /reports/:type               -> DynamicReportPage","-    /reports/tsm                 -> TsmReportPage","-    /ai-centre                   -> AiCentrePage","-    /briefing                    -> BriefingPage","-    /admin                       -> AdminPage","-    /admin/integrations          -> IntegrationsPage","-    /tenant-portal               -> TenantPortalPage","-    /search                      -> SearchPage","+3.3 Shared Components (app/src/components/shared/)","+    - ActionModal.tsx: modal with focus trap, ARIA, validation","+    - AiActionCard.tsx: AI dynamic action display","+    - BenefitsPanel.tsx: UK benefits entitlement analysis","+    - CountdownTimer.tsx: SLA/deadline countdown with colour transitions","+    - DampIntelligencePanel.tsx: 5-factor damp risk display","+    - HelpDrawer.tsx: contextual help system (20 pages)","+    - KpiCard.tsx: metric display with trend sparklines","+    - NeighbourhoodBriefingPanel.tsx: estate-level AI briefing","+    - PropertyMap.tsx: Leaflet map for property location","+    - ProtectedRoute.tsx: auth guard with role checking","+    - StatusPill.tsx: status indicator pills","+    - VulnerabilityPanel.tsx: 7-factor vulnerability display"," ","-3.3 State Management","-    - React Context for global state (auth user, persona)","-    - @tanstack/react-query for server state (API caching, 5-min stale time)","-    - Local component state (useState, useReducer) for UI state","-    - No Redux/Zustand — kept deliberately simple","+3.4 Pages (app/src/pages/ — 19 directories, 30+ page components)","+    admin/          AdminPage.tsx, IntegrationsPage.tsx","+    ai-centre/      AiCentrePage.tsx","+    allocations/    AllocationsPage.tsx","+    asb/            AsbPage.tsx, AsbDetailPage.tsx","+    auth/           LoginPage.tsx","+    briefing/       BriefingPage.tsx","+    communications/ CommunicationsPage.tsx","+    complaints/     ComplaintsPage.tsx, ComplaintDetailPage.tsx","+    compliance/     CompliancePage.tsx, ComplianceTypePage.tsx, AwaabsLawPage.tsx","+    dashboard/      DashboardPage.tsx","+    explore/        ExplorePage.tsx","+    properties/     PropertiesPage.tsx, PropertyDetailPage.tsx,","+                    ApplicationPage.tsx, ViewingBookingPage.tsx","+    rent/           RentPage.tsx","+    repairs/        RepairsPage.tsx, RepairDetailPage.tsx","+    reports/        ReportsPage.tsx, TsmReportPage.tsx, DynamicReportPage.tsx","+    search/         SearchPage.tsx","+    tenancies/      TenanciesPage.tsx, TenancyDetailPage.tsx","+    tenant-portal/  TenantPortalPage.tsx"," ","-3.4 Data Fetching Layer","-    - api-client.ts: 70+ typed API methods organized by domain","-    - useApi.ts: React Query hooks wrapping api-client methods","-    - useEntityIntelligence.ts: AI scoring hooks","-    - usePersonaScope.ts: Persona-based data filtering","-    - Timestamp sanitization in api-client to handle Firestore timestamps","+3.5 State Management","+    - AppContext.tsx: persona, theme, navigation state","+    - AuthContext.tsx: Firebase auth state, user profile","+    - React Query: server state management with caching","+    - No localStorage or sessionStorage (per spec)"," ","-3.5 Frontend Conventions","-    - safeText() helper for rendering potentially undefined values","-    - ?? [] for nullable arrays (prevents React Error #310)","-    - Tailwind CSS utility classes (no CSS modules)","-    - Lucide React for all icons","-    - Purple border for AI-generated elements","-    - Consistent page structure: header + filter bar + content grid","-    - ErrorBoundary wrapping for error resilience","+3.6 Hooks (app/src/hooks/)","+    - useApi.ts: 10+ React Query hooks for data fetching","+    - useEntityIntelligence.ts: AI context for entity pages","+    - usePersonaScope.ts: persona-scoped data filtering"," ","-3.6 Accessibility Implementation","-    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",","-      aria-modal, aria-labelledby, aria-describedby, focus restoration","-    - index.css: *:focus-visible outlines, prefers-reduced-motion,","-      .sr-only class, .skip-to-content link, .field-error styles","-    - Layout: skip-to-content link + id=\"main-content\" on <main>","-    - Sidebar: aria-label on <nav> and collapse button","-    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes","+3.7 Services (app/src/services/)","+    - api-client.ts (13KB): centralised HTTP client, auth token injection","+    - firebase.ts (2.6KB): Firebase client initialisation","+    - ai-drafting.ts (18KB): template-based communication generation","+    - public-data.ts (69KB): complex public data aggregation + fallbacks"," ","+3.8 Data (app/src/data/)","+    - Seed/mock data files for all entity types","+    - estates.ts, properties.ts, tenants.ts, cases.ts, regions.ts","+    - help-content.ts: 20-page contextual help system","+    - organisation.ts: RCHA organisation profile"," ","+"," 4. BACKEND ARCHITECTURE"," ================================================================================"," ","-4.1 Directory Structure","+4.1 Server Entry Point (server/src/index.ts)","+    Express application with middleware pipeline:","+    1. Morgan (HTTP logging)","+    2. Helmet (security headers)","+    3. CORS (allowed origins)","+    4. Compression (gzip/brotli)","+    5. JSON parser (1MB limit)","+    6. X-Request-ID (correlation)","+    7. Rate limiter (4 tiers)","+    8. Metrics recorder","+    9. Route handlers","+    10. Error handler (structured, no stack leaks in production)"," ","-    server/src/","-    +-- index.ts                 -- Express entry, middleware, route registration","-    |","-    +-- middleware/               -- 5 middleware modules","-    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback","-    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)","-    |   +-- metrics.ts           -- Request/response metrics recording","-    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)","-    |   +-- rbac.ts              -- Role-based access control","-    |","-    +-- routes/                  -- 16 route modules (2,300+ lines)","-    |   +-- admin.ts             -- Integration management, monitoring","-    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints","-    |   +-- auth.ts              -- Login, register, logout","-    |   +-- briefing.ts          -- Personalised morning briefing","-    |   +-- booking.ts           -- Viewing bookings, applications","-    |   +-- cases.ts             -- Unified case CRUD + pagination","-    |   +-- compliance.ts        -- Big 6 compliance data","-    |   +-- explore.ts           -- Hierarchy drill-down data","-    |   +-- export.ts            -- CSV/PDF exports","-    |   +-- lettings.ts          -- Void management, allocations","-    |   +-- properties.ts        -- Property list/detail","-    |   +-- public-data.ts       -- External API proxy (Tier 1-2)","-    |   +-- rent.ts              -- Arrears, statements, transactions","-    |   +-- reports.ts           -- 27 regulatory reports","-    |   +-- tenants.ts           -- Tenant list/detail","-    |","-    +-- services/                -- 25 service modules","-    |   +-- external-api.ts      -- Cache-through, rate limiting, audit","-    |   +-- firestore.ts         -- Firestore connection + helpers","-    |   +-- firebase-admin.ts    -- Firebase Admin initialization","-    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm","-    |   +-- crime-context.ts     -- Police data correlation","-    |   +-- vulnerability-detection.ts  -- 7-factor scoring","-    |   +-- benefits-engine.ts   -- UK benefit rules engine","-    |   +-- property-passport.ts -- Multi-source aggregation","-    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing","-    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)","-    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)","-    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints","-    |   +-- monitoring.ts        -- Metrics singleton","-    |   +-- hact-export.ts       -- HACT reporting format","-    |   +-- seed.ts              -- Database seeding","-    |   +-- seed-data.ts         -- Seed data definitions","-    |   +-- hact-codes.ts        -- SOR code definitions","-    |","-    +-- models/","-    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)","-    |   +-- hact-codes.ts        -- Repair code models","-    |","-    +-- scripts/","-        +-- seed-imd.ts          -- IMD data loader","-        +-- seed.ts              -- Main seed runner","+    Static file serving: Vite build output from app/dist/","+    Health endpoint: GET /health"," ","-4.2 Middleware Pipeline (Request Flow)","+4.2 Middleware (server/src/middleware/)","+    - auth.ts: Firebase token verification, user context injection","+    - rbac.ts: role-based access control by persona level","+    - rate-limiter.ts: sliding window rate limiter","+      * API: 100/minute","+      * Auth: 10/minute","+      * AI: 30/minute","+      * Admin: 20/minute","+    - metrics.ts: request/response metrics on res.finish","+    - error-handler.ts: structured JSON errors, correlation IDs"," ","-    Request -> Morgan Logger -> Helmet (CSP, security headers)","-            -> CORS (restricted origins) -> Compression (gzip)","-            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)","-            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler","-            -> Error Handler -> Response","+4.3 Route Modules (server/src/routes/ — 16 modules)","+    | Route Module      | Mount Path               | Purpose                    |","+    |-------------------|--------------------------|----------------------------|","+    | auth.ts           | /api/v1/auth             | Authentication, profiles   |","+    | ai.ts             | /api/v1/ai               | AI services (17KB)         |","+    | admin.ts          | /api/v1/admin            | Admin functions             |","+    | properties.ts     | /api/v1/properties       | Property CRUD & queries    |","+    | tenants.ts        | /api/v1/tenants          | Tenant management          |","+    | cases.ts          | /api/v1/cases            | Unified case management    |","+    | explore.ts        | /api/v1/explore          | Drill-down hierarchy       |","+    | briefing.ts       | /api/v1/briefing         | AI briefing generation     |","+    | compliance.ts     | /api/v1/compliance       | Compliance tracking        |","+    | rent.ts           | /api/v1/rent             | Financial tracking         |","+    | reports.ts        | /api/v1/reports          | Report generation          |","+    | public-data.ts    | /api/v1/public-data      | External API proxy (22KB)  |","+    | export.ts         | /api/v1/export           | Data export (HACT)         |","+    | lettings.ts       | /api/v1/lettings         | Lettings & allocations     |","+    | booking.ts        | /api/v1/booking          | Viewing/appointment        |","+    | public-data.test  | (test file)              | 66 tests (29KB)            |"," ","-4.3 Rate Limiting (4 Tiers)","+4.4 Service Modules (server/src/services/ — 19 modules)"," ","-    | Tier    | Routes              | Limit        | Window  |","-    |---------|---------------------|--------------|---------|","-    | API     | /api/v1/*           | 100 req/min  | Sliding |","-    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |","-    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |","-    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |","+    AI & Intelligence Services:","+    | Service                     | File                          | Size   |","+    |-----------------------------|-------------------------------|--------|","+    | Damp Prediction             | damp-prediction.ts            | 17KB   |","+    | Crime Context               | crime-context.ts              | 11KB   |","+    | Vulnerability Detection     | vulnerability-detection.ts    | 16KB   |","+    | Benefits Engine             | benefits-engine.ts            | 11KB   |","+    | Property Passport           | property-passport.ts          | 11KB   |","+    | Neighbourhood Briefing      | neighbourhood-briefing.ts     | 14KB   |","+    | GOV.UK Notify               | govuk-notify.ts               | 45KB   |"," ","-4.4 Error Handling","-    - Structured JSON error responses: { error, message, statusCode }","-    - No stack traces leaked in production","-    - Error logging with request ID correlation (X-Request-ID)","-    - Graceful degradation for external API failures","-    - ErrorBoundary on frontend for component-level recovery","+    Data & Integration Services:","+    | Service                     | File                          | Size   |","+    |-----------------------------|-------------------------------|--------|","+    | External API Client         | external-api.ts               | 5.1KB  |","+    | Census/NOMIS                | census-nomis.ts               | 17KB   |","+    | Mock Services               | mock-services.ts              | 23KB   |","+    | HACT Export                  | hact-export.ts                | 5.5KB  |"," ","-4.5 Health Check","-    GET /health -> { status, firestore, uptime, memory, timestamp }","-    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy","-    Memory: RSS, heap used, heap total","+    Core Infrastructure:","+    | Service                     | File                          | Size   |","+    |-----------------------------|-------------------------------|--------|","+    | Firebase Admin              | firebase-admin.ts             | 1.7KB  |","+    | Firestore Operations        | firestore.ts                  | 4.9KB  |","+    | Seed Data                   | seed-data.ts                  | 28KB   |","+    | Seed Runner                 | seed.ts                       | 9.1KB  |","+    | Monitoring                  | monitoring.ts                 | 4.4KB  |"," ","+    Test Files:","+    | Test                        | File                          | Size   |","+    |-----------------------------|-------------------------------|--------|","+    | External API Tests          | external-api.test.ts          | 12KB   |","+    | Firestore Tests             | firestore.test.ts             | 6.7KB  |","+    | Public Data Tests           | public-data.test.ts           | 29KB   |"," ","-5. DATA MODELS (FIRESTORE)","-================================================================================","+4.5 Models (server/src/models/)","+    - firestore-schemas.ts: Firestore collection schemas and validation","+    - hact-codes.ts: HACT Housing Data Standard reference codes"," ","-5.1 Collection Map (17+ Collections)"," ","-    +------------------+     +------------------+     +------------------+","-    |   organisations  |     |      users       |     |      teams       |","-    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |","-    +------------------+     +------------------+     +------------------+","-                                    |","-                                    v","-    +------------------+     +------------------+     +------------------+","-    |   properties     |<--->|     tenants      |<--->|      cases       |","-    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |","-    +--------+---------+     +------------------+     +--------+---------+","-             |                                                 |","-             v                                                 v","-    +------------------+     +------------------+     +------------------+","-    |   repairs        |     |   complaints     |     |       asb        |","-    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |","-    +------------------+     +------------------+     +------------------+","-                                                              |","-    +------------------+     +------------------+     +-------v----------+","-    |   financial      |     |   damp-mould     |     |   activities     |","-    |   (docs)         |     |   (docs)         |     |   (docs)         |","-    +------------------+     +------------------+     +------------------+","+5. DATA MODELS (Firestore Schemas)","+================================================================================"," ","-    +------------------+     +------------------+     +------------------+","-    |   tasks          |     |  integrations    |     |    auditLog      |","-    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |","-    +------------------+     +------------------+     +------------------+","+5.1 Firestore Collections"," ","-    +----------------------+     +------------------+","-    |  externalDataCache   |     |    imdData       |","-    |  (TTL-based cache)   |     |   (LSOA docs)    |","-    +----------------------+     +------------------+","+    | Collection         | Doc Count | Document ID Format   | Purpose              |","+    |--------------------|-----------|-----------------------|----------------------|","+    | organisations      | 1         | org-{id}              | Organisation profile |","+    | regions            | 3         | region-{id}           | Geographic regions   |","+    | localAuthorities   | ~5        | la-{id}               | Local authorities    |","+    | estates            | 5         | estate-{id}           | Housing estates      |","+    | blocks             | ~12       | block-{id}            | Building blocks      |","+    | properties         | 75        | {id}                  | Housing units        |","+    | tenants            | 68        | {id}                  | Tenant records       |","+    | cases              | 279+      | {type-prefix}-{num}   | All case types       |","+    | activities         | varies    | auto-id               | Case activity log    |","+    | communications     | varies    | auto-id               | Multi-channel comms  |","+    | rentTransactions   | varies    | auto-id               | Financial records    |","+    | users              | varies    | uid                   | User profiles        |","+    | auditLog           | varies    | auto-id               | Access audit trail   |","+    | hactCodes          | varies    | code                  | HACT reference data  |","+    | notifications      | varies    | auto-id               | User notifications   |","+    | voidProperties     | 5         | void-{id}             | Void pipeline        |","+    | applicants         | varies    | app-{id}              | Housing register     |","+    | tsmMeasures        | 22        | tsm-{code}            | TSM indicators       |","+    | externalDataCache  | varies    | {source}:{key}        | API response cache   |","+    | imdData            | varies    | {lsoaCode}            | IMD deprivation      |"," ","-    Geography Hierarchy:","-    +------------------+     +------------------+     +------------------+","-    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |","-    +------------------+     +------------------+     +--------+---------+","-                                                              |","-                                                     +--------v---------+","-                                                     |    blocks (8)    |","-                                                     +------------------+","-"," 5.2 Property Schema"," ","     {","-      id: string                    // Firestore document ID","+      id: string                    // Unique property ID","       uprn: string                  // 12-digit UPRN","-      address: {","-        line1: string","-        line2?: string","-        town: string","-        postcode: string            // Real SE London postcode","-        lat: number","-        lng: number","-        lsoaCode: string            // LSOA for IMD/Census","+      address: string               // Full address","+      postcode: string              // UK postcode","+      lat: number                   // Latitude","+      lng: number                   // Longitude","+      ward: string                  // Electoral ward (from postcodes.io)","+      lsoa: string                  // LSOA name","+      lsoaCode: string              // LSOA code (E01xxxxxx)","+      constituency: string          // Parliamentary constituency","+      type: 'flat'|'house'|'maisonette'|'bungalow'|'bedsit'|'studio'","+      tenure: 'secure'|'assured'|'AST'|'starter'|'fixed-term'|","+              'flexible'|'licence'|'shared-ownership'","+      bedrooms: number              // 0-5","+      floorArea: number             // Square metres","+      floor: number                 // For flats","+      construction: {","+        yearBuilt: number","+        type: string                // e.g. 'concrete panel', 'brick'","+        storeys: number","+        higherRisk: boolean         // ≥18m or ≥7 storeys","       }","-      type: 'house' | 'flat' | 'maisonette' | 'bungalow'","-      bedrooms: number","-      floor?: number","-      floorArea?: number","-      estateId: string","-      blockId?: string","-      regionId: string","-      localAuthorityId: string","-      buildYear: number","-      heatingType: string","-      wallType: string","-      roofType: string","+      heating: {","+        type: string                // Gas central, electric, communal","+        boilerMake: string","+        boilerModel: string","+        boilerAge: number","+        lastService: string","+        efficiency: string","+      }","       epc: {","-        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'","-        score: number","-        certificateNumber?: string","+        rating: string              // A-G","+        sapScore: number            // 0-100","         expiryDate: string","+        potentialRating: string","+        potentialScore: number","+        wallsDesc: string","+        roofDesc: string","+        windowsDesc: string","+        heatingDesc: string","+        co2Current: number","+        heatingCostAnnual: number","+        recommendations: string[]","       }","       compliance: {","-        gasSafety: { status, expiryDate, certificateRef }","-        electricalSafety: { status, expiryDate, certificateRef }","-        fireRiskAssessment: { status, lastAssessmentDate }","-        asbestos: { status, surveyDate }","-        legionella: { status, assessmentDate }","-        liftSafety?: { status, inspectionDate }","+        gasSafety: { status, expiryDate, contractor }","+        electrical: { status, expiryDate, contractor }","+        fire: { status, riskLevel, nextReview }","+        asbestos: { status, acmCount, managementPlan }","+        legionella: { status, nextReview, waterSystem }","+        lifts: { status, nextInspection }","       }","-      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'","+      stockCondition: {","+        components: [{","+          name, type, installYear, condition, remainingLife, replacementCost","+        }]","+      }","+      dampRisk: number              // 0-100 (AI-calculated)","       isVoid: boolean","-      voidSince?: string","-      currentTenancyId?: string","-      tenantId?: string","-      weeklyRent: number","-      serviceCharge: number","-      dampRisk?: number             // 0-100 computed score","-      createdAt: timestamp","-      updatedAt: timestamp","+      currentTenantId: string","+      estateId: string","+      blockId: string","+      regionId: string","+      localAuthorityId: string","+      accessibility: string[]       // Features list","+      photos: string[]","+      imdDecile: number             // 1-10 (from ONS)","+      imdScore: number","     }"," "," 5.3 Tenant Schema"]},{"oldStart":447,"oldLines":520,"newStart":468,"newLines":468,"lines":["       dateOfBirth: string","       email: string","       phone: string","-      mobile?: string","-      nino?: string                 // National Insurance Number","-      propertyId: string","-      tenancyId: string","-      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'","-      tenancyStartDate: string","-      tenancyStatus: string","-      assignedOfficer: string","-      rent: {","-        weeklyAmount: number","-        balance: number             // Negative = arrears","-        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'","-        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'","-      }","-      weeklyCharge: number","-      rentBalance: number","-      arrearsRisk: number           // 0-100 score","-      household: [","-        { name, relationship, dateOfBirth, isDependent }","-      ]","-      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']","+      mobile: string","+      householdMembers: [{","+        name, relationship, dateOfBirth, isDependent","+      }]","       emergencyContact: {","-        name: string","-        phone: string","-        relationship: string","+        name, relationship, phone","       }","-      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'","-      lastContact?: string","-      contactCount30Days?: number","-      createdAt: timestamp","-      updatedAt: timestamp","+      assignedOfficer: string","+      tenancyStatus: 'active'|'former'|'pending'|'suspended'","+      tenancyStartDate: string","+      tenureType: string","+      propertyId: string","+      weeklyRent: number","+      weeklyServiceCharge: number","+      weeklyTotalCharge: number","+      rentBalance: number           // Negative = arrears","+      paymentMethod: 'DD'|'UC'|'SO'|'Card'|'Cash'|'HB'","+      arrearsRisk: number           // 0-100 (AI-calculated)","+      ucStatus: 'not-claiming'|'claiming'|'transitioning'|'managed-migration'","+      ucManagedPayment: boolean","+      vulnerabilityFlags: [{","+        type, severity, notes, identifiedDate","+      }]","+      communicationPreference: 'email'|'phone'|'letter'|'sms'|'portal'","+      dependentsCount: number","+      employmentStatus: string","     }"," "," 5.4 Case Schema (Unified)"," ","     {","-      id: string","-      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'","-             | 'safeguarding' | 'enquiry'","-      reference: string             // e.g., REP-2025-001","-      title: string","+      id: string                    // e.g. REP-2025-00123","+      type: 'complaint'|'repair'|'asb'|'enquiry'|'financial'|","+            'safeguarding'|'damp-mould'","+      status: string                // Varies by type","+      priority: 'emergency'|'urgent'|'routine'|'planned'","+      subject: string","       description: string","-      status: string                // Type-specific statuses","-      priority: 'emergency' | 'urgent' | 'routine' | 'planned'","       propertyId: string","       tenantId: string","-      handler: string               // Assigned officer","-      assignedTo: string            // User ID","+      handler: string","       createdDate: string","       updatedDate: string","-      closedDate?: string","+      closedDate: string","+      slaTarget: string","+      slaStatus: 'within'|'approaching'|'breached'","       daysOpen: number","-      sla: {","-        targetDate: string","-        breached: boolean","-      }","-      slaStatus: 'on-track' | 'at-risk' | 'breached'","-      timeline: [","-        { date, action, actor, notes }","-      ]","-      // Type-specific fields via discriminated union","-    }"," ","-5.5 Repair Schema (extends Case)","-","-    {","-      ...Case,","-      type: 'repair',","-      sorCode: string               // HACT SOR code","-      trade: string                 // plumbing, electrical, carpentry, etc.","-      operative?: string","-      appointment: {","-        date: string","-        timeSlot: string","-        confirmedBy: string","-      }","-      appointmentDate?: string","-      completionDate?: string","-      contractor: {","-        name: string","-        company: string","-        gasSafeNumber?: string","-        niceicNumber?: string","-      }","-      cost: {","-        estimated: number","-        actual?: number","-        authorised: boolean","-      }","-      firstTimeFix?: boolean","-      photos: {","-        before: string[]","-        after: string[]","-      }","-      satisfaction?: {","-        rating: number              // 1-5","-        feedback: string","-        date: string","-      }","-      awaabsLaw?: {                 // For damp/mould repairs","-        isHazard: boolean","+      // Repair-specific fields","+      sorCode: string","+      sorDescription: string","+      trade: string","+      operative: string","+      appointment: { date, slot, confirmed }","+      firstTimeFix: boolean","+      satisfaction: number           // 1-5","+      recurrenceRisk: number","+      awaabsLaw: {","+        applicable: boolean","         hazardType: string","-        responseDeadline: string","-        repairDeadline: string","-        compliant: boolean","+        deadlines: { investigate, summary, safetyWorks, repairsBegun }","       }","-    }"," ","-5.6 Complaint Schema (extends Case)","+      // Complaint-specific fields","+      stage: 'stage-1'|'stage-2'","+      acknowledgementDate: string","+      acknowledgementDeadline: string","+      responseDeadline: string","+      finding: 'upheld'|'partially-upheld'|'not-upheld'","+      remedy: string","+      learningLog: string","+      ombudsmanEscalation: boolean"," ","-    {","-      ...Case,","-      type: 'complaint',","-      stage: 1 | 2","-      category: string","-      deadlines: {","-        stage1Acknowledgement: string   // 5 working days","-        stage1Response: string          // 10 working days","-        stage2Response?: string         // 20 working days","-      }","-      findings?: string","-      compensation?: number","-      learningActions: string[]","-      ombudsmanRef?: string","-      ombudsmanEscalation?: boolean","-      escalatedDate?: string","-      outcome?: string","-    }","-","-5.7 ASB Schema (extends Case)","-","-    {","-      ...Case,","-      type: 'asb',","-      severity: 'low' | 'medium' | 'high' | 'critical'","-      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'","+      // ASB-specific fields","+      asbCategory: string","+      severity: 'cat-1'|'cat-2'|'cat-3'","+      escalation: 'warning'|'ABC'|'CPW'|'CPN'|'injunction'|","+                  'possession'|'closure'","       evidenceCount: number","-      evidenceLog: [","-        { date, type, description, attachments }","-      ]","-      perpetratorId?: string","-      victimIds: string[]","-      communityTrigger: boolean","-      multiAgencyPanel?: boolean","-    }","+      multiAgencyPanel: boolean","+      legalActionProbability: number"," ","-5.8 Financial Case Schema (extends Case)","-","-    {","-      ...Case,","-      type: 'financial',","+      // Financial-specific fields","       arrearsAmount: number","       arrearsReason: string","-      paymentArrangement?: {","-        amount: number","-        frequency: string","-        startDate: string","-      }","-      preActionChecklist?: {","-        item: string","-        completed: boolean","-        date?: string","-      }[]","-    }","+      paymentArrangement: { amount, frequency, compliance }","+      escalationStage: 'pre-action'|'NOSP'|'court'|'possession'","+      preActionChecklist: object"," ","-5.9 Damp-Mould Case Schema (extends Case)","-","-    {","-      ...Case,","-      type: 'damp-mould',","-      hazardClassification: string","-      dampRiskScore: number","-      cause: string","-      linkedRepairs: string[]       // repair case IDs","+      // Damp-specific fields","+      hazardClassification: 'emergency'|'significant'|'non-urgent'","+      moistureLevel: number","+      humidityLevel: number","+      temperatureLevel: number","+      linkedRepairs: string[]","     }"," ","-5.10 ExternalDataCache Schema","+5.5 External Data Cache Schema"," ","     {","-      id: string                    // Cache key (e.g., \"police:SE17+1RY\")","-      source: string                // API source identifier","+      // Document ID: {source}:{lookupKey}","+      source: string                // API identifier","+      lookupKey: string             // postcode, UPRN, lat/lng, LSOA","       data: object                  // Cached response payload","-      fetchedAt: timestamp          // When data was fetched","-      ttl: number                   // TTL in seconds","-      expiresAt: timestamp          // Computed expiry","-      requestParams: object         // Original request parameters","+      fetchedAt: Timestamp","+      ttlSeconds: number","+      expiresAt: Timestamp","+      httpStatus: number","+      latencyMs: number","     }"," ","-5.11 Integration Schema","+5.6 Composite Indexes (17 defined in firestore.indexes.json)"," ","-    {","-      id: string","-      name: string","-      tier: 1 | 2 | 3","-      category: string","-      status: 'active' | 'inactive' | 'error' | 'pending'","-      enabled: boolean","-      config: {","-        baseUrl: string","-        apiKey?: string","-        rateLimit: number","-      }","-      stats: {","-        lastUsed: string","-        requestCount: number","-        avgResponseTime: number","-        cacheHitRate: number","-        errorRate: number","-      }","-    }","+    Cases (5 indexes):","+    - type + status + createdDate (desc)","+    - type + handler + createdDate (desc)","+    - tenantId + createdDate (desc)","+    - propertyId + createdDate (desc)","+    - type + priority + createdDate (desc)"," ","-5.12 Firestore Indexes (Composite)","-    Defined in firestore.indexes.json at project root (17 indexes).","-    Key indexes for:","-    - cases: (propertyId, type, createdDate DESC)","-    - cases: (tenantId, type, createdDate DESC)","-    - cases: (status, priority, createdDate DESC)","-    - cases: (type, status, createdDate DESC)","-    - cases: (type, handler, createdDate DESC)","-    - cases: (estateId, type, createdDate DESC)","-    - activities: (entityId, timestamp DESC)","-    - tenants: (arrearsRisk DESC)","-    - externalDataCache: (source, expiresAt)","+    Properties (3 indexes):","+    - regionId + type","+    - estateId + isVoid","+    - blockId + type"," ","-5.13 Firestore Security Rules","-    Defined in firestore.rules at project root.","-    Persona-based access control for all 15+ collections.","-    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()","-    Audit log is write-once, read-many (immutable).","+    Tenants (2 indexes):","+    - assignedOfficer + tenancyStatus","+    - arrearsRisk (desc)"," ","+    Activities (2 indexes):","+    - tenantId + date (desc)","+    - caseId + date (desc)"," ","-6. API ARCHITECTURE","-================================================================================","+    Other (5 indexes):","+    - rentTransactions: tenantId + date (desc)","+    - auditLog: timestamp (desc)","+    - localAuthorities: regionId","+    - estates: localAuthorityId","+    - blocks: estateId"," ","-6.1 API Design Principles","-    - RESTful design with /api/v1/ prefix","-    - JSON request/response bodies","-    - Consistent error format: { error, message, statusCode }","-    - Pagination: ?page=N&limit=N (default 20, max 50)","-    - Filtering: Query parameters per endpoint","-    - Sorting: ?sort=field&order=asc|desc","-    - Request correlation via X-Request-ID header","+5.7 Firestore Security Rules Summary"," ","-6.2 API Route Registry (50+ endpoints)","+    Rule helpers:","+    - isAuthenticated(): request.auth != null","+    - hasPersona(p): user doc has matching persona","+    - isManager(): persona in [coo, head-of-service, manager]","+    - isAdmin(): persona == 'coo'"," ","-    AUTHENTICATION (3)","-    POST   /api/v1/auth/login          -- Firebase token login","-    POST   /api/v1/auth/register       -- User registration","-    POST   /api/v1/auth/logout         -- Session invalidation","+    Access patterns:","+    | Collection       | Read         | Create       | Update       | Delete   |","+    |------------------|-------------|-------------|-------------|----------|","+    | organisations    | auth        | admin       | admin       | admin    |","+    | regions          | auth        | admin       | admin       | admin    |","+    | localAuthorities | auth        | admin       | admin       | admin    |","+    | estates          | auth        | manager+    | manager+    | admin    |","+    | blocks           | auth        | manager+    | manager+    | admin    |","+    | properties       | auth        | manager+    | manager+    | admin    |","+    | tenants          | auth        | manager+    | manager+    | admin    |","+    | cases            | auth        | auth        | auth        | admin    |","+    | activities       | auth        | auth        | auth        | admin    |","+    | communications   | auth        | auth        | auth        | manager+ |","+    | rentTransactions | auth        | manager+    | manager+    | manager+ |","+    | users            | auth        | admin       | admin/self  | admin    |","+    | auditLog         | manager+    | auth        | never       | never    |"," ","-    PROPERTIES (4)","-    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)","-    GET    /api/v1/properties/:id       -- Property detail","-    PATCH  /api/v1/properties/:id       -- Update property","-    GET    /api/v1/properties/available -- Available properties"," ","-    TENANTS (5)","-    GET    /api/v1/tenants              -- List with pagination/filter","-    GET    /api/v1/tenants/:id          -- Tenant detail","-    PATCH  /api/v1/tenants/:id          -- Update tenant","-    GET    /api/v1/tenants/:id/activities  -- Tenant activities","-    GET    /api/v1/tenants/:id/cases    -- Tenant cases","+6. API ARCHITECTURE (50+ Endpoints)","+================================================================================"," ","-    CASES (5)","-    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)","-    GET    /api/v1/cases/:id            -- Case detail","-    POST   /api/v1/cases                -- Create case","-    PATCH  /api/v1/cases/:id            -- Update case","-    GET    /api/v1/cases/:id/activities -- Case activities","+6.1 Auth Routes (/api/v1/auth)","+    POST  /seed-users              Create demo Firebase users (idempotent)","+    POST  /profile                 Create user profile on first registration","+    GET   /me                      Get authenticated user profile"," ","-    COMPLIANCE (2)","-    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard","-    GET    /api/v1/compliance/:type     -- Type-specific data","+6.2 Properties Routes (/api/v1/properties)","+    GET   /                        List with filters (?regionId, ?estateId, ?blockId,","+                                     ?type, ?isVoid, ?limit)","+    GET   /available               Void properties for letting","+    GET   /:id                     Single property by ID","+    PATCH /:id                     Update property"," ","-    EXPLORE (4)","-    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy","-    GET    /api/v1/explore/regions      -- List regions","-    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks","-    GET    /api/v1/explore/blocks/:id   -- Block detail","+6.3 Tenants Routes (/api/v1/tenants)","+    GET   /                        List with filters","+    GET   /:id                     Single tenant by ID","+    PATCH /:id                     Update tenant"," ","-    RENT (2)","-    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary","-    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions","+6.4 Cases Routes (/api/v1/cases)","+    GET   /                        List with filters (?type, ?status, ?handler,","+                                     ?priority, ?propertyId, ?tenantId,","+                                     ?limit=50, ?offset)","+    GET   /:id                     Case with related activities","+    POST  /                        Create new case","+    PATCH /:id                     Update case","+    GET   /:id/activities          Activities for a case"," ","-    REPORTS (3)","-    GET    /api/v1/reports              -- Report catalog (27 types)","-    GET    /api/v1/reports/:type        -- Generate report data","-    GET    /api/v1/reports/tsm          -- TSM specific data","+6.5 AI Routes (/api/v1/ai)","+    POST  /draft-communication     AI communication drafts","+    POST  /entity-intelligence     AI predictions/alerts per entity","+    POST  /neighbourhood-context   Neighbourhood briefing","+    POST  /property-intelligence   Property analysis","+    POST  /tenant-context          Tenant risk assessment","+    POST  /chat                    Conversational AI queries","+    GET   /damp-risk/:propertyId   Damp risk score","+    GET   /damp-risk/estate/:id    Estate-wide damp risk","+    GET   /crime-context/:estateId Crime correlation","+    GET   /crime-context/case/:id  Case crime context","+    GET   /vulnerability/:tenantId Vulnerability assessment","+    POST  /vulnerability/scan      Org-wide vulnerability scan","+    GET   /benefits-check/:id      Benefits entitlement check","+    GET   /property-passport/:id   Property passport","+    GET   /briefing/:estateId      Neighbourhood briefing","+    GET   /notify/templates        All GOV.UK Notify templates","+    GET   /notify/templates/:cat   Templates by category","+    GET   /notify/template/:id     Single template","+    POST  /notify/render           Render template with personalisation","+    GET   /mock/uc-verification/:id   DWP UC verification (mock)","+    GET   /mock/iot-sensors/:id       IoT sensor readings (mock)","+    GET   /mock/direct-debit/:id      GoCardless status (mock)","+    GET   /mock/labour-market/:code   NOMIS labour market (mock)","+    GET   /mock/repairs-marketplace/:id  Plentific/Fixflo (mock)","+    GET   /mock/regulatory/:type/:ref    RSH/CORE/Ombudsman (mock)","+    GET   /mock/signing/:type/:id        DocuSign (mock)","+    GET   /mock/referencing/:id          Experian/TransUnion (mock)","+    GET   /mock/land-registry/:id        Land Registry (mock)"," ","-    LETTINGS (2)","-    GET    /api/v1/lettings/voids       -- Void property list","-    GET    /api/v1/lettings/register    -- Housing register","+6.6 Public Data Routes (/api/v1/public-data)","+    GET   /police/:postcode        Street-level crime data","+    GET   /weather/:lat/:lng       Weather forecast","+    GET   /flood/:lat/:lng         Flood warnings","+    GET   /postcode/:postcode      Postcode lookup (geocoding, LSOA)","+    POST  /postcodes/bulk          Bulk postcode lookup","+    GET   /epc/:postcode           EPC certificates","+    GET   /imd/:lsoaCode           Index of Multiple Deprivation","+    GET   /census/:lsoaCode        Census 2021 demographics","+    GET   /nomis/:lsoaCode         NOMIS labour market","+    GET   /gas-safe/:regNo         Gas Safe Register verification","+    GET   /electrical-safety/:regNo  NICEIC verification"," ","-    BOOKING (2)","-    POST   /api/v1/booking/viewing      -- Book a viewing","-    POST   /api/v1/booking/application  -- Submit application","+6.7 Admin Routes (/api/v1/admin)","+    GET   /integrations            All 20 integration statuses","+    POST  /integrations/:id/toggle Toggle integration on/off","+    POST  /integrations/:id/test   Test integration connection","+    GET   /monitoring              System metrics & health"," ","-    BRIEFING (1)","-    GET    /api/v1/briefing             -- Personalised morning briefing","+6.8 Other Routes","+    GET   /api/v1/explore/*        Drill-down hierarchy queries","+    GET   /api/v1/briefing/*       AI briefing generation","+    GET   /api/v1/compliance/*     Compliance tracking","+    GET   /api/v1/rent/*           Financial tracking","+    GET   /api/v1/reports/*        Report generation","+    GET   /api/v1/export/*         HACT data export","+    GET   /api/v1/lettings/*       Lettings & allocations","+    POST  /api/v1/booking/*        Viewing/appointment booking","+    GET   /health                  Health check (Firestore, memory, uptime)"," ","-    EXPORT (2)","-    GET    /api/v1/export/csv/:type     -- CSV export","-    GET    /api/v1/export/pdf/:type     -- PDF export"," ","-    AI INTELLIGENCE (12)","-    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score","-    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview","-    GET    /api/v1/ai/crime-context/:estateId          -- Crime context","-    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation","-    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score","-    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants","-    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement","-    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport","-    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing","-    POST   /api/v1/ai/draft-communication               -- Draft communication","-    POST   /api/v1/ai/chat                              -- Yantra Assist chat","+7. EXTERNAL API INTEGRATION LAYER","+================================================================================"," ","-    GOV.UK NOTIFY (4)","-    GET    /api/v1/ai/notify/templates                  -- List all 24 templates","-    GET    /api/v1/ai/notify/templates/:category        -- Filter by category","-    GET    /api/v1/ai/notify/template/:id               -- Template detail","-    POST   /api/v1/ai/notify/render                     -- Render template","+7.1 Integration Pattern: Server-Side Proxy","+    All external API calls follow:","+    Client → Express route → Check Firestore cache → If valid: return cached →","+    If expired: Call external API → Transform → Cache in Firestore → Return →","+    If fail: Return simulated data with source: \"simulated\""," ","-    MOCK TIER 3 (9)","-    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check","-    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data","-    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data","-    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data","-    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific","-    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission","-    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope","-    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check","-    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry","+7.2 Shared Service: external-api.ts","+    - fetchWithCache(source, key, ttl, fetchFn): cache-through helper","+    - rateLimiter(source, maxPerMinute): token bucket","+    - buildAuditEntry(source, endpoint, status, latency): audit logging","+    - simulatedFallback(source, key): synthetic data generator"," ","-    EXTERNAL DATA PROXY (9)","-    GET    /api/v1/public-data/police/:postcode          -- Police crime data","-    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast","-    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk","-    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup","-    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate","-    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021","-    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour","-    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify","-    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify","+7.3 Integration Summary"," ","-    ADMIN (4)","-    GET    /api/v1/admin/integrations                   -- List integrations","-    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable","-    POST   /api/v1/admin/integrations/:id/test          -- Test connection","-    GET    /api/v1/admin/monitoring                      -- Metrics dashboard","+    TIER 1 — Live, No Key:","+    | API              | Base URL                          | Cache TTL | Rate Limit    |","+    |------------------|-----------------------------------|-----------|---------------|","+    | Police.uk        | data.police.uk/api                | 24 hours  | 15 req/sec    |","+    | Open-Meteo       | api.open-meteo.com/v1             | 1 hour    | 10,000/day    |","+    | DEFRA Flood      | environment.data.gov.uk/flood-*   | 1 hour    | Fair use      |"," ","-    CONFIG & HEALTH","-    GET    /api/v1/config              -- Firebase client config (public)","-    GET    /health                     -- Health check","+    TIER 2 — Live, Key Required:","+    | API              | Base URL                          | Cache TTL | Status         |","+    |------------------|-----------------------------------|-----------|----------------|","+    | Postcodes.io     | api.postcodes.io                  | 90 days   | Live           |","+    | Open UPRN        | uprn.uk                           | 90 days   | Live           |","+    | EPC Register     | epc.opendatacommunities.org/api   | 30 days   | Live+fallback  |","+    | NOMIS/Census     | nomisweb.co.uk/api/v01            | 7 days    | Live           |","+    | Gas Safe         | (verification endpoint)           | 30 days   | Live+fallback  |","+    | Electrical Safety| (verification endpoint)           | 30 days   | Live+fallback  |"," ","+    TIER 3 — Mock Services:","+    | API              | Service Function                  | Purpose                 |","+    |------------------|------------------------------------|-------------------------|","+    | DWP/UC           | mockUcVerification()              | UC status, APA          |","+    | IoT Sensors      | mockIotSensors()                  | Switchee, Aico, HomeLync|","+    | GoCardless       | mockDirectDebit()                 | DD payments             |","+    | Plentific/Fixflo | mockRepairsMarketplace()          | Contractor dispatch     |","+    | RSH/CORE         | mockRegulatorySubmission()        | Regulatory returns      |","+    | DocuSign         | mockSigningEnvelope()             | Digital signing         |","+    | Experian         | mockReferencingResult()           | Tenant referencing      |","+    | Land Registry    | mockLandRegistryTitle()           | Title/ownership data    |","+    | NOMIS Extended   | mockLabourMarket()                | Labour market stats     |"," ","-7. EXTERNAL API INTEGRATION ARCHITECTURE","+","+8. SECURITY ARCHITECTURE"," ================================================================================"," ","-7.1 Server-Side Proxy Pattern","-    All external API calls are proxied through the Express server.","-    Frontend NEVER calls external APIs directly.","+8.1 Authentication","+    - Firebase Authentication (Google SSO + email/password)","+    - JWT tokens verified on every API request","+    - Token injection via api-client.ts Authorization header","+    - Demo users seeded via /api/v1/auth/seed-users"," ","-    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API","+8.2 Authorisation (RBAC)","+    - 5 persona levels: COO > Head of Service > Manager > Officer > Operative","+    - Per-module permissions: view, create, edit, delete, approve","+    - Firestore security rules enforce at database level","+    - Express middleware enforces at API level"," ","-7.2 Caching Strategy (Firestore-based)","-    Collection: externalDataCache","-    Pattern: Cache-through with TTL","+8.3 Transport Security","+    - HTTPS enforced by Cloud Run (managed SSL)","+    - CSP headers whitelist: Google APIs, Firebase, OSM tiles, Google Fonts","+    - CORS restricted to allowed origins (localhost:5173, Cloud Run URL)","+    - Helmet middleware for security headers"," ","-    | Data Source       | TTL      | Rationale                    |","-    |-------------------|----------|------------------------------|","-    | Weather           | 1 hour   | Forecast changes frequently  |","-    | Crime data        | 24 hours | Updated monthly by Police.uk |","-    | EPC certificates  | 30 days  | Rarely changes               |","-    | Census data       | 90 days  | Static (Census 2021)         |","-    | Postcode lookup   | 7 days   | Rarely changes               |","-    | Gas Safe          | 24 hours | Registration status           |","-    | Electrical Safety | 24 hours | Registration status           |","-    | IMD data          | 90 days  | Annual update cycle          |","-    | NOMIS             | 30 days  | Monthly refresh               |","-    | Flood risk        | 1 hour   | Changes with weather          |","+8.4 Data Security","+    - Secret Manager for all credentials (4 secrets)","+    - No API keys in codebase (removed in Session 2)","+    - .mcp.json in .gitignore (contains Telegram bot token)","+    - .env files never committed","+    - JSON body limit: 1MB","+    - Structured error responses (no stack traces in production)","+    - Request correlation IDs for audit trail"," ","-7.3 Rate Limiting (External APIs)","-    Token bucket pattern per API source.","-    Fair-use limit: 15 requests/second across all external APIs.","+8.5 Rate Limiting","+    - Sliding window rate limiter (token bucket pattern)","+    - 4 tiers: API (100/min), Auth (10/min), AI (30/min), Admin (20/min)","+    - Per-source rate limiting for external APIs"," ","-7.4 Graceful Degradation","-    All external APIs have simulated fallbacks.","-    If an API fails or times out:","-    - Timeout: 10 seconds per external request","-    - Retry: 1 retry with exponential backoff (2s)","-    - Return simulated fallback data","-    - Flag response: { source: 'live' | 'simulated' }","-    Simulated data is realistic, consistent (deterministic seeding), flagged."," ","-","-8. SECURITY ARCHITECTURE","+9. DEPLOYMENT & INFRASTRUCTURE"," ================================================================================"," ","-8.1 Authentication Flow","-    1. User visits /login","-    2. FirebaseUI widget presents Google SSO or email/password","-    3. Firebase returns ID token (JWT)","-    4. Frontend stores token, sends in Authorization header","-    5. Express middleware verifies token via Firebase Admin SDK","-    6. User context loaded (role, persona, permissions)","-    7. Fallback: X-Persona header for development (non-production)","+9.1 Docker Build (3-Stage)","+    Stage 1 — Build Client:","+    - Node 20 slim → npm ci --legacy-peer-deps → Vite build → dist/","+    Stage 2 — Build Server:","+    - Node 20 slim → npm ci → TypeScript compile → dist/","+    Stage 3 — Production:","+    - Node 20 slim → production deps only → copy artifacts","+    - curl for health checks","+    - PORT=8080, NODE_ENV=production","+    - CMD: node server/dist/index.js"," ","-8.2 Authorization (RBAC)","-    10 default roles with hierarchical permissions:","-    - super-admin, org-admin, regional-manager, area-manager","-    - housing-manager, senior-officer, housing-officer","-    - repairs-coordinator, repairs-operative, read-only","+9.2 Cloud Run Configuration","+    - Service: socialhomes","+    - Region: europe-west2 (London)","+    - Memory: 1Gi","+    - CPU: 1","+    - Min instances: 0","+    - Max instances: 10","+    - Port: 8080","+    - Secrets: 4 from Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN,","+      FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)"," ","-8.3 Security Headers","-    - Content-Security-Policy (whitelist for APIs, fonts, tiles)","-    - X-Content-Type-Options: nosniff","-    - X-Frame-Options: DENY","-    - Referrer-Policy: strict-origin-when-cross-origin","-    - Permissions-Policy (camera, microphone, geolocation disabled)","-    - Strict-Transport-Security: max-age=31536000","+9.3 Cloud Build (CI/CD)","+    - Trigger: git push to main","+    - Config: cloudbuild.yaml","+    - Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/","+      cloud-run-source-deploy/socialhomes","+    - NOTE: cloudbuild.yaml needs updating for correct Artifact Registry path","+      (task 5.5.1 in EXECUTION-PLAN.md)"," ","-8.4 Secrets Management","-    All secrets stored in Google Secret Manager:","-    - FIREBASE_API_KEY","-    - FIREBASE_AUTH_DOMAIN","-    - FIREBASE_PROJECT_ID","-    - DEMO_USER_PASSWORD","-    No secrets in source code or environment files.","+9.4 Infrastructure References","+    - GCP Project ID: gen-lang-client-0878518473","+    - GCP Project Number: 587984201316","+    - Firebase Project: gen-lang-client-0146156913","+    - Service URL: https://socialhomes-587984201316.europe-west2.run.app","+    - GitHub: https://github.com/rajivpeter/SocialHomes_ai","+    - Service Account: 587984201316-compute@developer.gserviceaccount.com"," "," ","-9. DEPLOYMENT ARCHITECTURE","+10. MONITORING & OBSERVABILITY"," ================================================================================"," ","-9.1 Deployment Pipeline","+10.1 Health Endpoint (GET /health)","+    Returns:","+    - status: 'healthy' | 'degraded' | 'unhealthy'","+    - firestore: connectivity check with latency","+    - memory: RSS, heap used/total","+    - uptime: seconds"," ","-    Developer -> git push origin main","-                    |","-                    v","-    GitHub Repository (rajivpeter/SocialHomes_ai)","-                    |","-                    v","-    Cloud Build (auto-triggered)","-     +-- Step 1: Build React frontend (Vite)","-     +-- Step 2: Build Express backend (tsc)","-     +-- Step 3: Build & push Docker image","-                    |","-                    v","-    Artifact Registry (europe-west2)","-     +-- cloud-run-source-deploy/socialhomes:latest","-                    |","-                    v","-    Cloud Run (europe-west2)","-     +-- Min instances: 0","-     +-- Max instances: 10","-     +-- Memory: 1Gi","-     +-- CPU: 1","-     +-- Concurrency: 80","-     +-- Timeout: 300s","-     +-- Port: 8080","-     +-- Secrets: 4 from Secret Manager","+10.2 Metrics Service (monitoring.ts)","+    Tracks:","+    - Request counts by route","+    - Response times (P50, P95, P99)","+    - Status code distribution","+    - Endpoint hit counts","+    - Cache hit/miss ratios"," ","-9.2 Docker Build (Multi-Stage)","-    Stage 1: Build client (Vite) — node:20-slim base","-    Stage 2: Build server (tsc) — node:20-slim base","-    Stage 3: Production — copy built assets, start server (~500MB image)","+10.3 Admin Monitoring (GET /api/v1/admin/monitoring)","+    Aggregated metrics dashboard for admin users."," ","-9.3 Cloud Run Configuration","-    Region: europe-west2 (London)","-    Auto-scaling based on request volume","-    Min instances 0 for cost efficiency (cold start < 3s)","+10.4 Audit Trail","+    Every significant action logged to auditLog collection:","+    - timestamp, user, entity, field, old value, new value, IP","+    - External API calls logged with source, endpoint, status, latency"," ","-9.4 Key Infrastructure References","-    GCP Project ID: gen-lang-client-0878518473","-    GCP Project Number: 587984201316","-    Firebase Project: gen-lang-client-0146156913","-    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/","-                       cloud-run-source-deploy/socialhomes","-    Live URL: https://socialhomes-587984201316.europe-west2.run.app","+10.5 Telegram Notifications","+    Bot: @SocialHomesBot (MCP integration)","+    - Build status, deployment confirmations","+    - Test results, error alerts","+    - Progress updates"," "," ","-10. MONITORING & OBSERVABILITY","+11. ACCESSIBILITY IMPLEMENTATION"," ================================================================================"," ","-10.1 Custom Metrics (In-App)","-    - Request count (by endpoint, method, status code)","-    - Response time percentiles (P50, P95, P99)","-    - Cache hit/miss rates per API source","-    - Firestore query latency","-    - Error rate and error types","-    - Active concurrent requests","+11.1 WCAG 2.2 AA Compliance","+    - Focus traps on modals (Tab wrapping, Escape key handler)","+    - ARIA attributes: role=\"dialog\", aria-modal, aria-labelledby,","+      aria-describedby, aria-required, aria-invalid","+    - Form validation: noValidate + custom with inline errors","+    - Skip-to-content link with id=\"main-content\" on <main>","+    - Navigation: aria-label=\"Main navigation\" on <nav>","+    - Focus-visible outline styles on *:focus-visible","+    - Reduced motion: @media (prefers-reduced-motion: reduce)","+    - Screen reader: .sr-only class","+    - Keyboard navigation throughout all workflows","+    - htmlFor on all form labels"," ","-10.2 Health Check","-    GET /health","-    - Firestore connectivity check with latency measurement","-    - Memory usage (RSS, heap used, heap total)","-    - Process uptime","-    - Status: healthy | degraded | unhealthy"," ","-10.3 Structured Logging","-    - JSON format for all logs","-    - Request ID correlation (X-Request-ID)","-    - No sensitive data in logs (no PII)","-    - Error logging with full non-PII context","+12. PHASE 5 ARCHITECTURE TARGETS","+================================================================================"," ","-10.4 Admin Monitoring Dashboard","-    GET /api/v1/admin/monitoring","-    - Real-time metrics display","-    - Integration status overview (20 integrations)","-    - Cache performance statistics","-    - Error rate trending","+12.1 Vertex AI / Gemini Integration","+    - Server-side Vertex AI SDK with streaming responses (SSE)","+    - Context-aware system prompts per entity type","+    - Conversation history persistence in Firestore","+    - Token counting and budget enforcement","+    - PII masking and hallucination prevention guardrails"," ","+12.2 WebSocket (Socket.io)","+    - Real-time notifications via Socket.io","+    - Authentication handshake with Firebase JWT","+    - Room-based subscriptions (per-user, per-estate, per-org)","+    - Cloud Run sticky sessions configuration"," ","+12.3 Event-Driven Architecture","+    - Cloud Pub/Sub for async workflows","+    - Topics: case-created, compliance-expiring, arrears-threshold, damp-alert","+    - Dead letter queues for failed processing","+","+12.4 Multi-Tenant SaaS","+    - Organisation-scoped Firestore queries","+    - Tenant context middleware","+    - Per-org branding customisation","+    - Data partitioning strategy","+","+"," ================================================================================","-  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Yantra Works | 2026-02-25","+  End of Document","+  Doc2 — SocialHomes.Ai Technical Architecture v7.0","+  Yantra Works | 2026-02-26"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                              |\n                                                     +--------v---------+\n                                                     |    blocks (8)    |\n                                                     +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"54e8b35f-beae-4fa6-a58e-b63aafe7229e"}
{"parentUuid":"8d143af4-b023-46b4-93bb-86e9cdb76efd","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_015iTCES5GKtdJ9QvuSkn2ep","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0155VcV9FRJ3UVEsAt3pDLXe","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11695,"cache_read_input_tokens":108098,"output_tokens":304,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":11695,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWKzUEj2PQa1Fg8PSJYV","type":"assistant","uuid":"2ca93f53-4313-4876-91c7-dcda0ecee504","timestamp":"2026-02-26T08:00:34.779Z"}
{"parentUuid":"2ca93f53-4313-4876-91c7-dcda0ecee504","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0155VcV9FRJ3UVEsAt3pDLXe","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"dbb9e205-9c71-41fc-a4a4-99ff9660c4d0","timestamp":"2026-02-26T08:00:34.783Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"pending","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"2ca93f53-4313-4876-91c7-dcda0ecee504"}
{"parentUuid":"dbb9e205-9c71-41fc-a4a4-99ff9660c4d0","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01XQYQWhcSLMaRTq3yDc35Yc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EYYdGLf5AmzHhccnEF2A1d","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  API Overview & Strategy\n  2.  Tier 1 Integrations (Free, No Key)\n  3.  Tier 2 Integrations (Free, Registration Required)\n  4.  Tier 3 Integrations (Mock Services)\n  5.  Seven Killer Differentiator Services\n  6.  GOV.UK Notify Integration (24 Templates)\n  7.  Caching Architecture\n  8.  Rate Limiting Strategy\n  9.  Error Handling & Fallback\n  10. Security Requirements\n  11. Internal API Endpoint Registry (50+)\n  12. Future Roadmap\n\n\n1. API OVERVIEW & STRATEGY\n================================================================================\n\n1.1 Guiding Principles\n\n    GP-1  Server-side proxy only — the React client NEVER calls external\n          APIs directly. All external calls route through /api/v1/public-data/*\n          or /api/v1/ai/* endpoints.\n\n    GP-2  Graceful degradation — every external call has a simulated fallback.\n          If an API is down or unregistered, the system continues with\n          synthetic data marked source: \"simulated\".\n\n    GP-3  Caching — external data is cached in Firestore externalDataCache\n          collection with TTL metadata.\n\n    GP-4  Audit trail — every external API call is logged to auditLog\n          collection with action: \"external-api-call\".\n\n    GP-5  Rate limiting — server-side rate limiting per API. Never exceed\n          published fair-use limits. Token bucket pattern in memory.\n\n    GP-6  Cost control — Tier 1 and Tier 2 APIs are free. No paid API calls\n          without explicit admin opt-in via /admin/integrations.\n\n1.2 Integration Count Summary\n\n    | Tier | Count | Status                         |\n    |------|-------|--------------------------------|\n    | 1    | 3     | LIVE with real data             |\n    | 2    | 6     | LIVE with simulated fallbacks   |\n    | 3    | 9     | MOCK with realistic data        |\n    | AI   | 7     | Internal computation services   |\n    | Total| 25    |                                 |\n\n1.3 Server-Side Proxy Pattern\n\n    Client (React)\n      --> GET /api/v1/public-data/{source}/{params}\n      --> Express route handler (server/src/routes/public-data.ts)\n        --> Check Firestore cache (externalDataCache collection)\n        --> If cache valid: return cached data with source: \"cached\"\n        --> If cache expired or missing:\n          --> Call external API\n          --> Transform response to internal schema\n          --> Write to Firestore cache with TTL\n          --> Return data with source: \"{api-name}\"\n        --> If external call fails:\n          --> Return simulated data with source: \"simulated\"\n          --> Log error to auditLog\n\n1.4 Shared Service: server/src/services/external-api.ts\n\n    Functions:\n    - fetchWithCache(source, key, ttl, fetchFn) — cache-through helper\n    - rateLimiter(source, maxPerMinute) — token bucket\n    - buildAuditEntry(source, endpoint, status, latency) — audit logging\n    - simulatedFallback(source, key) — synthetic data generator\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key Required)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status:         LIVE\n    Base URL:       https://data.police.uk/api\n    Auth:           None\n    Rate Limit:     15 req/sec (fair use)\n    Documentation:  https://data.police.uk/docs/\n    Cache TTL:      24 hours per postcode per month\n    Fallback:       Simulated crime data matching postcode area\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-street/anti-social-behaviour?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}&date={YYYY-MM}\n    - GET /outcomes-at-location?lat={lat}&lng={lng}&date={YYYY-MM}\n\n    Server Route:\n    - GET /api/v1/public-data/police/:postcode\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), street name\n    - Outcome status, persistent ID\n    - 12-month historical data per location\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer toggle\n    - ASB case detail — nearby incidents card\n    - Neighbourhood Briefing — crime section\n    - Dashboard ASB KPI enrichment\n\n    Dependencies: postcodes.io (for postcode-to-latlong conversion)\n\n2.2 Open-Meteo — Weather Forecasting\n    Status:         LIVE\n    Base URL:       https://api.open-meteo.com/v1\n    Auth:           None\n    Rate Limit:     10,000 req/day\n    Documentation:  https://open-meteo.com/en/docs\n    Cache TTL:      1 hour (forecast), 7 days (historical)\n    Fallback:       Static weather for London SE\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum,\n                 relative_humidity_2m_mean,wind_speed_10m_max\n          &hourly=temperature_2m,relative_humidity_2m,dew_point_2m,\n                  surface_pressure,precipitation\n          &timezone=Europe/London&forecast_days=7\n    - GET /archive?latitude={lat}&longitude={lng}\n          &start_date={YYYY-MM-DD}&end_date={YYYY-MM-DD}\n          &daily=temperature_2m_mean,precipitation_sum,relative_humidity_2m_mean\n\n    Server Route:\n    - GET /api/v1/public-data/weather/:lat/:lng\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, dew point, wind speed\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n    - 90-day historical archive\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor, weight 0.25)\n    - AI Morning Briefing (weather section)\n    - D6: Neighbourhood Briefing (environmental context)\n    - Property detail page weather widget\n    - Awaab's Law damp risk assessment\n\n    Dependencies: postcodes.io (for lat/lng if only postcode known)\n\n2.3 DEFRA Flood Risk API\n    Status:         LIVE\n    Base URL:       https://environment.data.gov.uk/flood-monitoring\n    Auth:           None\n    Rate Limit:     Fair use\n    Documentation:  https://environment.data.gov.uk/flood-monitoring/doc/reference\n    Cache TTL:      1 hour\n    Fallback:       No active warnings (empty array)\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=5\n    - GET /id/floodAreas?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=5\n\n    Server Route:\n    - GET /api/v1/public-data/flood/:lat/:lng\n\n    Data Returned:\n    - Active flood warnings with severity levels\n    - Flood area descriptions\n    - River level station readings\n\n    Used By:\n    - Property detail page — flood risk badge\n    - Explore page — flood zone overlay\n    - Briefing page — active flood warnings\n    - Property Passport — environmental risk section\n\n\n3. TIER 2 INTEGRATIONS (Free, Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup & Geography\n    Status:         LIVE\n    Base URL:       https://api.postcodes.io\n    Auth:           None (despite being Tier 2, no key needed)\n    Rate Limit:     Fair use\n    Documentation:  https://postcodes.io/docs\n    Cache TTL:      90 days\n    Fallback:       Manual lat/lng from property record\n\n    Endpoints Used:\n    - GET /postcodes/:postcode\n    - POST /postcodes (bulk lookup, max 100)\n    - GET /postcodes/:postcode/validate\n\n    Server Routes:\n    - GET /api/v1/public-data/postcode/:postcode\n    - POST /api/v1/public-data/postcodes/bulk\n\n    Data Returned:\n    - Latitude, longitude (authoritative)\n    - Admin district (Local Authority), admin ward\n    - LSOA code and name, MSOA\n    - Parliamentary constituency\n    - ONS codes for all areas\n\n    Used By:\n    - Prerequisite for Police API, IMD, Census, Flood risk\n    - Property creation — postcode validation + auto-populate\n    - Reports — ward/constituency grouping\n    - Allocations — local connection verification\n\n3.2 Open UPRN (uprn.uk)\n    Status:         LIVE\n    Base URL:       https://uprn.uk\n    Auth:           None (Open Government Licence)\n    Cache TTL:      90 days\n    Fallback:       Unverified UPRN (no external check)\n\n    Endpoints Used:\n    - GET /postcode/{postcode}.json\n    - GET /{uprn}.json\n\n    Server Routes:\n    - GET /api/v1/public-data/uprn/:uprn\n\n    Data Returned:\n    - UPRN validation, postcode, lat/lng, country, class description\n\n    Used By:\n    - Property creation — UPRN validation badge\n    - Property Passport — authoritative coordinates\n    - Compliance — linking certificates to verified UPRNs\n\n3.3 EPC Register API\n    Status:         LIVE (with simulated fallback when no key)\n    Base URL:       https://epc.opendatacommunities.org/api/v1\n    Auth:           Basic auth with registered API key\n    Env Variable:   EPC_API_KEY\n    Cache TTL:      30 days\n    Fallback:       Simulated EPC data from property record\n\n    Endpoints Used:\n    - GET /domestic/search?postcode={postcode}&size=100\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n    - GET /domestic/recommendations/{lmk-key}\n\n    Server Route:\n    - GET /api/v1/public-data/epc/:postcode\n\n    Data Returned:\n    - Energy rating (A-G), SAP score, potential rating\n    - Building fabric: walls, roof, windows, heating descriptions\n    - CO2 emissions, heating costs\n    - Improvement recommendations with estimated savings\n\n    Used By:\n    - D1: Predictive Damp Intelligence (building fabric factor)\n    - D5: Property Passport (EPC section)\n    - Property detail — expanded Energy Performance panel\n    - Compliance — EPC compliance summary\n    - Reports — carbon emissions, retrofit planning\n\n3.4 NOMIS/Census (ONS)\n    Status:         LIVE (with simulated fallback)\n    Base URL:       https://www.nomisweb.co.uk/api/v01\n    Auth:           None (API key optional for higher limits)\n    Cache TTL:      7 days (labour market), 90 days (Census)\n    Fallback:       Simulated demographic data\n\n    Endpoints Used (Census 2021):\n    - NM_2072_1: Tenure by household (TS054)\n    - NM_2021_1: Household size (TS011)\n    - Age structure (TS009), Ethnic group (TS021), Disability (TS038)\n\n    Endpoints Used (Labour Market):\n    - NM_17_5: Claimant count by LA\n    - NM_162_1: Employment rate\n    - NM_30_1: Job density\n\n    Server Routes:\n    - GET /api/v1/public-data/census/:lsoaCode\n    - GET /api/v1/public-data/nomis/:lsoaCode\n\n    Data Returned:\n    - Census: tenure mix, household size, age profile, disability prevalence\n    - Labour: employment rate, claimant count, job density, OOW benefits rate\n\n    Used By:\n    - D3: Automatic Vulnerability Detection (deprivation context)\n    - D4: Benefits Entitlement Engine (employment data)\n    - D6: Neighbourhood Briefing (demographic section)\n    - Reports — community profiling\n\n3.5 Gas Safe Register\n    Status:         LIVE (with simulated fallback)\n    Base URL:       Gas Safe verification endpoint\n    Cache TTL:      30 days\n    Fallback:       Simulated verification result\n\n    Server Route:\n    - GET /api/v1/public-data/gas-safe/:registrationNumber\n\n    Data Returned:\n    - Registration validity, business name, registration number\n    - Appliance categories authorised\n\n    Used By:\n    - Repair detail page — Gas Safe contractor verification badge (green)\n    - Compliance — contractor verification\n\n3.6 Electrical Safety Register (NICEIC)\n    Status:         LIVE (with simulated fallback)\n    Base URL:       Electrical Safety verification endpoint\n    Cache TTL:      30 days\n    Fallback:       Simulated verification result\n\n    Server Route:\n    - GET /api/v1/public-data/electrical-safety/:registrationNumber\n\n    Data Returned:\n    - Registration validity, company name, scheme\n\n    Used By:\n    - Repair detail page — NICEIC contractor verification badge (blue)\n    - Compliance — contractor verification\n\n\n4. TIER 3 INTEGRATIONS (Mock Services)\n================================================================================\n\n    All Tier 3 APIs are implemented as mock services in\n    server/src/services/mock-services.ts returning realistic simulated data.\n    They are designed to be wired to real APIs when subscriptions are obtained.\n\n4.1 DWP Universal Credit\n    Mock Function:  mockUcVerification(tenantId)\n    Server Route:   GET /api/v1/ai/mock/uc-verification/:tenantId\n    Returns:        UC claim status, payment dates, APA eligibility\n    Used By:        Benefits Engine, Arrears prediction, Tenant context\n\n4.2 IoT Sensors (Switchee/Aico/HomeLync)\n    Mock Function:  mockIotSensors(propertyId)\n    Server Route:   GET /api/v1/ai/mock/iot-sensors/:propertyId\n    Returns:        Temperature, humidity, moisture readings, alerts\n    Used By:        Damp Prediction (sensor factor, weight 0.20)\n\n4.3 GoCardless / Allpay (Direct Debit)\n    Mock Function:  mockDirectDebit(tenantId)\n    Server Route:   GET /api/v1/ai/mock/direct-debit/:tenantId\n    Returns:        DD mandate status, payment schedule, failure history\n    Used By:        Rent & Income, payment tracking\n\n4.4 Plentific / Fixflo (Repairs Marketplace)\n    Mock Function:  mockRepairsMarketplace(caseId)\n    Server Route:   GET /api/v1/ai/mock/repairs-marketplace/:id\n    Returns:        Contractor quotes, scheduling, dispatch, satisfaction\n    Used By:        Repair case management, contractor selection\n\n4.5 RSH / CORE / Ombudsman (Regulatory)\n    Mock Function:  mockRegulatorySubmission(type, refId)\n    Server Route:   GET /api/v1/ai/mock/regulatory/:type/:ref\n    Returns:        IDA returns, CORE lettings/sales, ombudsman escalations\n    Used By:        Reports, compliance tracking\n\n4.6 DocuSign (Digital Signing)\n    Mock Function:  mockSigningEnvelope(documentType, tenantId)\n    Server Route:   GET /api/v1/ai/mock/signing/:type/:id\n    Returns:        Envelope status, recipients, signing URLs\n    Used By:        Tenancy agreements, Section 21, compliance certificates\n\n4.7 Experian / TransUnion (Referencing)\n    Mock Function:  mockReferencingResult(applicantId)\n    Server Route:   GET /api/v1/ai/mock/referencing/:id\n    Returns:        Credit score, affordability, CCJs, previous addresses\n    Used By:        Allocations — applicant referencing\n\n4.8 Land Registry\n    Mock Function:  mockLandRegistryTitle(propertyId)\n    Server Route:   GET /api/v1/ai/mock/land-registry/:id\n    Returns:        Title number, freehold/leasehold, price paid, lease details\n    Used By:        Property Passport, asset management\n\n4.9 NOMIS Extended (Labour Market)\n    Mock Function:  mockLabourMarket(lsoaCode)\n    Server Route:   GET /api/v1/ai/mock/labour-market/:code\n    Returns:        Detailed employment data, sector breakdown, wage data\n    Used By:        Benefits Engine, arrears context\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n    These services combine internal data with external API data to produce\n    intelligence no competitor housing system can match.\n\n5.1 D1: Predictive Damp Intelligence\n    Service:        server/src/services/damp-prediction.ts (17KB)\n    Algorithm:      5-factor weighted scoring (0-100)\n\n    Factor Weights:\n    | Factor    | Weight | Source                | Key Inputs                    |\n    |-----------|--------|-----------------------|-------------------------------|\n    | Weather   | 0.25   | Open-Meteo            | Temp, humidity, precipitation |\n    | Building  | 0.25   | EPC, internal data    | Construction, insulation, age |\n    | History   | 0.20   | Internal repairs       | Previous damp repairs, freq   |\n    | Sensor    | 0.20   | IoT mock              | Humidity, temp, moisture      |\n    | Occupancy | 0.10   | Internal tenant data   | Household size, ventilation   |\n\n    Output:         Risk score 0-100 + factor breakdown + recommendations\n    API:            GET /api/v1/ai/damp-risk/:propertyId\n                    GET /api/v1/ai/damp-risk/estate/:estateId\n    Frontend:       DampIntelligencePanel component\n\n5.2 D2: Live Crime Context for ASB\n    Service:        server/src/services/crime-context.ts (11KB)\n    Algorithm:      Police.uk data correlation with internal ASB cases\n\n    Features:\n    - Crime heatmap overlay on estate maps\n    - Hotspot analysis (density within 500m radius)\n    - Correlation between police reports and internal ASB cases\n    - Multi-agency referral recommendations\n\n    Output:         Crime summary, hotspot map data, correlation matches\n    API:            GET /api/v1/ai/crime-context/:estateId\n                    GET /api/v1/ai/crime-context/case/:caseId\n    Frontend:       Crime data layer on Explore page\n\n5.3 D3: Automatic Vulnerability Detection\n    Service:        server/src/services/vulnerability-detection.ts (16KB)\n    Algorithm:      7-factor scoring\n\n    Factors:\n    | Factor       | Weight | Source           | Key Inputs                   |\n    |--------------|--------|------------------|------------------------------|\n    | Deprivation  | --     | IMD/ONS          | IMD decile, domain scores    |\n    | Arrears      | --     | Internal         | Payment pattern, amount      |\n    | Health       | --     | Census/flags     | Disability, health indicators|\n    | Isolation    | --     | Internal         | Contact frequency, no-access |\n    | Age          | --     | Internal         | Elderly, young tenant        |\n    | Dependents   | --     | Internal         | Children, household size     |\n    | UC Transition| --     | DWP mock         | UC claim, transition stage   |\n\n    Output:         Overall score + factor scores + detected flags + actions\n    API:            GET /api/v1/ai/vulnerability/:tenantId\n                    POST /api/v1/ai/vulnerability/scan (org-wide)\n    Frontend:       VulnerabilityPanel component\n\n5.4 D4: Benefits Entitlement Engine\n    Service:        server/src/services/benefits-engine.ts (11KB)\n    Algorithm:      UK 2025/26 benefit rules analysis\n\n    Benefits Checked:\n    - Universal Credit (housing element, childcare, carer, disability)\n    - Housing Benefit (legacy)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (Guarantee, Savings)\n    - Council Tax Reduction\n    - Warm Home Discount\n    - Winter Fuel Payment\n    - Free School Meals\n\n    Output:         Entitlement list with status, amounts, unclaimed totals\n    API:            GET /api/v1/ai/benefits-check/:tenantId\n    Frontend:       BenefitsPanel component\n\n5.5 D5: Property Passport\n    Service:        server/src/services/property-passport.ts (11KB)\n    Algorithm:      Multi-source property dossier aggregation\n\n    Sources Aggregated:\n    - EPC certificate data (energy, fabric, heating)\n    - Gas Safe registration / EICR status\n    - UPRN verification\n    - Flood risk zone\n    - IMD deprivation score\n    - Crime statistics\n    - Weather forecast\n    - Internal compliance, repairs, stock condition data\n\n    Output:         Comprehensive property intelligence document\n    API:            GET /api/v1/ai/property-passport/:propertyId\n    Frontend:       Property detail page\n\n5.6 D6: AI Neighbourhood Briefing\n    Service:        server/src/services/neighbourhood-briefing.ts (14KB)\n    Algorithm:      Per-estate daily intelligence combining all sources\n\n    Sections:\n    - Weather outlook (damp risk, frost, storms)\n    - Crime context (recent incidents, trends)\n    - Demographics (area profile)\n    - Labour market (unemployment, claimant trends)\n    - Internal KPIs (repairs, arrears, compliance, voids)\n    - Action items (recommended officer actions)\n\n    Output:         6 summary cards + officer briefing + action items\n    API:            GET /api/v1/ai/briefing/:estateId\n    Frontend:       NeighbourhoodBriefingPanel component\n\n5.7 D7: GOV.UK Notify Integration\n    Service:        server/src/services/govuk-notify.ts (45KB)\n    See Section 6 for full template library.\n\n\n6. GOV.UK NOTIFY INTEGRATION (24 Templates)\n================================================================================\n\n6.1 Overview\n    Platform:       GOV.UK Notify (https://notifications.service.gov.uk)\n    Channels:       Email, SMS, Letter\n    Templates:      24 across 7 categories\n    Personalisation: ((field)) syntax for dynamic content\n    Tone options:   Supportive, Formal, Urgent, Legally Required\n\n6.2 Template Categories\n\n    | Category     | Count | Templates                                      |\n    |--------------|-------|------------------------------------------------|\n    | Rent/Arrears | 5     | Friendly reminder, formal warning, NOSP,       |\n    |              |       | payment arrangement, UC support                |\n    | Repairs      | 4     | Appointment booking, completion confirmation,  |\n    |              |       | delay notification, satisfaction follow-up      |\n    | ASB          | 3     | Warning letter, ABC agreement, CPN notice      |\n    | Compliance   | 3     | Gas safety appointment, EICR appointment,      |\n    |              |       | no-access escalation                           |\n    | Tenancy      | 3     | Welcome letter, annual review, end of tenancy  |\n    | Damp/Mould   | 3     | Inspection appointment, advice letter,         |\n    |              |       | Awaab's Law update                             |\n    | General      | 3     | General enquiry response, service update,      |\n    |              |       | annual report                                  |\n\n6.3 API Routes\n    GET  /api/v1/ai/notify/templates            All templates\n    GET  /api/v1/ai/notify/templates/:category   Templates by category\n    GET  /api/v1/ai/notify/template/:id          Single template\n    POST /api/v1/ai/notify/render                Render with personalisation\n\n6.4 Personalisation Fields\n    Common fields: ((name)), ((address)), ((reference)), ((date)),\n    ((officer_name)), ((officer_phone)), ((organisation_name))\n    Financial: ((balance)), ((amount)), ((weekly_rent))\n    Repairs: ((appointment_date)), ((appointment_time)), ((trade))\n    Legal: ((notice_period)), ((court_date)), ((compliance_date))\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Firestore Cache Collection: externalDataCache\n    Document ID:    {source}:{lookup-key}\n    Fields:\n    - source: string (API identifier)\n    - lookupKey: string (postcode, UPRN, lat/lng, LSOA)\n    - data: map (cached response payload)\n    - fetchedAt: timestamp\n    - ttlSeconds: number\n    - expiresAt: timestamp\n    - httpStatus: number\n    - latencyMs: number\n\n7.2 TTL Policy\n\n    | Source              | TTL         | Rationale                        |\n    |---------------------|-------------|----------------------------------|\n    | Weather (forecast)  | 1 hour      | Weather changes frequently       |\n    | Weather (historical)| 7 days      | Historical data stable            |\n    | Flood warnings      | 1 hour      | Active warnings change            |\n    | Crime data          | 24 hours    | Monthly police.uk releases        |\n    | Postcodes           | 90 days     | Postcodes rarely change           |\n    | UPRN data           | 90 days     | Address data very stable          |\n    | EPC certificates    | 30 days     | Change only on re-lodgement       |\n    | IMD/Census          | 90 days     | Updated every 4-5 years           |\n    | Labour market       | 7 days      | Monthly ONS releases              |\n    | Gas Safe            | 30 days     | Registration status stable        |\n    | Electrical Safety   | 30 days     | Registration status stable        |\n\n7.3 Cache Strategy\n    - Cache-through: check cache first, fetch on miss\n    - Stale data: return cached data even if expired, refresh in background\n    - Cache warming: planned for Phase 5 (task 5.2.6)\n\n\n8. RATE LIMITING STRATEGY\n================================================================================\n\n8.1 Internal Rate Limiting (per-client)\n    - API routes: 100 requests/minute\n    - Auth routes: 10 requests/minute\n    - AI routes: 30 requests/minute\n    - Admin routes: 20 requests/minute\n    - Implementation: Sliding window, token bucket pattern\n\n8.2 External API Rate Limiting (per-source)\n    | Source       | Limit          | Implementation              |\n    |--------------|----------------|-----------------------------|\n    | Police.uk    | 15 req/sec     | Token bucket, queue excess  |\n    | Open-Meteo   | 10,000/day     | Daily counter               |\n    | DEFRA        | Fair use       | 1 req/sec soft limit        |\n    | Postcodes.io | Fair use       | 1 req/sec soft limit        |\n    | EPC Register | Fair use       | 1 req/sec soft limit        |\n    | NOMIS        | Fair use       | 1 req/sec soft limit        |\n\n\n9. ERROR HANDLING & FALLBACK\n================================================================================\n\n9.1 Error Response Format\n    {\n      error: string           // Human-readable message\n      code: string            // Machine-readable code\n      requestId: string       // X-Request-ID for correlation\n      // No stack traces in production\n    }\n\n9.2 Fallback Strategy\n    Every external API integration has a simulated fallback:\n    1. Primary: call real API\n    2. On failure (timeout, 4xx, 5xx): return simulated data\n    3. Simulated data marked with source: \"simulated\"\n    4. Error logged to auditLog\n    5. Admin dashboard shows integration health status\n\n9.3 Circuit Breaker (Phase 5 — task 5.2.5)\n    Planned: per-source failure tracking with state machine\n    States: closed → open (after 5 failures) → half-open (after 60s)\n    Currently: simple try/catch with fallback\n\n\n10. SECURITY REQUIREMENTS\n================================================================================\n\n10.1 API Authentication\n    - All /api/v1/* routes require Firebase JWT token\n    - Token verified on every request via auth middleware\n    - Exception: /health, /api/v1/auth/seed-users\n\n10.2 External API Key Management\n    - API keys stored in Google Secret Manager\n    - Injected as environment variables on Cloud Run\n    - Never exposed to frontend client\n    - Admin can toggle integrations via /admin/integrations\n\n10.3 Data Security\n    - PII never sent to external APIs unnecessarily\n    - Cached data inherits sensitivity of source\n    - Audit log captures all external API calls\n    - CORS restricts which origins can call the API\n\n\n11. INTERNAL API ENDPOINT REGISTRY (50+ Endpoints)\n================================================================================\n\n    Full endpoint listing organised by route module:\n\n    AUTH (3 endpoints):\n    POST  /api/v1/auth/seed-users\n    POST  /api/v1/auth/profile\n    GET   /api/v1/auth/me\n\n    PROPERTIES (4 endpoints):\n    GET   /api/v1/properties\n    GET   /api/v1/properties/available\n    GET   /api/v1/properties/:id\n    PATCH /api/v1/properties/:id\n\n    TENANTS (3 endpoints):\n    GET   /api/v1/tenants\n    GET   /api/v1/tenants/:id\n    PATCH /api/v1/tenants/:id\n\n    CASES (5 endpoints):\n    GET   /api/v1/cases\n    GET   /api/v1/cases/:id\n    POST  /api/v1/cases\n    PATCH /api/v1/cases/:id\n    GET   /api/v1/cases/:id/activities\n\n    AI SERVICES (24 endpoints):\n    POST  /api/v1/ai/draft-communication\n    POST  /api/v1/ai/entity-intelligence\n    POST  /api/v1/ai/neighbourhood-context\n    POST  /api/v1/ai/property-intelligence\n    POST  /api/v1/ai/tenant-context\n    POST  /api/v1/ai/chat\n    GET   /api/v1/ai/damp-risk/:propertyId\n    GET   /api/v1/ai/damp-risk/estate/:estateId\n    GET   /api/v1/ai/crime-context/:estateId\n    GET   /api/v1/ai/crime-context/case/:caseId\n    GET   /api/v1/ai/vulnerability/:tenantId\n    POST  /api/v1/ai/vulnerability/scan\n    GET   /api/v1/ai/benefits-check/:tenantId\n    GET   /api/v1/ai/property-passport/:propertyId\n    GET   /api/v1/ai/briefing/:estateId\n    GET   /api/v1/ai/notify/templates\n    GET   /api/v1/ai/notify/templates/:category\n    GET   /api/v1/ai/notify/template/:id\n    POST  /api/v1/ai/notify/render\n    GET   /api/v1/ai/mock/uc-verification/:tenantId\n    GET   /api/v1/ai/mock/iot-sensors/:propertyId\n    GET   /api/v1/ai/mock/direct-debit/:tenantId\n    GET   /api/v1/ai/mock/labour-market/:lsoaCode\n    GET   /api/v1/ai/mock/repairs-marketplace/:caseId\n    GET   /api/v1/ai/mock/regulatory/:type/:refId\n    GET   /api/v1/ai/mock/signing/:type/:tenantId\n    GET   /api/v1/ai/mock/referencing/:applicantId\n    GET   /api/v1/ai/mock/land-registry/:propertyId\n\n    PUBLIC DATA (11 endpoints):\n    GET   /api/v1/public-data/police/:postcode\n    GET   /api/v1/public-data/weather/:lat/:lng\n    GET   /api/v1/public-data/flood/:lat/:lng\n    GET   /api/v1/public-data/postcode/:postcode\n    POST  /api/v1/public-data/postcodes/bulk\n    GET   /api/v1/public-data/epc/:postcode\n    GET   /api/v1/public-data/imd/:lsoaCode\n    GET   /api/v1/public-data/census/:lsoaCode\n    GET   /api/v1/public-data/nomis/:lsoaCode\n    GET   /api/v1/public-data/gas-safe/:regNo\n    GET   /api/v1/public-data/electrical-safety/:regNo\n\n    ADMIN (4 endpoints):\n    GET   /api/v1/admin/integrations\n    POST  /api/v1/admin/integrations/:id/toggle\n    POST  /api/v1/admin/integrations/:id/test\n    GET   /api/v1/admin/monitoring\n\n    OTHER ROUTES:\n    GET   /api/v1/explore/*          (drill-down hierarchy)\n    GET   /api/v1/briefing/*         (AI briefing generation)\n    GET   /api/v1/compliance/*       (compliance tracking)\n    GET   /api/v1/rent/*             (financial tracking)\n    GET   /api/v1/reports/*          (report generation)\n    GET   /api/v1/export/*           (HACT data export)\n    GET   /api/v1/lettings/*         (lettings & allocations)\n    POST  /api/v1/booking/*          (viewing/appointment)\n    GET   /health                    (health check)\n\n\n12. FUTURE ROADMAP\n================================================================================\n\n12.1 Phase 5 API Enhancements\n    - Vertex AI integration for Yantra Assist chat (5.2.1, 5.2.2)\n    - WebSocket for real-time notifications (5.2.3, 5.2.4)\n    - AI communication drafting with LLM (5.2.11)\n    - AI repair intake with NLP (5.2.14)\n    - Bulk operations API (5.2.9)\n    - Audit log query API with full-text search (5.2.10)\n    - File upload service with Cloud Storage (5.2.15)\n    - GDPR data export pipeline (5.2.16)\n    - Circuit breaker pattern (5.2.5)\n    - Cache warming service (5.2.6)\n    - Scheduled task runner (5.2.7)\n\n12.2 Phase 6 Enterprise Integrations (planned)\n    - Real DWP/UC API (replacing mock)\n    - Real GOV.UK Notify sending (replacing template render)\n    - Real IoT sensor APIs (Switchee, Aico)\n    - Payment processing (GoCardless, Allpay)\n    - Regulatory submissions (RSH CORE, Ombudsman)\n    - Open Banking for income verification\n    - Companies House for contractor checks\n    - HM Land Registry API for title verification\n\n12.3 OpenAPI/Swagger Specification (Phase 5 — task 5.1.7)\n    Planned: Full OpenAPI 3.0 spec for all 50+ endpoints\n    - Request/response schemas\n    - Authentication documentation\n    - Example payloads\n    - Error codes\n    - Rate limit documentation\n\n\n================================================================================\n  End of Document\n  Doc3 — SocialHomes.Ai API & Integration Requirements v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":119793,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWL12qHWbHLiFCiZJobv","type":"assistant","uuid":"e477c8f2-b4f1-479d-a03c-713f5442817a","timestamp":"2026-02-26T08:03:13.066Z"}
{"parentUuid":"e477c8f2-b4f1-479d-a03c-713f5442817a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EYYdGLf5AmzHhccnEF2A1d","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt has been updated successfully."}]},"uuid":"bffcf455-64e7-4175-a917-9735f37564db","timestamp":"2026-02-26T08:03:13.205Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 7.0  |  Date: 2026-02-26\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\nTABLE OF CONTENTS\n================================================================================\n  1.  API Overview & Strategy\n  2.  Tier 1 Integrations (Free, No Key)\n  3.  Tier 2 Integrations (Free, Registration Required)\n  4.  Tier 3 Integrations (Mock Services)\n  5.  Seven Killer Differentiator Services\n  6.  GOV.UK Notify Integration (24 Templates)\n  7.  Caching Architecture\n  8.  Rate Limiting Strategy\n  9.  Error Handling & Fallback\n  10. Security Requirements\n  11. Internal API Endpoint Registry (50+)\n  12. Future Roadmap\n\n\n1. API OVERVIEW & STRATEGY\n================================================================================\n\n1.1 Guiding Principles\n\n    GP-1  Server-side proxy only — the React client NEVER calls external\n          APIs directly. All external calls route through /api/v1/public-data/*\n          or /api/v1/ai/* endpoints.\n\n    GP-2  Graceful degradation — every external call has a simulated fallback.\n          If an API is down or unregistered, the system continues with\n          synthetic data marked source: \"simulated\".\n\n    GP-3  Caching — external data is cached in Firestore externalDataCache\n          collection with TTL metadata.\n\n    GP-4  Audit trail — every external API call is logged to auditLog\n          collection with action: \"external-api-call\".\n\n    GP-5  Rate limiting — server-side rate limiting per API. Never exceed\n          published fair-use limits. Token bucket pattern in memory.\n\n    GP-6  Cost control — Tier 1 and Tier 2 APIs are free. No paid API calls\n          without explicit admin opt-in via /admin/integrations.\n\n1.2 Integration Count Summary\n\n    | Tier | Count | Status                         |\n    |------|-------|--------------------------------|\n    | 1    | 3     | LIVE with real data             |\n    | 2    | 6     | LIVE with simulated fallbacks   |\n    | 3    | 9     | MOCK with realistic data        |\n    | AI   | 7     | Internal computation services   |\n    | Total| 25    |                                 |\n\n1.3 Server-Side Proxy Pattern\n\n    Client (React)\n      --> GET /api/v1/public-data/{source}/{params}\n      --> Express route handler (server/src/routes/public-data.ts)\n        --> Check Firestore cache (externalDataCache collection)\n        --> If cache valid: return cached data with source: \"cached\"\n        --> If cache expired or missing:\n          --> Call external API\n          --> Transform response to internal schema\n          --> Write to Firestore cache with TTL\n          --> Return data with source: \"{api-name}\"\n        --> If external call fails:\n          --> Return simulated data with source: \"simulated\"\n          --> Log error to auditLog\n\n1.4 Shared Service: server/src/services/external-api.ts\n\n    Functions:\n    - fetchWithCache(source, key, ttl, fetchFn) — cache-through helper\n    - rateLimiter(source, maxPerMinute) — token bucket\n    - buildAuditEntry(source, endpoint, status, latency) — audit logging\n    - simulatedFallback(source, key) — synthetic data generator\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key Required)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status:         LIVE\n    Base URL:       https://data.police.uk/api\n    Auth:           None\n    Rate Limit:     15 req/sec (fair use)\n    Documentation:  https://data.police.uk/docs/\n    Cache TTL:      24 hours per postcode per month\n    Fallback:       Simulated crime data matching postcode area\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-street/anti-social-behaviour?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}&date={YYYY-MM}\n    - GET /outcomes-at-location?lat={lat}&lng={lng}&date={YYYY-MM}\n\n    Server Route:\n    - GET /api/v1/public-data/police/:postcode\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), street name\n    - Outcome status, persistent ID\n    - 12-month historical data per location\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer toggle\n    - ASB case detail — nearby incidents card\n    - Neighbourhood Briefing — crime section\n    - Dashboard ASB KPI enrichment\n\n    Dependencies: postcodes.io (for postcode-to-latlong conversion)\n\n2.2 Open-Meteo — Weather Forecasting\n    Status:         LIVE\n    Base URL:       https://api.open-meteo.com/v1\n    Auth:           None\n    Rate Limit:     10,000 req/day\n    Documentation:  https://open-meteo.com/en/docs\n    Cache TTL:      1 hour (forecast), 7 days (historical)\n    Fallback:       Static weather for London SE\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum,\n                 relative_humidity_2m_mean,wind_speed_10m_max\n          &hourly=temperature_2m,relative_humidity_2m,dew_point_2m,\n                  surface_pressure,precipitation\n          &timezone=Europe/London&forecast_days=7\n    - GET /archive?latitude={lat}&longitude={lng}\n          &start_date={YYYY-MM-DD}&end_date={YYYY-MM-DD}\n          &daily=temperature_2m_mean,precipitation_sum,relative_humidity_2m_mean\n\n    Server Route:\n    - GET /api/v1/public-data/weather/:lat/:lng\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, dew point, wind speed\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n    - 90-day historical archive\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor, weight 0.25)\n    - AI Morning Briefing (weather section)\n    - D6: Neighbourhood Briefing (environmental context)\n    - Property detail page weather widget\n    - Awaab's Law damp risk assessment\n\n    Dependencies: postcodes.io (for lat/lng if only postcode known)\n\n2.3 DEFRA Flood Risk API\n    Status:         LIVE\n    Base URL:       https://environment.data.gov.uk/flood-monitoring\n    Auth:           None\n    Rate Limit:     Fair use\n    Documentation:  https://environment.data.gov.uk/flood-monitoring/doc/reference\n    Cache TTL:      1 hour\n    Fallback:       No active warnings (empty array)\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=5\n    - GET /id/floodAreas?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=5\n\n    Server Route:\n    - GET /api/v1/public-data/flood/:lat/:lng\n\n    Data Returned:\n    - Active flood warnings with severity levels\n    - Flood area descriptions\n    - River level station readings\n\n    Used By:\n    - Property detail page — flood risk badge\n    - Explore page — flood zone overlay\n    - Briefing page — active flood warnings\n    - Property Passport — environmental risk section\n\n\n3. TIER 2 INTEGRATIONS (Free, Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup & Geography\n    Status:         LIVE\n    Base URL:       https://api.postcodes.io\n    Auth:           None (despite being Tier 2, no key needed)\n    Rate Limit:     Fair use\n    Documentation:  https://postcodes.io/docs\n    Cache TTL:      90 days\n    Fallback:       Manual lat/lng from property record\n\n    Endpoints Used:\n    - GET /postcodes/:postcode\n    - POST /postcodes (bulk lookup, max 100)\n    - GET /postcodes/:postcode/validate\n\n    Server Routes:\n    - GET /api/v1/public-data/postcode/:postcode\n    - POST /api/v1/public-data/postcodes/bulk\n\n    Data Returned:\n    - Latitude, longitude (authoritative)\n    - Admin district (Local Authority), admin ward\n    - LSOA code and name, MSOA\n    - Parliamentary constituency\n    - ONS codes for all areas\n\n    Used By:\n    - Prerequisite for Police API, IMD, Census, Flood risk\n    - Property creation — postcode validation + auto-populate\n    - Reports — ward/constituency grouping\n    - Allocations — local connection verification\n\n3.2 Open UPRN (uprn.uk)\n    Status:         LIVE\n    Base URL:       https://uprn.uk\n    Auth:           None (Open Government Licence)\n    Cache TTL:      90 days\n    Fallback:       Unverified UPRN (no external check)\n\n    Endpoints Used:\n    - GET /postcode/{postcode}.json\n    - GET /{uprn}.json\n\n    Server Routes:\n    - GET /api/v1/public-data/uprn/:uprn\n\n    Data Returned:\n    - UPRN validation, postcode, lat/lng, country, class description\n\n    Used By:\n    - Property creation — UPRN validation badge\n    - Property Passport — authoritative coordinates\n    - Compliance — linking certificates to verified UPRNs\n\n3.3 EPC Register API\n    Status:         LIVE (with simulated fallback when no key)\n    Base URL:       https://epc.opendatacommunities.org/api/v1\n    Auth:           Basic auth with registered API key\n    Env Variable:   EPC_API_KEY\n    Cache TTL:      30 days\n    Fallback:       Simulated EPC data from property record\n\n    Endpoints Used:\n    - GET /domestic/search?postcode={postcode}&size=100\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n    - GET /domestic/recommendations/{lmk-key}\n\n    Server Route:\n    - GET /api/v1/public-data/epc/:postcode\n\n    Data Returned:\n    - Energy rating (A-G), SAP score, potential rating\n    - Building fabric: walls, roof, windows, heating descriptions\n    - CO2 emissions, heating costs\n    - Improvement recommendations with estimated savings\n\n    Used By:\n    - D1: Predictive Damp Intelligence (building fabric factor)\n    - D5: Property Passport (EPC section)\n    - Property detail — expanded Energy Performance panel\n    - Compliance — EPC compliance summary\n    - Reports — carbon emissions, retrofit planning\n\n3.4 NOMIS/Census (ONS)\n    Status:         LIVE (with simulated fallback)\n    Base URL:       https://www.nomisweb.co.uk/api/v01\n    Auth:           None (API key optional for higher limits)\n    Cache TTL:      7 days (labour market), 90 days (Census)\n    Fallback:       Simulated demographic data\n\n    Endpoints Used (Census 2021):\n    - NM_2072_1: Tenure by household (TS054)\n    - NM_2021_1: Household size (TS011)\n    - Age structure (TS009), Ethnic group (TS021), Disability (TS038)\n\n    Endpoints Used (Labour Market):\n    - NM_17_5: Claimant count by LA\n    - NM_162_1: Employment rate\n    - NM_30_1: Job density\n\n    Server Routes:\n    - GET /api/v1/public-data/census/:lsoaCode\n    - GET /api/v1/public-data/nomis/:lsoaCode\n\n    Data Returned:\n    - Census: tenure mix, household size, age profile, disability prevalence\n    - Labour: employment rate, claimant count, job density, OOW benefits rate\n\n    Used By:\n    - D3: Automatic Vulnerability Detection (deprivation context)\n    - D4: Benefits Entitlement Engine (employment data)\n    - D6: Neighbourhood Briefing (demographic section)\n    - Reports — community profiling\n\n3.5 Gas Safe Register\n    Status:         LIVE (with simulated fallback)\n    Base URL:       Gas Safe verification endpoint\n    Cache TTL:      30 days\n    Fallback:       Simulated verification result\n\n    Server Route:\n    - GET /api/v1/public-data/gas-safe/:registrationNumber\n\n    Data Returned:\n    - Registration validity, business name, registration number\n    - Appliance categories authorised\n\n    Used By:\n    - Repair detail page — Gas Safe contractor verification badge (green)\n    - Compliance — contractor verification\n\n3.6 Electrical Safety Register (NICEIC)\n    Status:         LIVE (with simulated fallback)\n    Base URL:       Electrical Safety verification endpoint\n    Cache TTL:      30 days\n    Fallback:       Simulated verification result\n\n    Server Route:\n    - GET /api/v1/public-data/electrical-safety/:registrationNumber\n\n    Data Returned:\n    - Registration validity, company name, scheme\n\n    Used By:\n    - Repair detail page — NICEIC contractor verification badge (blue)\n    - Compliance — contractor verification\n\n\n4. TIER 3 INTEGRATIONS (Mock Services)\n================================================================================\n\n    All Tier 3 APIs are implemented as mock services in\n    server/src/services/mock-services.ts returning realistic simulated data.\n    They are designed to be wired to real APIs when subscriptions are obtained.\n\n4.1 DWP Universal Credit\n    Mock Function:  mockUcVerification(tenantId)\n    Server Route:   GET /api/v1/ai/mock/uc-verification/:tenantId\n    Returns:        UC claim status, payment dates, APA eligibility\n    Used By:        Benefits Engine, Arrears prediction, Tenant context\n\n4.2 IoT Sensors (Switchee/Aico/HomeLync)\n    Mock Function:  mockIotSensors(propertyId)\n    Server Route:   GET /api/v1/ai/mock/iot-sensors/:propertyId\n    Returns:        Temperature, humidity, moisture readings, alerts\n    Used By:        Damp Prediction (sensor factor, weight 0.20)\n\n4.3 GoCardless / Allpay (Direct Debit)\n    Mock Function:  mockDirectDebit(tenantId)\n    Server Route:   GET /api/v1/ai/mock/direct-debit/:tenantId\n    Returns:        DD mandate status, payment schedule, failure history\n    Used By:        Rent & Income, payment tracking\n\n4.4 Plentific / Fixflo (Repairs Marketplace)\n    Mock Function:  mockRepairsMarketplace(caseId)\n    Server Route:   GET /api/v1/ai/mock/repairs-marketplace/:id\n    Returns:        Contractor quotes, scheduling, dispatch, satisfaction\n    Used By:        Repair case management, contractor selection\n\n4.5 RSH / CORE / Ombudsman (Regulatory)\n    Mock Function:  mockRegulatorySubmission(type, refId)\n    Server Route:   GET /api/v1/ai/mock/regulatory/:type/:ref\n    Returns:        IDA returns, CORE lettings/sales, ombudsman escalations\n    Used By:        Reports, compliance tracking\n\n4.6 DocuSign (Digital Signing)\n    Mock Function:  mockSigningEnvelope(documentType, tenantId)\n    Server Route:   GET /api/v1/ai/mock/signing/:type/:id\n    Returns:        Envelope status, recipients, signing URLs\n    Used By:        Tenancy agreements, Section 21, compliance certificates\n\n4.7 Experian / TransUnion (Referencing)\n    Mock Function:  mockReferencingResult(applicantId)\n    Server Route:   GET /api/v1/ai/mock/referencing/:id\n    Returns:        Credit score, affordability, CCJs, previous addresses\n    Used By:        Allocations — applicant referencing\n\n4.8 Land Registry\n    Mock Function:  mockLandRegistryTitle(propertyId)\n    Server Route:   GET /api/v1/ai/mock/land-registry/:id\n    Returns:        Title number, freehold/leasehold, price paid, lease details\n    Used By:        Property Passport, asset management\n\n4.9 NOMIS Extended (Labour Market)\n    Mock Function:  mockLabourMarket(lsoaCode)\n    Server Route:   GET /api/v1/ai/mock/labour-market/:code\n    Returns:        Detailed employment data, sector breakdown, wage data\n    Used By:        Benefits Engine, arrears context\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n    These services combine internal data with external API data to produce\n    intelligence no competitor housing system can match.\n\n5.1 D1: Predictive Damp Intelligence\n    Service:        server/src/services/damp-prediction.ts (17KB)\n    Algorithm:      5-factor weighted scoring (0-100)\n\n    Factor Weights:\n    | Factor    | Weight | Source                | Key Inputs                    |\n    |-----------|--------|-----------------------|-------------------------------|\n    | Weather   | 0.25   | Open-Meteo            | Temp, humidity, precipitation |\n    | Building  | 0.25   | EPC, internal data    | Construction, insulation, age |\n    | History   | 0.20   | Internal repairs       | Previous damp repairs, freq   |\n    | Sensor    | 0.20   | IoT mock              | Humidity, temp, moisture      |\n    | Occupancy | 0.10   | Internal tenant data   | Household size, ventilation   |\n\n    Output:         Risk score 0-100 + factor breakdown + recommendations\n    API:            GET /api/v1/ai/damp-risk/:propertyId\n                    GET /api/v1/ai/damp-risk/estate/:estateId\n    Frontend:       DampIntelligencePanel component\n\n5.2 D2: Live Crime Context for ASB\n    Service:        server/src/services/crime-context.ts (11KB)\n    Algorithm:      Police.uk data correlation with internal ASB cases\n\n    Features:\n    - Crime heatmap overlay on estate maps\n    - Hotspot analysis (density within 500m radius)\n    - Correlation between police reports and internal ASB cases\n    - Multi-agency referral recommendations\n\n    Output:         Crime summary, hotspot map data, correlation matches\n    API:            GET /api/v1/ai/crime-context/:estateId\n                    GET /api/v1/ai/crime-context/case/:caseId\n    Frontend:       Crime data layer on Explore page\n\n5.3 D3: Automatic Vulnerability Detection\n    Service:        server/src/services/vulnerability-detection.ts (16KB)\n    Algorithm:      7-factor scoring\n\n    Factors:\n    | Factor       | Weight | Source           | Key Inputs                   |\n    |--------------|--------|------------------|------------------------------|\n    | Deprivation  | --     | IMD/ONS          | IMD decile, domain scores    |\n    | Arrears      | --     | Internal         | Payment pattern, amount      |\n    | Health       | --     | Census/flags     | Disability, health indicators|\n    | Isolation    | --     | Internal         | Contact frequency, no-access |\n    | Age          | --     | Internal         | Elderly, young tenant        |\n    | Dependents   | --     | Internal         | Children, household size     |\n    | UC Transition| --     | DWP mock         | UC claim, transition stage   |\n\n    Output:         Overall score + factor scores + detected flags + actions\n    API:            GET /api/v1/ai/vulnerability/:tenantId\n                    POST /api/v1/ai/vulnerability/scan (org-wide)\n    Frontend:       VulnerabilityPanel component\n\n5.4 D4: Benefits Entitlement Engine\n    Service:        server/src/services/benefits-engine.ts (11KB)\n    Algorithm:      UK 2025/26 benefit rules analysis\n\n    Benefits Checked:\n    - Universal Credit (housing element, childcare, carer, disability)\n    - Housing Benefit (legacy)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (Guarantee, Savings)\n    - Council Tax Reduction\n    - Warm Home Discount\n    - Winter Fuel Payment\n    - Free School Meals\n\n    Output:         Entitlement list with status, amounts, unclaimed totals\n    API:            GET /api/v1/ai/benefits-check/:tenantId\n    Frontend:       BenefitsPanel component\n\n5.5 D5: Property Passport\n    Service:        server/src/services/property-passport.ts (11KB)\n    Algorithm:      Multi-source property dossier aggregation\n\n    Sources Aggregated:\n    - EPC certificate data (energy, fabric, heating)\n    - Gas Safe registration / EICR status\n    - UPRN verification\n    - Flood risk zone\n    - IMD deprivation score\n    - Crime statistics\n    - Weather forecast\n    - Internal compliance, repairs, stock condition data\n\n    Output:         Comprehensive property intelligence document\n    API:            GET /api/v1/ai/property-passport/:propertyId\n    Frontend:       Property detail page\n\n5.6 D6: AI Neighbourhood Briefing\n    Service:        server/src/services/neighbourhood-briefing.ts (14KB)\n    Algorithm:      Per-estate daily intelligence combining all sources\n\n    Sections:\n    - Weather outlook (damp risk, frost, storms)\n    - Crime context (recent incidents, trends)\n    - Demographics (area profile)\n    - Labour market (unemployment, claimant trends)\n    - Internal KPIs (repairs, arrears, compliance, voids)\n    - Action items (recommended officer actions)\n\n    Output:         6 summary cards + officer briefing + action items\n    API:            GET /api/v1/ai/briefing/:estateId\n    Frontend:       NeighbourhoodBriefingPanel component\n\n5.7 D7: GOV.UK Notify Integration\n    Service:        server/src/services/govuk-notify.ts (45KB)\n    See Section 6 for full template library.\n\n\n6. GOV.UK NOTIFY INTEGRATION (24 Templates)\n================================================================================\n\n6.1 Overview\n    Platform:       GOV.UK Notify (https://notifications.service.gov.uk)\n    Channels:       Email, SMS, Letter\n    Templates:      24 across 7 categories\n    Personalisation: ((field)) syntax for dynamic content\n    Tone options:   Supportive, Formal, Urgent, Legally Required\n\n6.2 Template Categories\n\n    | Category     | Count | Templates                                      |\n    |--------------|-------|------------------------------------------------|\n    | Rent/Arrears | 5     | Friendly reminder, formal warning, NOSP,       |\n    |              |       | payment arrangement, UC support                |\n    | Repairs      | 4     | Appointment booking, completion confirmation,  |\n    |              |       | delay notification, satisfaction follow-up      |\n    | ASB          | 3     | Warning letter, ABC agreement, CPN notice      |\n    | Compliance   | 3     | Gas safety appointment, EICR appointment,      |\n    |              |       | no-access escalation                           |\n    | Tenancy      | 3     | Welcome letter, annual review, end of tenancy  |\n    | Damp/Mould   | 3     | Inspection appointment, advice letter,         |\n    |              |       | Awaab's Law update                             |\n    | General      | 3     | General enquiry response, service update,      |\n    |              |       | annual report                                  |\n\n6.3 API Routes\n    GET  /api/v1/ai/notify/templates            All templates\n    GET  /api/v1/ai/notify/templates/:category   Templates by category\n    GET  /api/v1/ai/notify/template/:id          Single template\n    POST /api/v1/ai/notify/render                Render with personalisation\n\n6.4 Personalisation Fields\n    Common fields: ((name)), ((address)), ((reference)), ((date)),\n    ((officer_name)), ((officer_phone)), ((organisation_name))\n    Financial: ((balance)), ((amount)), ((weekly_rent))\n    Repairs: ((appointment_date)), ((appointment_time)), ((trade))\n    Legal: ((notice_period)), ((court_date)), ((compliance_date))\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Firestore Cache Collection: externalDataCache\n    Document ID:    {source}:{lookup-key}\n    Fields:\n    - source: string (API identifier)\n    - lookupKey: string (postcode, UPRN, lat/lng, LSOA)\n    - data: map (cached response payload)\n    - fetchedAt: timestamp\n    - ttlSeconds: number\n    - expiresAt: timestamp\n    - httpStatus: number\n    - latencyMs: number\n\n7.2 TTL Policy\n\n    | Source              | TTL         | Rationale                        |\n    |---------------------|-------------|----------------------------------|\n    | Weather (forecast)  | 1 hour      | Weather changes frequently       |\n    | Weather (historical)| 7 days      | Historical data stable            |\n    | Flood warnings      | 1 hour      | Active warnings change            |\n    | Crime data          | 24 hours    | Monthly police.uk releases        |\n    | Postcodes           | 90 days     | Postcodes rarely change           |\n    | UPRN data           | 90 days     | Address data very stable          |\n    | EPC certificates    | 30 days     | Change only on re-lodgement       |\n    | IMD/Census          | 90 days     | Updated every 4-5 years           |\n    | Labour market       | 7 days      | Monthly ONS releases              |\n    | Gas Safe            | 30 days     | Registration status stable        |\n    | Electrical Safety   | 30 days     | Registration status stable        |\n\n7.3 Cache Strategy\n    - Cache-through: check cache first, fetch on miss\n    - Stale data: return cached data even if expired, refresh in background\n    - Cache warming: planned for Phase 5 (task 5.2.6)\n\n\n8. RATE LIMITING STRATEGY\n================================================================================\n\n8.1 Internal Rate Limiting (per-client)\n    - API routes: 100 requests/minute\n    - Auth routes: 10 requests/minute\n    - AI routes: 30 requests/minute\n    - Admin routes: 20 requests/minute\n    - Implementation: Sliding window, token bucket pattern\n\n8.2 External API Rate Limiting (per-source)\n    | Source       | Limit          | Implementation              |\n    |--------------|----------------|-----------------------------|\n    | Police.uk    | 15 req/sec     | Token bucket, queue excess  |\n    | Open-Meteo   | 10,000/day     | Daily counter               |\n    | DEFRA        | Fair use       | 1 req/sec soft limit        |\n    | Postcodes.io | Fair use       | 1 req/sec soft limit        |\n    | EPC Register | Fair use       | 1 req/sec soft limit        |\n    | NOMIS        | Fair use       | 1 req/sec soft limit        |\n\n\n9. ERROR HANDLING & FALLBACK\n================================================================================\n\n9.1 Error Response Format\n    {\n      error: string           // Human-readable message\n      code: string            // Machine-readable code\n      requestId: string       // X-Request-ID for correlation\n      // No stack traces in production\n    }\n\n9.2 Fallback Strategy\n    Every external API integration has a simulated fallback:\n    1. Primary: call real API\n    2. On failure (timeout, 4xx, 5xx): return simulated data\n    3. Simulated data marked with source: \"simulated\"\n    4. Error logged to auditLog\n    5. Admin dashboard shows integration health status\n\n9.3 Circuit Breaker (Phase 5 — task 5.2.5)\n    Planned: per-source failure tracking with state machine\n    States: closed → open (after 5 failures) → half-open (after 60s)\n    Currently: simple try/catch with fallback\n\n\n10. SECURITY REQUIREMENTS\n================================================================================\n\n10.1 API Authentication\n    - All /api/v1/* routes require Firebase JWT token\n    - Token verified on every request via auth middleware\n    - Exception: /health, /api/v1/auth/seed-users\n\n10.2 External API Key Management\n    - API keys stored in Google Secret Manager\n    - Injected as environment variables on Cloud Run\n    - Never exposed to frontend client\n    - Admin can toggle integrations via /admin/integrations\n\n10.3 Data Security\n    - PII never sent to external APIs unnecessarily\n    - Cached data inherits sensitivity of source\n    - Audit log captures all external API calls\n    - CORS restricts which origins can call the API\n\n\n11. INTERNAL API ENDPOINT REGISTRY (50+ Endpoints)\n================================================================================\n\n    Full endpoint listing organised by route module:\n\n    AUTH (3 endpoints):\n    POST  /api/v1/auth/seed-users\n    POST  /api/v1/auth/profile\n    GET   /api/v1/auth/me\n\n    PROPERTIES (4 endpoints):\n    GET   /api/v1/properties\n    GET   /api/v1/properties/available\n    GET   /api/v1/properties/:id\n    PATCH /api/v1/properties/:id\n\n    TENANTS (3 endpoints):\n    GET   /api/v1/tenants\n    GET   /api/v1/tenants/:id\n    PATCH /api/v1/tenants/:id\n\n    CASES (5 endpoints):\n    GET   /api/v1/cases\n    GET   /api/v1/cases/:id\n    POST  /api/v1/cases\n    PATCH /api/v1/cases/:id\n    GET   /api/v1/cases/:id/activities\n\n    AI SERVICES (24 endpoints):\n    POST  /api/v1/ai/draft-communication\n    POST  /api/v1/ai/entity-intelligence\n    POST  /api/v1/ai/neighbourhood-context\n    POST  /api/v1/ai/property-intelligence\n    POST  /api/v1/ai/tenant-context\n    POST  /api/v1/ai/chat\n    GET   /api/v1/ai/damp-risk/:propertyId\n    GET   /api/v1/ai/damp-risk/estate/:estateId\n    GET   /api/v1/ai/crime-context/:estateId\n    GET   /api/v1/ai/crime-context/case/:caseId\n    GET   /api/v1/ai/vulnerability/:tenantId\n    POST  /api/v1/ai/vulnerability/scan\n    GET   /api/v1/ai/benefits-check/:tenantId\n    GET   /api/v1/ai/property-passport/:propertyId\n    GET   /api/v1/ai/briefing/:estateId\n    GET   /api/v1/ai/notify/templates\n    GET   /api/v1/ai/notify/templates/:category\n    GET   /api/v1/ai/notify/template/:id\n    POST  /api/v1/ai/notify/render\n    GET   /api/v1/ai/mock/uc-verification/:tenantId\n    GET   /api/v1/ai/mock/iot-sensors/:propertyId\n    GET   /api/v1/ai/mock/direct-debit/:tenantId\n    GET   /api/v1/ai/mock/labour-market/:lsoaCode\n    GET   /api/v1/ai/mock/repairs-marketplace/:caseId\n    GET   /api/v1/ai/mock/regulatory/:type/:refId\n    GET   /api/v1/ai/mock/signing/:type/:tenantId\n    GET   /api/v1/ai/mock/referencing/:applicantId\n    GET   /api/v1/ai/mock/land-registry/:propertyId\n\n    PUBLIC DATA (11 endpoints):\n    GET   /api/v1/public-data/police/:postcode\n    GET   /api/v1/public-data/weather/:lat/:lng\n    GET   /api/v1/public-data/flood/:lat/:lng\n    GET   /api/v1/public-data/postcode/:postcode\n    POST  /api/v1/public-data/postcodes/bulk\n    GET   /api/v1/public-data/epc/:postcode\n    GET   /api/v1/public-data/imd/:lsoaCode\n    GET   /api/v1/public-data/census/:lsoaCode\n    GET   /api/v1/public-data/nomis/:lsoaCode\n    GET   /api/v1/public-data/gas-safe/:regNo\n    GET   /api/v1/public-data/electrical-safety/:regNo\n\n    ADMIN (4 endpoints):\n    GET   /api/v1/admin/integrations\n    POST  /api/v1/admin/integrations/:id/toggle\n    POST  /api/v1/admin/integrations/:id/test\n    GET   /api/v1/admin/monitoring\n\n    OTHER ROUTES:\n    GET   /api/v1/explore/*          (drill-down hierarchy)\n    GET   /api/v1/briefing/*         (AI briefing generation)\n    GET   /api/v1/compliance/*       (compliance tracking)\n    GET   /api/v1/rent/*             (financial tracking)\n    GET   /api/v1/reports/*          (report generation)\n    GET   /api/v1/export/*           (HACT data export)\n    GET   /api/v1/lettings/*         (lettings & allocations)\n    POST  /api/v1/booking/*          (viewing/appointment)\n    GET   /health                    (health check)\n\n\n12. FUTURE ROADMAP\n================================================================================\n\n12.1 Phase 5 API Enhancements\n    - Vertex AI integration for Yantra Assist chat (5.2.1, 5.2.2)\n    - WebSocket for real-time notifications (5.2.3, 5.2.4)\n    - AI communication drafting with LLM (5.2.11)\n    - AI repair intake with NLP (5.2.14)\n    - Bulk operations API (5.2.9)\n    - Audit log query API with full-text search (5.2.10)\n    - File upload service with Cloud Storage (5.2.15)\n    - GDPR data export pipeline (5.2.16)\n    - Circuit breaker pattern (5.2.5)\n    - Cache warming service (5.2.6)\n    - Scheduled task runner (5.2.7)\n\n12.2 Phase 6 Enterprise Integrations (planned)\n    - Real DWP/UC API (replacing mock)\n    - Real GOV.UK Notify sending (replacing template render)\n    - Real IoT sensor APIs (Switchee, Aico)\n    - Payment processing (GoCardless, Allpay)\n    - Regulatory submissions (RSH CORE, Ombudsman)\n    - Open Banking for income verification\n    - Companies House for contractor checks\n    - HM Land Registry API for title verification\n\n12.3 OpenAPI/Swagger Specification (Phase 5 — task 5.1.7)\n    Planned: Full OpenAPI 3.0 spec for all 50+ endpoints\n    - Request/response schemas\n    - Authentication documentation\n    - Example payloads\n    - Error codes\n    - Rate limit documentation\n\n\n================================================================================\n  End of Document\n  Doc3 — SocialHomes.Ai API & Integration Requirements v7.0\n  Yantra Works | 2026-02-26\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":775,"newStart":1,"newLines":789,"lines":[" ================================================================================","   Doc3 — SocialHomes.Ai API & Integration Requirements","-  Version: 6.0  |  Date: 2026-02-25","+  Version: 7.0  |  Date: 2026-02-26","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," ","-1. API OVERVIEW","+TABLE OF CONTENTS"," ================================================================================","+  1.  API Overview & Strategy","+  2.  Tier 1 Integrations (Free, No Key)","+  3.  Tier 2 Integrations (Free, Registration Required)","+  4.  Tier 3 Integrations (Mock Services)","+  5.  Seven Killer Differentiator Services","+  6.  GOV.UK Notify Integration (24 Templates)","+  7.  Caching Architecture","+  8.  Rate Limiting Strategy","+  9.  Error Handling & Fallback","+  10. Security Requirements","+  11. Internal API Endpoint Registry (50+)","+  12. Future Roadmap"," ","-1.1 API Strategy","-    SocialHomes.Ai uses a server-side proxy pattern for ALL external API","-    integrations. The React frontend communicates exclusively with the Express","-    backend, which handles external calls, caching, rate limiting, and","-    graceful degradation."," ","-1.2 Integration Tiers","+1. API OVERVIEW & STRATEGY","+================================================================================"," ","-    TIER 1 — Free, No API Key Required","-    Publicly available APIs with no registration needed.","-    Status: LIVE with real data","+1.1 Guiding Principles"," ","-    TIER 2 — Free, Registration Required","-    APIs requiring account creation or key registration.","-    Status: LIVE with real data (where keys available) + simulated fallbacks","+    GP-1  Server-side proxy only — the React client NEVER calls external","+          APIs directly. All external calls route through /api/v1/public-data/*","+          or /api/v1/ai/* endpoints."," ","-    TIER 3 — Subscription/Paid APIs","-    Commercial APIs requiring contracts or paid subscriptions.","-    Status: MOCK endpoints with realistic simulated data","+    GP-2  Graceful degradation — every external call has a simulated fallback.","+          If an API is down or unregistered, the system continues with","+          synthetic data marked source: \"simulated\"."," ","-1.3 Current Integration Count","-    Total: 20 integrations","-    - Tier 1: 3 live","-    - Tier 2: 6 live (with simulated fallbacks)","-    - Tier 3: 5 mock services + 6 planned","+    GP-3  Caching — external data is cached in Firestore externalDataCache","+          collection with TTL metadata."," ","+    GP-4  Audit trail — every external API call is logged to auditLog","+          collection with action: \"external-api-call\"."," ","-2. TIER 1 INTEGRATIONS (Free, No Key)","+    GP-5  Rate limiting — server-side rate limiting per API. Never exceed","+          published fair-use limits. Token bucket pattern in memory.","+","+    GP-6  Cost control — Tier 1 and Tier 2 APIs are free. No paid API calls","+          without explicit admin opt-in via /admin/integrations.","+","+1.2 Integration Count Summary","+","+    | Tier | Count | Status                         |","+    |------|-------|--------------------------------|","+    | 1    | 3     | LIVE with real data             |","+    | 2    | 6     | LIVE with simulated fallbacks   |","+    | 3    | 9     | MOCK with realistic data        |","+    | AI   | 7     | Internal computation services   |","+    | Total| 25    |                                 |","+","+1.3 Server-Side Proxy Pattern","+","+    Client (React)","+      --> GET /api/v1/public-data/{source}/{params}","+      --> Express route handler (server/src/routes/public-data.ts)","+        --> Check Firestore cache (externalDataCache collection)","+        --> If cache valid: return cached data with source: \"cached\"","+        --> If cache expired or missing:","+          --> Call external API","+          --> Transform response to internal schema","+          --> Write to Firestore cache with TTL","+          --> Return data with source: \"{api-name}\"","+        --> If external call fails:","+          --> Return simulated data with source: \"simulated\"","+          --> Log error to auditLog","+","+1.4 Shared Service: server/src/services/external-api.ts","+","+    Functions:","+    - fetchWithCache(source, key, ttl, fetchFn) — cache-through helper","+    - rateLimiter(source, maxPerMinute) — token bucket","+    - buildAuditEntry(source, endpoint, status, latency) — audit logging","+    - simulatedFallback(source, key) — synthetic data generator","+","+","+2. TIER 1 INTEGRATIONS (Free, No Key Required)"," ================================================================================"," "," 2.1 Police.uk — Street-Level Crime Data","-    Status: LIVE","-    Base URL: https://data.police.uk/api","-    Documentation: https://data.police.uk/docs/","+    Status:         LIVE","+    Base URL:       https://data.police.uk/api","+    Auth:           None","+    Rate Limit:     15 req/sec (fair use)","+    Documentation:  https://data.police.uk/docs/","+    Cache TTL:      24 hours per postcode per month","+    Fallback:       Simulated crime data matching postcode area"," ","     Endpoints Used:","     - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}","-    - GET /crimes-at-location?location_id={id}","-    - GET /outcomes-at-location?location_id={id}","+    - GET /crimes-street/anti-social-behaviour?lat={lat}&lng={lng}&date={YYYY-MM}","+    - GET /crimes-at-location?location_id={id}&date={YYYY-MM}","+    - GET /outcomes-at-location?lat={lat}&lng={lng}&date={YYYY-MM}"," ","-    Server Route: GET /api/v1/public-data/police/:postcode","-    Cache TTL: 24 hours","-    Rate Limit: 15 req/sec (fair-use)","-    Fallback: Simulated crime data matching postcode area","+    Server Route:","+    - GET /api/v1/public-data/police/:postcode"," ","-    Used By:","-    - D2: Live Crime Context for ASB (crime-context.ts)","-    - Explore page crime data layer","-    - ASB case correlation","-    - Neighbourhood Briefing crime section","-","     Data Returned:","     - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)","-    - Month, location (lat/lng), outcome status","+    - Month, location (lat/lng), street name","+    - Outcome status, persistent ID","     - 12-month historical data per location"," ","+    Used By:","+    - D2: Live Crime Context for ASB (crime-context.ts)","+    - Explore page crime data layer toggle","+    - ASB case detail — nearby incidents card","+    - Neighbourhood Briefing — crime section","+    - Dashboard ASB KPI enrichment","+","+    Dependencies: postcodes.io (for postcode-to-latlong conversion)","+"," 2.2 Open-Meteo — Weather Forecasting","-    Status: LIVE","-    Base URL: https://api.open-meteo.com/v1","-    Documentation: https://open-meteo.com/en/docs","+    Status:         LIVE","+    Base URL:       https://api.open-meteo.com/v1","+    Auth:           None","+    Rate Limit:     10,000 req/day","+    Documentation:  https://open-meteo.com/en/docs","+    Cache TTL:      1 hour (forecast), 7 days (historical)","+    Fallback:       Static weather for London SE"," ","     Endpoints Used:","-    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,","-          relative_humidity_2m,precipitation,weathercode,windspeed_10m","-          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum","-          &timezone=Europe/London","+    - GET /forecast?latitude={lat}&longitude={lng}","+          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum,","+                 relative_humidity_2m_mean,wind_speed_10m_max","+          &hourly=temperature_2m,relative_humidity_2m,dew_point_2m,","+                  surface_pressure,precipitation","+          &timezone=Europe/London&forecast_days=7","+    - GET /archive?latitude={lat}&longitude={lng}","+          &start_date={YYYY-MM-DD}&end_date={YYYY-MM-DD}","+          &daily=temperature_2m_mean,precipitation_sum,relative_humidity_2m_mean"," ","-    Server Route: GET /api/v1/public-data/weather/:lat/:lng","-    Cache TTL: 1 hour","-    Rate Limit: 10,000 req/day (no key needed)","-    Fallback: Static weather for London SE","+    Server Route:","+    - GET /api/v1/public-data/weather/:lat/:lng"," ","-    Used By:","-    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)","-    - AI Morning Briefing (weather section)","-    - Neighbourhood Briefing (environmental context)","-    - Property impact assessment","-","     Data Returned:","-    - Hourly: temperature, humidity, precipitation, wind speed, weather code","+    - Hourly: temperature, humidity, precipitation, dew point, wind speed","     - Daily: max/min temperature, precipitation sum","     - 7-day forecast + current conditions","+    - 90-day historical archive"," ","+    Used By:","+    - D1: Predictive Damp Intelligence (weather factor, weight 0.25)","+    - AI Morning Briefing (weather section)","+    - D6: Neighbourhood Briefing (environmental context)","+    - Property detail page weather widget","+    - Awaab's Law damp risk assessment","+","+    Dependencies: postcodes.io (for lat/lng if only postcode known)","+"," 2.3 DEFRA Flood Risk API","-    Status: LIVE","-    Base URL: https://environment.data.gov.uk/flood-monitoring","-    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference","+    Status:         LIVE","+    Base URL:       https://environment.data.gov.uk/flood-monitoring","+    Auth:           None","+    Rate Limit:     Fair use","+    Documentation:  https://environment.data.gov.uk/flood-monitoring/doc/reference","+    Cache TTL:      1 hour","+    Fallback:       No active warnings (empty array)"," ","     Endpoints Used:","-    - GET /id/floods?lat={lat}&long={lng}&dist=3","-    - GET /id/stations?lat={lat}&long={lng}&dist=3","+    - GET /id/floods?lat={lat}&long={lng}&dist=5","+    - GET /id/floodAreas?lat={lat}&long={lng}&dist=3","+    - GET /id/stations?lat={lat}&long={lng}&dist=5"," ","-    Server Route: GET /api/v1/public-data/flood-risk/:postcode","-    Cache TTL: 1 hour","-    Rate Limit: No formal limit","-    Fallback: \"No active warnings\" with zone classification","+    Server Route:","+    - GET /api/v1/public-data/flood/:lat/:lng"," ","-    Used By:","-    - Property Passport (flood risk section)","-    - Neighbourhood Briefing (environmental alerts)","-    - Property detail page (risk indicators)","-","     Data Returned:","-    - Active flood warnings/alerts","-    - Flood risk zone classification","-    - Nearest monitoring station readings","+    - Active flood warnings with severity levels","+    - Flood area descriptions","+    - River level station readings"," ","+    Used By:","+    - Property detail page — flood risk badge","+    - Explore page — flood zone overlay","+    - Briefing page — active flood warnings","+    - Property Passport — environmental risk section"," ","-3. TIER 2 INTEGRATIONS (Registration Required)","+","+3. TIER 2 INTEGRATIONS (Free, Registration Required)"," ================================================================================"," ","-3.1 Postcodes.io — Postcode Lookup","-    Status: LIVE","-    Base URL: https://api.postcodes.io","-    Documentation: https://postcodes.io/docs","-    Registration: None (open API)","+3.1 Postcodes.io — Postcode Lookup & Geography","+    Status:         LIVE","+    Base URL:       https://api.postcodes.io","+    Auth:           None (despite being Tier 2, no key needed)","+    Rate Limit:     Fair use","+    Documentation:  https://postcodes.io/docs","+    Cache TTL:      90 days","+    Fallback:       Manual lat/lng from property record"," ","     Endpoints Used:","-    - GET /postcodes/{postcode}","-    - GET /postcodes/{postcode}/nearest","-    - POST /postcodes (bulk lookup)","+    - GET /postcodes/:postcode","+    - POST /postcodes (bulk lookup, max 100)","+    - GET /postcodes/:postcode/validate"," ","-    Server Route: GET /api/v1/public-data/postcode/:postcode","-    Cache TTL: 7 days","-    Rate Limit: Generous (no formal limit)","-    Fallback: Static mapping for SE London postcodes","+    Server Routes:","+    - GET /api/v1/public-data/postcode/:postcode","+    - POST /api/v1/public-data/postcodes/bulk"," ","     Data Returned:","-    - Latitude, longitude","-    - LSOA code and name (for IMD/Census/NOMIS)","-    - Ward, parliamentary constituency","-    - Local authority, region","+    - Latitude, longitude (authoritative)","+    - Admin district (Local Authority), admin ward","+    - LSOA code and name, MSOA","+    - Parliamentary constituency","+    - ONS codes for all areas"," ","     Used By:","-    - All location-dependent lookups","-    - LSOA resolution for Census/NOMIS/IMD","-    - Property geocoding","+    - Prerequisite for Police API, IMD, Census, Flood risk","+    - Property creation — postcode validation + auto-populate","+    - Reports — ward/constituency grouping","+    - Allocations — local connection verification"," ","-3.2 EPC Open Data","-    Status: LIVE (with simulated fallback)","-    Base URL: https://epc.opendatacommunities.org/api/v1","-    Documentation: https://epc.opendatacommunities.org/docs/api","-    Registration: API key via MHCLG portal","+3.2 Open UPRN (uprn.uk)","+    Status:         LIVE","+    Base URL:       https://uprn.uk","+    Auth:           None (Open Government Licence)","+    Cache TTL:      90 days","+    Fallback:       Unverified UPRN (no external check)"," ","     Endpoints Used:","-    - GET /domestic/search?uprn={uprn}","-    - GET /domestic/certificate/{lmk-key}","+    - GET /postcode/{postcode}.json","+    - GET /{uprn}.json"," ","-    Server Route: GET /api/v1/public-data/epc/:uprn","-    Cache TTL: 30 days","-    Rate Limit: 1,000 req/month (free tier)","-    Fallback: Generated EPC data matching property attributes","+    Server Routes:","+    - GET /api/v1/public-data/uprn/:uprn"," ","     Data Returned:","-    - Current energy rating (A-G) and score","-    - Potential rating","-    - Environmental impact rating","-    - Floor area, wall/roof type","-    - Heating type, hot water system","-    - Recommendations for improvement","-    - Certificate expiry date","+    - UPRN validation, postcode, lat/lng, country, class description"," ","     Used By:","-    - Property Passport (energy section)","-    - Compliance page (EPC tracking)","-    - Property detail page","-    - D1: Damp prediction (building factor input)","+    - Property creation — UPRN validation badge","+    - Property Passport — authoritative coordinates","+    - Compliance — linking certificates to verified UPRNs"," ","-3.3 Census 2021 (ONS via NOMIS)","-    Status: LIVE (with simulated fallback)","-    Base URL: https://www.nomisweb.co.uk/api/v01","-    Documentation: https://www.nomisweb.co.uk/api/v01/help","+3.3 EPC Register API","+    Status:         LIVE (with simulated fallback when no key)","+    Base URL:       https://epc.opendatacommunities.org/api/v1","+    Auth:           Basic auth with registered API key","+    Env Variable:   EPC_API_KEY","+    Cache TTL:      30 days","+    Fallback:       Simulated EPC data from property record"," ","-    Datasets Used:","-    - NM_2072_1 — Population by age/sex (Census 2021)","-    - NM_2021_1 — Accommodation type (Census 2021)","+    Endpoints Used:","+    - GET /domestic/search?postcode={postcode}&size=100","+    - GET /domestic/search?uprn={uprn}","+    - GET /domestic/certificate/{lmk-key}","+    - GET /domestic/recommendations/{lmk-key}"," ","-    Server Route: GET /api/v1/public-data/census/:lsoaCode","-    Cache TTL: 90 days","-    Rate Limit: 100,000 req/month","-    Fallback: Simulated demographics for Southwark LSOA areas","+    Server Route:","+    - GET /api/v1/public-data/epc/:postcode"," ","     Data Returned:","-    - Population count and density","-    - Age distribution (0-15, 16-64, 65+)","-    - Household composition","-    - Accommodation type breakdown","-    - Ethnicity distribution","+    - Energy rating (A-G), SAP score, potential rating","+    - Building fabric: walls, roof, windows, heating descriptions","+    - CO2 emissions, heating costs","+    - Improvement recommendations with estimated savings"," ","     Used By:","-    - Neighbourhood Briefing (demographics section)","-    - Property Passport (area context)","-    - D3: Vulnerability Detection (deprivation context)","+    - D1: Predictive Damp Intelligence (building fabric factor)","+    - D5: Property Passport (EPC section)","+    - Property detail — expanded Energy Performance panel","+    - Compliance — EPC compliance summary","+    - Reports — carbon emissions, retrofit planning"," ","-3.4 NOMIS — Labour Market Statistics","-    Status: LIVE (with simulated fallback)","-    Base URL: https://www.nomisweb.co.uk/api/v01","+3.4 NOMIS/Census (ONS)","+    Status:         LIVE (with simulated fallback)","+    Base URL:       https://www.nomisweb.co.uk/api/v01","+    Auth:           None (API key optional for higher limits)","+    Cache TTL:      7 days (labour market), 90 days (Census)","+    Fallback:       Simulated demographic data"," ","-    Datasets Used:","-    - NM_162_1 — JSA claimant count by age/sex","-    - NM_17_5  — Annual Population Survey (employment/unemployment)","+    Endpoints Used (Census 2021):","+    - NM_2072_1: Tenure by household (TS054)","+    - NM_2021_1: Household size (TS011)","+    - Age structure (TS009), Ethnic group (TS021), Disability (TS038)"," ","-    Server Route: GET /api/v1/public-data/nomis/:lsoaCode","-    Cache TTL: 30 days","-    Rate Limit: 100,000 req/month","-    Fallback: Simulated labour market data for SE London","+    Endpoints Used (Labour Market):","+    - NM_17_5: Claimant count by LA","+    - NM_162_1: Employment rate","+    - NM_30_1: Job density"," ","+    Server Routes:","+    - GET /api/v1/public-data/census/:lsoaCode","+    - GET /api/v1/public-data/nomis/:lsoaCode","+","     Data Returned:","-    - Employment rate, unemployment rate","-    - Economic activity breakdown","-    - Claimant count (JSA/UC)","-    - Occupation types","-    - Qualification levels","+    - Census: tenure mix, household size, age profile, disability prevalence","+    - Labour: employment rate, claimant count, job density, OOW benefits rate"," ","     Used By:","-    - D5: Benefits Entitlement Engine (employment context)","-    - Neighbourhood Briefing (economic section)","-    - D3: Vulnerability Detection (economic deprivation factor)","+    - D3: Automatic Vulnerability Detection (deprivation context)","+    - D4: Benefits Entitlement Engine (employment data)","+    - D6: Neighbourhood Briefing (demographic section)","+    - Reports — community profiling"," "," 3.5 Gas Safe Register","-    Status: LIVE (with simulated fallback)","-    Base URL: https://www.gassaferegister.co.uk/api","-    Documentation: Restricted (via partnership application)","+    Status:         LIVE (with simulated fallback)","+    Base URL:       Gas Safe verification endpoint","+    Cache TTL:      30 days","+    Fallback:       Simulated verification result"," ","-    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber","-    Cache TTL: 24 hours","-    Rate Limit: 100 req/hour","-    Fallback: Simulated verification with valid/expired/suspended status","+    Server Route:","+    - GET /api/v1/public-data/gas-safe/:registrationNumber"," ","     Data Returned:","-    - Engineer name and company","-    - Registration status (valid/expired/suspended)","-    - Qualifications (boiler, cooker, fire, etc.)","-    - Registration number and expiry date","+    - Registration validity, business name, registration number","+    - Appliance categories authorised"," ","     Used By:","-    - Repair detail page (contractor verification badge — green)","-    - Compliance management (contractor vetting)","+    - Repair detail page — Gas Safe contractor verification badge (green)","+    - Compliance — contractor verification"," "," 3.6 Electrical Safety Register (NICEIC)","-    Status: LIVE (with simulated fallback)","-    Base URL: https://www.niceic.com/api","-    Documentation: Via partnership application","+    Status:         LIVE (with simulated fallback)","+    Base URL:       Electrical Safety verification endpoint","+    Cache TTL:      30 days","+    Fallback:       Simulated verification result"," ","-    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber","-    Cache TTL: 24 hours","-    Rate Limit: 100 req/hour","-    Fallback: Simulated verification with valid/expired/suspended status","+    Server Route:","+    - GET /api/v1/public-data/electrical-safety/:registrationNumber"," ","     Data Returned:","-    - Contractor name and company","-    - Registration status (valid/expired/suspended)","-    - Scheme (NICEIC Approved Contractor / Competent Person)","-    - Registration number and expiry date","+    - Registration validity, company name, scheme"," ","     Used By:","-    - Repair detail page (contractor verification badge — blue)","-    - Compliance management (electrical contractor vetting)","+    - Repair detail page — NICEIC contractor verification badge (blue)","+    - Compliance — contractor verification"," "," ","-4. TIER 3 INTEGRATIONS (Mock/Subscription)","+4. TIER 3 INTEGRATIONS (Mock Services)"," ================================================================================"," ","-4.1 DWP Universal Credit Verification","-    Status: MOCK","-    Mock Function: mockUcVerification(tenantId)","-    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId","+    All Tier 3 APIs are implemented as mock services in","+    server/src/services/mock-services.ts returning realistic simulated data.","+    They are designed to be wired to real APIs when subscriptions are obtained."," ","-    Mock Response:","-    - UC claim status (active/pending/none)","-    - Housing element amount","-    - Payment frequency and next payment date","-    - Managed payment status (direct to landlord)","-    - Alternative Payment Arrangement (APA) eligibility","+4.1 DWP Universal Credit","+    Mock Function:  mockUcVerification(tenantId)","+    Server Route:   GET /api/v1/ai/mock/uc-verification/:tenantId","+    Returns:        UC claim status, payment dates, APA eligibility","+    Used By:        Benefits Engine, Arrears prediction, Tenant context"," ","-    Used By:","-    - D5: Benefits Entitlement Engine","-    - Rent management (UC tracking)","-    - Arrears prevention (early warning)","+4.2 IoT Sensors (Switchee/Aico/HomeLync)","+    Mock Function:  mockIotSensors(propertyId)","+    Server Route:   GET /api/v1/ai/mock/iot-sensors/:propertyId","+    Returns:        Temperature, humidity, moisture readings, alerts","+    Used By:        Damp Prediction (sensor factor, weight 0.20)"," ","-4.2 IoT Sensor Integration (Switchee/Aico)","-    Status: MOCK","-    Mock Function: mockIotSensors(propertyId)","-    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId","+4.3 GoCardless / Allpay (Direct Debit)","+    Mock Function:  mockDirectDebit(tenantId)","+    Server Route:   GET /api/v1/ai/mock/direct-debit/:tenantId","+    Returns:        DD mandate status, payment schedule, failure history","+    Used By:        Rent & Income, payment tracking"," ","-    Mock Response:","-    - Temperature readings (per room: living, bedroom, kitchen, bathroom)","-    - Humidity readings (per room)","-    - CO2 levels","-    - Smoke/CO detector status (OK/alert/battery-low)","-    - Heating system status (on/off/hours today)","-    - Alerts (high humidity, low temperature, CO detected)","+4.4 Plentific / Fixflo (Repairs Marketplace)","+    Mock Function:  mockRepairsMarketplace(caseId)","+    Server Route:   GET /api/v1/ai/mock/repairs-marketplace/:id","+    Returns:        Contractor quotes, scheduling, dispatch, satisfaction","+    Used By:        Repair case management, contractor selection"," ","-    Used By:","-    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)","-    - Property detail page (live sensor data)","-    - Compliance monitoring (smoke/CO detector status)","+4.5 RSH / CORE / Ombudsman (Regulatory)","+    Mock Function:  mockRegulatorySubmission(type, refId)","+    Server Route:   GET /api/v1/ai/mock/regulatory/:type/:ref","+    Returns:        IDA returns, CORE lettings/sales, ombudsman escalations","+    Used By:        Reports, compliance tracking"," ","-4.3 GoCardless — Direct Debit","-    Status: MOCK","-    Mock Function: mockDirectDebit(tenantId)","-    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId","+4.6 DocuSign (Digital Signing)","+    Mock Function:  mockSigningEnvelope(documentType, tenantId)","+    Server Route:   GET /api/v1/ai/mock/signing/:type/:id","+    Returns:        Envelope status, recipients, signing URLs","+    Used By:        Tenancy agreements, Section 21, compliance certificates"," ","-    Mock Response:","-    - Mandate status (active/pending/cancelled)","-    - Bank details (last 4 digits only)","-    - Next collection date and amount","-    - Payment history (last 12 months)","-    - Failed payment reasons","+4.7 Experian / TransUnion (Referencing)","+    Mock Function:  mockReferencingResult(applicantId)","+    Server Route:   GET /api/v1/ai/mock/referencing/:id","+    Returns:        Credit score, affordability, CCJs, previous addresses","+    Used By:        Allocations — applicant referencing"," ","-    Used By:","-    - Rent management (payment processing)","-    - Arrears management (DD failure tracking)","-    - Tenant detail (payment method)","+4.8 Land Registry","+    Mock Function:  mockLandRegistryTitle(propertyId)","+    Server Route:   GET /api/v1/ai/mock/land-registry/:id","+    Returns:        Title number, freehold/leasehold, price paid, lease details","+    Used By:        Property Passport, asset management"," ","-4.4 Plentific/Fixflo — Repairs Marketplace","-    Status: MOCK","-    Mock Function: mockRepairsMarketplace(caseId)","-    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId","+4.9 NOMIS Extended (Labour Market)","+    Mock Function:  mockLabourMarket(lsoaCode)","+    Server Route:   GET /api/v1/ai/mock/labour-market/:code","+    Returns:        Detailed employment data, sector breakdown, wage data","+    Used By:        Benefits Engine, arrears context"," ","-    Mock Response:","-    - Contractor quotes (3 quotes with price/availability)","-    - Dispatch confirmation","-    - Appointment scheduling","-    - Job completion notification","-    - Satisfaction survey trigger"," ","-    Used By:","-    - Repairs management (contractor dispatch)","-    - Cost management (competitive quotes)","-","-4.5 DocuSign — Digital Signing","-    Status: MOCK","-    Mock Function: mockSigningEnvelope(documentType, tenantId)","-    Server Route: POST /api/v1/ai/mock/signing","-","-    Mock Response:","-    - Envelope ID and status (sent/delivered/signed/declined)","-    - Document type (tenancy-agreement, section-21, gas-cert, atp)","-    - Recipients with signing status","-    - Completion date","-    - Signed document URL","-","-    Used By:","-    - Tenancy sign-up workflow","-    - Compliance certificate signing","-    - Legal document execution","-","-4.6 Experian/TransUnion — Tenant Referencing","-    Status: MOCK","-    Mock Function: mockReferencingResult(applicantId)","-    Server Route: GET /api/v1/ai/mock/referencing/:applicantId","-","-    Mock Response:","-    - Credit score (300-850)","-    - Affordability assessment (pass/refer/fail)","-    - CCJ count and value","-    - Previous addresses (last 3 years)","-    - Employment verification","-    - Recommendation (accept/refer/decline)","-","-    Used By:","-    - Allocations (applicant vetting)","-    - Lettings workflow (pre-tenancy checks)","-","-4.7 Land Registry — Title Data","-    Status: MOCK","-    Mock Function: mockLandRegistryTitle(propertyId)","-    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId","-","-    Mock Response:","-    - Title number","-    - Tenure type (freehold/leasehold)","-    - Price paid and date","-    - Registered owner","-    - Lease details (start, term, ground rent)","-    - Restrictions and charges","-","-    Used By:","-    - Property Passport (ownership section)","-    - Property detail page","-","-4.8 RSH/CORE/Ombudsman — Regulatory Submissions","-    Status: MOCK","-    Mock Function: mockRegulatorySubmission(type, refId)","-    Server Route: POST /api/v1/ai/mock/regulatory","-","-    Submission Types:","-    - IDA (Individual Data Return)","-    - CORE lettings","-    - CORE sales","-    - Ombudsman escalation","-    - Compliance score return","-","-    Used By:","-    - Reports module (regulatory submissions)","-    - Compliance management","-","-4.9 NOMIS Labour Market (Extended)","-    Status: MOCK","-    Mock Function: mockLabourMarket(lsoaCode)","-    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode","-","-    Used By:","-    - Neighbourhood Briefing (economic context)","-    - Benefits Engine (employment verification)","-","-"," 5. SEVEN KILLER DIFFERENTIATOR SERVICES"," ================================================================================"," ","+    These services combine internal data with external API data to produce","+    intelligence no competitor housing system can match.","+"," 5.1 D1: Predictive Damp Intelligence","-    Service: server/src/services/damp-prediction.ts","-    API Route: GET /api/v1/ai/damp-risk/:propertyId","+    Service:        server/src/services/damp-prediction.ts (17KB)","+    Algorithm:      5-factor weighted scoring (0-100)"," ","-    Algorithm: 5-Factor Weighted Score (0-100)","-    +---------------------+--------+--------------------------------+","-    | Factor              | Weight | Data Sources                   |","-    +---------------------+--------+--------------------------------+","-    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |","-    | Building attributes |  0.25  | Property data (age, type, EPC) |","-    | Repair history      |  0.20  | Case data (damp/mould reports) |","-    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |","-    | Occupancy patterns  |  0.10  | Tenant data (household size)   |","-    +---------------------+--------+--------------------------------+","+    Factor Weights:","+    | Factor    | Weight | Source                | Key Inputs                    |","+    |-----------|--------|-----------------------|-------------------------------|","+    | Weather   | 0.25   | Open-Meteo            | Temp, humidity, precipitation |","+    | Building  | 0.25   | EPC, internal data    | Construction, insulation, age |","+    | History   | 0.20   | Internal repairs       | Previous damp repairs, freq   |","+    | Sensor    | 0.20   | IoT mock              | Humidity, temp, moisture      |","+    | Occupancy | 0.10   | Internal tenant data   | Household size, ventilation   |"," ","-    Output:","-    - Overall risk score (0-100)","-    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)","-    - Factor breakdown with individual scores","-    - Proactive recommendations","-    - Awaab's Law compliance status","+    Output:         Risk score 0-100 + factor breakdown + recommendations","+    API:            GET /api/v1/ai/damp-risk/:propertyId","+                    GET /api/v1/ai/damp-risk/estate/:estateId","+    Frontend:       DampIntelligencePanel component"," "," 5.2 D2: Live Crime Context for ASB","-    Service: server/src/services/crime-context.ts","-    API Route: GET /api/v1/ai/crime-context/:estateId","+    Service:        server/src/services/crime-context.ts (11KB)","+    Algorithm:      Police.uk data correlation with internal ASB cases"," ","-    Algorithm:","-    - Fetch Police.uk data for estate location (12-month window)","-    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)","-    - Correlate with internal ASB cases","-    - Identify hotspots and trends","-    - Generate estate safety score","+    Features:","+    - Crime heatmap overlay on estate maps","+    - Hotspot analysis (density within 500m radius)","+    - Correlation between police reports and internal ASB cases","+    - Multi-agency referral recommendations"," ","-    Output:","-    - Crime summary by category (last 12 months)","-    - Monthly trend (rising/stable/declining)","-    - Hotspot locations within estate","-    - Correlation with internal ASB cases","-    - Recommended patrol priorities","+    Output:         Crime summary, hotspot map data, correlation matches","+    API:            GET /api/v1/ai/crime-context/:estateId","+                    GET /api/v1/ai/crime-context/case/:caseId","+    Frontend:       Crime data layer on Explore page"," "," 5.3 D3: Automatic Vulnerability Detection","-    Service: server/src/services/vulnerability-detection.ts","-    API Route: GET /api/v1/ai/vulnerability/:tenantId","+    Service:        server/src/services/vulnerability-detection.ts (16KB)","+    Algorithm:      7-factor scoring"," ","-    Algorithm: 7-Factor Weighted Score (0-100)","-    +--------------------------+--------+--------------------------+","-    | Factor                   | Weight | Data Sources             |","-    +--------------------------+--------+--------------------------+","-    | IMD deprivation          |  0.20  | IMD data (decile)        |","-    | Arrears history          |  0.20  | Rent account (balance)   |","-    | Health flags             |  0.15  | Tenant vulnerability     |","-    | Social isolation         |  0.15  | Household composition    |","-    | Age risk (elderly/young) |  0.10  | Tenant DOB              |","-    | Dependents               |  0.10  | Household members        |","-    | UC transition            |  0.10  | UC status                |","-    +--------------------------+--------+--------------------------+","+    Factors:","+    | Factor       | Weight | Source           | Key Inputs                   |","+    |--------------|--------|------------------|------------------------------|","+    | Deprivation  | --     | IMD/ONS          | IMD decile, domain scores    |","+    | Arrears      | --     | Internal         | Payment pattern, amount      |","+    | Health       | --     | Census/flags     | Disability, health indicators|","+    | Isolation    | --     | Internal         | Contact frequency, no-access |","+    | Age          | --     | Internal         | Elderly, young tenant        |","+    | Dependents   | --     | Internal         | Children, household size     |","+    | UC Transition| --     | DWP mock         | UC claim, transition stage   |"," ","-    Output:","-    - Vulnerability score (0-100)","-    - Risk level: low / moderate / high / critical","-    - Detected flags (e.g., elderly, mental-health, financial-hardship)","-    - Recommended support actions","-    - Referral suggestions (social services, CAB, food bank)","+    Output:         Overall score + factor scores + detected flags + actions","+    API:            GET /api/v1/ai/vulnerability/:tenantId","+                    POST /api/v1/ai/vulnerability/scan (org-wide)","+    Frontend:       VulnerabilityPanel component"," ","-5.4 D4: Property Passport","-    Service: server/src/services/property-passport.ts","-    API Route: GET /api/v1/ai/property-passport/:propertyId","+5.4 D4: Benefits Entitlement Engine","+    Service:        server/src/services/benefits-engine.ts (11KB)","+    Algorithm:      UK 2025/26 benefit rules analysis"," ","-    Aggregation Sources:","-    - Property data (Firestore)","-    - EPC certificate (Tier 2 API)","-    - Compliance certificates (Firestore)","-    - Repair history (Firestore cases)","-    - Damp risk score (D1 service)","-    - Flood risk (DEFRA API)","-    - Crime context (D2 service)","-    - Census demographics (NOMIS API)","-    - Land Registry title (mock)","-","-    Output:","-    - Comprehensive property dossier","-    - Current condition assessment","-    - Compliance status summary","-    - Energy efficiency profile","-    - Neighbourhood context","-    - Investment recommendations","-","-5.5 D5: Benefits Entitlement Engine","-    Service: server/src/services/benefits-engine.ts","-    API Route: GET /api/v1/ai/benefits-check/:tenantId","-","-    Rules Engine (UK 2025/26):","-    - Universal Credit (standard allowance, housing element, child element)","+    Benefits Checked:","+    - Universal Credit (housing element, childcare, carer, disability)","+    - Housing Benefit (legacy)","     - Personal Independence Payment (PIP)","     - Attendance Allowance","-    - Pension Credit (guarantee, savings)","+    - Pension Credit (Guarantee, Savings)","     - Council Tax Reduction","-    - Discretionary Housing Payment","     - Warm Home Discount","-    - Free school meals","+    - Winter Fuel Payment","+    - Free School Meals"," ","-    Input:","-    - Tenant age, household composition","-    - Employment status, income","-    - Disability/health conditions","-    - Current benefit claims","+    Output:         Entitlement list with status, amounts, unclaimed totals","+    API:            GET /api/v1/ai/benefits-check/:tenantId","+    Frontend:       BenefitsPanel component"," ","-    Output:","-    - List of potential entitlements","-    - Estimated weekly/monthly amounts","-    - Claim status (claimed/unclaimed/check-eligibility)","-    - Total unclaimed benefits estimate","-    - Next steps for each entitlement","+5.5 D5: Property Passport","+    Service:        server/src/services/property-passport.ts (11KB)","+    Algorithm:      Multi-source property dossier aggregation"," ","-5.6 D6: AI Neighbourhood Briefing","-    Service: server/src/services/neighbourhood-briefing.ts","-    API Route: GET /api/v1/ai/briefing/:estateId","+    Sources Aggregated:","+    - EPC certificate data (energy, fabric, heating)","+    - Gas Safe registration / EICR status","+    - UPRN verification","+    - Flood risk zone","+    - IMD deprivation score","+    - Crime statistics","+    - Weather forecast","+    - Internal compliance, repairs, stock condition data"," ","-    Data Sources Combined:","-    - Weather forecast (Open-Meteo)","-    - Crime data (Police.uk)","-    - Active cases (Firestore)","-    - Compliance status (Firestore)","-    - Census demographics (NOMIS)","-    - Damp risk aggregation (D1)","-    - ASB incidents (Firestore + Police)","+    Output:         Comprehensive property intelligence document","+    API:            GET /api/v1/ai/property-passport/:propertyId","+    Frontend:       Property detail page"," ","-    Output:","-    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)","-    - Officer briefing text (AI-generated narrative)","-    - Action items prioritized by urgency","-    - Trend comparisons (this week vs last)","+5.6 D6: AI Neighbourhood Briefing","+    Service:        server/src/services/neighbourhood-briefing.ts (14KB)","+    Algorithm:      Per-estate daily intelligence combining all sources"," ","-5.7 D7: IoT Sensor Integration","-    Service: server/src/services/mock-services.ts","-    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId","+    Sections:","+    - Weather outlook (damp risk, frost, storms)","+    - Crime context (recent incidents, trends)","+    - Demographics (area profile)","+    - Labour market (unemployment, claimant trends)","+    - Internal KPIs (repairs, arrears, compliance, voids)","+    - Action items (recommended officer actions)"," ","-    Supported Devices:","-    - Switchee smart thermostat (temperature, humidity, heating usage)","-    - Aico smoke/CO detectors (status, battery, alerts)","-    - Third-party humidity sensors","+    Output:         6 summary cards + officer briefing + action items","+    API:            GET /api/v1/ai/briefing/:estateId","+    Frontend:       NeighbourhoodBriefingPanel component"," ","-    Status: MOCK (ready for real Switchee/Aico API integration)","+5.7 D7: GOV.UK Notify Integration","+    Service:        server/src/services/govuk-notify.ts (45KB)","+    See Section 6 for full template library."," "," ","-6. GOV.UK NOTIFY INTEGRATION","+6. GOV.UK NOTIFY INTEGRATION (24 Templates)"," ================================================================================"," "," 6.1 Overview","-    Service: server/src/services/govuk-notify.ts (1,257 lines)","-    Status: Template library defined (24 templates)","-    Integration: Ready for GOV.UK Notify API key","+    Platform:       GOV.UK Notify (https://notifications.service.gov.uk)","+    Channels:       Email, SMS, Letter","+    Templates:      24 across 7 categories","+    Personalisation: ((field)) syntax for dynamic content","+    Tone options:   Supportive, Formal, Urgent, Legally Required"," ","-6.2 Template Categories (7)","+6.2 Template Categories"," ","-    CATEGORY 1: Rent Arrears (4 templates)","-    - arrears-mild: Friendly reminder (1-2 weeks behind)","-    - arrears-moderate: Formal notice (3-4 weeks)","-    - arrears-severe: Pre-action warning (5+ weeks)","-    - arrears-arrangement: Payment plan confirmation","+    | Category     | Count | Templates                                      |","+    |--------------|-------|------------------------------------------------|","+    | Rent/Arrears | 5     | Friendly reminder, formal warning, NOSP,       |","+    |              |       | payment arrangement, UC support                |","+    | Repairs      | 4     | Appointment booking, completion confirmation,  |","+    |              |       | delay notification, satisfaction follow-up      |","+    | ASB          | 3     | Warning letter, ABC agreement, CPN notice      |","+    | Compliance   | 3     | Gas safety appointment, EICR appointment,      |","+    |              |       | no-access escalation                           |","+    | Tenancy      | 3     | Welcome letter, annual review, end of tenancy  |","+    | Damp/Mould   | 3     | Inspection appointment, advice letter,         |","+    |              |       | Awaab's Law update                             |","+    | General      | 3     | General enquiry response, service update,      |","+    |              |       | annual report                                  |"," ","-    CATEGORY 2: Repairs (4 templates)","-    - repair-acknowledged: Repair reported acknowledgement","-    - repair-appointment: Appointment booking confirmation","-    - repair-completed: Completion notification + satisfaction link","-    - repair-follow-up: Post-repair follow-up","+6.3 API Routes","+    GET  /api/v1/ai/notify/templates            All templates","+    GET  /api/v1/ai/notify/templates/:category   Templates by category","+    GET  /api/v1/ai/notify/template/:id          Single template","+    POST /api/v1/ai/notify/render                Render with personalisation"," ","-    CATEGORY 3: ASB (3 templates)","-    - asb-reported: ASB report acknowledgement","-    - asb-warning: Warning letter to perpetrator","-    - asb-update: Case update to victim/reporter","+6.4 Personalisation Fields","+    Common fields: ((name)), ((address)), ((reference)), ((date)),","+    ((officer_name)), ((officer_phone)), ((organisation_name))","+    Financial: ((balance)), ((amount)), ((weekly_rent))","+    Repairs: ((appointment_date)), ((appointment_time)), ((trade))","+    Legal: ((notice_period)), ((court_date)), ((compliance_date))"," ","-    CATEGORY 4: Compliance (3 templates)","-    - compliance-access: Access request for inspection","-    - compliance-reminder: Appointment reminder","-    - compliance-certificate: Certificate available notification"," ","-    CATEGORY 5: Tenancy (4 templates)","-    - tenancy-welcome: New tenant welcome pack","-    - tenancy-renewal: Renewal offer","-    - tenancy-end: End of tenancy notification","-    - tenancy-annual-visit: Annual visit scheduling","+7. CACHING ARCHITECTURE","+================================================================================"," ","-    CATEGORY 6: Damp & Mould (3 templates)","-    - damp-report-ack: Report acknowledged","-    - damp-inspection: Inspection scheduled","-    - damp-works: Works ordered notification (Awaab's Law timeline)","+7.1 Firestore Cache Collection: externalDataCache","+    Document ID:    {source}:{lookup-key}","+    Fields:","+    - source: string (API identifier)","+    - lookupKey: string (postcode, UPRN, lat/lng, LSOA)","+    - data: map (cached response payload)","+    - fetchedAt: timestamp","+    - ttlSeconds: number","+    - expiresAt: timestamp","+    - httpStatus: number","+    - latencyMs: number"," ","-    CATEGORY 7: General (3 templates)","-    - general-update: Generic case update","-    - general-survey: Satisfaction survey invitation","-    - general-information: Information request","+7.2 TTL Policy"," ","-6.3 Template Rendering","-    - Personalisation fields use ((field)) syntax","-    - Rendered server-side via /api/v1/ai/notify/render","-    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),","-      ((amount)), ((date)), ((officer_name)), etc.","+    | Source              | TTL         | Rationale                        |","+    |---------------------|-------------|----------------------------------|","+    | Weather (forecast)  | 1 hour      | Weather changes frequently       |","+    | Weather (historical)| 7 days      | Historical data stable            |","+    | Flood warnings      | 1 hour      | Active warnings change            |","+    | Crime data          | 24 hours    | Monthly police.uk releases        |","+    | Postcodes           | 90 days     | Postcodes rarely change           |","+    | UPRN data           | 90 days     | Address data very stable          |","+    | EPC certificates    | 30 days     | Change only on re-lodgement       |","+    | IMD/Census          | 90 days     | Updated every 4-5 years           |","+    | Labour market       | 7 days      | Monthly ONS releases              |","+    | Gas Safe            | 30 days     | Registration status stable        |","+    | Electrical Safety   | 30 days     | Registration status stable        |"," ","-6.4 API Endpoints","-    GET  /api/v1/ai/notify/templates           -- List all 24 templates","-    GET  /api/v1/ai/notify/templates/:category  -- Filter by category","-    GET  /api/v1/ai/notify/template/:id         -- Single template detail","-    POST /api/v1/ai/notify/render               -- Render with personalisation","+7.3 Cache Strategy","+    - Cache-through: check cache first, fetch on miss","+    - Stale data: return cached data even if expired, refresh in background","+    - Cache warming: planned for Phase 5 (task 5.2.6)"," "," ","-7. CACHING ARCHITECTURE","+8. RATE LIMITING STRATEGY"," ================================================================================"," ","-7.1 Cache Collection: externalDataCache","-    Stored in Firestore with TTL-based expiration.","-    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")","+8.1 Internal Rate Limiting (per-client)","+    - API routes: 100 requests/minute","+    - Auth routes: 10 requests/minute","+    - AI routes: 30 requests/minute","+    - Admin routes: 20 requests/minute","+    - Implementation: Sliding window, token bucket pattern"," ","-7.2 Cache-Through Pattern","-    1. Check Firestore cache for key","-    2. If found AND not expired -> return cached data","-    3. If missing OR expired -> fetch from external API","-    4. Store result in cache with TTL","-    5. Return data to caller","+8.2 External API Rate Limiting (per-source)","+    | Source       | Limit          | Implementation              |","+    |--------------|----------------|-----------------------------|","+    | Police.uk    | 15 req/sec     | Token bucket, queue excess  |","+    | Open-Meteo   | 10,000/day     | Daily counter               |","+    | DEFRA        | Fair use       | 1 req/sec soft limit        |","+    | Postcodes.io | Fair use       | 1 req/sec soft limit        |","+    | EPC Register | Fair use       | 1 req/sec soft limit        |","+    | NOMIS        | Fair use       | 1 req/sec soft limit        |"," ","-7.3 TTL Configuration"," ","-    | Source              | TTL       | Key Format                 |","-    |---------------------|-----------|----------------------------|","-    | police              | 24 hours  | police:{postcode}          |","-    | weather             | 1 hour    | weather:{lat},{lng}        |","-    | flood-risk          | 1 hour    | flood:{postcode}           |","-    | postcode            | 7 days    | postcode:{postcode}        |","-    | epc                 | 30 days   | epc:{uprn}                 |","-    | census              | 90 days   | census:{lsoaCode}          |","-    | nomis               | 30 days   | nomis:{lsoaCode}           |","-    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |","-    | electrical-safety   | 24 hours  | electrical:{regNumber}     |","-    | imd                 | 90 days   | imd:{lsoaCode}             |","+9. ERROR HANDLING & FALLBACK","+================================================================================"," ","-7.4 Cache Management","-    - Automatic TTL enforcement on read","-    - Manual cache invalidation via admin API","-    - Cache hit rate tracked in metrics","-    - No cache warming (fetch-on-demand only — warming planned Phase 5)","+9.1 Error Response Format","+    {","+      error: string           // Human-readable message","+      code: string            // Machine-readable code","+      requestId: string       // X-Request-ID for correlation","+      // No stack traces in production","+    }"," ","+9.2 Fallback Strategy","+    Every external API integration has a simulated fallback:","+    1. Primary: call real API","+    2. On failure (timeout, 4xx, 5xx): return simulated data","+    3. Simulated data marked with source: \"simulated\"","+    4. Error logged to auditLog","+    5. Admin dashboard shows integration health status"," ","-8. RATE LIMITING","-================================================================================","+9.3 Circuit Breaker (Phase 5 — task 5.2.5)","+    Planned: per-source failure tracking with state machine","+    States: closed → open (after 5 failures) → half-open (after 60s)","+    Currently: simple try/catch with fallback"," ","-8.1 Internal Rate Limits (per client IP)"," ","-    | Tier    | Routes              | Limit        | Window  |","-    |---------|---------------------|--------------|---------|","-    | API     | /api/v1/*           | 100 req/min  | Sliding |","-    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |","-    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |","-    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |","+10. SECURITY REQUIREMENTS","+================================================================================"," ","-8.2 External API Rate Limits","-    Token bucket pattern per API source.","-    Global fair-use: 15 req/sec across all external APIs.","+10.1 API Authentication","+    - All /api/v1/* routes require Firebase JWT token","+    - Token verified on every request via auth middleware","+    - Exception: /health, /api/v1/auth/seed-users"," ","-    | API               | Limit             | Enforced By       |","-    |-------------------|-------------------|-------------------|","-    | Police.uk         | 15 req/sec        | Fair-use + cache  |","-    | Open-Meteo        | 10,000 req/day    | No key needed     |","-    | DEFRA             | No formal limit   | Fair-use          |","-    | Postcodes.io      | No formal limit   | Fair-use          |","-    | EPC Open Data     | 1,000 req/month   | API key + cache   |","-    | NOMIS             | 100,000 req/month | Fair-use          |","-    | Gas Safe          | 100 req/hour      | Fair-use + cache  |","-    | Electrical Safety | 100 req/hour      | Fair-use + cache  |","+10.2 External API Key Management","+    - API keys stored in Google Secret Manager","+    - Injected as environment variables on Cloud Run","+    - Never exposed to frontend client","+    - Admin can toggle integrations via /admin/integrations"," ","+10.3 Data Security","+    - PII never sent to external APIs unnecessarily","+    - Cached data inherits sensitivity of source","+    - Audit log captures all external API calls","+    - CORS restricts which origins can call the API"," ","-9. ERROR HANDLING & GRACEFUL DEGRADATION","+","+11. INTERNAL API ENDPOINT REGISTRY (50+ Endpoints)"," ================================================================================"," ","-9.1 External API Error Handling","-    - Timeout: 10 seconds per external request","-    - Retry: 1 retry with exponential backoff (2s)","-    - On failure: Return simulated fallback data","-    - Flag: Response includes { source: 'live' | 'simulated' }","+    Full endpoint listing organised by route module:"," ","-9.2 Simulated Fallback Strategy","-    Every external API has a corresponding simulated data generator.","-    Simulated data is:","-    - Realistic for the requested entity/location","-    - Consistent across requests (deterministic seeding)","-    - Flagged clearly in the response","+    AUTH (3 endpoints):","+    POST  /api/v1/auth/seed-users","+    POST  /api/v1/auth/profile","+    GET   /api/v1/auth/me"," ","-9.3 Circuit Breaker Pattern (Planned — Phase 5)","-    - Track failure count per API source","-    - Open circuit after 5 consecutive failures","-    - Half-open after 60 seconds (single test request)","-    - Close circuit on successful test","-    Status: Designed, not yet implemented (task 5.2.5)","+    PROPERTIES (4 endpoints):","+    GET   /api/v1/properties","+    GET   /api/v1/properties/available","+    GET   /api/v1/properties/:id","+    PATCH /api/v1/properties/:id"," ","+    TENANTS (3 endpoints):","+    GET   /api/v1/tenants","+    GET   /api/v1/tenants/:id","+    PATCH /api/v1/tenants/:id"," ","-10. API SECURITY","-================================================================================","+    CASES (5 endpoints):","+    GET   /api/v1/cases","+    GET   /api/v1/cases/:id","+    POST  /api/v1/cases","+    PATCH /api/v1/cases/:id","+    GET   /api/v1/cases/:id/activities"," ","-10.1 Authentication","-    All /api/v1/* routes require Firebase Bearer token.","-    Exception: /health (public health check), /api/v1/config (public)","+    AI SERVICES (24 endpoints):","+    POST  /api/v1/ai/draft-communication","+    POST  /api/v1/ai/entity-intelligence","+    POST  /api/v1/ai/neighbourhood-context","+    POST  /api/v1/ai/property-intelligence","+    POST  /api/v1/ai/tenant-context","+    POST  /api/v1/ai/chat","+    GET   /api/v1/ai/damp-risk/:propertyId","+    GET   /api/v1/ai/damp-risk/estate/:estateId","+    GET   /api/v1/ai/crime-context/:estateId","+    GET   /api/v1/ai/crime-context/case/:caseId","+    GET   /api/v1/ai/vulnerability/:tenantId","+    POST  /api/v1/ai/vulnerability/scan","+    GET   /api/v1/ai/benefits-check/:tenantId","+    GET   /api/v1/ai/property-passport/:propertyId","+    GET   /api/v1/ai/briefing/:estateId","+    GET   /api/v1/ai/notify/templates","+    GET   /api/v1/ai/notify/templates/:category","+    GET   /api/v1/ai/notify/template/:id","+    POST  /api/v1/ai/notify/render","+    GET   /api/v1/ai/mock/uc-verification/:tenantId","+    GET   /api/v1/ai/mock/iot-sensors/:propertyId","+    GET   /api/v1/ai/mock/direct-debit/:tenantId","+    GET   /api/v1/ai/mock/labour-market/:lsoaCode","+    GET   /api/v1/ai/mock/repairs-marketplace/:caseId","+    GET   /api/v1/ai/mock/regulatory/:type/:refId","+    GET   /api/v1/ai/mock/signing/:type/:tenantId","+    GET   /api/v1/ai/mock/referencing/:applicantId","+    GET   /api/v1/ai/mock/land-registry/:propertyId"," ","-10.2 Request Validation","-    - JSON body limit: 1MB","-    - Content-Type: application/json enforced","-    - Query parameter sanitization","-    - Path parameter validation","+    PUBLIC DATA (11 endpoints):","+    GET   /api/v1/public-data/police/:postcode","+    GET   /api/v1/public-data/weather/:lat/:lng","+    GET   /api/v1/public-data/flood/:lat/:lng","+    GET   /api/v1/public-data/postcode/:postcode","+    POST  /api/v1/public-data/postcodes/bulk","+    GET   /api/v1/public-data/epc/:postcode","+    GET   /api/v1/public-data/imd/:lsoaCode","+    GET   /api/v1/public-data/census/:lsoaCode","+    GET   /api/v1/public-data/nomis/:lsoaCode","+    GET   /api/v1/public-data/gas-safe/:regNo","+    GET   /api/v1/public-data/electrical-safety/:regNo"," ","-10.3 Response Security","-    - No sensitive data in error responses (production)","-    - CORS restricted to allowed origins","-    - Request ID correlation (X-Request-ID)","-    - Security headers on all responses","+    ADMIN (4 endpoints):","+    GET   /api/v1/admin/integrations","+    POST  /api/v1/admin/integrations/:id/toggle","+    POST  /api/v1/admin/integrations/:id/test","+    GET   /api/v1/admin/monitoring"," ","-10.4 API Key Management","-    - No API keys in source code","-    - All keys in Google Secret Manager","-    - Environment variable injection at runtime","-    - Key rotation support via Secret Manager versioning","+    OTHER ROUTES:","+    GET   /api/v1/explore/*          (drill-down hierarchy)","+    GET   /api/v1/briefing/*         (AI briefing generation)","+    GET   /api/v1/compliance/*       (compliance tracking)","+    GET   /api/v1/rent/*             (financial tracking)","+    GET   /api/v1/reports/*          (report generation)","+    GET   /api/v1/export/*           (HACT data export)","+    GET   /api/v1/lettings/*         (lettings & allocations)","+    POST  /api/v1/booking/*          (viewing/appointment)","+    GET   /health                    (health check)"," "," ","-11. FUTURE INTEGRATION ROADMAP","+12. FUTURE ROADMAP"," ================================================================================"," ","-11.1 Phase 5 — Real-Time & Advanced (Planned)","+12.1 Phase 5 API Enhancements","+    - Vertex AI integration for Yantra Assist chat (5.2.1, 5.2.2)","+    - WebSocket for real-time notifications (5.2.3, 5.2.4)","+    - AI communication drafting with LLM (5.2.11)","+    - AI repair intake with NLP (5.2.14)","+    - Bulk operations API (5.2.9)","+    - Audit log query API with full-text search (5.2.10)","+    - File upload service with Cloud Storage (5.2.15)","+    - GDPR data export pipeline (5.2.16)","+    - Circuit breaker pattern (5.2.5)","+    - Cache warming service (5.2.6)","+    - Scheduled task runner (5.2.7)"," ","-    | Integration           | Priority | Complexity | Description                     |","-    |-----------------------|----------|------------|---------------------------------|","-    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |","-    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |","-    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |","-    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |","-    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |","-    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |","-    | GoCardless API (real) | P2       | M          | Real direct debit processing     |","-    | DocuSign API (real)   | P2       | M          | Real digital signing             |","-    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |","-    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |","+12.2 Phase 6 Enterprise Integrations (planned)","+    - Real DWP/UC API (replacing mock)","+    - Real GOV.UK Notify sending (replacing template render)","+    - Real IoT sensor APIs (Switchee, Aico)","+    - Payment processing (GoCardless, Allpay)","+    - Regulatory submissions (RSH CORE, Ombudsman)","+    - Open Banking for income verification","+    - Companies House for contractor checks","+    - HM Land Registry API for title verification"," ","-11.2 Phase 6 — Enterprise Integrations (Future)","+12.3 OpenAPI/Swagger Specification (Phase 5 — task 5.1.7)","+    Planned: Full OpenAPI 3.0 spec for all 50+ endpoints","+    - Request/response schemas","+    - Authentication documentation","+    - Example payloads","+    - Error codes","+    - Rate limit documentation"," ","-    | Integration           | Priority | Complexity | Description                     |","-    |-----------------------|----------|------------|---------------------------------|","-    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |","-    | Salesforce CRM        | P3       | H          | Tenant relationship management   |","-    | Power BI              | P3       | M          | Advanced analytics/dashboards    |","-    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |","-    | NHS Digital           | P3       | H          | Health data integration          |","-    | Companies House       | P3       | S          | Contractor verification          |","-    | Stripe/GoCardless     | P3       | M          | Online rent payment              |"," ","-"," ================================================================================","-  End of Doc3 — SocialHomes.Ai API & Integration Requirements","-  Yantra Works | 2026-02-25","+  End of Document","+  Doc3 — SocialHomes.Ai API & Integration Requirements v7.0","+  Yantra Works | 2026-02-26"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"e477c8f2-b4f1-479d-a03c-713f5442817a"}
{"parentUuid":"bffcf455-64e7-4175-a917-9735f37564db","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01XDjBZ6FPzFUQcCExjYUVBK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0172Cg9yaCoLLxxwHzFdrnsR","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"in_progress","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9188,"cache_read_input_tokens":120139,"output_tokens":304,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":9188,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLCeh6yjHtHSGe1YbLk","type":"assistant","uuid":"8db2a557-e9aa-4a95-8e2d-2b68708b54df","timestamp":"2026-02-26T08:03:21.772Z"}
{"parentUuid":"8db2a557-e9aa-4a95-8e2d-2b68708b54df","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0172Cg9yaCoLLxxwHzFdrnsR","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"a8b149d9-6472-4db8-a499-56cde4f7977a","timestamp":"2026-02-26T08:03:21.776Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"in_progress","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"pending","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"in_progress","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"8db2a557-e9aa-4a95-8e2d-2b68708b54df"}
{"parentUuid":"a8b149d9-6472-4db8-a499-56cde4f7977a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01MiguGb2h7xEb65iomPWFVj","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the EXECUTION-PLAN.md. I'll preserve the completed phases 0-4 and refresh Phase 5 with the full v7.0 structure:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":129327,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWLDLYjF58FqorB8vZPj","type":"assistant","uuid":"9cba1513-4c07-4683-9561-ba6be55abc1d","timestamp":"2026-02-26T08:03:26.021Z"}
{"parentUuid":"9cba1513-4c07-4683-9561-ba6be55abc1d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01MiguGb2h7xEb65iomPWFVj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QHMv8DBJ99aPvdCi9FCh2X","name":"Write","input":{"file_path":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 7.0 | 2026-02-26 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **IN PROGRESS** | **3/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — IN PROGRESS (3/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the agent structure:\n1. Project Setup & Architecture\n2. Backend Development\n3. Frontend Development\n4. Testing & QA\n5. DevOps & Deployment\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v7.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v7.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | DONE |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v7.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v7.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v7.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 3, TODO: 47) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — DONE)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix — DONE) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 7.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-26**\n"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":129327,"output_tokens":9990,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":346,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLDLYjF58FqorB8vZPj","type":"assistant","uuid":"233edbf1-f2b1-4312-a3c6-2971802527ad","timestamp":"2026-02-26T08:06:37.801Z"}
{"parentUuid":"233edbf1-f2b1-4312-a3c6-2971802527ad","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QHMv8DBJ99aPvdCi9FCh2X","type":"tool_result","content":"The file /mnt/c/.REDACTED.md has been updated successfully."}]},"uuid":"3bd99f3d-e280-4519-9747-23609aaa3493","timestamp":"2026-02-26T08:06:37.834Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 7.0 | 2026-02-26 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **IN PROGRESS** | **3/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — IN PROGRESS (3/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the agent structure:\n1. Project Setup & Architecture\n2. Backend Development\n3. Frontend Development\n4. Testing & QA\n5. DevOps & Deployment\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v7.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v7.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | DONE |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v7.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v7.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v7.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 3, TODO: 47) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — DONE)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix — DONE) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 7.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-26**\n","structuredPatch":[{"oldStart":1,"oldLines":7,"newStart":1,"newLines":7,"lines":[" # SocialHomes.Ai — Master Execution Plan"," "," > Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.","-> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent","+> Version 7.0 | 2026-02-26 | Updated by Business Analyst Agent"," > Studio: Yantra Works"," "," ---"]},{"oldStart":15,"oldLines":7,"newStart":15,"newLines":7,"lines":[" | 2 | Intelligence | 3-4 | DONE | 14/14 |"," | 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |"," | 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |","-| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |","+| **5** | **Evolution** | **9-14** | **IN PROGRESS** | **3/50** |"," "," ---"," "]},{"oldStart":129,"oldLines":13,"newStart":129,"newLines":16,"lines":[" "," ---"," ","-## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)","+## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — IN PROGRESS (3/50)"," "," ### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness"," ","-Phase 5 is organized into 5 sub-phases matching the required agent structure:","-Project Setup & Architecture, Backend Development, Frontend Development,","-Testing & QA, and DevOps & Deployment.","+Phase 5 is organized into 5 sub-phases matching the agent structure:","+1. Project Setup & Architecture","+2. Backend Development","+3. Frontend Development","+4. Testing & QA","+5. DevOps & Deployment"," "," ---"," "]},{"oldStart":143,"oldLines":8,"newStart":146,"newLines":8,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |","-| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |","+| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v7.0 | P0 | L | BA | DONE |","+| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v7.0) | P0 | M | BA | DONE |"," | 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |"," | 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |"," | 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |"]},{"oldStart":216,"oldLines":7,"newStart":219,"newLines":7,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |","+| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | DONE |"," | 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |"," | 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |"," | 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |"]},{"oldStart":232,"oldLines":10,"newStart":235,"newLines":10,"lines":[" "," | Agent | Responsibility | Key Files |"," |-------|---------------|-----------|","+| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |"," | **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |"," | **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |"," | **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |","-| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |"," | **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |"," "," ---"]},{"oldStart":244,"oldLines":9,"newStart":247,"newLines":9,"lines":[" "," | Document | Location | Purpose |"," |----------|----------|---------|","-| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |","-| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |","-| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |","+| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v7.0) |","+| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v7.0) |","+| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v7.0) |"," | Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |"," | Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |"," | Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |"]},{"oldStart":327,"oldLines":14,"newStart":330,"newLines":14,"lines":[" | **Frontend** | 12 | 0 | 2 | 9 | 1 |"," | **Tester** | 8 | 0 | 4 | 4 | 0 |"," | **DevOps** | 9 | 0 | 3 | 6 | 0 |","-| **TOTAL** | **50** (DONE: 2, TODO: 48) |","+| **TOTAL** | **50** (DONE: 3, TODO: 47) |"," "," ### Recommended Execution Order (Critical Path)"," "," **Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**"," 1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)"," 2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)","-3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)","+3. 5.5.1 (Fix cloudbuild.yaml — DONE)"," 4. 5.1.8 (Firestore migration strategy — enables schema evolution)"," "," **Sprint 10 (Weeks 19-20): Backend Features**"]},{"oldStart":389,"oldLines":7,"newStart":392,"newLines":7,"lines":["     -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)"," "," DevOps Chain:","-  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)","+  5.5.1 (cloudbuild fix — DONE) -> 5.5.2 (staging) -> 5.5.4 (monitoring)","     -> 5.5.5 (backups) -> 5.5.7 (custom domain)"," "," File/Data Chain:"]},{"oldStart":400,"oldLines":4,"newStart":403,"newLines":4,"lines":[" "," ---"," ","-**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**","+**Plan Version 7.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-26**"]}],"originalFile":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 2, TODO: 48) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n"},"sourceToolAssistantUUID":"233edbf1-f2b1-4312-a3c6-2971802527ad"}
{"parentUuid":"3bd99f3d-e280-4519-9747-23609aaa3493","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_012mhmo2byqPs7peZJnWoSRA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TYjQpb9LmZ5ZqisEb8P1N3","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"completed","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10029,"cache_read_input_tokens":129673,"output_tokens":304,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":10029,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLTjffn5TDp9Xs9BGEc","type":"assistant","uuid":"e73e368a-1057-47db-a1d2-858a9ab94f8a","timestamp":"2026-02-26T08:06:45.879Z"}
{"parentUuid":"e73e368a-1057-47db-a1d2-858a9ab94f8a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TYjQpb9LmZ5ZqisEb8P1N3","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"67a5a54f-d054-4859-a82b-598b61a034ea","timestamp":"2026-02-26T08:06:45.884Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"in_progress","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"completed","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"e73e368a-1057-47db-a1d2-858a9ab94f8a"}
{"parentUuid":"67a5a54f-d054-4859-a82b-598b61a034ea","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01HSwGTiBMKU55FnADf3bfZT","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update SESSION-HISTORY.md with this session's work:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":139702,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":346},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWLUP2EDTdzPs4rPLCHi","type":"assistant","uuid":"f8b2aa00-bdda-46a3-b9d2-03a2437004f8","timestamp":"2026-02-26T08:06:49.813Z"}
{"parentUuid":"f8b2aa00-bdda-46a3-b9d2-03a2437004f8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01HSwGTiBMKU55FnADf3bfZT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JeLhXCBdauk7KyfmznBd86","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","offset":560,"limit":15},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":346,"cache_read_input_tokens":139702,"output_tokens":123,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":346,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLUP2EDTdzPs4rPLCHi","type":"assistant","uuid":"fe3325fc-1a10-41d6-beb6-2da29f8b7e3d","timestamp":"2026-02-26T08:06:50.597Z"}
{"parentUuid":"fe3325fc-1a10-41d6-beb6-2da29f8b7e3d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JeLhXCBdauk7KyfmznBd86","type":"tool_result","content":"   560→- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n   561→- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n   562→- All documents validated against actual codebase (no stale references)\n   563→- Maintained backward compatibility with all existing task IDs\n   564→\n   565→### Pending Work:\n   566→- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n   567→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   568→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   569→- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n   570→"}]},"uuid":"c946f498-3dbf-4055-86c6-da0554d037b9","timestamp":"2026-02-26T08:06:50.621Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n- All documents validated against actual codebase (no stale references)\n- Maintained backward compatibility with all existing task IDs\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n","numLines":11,"startLine":560,"totalLines":570}},"sourceToolAssistantUUID":"fe3325fc-1a10-41d6-beb6-2da29f8b7e3d"}
{"parentUuid":"c946f498-3dbf-4055-86c6-da0554d037b9","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01SnoTixw1kAhZfhkMkzKUJg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CmoQgaR26wC3wDv5Ey6mvR","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","old_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14","new_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n\n---\n\n## Session 11 — 2026-02-26 (Business Analyst Session — Spec Refresh v7.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v6.0 -> v7.0)\n\nPerformed full project re-analysis with deep codebase exploration including:\n- All existing specification documents (Doc1, Doc2, Doc3 at root + docs/requirements/)\n- Full frontend architecture (30+ pages, 12 shared components, 4 services, 3 hooks)\n- Full backend architecture (16 route modules, 19 services, 5 middleware, 2 models)\n- Complete TypeScript type system (40+ domain types)\n- All 50+ API endpoints across 16 route modules\n- Firestore schemas, security rules, indexes (17 composite)\n- Package dependencies (exact versions from package.json files)\n- Docker multi-stage build, Cloud Build, deployment configuration\n- 10 previous session histories for context continuity\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v7.0) — Core product specification\n   - 14 comprehensive sections covering full product scope\n   - All 17 functional modules with route-level detail\n   - Complete Visual Drill-Down Explorer specification (7 levels + case detail)\n   - Full 5-persona system with AI focus areas per persona\n   - AI-native features: dynamic elements, action flow pattern, Yantra Assist,\n     augmented workflows, 5 signature interactions\n   - 8 predictive intelligence models documented\n   - 7 killer differentiators with algorithms and data sources\n   - Complete UI design language (colour palette, typography, components)\n   - Regulatory framework (RSH, Ombudsman, Awaab's Law, TSM, GDPR)\n   - Non-functional requirements with current metrics\n   - Simulated data profile (75 properties, 68 tenants, 279+ cases)\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v7.0) — Technical architecture\n   - Full system architecture with ASCII diagrams (high-level + request flow)\n   - Complete technology stack with exact version numbers from package.json\n   - Frontend architecture: component hierarchy, 19 page directories, state management\n   - Backend architecture: middleware pipeline (10-step), 16 route modules, 19 services\n   - Complete Firestore schemas for Property, Tenant, Case, ExternalDataCache\n   - API endpoint registry (50+ endpoints organised by module)\n   - External API integration layer (3 tiers, 25 integrations)\n   - Security architecture (auth, RBAC, transport, data, rate limiting)\n   - Deployment & infrastructure (Docker 3-stage, Cloud Run, CI/CD)\n   - Monitoring & observability (health, metrics, audit, Telegram)\n   - Accessibility implementation (WCAG 2.2 AA details)\n   - Phase 5 architecture targets (Vertex AI, WebSocket, Pub/Sub, SaaS)\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v7.0) — API & integration requirements\n   - 12 sections covering full integration landscape\n   - 6 guiding principles (GP-1 to GP-6) for API strategy\n   - Tier 1 (3 APIs): Police.uk, Open-Meteo, DEFRA — with full endpoint docs\n   - Tier 2 (6 APIs): Postcodes.io, UPRN, EPC, NOMIS/Census, Gas Safe, Electrical\n   - Tier 3 (9 mock services): DWP, IoT, GoCardless, Plentific, RSH, DocuSign,\n     Experian, Land Registry, NOMIS Extended\n   - 7 killer differentiator services with algorithms and factor weights\n   - GOV.UK Notify (24 templates, 7 categories, personalisation fields)\n   - Caching architecture (TTL policy table, cache strategy)\n   - Rate limiting strategy (internal 4-tier + external per-source)\n   - Error handling & fallback patterns\n   - Complete internal API endpoint registry (50+ endpoints by module)\n\n#### Updated EXECUTION-PLAN.md (v6.0 -> v7.0):\n\n- All phases 0-4 preserved with exact status\n- Phase 5 refreshed: 50 tasks (3 DONE, 47 TODO) — 5.5.1 now marked DONE\n- Plan status updated from \"TODO\" to \"IN PROGRESS\" (3/50)\n- Maintained all task descriptions, priorities, complexities, agent assignments\n- Sprint-by-sprint critical path preserved with dependency graph\n- Agent role table and communication section up to date\n- Metrics table with current vs target values\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (REWRITTEN — v6.0 -> v7.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (REWRITTEN — v6.0 -> v7.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (REWRITTEN — v6.0 -> v7.0)\n- `EXECUTION-PLAN.md` (UPDATED — v6.0 -> v7.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 11)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- v7.0 docs are comprehensive rewrites (not incremental updates) for maximum clarity\n- Doc1 now serves as single-source-of-truth for product specification (merged all AI-native\n  features from original Doc2 into main spec)\n- Doc2 covers complete technical architecture with exact versions and schemas\n- Doc3 covers all API/integration requirements with endpoint registry\n- Phase 5 progress updated: 5.1.1 + 5.1.2 (this session) + 5.5.1 (prior) = 3 DONE\n- Total Phase 5: 50 tasks (3 DONE, 47 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 at TODO status (47 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design)\n- Sprint 9 focus: Architecture decisions + backend foundation\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":140048,"output_tokens":1975,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":366,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLUgGJiRZr16CaLZPes","type":"assistant","uuid":"93e6d339-ed86-4658-b02d-20ddec93c397","timestamp":"2026-02-26T08:07:30.535Z"}
{"parentUuid":"93e6d339-ed86-4658-b02d-20ddec93c397","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CmoQgaR26wC3wDv5Ey6mvR","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md has been updated successfully."}]},"uuid":"1d4c4023-d214-4b2d-bdb8-ab23bf7d0eb8","timestamp":"2026-02-26T08:07:30.589Z","toolUseResult":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","oldString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14","newString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n\n---\n\n## Session 11 — 2026-02-26 (Business Analyst Session — Spec Refresh v7.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v6.0 -> v7.0)\n\nPerformed full project re-analysis with deep codebase exploration including:\n- All existing specification documents (Doc1, Doc2, Doc3 at root + docs/requirements/)\n- Full frontend architecture (30+ pages, 12 shared components, 4 services, 3 hooks)\n- Full backend architecture (16 route modules, 19 services, 5 middleware, 2 models)\n- Complete TypeScript type system (40+ domain types)\n- All 50+ API endpoints across 16 route modules\n- Firestore schemas, security rules, indexes (17 composite)\n- Package dependencies (exact versions from package.json files)\n- Docker multi-stage build, Cloud Build, deployment configuration\n- 10 previous session histories for context continuity\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v7.0) — Core product specification\n   - 14 comprehensive sections covering full product scope\n   - All 17 functional modules with route-level detail\n   - Complete Visual Drill-Down Explorer specification (7 levels + case detail)\n   - Full 5-persona system with AI focus areas per persona\n   - AI-native features: dynamic elements, action flow pattern, Yantra Assist,\n     augmented workflows, 5 signature interactions\n   - 8 predictive intelligence models documented\n   - 7 killer differentiators with algorithms and data sources\n   - Complete UI design language (colour palette, typography, components)\n   - Regulatory framework (RSH, Ombudsman, Awaab's Law, TSM, GDPR)\n   - Non-functional requirements with current metrics\n   - Simulated data profile (75 properties, 68 tenants, 279+ cases)\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v7.0) — Technical architecture\n   - Full system architecture with ASCII diagrams (high-level + request flow)\n   - Complete technology stack with exact version numbers from package.json\n   - Frontend architecture: component hierarchy, 19 page directories, state management\n   - Backend architecture: middleware pipeline (10-step), 16 route modules, 19 services\n   - Complete Firestore schemas for Property, Tenant, Case, ExternalDataCache\n   - API endpoint registry (50+ endpoints organised by module)\n   - External API integration layer (3 tiers, 25 integrations)\n   - Security architecture (auth, RBAC, transport, data, rate limiting)\n   - Deployment & infrastructure (Docker 3-stage, Cloud Run, CI/CD)\n   - Monitoring & observability (health, metrics, audit, Telegram)\n   - Accessibility implementation (WCAG 2.2 AA details)\n   - Phase 5 architecture targets (Vertex AI, WebSocket, Pub/Sub, SaaS)\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v7.0) — API & integration requirements\n   - 12 sections covering full integration landscape\n   - 6 guiding principles (GP-1 to GP-6) for API strategy\n   - Tier 1 (3 APIs): Police.uk, Open-Meteo, DEFRA — with full endpoint docs\n   - Tier 2 (6 APIs): Postcodes.io, UPRN, EPC, NOMIS/Census, Gas Safe, Electrical\n   - Tier 3 (9 mock services): DWP, IoT, GoCardless, Plentific, RSH, DocuSign,\n     Experian, Land Registry, NOMIS Extended\n   - 7 killer differentiator services with algorithms and factor weights\n   - GOV.UK Notify (24 templates, 7 categories, personalisation fields)\n   - Caching architecture (TTL policy table, cache strategy)\n   - Rate limiting strategy (internal 4-tier + external per-source)\n   - Error handling & fallback patterns\n   - Complete internal API endpoint registry (50+ endpoints by module)\n\n#### Updated EXECUTION-PLAN.md (v6.0 -> v7.0):\n\n- All phases 0-4 preserved with exact status\n- Phase 5 refreshed: 50 tasks (3 DONE, 47 TODO) — 5.5.1 now marked DONE\n- Plan status updated from \"TODO\" to \"IN PROGRESS\" (3/50)\n- Maintained all task descriptions, priorities, complexities, agent assignments\n- Sprint-by-sprint critical path preserved with dependency graph\n- Agent role table and communication section up to date\n- Metrics table with current vs target values\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (REWRITTEN — v6.0 -> v7.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (REWRITTEN — v6.0 -> v7.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (REWRITTEN — v6.0 -> v7.0)\n- `EXECUTION-PLAN.md` (UPDATED — v6.0 -> v7.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 11)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- v7.0 docs are comprehensive rewrites (not incremental updates) for maximum clarity\n- Doc1 now serves as single-source-of-truth for product specification (merged all AI-native\n  features from original Doc2 into main spec)\n- Doc2 covers complete technical architecture with exact versions and schemas\n- Doc3 covers all API/integration requirements with endpoint registry\n- Phase 5 progress updated: 5.1.1 + 5.1.2 (this session) + 5.5.1 (prior) = 3 DONE\n- Total Phase 5: 50 tasks (3 DONE, 47 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 at TODO status (47 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design)\n- Sprint 9 focus: Architecture decisions + backend foundation\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14","originalFile":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n\n---\n\n## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)\n\nPerformed full project re-analysis with deep codebase exploration (40 tool calls\nacross all 116+ TypeScript files) and updated all specification documents to v6.0.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification\n   - Refreshed and validated all 17 functional modules against codebase\n   - Updated Phase 5 task count to 50 (from 44)\n   - Confirmed all 7 AI differentiators implemented and documented\n   - Validated 5 persona definitions with AI focus areas\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture\n   - Validated all version numbers against package.json files\n   - Confirmed 50+ API endpoints across 16 route modules\n   - Validated all Firestore schemas against firestore-schemas.ts\n   - Confirmed 17 composite indexes and security rules\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements\n   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)\n   - 7 killer differentiator services fully specified with algorithms\n   - 24 GOV.UK Notify templates across 7 categories\n   - Cache TTL, rate limiting, and fallback strategies documented\n\n#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):\n\n- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):\n  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)\n  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)\n  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)\n  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)\n  - Added new dependency chains for File/Data workflows\n- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9\n- All doc version references updated to v6.0\n- Refreshed critical path execution order with new tasks\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)\n- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)\n- `SESSION-HISTORY.md` (UPDATED — added Session 10)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management\n- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n- All documents validated against actual codebase (no stale references)\n- Maintained backward compatibility with all existing task IDs\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14\n","structuredPatch":[{"oldStart":567,"oldLines":3,"newStart":567,"newLines":103,"lines":[" - Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)"," - Sprint 9 focus: Architecture decisions + backend foundation + CI fix"," - Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14","+","+---","+","+## Session 11 — 2026-02-26 (Business Analyst Session — Spec Refresh v7.0)","+**Working directory:** `/mnt/c/.netapps/socialhomes`","+**Agent:** Business Analyst Agent (Claude Opus 4.6)","+","+### What happened:","+","+#### Task: Comprehensive Specification Refresh (v6.0 -> v7.0)","+","+Performed full project re-analysis with deep codebase exploration including:","+- All existing specification documents (Doc1, Doc2, Doc3 at root + docs/requirements/)","+- Full frontend architecture (30+ pages, 12 shared components, 4 services, 3 hooks)","+- Full backend architecture (16 route modules, 19 services, 5 middleware, 2 models)","+- Complete TypeScript type system (40+ domain types)","+- All 50+ API endpoints across 16 route modules","+- Firestore schemas, security rules, indexes (17 composite)","+- Package dependencies (exact versions from package.json files)","+- Docker multi-stage build, Cloud Build, deployment configuration","+- 10 previous session histories for context continuity","+","+#### Updated 3 Specification Documents in `docs/requirements/`:","+","+1. **Doc1-socialhomes-Base-Specification.txt** (v7.0) — Core product specification","+   - 14 comprehensive sections covering full product scope","+   - All 17 functional modules with route-level detail","+   - Complete Visual Drill-Down Explorer specification (7 levels + case detail)","+   - Full 5-persona system with AI focus areas per persona","+   - AI-native features: dynamic elements, action flow pattern, Yantra Assist,","+     augmented workflows, 5 signature interactions","+   - 8 predictive intelligence models documented","+   - 7 killer differentiators with algorithms and data sources","+   - Complete UI design language (colour palette, typography, components)","+   - Regulatory framework (RSH, Ombudsman, Awaab's Law, TSM, GDPR)","+   - Non-functional requirements with current metrics","+   - Simulated data profile (75 properties, 68 tenants, 279+ cases)","+","+2. **Doc2-socialhomes-Technical-Architecture.txt** (v7.0) — Technical architecture","+   - Full system architecture with ASCII diagrams (high-level + request flow)","+   - Complete technology stack with exact version numbers from package.json","+   - Frontend architecture: component hierarchy, 19 page directories, state management","+   - Backend architecture: middleware pipeline (10-step), 16 route modules, 19 services","+   - Complete Firestore schemas for Property, Tenant, Case, ExternalDataCache","+   - API endpoint registry (50+ endpoints organised by module)","+   - External API integration layer (3 tiers, 25 integrations)","+   - Security architecture (auth, RBAC, transport, data, rate limiting)","+   - Deployment & infrastructure (Docker 3-stage, Cloud Run, CI/CD)","+   - Monitoring & observability (health, metrics, audit, Telegram)","+   - Accessibility implementation (WCAG 2.2 AA details)","+   - Phase 5 architecture targets (Vertex AI, WebSocket, Pub/Sub, SaaS)","+","+3. **Doc3-socialhomes-API-Requirements.txt** (v7.0) — API & integration requirements","+   - 12 sections covering full integration landscape","+   - 6 guiding principles (GP-1 to GP-6) for API strategy","+   - Tier 1 (3 APIs): Police.uk, Open-Meteo, DEFRA — with full endpoint docs","+   - Tier 2 (6 APIs): Postcodes.io, UPRN, EPC, NOMIS/Census, Gas Safe, Electrical","+   - Tier 3 (9 mock services): DWP, IoT, GoCardless, Plentific, RSH, DocuSign,","+     Experian, Land Registry, NOMIS Extended","+   - 7 killer differentiator services with algorithms and factor weights","+   - GOV.UK Notify (24 templates, 7 categories, personalisation fields)","+   - Caching architecture (TTL policy table, cache strategy)","+   - Rate limiting strategy (internal 4-tier + external per-source)","+   - Error handling & fallback patterns","+   - Complete internal API endpoint registry (50+ endpoints by module)","+","+#### Updated EXECUTION-PLAN.md (v6.0 -> v7.0):","+","+- All phases 0-4 preserved with exact status","+- Phase 5 refreshed: 50 tasks (3 DONE, 47 TODO) — 5.5.1 now marked DONE","+- Plan status updated from \"TODO\" to \"IN PROGRESS\" (3/50)","+- Maintained all task descriptions, priorities, complexities, agent assignments","+- Sprint-by-sprint critical path preserved with dependency graph","+- Agent role table and communication section up to date","+- Metrics table with current vs target values","+","+### Files Changed:","+- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (REWRITTEN — v6.0 -> v7.0)","+- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (REWRITTEN — v6.0 -> v7.0)","+- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (REWRITTEN — v6.0 -> v7.0)","+- `EXECUTION-PLAN.md` (UPDATED — v6.0 -> v7.0)","+- `SESSION-HISTORY.md` (UPDATED — added Session 11)","+","+### Commits:","+- (pending — awaiting user instruction to commit)","+","+### Decisions Taken:","+- v7.0 docs are comprehensive rewrites (not incremental updates) for maximum clarity","+- Doc1 now serves as single-source-of-truth for product specification (merged all AI-native","+  features from original Doc2 into main spec)","+- Doc2 covers complete technical architecture with exact versions and schemas","+- Doc3 covers all API/integration requirements with endpoint registry","+- Phase 5 progress updated: 5.1.1 + 5.1.2 (this session) + 5.5.1 (prior) = 3 DONE","+- Total Phase 5: 50 tasks (3 DONE, 47 TODO)","+","+### Pending Work:","+- Phase 5 tasks 5.1.3–5.5.9 at TODO status (47 remaining tasks)","+- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design)","+- Sprint 9 focus: Architecture decisions + backend foundation","+- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"93e6d339-ed86-4658-b02d-20ddec93c397"}
{"parentUuid":"1d4c4023-d214-4b2d-bdb8-ab23bf7d0eb8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01QMj9zVCwty4A2SVXuRgAL2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VZJVH3PiuvFzj7Zhzdf4Sp","name":"TodoWrite","input":{"todos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"completed","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"completed","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2032,"cache_read_input_tokens":140414,"output_tokens":302,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":2032,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLXdEaU4U1R8Mk8o7qN","type":"assistant","uuid":"0de00268-45bd-4281-bd2c-c9f8e5bc7561","timestamp":"2026-02-26T08:07:35.182Z"}
{"parentUuid":"0de00268-45bd-4281-bd2c-c9f8e5bc7561","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VZJVH3PiuvFzj7Zhzdf4Sp","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"da7c1252-5d8b-4051-a201-54c0a63098b7","timestamp":"2026-02-26T08:07:35.185Z","toolUseResult":{"oldTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"completed","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Explore project structure and read existing docs","status":"completed","activeForm":"Exploring project structure and reading existing docs"},{"content":"Create Doc1 - Base Specification (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc1 - Base Specification v7.0"},{"content":"Create Doc2 - Technical Architecture (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc2 - Technical Architecture v7.0"},{"content":"Create Doc3 - API Requirements (v7.0 comprehensive refresh)","status":"completed","activeForm":"Creating Doc3 - API Requirements v7.0"},{"content":"Create EXECUTION-PLAN.md with all 5 phases (v7.0)","status":"completed","activeForm":"Creating EXECUTION-PLAN.md v7.0"},{"content":"Update SESSION-HISTORY.md","status":"completed","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"0de00268-45bd-4281-bd2c-c9f8e5bc7561"}
{"parentUuid":"da7c1252-5d8b-4051-a201-54c0a63098b7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01APkRwyJbSkxm6gBqZQ2WNa","type":"message","role":"assistant","content":[{"type":"text","text":"Let me verify all files were written correctly:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":344,"cache_read_input_tokens":142446,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":344},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWLY1ivkrH67xi9eZn5K","type":"assistant","uuid":"b3cfd883-d3b1-4707-976e-8cb055875001","timestamp":"2026-02-26T08:07:38.941Z"}
{"parentUuid":"b3cfd883-d3b1-4707-976e-8cb055875001","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01APkRwyJbSkxm6gBqZQ2WNa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LZn2hUuhcMfkMGShzz1EYa","name":"Bash","input":{"command":"wc -l /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt /mnt/c/.REDACTED.md /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","description":"Count lines in all updated files"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":344,"cache_read_input_tokens":142446,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":344},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWLY1ivkrH67xi9eZn5K","type":"assistant","uuid":"fb641a0d-fe5d-4ed9-9e30-97781cca6b34","timestamp":"2026-02-26T08:07:40.686Z"}
{"parentUuid":"fb641a0d-fe5d-4ed9-9e30-97781cca6b34","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LZn2hUuhcMfkMGShzz1EYa","type":"tool_result","content":"   935 /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt\n   935 /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt\n   789 /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt\n   406 /mnt/c/.REDACTED.md\n   669 /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md\n  3734 total","is_error":false}]},"uuid":"453a8ad8-d26d-4077-a23a-a3817ac4507a","timestamp":"2026-02-26T08:07:40.870Z","toolUseResult":{"stdout":"   935 /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt\n   935 /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt\n   789 /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt\n   406 /mnt/c/.REDACTED.md\n   669 /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md\n  3734 total","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"fb641a0d-fe5d-4ed9-9e30-97781cca6b34"}
{"parentUuid":"453a8ad8-d26d-4077-a23a-a3817ac4507a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01APkRwyJbSkxm6gBqZQ2WNa","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0193hct7dpSLRpgJBac3u8gQ","name":"Bash","input":{"command":"ls -lh /mnt/c/.netapps/socialhomes/docs/requirements/","description":"Check file sizes in docs/requirements"},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":344,"cache_read_input_tokens":142446,"output_tokens":298,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":344,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLY1ivkrH67xi9eZn5K","type":"assistant","uuid":"44139f2f-8fc5-42d2-a2ef-4f5eaa11b34d","timestamp":"2026-02-26T08:07:41.466Z"}
{"parentUuid":"44139f2f-8fc5-42d2-a2ef-4f5eaa11b34d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0193hct7dpSLRpgJBac3u8gQ","type":"tool_result","content":"total 120K\n-rwxrwxrwx 1 rajiv rajiv 43K Feb 26 07:56 Doc1-socialhomes-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 42K Feb 26 08:00 Doc2-socialhomes-Technical-Architecture.txt\n-rwxrwxrwx 1 rajiv rajiv 31K Feb 26 08:03 Doc3-socialhomes-API-Requirements.txt","is_error":false}]},"uuid":"63ef473b-bc3a-47d6-a8e5-8b1bc8d4c1c6","timestamp":"2026-02-26T08:07:41.572Z","toolUseResult":{"stdout":"total 120K\n-rwxrwxrwx 1 rajiv rajiv 43K Feb 26 07:56 Doc1-socialhomes-Base-Specification.txt\n-rwxrwxrwx 1 rajiv rajiv 42K Feb 26 08:00 Doc2-socialhomes-Technical-Architecture.txt\n-rwxrwxrwx 1 rajiv rajiv 31K Feb 26 08:03 Doc3-socialhomes-API-Requirements.txt","stderr":"","interrupted":false,"isImage":false,"noOutputExpected":false},"sourceToolAssistantUUID":"44139f2f-8fc5-42d2-a2ef-4f5eaa11b34d"}
{"parentUuid":"63ef473b-bc3a-47d6-a8e5-8b1bc8d4c1c6","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_017qC37ia2mEi7AAMcV1TDY5","type":"message","role":"assistant","content":[{"type":"text","text":"All files created successfully. Let me send a notification:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":142790,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":641},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYWLYSAqvLfB1hBmRWq4m","type":"assistant","uuid":"921b18df-6fd0-4a89-b1db-91ed152a30b3","timestamp":"2026-02-26T08:07:44.776Z"}
{"parentUuid":"921b18df-6fd0-4a89-b1db-91ed152a30b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_017qC37ia2mEi7AAMcV1TDY5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014B3RAtUSCmVCuHEpDVjjfa","name":"mcp__telegram__notify_user","input":{"message":"✅ BA Agent — Spec Refresh v7.0 Complete\n\n📄 3 specification documents updated in docs/requirements/:\n• Doc1 (43KB, 935 lines) — Base Specification\n• Doc2 (42KB, 935 lines) — Technical Architecture\n• Doc3 (31KB, 789 lines) — API Requirements\n\n📋 EXECUTION-PLAN.md updated (v7.0, 406 lines)\n• Phases 0-4: DONE (61/67 tasks)\n• Phase 5: IN PROGRESS (3/50 tasks)\n• 47 remaining tasks across 5 sub-phases\n\n📝 SESSION-HISTORY.md updated (Session 11)\n\nReady for commit when you're ready."},"caller":{"type":"direct"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":641,"cache_read_input_tokens":142790,"output_tokens":246,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":641,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLYSAqvLfB1hBmRWq4m","type":"assistant","uuid":"3cdf1622-2a0a-4cca-aded-bf800a622ec5","timestamp":"2026-02-26T08:07:48.296Z"}
{"parentUuid":"3cdf1622-2a0a-4cca-aded-bf800a622ec5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014B3RAtUSCmVCuHEpDVjjfa","type":"tool_result","content":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Spec Refresh v7.0 Complete\n\n📄 3 specification documents updated in docs/requirements/:\n• Doc1 (43KB, 935 lines) — Base Specification\n• Doc2 (42KB, 935 lines) — Technical Architecture\n• Doc3 (31KB, 789 lines) — API Requirements\n\n📋 EXECUTION-PLAN.md updated (v7.0, 406 lines)\n• Phases 0-4: DONE (61/67 tasks)\n• Phase 5: IN PROGRESS (3/50 tasks)\n• 47 remaining tasks across 5 sub-phases\n\n📝 SESSION-HISTORY.md updated (Session 11)\n\nReady for commit when you're ready.\""}]}]},"uuid":"e1ef9fe2-f92d-48a4-88bc-477e7f8394ff","timestamp":"2026-02-26T08:07:49.533Z","toolUseResult":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Spec Refresh v7.0 Complete\n\n📄 3 specification documents updated in docs/requirements/:\n• Doc1 (43KB, 935 lines) — Base Specification\n• Doc2 (42KB, 935 lines) — Technical Architecture\n• Doc3 (31KB, 789 lines) — API Requirements\n\n📋 EXECUTION-PLAN.md updated (v7.0, 406 lines)\n• Phases 0-4: DONE (61/67 tasks)\n• Phase 5: IN PROGRESS (3/50 tasks)\n• 47 remaining tasks across 5 sub-phases\n\n📝 SESSION-HISTORY.md updated (Session 11)\n\nReady for commit when you're ready.\""}],"sourceToolAssistantUUID":"3cdf1622-2a0a-4cca-aded-bf800a622ec5"}
{"parentUuid":"e1ef9fe2-f92d-48a4-88bc-477e7f8394ff","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"03fde433-c592-4f3e-8fc9-24fc3d31e5e1","version":"2.1.59","gitBranch":"main","slug":"iterative-growing-cook","message":{"model":"claude-opus-4-6","id":"msg_01G5rmcBs4Gh3Jc5pvpHTtkz","type":"message","role":"assistant","content":[{"type":"text","text":"All tasks are complete. Here's a summary of everything delivered:\n\n---\n\n## ✅ Business Analyst Session Complete — v7.0 Specification Refresh\n\n### Documents Created/Updated in `docs/requirements/`:\n\n**Doc1 — Base Specification** (43KB, 935 lines)\n- 14 sections covering the full product scope\n- All 17 functional modules with routes and features\n- Complete Visual Drill-Down Explorer (7 hierarchy levels)\n- 5-persona system with AI focus areas\n- AI-native features: dynamic elements, action flow, Yantra Assist, 5 signature interactions\n- 8 predictive intelligence models + 7 killer differentiators\n- Full UI design language (colours, typography, components)\n- Regulatory framework (RSH, Ombudsman, Awaab's Law, TSM, GDPR)\n- Simulated data profile (75 properties, 68 tenants, 279+ cases)\n\n**Doc2 — Technical Architecture** (42KB, 935 lines)\n- System architecture with ASCII diagrams\n- Complete tech stack with exact versions from package.json\n- Frontend architecture: 30+ pages, 12 shared components, hooks, state management\n- Backend architecture: 10-step middleware pipeline, 16 route modules, 19 services\n- Firestore schemas (Property, Tenant, Case, ExternalDataCache), 17 indexes, security rules\n- 50+ API endpoints organized by module\n- External API integration (25 integrations across 3 tiers)\n- Security, deployment (Docker 3-stage, Cloud Run), monitoring\n\n**Doc3 — API Requirements** (31KB, 789 lines)\n- 12 sections covering the full integration landscape\n- Tier 1 (3 live), Tier 2 (6 live), Tier 3 (9 mock) APIs fully documented\n- 7 differentiator services with algorithms and weights\n- GOV.UK Notify (24 templates, 7 categories)\n- Caching architecture, rate limiting, error handling\n- Complete endpoint registry (50+ endpoints)\n\n### EXECUTION-PLAN.md (v7.0, 406 lines)\n- **Phases 0–4**: DONE (61 of 67 tasks completed, 6 deferred)\n- **Phase 5: Evolution** — 50 tasks across 5 sub-phases:\n  - 5.1 Setup & Architecture: 9 tasks (2 DONE, 7 TODO)\n  - 5.2 Backend: 16 tasks (all TODO)\n  - 5.3 Frontend: 12 tasks (all TODO)\n  - 5.4 Testing: 8 tasks (all TODO)\n  - 5.5 DevOps: 9 tasks (1 DONE, 8 TODO)\n- Sprint-by-sprint critical path with dependency graph\n- Agent assignments, priority/complexity ratings, metrics targets"}],"stop_reason":"end_turn","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":441,"cache_read_input_tokens":143431,"output_tokens":692,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":441,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"requestId":"req_011CYWLZ26XdZot7qL4M57Co","type":"assistant","uuid":"34b50442-18da-447f-aade-173d8c940373","timestamp":"2026-02-26T08:08:00.664Z"}
