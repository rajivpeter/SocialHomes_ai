{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-23T18:22:51.813Z","sessionId":"04e29004-abee-469c-be92-00aa04948dea","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-23T18:22:51.815Z","sessionId":"04e29004-abee-469c-be92-00aa04948dea"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"c2a98588-5064-456d-acbc-86361ceaab5c","toolUseID":"c2a98588-5064-456d-acbc-86361ceaab5c","timestamp":"2026-02-23T18:22:51.004Z","uuid":"238e7111-6ad0-4fad-bc72-cac881821958"}
{"parentUuid":"238e7111-6ad0-4fad-bc72-cac881821958","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"aa4580bf-020b-48a8-99b2-cbf19d6c2288","timestamp":"2026-02-23T18:22:51.851Z","permissionMode":"bypassPermissions"}
{"parentUuid":"aa4580bf-020b-48a8-99b2-cbf19d6c2288","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_019uL5nmR9yFiWVQQwWVBh84","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me start by understanding the existing project structure, reading any existing documentation, and then creating the comprehensive specification documents and execution plan.","signature":"EtoCCkYICxgCKkBYjJzAWctlEgYp64Giw6QFIr7qKIoOQ+WWqGfGOWrsAaVs1Kb+qyiIf5zK/dHuJIuJQY9bSVRtVNbOVQf8EJrDEgwu5gcOgg2SsY9IYJQaDLI5xD6I5lWde+zyCCIwZ9NmuPn4Eqc3G0zKAiXOdK3FIDPm4VqCx+3IIka/Ftrb2F3fGrN0v/UBOaD4OixvKsEBshzj0TqKu3QOmZnSiGHIKvCJMq97UzODKYxeJ6bPfWYWgGUMG6Xk0o6i2eGJ91IXuPS47iLZonT3LohPQDsgGYMtJ2MWb89UtMMjO7SfJcaMPp+msP5osEg5xQOgLTKCatRKMm/aMRvWmX69MlQnWL0VRBdSKKOYRE/4WFtmIJRUS+Vonvc49fDjt0r/c5zxm2tMHY8hSu7rxeYXRLVWQs+V+Me4BOyK8Pkn7ps8U5ULdKeQxVt86razrn1JJfshgBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4371,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRUjfAuZKc5MMsCPXXie","type":"assistant","uuid":"3df8a84b-e385-4147-84ac-ffaaf9511544","timestamp":"2026-02-23T18:32:12.953Z"}
{"parentUuid":"3df8a84b-e385-4147-84ac-ffaaf9511544","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_019uL5nmR9yFiWVQQwWVBh84","type":"message","role":"assistant","content":[{"type":"text","text":"I'll start by exploring the project structure and reading all existing documentation to understand the current state before creating the specification documents."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4371,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRUjfAuZKc5MMsCPXXie","type":"assistant","uuid":"8afc7068-ce9d-421e-8e19-6c8869d05ea4","timestamp":"2026-02-23T18:32:13.573Z"}
{"parentUuid":"8afc7068-ce9d-421e-8e19-6c8869d05ea4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_019uL5nmR9yFiWVQQwWVBh84","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0198tjANhxU9V3oVfTy4Rkxy","name":"Task","input":{"subagent_type":"Explore","description":"Explore socialhomes project structure","prompt":"Very thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all top-level dirs and key subdirectories)\n2. All existing documentation files (*.md, *.txt, docs/*)\n3. Package.json files (root, app/, server/)\n4. Key configuration files (tsconfig, vite config, docker files, cloud build, etc.)\n5. The app/src/ structure - pages, components, routes, hooks, data\n6. The server/src/ structure - routes, models, middleware, services\n7. Any existing specification docs (Doc1, Doc2, Doc3 mentioned in CLAUDE.md)\n8. SESSION-HISTORY.md, EXECUTION-PLAN.md, DEV-FIX-LIST.md\n9. Firebase/Firestore configuration\n10. Any .env.example or environment config patterns\n\nBe very thorough - read the contents of all documentation files, package.json files, and key source files to understand what this application does, its tech stack, and current state of development."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4371,"cache_read_input_tokens":14300,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4371},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRUjfAuZKc5MMsCPXXie","type":"assistant","uuid":"46580fb6-ac17-4799-9338-95cc00bb7f36","timestamp":"2026-02-23T18:32:19.910Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-23T18:35:27.727Z","sessionId":"04e29004-abee-469c-be92-00aa04948dea","content":"{\"task_id\":\"a406a2f4626ee1fc9\",\"tool_use_id\":\"toolu_0198tjANhxU9V3oVfTy4Rkxy\",\"description\":\"Explore socialhomes project structure\",\"task_type\":\"local_agent\"}"}
{"parentUuid":"46580fb6-ac17-4799-9338-95cc00bb7f36","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0198tjANhxU9V3oVfTy4Rkxy","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have a comprehensive understanding. Let me create the detailed exploration report:\n\n---\n\n## COMPREHENSIVE EXPLORATION: SocialHomes.Ai Project\n\nI've completed a thorough exploration of the SocialHomes.Ai project. Here's the complete breakdown:\n\n---\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native social housing management platform designed for UK housing associations and local authorities managing 5,000-20,000 units. It's built as a modern, dark-themed Bloomberg Terminal-style application rather than a traditional government form interface.\n\n**Current Status:** Production-ready on Google Cloud Run (europe-west2)\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Test Pass Rate:** 99.7% (330/331 tests passing)\n- **Codebase:** 23,852 lines of code\n- **Phase Status:** Phases 0-4 complete (Intelligence, Enrichment, Completion); Phase 5 (Evolution) pending\n\n---\n\n### 2. DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                           # React 19 frontend (Vite)\n│   ├── src/\n│   │   ├── pages/                 # 19 page directories\n│   │   │   ├── admin/             # Admin dashboard + integrations\n│   │   │   ├── ai-centre/         # AI predictions & insights\n│   │   │   ├── allocations/       # Housing allocations\n│   │   │   ├── asb/               # Anti-Social Behaviour cases\n│   │   │   ├── auth/              # Firebase authentication\n│   │   │   ├── briefing/          # Daily briefing + neighbourhood intelligence\n│   │   │   ├── communications/    # Email/message management\n│   │   │   ├── complaints/        # Complaint tracking & escalation\n│   │   │   ├── compliance/        # Regulatory compliance (Big 6)\n│   │   │   ├── dashboard/         # KPI dashboard\n│   │   │   ├── explore/           # Interactive map (Leaflet)\n│   │   │   ├── properties/        # Property detail & management\n│   │   │   ├── rent/              # Rent & income tracking\n│   │   │   ├── repairs/           # Repair case management\n│   │   │   ├── reports/           # Dynamic reports (27 types)\n│   │   │   ├── search/            # Global search\n│   │   │   ├── tenancies/         # Tenant management\n│   │   │   └── tenant-portal/     # Self-service portal\n│   │   ├── components/\n│   │   │   ├── layout/            # Header, Sidebar, Breadcrumbs, Layout, YantraAssist\n│   │   │   └── shared/            # Reusable UI components\n│   │   │       ├── ActionModal\n│   │   │       ├── AiActionCard\n│   │   │       ├── BenefitsPanel\n│   │   │       ├── CountdownTimer\n│   │   │       ├── DampIntelligencePanel\n│   │   │       ├── HelpDrawer\n│   │   │       ├── KpiCard\n│   │   │       ├── NeighbourhoodBriefingPanel\n│   │   │       ├── PropertyMap\n│   │   │       ├── VulnerabilityPanel\n│   │   │       └── StatusPill\n│   │   ├── services/\n│   │   │   ├── api-client.ts      # API client with 50+ endpoints\n│   │   │   ├── firebase.ts        # Firebase SDK configuration\n│   │   │   ├── ai-drafting.ts     # AI communication drafting\n│   │   │   └── public-data.ts     # Public data caching\n│   │   ├── hooks/                 # React hooks\n│   │   │   ├── useApi.ts          # 23 custom API hooks (React Query)\n│   │   │   ├── useEntityIntelligence.ts\n│   │   │   └── usePersonaScope.ts\n│   │   ├── data/                  # Static/seed data\n│   │   ├── contexts/              # React contexts (Auth, App)\n│   │   ├── types/                 # TypeScript type definitions\n│   │   └── utils/                 # Formatting utilities\n│   ├── package.json\n│   ├── tsconfig.json\n│   ├── vite.config.ts\n│   └── dist/                      # Built output\n│\n├── server/                        # Express.js backend\n│   ├── src/\n│   │   ├── routes/                # 13 API route modules\n│   │   │   ├── properties.ts      # Property CRUD\n│   │   │   ├── tenants.ts         # Tenant CRUD\n│   │   │   ├── cases.ts           # Case management (unified)\n│   │   │   ├── ai.ts              # AI services (7 differentiators + mock APIs)\n│   │   │   ├── admin.ts           # Admin endpoints\n│   │   │   ├── explore.ts         # Hierarchy navigation\n│   │   │   ├── briefing.ts        # Neighbourhood briefing\n│   │   │   ├── compliance.ts      # Regulatory compliance\n│   │   │   ├── rent.ts            # Rent/income tracking\n│   │   │   ├── reports.ts         # Report generation\n│   │   │   ├── public-data.ts     # Public APIs (Census, NOMIS, Gas Safe, etc.)\n│   │   │   ├── auth.ts            # Authentication\n│   │   │   ├── lettings.ts        # Lettings/allocations\n│   │   │   └── booking.ts         # Viewing bookings\n│   │   ├── services/              # 25 service modules\n│   │   │   ├── external-api.ts    # Shared caching & rate limiting\n│   │   │   ├── firestore.ts       # Firestore wrapper\n│   │   │   ├── firebase-admin.ts  # Firebase Admin SDK\n│   │   │   ├── damp-prediction.ts # Damp intelligence (5-factor weighted)\n│   │   │   ├── crime-context.ts   # Crime/ASB correlation\n│   │   │   ├── vulnerability-detection.ts # 7-factor vulnerability scoring\n│   │   │   ├── benefits-engine.ts # UK benefit rules (UC, PIP, AA, etc.)\n│   │   │   ├── property-passport.ts # Multi-source property dossier\n│   │   │   ├── neighbourhood-briefing.ts # Estate intelligence\n│   │   │   ├── mock-services.ts   # Tier 3 mock APIs (5 major integrations)\n│   │   │   ├── govuk-notify.ts    # 24 notification templates (7 categories)\n│   │   │   ├── census-nomis.ts    # Census 2021 + labour market data\n│   │   │   ├── monitoring.ts      # Metrics & health checks\n│   │   │   ├── seed.ts & seed-data.ts # Data seeding\n│   │   │   ├── hact-export.ts     # Housing HACT code exports\n│   │   │   └── Test files (4 integration tests)\n│   │   ├── middleware/            # 5 middleware modules\n│   │   │   ├── auth.ts            # JWT + X-Persona fallback\n│   │   │   ├── error-handler.ts   # Structured error logging\n│   │   │   ├── rate-limiter.ts    # 4-tier sliding window\n│   │   │   ├── metrics.ts         # Request tracking\n│   │   │   └── rbac.ts            # Role-based access control\n│   │   ├── models/\n│   │   │   ├── firestore-schemas.ts # Firestore document interfaces\n│   │   │   └── hact-codes.ts      # Housing code definitions\n│   │   ├── scripts/\n│   │   │   └── seed-imd.ts        # IMD data seeding\n│   │   └── index.ts               # Express app entry point\n│   ├── package.json\n│   ├── tsconfig.json\n│   └── dist/                      # Built output\n│\n├── .git/                          # Git repository with Entire.io checkpoints\n├── .entire/                       # Entire.io session metadata\n├── .mission-control/              # Mission Control integration files\n├── tests/                         # Selenium E2E test suites\n├── docs/                          # Additional documentation\n│   └── requirements/              # Latest specification documents (3 Docs)\n├── cloudbuild.yaml               # Cloud Build CI/CD pipeline\n├── Dockerfile                    # Multi-stage Docker build\n├── firestore.rules               # Security rules (15 collections)\n├── firestore.indexes.json        # Firestore composite indexes (16 indexes)\n├── Doc1-SocialHomesAi-Base-Specification.txt (481 lines)\n├── Doc2-SocialHomesAi-AI-Native-Features.txt (470 lines)\n├── Doc3-Public-API-Integration-Requirements.txt (2,333 lines)\n├── Doc4-UI-UX-Audit-Build-Guide.md\n├── CLAUDE.md                     # Claude Code project instructions\n├── SESSION-HISTORY.md            # Persistent conversation log\n├── EXECUTION-PLAN.md             # Multi-agent orchestration plan (v2.0)\n├── DEV-FIX-LIST.md              # Bug/warning tracker\n├── DEVOPS.md                     # DevOps & deployment guide (952 lines)\n└── README.md\n```\n\n---\n\n### 3. TECHNOLOGY STACK\n\n#### Frontend (React 19 + Vite)\n- **Framework:** React 19.2.0 with hooks & functional components\n- **Build Tool:** Vite 7.2.4\n- **Styling:** Tailwind CSS 4.1.18 (dark theme, brand-teal primary)\n- **Routing:** React Router v6\n- **State Management:** React Context + useReducer (no Redux)\n- **Data Fetching:** TanStack React Query 5.90.20\n- **Maps:** Leaflet 1.9.4 + React Leaflet 5.0.0 (OpenStreetMap)\n- **Charts:** Recharts 3.7.0, D3.js 7.9.0\n- **3D Visualization:** Three.js 0.182.0 + React Three Fiber\n- **Icons:** Lucide React 0.563.0\n- **Forms:** Uncontrolled (react-hook-form style)\n- **Animation:** CSS transitions & keyframes throughout\n- **Language:** TypeScript 5.9.3 with strict mode\n\n#### Backend (Express.js + Node.js)\n- **Framework:** Express.js 4.21.2\n- **Runtime:** Node.js 20.17.0\n- **Language:** TypeScript 5.7.0\n- **Database:** Google Firestore\n- **Firebase:** Firebase Admin SDK 13.6.1\n- **Middleware:**\n  - Helmet 8.1.0 (security headers + CSP)\n  - CORS 2.8.5 (restricted origins)\n  - Morgan 1.10.0 (logging)\n  - Compression 1.8.0 (gzip)\n- **Authentication:** Firebase JWT + custom X-Persona header\n- **Rate Limiting:** Custom sliding window (4 tiers)\n- **Metrics:** Custom monitoring service\n- **Testing:** Vitest 4.0.18\n\n#### Database & Infrastructure\n- **Primary DB:** Google Firestore (real-time, cloud-native)\n- **Collections:** 15 (properties, tenants, cases, communications, rentTransactions, users, auditLog, hactCodes, notifications, voidProperties, applicants, tsmMeasures, externalDataCache, activities, organisations)\n- **Indexes:** 16 composite indexes for query optimization\n- **Security:** Firestore security rules with persona-based RBAC\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** Cloud Build (git push → build → deploy)\n- **Container:** Docker multi-stage build (node:20-slim)\n- **Secrets:** Google Secret Manager (4 secrets)\n\n#### External APIs (Tier 1 & 2)\n- **Tier 1 (Free):**\n  - postcodes.io (postcode lookup)\n  - uprn.uk (UPRN data)\n  - data.police.uk (street-level crime & ASB)\n  - Open-Meteo API (weather & flood)\n  - DEFRA Flood Risk API\n  - ONS IMD data (Index of Multiple Deprivation)\n  \n- **Tier 2 (Registration):**\n  - GOV.UK Notify (email/SMS - 24 templates)\n  - Census 2021 (via NOMIS)\n  - NOMIS Labour Market Stats\n  - Gas Safe Register\n  - Electrical Safety Register\n\n- **Tier 3 (Mocked):**\n  - DWP Universal Credit verification\n  - IoT sensors (Switchee/Aico)\n  - GoCardless/Allpay payments\n  - Plentific/Fixflo repairs marketplace\n  - RSH/CORE regulatory submissions\n  - DocuSign digital signing\n  - Experian/TransUnion referencing\n  - Land Registry data\n\n---\n\n### 4. KEY FEATURES & MODULES\n\n#### Core Modules (14 main routes)\n1. **Dashboard** — KPI overview (Properties, Tenancies, Repairs, Compliance, Arrears, Void)\n2. **Briefing** — Personalized AI alerts, action items, neighbourhood intelligence\n3. **Properties** — 75 properties with map, EPC, compliance, damp risk scoring\n4. **Tenancies** — 68 tenants with arrears tracking, UC status, vulnerability flags\n5. **Repairs** — 200+ cases with workflow, SLA tracking, contractor management\n6. **Complaints** — 34 complaints with timeline, ombudsman tracking, deadlines\n7. **ASB (Anti-Social Behaviour)** — 12 cases with crime context correlation\n8. **Rent & Income** — Financial tracking, UC integration, payment arrangements\n9. **Compliance** — Big 6 checks (Gas Safety, EICR, Fire Risk, Asbestos, Legionella, Lifts), Awaab's Law\n10. **Communications** — Message management, template library, bulk send\n11. **Reports** — 27 dynamic report types (HACT, stock condition, TSM, etc.)\n12. **AI Centre** — Predictions, insights, differentiators hub, vulnerability scan\n13. **Admin** — 20 integration management dashboard, user management\n14. **Explore** — Interactive map with crime/damp/compliance layers\n\n#### 7 Killer Differentiators (Phase 2)\n1. **Predictive Damp Intelligence** — 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10)\n2. **Live Crime Context for ASB** — Police data correlation with internal ASB cases\n3. **Automatic Vulnerability Detection** — 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Benefits Entitlement Engine** — UK 2025/26 benefit rules analysis\n5. **Property Passport** — Multi-source property dossier aggregation\n6. **AI Neighbourhood Briefing** — Per-estate daily intelligence combining all data sources\n7. **Dynamic AI Interface Elements** — Context-aware buttons, fields, actions on entity pages\n\n#### AI-Native Features\n- **YantraAssist** — Contextual AI assistant (chat panel with streaming responses)\n- **Dynamic Action Cards** — AI-generated buttons based on entity context\n- **Predictive Alerts** — Vulnerability scoring, SLA breaches, compliance expirations\n- **AI Communication Drafting** — Pre-drafted emails with personalization\n- **AI Action Recommendations** — Context-aware next steps for each entity\n- **Batch Intelligence Scanning** — Vulnerability scan across all tenants\n\n#### Accessibility & Compliance\n- **WCAG AA Compliant** — Focus traps, skip links, ARIA labels, screen reader support\n- **Dark Theme Default** — Yantra.Works brand colours (teal, peach, garnet)\n- **Awaab's Law Tracking** — Damp & mould emergency timers with colour transitions\n- **Mobile Responsive** — Dashboard renders on mobile viewports\n- **Pre-Action Protocol** — Formal eviction process enforcement\n\n---\n\n### 5. PERSONAS & RBAC\n\n5 persona levels with graduated permissions:\n1. **COO** — Organisation-wide view, admin functions, approve policies\n2. **Head of Service** — Regional oversight, budget control, compliance reporting\n3. **Housing Manager** — Estate/block management, case assignment, contractor management\n4. **Housing Officer** — Frontline casework, tenant interaction, case logging\n5. **Repairs Operative** — Job-level repairs, appointment scheduling\n\nFirestore rules enforce persona-based access control for all collections.\n\n---\n\n### 6. API STRUCTURE (50+ Endpoints)\n\n#### Authentication Routes (`/api/v1/auth`)\n- POST `/login` — Firebase email login\n- POST `/login-google` — Google OAuth login\n- POST `/logout` — Logout\n- GET `/me` — Current user info\n\n#### Property Routes (`/api/v1/properties`)\n- GET `/` — List with filters (regionId, estateId, type, isVoid, limit)\n- GET `/available` — Void properties\n- GET `/:id` — Property detail\n- PATCH `/:id` — Update property\n\n#### Tenant Routes (`/api/v1/tenants`)\n- GET `/` — List with filters\n- GET `/:id` — Tenant detail\n- GET `/:id/activities` — Activity timeline\n- GET `/:id/cases` — Associated cases\n- PATCH `/:id` — Update tenant\n\n#### Case Routes (`/api/v1/cases`)\n- GET `/` — List with type/status filters & pagination\n- GET `/:id` — Case detail\n- POST `/` — Create case\n- PATCH `/:id` — Update case\n- GET `/:id/activities` — Case timeline\n\n#### Convenience Aliases\n- GET `/api/v1/repairs` — All repairs (type=='repair')\n- GET `/api/v1/complaints` — All complaints (type=='complaint')\n\n#### Explore Routes (`/api/v1/explore`)\n- GET `/hierarchy` — Geography drill-down\n- GET `/regions` — All regions\n- GET `/local-authorities/:id`\n- GET `/estates/:id`\n- GET `/blocks/:id`\n\n#### Briefing Routes (`/api/v1/briefing`)\n- GET `/:estateId` — Daily estate briefing\n\n#### Compliance Routes (`/api/v1/compliance`)\n- GET `/` — Big 6 summary\n- GET `/:type` — Compliance by type (gas, electrical, fire, asbestos, legionella, lifts)\n\n#### Rent Routes (`/api/v1/rent`)\n- GET `/` — Rent summary\n- GET `/transactions/:tenantId` — Payment history\n- GET `/arrears` — High-risk tenants\n\n#### Reports Routes (`/api/v1/reports`)\n- GET `/` — Available reports (27 types)\n- GET `/:type` — Generate report\n\n#### AI Routes (`/api/v1/ai`)\n- GET `/damp-risk/:propertyId` — Damp score\n- GET `/crime-context/:estateId` — Crime stats\n- GET `/vulnerability/:tenantId` — 7-factor assessment\n- POST `/vulnerability/scan` — Bulk scan all tenants\n- GET `/benefits-check/:tenantId` — Benefit entitlements\n- GET `/property-passport/:propertyId` — Property dossier\n- GET `/briefing/:estateId` — Neighbourhood briefing\n- POST `/draft-communication` — Generate email/SMS\n- POST `/chat` — Yantra Assist chat\n- GET `/notify/templates` — Notify template library (24 templates)\n- GET `/notify/templates/:category` — Templates by category\n- POST `/notify/render` — Render template with personalisation\n\n#### Public Data Routes (`/api/v1/public-data`)\n- GET `/census/:lsoaCode` — Census 2021 data\n- GET `/nomis/:lsoaCode` — Labour market stats\n- GET `/gas-safe/:registrationNumber` — Gas Safe verification\n- GET `/electrical-safety/:registrationNumber` — Electrical safety verification\n\n#### Admin Routes (`/api/v1/admin`)\n- GET `/integrations` — 20 integrations with status\n- POST `/integrations/:id/toggle` — Enable/disable integration\n- POST `/integrations/:id/test` — Test connection\n- GET `/monitoring` — Metrics & health\n\n#### Additional Routes\n- GET `/api/v1/config` — Firebase client config (public)\n- GET `/health` — Cloud Run health check\n\n---\n\n### 7. FIRESTORE DATA MODEL\n\n**15 Collections:**\n\n1. **organisations** — Top-level entity (1 org)\n2. **regions** — Geographic regions (N regions)\n3. **localAuthorities** — Local councils/authorities (N)\n4. **estates** — Housing estates/schemes (N)\n5. **blocks** — Building blocks within estates (N)\n6. **properties** — Individual units (75 seeded)\n7. **tenants** — Residents (68 seeded)\n8. **cases** — Unified case management (repairs, complaints, ASB, damp, financial)\n9. **activities** — Timeline/audit trail entries\n10. **communications** — Email/message records (5 seeded)\n11. **rentTransactions** — Payment history\n12. **users** — System users with persona\n13. **auditLog** — Read-only audit trail\n14. **hactCodes** — Housing HACT code reference data\n15. **notifications** — In-app notification queue\n\n**Additional Collections (auto-managed):**\n- **externalDataCache** — API response caching with TTL\n- **voidProperties** — Void tracking\n- **applicants** — Applicant records\n- **tsmMeasures** — Decent Homes stock condition\n\n**Security Model:**\n- Field-level encryption not implemented (relies on Cloud IAM)\n- Persona-based access via custom claims in Firebase JWT\n- Fallback to X-Persona header for unauthenticated requests (dev mode)\n- Audit log is write-once, read-many (immutable)\n\n---\n\n### 8. DOCUMENTATION FILES\n\n**At Project Root:**\n- `/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt` (481 lines) — Core product spec\n- `/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt` (470 lines) — AI-native features\n- `/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt` (2,333 lines) — 30+ API integrations\n- `/mnt/c/.netapps/socialhomes/Doc4-UI-UX-Audit-Build-Guide.md` — Frontend audit\n- `/mnt/c/.netapps/socialhomes/CLAUDE.md` — Claude Code instructions\n- `/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md` — 8 session logs (persistent context)\n- `/mnt/c/.REDACTED.md` (v2.0) — 5-phase orchestration plan (Phases 0-4 DONE, Phase 5 TODO)\n- `/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md` — Bug/warning tracker (99.7% pass rate)\n- `/mnt/c/.netapps/socialhomes/DEVOPS.md` (952 lines) — Deployment & operations\n\n**In docs/requirements/:**\n- `Doc1-socialhomes-Base-Specification.txt` (21KB) — Updated base spec (v2.0)\n- `Doc2-socialhomes-Technical-Architecture.txt` (38KB) — Technical deep-dive with ASCII diagrams\n- `Doc3-socialhomes-API-Requirements.txt` (29KB) — Comprehensive API reference\n\n---\n\n### 9. BUILD & DEPLOYMENT\n\n**Build Configuration:**\n- **Frontend:** `app/npm run build` → Vite build, ~2.5MB bundle, ~1400px max-width responsive\n- **Backend:** `server/npm run build` → TypeScript compilation to `dist/`\n- **Docker:** Multi-stage build (client + server + production image)\n- **Image:** node:20-slim base, ~500MB final image\n\n**Deployment Pipeline:**\n```\ngit push origin main \n  → Cloud Build trigger \n  → Docker build & push to Artifact Registry \n  → Cloud Run deploy \n  → Health check passes\n```\n\n**Cloud Run Configuration:**\n- **Region:** europe-west2\n- **Memory:** 1GB\n- **CPU:** 1 core\n- **Min instances:** 0 (cold start ~2s)\n- **Max instances:** 10\n- **Port:** 8080\n- **Secrets:** 4 from Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n**Environment:**\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes\n\n---\n\n### 10. CURRENT DEVELOPMENT STATUS\n\n**Completed (Phases 0-4):**\n- 58 completed tasks across infrastructure, foundation, intelligence, enrichment, and completion phases\n- All 7 killer differentiators implemented and tested\n- 50+ API endpoints operational\n- 24 GOV.UK Notify templates with personalisation\n- Admin integration dashboard (20 integrations)\n- Security hardening (CSP, CORS, rate limiting, security headers)\n- Production monitoring (metrics, health checks, structured logging)\n- WCAG AA accessibility compliance\n- 99.7% Selenium test pass rate (330/331 tests)\n\n**Pending (Phase 5 - Evolution):**\n32 remaining tasks organized in 5 sub-phases:\n- **5.1:** Project Setup & Architecture (Vertex AI design, WebSocket design, SaaS strategy, API docs)\n- **5.2:** Backend Development (Vertex AI integration, notification dispatch, circuit breaker, cache warming, scheduled tasks)\n- **5.3:** Frontend Development (Yantra Assist chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive)\n- **5.4:** Testing & QA (Comprehensive regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline)\n- **5.5:** DevOps & Deployment (Fix cloudbuild.yaml, staging environment, auto-scaling, monitoring alerts, backups, CDN, custom domain, runbook)\n\n---\n\n### 11. KEY FILES & THEIR PURPOSE\n\n**Frontend Entry Points:**\n- `/mnt/c/.netapps/socialhomes/app/src/main.tsx` — React app bootstrap with Query Client\n- `/mnt/c/.netapps/socialhomes/app/src/App.tsx` — Main router & layout wrapper\n- `/mnt/c/.netapps/socialhomes/app/src/contexts/AuthContext.tsx` — Firebase auth provider\n\n**Backend Entry Points:**\n- `/mnt/c/.netapps/socialhomes/server/src/index.ts` — Express app setup with middleware & routes\n- `/mnt/c/.netapps/socialhomes/server/src/services/firestore.ts` — Firestore wrapper (getDocs, getDoc, updateDoc, etc.)\n- `/mnt/c/.netapps/socialhomes/server/src/middleware/auth.ts` — JWT verification & persona extraction\n\n**Critical Paths:**\n- **Damp Intelligence:** `server/src/services/damp-prediction.ts` (5-factor algorithm)\n- **Vulnerability Scanning:** `server/src/services/vulnerability-detection.ts` (7-factor scoring)\n- **AI Communication Drafting:** `server/src/routes/ai.ts` + `app/src/services/ai-drafting.ts`\n- **Notification System:** `server/src/services/govuk-notify.ts` (24 templates)\n- **Map Rendering:** `app/src/pages/explore/ExplorePage.tsx` (Leaflet, data layers)\n- **Data Caching:** `server/src/services/external-api.ts` (shared caching + TTL management)\n\n---\n\n### 12. TESTING & QUALITY ASSURANCE\n\n**Test Coverage:**\n- **Selenium E2E:** 331 tests across 17 test classes covering all 40+ routes\n- **Pass Rate:** 99.7% (330 passing, 1 warning about popup interaction)\n- **TypeScript:** 0 compilation errors (strict mode)\n- **Vitest Unit Tests:** 4 integration test files (external-api, firestore, public-data)\n\n**Known Issues (All Resolved):**\n- BUG-001–004: React Error #310 on detail pages (FIXED)\n- BUG-005–006: React hooks violation (FIXED)\n- WARN-001–003: Map popups, search filtering, API pagination (FIXED)\n\n---\n\n### 13. AUTHENTICATION & SECURITY\n\n**Authentication Methods:**\n1. **Firebase Email/Password** — Primary auth for staff\n2. **Google OAuth** — Secondary auth option\n3. **Demo User** — `test@socialhomes.ai` / password from Secret Manager (dev/testing)\n\n**Authorization:**\n- Firebase JWT contains `persona` custom claim\n- Server validates via `/api/v1/config` endpoint (Firebase config)\n- Fallback to X-Persona header (development mode)\n\n**Security Measures:**\n- **CSP:** Whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- **CORS:** Restricted to localhost + Cloud Run URL\n- **Rate Limiting:** 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- **Headers:** Helmet (security headers), X-Request-ID correlation\n- **JSON Limit:** 1MB (prevents large payloads)\n- **Secrets:** 4 secrets in Google Secret Manager (never in .env or code)\n\n---\n\n### 14. CONFIGURATION FILES\n\n**TypeScript:**\n- `app/tsconfig.json` — References tsconfig.app.json & tsconfig.node.json\n- `server/tsconfig.json` — Node.js target, module: esnext\n\n**Vite:**\n- `app/vite.config.ts` — React plugin, Tailwind plugin, path alias for @/\n\n**Firestore:**\n- `firestore.rules` — Security rules with persona-based RBAC\n- `firestore.indexes.json` — 16 composite indexes for query optimization\n\n**Docker:**\n- `Dockerfile` — Multi-stage build (3 stages: build-client, build-server, production)\n\n**Cloud Build:**\n- `cloudbuild.yaml` — Build, push, deploy pipeline (needs path fix in next session)\n\n**MCP (Claude Code):**\n- `.mcp.json` — Telegram bot token config (not committed, .gitignore'd)\n\n---\n\n### 15. SEED DATA\n\n**Database is seeded with realistic test data:**\n- **Properties:** 75 units across multiple estates\n- **Tenants:** 68 residents with full demographic data\n- **Cases:** 279 mixed (repairs, complaints, ASB, damp, financial)\n- **Rent Transactions:** Payment history with arrears data\n- **Communications:** 5 message records\n- **Users:** Demo staff accounts with personas\n- **IMD Data:** Index of Multiple Deprivation loaded via `seed-imd.ts`\n\n**Seeding Commands:**\n- `npm run seed` — Load main database\n- `npm run seed:imd` — Load IMD data (server-side)\n\n---\n\n### 16. ENTIRE.IO INTEGRATION\n\n- **CLI:** Installed at `~/.local/bin/entire`\n- **Strategy:** Manual commit (not automatic checkpoints)\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **Dashboard:** https://app.entire.io (authenticated access required)\n- **Sessions:** 8 session checkpoints logged\n\n---\n\n### 17. MISSION CONTROL INTEGRATION\n\n- **Directory:** `.mission-control/` (untracked in git)\n- **Files:** BA system prompt, BA task prompt\n- **Purpose:** Coordination with Mission Control orchestration layer for multi-project management\n\n---\n\n### 18. COMMUNICATION SETUP\n\n**Telegram Bot (@SocialHomesBot):**\n- **Chat ID:** socialhomes:8020560167\n- **Config:** `.mcp.json` (bot token, not in git)\n- **MCP Tools:**\n  - `mcp__telegram__send_message` — Two-way communication (expects response)\n  - `mcp__telegram__notify_user` — One-way async notifications\n  - `mcp__telegram__continue_chat` — Follow-up messages\n  - `mcp__telegram__end_chat` — Close session\n\n---\n\n### 19. KEY CONVENTIONS & PATTERNS\n\n**Frontend:**\n- Use `safeText()` helper for undefined values (prevents React Error #310)\n- Use `?? []` for nullable arrays\n- Tailwind classes with dark theme (--surface-dark, --brand-teal, etc.)\n- React Query for data fetching (5-minute stale time)\n- useApi hooks for typed API calls\n- ErrorBoundary wrapping for error resilience\n\n**Backend:**\n- All routes in `server/src/routes/`\n- All services in `server/src/services/`\n- Middleware pipeline: auth → metrics → error-handler\n- Firestore serialization to prevent object leaks\n- Rate limiting per-category\n- Structured logging with correlation IDs\n\n**Data Flow:**\n- Frontend → API Client → Express Routes → Firestore Services → Firestore\n- External APIs → Cache (externalDataCache collection) → Express Services\n- Real-time: Firestore listeners (Briefing page uses live updates)\n\n---\n\n### 20. ABSOLUTE FILE PATHS (Key Resources)\n\n**Documentation:**\n- `/mnt/c/.netapps/socialhomes/CLAUDE.md`\n- `/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md`\n- `/mnt/c/.REDACTED.md`\n- `/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md`\n- `/mnt/c/.netapps/socialhomes/DEVOPS.md`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt`\n\n**Configuration:**\n- `/mnt/c/.netapps/socialhomes/firestore.rules`\n- `/mnt/c/.netapps/socialhomes/firestore.indexes.json`\n- `/mnt/c/.netapps/socialhomes/cloudbuild.yaml`\n- `/mnt/c/.netapps/socialhomes/Dockerfile`\n\n**Frontend Sources:**\n- `/mnt/c/.netapps/socialhomes/app/src/App.tsx`\n- `/mnt/c/.netapps/socialhomes/app/src/main.tsx`\n- `/mnt/c/.netapps/socialhomes/app/src/services/api-client.ts`\n- `/mnt/c/.netapps/socialhomes/app/src/types/index.ts`\n\n**Backend Sources:**\n- `/mnt/c/.netapps/socialhomes/server/src/index.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/routes/ai.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/services/firestore.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/services/damp-prediction.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/models/firestore-schemas.ts`\n\n**Package Files:**\n- `/mnt/c/.netapps/socialhomes/app/package.json`\n- `/mnt/c/.netapps/socialhomes/server/package.json`\n\n---\n\n## SUMMARY\n\nSocialHomes.Ai is a **production-grade, AI-native housing management platform** with:\n\n- **23,852 lines of TypeScript code** across 73 frontend and 43 backend files\n- **50+ API endpoints** with comprehensive error handling and rate limiting\n- **7 killer differentiators** (damp intelligence, crime context, vulnerability detection, benefits engine, property passport, neighbourhood briefing, dynamic UI)\n- **99.7% test pass rate** (330/331 Selenium E2E tests)\n- **5 personas** with graduated permissions and RBAC\n- **15 Firestore collections** with 16 composite indexes\n- **Tier 1, 2, & 3 API integrations** (30+ external services)\n- **Complete documentation** (4 specification docs + DevOps guide + persistent session history)\n- **Production deployment** on Google Cloud Run (europe-west2) with health checks, metrics, and Secret Manager\n- **Phase 5 roadmap** with 32 remaining evolution tasks\n\nThe codebase is clean, well-structured, fully documented, and ready for Phase 5 development (Vertex AI integration, WebSockets, advanced testing, and production hardening)."},{"type":"text","text":"agentId: a406a2f4626ee1fc9 (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 79521\ntool_uses: 37\nduration_ms: 117418</usage>"}]}]},"uuid":"3479d379-50b8-4747-b16a-cc11dc9e3727","timestamp":"2026-02-23T18:37:25.142Z","toolUseResult":{"status":"completed","prompt":"Very thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all top-level dirs and key subdirectories)\n2. All existing documentation files (*.md, *.txt, docs/*)\n3. Package.json files (root, app/, server/)\n4. Key configuration files (tsconfig, vite config, docker files, cloud build, etc.)\n5. The app/src/ structure - pages, components, routes, hooks, data\n6. The server/src/ structure - routes, models, middleware, services\n7. Any existing specification docs (Doc1, Doc2, Doc3 mentioned in CLAUDE.md)\n8. SESSION-HISTORY.md, EXECUTION-PLAN.md, DEV-FIX-LIST.md\n9. Firebase/Firestore configuration\n10. Any .env.example or environment config patterns\n\nBe very thorough - read the contents of all documentation files, package.json files, and key source files to understand what this application does, its tech stack, and current state of development.","agentId":"a406a2f4626ee1fc9","content":[{"type":"text","text":"Perfect! Now I have a comprehensive understanding. Let me create the detailed exploration report:\n\n---\n\n## COMPREHENSIVE EXPLORATION: SocialHomes.Ai Project\n\nI've completed a thorough exploration of the SocialHomes.Ai project. Here's the complete breakdown:\n\n---\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native social housing management platform designed for UK housing associations and local authorities managing 5,000-20,000 units. It's built as a modern, dark-themed Bloomberg Terminal-style application rather than a traditional government form interface.\n\n**Current Status:** Production-ready on Google Cloud Run (europe-west2)\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **Test Pass Rate:** 99.7% (330/331 tests passing)\n- **Codebase:** 23,852 lines of code\n- **Phase Status:** Phases 0-4 complete (Intelligence, Enrichment, Completion); Phase 5 (Evolution) pending\n\n---\n\n### 2. DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                           # React 19 frontend (Vite)\n│   ├── src/\n│   │   ├── pages/                 # 19 page directories\n│   │   │   ├── admin/             # Admin dashboard + integrations\n│   │   │   ├── ai-centre/         # AI predictions & insights\n│   │   │   ├── allocations/       # Housing allocations\n│   │   │   ├── asb/               # Anti-Social Behaviour cases\n│   │   │   ├── auth/              # Firebase authentication\n│   │   │   ├── briefing/          # Daily briefing + neighbourhood intelligence\n│   │   │   ├── communications/    # Email/message management\n│   │   │   ├── complaints/        # Complaint tracking & escalation\n│   │   │   ├── compliance/        # Regulatory compliance (Big 6)\n│   │   │   ├── dashboard/         # KPI dashboard\n│   │   │   ├── explore/           # Interactive map (Leaflet)\n│   │   │   ├── properties/        # Property detail & management\n│   │   │   ├── rent/              # Rent & income tracking\n│   │   │   ├── repairs/           # Repair case management\n│   │   │   ├── reports/           # Dynamic reports (27 types)\n│   │   │   ├── search/            # Global search\n│   │   │   ├── tenancies/         # Tenant management\n│   │   │   └── tenant-portal/     # Self-service portal\n│   │   ├── components/\n│   │   │   ├── layout/            # Header, Sidebar, Breadcrumbs, Layout, YantraAssist\n│   │   │   └── shared/            # Reusable UI components\n│   │   │       ├── ActionModal\n│   │   │       ├── AiActionCard\n│   │   │       ├── BenefitsPanel\n│   │   │       ├── CountdownTimer\n│   │   │       ├── DampIntelligencePanel\n│   │   │       ├── HelpDrawer\n│   │   │       ├── KpiCard\n│   │   │       ├── NeighbourhoodBriefingPanel\n│   │   │       ├── PropertyMap\n│   │   │       ├── VulnerabilityPanel\n│   │   │       └── StatusPill\n│   │   ├── services/\n│   │   │   ├── api-client.ts      # API client with 50+ endpoints\n│   │   │   ├── firebase.ts        # Firebase SDK configuration\n│   │   │   ├── ai-drafting.ts     # AI communication drafting\n│   │   │   └── public-data.ts     # Public data caching\n│   │   ├── hooks/                 # React hooks\n│   │   │   ├── useApi.ts          # 23 custom API hooks (React Query)\n│   │   │   ├── useEntityIntelligence.ts\n│   │   │   └── usePersonaScope.ts\n│   │   ├── data/                  # Static/seed data\n│   │   ├── contexts/              # React contexts (Auth, App)\n│   │   ├── types/                 # TypeScript type definitions\n│   │   └── utils/                 # Formatting utilities\n│   ├── package.json\n│   ├── tsconfig.json\n│   ├── vite.config.ts\n│   └── dist/                      # Built output\n│\n├── server/                        # Express.js backend\n│   ├── src/\n│   │   ├── routes/                # 13 API route modules\n│   │   │   ├── properties.ts      # Property CRUD\n│   │   │   ├── tenants.ts         # Tenant CRUD\n│   │   │   ├── cases.ts           # Case management (unified)\n│   │   │   ├── ai.ts              # AI services (7 differentiators + mock APIs)\n│   │   │   ├── admin.ts           # Admin endpoints\n│   │   │   ├── explore.ts         # Hierarchy navigation\n│   │   │   ├── briefing.ts        # Neighbourhood briefing\n│   │   │   ├── compliance.ts      # Regulatory compliance\n│   │   │   ├── rent.ts            # Rent/income tracking\n│   │   │   ├── reports.ts         # Report generation\n│   │   │   ├── public-data.ts     # Public APIs (Census, NOMIS, Gas Safe, etc.)\n│   │   │   ├── auth.ts            # Authentication\n│   │   │   ├── lettings.ts        # Lettings/allocations\n│   │   │   └── booking.ts         # Viewing bookings\n│   │   ├── services/              # 25 service modules\n│   │   │   ├── external-api.ts    # Shared caching & rate limiting\n│   │   │   ├── firestore.ts       # Firestore wrapper\n│   │   │   ├── firebase-admin.ts  # Firebase Admin SDK\n│   │   │   ├── damp-prediction.ts # Damp intelligence (5-factor weighted)\n│   │   │   ├── crime-context.ts   # Crime/ASB correlation\n│   │   │   ├── vulnerability-detection.ts # 7-factor vulnerability scoring\n│   │   │   ├── benefits-engine.ts # UK benefit rules (UC, PIP, AA, etc.)\n│   │   │   ├── property-passport.ts # Multi-source property dossier\n│   │   │   ├── neighbourhood-briefing.ts # Estate intelligence\n│   │   │   ├── mock-services.ts   # Tier 3 mock APIs (5 major integrations)\n│   │   │   ├── govuk-notify.ts    # 24 notification templates (7 categories)\n│   │   │   ├── census-nomis.ts    # Census 2021 + labour market data\n│   │   │   ├── monitoring.ts      # Metrics & health checks\n│   │   │   ├── seed.ts & seed-data.ts # Data seeding\n│   │   │   ├── hact-export.ts     # Housing HACT code exports\n│   │   │   └── Test files (4 integration tests)\n│   │   ├── middleware/            # 5 middleware modules\n│   │   │   ├── auth.ts            # JWT + X-Persona fallback\n│   │   │   ├── error-handler.ts   # Structured error logging\n│   │   │   ├── rate-limiter.ts    # 4-tier sliding window\n│   │   │   ├── metrics.ts         # Request tracking\n│   │   │   └── rbac.ts            # Role-based access control\n│   │   ├── models/\n│   │   │   ├── firestore-schemas.ts # Firestore document interfaces\n│   │   │   └── hact-codes.ts      # Housing code definitions\n│   │   ├── scripts/\n│   │   │   └── seed-imd.ts        # IMD data seeding\n│   │   └── index.ts               # Express app entry point\n│   ├── package.json\n│   ├── tsconfig.json\n│   └── dist/                      # Built output\n│\n├── .git/                          # Git repository with Entire.io checkpoints\n├── .entire/                       # Entire.io session metadata\n├── .mission-control/              # Mission Control integration files\n├── tests/                         # Selenium E2E test suites\n├── docs/                          # Additional documentation\n│   └── requirements/              # Latest specification documents (3 Docs)\n├── cloudbuild.yaml               # Cloud Build CI/CD pipeline\n├── Dockerfile                    # Multi-stage Docker build\n├── firestore.rules               # Security rules (15 collections)\n├── firestore.indexes.json        # Firestore composite indexes (16 indexes)\n├── Doc1-SocialHomesAi-Base-Specification.txt (481 lines)\n├── Doc2-SocialHomesAi-AI-Native-Features.txt (470 lines)\n├── Doc3-Public-API-Integration-Requirements.txt (2,333 lines)\n├── Doc4-UI-UX-Audit-Build-Guide.md\n├── CLAUDE.md                     # Claude Code project instructions\n├── SESSION-HISTORY.md            # Persistent conversation log\n├── EXECUTION-PLAN.md             # Multi-agent orchestration plan (v2.0)\n├── DEV-FIX-LIST.md              # Bug/warning tracker\n├── DEVOPS.md                     # DevOps & deployment guide (952 lines)\n└── README.md\n```\n\n---\n\n### 3. TECHNOLOGY STACK\n\n#### Frontend (React 19 + Vite)\n- **Framework:** React 19.2.0 with hooks & functional components\n- **Build Tool:** Vite 7.2.4\n- **Styling:** Tailwind CSS 4.1.18 (dark theme, brand-teal primary)\n- **Routing:** React Router v6\n- **State Management:** React Context + useReducer (no Redux)\n- **Data Fetching:** TanStack React Query 5.90.20\n- **Maps:** Leaflet 1.9.4 + React Leaflet 5.0.0 (OpenStreetMap)\n- **Charts:** Recharts 3.7.0, D3.js 7.9.0\n- **3D Visualization:** Three.js 0.182.0 + React Three Fiber\n- **Icons:** Lucide React 0.563.0\n- **Forms:** Uncontrolled (react-hook-form style)\n- **Animation:** CSS transitions & keyframes throughout\n- **Language:** TypeScript 5.9.3 with strict mode\n\n#### Backend (Express.js + Node.js)\n- **Framework:** Express.js 4.21.2\n- **Runtime:** Node.js 20.17.0\n- **Language:** TypeScript 5.7.0\n- **Database:** Google Firestore\n- **Firebase:** Firebase Admin SDK 13.6.1\n- **Middleware:**\n  - Helmet 8.1.0 (security headers + CSP)\n  - CORS 2.8.5 (restricted origins)\n  - Morgan 1.10.0 (logging)\n  - Compression 1.8.0 (gzip)\n- **Authentication:** Firebase JWT + custom X-Persona header\n- **Rate Limiting:** Custom sliding window (4 tiers)\n- **Metrics:** Custom monitoring service\n- **Testing:** Vitest 4.0.18\n\n#### Database & Infrastructure\n- **Primary DB:** Google Firestore (real-time, cloud-native)\n- **Collections:** 15 (properties, tenants, cases, communications, rentTransactions, users, auditLog, hactCodes, notifications, voidProperties, applicants, tsmMeasures, externalDataCache, activities, organisations)\n- **Indexes:** 16 composite indexes for query optimization\n- **Security:** Firestore security rules with persona-based RBAC\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** Cloud Build (git push → build → deploy)\n- **Container:** Docker multi-stage build (node:20-slim)\n- **Secrets:** Google Secret Manager (4 secrets)\n\n#### External APIs (Tier 1 & 2)\n- **Tier 1 (Free):**\n  - postcodes.io (postcode lookup)\n  - uprn.uk (UPRN data)\n  - data.police.uk (street-level crime & ASB)\n  - Open-Meteo API (weather & flood)\n  - DEFRA Flood Risk API\n  - ONS IMD data (Index of Multiple Deprivation)\n  \n- **Tier 2 (Registration):**\n  - GOV.UK Notify (email/SMS - 24 templates)\n  - Census 2021 (via NOMIS)\n  - NOMIS Labour Market Stats\n  - Gas Safe Register\n  - Electrical Safety Register\n\n- **Tier 3 (Mocked):**\n  - DWP Universal Credit verification\n  - IoT sensors (Switchee/Aico)\n  - GoCardless/Allpay payments\n  - Plentific/Fixflo repairs marketplace\n  - RSH/CORE regulatory submissions\n  - DocuSign digital signing\n  - Experian/TransUnion referencing\n  - Land Registry data\n\n---\n\n### 4. KEY FEATURES & MODULES\n\n#### Core Modules (14 main routes)\n1. **Dashboard** — KPI overview (Properties, Tenancies, Repairs, Compliance, Arrears, Void)\n2. **Briefing** — Personalized AI alerts, action items, neighbourhood intelligence\n3. **Properties** — 75 properties with map, EPC, compliance, damp risk scoring\n4. **Tenancies** — 68 tenants with arrears tracking, UC status, vulnerability flags\n5. **Repairs** — 200+ cases with workflow, SLA tracking, contractor management\n6. **Complaints** — 34 complaints with timeline, ombudsman tracking, deadlines\n7. **ASB (Anti-Social Behaviour)** — 12 cases with crime context correlation\n8. **Rent & Income** — Financial tracking, UC integration, payment arrangements\n9. **Compliance** — Big 6 checks (Gas Safety, EICR, Fire Risk, Asbestos, Legionella, Lifts), Awaab's Law\n10. **Communications** — Message management, template library, bulk send\n11. **Reports** — 27 dynamic report types (HACT, stock condition, TSM, etc.)\n12. **AI Centre** — Predictions, insights, differentiators hub, vulnerability scan\n13. **Admin** — 20 integration management dashboard, user management\n14. **Explore** — Interactive map with crime/damp/compliance layers\n\n#### 7 Killer Differentiators (Phase 2)\n1. **Predictive Damp Intelligence** — 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10)\n2. **Live Crime Context for ASB** — Police data correlation with internal ASB cases\n3. **Automatic Vulnerability Detection** — 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Benefits Entitlement Engine** — UK 2025/26 benefit rules analysis\n5. **Property Passport** — Multi-source property dossier aggregation\n6. **AI Neighbourhood Briefing** — Per-estate daily intelligence combining all data sources\n7. **Dynamic AI Interface Elements** — Context-aware buttons, fields, actions on entity pages\n\n#### AI-Native Features\n- **YantraAssist** — Contextual AI assistant (chat panel with streaming responses)\n- **Dynamic Action Cards** — AI-generated buttons based on entity context\n- **Predictive Alerts** — Vulnerability scoring, SLA breaches, compliance expirations\n- **AI Communication Drafting** — Pre-drafted emails with personalization\n- **AI Action Recommendations** — Context-aware next steps for each entity\n- **Batch Intelligence Scanning** — Vulnerability scan across all tenants\n\n#### Accessibility & Compliance\n- **WCAG AA Compliant** — Focus traps, skip links, ARIA labels, screen reader support\n- **Dark Theme Default** — Yantra.Works brand colours (teal, peach, garnet)\n- **Awaab's Law Tracking** — Damp & mould emergency timers with colour transitions\n- **Mobile Responsive** — Dashboard renders on mobile viewports\n- **Pre-Action Protocol** — Formal eviction process enforcement\n\n---\n\n### 5. PERSONAS & RBAC\n\n5 persona levels with graduated permissions:\n1. **COO** — Organisation-wide view, admin functions, approve policies\n2. **Head of Service** — Regional oversight, budget control, compliance reporting\n3. **Housing Manager** — Estate/block management, case assignment, contractor management\n4. **Housing Officer** — Frontline casework, tenant interaction, case logging\n5. **Repairs Operative** — Job-level repairs, appointment scheduling\n\nFirestore rules enforce persona-based access control for all collections.\n\n---\n\n### 6. API STRUCTURE (50+ Endpoints)\n\n#### Authentication Routes (`/api/v1/auth`)\n- POST `/login` — Firebase email login\n- POST `/login-google` — Google OAuth login\n- POST `/logout` — Logout\n- GET `/me` — Current user info\n\n#### Property Routes (`/api/v1/properties`)\n- GET `/` — List with filters (regionId, estateId, type, isVoid, limit)\n- GET `/available` — Void properties\n- GET `/:id` — Property detail\n- PATCH `/:id` — Update property\n\n#### Tenant Routes (`/api/v1/tenants`)\n- GET `/` — List with filters\n- GET `/:id` — Tenant detail\n- GET `/:id/activities` — Activity timeline\n- GET `/:id/cases` — Associated cases\n- PATCH `/:id` — Update tenant\n\n#### Case Routes (`/api/v1/cases`)\n- GET `/` — List with type/status filters & pagination\n- GET `/:id` — Case detail\n- POST `/` — Create case\n- PATCH `/:id` — Update case\n- GET `/:id/activities` — Case timeline\n\n#### Convenience Aliases\n- GET `/api/v1/repairs` — All repairs (type=='repair')\n- GET `/api/v1/complaints` — All complaints (type=='complaint')\n\n#### Explore Routes (`/api/v1/explore`)\n- GET `/hierarchy` — Geography drill-down\n- GET `/regions` — All regions\n- GET `/local-authorities/:id`\n- GET `/estates/:id`\n- GET `/blocks/:id`\n\n#### Briefing Routes (`/api/v1/briefing`)\n- GET `/:estateId` — Daily estate briefing\n\n#### Compliance Routes (`/api/v1/compliance`)\n- GET `/` — Big 6 summary\n- GET `/:type` — Compliance by type (gas, electrical, fire, asbestos, legionella, lifts)\n\n#### Rent Routes (`/api/v1/rent`)\n- GET `/` — Rent summary\n- GET `/transactions/:tenantId` — Payment history\n- GET `/arrears` — High-risk tenants\n\n#### Reports Routes (`/api/v1/reports`)\n- GET `/` — Available reports (27 types)\n- GET `/:type` — Generate report\n\n#### AI Routes (`/api/v1/ai`)\n- GET `/damp-risk/:propertyId` — Damp score\n- GET `/crime-context/:estateId` — Crime stats\n- GET `/vulnerability/:tenantId` — 7-factor assessment\n- POST `/vulnerability/scan` — Bulk scan all tenants\n- GET `/benefits-check/:tenantId` — Benefit entitlements\n- GET `/property-passport/:propertyId` — Property dossier\n- GET `/briefing/:estateId` — Neighbourhood briefing\n- POST `/draft-communication` — Generate email/SMS\n- POST `/chat` — Yantra Assist chat\n- GET `/notify/templates` — Notify template library (24 templates)\n- GET `/notify/templates/:category` — Templates by category\n- POST `/notify/render` — Render template with personalisation\n\n#### Public Data Routes (`/api/v1/public-data`)\n- GET `/census/:lsoaCode` — Census 2021 data\n- GET `/nomis/:lsoaCode` — Labour market stats\n- GET `/gas-safe/:registrationNumber` — Gas Safe verification\n- GET `/electrical-safety/:registrationNumber` — Electrical safety verification\n\n#### Admin Routes (`/api/v1/admin`)\n- GET `/integrations` — 20 integrations with status\n- POST `/integrations/:id/toggle` — Enable/disable integration\n- POST `/integrations/:id/test` — Test connection\n- GET `/monitoring` — Metrics & health\n\n#### Additional Routes\n- GET `/api/v1/config` — Firebase client config (public)\n- GET `/health` — Cloud Run health check\n\n---\n\n### 7. FIRESTORE DATA MODEL\n\n**15 Collections:**\n\n1. **organisations** — Top-level entity (1 org)\n2. **regions** — Geographic regions (N regions)\n3. **localAuthorities** — Local councils/authorities (N)\n4. **estates** — Housing estates/schemes (N)\n5. **blocks** — Building blocks within estates (N)\n6. **properties** — Individual units (75 seeded)\n7. **tenants** — Residents (68 seeded)\n8. **cases** — Unified case management (repairs, complaints, ASB, damp, financial)\n9. **activities** — Timeline/audit trail entries\n10. **communications** — Email/message records (5 seeded)\n11. **rentTransactions** — Payment history\n12. **users** — System users with persona\n13. **auditLog** — Read-only audit trail\n14. **hactCodes** — Housing HACT code reference data\n15. **notifications** — In-app notification queue\n\n**Additional Collections (auto-managed):**\n- **externalDataCache** — API response caching with TTL\n- **voidProperties** — Void tracking\n- **applicants** — Applicant records\n- **tsmMeasures** — Decent Homes stock condition\n\n**Security Model:**\n- Field-level encryption not implemented (relies on Cloud IAM)\n- Persona-based access via custom claims in Firebase JWT\n- Fallback to X-Persona header for unauthenticated requests (dev mode)\n- Audit log is write-once, read-many (immutable)\n\n---\n\n### 8. DOCUMENTATION FILES\n\n**At Project Root:**\n- `/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt` (481 lines) — Core product spec\n- `/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt` (470 lines) — AI-native features\n- `/mnt/c/.netapps/socialhomes/Doc3-Public-API-Integration-Requirements.txt` (2,333 lines) — 30+ API integrations\n- `/mnt/c/.netapps/socialhomes/Doc4-UI-UX-Audit-Build-Guide.md` — Frontend audit\n- `/mnt/c/.netapps/socialhomes/CLAUDE.md` — Claude Code instructions\n- `/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md` — 8 session logs (persistent context)\n- `/mnt/c/.REDACTED.md` (v2.0) — 5-phase orchestration plan (Phases 0-4 DONE, Phase 5 TODO)\n- `/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md` — Bug/warning tracker (99.7% pass rate)\n- `/mnt/c/.netapps/socialhomes/DEVOPS.md` (952 lines) — Deployment & operations\n\n**In docs/requirements/:**\n- `Doc1-socialhomes-Base-Specification.txt` (21KB) — Updated base spec (v2.0)\n- `Doc2-socialhomes-Technical-Architecture.txt` (38KB) — Technical deep-dive with ASCII diagrams\n- `Doc3-socialhomes-API-Requirements.txt` (29KB) — Comprehensive API reference\n\n---\n\n### 9. BUILD & DEPLOYMENT\n\n**Build Configuration:**\n- **Frontend:** `app/npm run build` → Vite build, ~2.5MB bundle, ~1400px max-width responsive\n- **Backend:** `server/npm run build` → TypeScript compilation to `dist/`\n- **Docker:** Multi-stage build (client + server + production image)\n- **Image:** node:20-slim base, ~500MB final image\n\n**Deployment Pipeline:**\n```\ngit push origin main \n  → Cloud Build trigger \n  → Docker build & push to Artifact Registry \n  → Cloud Run deploy \n  → Health check passes\n```\n\n**Cloud Run Configuration:**\n- **Region:** europe-west2\n- **Memory:** 1GB\n- **CPU:** 1 core\n- **Min instances:** 0 (cold start ~2s)\n- **Max instances:** 10\n- **Port:** 8080\n- **Secrets:** 4 from Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n**Environment:**\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes\n\n---\n\n### 10. CURRENT DEVELOPMENT STATUS\n\n**Completed (Phases 0-4):**\n- 58 completed tasks across infrastructure, foundation, intelligence, enrichment, and completion phases\n- All 7 killer differentiators implemented and tested\n- 50+ API endpoints operational\n- 24 GOV.UK Notify templates with personalisation\n- Admin integration dashboard (20 integrations)\n- Security hardening (CSP, CORS, rate limiting, security headers)\n- Production monitoring (metrics, health checks, structured logging)\n- WCAG AA accessibility compliance\n- 99.7% Selenium test pass rate (330/331 tests)\n\n**Pending (Phase 5 - Evolution):**\n32 remaining tasks organized in 5 sub-phases:\n- **5.1:** Project Setup & Architecture (Vertex AI design, WebSocket design, SaaS strategy, API docs)\n- **5.2:** Backend Development (Vertex AI integration, notification dispatch, circuit breaker, cache warming, scheduled tasks)\n- **5.3:** Frontend Development (Yantra Assist chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive)\n- **5.4:** Testing & QA (Comprehensive regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline)\n- **5.5:** DevOps & Deployment (Fix cloudbuild.yaml, staging environment, auto-scaling, monitoring alerts, backups, CDN, custom domain, runbook)\n\n---\n\n### 11. KEY FILES & THEIR PURPOSE\n\n**Frontend Entry Points:**\n- `/mnt/c/.netapps/socialhomes/app/src/main.tsx` — React app bootstrap with Query Client\n- `/mnt/c/.netapps/socialhomes/app/src/App.tsx` — Main router & layout wrapper\n- `/mnt/c/.netapps/socialhomes/app/src/contexts/AuthContext.tsx` — Firebase auth provider\n\n**Backend Entry Points:**\n- `/mnt/c/.netapps/socialhomes/server/src/index.ts` — Express app setup with middleware & routes\n- `/mnt/c/.netapps/socialhomes/server/src/services/firestore.ts` — Firestore wrapper (getDocs, getDoc, updateDoc, etc.)\n- `/mnt/c/.netapps/socialhomes/server/src/middleware/auth.ts` — JWT verification & persona extraction\n\n**Critical Paths:**\n- **Damp Intelligence:** `server/src/services/damp-prediction.ts` (5-factor algorithm)\n- **Vulnerability Scanning:** `server/src/services/vulnerability-detection.ts` (7-factor scoring)\n- **AI Communication Drafting:** `server/src/routes/ai.ts` + `app/src/services/ai-drafting.ts`\n- **Notification System:** `server/src/services/govuk-notify.ts` (24 templates)\n- **Map Rendering:** `app/src/pages/explore/ExplorePage.tsx` (Leaflet, data layers)\n- **Data Caching:** `server/src/services/external-api.ts` (shared caching + TTL management)\n\n---\n\n### 12. TESTING & QUALITY ASSURANCE\n\n**Test Coverage:**\n- **Selenium E2E:** 331 tests across 17 test classes covering all 40+ routes\n- **Pass Rate:** 99.7% (330 passing, 1 warning about popup interaction)\n- **TypeScript:** 0 compilation errors (strict mode)\n- **Vitest Unit Tests:** 4 integration test files (external-api, firestore, public-data)\n\n**Known Issues (All Resolved):**\n- BUG-001–004: React Error #310 on detail pages (FIXED)\n- BUG-005–006: React hooks violation (FIXED)\n- WARN-001–003: Map popups, search filtering, API pagination (FIXED)\n\n---\n\n### 13. AUTHENTICATION & SECURITY\n\n**Authentication Methods:**\n1. **Firebase Email/Password** — Primary auth for staff\n2. **Google OAuth** — Secondary auth option\n3. **Demo User** — `test@socialhomes.ai` / password from Secret Manager (dev/testing)\n\n**Authorization:**\n- Firebase JWT contains `persona` custom claim\n- Server validates via `/api/v1/config` endpoint (Firebase config)\n- Fallback to X-Persona header (development mode)\n\n**Security Measures:**\n- **CSP:** Whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- **CORS:** Restricted to localhost + Cloud Run URL\n- **Rate Limiting:** 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- **Headers:** Helmet (security headers), X-Request-ID correlation\n- **JSON Limit:** 1MB (prevents large payloads)\n- **Secrets:** 4 secrets in Google Secret Manager (never in .env or code)\n\n---\n\n### 14. CONFIGURATION FILES\n\n**TypeScript:**\n- `app/tsconfig.json` — References tsconfig.app.json & tsconfig.node.json\n- `server/tsconfig.json` — Node.js target, module: esnext\n\n**Vite:**\n- `app/vite.config.ts` — React plugin, Tailwind plugin, path alias for @/\n\n**Firestore:**\n- `firestore.rules` — Security rules with persona-based RBAC\n- `firestore.indexes.json` — 16 composite indexes for query optimization\n\n**Docker:**\n- `Dockerfile` — Multi-stage build (3 stages: build-client, build-server, production)\n\n**Cloud Build:**\n- `cloudbuild.yaml` — Build, push, deploy pipeline (needs path fix in next session)\n\n**MCP (Claude Code):**\n- `.mcp.json` — Telegram bot token config (not committed, .gitignore'd)\n\n---\n\n### 15. SEED DATA\n\n**Database is seeded with realistic test data:**\n- **Properties:** 75 units across multiple estates\n- **Tenants:** 68 residents with full demographic data\n- **Cases:** 279 mixed (repairs, complaints, ASB, damp, financial)\n- **Rent Transactions:** Payment history with arrears data\n- **Communications:** 5 message records\n- **Users:** Demo staff accounts with personas\n- **IMD Data:** Index of Multiple Deprivation loaded via `seed-imd.ts`\n\n**Seeding Commands:**\n- `npm run seed` — Load main database\n- `npm run seed:imd` — Load IMD data (server-side)\n\n---\n\n### 16. ENTIRE.IO INTEGRATION\n\n- **CLI:** Installed at `~/.local/bin/entire`\n- **Strategy:** Manual commit (not automatic checkpoints)\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **Dashboard:** https://app.entire.io (authenticated access required)\n- **Sessions:** 8 session checkpoints logged\n\n---\n\n### 17. MISSION CONTROL INTEGRATION\n\n- **Directory:** `.mission-control/` (untracked in git)\n- **Files:** BA system prompt, BA task prompt\n- **Purpose:** Coordination with Mission Control orchestration layer for multi-project management\n\n---\n\n### 18. COMMUNICATION SETUP\n\n**Telegram Bot (@SocialHomesBot):**\n- **Chat ID:** socialhomes:8020560167\n- **Config:** `.mcp.json` (bot token, not in git)\n- **MCP Tools:**\n  - `mcp__telegram__send_message` — Two-way communication (expects response)\n  - `mcp__telegram__notify_user` — One-way async notifications\n  - `mcp__telegram__continue_chat` — Follow-up messages\n  - `mcp__telegram__end_chat` — Close session\n\n---\n\n### 19. KEY CONVENTIONS & PATTERNS\n\n**Frontend:**\n- Use `safeText()` helper for undefined values (prevents React Error #310)\n- Use `?? []` for nullable arrays\n- Tailwind classes with dark theme (--surface-dark, --brand-teal, etc.)\n- React Query for data fetching (5-minute stale time)\n- useApi hooks for typed API calls\n- ErrorBoundary wrapping for error resilience\n\n**Backend:**\n- All routes in `server/src/routes/`\n- All services in `server/src/services/`\n- Middleware pipeline: auth → metrics → error-handler\n- Firestore serialization to prevent object leaks\n- Rate limiting per-category\n- Structured logging with correlation IDs\n\n**Data Flow:**\n- Frontend → API Client → Express Routes → Firestore Services → Firestore\n- External APIs → Cache (externalDataCache collection) → Express Services\n- Real-time: Firestore listeners (Briefing page uses live updates)\n\n---\n\n### 20. ABSOLUTE FILE PATHS (Key Resources)\n\n**Documentation:**\n- `/mnt/c/.netapps/socialhomes/CLAUDE.md`\n- `/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md`\n- `/mnt/c/.REDACTED.md`\n- `/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md`\n- `/mnt/c/.netapps/socialhomes/DEVOPS.md`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt`\n- `/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt`\n\n**Configuration:**\n- `/mnt/c/.netapps/socialhomes/firestore.rules`\n- `/mnt/c/.netapps/socialhomes/firestore.indexes.json`\n- `/mnt/c/.netapps/socialhomes/cloudbuild.yaml`\n- `/mnt/c/.netapps/socialhomes/Dockerfile`\n\n**Frontend Sources:**\n- `/mnt/c/.netapps/socialhomes/app/src/App.tsx`\n- `/mnt/c/.netapps/socialhomes/app/src/main.tsx`\n- `/mnt/c/.netapps/socialhomes/app/src/services/api-client.ts`\n- `/mnt/c/.netapps/socialhomes/app/src/types/index.ts`\n\n**Backend Sources:**\n- `/mnt/c/.netapps/socialhomes/server/src/index.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/routes/ai.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/services/firestore.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/services/damp-prediction.ts`\n- `/mnt/c/.netapps/socialhomes/server/src/models/firestore-schemas.ts`\n\n**Package Files:**\n- `/mnt/c/.netapps/socialhomes/app/package.json`\n- `/mnt/c/.netapps/socialhomes/server/package.json`\n\n---\n\n## SUMMARY\n\nSocialHomes.Ai is a **production-grade, AI-native housing management platform** with:\n\n- **23,852 lines of TypeScript code** across 73 frontend and 43 backend files\n- **50+ API endpoints** with comprehensive error handling and rate limiting\n- **7 killer differentiators** (damp intelligence, crime context, vulnerability detection, benefits engine, property passport, neighbourhood briefing, dynamic UI)\n- **99.7% test pass rate** (330/331 Selenium E2E tests)\n- **5 personas** with graduated permissions and RBAC\n- **15 Firestore collections** with 16 composite indexes\n- **Tier 1, 2, & 3 API integrations** (30+ external services)\n- **Complete documentation** (4 specification docs + DevOps guide + persistent session history)\n- **Production deployment** on Google Cloud Run (europe-west2) with health checks, metrics, and Secret Manager\n- **Phase 5 roadmap** with 32 remaining evolution tasks\n\nThe codebase is clean, well-structured, fully documented, and ready for Phase 5 development (Vertex AI integration, WebSockets, advanced testing, and production hardening)."}],"totalDurationMs":117418,"totalTokens":79521,"totalToolUseCount":37,"usage":{"input_tokens":7,"cache_creation_input_tokens":560,"cache_read_input_tokens":69515,"output_tokens":9439,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":560,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"46580fb6-ac17-4799-9338-95cc00bb7f36"}
{"parentUuid":"3479d379-50b8-4747-b16a-cc11dc9e3727","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the existing docs in `docs/requirements/` and the root-level specification files to understand what's already there:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"0a28a948-c0e6-4ad8-a9cb-9cec1104df40","timestamp":"2026-02-23T18:40:37.626Z"}
{"parentUuid":"0a28a948-c0e6-4ad8-a9cb-9cec1104df40","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017GnzaBs6jh6j21CUkL2ofW","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"38c6b656-1dcd-4b6f-a489-1d2d746f6271","timestamp":"2026-02-23T18:40:38.143Z"}
{"parentUuid":"38c6b656-1dcd-4b6f-a489-1d2d746f6271","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017GnzaBs6jh6j21CUkL2ofW","type":"tool_result","content":"     1→================================================================================\n     2→  Doc1 — SocialHomes.Ai Base Specification\n     3→  Version: 2.0  |  Date: 2026-02-18\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. PRODUCT OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Product Name\n    11→    SocialHomes.Ai\n    12→\n    13→1.2 Tagline\n    14→    AI-native social housing management for UK housing associations.\n    15→\n    16→1.3 Vision\n    17→    To be the first truly AI-native housing management system that embeds\n    18→    predictive intelligence, automation, and contextual assistance into every\n    19→    screen, workflow, and decision — transforming reactive housing operations\n    20→    into proactive, data-driven housing management.\n    21→\n    22→1.4 Target Market\n    23→    UK Social Housing Providers:\n    24→    - Housing Associations (Registered Providers)\n    25→    - Local Authority housing departments\n    26→    - ALMOs (Arms Length Management Organisations)\n    27→    Typical scale: 5,000–20,000 housing units across multiple regions.\n    28→\n    29→1.5 Simulated Organisation\n    30→    Name:           Riverside Crescent Housing Association (RCHA)\n    31→    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    32→    Stock:          75 properties, 68 tenants, 279+ cases\n    33→    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)\n    34→    UPRNs:          Realistic 12-digit references\n    35→    EPCs:           Mapped to real certificates where available\n    36→\n    37→1.6 Built By\n    38→    Yantra Works — an AI-native development studio.\n    39→\n    40→\n    41→2. CORE FUNCTIONAL MODULES\n    42→================================================================================\n    43→\n    44→2.1 Dashboard\n    45→    Route: /dashboard\n    46→    Purpose: Real-time operational overview with persona-scoped KPIs\n    47→    Features:\n    48→    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)\n    49→    - KPI trend sparklines (12 months)\n    50→    - Activity feed with live updates\n    51→    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    52→    - Quick action buttons for common tasks\n    53→\n    54→2.2 Visual Drill-Down Explorer\n    55→    Route: /explore\n    56→    Purpose: 7-level spatial hierarchy navigation\n    57→    Hierarchy:\n    58→      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    59→    Features:\n    60→    - Interactive Leaflet map with property markers\n    61→    - Three.js 3D building visualization (digital twin)\n    62→    - Context panel with attributes, KPIs, compliance, AI insights\n    63→    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)\n    64→    - Data layer toggles: Crime, Damp Risk, Compliance\n    65→    - Click-through navigation from any level\n    66→\n    67→2.3 Tenancies Management\n    68→    Route: /tenancies, /tenancies/:id\n    69→    Purpose: Tenancy lifecycle management\n    70→    Features:\n    71→    - Tenancy list with search, filter, sort\n    72→    - Tenancy detail: household composition, rent account, case timeline\n    73→    - Vulnerability detection (AI 7-factor scoring)\n    74→    - Benefits entitlement check\n    75→    - Arrears status with color-coded balance\n    76→    - 52-week transaction ledger with balance trend chart\n    77→    - Action workflows: arrears action, schedule visit, create case\n    78→\n    79→2.4 Properties Management\n    80→    Route: /properties, /properties/:id\n    81→    Purpose: Property and asset data management\n    82→    Features:\n    83→    - Property list with mini Leaflet map\n    84→    - Property detail: building attributes, compliance certificates, case history\n    85→    - Property Passport (multi-source AI aggregation)\n    86→    - Damp Intelligence Panel (5-factor predictive score)\n    87→    - Compliance timeline (Big 6 certificates)\n    88→    - Viewing bookings and allocation workflow\n    89→    - Digital twin (3D block visualization)\n    90→\n    91→2.5 Repairs Management\n    92→    Route: /repairs, /repairs/:id\n    93→    Purpose: Responsive and planned repairs case management\n    94→    Features:\n    95→    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)\n    96→    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    97→    - Appointment booking with time slots\n    98→    - Operative notes, before/after photos\n    99→    - Contractor verification badges (Gas Safe, NICEIC)\n   100→    - Satisfaction survey (post-completion)\n   101→    - Recurrence prediction (AI)\n   102→    - Cost tracking and authorisation workflow\n   103→\n   104→2.6 Compliance Management\n   105→    Route: /compliance, /compliance/:type\n   106→    Purpose: Regulatory compliance tracking and Awaab's Law\n   107→    Features:\n   108→    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n   109→    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n   110→    - Awaab's Law dedicated page (/compliance/awaabs-law):\n   111→      - Emergency hazard response: 24-hour countdown timer\n   112→      - Significant hazard repair: 10–12 week countdown timer\n   113→      - Risk register with property-level assessments\n   114→      - Proactive inspection programme tracking\n   115→    - Building-level compliance: Fire Risk Assessment, Building Safety Case\n   116→    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n   117→    - Compliance failure prediction (AI)\n   118→\n   119→2.7 Complaints Management\n   120→    Route: /complaints, /complaints/:id\n   121→    Purpose: Two-stage complaints handling (Housing Ombudsman code)\n   122→    Features:\n   123→    - Complaint list with status filtering\n   124→    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)\n   125→    - Deadline countdown timers with color-coded urgency\n   126→    - Ombudsman escalation pathway\n   127→    - Complaint escalation prediction (AI)\n   128→    - Linked cases and evidence log\n   129→    - TSM reporting integration\n   130→\n   131→2.8 Anti-Social Behaviour (ASB)\n   132→    Route: /asb, /asb/:id\n   133→    Purpose: ASB case management with escalation pipeline\n   134→    Features:\n   135→    - ASB case list with severity indicators\n   136→    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n   137→    - Evidence log with timestamps and categories\n   138→    - Live Crime Context (Police.uk data correlation)\n   139→    - ASB hotspot analysis per estate\n   140→    - ASB escalation prediction (AI)\n   141→    - Witness/victim support tracking\n   142→    - Community Trigger threshold monitoring\n   143→\n   144→2.9 Rent & Arrears\n   145→    Route: /rent\n   146→    Purpose: Rent management and arrears recovery\n   147→    Features:\n   148→    - Arrears dashboard with band analysis\n   149→    - Pre-Action Protocol (PAP) checklist\n   150→    - Arrears worklist with priority scoring\n   151→    - Universal Credit tracking and verification\n   152→    - Payment arrangement management\n   153→    - Direct debit integration (GoCardless mock)\n   154→    - HB/UC transition tracking\n   155→    - Arrears risk prediction (AI)\n   156→    - 12-month payment trend analysis\n   157→\n   158→2.10 Allocations & Lettings\n   159→    Route: /allocations\n   160→    Purpose: Void management and lettings workflow\n   161→    Features:\n   162→    - Housing register management\n   163→    - Void property kanban (keys received → inspection → works → ready → let)\n   164→    - Void duration prediction (AI)\n   165→    - Applicant shortlisting and matching\n   166→    - Viewing booking system\n   167→    - Tenancy sign-up workflow\n   168→    - CORE lettings/sales reporting\n   169→\n   170→2.11 Communications\n   171→    Route: /communications\n   172→    Purpose: Unified multi-channel inbox\n   173→    Features:\n   174→    - Unified inbox (email, SMS, letter, portal message)\n   175→    - GOV.UK Notify template integration (24 templates, 7 categories)\n   176→    - Template rendering with ((field)) personalisation\n   177→    - Message history per tenant\n   178→    - Bulk communications\n   179→    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n   180→\n   181→2.12 Reports & Analytics\n   182→    Route: /reports, /reports/:type\n   183→    Purpose: Regulatory reporting and operational analytics\n   184→    Features:\n   185→    - 27 regulatory reports\n   186→    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n   187→    - CORE lettings and sales returns\n   188→    - Consumer Standards compliance scorecard\n   189→    - Housing Ombudsman reporting\n   190→    - Building Safety Act compliance reporting\n   191→    - Dynamic report builder with filters\n   192→    - CSV/PDF export capability\n   193→    - Trend charts, sector median/quartile benchmarking\n   194→\n   195→2.13 AI Centre\n   196→    Route: /ai-centre\n   197→    Purpose: AI capabilities hub and differentiator showcase\n   198→    Features:\n   199→    - Insights tab: AI-generated operational insights\n   200→    - Predictions tab: 8 predictive models dashboard\n   201→    - Differentiators tab: 7 killer differentiator feature cards\n   202→    - Vulnerability scan: Bulk tenant vulnerability assessment\n   203→    - Assistant tab: Conversational AI interface\n   204→\n   205→2.14 AI Morning Briefing\n   206→    Route: /briefing\n   207→    Purpose: Personalised daily operational briefing\n   208→    Features:\n   209→    - Persona-aware greeting and summary\n   210→    - Weather forecast with property impact assessment\n   211→    - Today's tasks with priority indicators\n   212→    - AI predictions and alerts\n   213→    - Estate-level neighbourhood briefing accordion\n   214→    - Compliance section with Big 6 stats\n   215→\n   216→2.15 Admin System\n   217→    Route: /admin, /admin/integrations\n   218→    Purpose: System configuration and management\n   219→    Features:\n   220→    - Organisation profile and branding\n   221→    - User management with RBAC (10 default roles)\n   222→    - Team and patch management\n   223→    - Workflow engine (visual builder with triggers/conditions/actions)\n   224→    - Integration hub (20 integrations across 3 tiers)\n   225→    - Integration toggle, test connection, status monitoring\n   226→    - Audit trail (full CRUD logging)\n   227→    - GDPR tools (SAR, erasure, retention policies)\n   228→    - System reference data configuration\n   229→    - Notification configuration\n   230→    - AI model configuration\n   231→\n   232→2.16 Tenant Portal\n   233→    Route: /tenant-portal\n   234→    Purpose: Tenant self-service interface\n   235→    Features:\n   236→    - Distinct lighter/warmer UI theme\n   237→    - Report repair (conversational wizard)\n   238→    - Check rent balance and make payment\n   239→    - View active repairs with photos and status\n   240→    - Quick message to housing officer\n   241→    - Document access\n   242→\n   243→\n   244→3. PERSONA SYSTEM\n   245→================================================================================\n   246→\n   247→3.1 Overview\n   248→    5 operational personas with scoped data visibility and dashboard layout.\n   249→    Persona selection via sidebar switcher. Persisted per session.\n   250→\n   251→3.2 Persona Definitions\n   252→\n   253→    PERSONA 1: Chief Operating Officer (COO)\n   254→    Scope: Organisation-wide\n   255→    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap\n   256→    Access: Full read/write, admin settings, reports\n   257→\n   258→    PERSONA 2: Head of Housing\n   259→    Scope: Regional (multiple Local Authorities)\n   260→    Dashboard: Regional performance, team metrics, escalated cases\n   261→    Access: Team management, regional reports, case oversight\n   262→\n   263→    PERSONA 3: Housing Manager\n   264→    Scope: Estate/Block level\n   265→    Dashboard: Estate KPIs, staff workload, compliance deadlines\n   266→    Access: Case assignment, approval workflows, local reports\n   267→\n   268→    PERSONA 4: Housing Officer\n   269→    Scope: Assigned patch (specific estates/blocks)\n   270→    Dashboard: Caseload worklist, today's visits, tenant alerts\n   271→    Access: Case CRUD, tenant interactions, notes\n   272→\n   273→    PERSONA 5: Repairs Operative\n   274→    Scope: Assigned jobs\n   275→    Dashboard: Today's job list, materials, access notes\n   276→    Access: Repair status updates, photos, completion notes\n   277→\n   278→\n   279→4. AI-NATIVE FEATURES\n   280→================================================================================\n   281→\n   282→4.1 Dynamic AI Interface Elements\n   283→    - Purple-bordered AI-generated buttons, fields, and prompts\n   284→    - Appear contextually based on entity state and user role\n   285→    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create\n   286→\n   287→4.2 Yantra Assist\n   288→    Location: Bottom-left floating trigger (all pages)\n   289→    Features:\n   290→    - Contextual urgent items panel\n   291→    - AI-generated insights for current page\n   292→    - Daily briefing summary\n   293→    - External factors affecting current entity\n   294→    - Natural language query interface\n   295→\n   296→4.3 Prediction Models (8 total)\n   297→    MODEL 1: Arrears Risk\n   298→      Input: Payment history, UC status, household changes, employment\n   299→      Output: Risk score (0–100), predicted arrears amount, recommended actions\n   300→\n   301→    MODEL 2: Damp & Mould Risk\n   302→      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n   303→             IoT sensors (0.20), occupancy (0.10)\n   304→      Output: Risk score (0–100), factor breakdown, proactive recommendations\n   305→\n   306→    MODEL 3: Complaint Escalation\n   307→      Input: Response times, complaint category, tenant history, complexity\n   308→      Output: Escalation probability, recommended priority, deadline warnings\n   309→\n   310→    MODEL 4: Void Duration\n   311→      Input: Property type, condition, location, market demand, works needed\n   312→      Output: Predicted void days, optimal marketing strategy\n   313→\n   314→    MODEL 5: Repair Recurrence\n   315→      Input: Component age, repair history, building type, contractor quality\n   316→      Output: Recurrence probability, recommended planned maintenance\n   317→\n   318→    MODEL 6: Vulnerability Detection\n   319→      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n   320→             social isolation (0.15), age risk (0.10), dependents (0.10),\n   321→             UC transition (0.10)\n   322→      Output: Vulnerability score (0–100), detected flags, recommended support\n   323→\n   324→    MODEL 7: ASB Escalation\n   325→      Input: Case history, estate context, crime data, tenant profile\n   326→      Output: Escalation risk, recommended intervention level\n   327→\n   328→    MODEL 8: Compliance Failure\n   329→      Input: Certificate expiry, contractor availability, building complexity\n   330→      Output: Failure probability, priority scheduling recommendations\n   331→\n   332→4.4 Seven Killer Differentiators\n   333→    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n   334→    D2: Live Crime Context for ASB — Police.uk data correlation\n   335→    D3: Automatic Vulnerability Detection — 7-factor scoring\n   336→    D4: Property Passport — Multi-source property dossier\n   337→    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n   338→    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n   339→    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n   340→\n   341→\n   342→5. DATA MODEL (SUMMARY)\n   343→================================================================================\n   344→\n   345→5.1 Core Entities\n   346→    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n   347→    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n   348→    - Tenancy — property–tenant link, start date, type, rent, balance\n   349→    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n   350→    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n   351→    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n   352→    - ASB (12 records) — severity, escalation level, evidence log\n   353→    - Activity — timeline events for any entity\n   354→    - Task — assigned work items with due dates\n   355→\n   356→5.2 Supporting Entities\n   357→    - Organisation — RCHA metadata, branding, settings\n   358→    - Region (3) — London, South, Midlands\n   359→    - Local Authority — Southwark, Lewisham, Lambeth\n   360→    - Estate (5) — name, location, block count, manager\n   361→    - Block — floors, cores, unit count\n   362→    - User — auth profile, role, persona, team\n   363→    - Team — name, manager, patch, members\n   364→    - Integration — external service config (20 integrations)\n   365→    - Report — template definitions (27 reports)\n   366→    - ExternalDataCache — TTL-based cache for API responses\n   367→\n   368→5.3 Firestore Collections (17)\n   369→    users, properties, tenants, cases, activities, tasks,\n   370→    repairs, complaints, asb, financial, damp-mould,\n   371→    organisations, teams, integrations, auditLog,\n   372→    externalDataCache, imdData\n   373→\n   374→\n   375→6. USER INTERFACE DESIGN\n   376→================================================================================\n   377→\n   378→6.1 Theme\n   379→    Brand: Yantra Works dark theme\n   380→    Primary Background: Dark (gray-900 / slate-900)\n   381→    Accent: Brand teal (#14b8a6)\n   382→    Secondary: Peach, garnet, purple (for AI elements)\n   383→    Typography: System font stack, clean hierarchy\n   384→\n   385→6.2 Layout\n   386→    - Fixed left sidebar (collapsible) with 14 navigation items\n   387→    - Top header with logo, global search, notifications, user menu\n   388→    - Breadcrumb navigation reflecting hierarchy\n   389→    - Main content area with responsive grid\n   390→    - Yantra Assist floating panel (bottom-left)\n   391→\n   392→6.3 Navigation Items (Sidebar)\n   393→    1. Dashboard        8. Communications\n   394→    2. Explore          9. Reports\n   395→    3. Tenancies       10. AI Centre\n   396→    4. Properties      11. Admin\n   397→    5. Repairs         12. Tenant Portal\n   398→    6. Compliance      13. ---\n   399→    7. Complaints      14. Persona Switcher\n   400→    + ASB, Rent, Allocations (sub-items)\n   401→\n   402→6.4 Design Principles\n   403→    - Mobile-aware responsive design\n   404→    - WCAG AA compliant (contrast, focus, keyboard, ARIA)\n   405→    - Skip-to-content link\n   406→    - Reduced-motion support (@media prefers-reduced-motion)\n   407→    - Focus-visible outlines on all interactive elements\n   408→    - Screen-reader-only (.sr-only) text for context\n   409→\n   410→6.5 Component Library\n   411→    - KpiCard — metric display with trend sparkline\n   412→    - StatusPill — status badge (green/amber/red)\n   413→    - ActionModal — accessible form modal with validation\n   414→    - AiActionCard — purple-bordered AI suggestion card\n   415→    - CountdownTimer — deadline countdown with color urgency\n   416→    - PropertyMap — Leaflet map with markers\n   417→    - HelpDrawer — full-screen contextual help (20 topics)\n   418→    - DampIntelligencePanel — damp risk factor display\n   419→    - VulnerabilityPanel — 7-factor vulnerability assessment\n   420→    - BenefitsPanel — entitlement list with status icons\n   421→    - NeighbourhoodBriefingPanel — estate-level daily briefing\n   422→\n   423→\n   424→7. REGULATORY COMPLIANCE\n   425→================================================================================\n   426→\n   427→7.1 Housing Regulations Supported\n   428→    - Housing Ombudsman Complaint Handling Code (2024)\n   429→    - Awaab's Law (Social Housing Regulation Act 2023)\n   430→    - Building Safety Act 2022\n   431→    - Regulator of Social Housing (RSH) Consumer Standards\n   432→    - Tenant Satisfaction Measures (TSM) Standard\n   433→    - CORE lettings and sales data collection\n   434→    - Gas Safety (Installation and Use) Regulations 1998\n   435→    - Electrical Safety Standards in the Private Rented Sector\n   436→    - Regulatory Reform (Fire Safety) Order 2005\n   437→    - Control of Asbestos Regulations 2012\n   438→    - Legionella risk assessment (HSE ACoP L8)\n   439→    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n   440→\n   441→7.2 GDPR Compliance\n   442→    - Full audit trail on all data operations\n   443→    - Subject Access Request (SAR) support\n   444→    - Right to erasure workflow\n   445→    - Data retention policy configuration\n   446→    - Consent management\n   447→\n   448→\n   449→8. NON-FUNCTIONAL REQUIREMENTS\n   450→================================================================================\n   451→\n   452→8.1 Performance\n   453→    - API response time (P95): < 500ms\n   454→    - Frontend bundle size: < 3MB\n   455→    - Cloud Run cold start: < 3s\n   456→    - Firestore query latency: < 200ms\n   457→\n   458→8.2 Security\n   459→    - Firebase Authentication with Google sign-in\n   460→    - RBAC with 10 default roles\n   461→    - CSP headers with whitelist\n   462→    - CORS restricted to allowed origins\n   463→    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   464→    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)\n   465→    - Secret Manager for all credentials (no secrets in code)\n   466→    - JSON body limit 1MB\n   467→\n   468→8.3 Scalability\n   469→    - Cloud Run: 0–10 instances (auto-scaling)\n   470→    - Firestore: NoSQL, horizontally scalable\n   471→    - External API caching reduces load\n   472→\n   473→8.4 Availability\n   474→    - Cloud Run SLA: 99.95%\n   475→    - External API fallbacks (simulated data on failure)\n   476→    - Health check with Firestore connectivity monitoring\n   477→\n   478→8.5 Accessibility (WCAG AA)\n   479→    - Focus traps in modals\n   480→    - Skip-to-content link\n   481→    - Keyboard navigation (Tab, Escape)\n   482→    - ARIA labels, roles, described-by\n   483→    - Reduced-motion media query\n   484→    - Color contrast ratio ≥ 4.5:1\n   485→\n   486→8.6 Testing\n   487→    - Selenium E2E: 332 tests, 99.7% pass rate\n   488→    - Unit tests: 66 tests for public data APIs\n   489→    - TypeScript: 0 errors (strict mode)\n   490→    - Vite build: 0 critical warnings\n   491→\n   492→\n   493→9. CURRENT STATUS & METRICS\n   494→================================================================================\n   495→\n   496→9.1 Production Deployment\n   497→    URL: https://socialhomes-587984201316.europe-west2.run.app\n   498→    Region: europe-west2 (London)\n   499→    Status: LIVE and operational\n   500→    Database: 460+ documents across 17 Firestore collections\n   501→\n   502→9.2 Build Metrics\n   503→    | Metric                    | Value           |\n   504→    |---------------------------|-----------------|\n   505→    | Frontend modules          | 3,397           |\n   506→    | Frontend build time       | ~35–39 seconds  |\n   507→    | Backend TypeScript errors | 0               |\n   508→    | Frontend TypeScript errors| 0               |\n   509→    | Selenium tests            | 332             |\n   510→    | Selenium pass rate        | 99.7%           |\n   511→    | Unit tests (public data)  | 66              |\n   512→    | Firestore collections     | 17              |\n   513→    | Seeded properties         | 75              |\n   514→    | Seeded tenants            | 68              |\n   515→    | Seeded cases              | 279+            |\n   516→    | API endpoints             | 50+             |\n   517→    | Frontend routes           | 40+             |\n   518→\n   519→================================================================================\n   520→  End of Doc1 — SocialHomes.Ai Base Specification\n   521→  Yantra Works | 2026-02-18\n   522→================================================================================\n   523→"}]},"uuid":"190709c2-46f3-4c30-8458-f22069a480b2","timestamp":"2026-02-23T18:40:38.227Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)\n    - KPI trend sparklines (12 months)\n    - Activity feed with live updates\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    Features:\n    - Interactive Leaflet map with property markers\n    - Three.js 3D building visualization (digital twin)\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search, filter, sort\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n\n2.4 Properties Management\n    Route: /properties, /properties/:id\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page (/compliance/awaabs-law):\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: Fire Risk Assessment, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman code)\n    Features:\n    - Complaint list with status filtering\n    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM reporting integration\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - ASB case list with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with priority scoring\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management\n    - Void property kanban (keys received → inspection → works → ready → let)\n    - Void duration prediction (AI)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights\n    - Predictions tab: 8 predictive models dashboard\n    - Differentiators tab: 7 killer differentiator feature cards\n    - Vulnerability scan: Bulk tenant vulnerability assessment\n    - Assistant tab: Conversational AI interface\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting and summary\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles)\n    - Team and patch management\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging)\n    - GDPR tools (SAR, erasure, retention policies)\n    - System reference data configuration\n    - Notification configuration\n    - AI model configuration\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme\n    - Report repair (conversational wizard)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap\n    Access: Full read/write, admin settings, reports\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n\n    PERSONA 4: Housing Officer\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Dynamic AI Interface Elements\n    - Purple-bordered AI-generated buttons, fields, and prompts\n    - Appear contextually based on entity state and user role\n    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create\n\n4.2 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Features:\n    - Contextual urgent items panel\n    - AI-generated insights for current page\n    - Daily briefing summary\n    - External factors affecting current entity\n    - Natural language query interface\n\n4.3 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, household changes, employment\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.4 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: Dark (gray-900 / slate-900)\n    Accent: Brand teal (#14b8a6)\n    Secondary: Peach, garnet, purple (for AI elements)\n    Typography: System font stack, clean hierarchy\n\n6.2 Layout\n    - Fixed left sidebar (collapsible) with 14 navigation items\n    - Top header with logo, global search, notifications, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid\n    - Yantra Assist floating panel (bottom-left)\n\n6.3 Navigation Items (Sidebar)\n    1. Dashboard        8. Communications\n    2. Explore          9. Reports\n    3. Tenancies       10. AI Centre\n    4. Properties      11. Admin\n    5. Repairs         12. Tenant Portal\n    6. Compliance      13. ---\n    7. Complaints      14. Persona Switcher\n    + ASB, Rent, Allocations (sub-items)\n\n6.4 Design Principles\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n\n6.5 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with validation\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons\n    - NeighbourhoodBriefingPanel — estate-level daily briefing\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) support\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n\n8.5 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n\n8.6 Testing\n    - Selenium E2E: 332 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. CURRENT STATUS & METRICS\n================================================================================\n\n9.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n9.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 332             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-18\n================================================================================\n","numLines":523,"startLine":1,"totalLines":523}},"sourceToolAssistantUUID":"38c6b656-1dcd-4b6f-a489-1d2d746f6271"}
{"parentUuid":"190709c2-46f3-4c30-8458-f22069a480b2","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YHvABiaXJ5pPkZYZi9rMoV","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"bafec079-711b-452a-a5e7-f5250fa2ec1e","timestamp":"2026-02-23T18:40:38.640Z"}
{"parentUuid":"bafec079-711b-452a-a5e7-f5250fa2ec1e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YHvABiaXJ5pPkZYZi9rMoV","type":"tool_result","content":"     1→================================================================================\n     2→  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n     3→  Version: 2.0  |  Date: 2026-02-18\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. SYSTEM ARCHITECTURE OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Architecture Style\n    11→    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    12→    deployed as a single container on Google Cloud Run. The Express server\n    13→    serves both the API and the built React static assets.\n    14→\n    15→1.2 High-Level Architecture Diagram (ASCII)\n    16→\n    17→    ┌─────────────────────────────────────────────────────────────────┐\n    18→    │                        CLOUD RUN (europe-west2)                │\n    19→    │  ┌───────────────────────────────────────────────────────────┐  │\n    20→    │  │                    Express.js Server                      │  │\n    21→    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    22→    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    23→    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    24→    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    25→    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    26→    │  │  │ Output       │  │ modules      │  │               │  │  │\n    27→    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    28→    │  └───────────────────────────┼───────────────────────────────┘  │\n    29→    │                              │                                  │\n    30→    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    31→    │  │                    Service Layer                          │  │\n    32→    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    33→    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    34→    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    35→    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    36→    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    37→    │  └───────────────────────────┼───────────────────────────────┘  │\n    38→    └──────────────────────────────┼──────────────────────────────────┘\n    39→                                   │\n    40→              ┌────────────────────┼────────────────────┐\n    41→              │                    │                     │\n    42→    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    43→    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    44→    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    45→    └────────────────┘  └────────────────┘  └────────────────┘\n    46→              │\n    47→    ┌─────────▼──────────────────────────────────────────┐\n    48→    │              External APIs (3 Tiers)               │\n    49→    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    50→    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    51→    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    52→    └────────────────────────────────────────────────────┘\n    53→\n    54→\n    55→2. TECHNOLOGY STACK\n    56→================================================================================\n    57→\n    58→2.1 Frontend Stack\n    59→\n    60→    | Component          | Technology              | Version    |\n    61→    |--------------------|-------------------------|------------|\n    62→    | Framework          | React                   | 19         |\n    63→    | Language           | TypeScript              | 5.9        |\n    64→    | Router             | React Router            | v7         |\n    65→    | Styling            | Tailwind CSS            | v4         |\n    66→    | State Management   | React Context + Hooks   | —          |\n    67→    | Data Fetching      | @tanstack/react-query   | latest     |\n    68→    | 3D Visualization   | Three.js (@react-three) | r128       |\n    69→    | Maps               | Leaflet + React Leaflet | 1.9        |\n    70→    | Charts             | Recharts + D3.js        | latest     |\n    71→    | Icons              | Lucide React            | latest     |\n    72→    | Auth UI            | FirebaseUI              | latest     |\n    73→    | Build Tool         | Vite                    | 7.2        |\n    74→\n    75→2.2 Backend Stack\n    76→\n    77→    | Component          | Technology              | Version    |\n    78→    |--------------------|-------------------------|------------|\n    79→    | Framework          | Express.js              | 4          |\n    80→    | Language           | TypeScript              | 5.7        |\n    81→    | Runtime            | Node.js                 | 20.17.0    |\n    82→    | Database           | Google Firestore        | latest     |\n    83→    | Auth               | Firebase Admin SDK      | latest     |\n    84→    | Security           | Helmet                  | latest     |\n    85→    | Logging            | Morgan + structured     | latest     |\n    86→    | Testing            | Vitest                  | latest     |\n    87→    | Build              | tsc + tsx               | latest     |\n    88→\n    89→2.3 Infrastructure\n    90→\n    91→    | Component          | Technology              | Details            |\n    92→    |--------------------|-------------------------|--------------------|\n    93→    | Hosting            | Google Cloud Run        | europe-west2       |\n    94→    | Container Registry | Artifact Registry       | europe-west2       |\n    95→    | Database           | Google Firestore        | Native mode        |\n    96→    | Authentication     | Firebase Auth           | Google SSO + email |\n    97→    | Secrets            | Secret Manager          | 4 secrets          |\n    98→    | CI/CD              | Cloud Build             | Auto on git push   |\n    99→    | Source Control      | GitHub                  | rajivpeter repo    |\n   100→    | Monitoring         | Custom metrics + health | In-app             |\n   101→\n   102→2.4 Testing Stack\n   103→\n   104→    | Component          | Technology              | Coverage           |\n   105→    |--------------------|-------------------------|--------------------|\n   106→    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |\n   107→    | Unit               | Vitest                  | 66 tests           |\n   108→    | Type Checking      | TypeScript (strict)     | 0 errors           |\n   109→\n   110→\n   111→3. FRONTEND ARCHITECTURE\n   112→================================================================================\n   113→\n   114→3.1 Directory Structure\n   115→\n   116→    app/src/\n   117→    ├── App.tsx                  — Router with 40+ routes\n   118→    ├── main.tsx                 — React DOM entry point\n   119→    ├── index.css                — Global styles + animations\n   120→    │\n   121→    ├── pages/                   — 19 page directories\n   122→    │   ├── admin/               — AdminPage, IntegrationsPage\n   123→    │   ├── ai-centre/           — AiCentrePage\n   124→    │   ├── allocations/         — AllocationsPage\n   125→    │   ├── asb/                 — AsbPage, AsbDetailPage\n   126→    │   ├── auth/                — LoginPage\n   127→    │   ├── briefing/            — BriefingPage\n   128→    │   ├── communications/      — CommunicationsPage\n   129→    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n   130→    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n   131→    │   ├── dashboard/           — DashboardPage\n   132→    │   ├── explore/             — ExplorePage (7-level drill-down)\n   133→    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.\n   134→    │   ├── rent/                — RentPage\n   135→    │   ├── repairs/             — RepairsPage, RepairDetailPage\n   136→    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n   137→    │   ├── search/              — SearchPage\n   138→    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n   139→    │   ├── tenant-portal/       — TenantPortalPage\n   140→    │   └── shared/              — ComingSoonPage\n   141→    │\n   142→    ├── components/\n   143→    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n   144→    │   └── shared/              — Reusable components (12 files)\n   145→    │\n   146→    ├── data/                    — Mock/seed data (10 files)\n   147→    ├── hooks/                   — Custom hooks (3 files)\n   148→    ├── types/                   — TypeScript definitions (721 lines)\n   149→    ├── services/                — API client, public data helpers\n   150→    ├── contexts/                — Auth, User contexts\n   151→    ├── utils/                   — Utility helpers\n   152→    └── assets/                  — Images, fonts\n   153→\n   154→3.2 Routing Architecture (React Router v7)\n   155→    All routes defined in App.tsx within a BrowserRouter.\n   156→    Routes wrapped in Layout component (sidebar + header).\n   157→    Protected routes use ProtectedRoute component (Firebase auth guard).\n   158→\n   159→    Key Route Groups:\n   160→    /                           → Redirect to /dashboard\n   161→    /login                      → LoginPage (public)\n   162→    /dashboard                  → DashboardPage\n   163→    /explore                    → ExplorePage\n   164→    /tenancies                  → TenanciesPage\n   165→    /tenancies/:id              → TenancyDetailPage\n   166→    /properties                 → PropertiesPage\n   167→    /properties/:id             → PropertyDetailPage\n   168→    /properties/:id/apply       → ApplicationPage\n   169→    /properties/:id/book-viewing→ ViewingBookingPage\n   170→    /repairs                    → RepairsPage\n   171→    /repairs/:id                → RepairDetailPage\n   172→    /compliance                 → CompliancePage\n   173→    /compliance/:type           → ComplianceTypePage\n   174→    /compliance/awaabs-law      → AwaabsLawPage\n   175→    /complaints                 → ComplaintsPage\n   176→    /complaints/:id             → ComplaintDetailPage\n   177→    /asb                        → AsbPage\n   178→    /asb/:id                    → AsbDetailPage\n   179→    /rent                       → RentPage\n   180→    /allocations                → AllocationsPage\n   181→    /communications             → CommunicationsPage\n   182→    /reports                    → ReportsPage\n   183→    /reports/:type              → DynamicReportPage\n   184→    /reports/tsm                → TsmReportPage\n   185→    /ai-centre                  → AiCentrePage\n   186→    /briefing                   → BriefingPage\n   187→    /admin                      → AdminPage\n   188→    /admin/integrations         → IntegrationsPage\n   189→    /tenant-portal              → TenantPortalPage\n   190→    /search                     → SearchPage\n   191→\n   192→3.3 State Management\n   193→    - React Context for global state (auth user, persona)\n   194→    - @tanstack/react-query for server state (API data caching, polling)\n   195→    - Local component state (useState, useReducer) for UI state\n   196→    - No Redux/Zustand — kept deliberately simple\n   197→\n   198→3.4 Data Fetching Layer\n   199→    - api-client.ts: 70+ typed API methods organized by domain\n   200→    - useApi.ts: React Query hooks wrapping api-client methods\n   201→    - useEntityIntelligence.ts: AI scoring hooks\n   202→    - usePersonaScope.ts: Persona-based data filtering\n   203→\n   204→3.5 Frontend Conventions\n   205→    - safeText() helper for rendering potentially undefined values\n   206→    - ?? [] for nullable arrays (prevents React Error #310)\n   207→    - Tailwind CSS utility classes (no CSS modules)\n   208→    - Lucide React for all icons\n   209→    - Purple border for AI-generated elements\n   210→    - Consistent page structure: header + filter bar + content grid\n   211→\n   212→\n   213→4. BACKEND ARCHITECTURE\n   214→================================================================================\n   215→\n   216→4.1 Directory Structure\n   217→\n   218→    server/src/\n   219→    ├── index.ts                 — Express entry, middleware, route registration\n   220→    │\n   221→    ├── middleware/               — 5 middleware modules\n   222→    │   ├── auth.ts              — Firebase token verification\n   223→    │   ├── error-handler.ts     — Structured JSON error handler\n   224→    │   ├── metrics.ts           — Request/response metrics recording\n   225→    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n   226→    │   └── rbac.ts              — Role-based access control\n   227→    │\n   228→    ├── routes/                  — 16 route modules (2,300+ lines)\n   229→    │   ├── admin.ts             — Integration management, monitoring\n   230→    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n   231→    │   ├── auth.ts              — Login, register, logout\n   232→    │   ├── briefing.ts          — Personalised morning briefing\n   233→    │   ├── booking.ts           — Viewing bookings, applications\n   234→    │   ├── cases.ts             — Unified case CRUD + pagination\n   235→    │   ├── compliance.ts        — Big 6 compliance data\n   236→    │   ├── explore.ts           — Hierarchy drill-down data\n   237→    │   ├── export.ts            — CSV/PDF exports\n   238→    │   ├── lettings.ts          — Void management, allocations\n   239→    │   ├── properties.ts        — Property list/detail\n   240→    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n   241→    │   ├── rent.ts              — Arrears, statements, transactions\n   242→    │   ├── reports.ts           — 27 regulatory reports\n   243→    │   └── tenants.ts           — Tenant list/detail\n   244→    │\n   245→    ├── services/                — 20 service modules\n   246→    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n   247→    │   ├── firestore.ts         — Firestore connection + helpers\n   248→    │   ├── firebase-admin.ts    — Firebase Admin initialization\n   249→    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n   250→    │   ├── crime-context.ts     — Police data correlation\n   251→    │   ├── vulnerability-detection.ts  — 7-factor scoring\n   252→    │   ├── benefits-engine.ts   — UK benefit rules engine\n   253→    │   ├── property-passport.ts — Multi-source aggregation\n   254→    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n   255→    │   ├── govuk-notify.ts      — 24 notification templates\n   256→    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical\n   257→    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints\n   258→    │   ├── monitoring.ts        — Metrics singleton\n   259→    │   ├── hact-export.ts       — HACT reporting format\n   260→    │   ├── seed.ts              — Database seeding\n   261→    │   ├── seed-data.ts         — Seed data definitions\n   262→    │   └── hact-codes.ts        — SOR code definitions\n   263→    │\n   264→    ├── models/\n   265→    │   ├── firestore-schemas.ts — Firestore collection schemas\n   266→    │   └── hact-codes.ts        — Repair code models\n   267→    │\n   268→    └── scripts/\n   269→        ├── seed-imd.ts          — IMD data loader\n   270→        └── seed.ts              — Main seed runner\n   271→\n   272→4.2 Middleware Pipeline (Request Flow)\n   273→\n   274→    Request → Morgan Logger → Helmet → CORS → Compression\n   275→            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n   276→            → Rate Limiter → Metrics Recorder → Route Handler\n   277→            → Error Handler → Response\n   278→\n   279→4.3 Rate Limiting (4 Tiers)\n   280→\n   281→    | Tier    | Routes              | Limit        | Window  |\n   282→    |---------|---------------------|--------------|---------|\n   283→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   284→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   285→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   286→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   287→\n   288→4.4 Error Handling\n   289→    - Structured JSON error responses\n   290→    - No stack traces leaked in production\n   291→    - Error logging with request ID correlation\n   292→    - Graceful degradation for external API failures\n   293→\n   294→4.5 Health Check\n   295→    GET /health → { status, firestore, uptime, memory, timestamp }\n   296→    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n   297→\n   298→\n   299→5. DATA MODELS (FIRESTORE)\n   300→================================================================================\n   301→\n   302→5.1 Collection Map (17 Collections)\n   303→\n   304→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   305→    │   organisations │     │     users        │     │     teams       │\n   306→    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n   307→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   308→                                     │\n   309→                                     ▼\n   310→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   311→    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n   312→    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n   313→    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n   314→             │                                               │\n   315→             ▼                                               ▼\n   316→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   317→    │   repairs       │     │   complaints     │     │      asb        │\n   318→    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n   319→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   320→                                                             │\n   321→    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐\n   322→    │   financial     │     │   damp-mould     │     │   activities    │\n   323→    │   (docs)        │     │   (docs)         │     │   (docs)        │\n   324→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   325→\n   326→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   327→    │   tasks         │     │  integrations    │     │    auditLog     │\n   328→    │   (docs)        │     │   (20 docs)      │     │   (docs)        │\n   329→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   330→\n   331→    ┌──────────────────────┐     ┌─────────────────┐\n   332→    │  externalDataCache   │     │    imdData       │\n   333→    │  (TTL-based cache)   │     │   (LSOA docs)    │\n   334→    └──────────────────────┘     └─────────────────┘\n   335→\n   336→5.2 Property Schema\n   337→\n   338→    {\n   339→      id: string                    // Firestore document ID\n   340→      uprn: string                  // 12-digit UPRN\n   341→      address: {\n   342→        line1: string\n   343→        line2?: string\n   344→        town: string\n   345→        postcode: string            // Real SE London postcode\n   346→        lat: number\n   347→        lng: number\n   348→        lsoaCode: string            // LSOA for IMD/Census\n   349→      }\n   350→      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n   351→      bedrooms: number\n   352→      floor?: number\n   353→      estateId: string\n   354→      blockId?: string\n   355→      buildYear: number\n   356→      heatingType: string\n   357→      wallType: string\n   358→      roofType: string\n   359→      epc: {\n   360→        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n   361→        score: number\n   362→        certificateNumber?: string\n   363→        expiryDate: string\n   364→      }\n   365→      compliance: {\n   366→        gasSafety: { status, expiryDate, certificateRef }\n   367→        electricalSafety: { status, expiryDate, certificateRef }\n   368→        fireRiskAssessment: { status, lastAssessmentDate }\n   369→        asbestos: { status, surveyDate }\n   370→        legionella: { status, assessmentDate }\n   371→        liftSafety?: { status, inspectionDate }\n   372→      }\n   373→      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n   374→      tenantId?: string\n   375→      createdAt: timestamp\n   376→      updatedAt: timestamp\n   377→    }\n   378→\n   379→5.3 Tenant Schema\n   380→\n   381→    {\n   382→      id: string\n   383→      title: string\n   384→      firstName: string\n   385→      lastName: string\n   386→      dateOfBirth: string\n   387→      email: string\n   388→      phone: string\n   389→      nino?: string                 // National Insurance Number\n   390→      propertyId: string\n   391→      tenancyId: string\n   392→      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n   393→      tenancyStartDate: string\n   394→      rent: {\n   395→        weeklyAmount: number\n   396→        balance: number             // Negative = arrears\n   397→        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n   398→        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n   399→      }\n   400→      household: [\n   401→        { name, relationship, dateOfBirth, isDependent }\n   402→      ]\n   403→      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n   404→      emergencyContact: {\n   405→        name: string\n   406→        phone: string\n   407→        relationship: string\n   408→      }\n   409→      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n   410→      createdAt: timestamp\n   411→      updatedAt: timestamp\n   412→    }\n   413→\n   414→5.4 Case Schema (Unified)\n   415→\n   416→    {\n   417→      id: string\n   418→      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n   419→             | 'safeguarding' | 'enquiry'\n   420→      reference: string             // e.g., REP-2025-001\n   421→      title: string\n   422→      description: string\n   423→      status: string                // Type-specific statuses\n   424→      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n   425→      propertyId: string\n   426→      tenantId: string\n   427→      assignedTo: string            // User ID\n   428→      createdDate: string\n   429→      updatedDate: string\n   430→      closedDate?: string\n   431→      sla: {\n   432→        targetDate: string\n   433→        breached: boolean\n   434→      }\n   435→      timeline: [\n   436→        { date, action, actor, notes }\n   437→      ]\n   438→      // Type-specific fields via discriminated union\n   439→      // See individual type schemas below\n   440→    }\n   441→\n   442→5.5 Repair Schema (extends Case)\n   443→\n   444→    {\n   445→      ...Case,\n   446→      type: 'repair',\n   447→      sorCode: string               // HACT SOR code\n   448→      trade: string                 // plumbing, electrical, carpentry, etc.\n   449→      appointment: {\n   450→        date: string\n   451→        timeSlot: string\n   452→        confirmedBy: string\n   453→      }\n   454→      contractor: {\n   455→        name: string\n   456→        company: string\n   457→        gasSafeNumber?: string\n   458→        niceicNumber?: string\n   459→      }\n   460→      cost: {\n   461→        estimated: number\n   462→        actual?: number\n   463→        authorised: boolean\n   464→      }\n   465→      photos: {\n   466→        before: string[]\n   467→        after: string[]\n   468→      }\n   469→      satisfaction?: {\n   470→        rating: number              // 1-5\n   471→        feedback: string\n   472→        date: string\n   473→      }\n   474→    }\n   475→\n   476→5.6 Complaint Schema (extends Case)\n   477→\n   478→    {\n   479→      ...Case,\n   480→      type: 'complaint',\n   481→      stage: 1 | 2\n   482→      category: string\n   483→      deadlines: {\n   484→        stage1Acknowledgement: string   // 5 working days\n   485→        stage1Response: string          // 10 working days\n   486→        stage2Response?: string         // 20 working days\n   487→      }\n   488→      ombudsmanRef?: string\n   489→      escalatedDate?: string\n   490→      outcome?: string\n   491→      learningActions: string[]\n   492→    }\n   493→\n   494→5.7 ASB Schema (extends Case)\n   495→\n   496→    {\n   497→      ...Case,\n   498→      type: 'asb',\n   499→      severity: 'low' | 'medium' | 'high' | 'critical'\n   500→      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n   501→      evidenceLog: [\n   502→        { date, type, description, attachments }\n   503→      ]\n   504→      perpetratorId?: string\n   505→      victimIds: string[]\n   506→      communityTrigger: boolean\n   507→    }\n   508→\n   509→5.8 ExternalDataCache Schema\n   510→\n   511→    {\n   512→      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n   513→      source: string                // API source identifier\n   514→      data: object                  // Cached response payload\n   515→      fetchedAt: timestamp          // When data was fetched\n   516→      ttl: number                   // TTL in seconds\n   517→      expiresAt: timestamp          // Computed expiry\n   518→      requestParams: object         // Original request parameters\n   519→    }\n   520→\n   521→5.9 Integration Schema\n   522→\n   523→    {\n   524→      id: string\n   525→      name: string\n   526→      tier: 1 | 2 | 3\n   527→      category: string\n   528→      status: 'active' | 'inactive' | 'error' | 'pending'\n   529→      enabled: boolean\n   530→      config: {\n   531→        baseUrl: string\n   532→        apiKey?: string\n   533→        rateLimit: number\n   534→      }\n   535→      stats: {\n   536→        lastUsed: string\n   537→        requestCount: number\n   538→        avgResponseTime: number\n   539→        cacheHitRate: number\n   540→        errorRate: number\n   541→      }\n   542→    }\n   543→\n   544→5.10 Firestore Indexes (Composite)\n   545→    Defined in firestore.indexes.json at project root.\n   546→    Key indexes for:\n   547→    - cases: (propertyId, type, createdDate DESC)\n   548→    - cases: (tenantId, type, createdDate DESC)\n   549→    - cases: (status, priority, createdDate DESC)\n   550→    - activities: (entityId, timestamp DESC)\n   551→    - externalDataCache: (source, expiresAt)\n   552→\n   553→\n   554→6. API ARCHITECTURE\n   555→================================================================================\n   556→\n   557→6.1 API Design Principles\n   558→    - RESTful design with /api/v1/ prefix\n   559→    - JSON request/response bodies\n   560→    - Consistent error format: { error, message, statusCode }\n   561→    - Pagination: ?page=N&limit=N (default 20)\n   562→    - Filtering: Query parameters per endpoint\n   563→    - Sorting: ?sort=field&order=asc|desc\n   564→    - Request correlation via X-Request-ID header\n   565→\n   566→6.2 API Route Registry (50+ endpoints)\n   567→\n   568→    AUTHENTICATION\n   569→    POST   /api/v1/auth/login          — Firebase token login\n   570→    POST   /api/v1/auth/register       — User registration\n   571→    POST   /api/v1/auth/logout         — Session invalidation\n   572→\n   573→    PROPERTIES\n   574→    GET    /api/v1/properties           — List with pagination/filter\n   575→    GET    /api/v1/properties/:id       — Property detail\n   576→\n   577→    TENANTS\n   578→    GET    /api/v1/tenants              — List with pagination/filter\n   579→    GET    /api/v1/tenants/:id          — Tenant detail\n   580→\n   581→    CASES (Unified)\n   582→    GET    /api/v1/cases                — List with type/status filter\n   583→    GET    /api/v1/cases/:id            — Case detail\n   584→    POST   /api/v1/cases                — Create case\n   585→    PUT    /api/v1/cases/:id            — Update case\n   586→    DELETE /api/v1/cases/:id            — Close/archive case\n   587→\n   588→    COMPLIANCE\n   589→    GET    /api/v1/compliance           — Big 6 summary dashboard\n   590→    GET    /api/v1/compliance/:type     — Type-specific data\n   591→\n   592→    EXPLORE\n   593→    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data\n   594→    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n   595→\n   596→    RENT\n   597→    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n   598→    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n   599→    GET    /api/v1/rent/transactions    — Transaction list\n   600→\n   601→    REPAIRS\n   602→    GET    /api/v1/repairs              — Repair list\n   603→    GET    /api/v1/repairs/:id          — Repair detail\n   604→\n   605→    REPORTS\n   606→    GET    /api/v1/reports              — Report catalog (27 types)\n   607→    GET    /api/v1/reports/:type        — Generate report data\n   608→    GET    /api/v1/reports/tsm          — TSM specific data\n   609→\n   610→    LETTINGS\n   611→    GET    /api/v1/lettings/voids       — Void property list\n   612→    GET    /api/v1/lettings/register    — Housing register\n   613→\n   614→    BOOKING\n   615→    POST   /api/v1/booking/viewing      — Book a viewing\n   616→    POST   /api/v1/booking/application  — Submit application\n   617→\n   618→    BRIEFING\n   619→    GET    /api/v1/briefing             — Personalised morning briefing\n   620→    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n   621→\n   622→    EXPORT\n   623→    GET    /api/v1/export/csv/:type     — CSV export\n   624→    GET    /api/v1/export/pdf/:type     — PDF export\n   625→\n   626→    AI INTELLIGENCE (14 endpoints)\n   627→    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n   628→    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n   629→    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n   630→    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n   631→    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n   632→    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan\n   633→    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n   634→    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n   635→    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n   636→    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n   637→    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n   638→    GET    /api/v1/ai/notify/template/:id                — Template detail\n   639→    POST   /api/v1/ai/notify/render                      — Render template\n   640→\n   641→    MOCK TIER 3 APIs\n   642→    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n   643→    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n   644→    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n   645→    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n   646→    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n   647→    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n   648→    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n   649→    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n   650→    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title\n   651→\n   652→    EXTERNAL DATA PROXY\n   653→    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data\n   654→    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather\n   655→    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk\n   656→    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup\n   657→    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n   658→    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data\n   659→    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market\n   660→    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n   661→    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify\n   662→\n   663→    ADMIN\n   664→    GET    /api/v1/admin/integrations                    — List integrations\n   665→    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n   666→    POST   /api/v1/admin/integrations/:id/test           — Test connection\n   667→    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n   668→\n   669→    HEALTH\n   670→    GET    /health                                        — Health check\n   671→\n   672→\n   673→7. EXTERNAL API INTEGRATION ARCHITECTURE\n   674→================================================================================\n   675→\n   676→7.1 Server-Side Proxy Pattern\n   677→    All external API calls are proxied through the Express server.\n   678→    Frontend NEVER calls external APIs directly.\n   679→\n   680→    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n   681→\n   682→7.2 Caching Strategy (Firestore-based)\n   683→    Collection: externalDataCache\n   684→    Pattern: Cache-through with TTL\n   685→\n   686→    | Data Source       | TTL      | Rationale                    |\n   687→    |-------------------|----------|------------------------------|\n   688→    | Weather           | 1 hour   | Forecast changes frequently  |\n   689→    | Crime data        | 24 hours | Updated monthly by Police.uk |\n   690→    | EPC certificates  | 30 days  | Rarely changes               |\n   691→    | Census data       | 90 days  | Static (Census 2021)         |\n   692→    | Postcode lookup   | 7 days   | Rarely changes               |\n   693→    | Gas Safe          | 24 hours | Registration status           |\n   694→    | IMD data          | 90 days  | Annual update cycle          |\n   695→\n   696→7.3 Rate Limiting (External APIs)\n   697→    Token bucket pattern per API source.\n   698→    Fair-use limit: 15 requests/second across all external APIs.\n   699→\n   700→7.4 Graceful Degradation\n   701→    All external APIs have simulated fallbacks.\n   702→    If an API fails or times out, the system returns realistic simulated data\n   703→    with a flag indicating the data source (live vs simulated).\n   704→\n   705→\n   706→8. SECURITY ARCHITECTURE\n   707→================================================================================\n   708→\n   709→8.1 Authentication Flow\n   710→    1. User visits /login\n   711→    2. FirebaseUI widget presents Google SSO or email/password\n   712→    3. Firebase returns ID token (JWT)\n   713→    4. Frontend stores token, sends in Authorization header\n   714→    5. Express middleware verifies token via Firebase Admin SDK\n   715→    6. User context loaded (role, persona, permissions)\n   716→\n   717→8.2 Authorization (RBAC)\n   718→    10 default roles with hierarchical permissions:\n   719→    - super-admin, org-admin, regional-manager, area-manager\n   720→    - housing-manager, senior-officer, housing-officer\n   721→    - repairs-coordinator, repairs-operative, read-only\n   722→\n   723→8.3 Security Headers\n   724→    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n   725→    - X-Content-Type-Options: nosniff\n   726→    - X-Frame-Options: DENY\n   727→    - Referrer-Policy: strict-origin-when-cross-origin\n   728→    - Permissions-Policy (camera, microphone, geolocation disabled)\n   729→    - Strict-Transport-Security: max-age=31536000\n   730→\n   731→8.4 Secrets Management\n   732→    All secrets stored in Google Secret Manager:\n   733→    - FIREBASE_API_KEY\n   734→    - FIREBASE_AUTH_DOMAIN\n   735→    - FIREBASE_PROJECT_ID\n   736→    - DEMO_USER_PASSWORD\n   737→    No secrets in source code or environment files.\n   738→\n   739→\n   740→9. DEPLOYMENT ARCHITECTURE\n   741→================================================================================\n   742→\n   743→9.1 Deployment Pipeline\n   744→\n   745→    Developer → git push origin main\n   746→                    │\n   747→                    ▼\n   748→    GitHub Repository (rajivpeter/SocialHomes_ai)\n   749→                    │\n   750→                    ▼\n   751→    Cloud Build (auto-triggered)\n   752→     ├── Step 1: Build React frontend (Vite)\n   753→     ├── Step 2: Build Express backend (tsc)\n   754→     └── Step 3: Build & push Docker image\n   755→                    │\n   756→                    ▼\n   757→    Artifact Registry (europe-west2)\n   758→     └── cloud-run-source-deploy/socialhomes:latest\n   759→                    │\n   760→                    ▼\n   761→    Cloud Run (europe-west2)\n   762→     ├── Min instances: 0\n   763→     ├── Max instances: 10\n   764→     ├── Memory: 1Gi\n   765→     ├── CPU: 1\n   766→     ├── Port: 8080\n   767→     └── Secrets: 4 from Secret Manager\n   768→\n   769→9.2 Docker Build (Multi-Stage)\n   770→    Stage 1: Build client (Vite)\n   771→    Stage 2: Build server (tsc)\n   772→    Stage 3: Production (Node.js 20 slim, copy built assets, start server)\n   773→\n   774→9.3 Cloud Run Configuration\n   775→    Region: europe-west2 (London)\n   776→    Concurrency: 80 requests/instance\n   777→    Timeout: 300 seconds\n   778→    Auto-scaling based on request volume\n   779→    Min instances 0 for cost efficiency (cold start < 3s)\n   780→\n   781→\n   782→10. MONITORING & OBSERVABILITY\n   783→================================================================================\n   784→\n   785→10.1 Custom Metrics (In-App)\n   786→    - Request count (by endpoint, method, status code)\n   787→    - Response time percentiles (P50, P95, P99)\n   788→    - Cache hit/miss rates per API source\n   789→    - Firestore query latency\n   790→    - Error rate and error types\n   791→    - Active concurrent requests\n   792→\n   793→10.2 Health Check\n   794→    GET /health\n   795→    - Firestore connectivity check with latency measurement\n   796→    - Memory usage (RSS, heap used, heap total)\n   797→    - Process uptime\n   798→    - Status: healthy | degraded | unhealthy\n   799→\n   800→10.3 Structured Logging\n   801→    - JSON format for all logs\n   802→    - Request ID correlation (X-Request-ID)\n   803→    - No sensitive data in logs\n   804→    - Error logging with full context (non-PII)\n   805→\n   806→10.4 Admin Monitoring Dashboard\n   807→    GET /api/v1/admin/monitoring\n   808→    - Real-time metrics display\n   809→    - Integration status overview\n   810→    - Cache performance statistics\n   811→    - Error rate trending\n   812→\n   813→\n   814→================================================================================\n   815→  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n   816→  Yantra Works | 2026-02-18\n   817→================================================================================\n   818→"}]},"uuid":"aef4b1a8-139f-4aab-9d2f-a2dd2a13e2a4","timestamp":"2026-02-23T18:40:38.916Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer                          │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19         |\n    | Language           | TypeScript              | 5.9        |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | v4         |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | latest     |\n    | 3D Visualization   | Three.js (@react-three) | r128       |\n    | Maps               | Leaflet + React Leaflet | 1.9        |\n    | Charts             | Recharts + D3.js        | latest     |\n    | Icons              | Lucide React            | latest     |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2        |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4          |\n    | Language           | TypeScript              | 5.7        |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | latest     |\n    | Auth               | Firebase Admin SDK      | latest     |\n    | Security           | Helmet                  | latest     |\n    | Logging            | Morgan + structured     | latest     |\n    | Testing            | Vitest                  | latest     |\n    | Build              | tsc + tsx               | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details            |\n    |--------------------|-------------------------|--------------------|\n    | Hosting            | Google Cloud Run        | europe-west2       |\n    | Container Registry | Artifact Registry       | europe-west2       |\n    | Database           | Google Firestore        | Native mode        |\n    | Authentication     | Firebase Auth           | Google SSO + email |\n    | Secrets            | Secret Manager          | 4 secrets          |\n    | CI/CD              | Cloud Build             | Auto on git push   |\n    | Source Control      | GitHub                  | rajivpeter repo    |\n    | Monitoring         | Custom metrics + health | In-app             |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage           |\n    |--------------------|-------------------------|--------------------|\n    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |\n    | Unit               | Vitest                  | 66 tests           |\n    | Type Checking      | TypeScript (strict)     | 0 errors           |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point\n    ├── index.css                — Global styles + animations\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage\n    │   ├── briefing/            — BriefingPage\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — Reusable components (12 files)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client, public data helpers\n    ├── contexts/                — Auth, User contexts\n    ├── utils/                   — Utility helpers\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within a BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API data caching, polling)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification\n    │   ├── error-handler.ts     — Structured JSON error handler\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 20 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical\n    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet → CORS → Compression\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses\n    - No stack traces leaked in production\n    - Error logging with request ID correlation\n    - Graceful degradation for external API failures\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                     │\n                                     ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                             │\n    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n      // See individual type schemas below\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root.\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (Unified)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    COMPLIANCE\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14 endpoints)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n\n    MOCK TIER 3 APIs\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title\n\n    EXTERNAL DATA PROXY\n    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather\n    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify\n\n    ADMIN\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    HEALTH\n    GET    /health                                        — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out, the system returns realistic simulated data\n    with a flag indicating the data source (live vs simulated).\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite)\n    Stage 2: Build server (tsc)\n    Stage 3: Production (Node.js 20 slim, copy built assets, start server)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Concurrency: 80 requests/instance\n    Timeout: 300 seconds\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs\n    - Error logging with full context (non-PII)\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-18\n================================================================================\n","numLines":818,"startLine":1,"totalLines":818}},"sourceToolAssistantUUID":"bafec079-711b-452a-a5e7-f5250fa2ec1e"}
{"parentUuid":"aef4b1a8-139f-4aab-9d2f-a2dd2a13e2a4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Xn6H56dwLTfdcJATvL61KL","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"a6a27124-7d30-4e2c-a7d5-8d570c2a31e1","timestamp":"2026-02-23T18:40:39.099Z"}
{"parentUuid":"a6a27124-7d30-4e2c-a7d5-8d570c2a31e1","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Xn6H56dwLTfdcJATvL61KL","type":"tool_result","content":"     1→================================================================================\n     2→  Doc3 — SocialHomes.Ai API & Integration Requirements\n     3→  Version: 2.0  |  Date: 2026-02-18\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. API OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 API Strategy\n    11→    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    12→    integrations. The React frontend communicates exclusively with the Express\n    13→    backend, which handles external calls, caching, rate limiting, and\n    14→    graceful degradation.\n    15→\n    16→1.2 Integration Tiers\n    17→\n    18→    TIER 1 — Free, No API Key Required\n    19→    Publicly available APIs with no registration needed.\n    20→    Status: LIVE with real data\n    21→\n    22→    TIER 2 — Free, Registration Required\n    23→    APIs requiring account creation or key registration.\n    24→    Status: LIVE with real data (where keys available) + simulated fallbacks\n    25→\n    26→    TIER 3 — Subscription/Paid APIs\n    27→    Commercial APIs requiring contracts or paid subscriptions.\n    28→    Status: MOCK endpoints with realistic simulated data\n    29→\n    30→1.3 Current Integration Count\n    31→    Total: 20 integrations\n    32→    - Tier 1: 3 live\n    33→    - Tier 2: 6 live (with simulated fallbacks)\n    34→    - Tier 3: 5 mock services + 6 planned\n    35→\n    36→\n    37→2. TIER 1 INTEGRATIONS (Free, No Key)\n    38→================================================================================\n    39→\n    40→2.1 Police.uk — Street-Level Crime Data\n    41→    Status: LIVE\n    42→    Base URL: https://data.police.uk/api\n    43→    Documentation: https://data.police.uk/docs/\n    44→\n    45→    Endpoints Used:\n    46→    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    47→    - GET /crimes-at-location?location_id={id}\n    48→    - GET /outcomes-at-location?location_id={id}\n    49→\n    50→    Server Route: GET /api/v1/public-data/police/:postcode\n    51→    Cache TTL: 24 hours\n    52→    Rate Limit: 15 req/sec (fair-use)\n    53→    Fallback: Simulated crime data matching postcode area\n    54→\n    55→    Used By:\n    56→    - D2: Live Crime Context for ASB (crime-context.ts)\n    57→    - Explore page crime data layer\n    58→    - ASB case correlation\n    59→    - Neighbourhood Briefing crime section\n    60→\n    61→    Data Returned:\n    62→    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    63→    - Month, location (lat/lng), outcome status\n    64→    - 12-month historical data per location\n    65→\n    66→2.2 Open-Meteo — Weather Forecasting\n    67→    Status: LIVE\n    68→    Base URL: https://api.open-meteo.com/v1\n    69→    Documentation: https://open-meteo.com/en/docs\n    70→\n    71→    Endpoints Used:\n    72→    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n    73→          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n    74→          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n    75→          &timezone=Europe/London\n    76→\n    77→    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    78→    Cache TTL: 1 hour\n    79→    Rate Limit: 10,000 req/day (no key needed)\n    80→    Fallback: Static weather for London SE\n    81→\n    82→    Used By:\n    83→    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    84→    - AI Morning Briefing (weather section)\n    85→    - Neighbourhood Briefing (environmental context)\n    86→    - Property impact assessment\n    87→\n    88→    Data Returned:\n    89→    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    90→    - Daily: max/min temperature, precipitation sum\n    91→    - 7-day forecast + current conditions\n    92→\n    93→2.3 DEFRA Flood Risk API\n    94→    Status: LIVE\n    95→    Base URL: https://environment.data.gov.uk/flood-monitoring\n    96→    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n    97→\n    98→    Endpoints Used:\n    99→    - GET /id/floods?lat={lat}&long={lng}&dist=3\n   100→    - GET /id/stations?lat={lat}&long={lng}&dist=3\n   101→\n   102→    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n   103→    Cache TTL: 1 hour\n   104→    Rate Limit: No formal limit\n   105→    Fallback: \"No active warnings\" with zone classification\n   106→\n   107→    Used By:\n   108→    - Property Passport (flood risk section)\n   109→    - Neighbourhood Briefing (environmental alerts)\n   110→    - Property detail page (risk indicators)\n   111→\n   112→    Data Returned:\n   113→    - Active flood warnings/alerts\n   114→    - Flood risk zone classification\n   115→    - Nearest monitoring station readings\n   116→\n   117→\n   118→3. TIER 2 INTEGRATIONS (Registration Required)\n   119→================================================================================\n   120→\n   121→3.1 Postcodes.io — Postcode Lookup\n   122→    Status: LIVE\n   123→    Base URL: https://api.postcodes.io\n   124→    Documentation: https://postcodes.io/docs\n   125→    Registration: None (open API)\n   126→\n   127→    Endpoints Used:\n   128→    - GET /postcodes/{postcode}\n   129→    - GET /postcodes/{postcode}/nearest\n   130→    - POST /postcodes (bulk lookup)\n   131→\n   132→    Server Route: GET /api/v1/public-data/postcode/:postcode\n   133→    Cache TTL: 7 days\n   134→    Rate Limit: Generous (no formal limit)\n   135→    Fallback: Static mapping for SE London postcodes\n   136→\n   137→    Data Returned:\n   138→    - Latitude, longitude\n   139→    - LSOA code and name (for IMD/Census/NOMIS)\n   140→    - Ward, parliamentary constituency\n   141→    - Local authority, region\n   142→    - Country, European electoral region\n   143→\n   144→    Used By:\n   145→    - All location-dependent lookups\n   146→    - LSOA resolution for Census/NOMIS/IMD\n   147→    - Property geocoding\n   148→\n   149→3.2 EPC Open Data\n   150→    Status: LIVE (with simulated fallback)\n   151→    Base URL: https://epc.opendatacommunities.org/api/v1\n   152→    Documentation: https://epc.opendatacommunities.org/docs/api\n   153→    Registration: API key via MHCLG portal\n   154→\n   155→    Endpoints Used:\n   156→    - GET /domestic/search?uprn={uprn}\n   157→    - GET /domestic/certificate/{lmk-key}\n   158→\n   159→    Server Route: GET /api/v1/public-data/epc/:uprn\n   160→    Cache TTL: 30 days\n   161→    Rate Limit: 1,000 req/month (free tier)\n   162→    Fallback: Generated EPC data matching property attributes\n   163→\n   164→    Data Returned:\n   165→    - Current energy rating (A–G) and score\n   166→    - Potential rating\n   167→    - Environmental impact rating\n   168→    - Floor area, wall/roof type\n   169→    - Heating type, hot water system\n   170→    - Recommendations for improvement\n   171→    - Certificate expiry date\n   172→\n   173→    Used By:\n   174→    - Property Passport (energy section)\n   175→    - Compliance page (EPC tracking)\n   176→    - Property detail page\n   177→    - D1: Damp prediction (building factor input)\n   178→\n   179→3.3 Census 2021 (ONS via NOMIS)\n   180→    Status: LIVE (with simulated fallback)\n   181→    Base URL: https://www.nomisweb.co.uk/api/v01\n   182→    Documentation: https://www.nomisweb.co.uk/api/v01/help\n   183→\n   184→    Datasets Used:\n   185→    - NM_2072_1 — Population by age/sex (Census 2021)\n   186→    - NM_2021_1 — Accommodation type (Census 2021)\n   187→\n   188→    Server Route: GET /api/v1/public-data/census/:lsoaCode\n   189→    Cache TTL: 90 days\n   190→    Rate Limit: 100,000 req/month\n   191→    Fallback: Simulated demographics for Southwark LSOA areas\n   192→\n   193→    Data Returned:\n   194→    - Population count and density\n   195→    - Age distribution (0–15, 16–64, 65+)\n   196→    - Household composition\n   197→    - Accommodation type breakdown\n   198→    - Ethnicity distribution\n   199→\n   200→    Used By:\n   201→    - Neighbourhood Briefing (demographics section)\n   202→    - Property Passport (area context)\n   203→    - D3: Vulnerability Detection (deprivation context)\n   204→\n   205→3.4 NOMIS — Labour Market Statistics\n   206→    Status: LIVE (with simulated fallback)\n   207→    Base URL: https://www.nomisweb.co.uk/api/v01\n   208→    Documentation: https://www.nomisweb.co.uk/api/v01/help\n   209→\n   210→    Datasets Used:\n   211→    - NM_162_1 — JSA claimant count by age/sex\n   212→    - NM_17_5  — Annual Population Survey (employment/unemployment)\n   213→\n   214→    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n   215→    Cache TTL: 30 days\n   216→    Rate Limit: 100,000 req/month\n   217→    Fallback: Simulated labour market data for SE London\n   218→\n   219→    Data Returned:\n   220→    - Employment rate, unemployment rate\n   221→    - Economic activity breakdown\n   222→    - Claimant count (JSA/UC)\n   223→    - Occupation types\n   224→    - Qualification levels\n   225→\n   226→    Used By:\n   227→    - D5: Benefits Entitlement Engine (employment context)\n   228→    - Neighbourhood Briefing (economic section)\n   229→    - D3: Vulnerability Detection (economic deprivation factor)\n   230→\n   231→3.5 Gas Safe Register\n   232→    Status: LIVE (with simulated fallback)\n   233→    Base URL: https://www.gassaferegister.co.uk/api\n   234→    Documentation: Restricted (via partnership application)\n   235→\n   236→    Endpoint Pattern:\n   237→    - GET /engineer/{registrationNumber}\n   238→\n   239→    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n   240→    Cache TTL: 24 hours\n   241→    Rate Limit: 100 req/hour\n   242→    Fallback: Simulated verification with valid/expired/suspended status\n   243→\n   244→    Data Returned:\n   245→    - Engineer name and company\n   246→    - Registration status (valid/expired/suspended)\n   247→    - Qualifications (boiler, cooker, fire, etc.)\n   248→    - Registration number and expiry date\n   249→\n   250→    Used By:\n   251→    - Repair detail page (contractor verification badge)\n   252→    - Compliance management (contractor vetting)\n   253→\n   254→3.6 Electrical Safety Register (NICEIC)\n   255→    Status: LIVE (with simulated fallback)\n   256→    Base URL: https://www.niceic.com/api\n   257→    Documentation: Via partnership application\n   258→\n   259→    Endpoint Pattern:\n   260→    - GET /contractor/{registrationNumber}\n   261→\n   262→    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n   263→    Cache TTL: 24 hours\n   264→    Rate Limit: 100 req/hour\n   265→    Fallback: Simulated verification with valid/expired/suspended status\n   266→\n   267→    Data Returned:\n   268→    - Contractor name and company\n   269→    - Registration status (valid/expired/suspended)\n   270→    - Scheme (NICEIC Approved Contractor / Competent Person)\n   271→    - Registration number and expiry date\n   272→\n   273→    Used By:\n   274→    - Repair detail page (contractor verification badge — blue)\n   275→    - Compliance management (electrical contractor vetting)\n   276→\n   277→\n   278→4. TIER 3 INTEGRATIONS (Mock/Subscription)\n   279→================================================================================\n   280→\n   281→4.1 DWP Universal Credit Verification\n   282→    Status: MOCK\n   283→    Mock Function: mockUcVerification(tenantId)\n   284→    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n   285→\n   286→    Mock Response:\n   287→    - UC claim status (active/pending/none)\n   288→    - Housing element amount\n   289→    - Payment frequency and next payment date\n   290→    - Managed payment status (direct to landlord)\n   291→    - Alternative Payment Arrangement (APA) eligibility\n   292→\n   293→    Used By:\n   294→    - D5: Benefits Entitlement Engine\n   295→    - Rent management (UC tracking)\n   296→    - Arrears prevention (early warning)\n   297→\n   298→4.2 IoT Sensor Integration (Switchee/Aico)\n   299→    Status: MOCK\n   300→    Mock Function: mockIotSensors(propertyId)\n   301→    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   302→\n   303→    Mock Response:\n   304→    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n   305→    - Humidity readings (per room)\n   306→    - CO2 levels\n   307→    - Smoke/CO detector status (OK/alert/battery-low)\n   308→    - Heating system status (on/off/hours today)\n   309→    - Alerts (high humidity, low temperature, CO detected)\n   310→\n   311→    Used By:\n   312→    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n   313→    - Property detail page (live sensor data)\n   314→    - Compliance monitoring (smoke/CO detector status)\n   315→\n   316→4.3 GoCardless — Direct Debit\n   317→    Status: MOCK\n   318→    Mock Function: mockDirectDebit(tenantId)\n   319→    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n   320→\n   321→    Mock Response:\n   322→    - Mandate status (active/pending/cancelled)\n   323→    - Bank details (last 4 digits only)\n   324→    - Next collection date and amount\n   325→    - Payment history (last 12 months)\n   326→    - Failed payment reasons\n   327→\n   328→    Used By:\n   329→    - Rent management (payment processing)\n   330→    - Arrears management (DD failure tracking)\n   331→    - Tenant detail (payment method)\n   332→\n   333→4.4 Plentific/Fixflo — Repairs Marketplace\n   334→    Status: MOCK\n   335→    Mock Function: mockRepairsMarketplace(caseId)\n   336→    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n   337→\n   338→    Mock Response:\n   339→    - Contractor quotes (3 quotes with price/availability)\n   340→    - Dispatch confirmation\n   341→    - Appointment scheduling\n   342→    - Job completion notification\n   343→    - Satisfaction survey trigger\n   344→\n   345→    Used By:\n   346→    - Repairs management (contractor dispatch)\n   347→    - Cost management (competitive quotes)\n   348→\n   349→4.5 DocuSign — Digital Signing\n   350→    Status: MOCK\n   351→    Mock Function: mockSigningEnvelope(documentType, tenantId)\n   352→    Server Route: POST /api/v1/ai/mock/signing\n   353→\n   354→    Mock Response:\n   355→    - Envelope ID and status (sent/delivered/signed/declined)\n   356→    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n   357→    - Recipients with signing status\n   358→    - Completion date\n   359→    - Signed document URL\n   360→\n   361→    Used By:\n   362→    - Tenancy sign-up workflow\n   363→    - Compliance certificate signing\n   364→    - Legal document execution\n   365→\n   366→4.6 Experian/TransUnion — Tenant Referencing\n   367→    Status: MOCK\n   368→    Mock Function: mockReferencingResult(applicantId)\n   369→    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n   370→\n   371→    Mock Response:\n   372→    - Credit score (300–850)\n   373→    - Affordability assessment (pass/refer/fail)\n   374→    - CCJ count and value\n   375→    - Previous addresses (last 3 years)\n   376→    - Employment verification\n   377→    - Recommendation (accept/refer/decline)\n   378→\n   379→    Used By:\n   380→    - Allocations (applicant vetting)\n   381→    - Lettings workflow (pre-tenancy checks)\n   382→\n   383→4.7 Land Registry — Title Data\n   384→    Status: MOCK\n   385→    Mock Function: mockLandRegistryTitle(propertyId)\n   386→    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n   387→\n   388→    Mock Response:\n   389→    - Title number\n   390→    - Tenure type (freehold/leasehold)\n   391→    - Price paid and date\n   392→    - Registered owner\n   393→    - Lease details (start, term, ground rent)\n   394→    - Restrictions and charges\n   395→\n   396→    Used By:\n   397→    - Property Passport (ownership section)\n   398→    - Property detail page\n   399→\n   400→4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n   401→    Status: MOCK\n   402→    Mock Function: mockRegulatorySubmission(type, refId)\n   403→    Server Route: POST /api/v1/ai/mock/regulatory\n   404→\n   405→    Submission Types:\n   406→    - IDA (Individual Data Return)\n   407→    - CORE lettings\n   408→    - CORE sales\n   409→    - Ombudsman escalation\n   410→    - Compliance score return\n   411→\n   412→    Used By:\n   413→    - Reports module (regulatory submissions)\n   414→    - Compliance management\n   415→\n   416→\n   417→5. SEVEN KILLER DIFFERENTIATOR SERVICES\n   418→================================================================================\n   419→\n   420→5.1 D1: Predictive Damp Intelligence\n   421→    Service: server/src/services/damp-prediction.ts\n   422→    API Route: GET /api/v1/ai/damp-risk/:propertyId\n   423→\n   424→    Algorithm: 5-Factor Weighted Score (0–100)\n   425→    ┌─────────────────────┬────────┬────────────────────────────────┐\n   426→    │ Factor              │ Weight │ Data Sources                   │\n   427→    ├─────────────────────┼────────┼────────────────────────────────┤\n   428→    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n   429→    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n   430→    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n   431→    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n   432→    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n   433→    └─────────────────────┴────────┴────────────────────────────────┘\n   434→\n   435→    Output:\n   436→    - Overall risk score (0–100)\n   437→    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n   438→    - Factor breakdown with individual scores\n   439→    - Proactive recommendations\n   440→    - Awaab's Law compliance status\n   441→\n   442→5.2 D2: Live Crime Context for ASB\n   443→    Service: server/src/services/crime-context.ts\n   444→    API Route: GET /api/v1/ai/crime-context/:estateId\n   445→\n   446→    Algorithm:\n   447→    - Fetch Police.uk data for estate location (12-month window)\n   448→    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n   449→    - Correlate with internal ASB cases\n   450→    - Identify hotspots and trends\n   451→    - Generate estate safety score\n   452→\n   453→    Output:\n   454→    - Crime summary by category (last 12 months)\n   455→    - Monthly trend (rising/stable/declining)\n   456→    - Hotspot locations within estate\n   457→    - Correlation with internal ASB cases\n   458→    - Recommended patrol priorities\n   459→\n   460→5.3 D3: Automatic Vulnerability Detection\n   461→    Service: server/src/services/vulnerability-detection.ts\n   462→    API Route: GET /api/v1/ai/vulnerability/:tenantId\n   463→\n   464→    Algorithm: 7-Factor Weighted Score (0–100)\n   465→    ┌──────────────────────────┬────────┬──────────────────────────┐\n   466→    │ Factor                   │ Weight │ Data Sources             │\n   467→    ├──────────────────────────┼────────┼──────────────────────────┤\n   468→    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n   469→    │ Arrears history          │  0.20  │ Rent account (balance)   │\n   470→    │ Health flags             │  0.15  │ Tenant vulnerability     │\n   471→    │ Social isolation         │  0.15  │ Household composition    │\n   472→    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n   473→    │ Dependents               │  0.10  │ Household members        │\n   474→    │ UC transition            │  0.10  │ UC status                │\n   475→    └──────────────────────────┴────────┴──────────────────────────┘\n   476→\n   477→    Output:\n   478→    - Vulnerability score (0–100)\n   479→    - Risk level: low / moderate / high / critical\n   480→    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n   481→    - Recommended support actions\n   482→    - Referral suggestions (social services, CAB, food bank)\n   483→\n   484→5.4 D4: Property Passport\n   485→    Service: server/src/services/property-passport.ts\n   486→    API Route: GET /api/v1/ai/property-passport/:propertyId\n   487→\n   488→    Aggregation Sources:\n   489→    - Property data (Firestore)\n   490→    - EPC certificate (Tier 2 API)\n   491→    - Compliance certificates (Firestore)\n   492→    - Repair history (Firestore cases)\n   493→    - Damp risk score (D1 service)\n   494→    - Flood risk (DEFRA API)\n   495→    - Crime context (D2 service)\n   496→    - Census demographics (NOMIS API)\n   497→    - Land Registry title (mock)\n   498→\n   499→    Output:\n   500→    - Comprehensive property dossier\n   501→    - Current condition assessment\n   502→    - Compliance status summary\n   503→    - Energy efficiency profile\n   504→    - Neighbourhood context\n   505→    - Investment recommendations\n   506→\n   507→5.5 D5: Benefits Entitlement Engine\n   508→    Service: server/src/services/benefits-engine.ts\n   509→    API Route: GET /api/v1/ai/benefits-check/:tenantId\n   510→\n   511→    Rules Engine (UK 2025/26):\n   512→    - Universal Credit (standard allowance, housing element, child element)\n   513→    - Personal Independence Payment (PIP)\n   514→    - Attendance Allowance\n   515→    - Pension Credit (guarantee, savings)\n   516→    - Council Tax Reduction\n   517→    - Discretionary Housing Payment\n   518→    - Warm Home Discount\n   519→    - Free school meals\n   520→\n   521→    Input:\n   522→    - Tenant age, household composition\n   523→    - Employment status, income\n   524→    - Disability/health conditions\n   525→    - Current benefit claims\n   526→\n   527→    Output:\n   528→    - List of potential entitlements\n   529→    - Estimated weekly/monthly amounts\n   530→    - Claim status (claimed/unclaimed/check-eligibility)\n   531→    - Total unclaimed benefits estimate\n   532→    - Next steps for each entitlement\n   533→\n   534→5.6 D6: AI Neighbourhood Briefing\n   535→    Service: server/src/services/neighbourhood-briefing.ts\n   536→    API Route: GET /api/v1/ai/briefing/:estateId\n   537→\n   538→    Data Sources Combined:\n   539→    - Weather forecast (Open-Meteo)\n   540→    - Crime data (Police.uk)\n   541→    - Active cases (Firestore)\n   542→    - Compliance status (Firestore)\n   543→    - Census demographics (NOMIS)\n   544→    - Damp risk aggregation (D1)\n   545→    - ASB incidents (Firestore + Police)\n   546→\n   547→    Output:\n   548→    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n   549→    - Officer briefing text (AI-generated narrative)\n   550→    - Action items prioritized by urgency\n   551→    - Trend comparisons (this week vs last)\n   552→\n   553→5.7 D7: IoT Sensor Integration\n   554→    Service: server/src/services/mock-services.ts\n   555→    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   556→\n   557→    Supported Devices:\n   558→    - Switchee smart thermostat (temperature, humidity, heating usage)\n   559→    - Aico smoke/CO detectors (status, battery, alerts)\n   560→    - Third-party humidity sensors\n   561→\n   562→    Status: MOCK (ready for real Switchee/Aico API integration)\n   563→\n   564→\n   565→6. GOV.UK NOTIFY INTEGRATION\n   566→================================================================================\n   567→\n   568→6.1 Overview\n   569→    Service: server/src/services/govuk-notify.ts\n   570→    Status: Template library defined (24 templates)\n   571→    Integration: Ready for GOV.UK Notify API key\n   572→\n   573→6.2 Template Categories (7)\n   574→\n   575→    CATEGORY 1: Rent Arrears (4 templates)\n   576→    - arrears-mild: Friendly reminder (1–2 weeks behind)\n   577→    - arrears-moderate: Formal notice (3–4 weeks)\n   578→    - arrears-severe: Pre-action warning (5+ weeks)\n   579→    - arrears-arrangement: Payment plan confirmation\n   580→\n   581→    CATEGORY 2: Repairs (4 templates)\n   582→    - repair-acknowledged: Repair reported acknowledgement\n   583→    - repair-appointment: Appointment booking confirmation\n   584→    - repair-completed: Completion notification + satisfaction link\n   585→    - repair-follow-up: Post-repair follow-up\n   586→\n   587→    CATEGORY 3: ASB (3 templates)\n   588→    - asb-reported: ASB report acknowledgement\n   589→    - asb-warning: Warning letter to perpetrator\n   590→    - asb-update: Case update to victim/reporter\n   591→\n   592→    CATEGORY 4: Compliance (3 templates)\n   593→    - compliance-access: Access request for inspection\n   594→    - compliance-reminder: Appointment reminder\n   595→    - compliance-certificate: Certificate available notification\n   596→\n   597→    CATEGORY 5: Tenancy (4 templates)\n   598→    - tenancy-welcome: New tenant welcome pack\n   599→    - tenancy-renewal: Renewal offer\n   600→    - tenancy-end: End of tenancy notification\n   601→    - tenancy-annual-visit: Annual visit scheduling\n   602→\n   603→    CATEGORY 6: Damp & Mould (3 templates)\n   604→    - damp-report-ack: Report acknowledged\n   605→    - damp-inspection: Inspection scheduled\n   606→    - damp-works: Works ordered notification (Awaab's Law timeline)\n   607→\n   608→    CATEGORY 7: General (3 templates)\n   609→    - general-update: Generic case update\n   610→    - general-survey: Satisfaction survey invitation\n   611→    - general-information: Information request\n   612→\n   613→6.3 Template Rendering\n   614→    - Personalisation fields use ((field)) syntax\n   615→    - Rendered server-side via /api/v1/ai/notify/render\n   616→    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n   617→      ((amount)), ((date)), ((officer_name)), etc.\n   618→\n   619→\n   620→7. CACHING ARCHITECTURE\n   621→================================================================================\n   622→\n   623→7.1 Cache Collection: externalDataCache\n   624→    Stored in Firestore with TTL-based expiration.\n   625→    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n   626→\n   627→7.2 Cache-Through Pattern\n   628→    1. Check Firestore cache for key\n   629→    2. If found AND not expired → return cached data\n   630→    3. If missing OR expired → fetch from external API\n   631→    4. Store result in cache with TTL\n   632→    5. Return data to caller\n   633→\n   634→7.3 TTL Configuration\n   635→\n   636→    | Source              | TTL       | Key Format                 |\n   637→    |---------------------|-----------|----------------------------|\n   638→    | police              | 24 hours  | police:{postcode}          |\n   639→    | weather             | 1 hour    | weather:{lat},{lng}        |\n   640→    | flood-risk          | 1 hour    | flood:{postcode}           |\n   641→    | postcode            | 7 days    | postcode:{postcode}        |\n   642→    | epc                 | 30 days   | epc:{uprn}                 |\n   643→    | census              | 90 days   | census:{lsoaCode}          |\n   644→    | nomis               | 30 days   | nomis:{lsoaCode}           |\n   645→    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n   646→    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n   647→    | imd                 | 90 days   | imd:{lsoaCode}             |\n   648→\n   649→7.4 Cache Management\n   650→    - Automatic TTL enforcement on read\n   651→    - Manual cache invalidation via admin API\n   652→    - Cache hit rate tracked in metrics\n   653→    - No cache warming (fetch-on-demand only)\n   654→\n   655→\n   656→8. RATE LIMITING\n   657→================================================================================\n   658→\n   659→8.1 Internal Rate Limits (per client IP)\n   660→\n   661→    | Tier    | Routes              | Limit        | Window  |\n   662→    |---------|---------------------|--------------|---------|\n   663→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   664→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   665→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   666→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   667→\n   668→8.2 External API Rate Limits\n   669→    Token bucket pattern per API source.\n   670→    Global fair-use: 15 req/sec across all external APIs.\n   671→\n   672→    | API               | Limit             | Enforced By       |\n   673→    |-------------------|-------------------|-------------------|\n   674→    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n   675→    | Open-Meteo        | 10,000 req/day    | No key needed     |\n   676→    | DEFRA             | No formal limit   | Fair-use          |\n   677→    | Postcodes.io      | No formal limit   | Fair-use          |\n   678→    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n   679→    | NOMIS             | 100,000 req/month | Fair-use          |\n   680→    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n   681→    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n   682→\n   683→\n   684→9. ERROR HANDLING & GRACEFUL DEGRADATION\n   685→================================================================================\n   686→\n   687→9.1 External API Error Handling\n   688→    - Timeout: 10 seconds per external request\n   689→    - Retry: 1 retry with exponential backoff (2s)\n   690→    - On failure: Return simulated fallback data\n   691→    - Flag: Response includes { source: 'live' | 'simulated' }\n   692→\n   693→9.2 Simulated Fallback Strategy\n   694→    Every external API has a corresponding simulated data generator.\n   695→    Simulated data is:\n   696→    - Realistic for the requested entity/location\n   697→    - Consistent across requests (deterministic seeding)\n   698→    - Flagged clearly in the response\n   699→\n   700→9.3 Circuit Breaker Pattern (Planned)\n   701→    - Track failure count per API source\n   702→    - Open circuit after 5 consecutive failures\n   703→    - Half-open after 60 seconds (single test request)\n   704→    - Close circuit on successful test\n   705→    Status: Not yet implemented (deferred)\n   706→\n   707→\n   708→10. API SECURITY\n   709→================================================================================\n   710→\n   711→10.1 Authentication\n   712→    All /api/v1/* routes require Firebase Bearer token.\n   713→    Exception: /health (public health check)\n   714→\n   715→10.2 Request Validation\n   716→    - JSON body limit: 1MB\n   717→    - Content-Type: application/json enforced\n   718→    - Query parameter sanitization\n   719→    - Path parameter validation\n   720→\n   721→10.3 Response Security\n   722→    - No sensitive data in error responses (production)\n   723→    - CORS restricted to allowed origins\n   724→    - Request ID correlation (X-Request-ID)\n   725→    - Security headers on all responses\n   726→\n   727→10.4 API Key Management\n   728→    - No API keys in source code\n   729→    - All keys in Google Secret Manager\n   730→    - Environment variable injection at runtime\n   731→    - Key rotation support via Secret Manager versioning\n   732→\n   733→\n   734→11. FUTURE INTEGRATION ROADMAP\n   735→================================================================================\n   736→\n   737→11.1 Phase 5 — Real-Time & Advanced (Planned)\n   738→\n   739→    | Integration           | Priority | Complexity | Description                     |\n   740→    |-----------------------|----------|------------|---------------------------------|\n   741→    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |\n   742→    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |\n   743→    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |\n   744→    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |\n   745→    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |\n   746→    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |\n   747→    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |\n   748→    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |\n   749→    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |\n   750→    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |\n   751→\n   752→11.2 Phase 6 — Enterprise Integrations (Future)\n   753→\n   754→    | Integration           | Priority | Complexity | Description                     |\n   755→    |-----------------------|----------|------------|---------------------------------|\n   756→    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |\n   757→    | Salesforce CRM        | P3       | High       | Tenant relationship management  |\n   758→    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |\n   759→    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |\n   760→    | NHS Digital           | P3       | High       | Health data integration         |\n   761→    | Companies House       | P3       | Low        | Contractor verification         |\n   762→\n   763→\n   764→================================================================================\n   765→  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n   766→  Yantra Works | 2026-02-18\n   767→================================================================================\n   768→"}]},"uuid":"a63a80e7-19d2-4d81-a399-ad11d395d7c4","timestamp":"2026-02-23T18:40:39.311Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n    - Country, European electoral region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Endpoint Pattern:\n    - GET /engineer/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Endpoint Pattern:\n    - GET /contractor/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Not yet implemented (deferred)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |\n    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |\n    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |\n    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |\n    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |\n    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |\n    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |\n    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |\n    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |\n    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |\n    | Salesforce CRM        | P3       | High       | Tenant relationship management  |\n    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |\n    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |\n    | NHS Digital           | P3       | High       | Health data integration         |\n    | Companies House       | P3       | Low        | Contractor verification         |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-18\n================================================================================\n","numLines":768,"startLine":1,"totalLines":768}},"sourceToolAssistantUUID":"a6a27124-7d30-4e2c-a7d5-8d570c2a31e1"}
{"parentUuid":"a63a80e7-19d2-4d81-a399-ad11d395d7c4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015aSiyN1iNzfyjcrA9XCgjh","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"384e2928-9394-413d-8ee9-26fc849f3dc9","timestamp":"2026-02-23T18:40:39.549Z"}
{"parentUuid":"384e2928-9394-413d-8ee9-26fc849f3dc9","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015aSiyN1iNzfyjcrA9XCgjh","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n     4→> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent\n     5→> Studio: Yantra Works\n     6→\n     7→---\n     8→\n     9→## PLAN SUMMARY\n    10→\n    11→| Phase | Name | Sprints | Status | Progress |\n    12→|-------|------|---------|--------|----------|\n    13→| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n    14→| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n    15→| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n    16→| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n    17→| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n    18→| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |\n    19→\n    20→---\n    21→\n    22→## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n    23→\n    24→| # | Task | Status | Agent |\n    25→|---|------|--------|-------|\n    26→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    27→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    28→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    29→| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n    30→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    31→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    32→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    33→| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    34→| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    35→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    36→\n    37→---\n    38→\n    39→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n    40→\n    41→### Goal: Core external API infrastructure + free API integrations\n    42→\n    43→| # | Task | Priority | Complexity | Agent | Status |\n    44→|---|------|----------|------------|-------|--------|\n    45→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n    46→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n    47→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n    48→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n    49→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n    50→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n    51→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n    52→| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n    53→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n    54→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n    55→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n    56→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n    57→\n    58→---\n    59→\n    60→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n    61→\n    62→### Goal: 7 killer differentiators + Tier 2 API registrations\n    63→\n    64→| # | Task | Priority | Complexity | Agent | Status |\n    65→|---|------|----------|------------|-------|--------|\n    66→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n    67→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n    68→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n    69→| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n    70→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n    71→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n    72→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n    73→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n    74→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n    75→| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n    76→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n    77→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n    78→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n    79→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n    80→\n    81→---\n    82→\n    83→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n    84→\n    85→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    86→\n    87→| # | Task | Priority | Complexity | Agent | Status |\n    88→|---|------|----------|------------|-------|--------|\n    89→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n    90→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n    91→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n    92→| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    93→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n    94→| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n    95→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n    96→| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n    97→| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n    98→| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    99→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n   100→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n   101→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n   102→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n   103→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n   104→| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n   105→| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n   106→\n   107→---\n   108→\n   109→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n   110→\n   111→### Goal: Mock services + polish + production hardening\n   112→\n   113→| # | Task | Priority | Complexity | Agent | Status |\n   114→|---|------|----------|------------|-------|--------|\n   115→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n   116→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n   117→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n   118→| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n   119→| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n   120→| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n   121→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n   122→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n   123→| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n   124→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n   125→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n   126→| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n   127→| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n   128→| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n   129→\n   130→---\n   131→\n   132→## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)\n   133→\n   134→### Goal: Real AI, real-time features, advanced testing, production scaling\n   135→\n   136→Phase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.\n   137→\n   138→---\n   139→\n   140→### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n   141→\n   142→| # | Task | Priority | Complexity | Agent | Status |\n   143→|---|------|----------|------------|-------|--------|\n   144→| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |\n   145→| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |\n   146→| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |\n   147→| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |\n   148→| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |\n   149→| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |\n   150→| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |\n   151→\n   152→---\n   153→\n   154→### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n   155→\n   156→| # | Task | Priority | Complexity | Agent | Status |\n   157→|---|------|----------|------------|-------|--------|\n   158→| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |\n   159→| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |\n   160→| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |\n   161→| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |\n   162→| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |\n   163→| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |\n   164→| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |\n   165→| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |\n   166→| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |\n   167→| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |\n   168→\n   169→---\n   170→\n   171→### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n   172→\n   173→| # | Task | Priority | Complexity | Agent | Status |\n   174→|---|------|----------|------------|-------|--------|\n   175→| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |\n   176→| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |\n   177→| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |\n   178→| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |\n   179→| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |\n   180→| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |\n   181→| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |\n   182→| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |\n   183→\n   184→---\n   185→\n   186→### PHASE 5.4: TESTING & QA (Sprint 11)\n   187→\n   188→| # | Task | Priority | Complexity | Agent | Status |\n   189→|---|------|----------|------------|-------|--------|\n   190→| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |\n   191→| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |\n   192→| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |\n   193→| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |\n   194→| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |\n   195→| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |\n   196→| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |\n   197→\n   198→---\n   199→\n   200→### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n   201→\n   202→| # | Task | Priority | Complexity | Agent | Status |\n   203→|---|------|----------|------------|-------|--------|\n   204→| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |\n   205→| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |\n   206→| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |\n   207→| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |\n   208→| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |\n   209→| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |\n   210→| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |\n   211→| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |\n   212→\n   213→---\n   214→\n   215→## AGENT ROLES\n   216→\n   217→| Agent | Responsibility | Key Files |\n   218→|-------|---------------|-----------|\n   219→| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   220→| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   221→| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n   222→| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   223→| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n   224→\n   225→---\n   226→\n   227→## KEY DOCUMENTS\n   228→\n   229→| Document | Location | Purpose |\n   230→|----------|----------|---------|\n   231→| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |\n   232→| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |\n   233→| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |\n   234→| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n   235→| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n   236→| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n   237→| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n   238→| CLAUDE.md | Project root | Claude Code project instructions |\n   239→| SESSION-HISTORY.md | Project root | Persistent conversation history |\n   240→| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n   241→| DEVOPS.md | Project root | DevOps and deployment guide |\n   242→| EXECUTION-PLAN.md | Project root | This document |\n   243→\n   244→---\n   245→\n   246→## COMMUNICATION\n   247→\n   248→### Telegram (@SocialHomesBot)\n   249→- **Async notifications**: Build status, deployment confirmations, test results\n   250→- **Permission requests**: Routed via Telegram when user is away from desk\n   251→- **Progress updates**: Phase/sprint completion summaries\n   252→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   253→\n   254→### Session Continuity\n   255→- Update `SESSION-HISTORY.md` at end of every session\n   256→- `CLAUDE.md` provides context for new sessions\n   257→- Entire.io captures checkpoints on commits\n   258→\n   259→---\n   260→\n   261→## METRICS & SUCCESS CRITERIA\n   262→\n   263→| Metric | Target | Current |\n   264→|--------|--------|---------|\n   265→| Selenium test pass rate | > 98% | 99.7% ✅ |\n   266→| TypeScript errors | 0 | 0 ✅ |\n   267→| Vite build warnings | 0 critical | 0 ✅ |\n   268→| API response time (P95) | < 500ms | ~200-300ms ✅ |\n   269→| WCAG AA compliance | 100% | 100% ✅ |\n   270→| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n   271→| Bundle size | < 3MB | ~2.5MB ✅ |\n   272→| Cloud Run cold start | < 3s | < 2s ✅ |\n   273→\n   274→### Phase 5 Additional Targets\n   275→\n   276→| Metric | Target |\n   277→|--------|--------|\n   278→| AI response latency (Vertex AI) | < 3s for conversational queries |\n   279→| WebSocket connection stability | > 99.9% uptime |\n   280→| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n   281→| Selenium test coverage | > 95% of routes |\n   282→| Unit test coverage (services) | > 80% line coverage |\n   283→| Staging deployment frequency | Every PR |\n   284→| Database backup frequency | Daily automated |\n   285→| Lighthouse accessibility score | > 90 on all pages |\n   286→\n   287→---\n   288→\n   289→## DEFERRED ITEMS (From Phases 3-4)\n   290→\n   291→Items deferred from earlier phases, now included in Phase 5:\n   292→\n   293→| Original ID | Task | New Phase 5 ID |\n   294→|-------------|------|----------------|\n   295→| 3.17 | E2E testing for all new features | 5.4.1 |\n   296→| 4.12 | Full regression test suite | 5.4.1 |\n   297→| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n   298→| 4.14 | API reference documentation | 5.1.7 |\n   299→| 4.9 | Cache warming, batch updates | 5.2.6 |\n   300→\n   301→---\n   302→\n   303→**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**\n   304→"}]},"uuid":"61a91724-204c-4361-9386-5aa8438b2cae","timestamp":"2026-02-23T18:40:39.573Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |\n| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**\n","numLines":304,"startLine":1,"totalLines":304}},"sourceToolAssistantUUID":"384e2928-9394-413d-8ee9-26fc849f3dc9"}
{"parentUuid":"61a91724-204c-4361-9386-5aa8438b2cae","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KqdjFkSfD7JB8LQxxvqKBr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012CQBW4aa4snnkXqbESWdkV","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9916,"cache_read_input_tokens":18671,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9916},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVNr7zoHLzk9ihhEjpP","type":"assistant","uuid":"8dc87f98-6e63-4a40-b167-1f878b50d0a3","timestamp":"2026-02-23T18:40:39.988Z"}
{"parentUuid":"8dc87f98-6e63-4a40-b167-1f878b50d0a3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012CQBW4aa4snnkXqbESWdkV","type":"tool_result","content":"     1→# SocialHomes.Ai — Session History\n     2→\n     3→> Persistent conversation log across all Claude Code sessions.\n     4→> Updated at the end of each session to preserve context.\n     5→\n     6→---\n     7→\n     8→## Session 1 — 2026-02-12 (Google Drive path)\n     9→**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10→**Agent:** Claude Opus 4.6\n    11→\n    12→### What happened:\n    13→- Initial project setup and exploration\n    14→- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15→- Comprehensive Selenium testing initiated (17 test classes)\n    16→- Project overview sent to Telegram\n    17→\n    18→### Key decisions:\n    19→- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20→- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21→- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22→\n    23→---\n    24→\n    25→## Session 2 — 2026-02-13 (Migrated to C: drive)\n    26→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27→**Agent:** Claude Opus 4.6\n    28→\n    29→### What happened:\n    30→- Security cleanup: removed all exposed API keys and secrets from codebase\n    31→- Added full workflow actions and cross-entity navigation\n    32→- Eliminated all React Error #310 instances\n    33→- Redesigned login page\n    34→- Polished dashboard\n    35→- Updated DEVOPS.md\n    36→\n    37→### Commits:\n    38→- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n    39→- `944e952` — feat: add full workflow actions & cross-entity navigation\n    40→- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n    41→- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42→- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n    43→\n    44→---\n    45→\n    46→## Session 3 — 2026-02-14\n    47→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48→**Agent:** Claude Opus 4.6\n    49→\n    50→### What happened:\n    51→\n    52→#### Task 1: Verified 4 previous bug fixes\n    53→- BUG-001: ComplaintDetailPage.tsx — null checks intact\n    54→- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n    55→- BUG-003: AsbPage.tsx — navigation handlers intact\n    56→- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n    57→\n    58→#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59→| Warning | File | Fix |\n    60→|---------|------|-----|\n    61→| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62→| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63→| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64→| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65→| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66→| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67→| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68→| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69→| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70→| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71→| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72→\n    73→#### Task 3: Installed Entire.io CLI\n    74→- Installed v0.4.4 at ~/.local/bin/entire\n    75→- Strategy: manual-commit\n    76→- Fixed all 4 git hooks with PATH export\n    77→\n    78→#### Task 4: Build and deploy\n    79→- TypeScript: 0 errors\n    80→- Vite build: 2,580.62 kB JS bundle\n    81→- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82→- Push: succeeded → Cloud Build triggered\n    83→\n    84→---\n    85→\n    86→## Session 4 — 2026-02-14 (current)\n    87→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88→**Agent:** Claude Opus 4.6\n    89→\n    90→### What happened:\n    91→\n    92→#### Task 5: Telegram notifications setup\n    93→- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94→- Created .mcp.json with telegram MCP server config\n    95→- Added .mcp.json to .gitignore (contains bot token)\n    96→- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97→\n    98→#### Task 6: Persistent conversation history\n    99→- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100→- Added to .gitignore (local dev reference only)\n   101→\n   102→#### Task 7: Entire.io repo\n   103→- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104→- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105→- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106→- Entire.io dashboard: https://app.entire.io (login required)\n   107→\n   108→#### Task 8: UI/UX Audit Document (in progress)\n   109→- Frontend UI engineer agent reviewing all pages, components, interactions\n   110→- Output: comprehensive audit for fullstack and tester agents\n   111→\n   112→#### Task 9: BA Requirements — Public API Integrations (in progress)\n   113→- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114→- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115→- 7 killer differentiators documented\n   116→\n   117→#### Task 10: Master Execution Plan (pending)\n   118→- Will be created after Tasks 8 and 9 complete\n   119→\n   120→---\n   121→\n   122→## Architecture Reference\n   123→\n   124→### Tech Stack\n   125→- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126→- **Backend:** Express.js + TypeScript\n   127→- **Database:** Google Firestore\n   128→- **Hosting:** Google Cloud Run (europe-west2)\n   129→- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n   130→- **Maps:** Leaflet.js + OpenStreetMap\n   131→- **3D:** Three.js\n   132→- **Charts:** Recharts\n   133→- **AI:** YantraAssist (contextual AI assistant)\n   134→\n   135→### Key URLs\n   136→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137→- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138→- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139→- **Firebase Project:** gen-lang-client-0146156913\n   140→- **Entire.io dashboard:** https://app.entire.io\n   141→\n   142→### Personas\n   143→1. COO — Organisation-wide view\n   144→2. Head of Housing — Regional oversight\n   145→3. Housing Manager — Estate/block management\n   146→4. Housing Officer — Frontline casework\n   147→5. Repairs Operative — Job-level repairs\n   148→\n   149→### Telegram Bot\n   150→- Bot: @SocialHomesBot\n   151→- Chat ID: socialhomes:8020560167\n   152→- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153→\n   154→---\n   155→\n   156→## Session 5 — 2026-02-15\n   157→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158→**Agent:** Claude Opus 4.6\n   159→\n   160→### What happened:\n   161→\n   162→#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163→\n   164→**Backend Services Created (7 new files):**\n   165→| Service | File | Description |\n   166→|---------|------|-------------|\n   167→| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168→| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169→| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170→| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171→| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172→| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173→| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174→\n   175→**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176→- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177→- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178→- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179→- D4: `GET /benefits-check/:tenantId`\n   180→- D5: `GET /property-passport/:propertyId`\n   181→- D6: `GET /briefing/:estateId`\n   182→- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183→\n   184→**Frontend Components Created (4 new panels):**\n   185→- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n   186→- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n   187→- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n   188→- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n   189→\n   190→**Frontend Pages Updated:**\n   191→- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n   192→- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n   193→- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n   194→- `api-client.ts` — 13 new AI API methods\n   195→- `useApi.ts` — 10 new React Query hooks\n   196→\n   197→### Build Results:\n   198→- TypeScript (server): 0 errors\n   199→- TypeScript (app): 0 errors\n   200→- Vite build: 3,395 modules, 38.43s\n   201→- All clean on first attempt\n   202→\n   203→### Commits:\n   204→- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205→\n   206→### EXECUTION-PLAN.md updated:\n   207→- Phase 2 marked as DONE (all 14 tasks)\n   208→\n   209→---\n   210→\n   211→## Session 6 — 2026-02-16\n   212→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213→**Agent:** Claude Opus 4.6\n   214→\n   215→### What happened:\n   216→\n   217→#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n   218→\n   219→**New Backend Services (2 files):**\n   220→| Service | File | Lines | Description |\n   221→|---------|------|-------|-------------|\n   222→| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223→| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n   224→\n   225→**API Routes Added (8 new endpoints):**\n   226→- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227→- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228→\n   229→**Frontend Enhancements (5 files modified):**\n   230→- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231→- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232→- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233→- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n   234→\n   235→**Accessibility Fixes (WCAG AA):**\n   236→- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237→- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238→- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239→- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240→\n   241→### Build Results:\n   242→- TypeScript (server): 0 errors\n   243→- TypeScript (app): 0 errors\n   244→- Vite build: 3,396 modules, 39.22s — all clean\n   245→- Server build: clean\n   246→\n   247→### Files Changed: 13 modified + 2 new (523 insertions)\n   248→\n   249→### Commits:\n   250→- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251→\n   252→### EXECUTION-PLAN.md updated:\n   253→- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254→\n   255→---\n   256→\n   257→#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n   258→\n   259→**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260→| Service | Function | Description |\n   261→|---------|----------|-------------|\n   262→| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263→| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264→| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n   265→| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266→| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267→\n   268→**Admin Integration Dashboard:**\n   269→- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270→- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271→- Toggle enable/disable + Test Connection buttons\n   272→- Summary bar: total, active, issues, avg response time\n   273→- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274→- Updated App.tsx routing to use IntegrationsPage\n   275→\n   276→**Security Hardening:**\n   277→- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278→- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279→- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280→- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281→- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282→- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283→- JSON body limit reduced from 10mb to 1mb\n   284→\n   285→**Production Monitoring:**\n   286→- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287→- New `server/src/middleware/metrics.ts` — records every request on res.finish\n   288→- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289→- New admin route: GET /api/v1/admin/monitoring\n   290→- Frontend API client: adminApi.monitoring()\n   291→\n   292→**API Routes Added (8 new):**\n   293→- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294→- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295→\n   296→### Build Results:\n   297→- TypeScript (server): 0 errors\n   298→- TypeScript (app): 0 errors\n   299→- Vite build: 3,397 modules, 35.59s — all clean\n   300→- Server build: clean\n   301→\n   302→### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303→### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304→\n   305→### EXECUTION-PLAN.md updated:\n   306→- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307→\n   308→---\n   309→\n   310→## Session 7 — 2026-02-16 (Cloud Run Deployment)\n   311→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312→**Agent:** Claude Opus 4.6\n   313→\n   314→### What happened:\n   315→\n   316→#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n   317→\n   318→**Problem:** Previous deployment attempts failed:\n   319→1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320→2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321→\n   322→**Resolution:**\n   323→1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324→2. Created 4 secrets in Secret Manager:\n   325→   | Secret | Value Source |\n   326→   |--------|-------------|\n   327→   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328→   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329→   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330→   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331→3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332→4. Deployed using pre-built image from Artifact Registry:\n   333→   ```\n   334→   gcloud run deploy socialhomes \\\n   335→     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336→     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337→     --min-instances=0 --max-instances=10 --port=8080 \\\n   338→     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339→   ```\n   340→\n   341→**Result:**\n   342→- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n   343→- Health check: `healthy`, Firestore connected (984ms latency)\n   344→- Firebase config endpoint: secrets injected correctly\n   345→- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346→\n   347→### Key Discoveries:\n   348→- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349→- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→\n   361→---\n   362→\n   363→## Session 8 — 2026-02-18 (Business Analyst Session)\n   364→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366→\n   367→### What happened:\n   368→\n   369→#### Task: Comprehensive Project Analysis & Specification Documents\n   370→\n   371→Performed full project analysis covering:\n   372→- All 73 frontend TypeScript files across 19 page directories\n   373→- All 43 backend TypeScript files (routes, services, middleware, models)\n   374→- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375→- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376→- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377→\n   378→#### Created 3 Specification Documents in `docs/requirements/`:\n   379→\n   380→1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   381→   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382→   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383→   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384→\n   385→2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   386→   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387→   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388→   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389→\n   390→3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   391→   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392→   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393→\n   394→#### Updated EXECUTION-PLAN.md (v2.0):\n   395→\n   396→- Preserved Phases 0–4 (all DONE) with progress counts\n   397→- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398→  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399→  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400→  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401→  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402→  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403→- Added deferred items cross-reference table\n   404→- Added Phase 5 metrics targets\n   405→- Updated plan summary table\n   406→\n   407→### Files Changed:\n   408→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411→- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n   412→- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n   413→\n   414→### Commits:\n   415→- (pending — awaiting user instruction to commit)\n   416→\n   417→### Decisions Taken:\n   418→- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n   419→- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420→- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421→- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n   422→- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423→\n   424→### Pending Work:\n   425→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n   426→- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427→"}]},"uuid":"47add1e9-a834-43a5-8f93-b8bef121afee","timestamp":"2026-02-23T18:40:40.014Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n","numLines":427,"startLine":1,"totalLines":427}},"sourceToolAssistantUUID":"8dc87f98-6e63-4a40-b167-1f878b50d0a3"}
{"parentUuid":"47add1e9-a834-43a5-8f93-b8bef121afee","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01UWGPTjyksxAqhHLDQ7n9kT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013YazQLjVphtzLhXVR4q69E","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":45399,"cache_read_input_tokens":28587,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":45399},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVPENxgqLoFGfBd6tjj","type":"assistant","uuid":"26712275-4943-45c2-a29d-0e60e8948f52","timestamp":"2026-02-23T18:40:47.322Z"}
{"parentUuid":"26712275-4943-45c2-a29d-0e60e8948f52","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013YazQLjVphtzLhXVR4q69E","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"1297d459-ee67-4b33-a1b6-7a76b0af8995","timestamp":"2026-02-23T18:40:47.324Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"26712275-4943-45c2-a29d-0e60e8948f52"}
{"parentUuid":"1297d459-ee67-4b33-a1b6-7a76b0af8995","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01PUWkq9gaPoQkvL2GbaybnG","type":"message","role":"assistant","content":[{"type":"text","text":"I now have a comprehensive understanding of the project. The existing docs in `docs/requirements/` were created in Session 8 (2026-02-18). They're solid but I'll now create updated, more comprehensive versions that reflect the latest state. Let me also read the root-level originals for any additional context:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":73986,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVPoGsfpTfEJzU3qW6B","type":"assistant","uuid":"c6246c43-f19b-4bf9-b4ab-7c345fffef0a","timestamp":"2026-02-23T18:40:52.018Z"}
{"parentUuid":"c6246c43-f19b-4bf9-b4ab-7c345fffef0a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01PUWkq9gaPoQkvL2GbaybnG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MgLRZrDyp9wW859zpRRQbc","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":73986,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVPoGsfpTfEJzU3qW6B","type":"assistant","uuid":"89762181-2b7d-4047-9123-746858aa32b3","timestamp":"2026-02-23T18:40:53.039Z"}
{"parentUuid":"89762181-2b7d-4047-9123-746858aa32b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01PUWkq9gaPoQkvL2GbaybnG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YLwVurPc7ZSC7rSikwBM4D","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":73986,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVPoGsfpTfEJzU3qW6B","type":"assistant","uuid":"b32d01f0-2a34-4900-a0c9-909e3096fb0c","timestamp":"2026-02-23T18:40:53.377Z"}
{"parentUuid":"89762181-2b7d-4047-9123-746858aa32b3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MgLRZrDyp9wW859zpRRQbc","type":"tool_result","content":"     1→# DOCUMENT 1 OF 2: BASE APPLICATION SPECIFICATION\n     2→# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n     3→\n     4→## INSTRUCTION TO AI\n     5→\n     6→You are building **SocialHomes.Ai**, a comprehensive, open-source, AI-native housing management system for UK social housing providers (housing associations and local authorities) managing 5,000–20,000 units. Created by **Yantra.Works**.\n     7→\n     8→Build a complete, multi-page React application. This is NOT a legacy housing system with a fresh coat of paint. This must look and feel like nothing the social housing sector has ever seen — think Bloomberg Terminal meets Figma, not a government form. The sector is dominated by ugly, slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai is the opposite: dark, fast, visually stunning, animated, intelligent.\n     9→\n    10→There is a companion document (Document 2) that specifies all AI-native features, dynamic buttons/fields, personas, admin system, and prediction models. Build the base application first using this document, then apply Document 2's features.\n    11→\n    12→---\n    13→\n    14→## TECHNICAL STACK\n    15→\n    16→- **React 19** with functional components, hooks, Suspense\n    17→- **React Router v7** for client-side routing with nested routes\n    18→- **Tailwind CSS v4** via CDN — Yantra.Works dark-mode-first brand language\n    19→- **Three.js (r128)** via `https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js` — for 3D building visualisations in the drill-down\n    20→- **Leaflet 1.9** with OpenStreetMap tiles — for 2D map views (free, no API key)\n    21→- **Recharts** for dashboards and charts\n    22→- **D3.js** for advanced visualisations (Sankey diagrams, heatmaps)\n    23→- **Lucide React** for iconography\n    24→- **Animations**: CSS transitions and keyframe animations throughout — every page load has staggered reveals, every panel slides, every card fades in, status changes animate. The UI must feel ALIVE, not static.\n    25→- **State management**: React Context + useReducer\n    26→- Do NOT use localStorage or sessionStorage\n    27→\n    28→---\n    29→\n    30→## BRANDING\n    31→\n    32→### Logo\n    33→The product logo is the Yantra.Works geometric mark in teal. Embed this SVG inline:\n    34→\n    35→```svg\n    36→<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 751 772\" width=\"36\" height=\"37\">\n    37→  <path fill=\"#058995\" d=\"M745.51,390.8l-95.41-91.94-41.32,42.88,48.94,47.16-250.45,254.19-1.31-194.04,12.47-12.74-.31-.3,143.2-143.64.08.08,42.88-42.58-.29-.29,1-1-41.76-41.63-.79.79L377.89,21.94l-1.41,1.4-.43-.44L10.05,385.9l.67.67-2.57,2.54,325.25,328.97-.16.16,12.35,12.17,30.65,31,.41-.4,2.02,1.99,324.99-329.84.55.53,41.32-42.88ZM345.09,452.5l1.28,189.95-251.12-253.99,92.74-91.98,144.76,141.66-1.03,1.03,13.37,13.33ZM375.98,394.78l-144.51-141.42,146.65-145.45,141.65,142.63-143.79,144.23Z\"/>\n    38→</svg>\n    39→```\n    40→\n    41→- Header: Logo mark (36px) + **\"SocialHomes.Ai\"** (`--brand-teal`, with \".Ai\" in `--status-ai` purple) + **\"by Yantra.Works\"** (smaller, `--brand-soft`)\n    42→- Tagline: \"AI-native. Human-assured.\"\n    43→- Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n    44→\n    45→### Colour Palette — Yantra.Works Official Brand\n    46→\n    47→```css\n    48→/* Brand palette */\n    49→--brand-peach: #EFAC92;     /* Headings & Accents */\n    50→--brand-garnet: #BE3358;    /* Action & Signature — CTAs, critical alerts */\n    51→--brand-teal: #058995;      /* Logo & Labels — primary identity, links */\n    52→--brand-blue: #5BA4AA;      /* Atmospheric UI — charts, secondary highlights */\n    53→--brand-soft: #ACC0B5;      /* Metadata Text — secondary text, labels */\n    54→--brand-deep: #1A5A5E;      /* Core Surfaces — dark panels, sidebars */\n    55→\n    56→/* Dark theme surfaces */\n    57→--surface-dark: #0D1117;    /* Page background */\n    58→--surface-card: #151B23;    /* Card/panel backgrounds */\n    59→--surface-elevated: #1C2333;/* Modals, dropdowns, elevated panels */\n    60→--surface-hover: #222D3D;   /* Hover states */\n    61→\n    62→/* Text */\n    63→--text-primary: #E6EDF3;    /* Primary text */\n    64→--text-secondary: #ACC0B5;  /* Secondary text (= brand-soft) */\n    65→--text-muted: #6B7B8D;      /* Timestamps, IDs, low-priority text */\n    66→\n    67→/* Borders */\n    68→--border-default: #2A3545;\n    69→--border-focus: #EFAC92;    /* Focus ring — peach for visibility on dark */\n    70→\n    71→/* Semantic statuses */\n    72→--status-compliant: #2EA043;  /* Green */\n    73→--status-warning: #EFAC92;    /* Peach/amber */\n    74→--status-critical: #BE3358;   /* Garnet */\n    75→--status-info: #5BA4AA;       /* Blue */\n    76→--status-ai: #A371F7;         /* Purple — AI features */\n    77→--status-void: #6B7B8D;       /* Grey */\n    78→```\n    79→\n    80→### Typography\n    81→- Headings: `\"Space Grotesk\", sans-serif` — bold, technical\n    82→- Body: `\"Inter\", Arial, sans-serif` — clean, readable\n    83→- Monospace: `\"JetBrains Mono\", monospace` — references, codes\n    84→- Body size: 15px. Line height: 1.6 body, 1.2 headings\n    85→- Headings in `--brand-peach` on dark backgrounds\n    86→- Section labels: `--brand-teal`, uppercase, letter-spaced\n    87→\n    88→### Design Principles\n    89→- **Dark mode is default** — `--surface-dark` background with warm accent colours\n    90→- Max content width: 1400px (except full-bleed map views)\n    91→- Cards: `--surface-card` background, 4px left colour border for RAG, 8px rounded corners, subtle shadow\n    92→- Status tags: pill-shaped, semi-transparent background\n    93→- Countdown timers: large monospace digits, colour transitions green→peach→garnet→pulsing garnet\n    94→- Tables: `--surface-card` background, `--surface-hover` on hover, sortable columns\n    95→- Buttons: `--brand-teal` primary, `--surface-elevated` secondary, `--brand-garnet` destructive, `--status-ai` purple for AI actions\n    96→- Charts: teal primary, blue secondary, peach highlights, garnet alerts\n    97→- Subtle background grid/dot pattern at 3% opacity for texture\n    98→- UK date format DD/MM/YYYY, British English, GBP £\n    99→\n   100→---\n   101→\n   102→## APPLICATION SHELL\n   103→\n   104→### Navigation Structure\n   105→\n   106→**Persistent left sidebar** (280px, collapsible to 64px icons-only):\n   107→- Background: `--surface-card`\n   108→- Active item: `--brand-teal` left border + tinted background\n   109→- Sections with dividers:\n   110→  - NAVIGATE: Explore (map icon), Dashboard\n   111→  - MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance, Complaints, Allocations, ASB\n   112→  - COMMUNICATE: Communications\n   113→  - ANALYSE: Reports, AI Centre\n   114→  - SYSTEM: Admin, Settings\n   115→- Notification badges on items with outstanding actions (garnet dot)\n   116→\n   117→**Top header bar** (`--surface-dark`):\n   118→- Left: Yantra.Works logo + \"SocialHomes.Ai\" branding\n   119→- Centre: Global search bar (dark input, magnifying glass icon, `--border-default` border, placeholder: \"Search tenants, properties, cases...\")\n   120→- Right: Notification bell (garnet badge count), AI Assist button (Yantra mark with pulsing purple ring), User avatar + \"Sarah Mitchell\" dropdown with persona switcher\n   121→\n   122→**Breadcrumbs**: On every page, `--text-muted` with `--brand-teal` links, reflecting hierarchy path\n   123→\n   124→**Phase banner**: `--brand-garnet` \"BETA\" tag\n   125→\n   126→---\n   127→\n   128→## ROUTE STRUCTURE\n   129→\n   130→```\n   131→/ → /briefing (AI morning briefing — full-screen personalised)\n   132→/dashboard — Operational nerve centre\n   133→/explore — Visual drill-down hierarchy (Part 1)\n   134→  /explore/country\n   135→  /explore/region/:id\n   136→  /explore/region/:id/la/:id\n   137→  /explore/region/:id/la/:id/estate/:id\n   138→  /explore/region/:id/la/:id/estate/:id/block/:id\n   139→  /explore/region/:id/la/:id/estate/:id/block/:id/core/:id\n   140→  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id\n   141→  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id/tenant/:id\n   142→/search — Global search results\n   143→/tenancies — List (search, filter, sort)\n   144→/tenancies/:id — Tenancy detail (tabbed)\n   145→/tenancies/new — Create tenancy\n   146→/properties — Property list (map/list toggle)\n   147→/properties/:uprn — Property detail (tabbed)\n   148→/repairs — List with kanban toggle\n   149→/repairs/:id — Repair detail with timeline\n   150→/repairs/new — AI-assisted repair intake\n   151→/repairs/schedule — Workforce calendar\n   152→/rent — Arrears dashboard\n   153→/rent/accounts — Rent account list\n   154→/rent/accounts/:id — Individual rent account (statement)\n   155→/rent/arrears — AI-prioritised worklist\n   156→/compliance — Big 6 dashboard\n   157→/compliance/gas — Gas safety certificates\n   158→/compliance/electrical — EICRs\n   159→/compliance/fire — Fire risk assessments\n   160→/compliance/asbestos — Asbestos register\n   161→/compliance/legionella — Water safety\n   162→/compliance/lifts — Lift safety\n   163→/compliance/awaabs-law — Damp & mould tracker with AI risk\n   164→/complaints — Dashboard with Ombudsman KPIs\n   165→/complaints/:id — Complaint detail (two-stage timeline)\n   166→/complaints/new — AI-categorised complaint intake\n   167→/allocations — Housing register & lettings\n   168→/allocations/voids — Void management pipeline (kanban)\n   169→/allocations/lettings — Available properties\n   170→/asb — ASB case list\n   171→/asb/:id — ASB case detail\n   172→/communications — Unified inbox\n   173→/communications/templates — GOV.UK Notify template manager\n   174→/reports — Report hub\n   175→/reports/tsm — Tenant Satisfaction Measures (22 indicators)\n   176→/reports/core — CORE lettings/sales returns\n   177→/reports/regulatory — Consumer Standards compliance\n   178→/reports/ombudsman — Complaint Handling Code self-assessment\n   179→/reports/performance — Operational performance\n   180→/reports/financial — Financial reports\n   181→/reports/stock-condition — Stock condition & investment\n   182→/ai — AI command centre\n   183→/ai/insights — Cross-module AI insight feed\n   184→/ai/predictions — Active prediction models\n   185→/ai/assistant — Conversational AI chat\n   186→/admin — Full administration system (see Document 2)\n   187→/admin/organisation\n   188→/admin/users\n   189→/admin/teams\n   190→/admin/workflows\n   191→/admin/integrations\n   192→/admin/audit\n   193→/admin/system\n   194→/tenant-portal — Separate tenant-facing self-service (distinct, warmer UI)\n   195→/tenant-portal/repairs\n   196→/tenant-portal/rent\n   197→/tenant-portal/documents\n   198→/tenant-portal/contact\n   199→```\n   200→\n   201→---\n   202→\n   203→## PART 1: VISUAL DRILL-DOWN HIERARCHY\n   204→\n   205→The PRIMARY navigation experience. Users visually navigate from Country → Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every level, the right panel shows that level's attributes, KPIs, compliance, and AI insights.\n   206→\n   207→### Layout\n   208→\n   209→```\n   210→┌──────────────────────────────────────────────────────────────────┐\n   211→│ Header: SocialHomes.Ai | Search | Notifications | AI | User     │\n   212→├──────────────────────────────────────────────────────────────────┤\n   213→│ Breadcrumb: Country > Region > LA > Estate > Block > Unit > ... │\n   214→├────────────────────────────────┬─────────────────────────────────┤\n   215→│                                │  CONTEXT PANEL (scrollable)     │\n   216→│      MAP / 3D VIEW             │  - Entity name & summary        │\n   217→│      (60% width)               │  - Attribute cards               │\n   218→│                                │  - Compliance status             │\n   219→│      Interactive Leaflet map   │  - KPI metrics                   │\n   220→│      OR Three.js 3D building   │  - AI insights (purple section)  │\n   221→│      depending on zoom level   │  - AI dynamic actions (Doc 2)    │\n   222→│                                │  - Children list (next level)    │\n   223→│                                │  - Quick actions                  │\n   224→├────────────────────────────────┴─────────────────────────────────┤\n   225→│ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n   226→└──────────────────────────────────────────────────────────────────┘\n   227→```\n   228→\n   229→### LEVEL 0: Country (`/explore/country`)\n   230→- Map: England centred (~52.5°N, 1.5°W, zoom 6). 3 operational regions shown with property count badges.\n   231→- Panel: Organisation portfolio summary — total units, occupancy rate, overall compliance %, total arrears, collection rate, TSM headlines. Regional breakdown table. Regulatory status (G1/V1). Stock by tenure type (pie chart).\n   232→\n   233→### LEVEL 1: Region (`/explore/region/:id`)\n   234→- Map: Zooms to region (e.g., London, zoom 10). LA areas shown as markers sized by stock count, coloured by compliance.\n   235→- Panel: Region KPIs — compliance, arrears, voids, repairs backlog. LA breakdown table. Stock profile. Average EPC distribution.\n   236→\n   237→### LEVEL 2: Local Authority (`/explore/region/:id/la/:id`)\n   238→- Map: Zoom 13. Estates as clusters/polygons with mini-donut compliance indicators.\n   239→- Panel: Properties in LA, tenancies, voids. Compliance by Big 6. Estates list with click-through. LA context (housing market, LHA rates, nomination agreements).\n   240→\n   241→### LEVEL 3: Estate / Scheme (`/explore/.../estate/:id`)\n   242→- Map: Zoom 16-17. Individual buildings as footprints, colour-coded (green=compliant, amber=issues, red=critical).\n   243→- Panel: Estate name, postcode, construction era, total units. KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases. Buildings list. Estate management (officer, contractors, inspection score). Communal areas condition. External areas. Scheme type (general needs/sheltered/extra care/supported). Estate budget chart.\n   244→\n   245→### LEVEL 4: Block / Building (`/explore/.../block/:id`)\n   246→- **Transition to 3D view**: Map transitions to a Three.js 3D building visualisation (procedurally generated: extruded rectangle, floors shown as stacked layers, windows as grid pattern). Can toggle back to 2D map. Rotate, zoom, pan with OrbitControls.\n   247→- Panel: Building name, address, UPRN, construction details (type, year, storeys), higher-risk building flag (≥18m/≥7 storeys).\n   248→- **BUILDING-LEVEL ATTRIBUTES** (these attach to the building, NOT individual units):\n   249→  - Fire Risk Assessment: date, risk level, action plan items status\n   250→  - Building Safety Case (if higher-risk): accountable person, BSR registration, safety case status\n   251→  - Communal fire systems: detection type/zones/service date, emergency lighting, means of escape, compartmentation, fire doors\n   252→  - Asbestos management plan: building-level register, ACM count by location\n   253→  - Legionella risk assessment: water system, cold water tanks, TMVs, dead legs\n   254→  - Structural surveys, roof condition, communal boiler/heating, lifts (LOLER), entry systems, insurance\n   255→- Units list: number, floor, bedrooms, tenure, occupancy, tenant name, compliance RAG, rent RAG\n   256→\n   257→### LEVEL 4a: Core / Entrance (`/explore/.../core/:id`)\n   258→- For buildings with multiple cores (e.g., tower blocks with separate stairwells)\n   259→- Visual: schematic floor plan showing units per floor for this core\n   260→- Panel: Core ID, floors served, units, stairwell condition, lift, fire escape\n   261→\n   262→### LEVEL 5: Unit (`/explore/.../unit/:id`)\n   263→- 3D: Highlighted unit within the building model. Context map showing position.\n   264→- Panel (tabbed):\n   265→  - **Overview**: address, UPRN, type, bedrooms, floor area, heating, tenure, current tenancy or void status, photos, accessibility features\n   266→  - **Compliance** — UNIT-LEVEL ATTRIBUTES:\n   267→    - Gas Safety (CP12): annual, per-appliance breakdown with combustion readings, access history\n   268→    - EICR: 5-yearly, per-circuit observations with C1/C2/C3/FI classifications\n   269→    - EPC: rating band display, SAP score, costs, CO2, recommendations\n   270→    - Smoke & CO alarms: per-alarm type/location/test dates\n   271→    - Unit-specific asbestos: per-ACM records\n   272→    - Boiler: make/model/age/service history/efficiency\n   273→    - Decent Homes assessment: 5 criteria (A-E including new damp/mould)\n   274→  - **Stock Condition**: component lifecycle table (roof, windows, kitchen, bathroom, boiler, electrics, etc. with type, install year, condition 1-5, remaining life, replacement cost)\n   275→  - **Damp & Mould / Awaab's Law**: AI risk score 0-100, active cases with countdown timers, IoT sensor data (simulated)\n   276→  - **Works History**: all repairs/works with costs, annual spend trend\n   277→  - **Documents**: certificates, reports, photos\n   278→\n   279→### LEVEL 6: Tenant (`/explore/.../tenant/:id`)\n   280→- Panel (tabbed):\n   281→  - **Overview**: name, DOB, contact, household members table, emergency contact, assigned officers, vulnerability flags (with sensitivity controls), key dates, tenancy type/status\n   282→  - **Cases** — UNIFIED CASE TIMELINE (filterable by type):\n   283→    | Type | Format | Colour |\n   284→    |------|--------|--------|\n   285→    | Complaint | CMP-YYYY-XXXXX | Orange |\n   286→    | Repair | REP-YYYY-XXXXX | Blue |\n   287→    | ASB | ASB-YYYY-XXXXX | Red |\n   288→    | Enquiry | ENQ-YYYY-XXXXX | Grey |\n   289→    | Financial | FIN-YYYY-XXXXX | Amber |\n   290→    | Safeguarding | SAF-YYYY-XXXXX | Purple |\n   291→    | Damp/Mould | DAM-YYYY-XXXXX | Teal |\n   292→    Each card: type icon, reference, date, subject, status tag, handler, days open, SLA countdown, click to expand or navigate to full detail\n   293→  - **Activities**: chronological log — calls, visits, letters, emails, SMS, system events. Each linked to a case.\n   294→  - **Tasks**: outstanding/completed tasks — description, due date, priority, status, linked case\n   295→  - **Statement (Rent Account)**:\n   296→    - Balance (large, colour-coded), weekly charge, payment method, UC/HB status\n   297→    - Rent breakdown: base rent + itemised service charges\n   298→    - Transaction ledger: date, week, type, description, debit, credit, running balance\n   299→    - 52-week statement view (standard UK housing format)\n   300→    - Balance trend chart (12 months)\n   301→    - Payment arrangement: terms, compliance tracker\n   302→  - **Orders** — Financial/contractual instruments:\n   303→    | Order | Key Fields |\n   304→    |-------|-----------|\n   305→    | Rent Order | Amount, effective date, formula rent calculation, increase history, cap check |\n   306→    | Tenure Type | Secure/Assured/AST/Starter/Fixed Term/Flexible/Licence/Shared Ownership (equity %) |\n   307→    | Service Charge | Per-service: description, budget, apportionment, weekly amount, S20 status |\n   308→    | Garage/Parking | Location, charge, licence terms |\n   309→    | Rechargeable Repair | Repair ref, cost, payment plan, recovery status |\n   310→    | Court Order | Type, court, date, terms, compliance, review date |\n   311→    | Leaseholder | Equity %, staircasing history, ground rent, insurance share |\n   312→\n   313→### LEVEL 7: Case Detail\n   314→All cases share a common layout:\n   315→\n   316→```\n   317→┌─────────────────────────────────────────────────────────────┐\n   318→│ Case Header: Reference | Type Tag | Status Tag | Priority   │\n   319→│ Property: [link] | Tenant: [link] | Handler: name           │\n   320→├─────────────────────────────────────────────────────────────┤\n   321→│  STAGE TIMELINE (horizontal stepper with dates/countdowns)  │\n   322→├──────────────────────────┬──────────────────────────────────┤\n   323→│ Case Details (55%)       │ Activity Feed (45%, scrollable)  │\n   324→│ Description, category,   │ Chronological log of actions,    │\n   325→│ attachments, AI analysis │ notes, letters, status changes   │\n   326→├──────────────────────────┴──────────────────────────────────┤\n   327→│ Actions: [Assign] [Update] [Escalate] [Close] [AI Actions]  │\n   328→└─────────────────────────────────────────────────────────────┘\n   329→```\n   330→\n   331→**Complaint**: Two-stage timeline with countdown timers (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD). Category, findings (upheld/partial/not), remedy, learning log, Ombudsman escalation.\n   332→\n   333→**Repair**: Priority-based SLA timer. SOR code, trade, appointment, risk assessment, operative notes, photos before/during/after, materials, satisfaction survey, first-time fix, Awaab's Law compliance (if damp/mould).\n   334→\n   335→**ASB**: Category/severity (Cat 1-3). Evidence log. Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession → Closure. Multi-agency panel. Risk assessment. Community Trigger check.\n   336→\n   337→**Financial**: Arrears reason, payment arrangement, escalation stage (pre-action → NOSP → court → possession), Pre-Action Protocol checklist.\n   338→\n   339→**Damp/Mould (Awaab's Law)**: Hazard classification. **Countdown timers**: Emergency (24hrs all actions), Significant (investigate 10WD → summary 3WD → safety works 5WD → repairs begun 12 weeks). Cause assessment. Environmental data. Linked repairs.\n   340→\n   341→---\n   342→\n   343→## PART 2: TRADITIONAL NAVIGATION MODULES\n   344→\n   345→### Dashboard (`/dashboard`)\n   346→**8 KPI cards** (top row): Properties (12,847), Tenancies (12,103), Active Repairs (487), Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293), Compliance (98.7%), Open Complaints (34), AI Alerts (12).\n   347→\n   348→**Charts row**: Rent collection 12-month trend vs 97% target | Repairs monthly volume by priority with avg days line\n   349→\n   350→**Three panels**: Big 6 compliance heatmap (6 tiles, % + RAG) | Awaab's Law active cases with countdown timers | AI insights scrolling feed\n   351→\n   352→**Activity timeline**: Real-time system event feed with avatars, timestamps, entity links\n   353→\n   354→### Repairs (`/repairs`)\n   355→- List/Kanban toggle. Columns: ref, date, property, SOR category, priority, status, operative, target date, days elapsed\n   356→- Kanban: status columns, cards with priority colour borders\n   357→- New repair wizard: property lookup → free-text description → AI auto-suggests SOR code/priority/trade/Awaab's Law flags → appointment booking → risk assessment → confirm\n   358→- Schedule: weekly calendar, operative schedules, capacity indicators\n   359→\n   360→### Rent & Income (`/rent`)\n   361→- Arrears dashboard: total, by band (chart), collection rate gauge, payment method breakdown\n   362→- AI-prioritised worklist: each case with tenant details, arrears amount, 12-week sparkline, AI score (1-100), risk factors, recommended action, action buttons\n   363→\n   364→### Compliance (`/compliance`)\n   365→- Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n   366→- Awaab's Law: active cases with timers, risk register (all properties with AI scores), proactive inspection programme\n   367→- Each area page: certificate list, filters, no-access tracker, contractor performance\n   368→\n   369→### Complaints (`/complaints`)\n   370→- Dashboard: Stage 1/2 counts, response % vs timescale, TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n   371→- New: tenant selection → free-text → AI categorises/assigns severity/checks history → handler assignment → auto-acknowledgement\n   372→- Detail: two-stage timeline with countdowns\n   373→\n   374→### Allocations (`/allocations`)\n   375→- Housing register: applicants by band (A-D), bedroom need, medical priority\n   376→- Void kanban: Notice → Keys → Inspection → Works → Quality → Ready → Offer → Let. Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n   377→\n   378→### ASB (`/asb`)\n   379→- Case list: ref, location, category, severity, status, handler, days open\n   380→- Detail: escalation pipeline visual tracker, evidence log, multi-agency panel\n   381→\n   382→### Communications (`/communications`)\n   383→- Unified inbox: all channels linked to tenant/property/case. AI triage: auto-categorise, priority, sentiment, suggested response.\n   384→\n   385→### AI Centre (`/ai`)\n   386→- Insights feed: predictions, alerts, recommendations, analytics — with confidence %, affected entities, action buttons\n   387→- Predictions: Arrears (scatter + top 50 + feature importance), Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n   388→- Assistant: chat panel with natural language queries\n   389→\n   390→### Tenant Portal (`/tenant-portal`)\n   391→- **Visually distinct**: lighter/warmer theme option, simpler layout, larger text, no jargon, large touch targets\n   392→- Dashboard: welcome, quick actions (report repair, check balance, make payment, contact), active repairs, rent balance, appointments\n   393→- Report repair: conversational wizard — room → problem category tiles → sub-category → photo → appointment → confirm. AI urgency detection.\n   394→- Rent: clear balance, simple transactions, payment button\n   395→\n   396→---\n   397→\n   398→## PART 3: BASELINE REPORTING\n   399→\n   400→### Regulatory Returns\n   401→- TSM Annual Return (22 measures with actuals, targets, sector medians, quartiles)\n   402→- CORE Lettings/Sales Logs (field validation, CSV export)\n   403→- Consumer Standards Self-Assessment (4 standards, evidence mapping)\n   404→- Complaint Handling Code Self-Assessment (per-section compliance scoring)\n   405→- Building Safety Act Returns (higher-risk buildings)\n   406→- Statistical Data Return (SDR) for RSH\n   407→\n   408→### Operational Performance\n   409→- Repairs: volume, SLA %, first-time fix, satisfaction, spend, top costliest properties\n   410→- Voids: average relet days, rent loss, by stage, contractor performance\n   411→- Arrears: collection rate, band movement, payment methods, UC performance, court pipeline\n   412→- Complaints: volume, response %, findings, compensation, root causes, learning actions\n   413→- ASB: cases opened/closed, resolution days, enforcement actions\n   414→- Contact Centre: call volumes, wait times, channel usage, first contact resolution\n   415→\n   416→### Compliance Reports\n   417→- Big 6 dashboard (daily/weekly per area)\n   418→- Per-area: gas programme, electrical, fire, asbestos, legionella, lifts\n   419→- Awaab's Law compliance (weekly)\n   420→- Decent Homes (quarterly)\n   421→- Stock Condition (quarterly/annual)\n   422→- EPC / Energy (quarterly)\n   423→\n   424→### Financial Reports\n   425→- Rent setting summary, service charge report, repairs expenditure, bad debt provision, void loss\n   426→\n   427→### Governance\n   428→- Board performance pack (monthly/quarterly executive dashboard)\n   429→- Risk register, regulatory compliance summary, H&S summary\n   430→\n   431→### Tenant-Facing\n   432→- Annual report to tenants (TSM results, repairs, complaints, improvements)\n   433→- Estate reports (quarterly per-estate)\n   434→\n   435→### Report Features\n   436→Every report supports: date range, property group, tenure type, comparison period, CSV/PDF export, drill-down from aggregates, benchmarking vs targets/previous/sector, AI-generated narrative summary, scheduled email distribution.\n   437→\n   438→---\n   439→\n   440→## SIMULATED DATA\n   441→\n   442→**Organisation**: Riverside Crescent Housing Association (RCHA), RP 4567, G1/V1, HQ Southwark. Stock across Southwark, Lewisham, Lambeth.\n   443→\n   444→**5 Estates:**\n   445→1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n   446→2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n   447→3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n   448→4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n   449→5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n   450→\n   451→**50 properties, 45 active tenancies, 5 voids.** Realistic SE London postcodes, 12-digit UPRNs, diverse tenant names reflecting London demographics.\n   452→\n   453→Rents: social £95-140/week, affordable £140-200/week. Service charges £5-35/week.\n   454→Payment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%.\n   455→Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k.\n   456→\n   457→**200 repairs** (5% emergency, 15% urgent, 70% routine, 10% planned). 95% emergency <24hrs, 88% urgent <5 days, 82% routine <28 days. FTF: 78%. Satisfaction: mean 3.8/5.\n   458→\n   459→**34 open complaints** (28 Stage 1, 6 Stage 2). Response within timescale: 91%.\n   460→**12 ASB cases.** **8 damp/mould cases** (3 emergency, 5 significant). **25 financial cases.** **5 voids** at various stages.\n   461→\n   462→Compliance: Gas 99.4%, Electrical 97.8%, Fire 99.1%, Asbestos 98.5%, Legionella 99.0%, Lifts 100%.\n   463→\n   464→---\n   465→\n   466→## IMPLEMENTATION REQUIREMENTS\n   467→\n   468→1. **Every page fully functional** — no \"coming soon\" placeholders\n   469→2. **Visual drill-down is the flagship** — smooth map-to-3D transitions, each level shows correct attributes\n   470→3. **Data relationships consistent** — navigating hierarchy = same data as direct search\n   471→4. **Countdown timers prominent** — Awaab's Law and complaints deadlines with colour-coded urgency\n   472→5. **Dark mode default** — Yantra.Works brand palette throughout\n   473→6. **Attributes at correct level** — building-level (FRA, building safety) vs unit-level (gas, EICR, EPC)\n   474→7. **Tenant portal visually distinct** — simpler, warmer\n   475→8. **UK conventions** — DD/MM/YYYY, British English, GBP, \"flat\" not \"apartment\"\n   476→9. **Accessibility** — WCAG 2.2 AA contrast, keyboard navigation, aria-labels, visible focus states\n   477→10. **Animations throughout** — staggered reveals, sliding panels, smooth transitions, pulsing alerts. The UI must feel alive.\n   478→11. **Leave clear integration points** for Document 2's AI features: empty `<div id=\"ai-assist-panel\">` on every page, empty `<div id=\"ai-dynamic-actions\">` in every entity detail page, persona context in global state\n   479→12. **Build as single self-contained file** using CDN imports\n   480→\n   481→Now build the complete SocialHomes.Ai base application.\n   482→"}]},"uuid":"e4f03e54-6da0-4120-8ff0-c5695ad3133b","timestamp":"2026-02-23T18:40:53.431Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc1-SocialHomesAi-Base-Specification.txt","content":"# DOCUMENT 1 OF 2: BASE APPLICATION SPECIFICATION\n# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n\n## INSTRUCTION TO AI\n\nYou are building **SocialHomes.Ai**, a comprehensive, open-source, AI-native housing management system for UK social housing providers (housing associations and local authorities) managing 5,000–20,000 units. Created by **Yantra.Works**.\n\nBuild a complete, multi-page React application. This is NOT a legacy housing system with a fresh coat of paint. This must look and feel like nothing the social housing sector has ever seen — think Bloomberg Terminal meets Figma, not a government form. The sector is dominated by ugly, slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai is the opposite: dark, fast, visually stunning, animated, intelligent.\n\nThere is a companion document (Document 2) that specifies all AI-native features, dynamic buttons/fields, personas, admin system, and prediction models. Build the base application first using this document, then apply Document 2's features.\n\n---\n\n## TECHNICAL STACK\n\n- **React 19** with functional components, hooks, Suspense\n- **React Router v7** for client-side routing with nested routes\n- **Tailwind CSS v4** via CDN — Yantra.Works dark-mode-first brand language\n- **Three.js (r128)** via `https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js` — for 3D building visualisations in the drill-down\n- **Leaflet 1.9** with OpenStreetMap tiles — for 2D map views (free, no API key)\n- **Recharts** for dashboards and charts\n- **D3.js** for advanced visualisations (Sankey diagrams, heatmaps)\n- **Lucide React** for iconography\n- **Animations**: CSS transitions and keyframe animations throughout — every page load has staggered reveals, every panel slides, every card fades in, status changes animate. The UI must feel ALIVE, not static.\n- **State management**: React Context + useReducer\n- Do NOT use localStorage or sessionStorage\n\n---\n\n## BRANDING\n\n### Logo\nThe product logo is the Yantra.Works geometric mark in teal. Embed this SVG inline:\n\n```svg\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 751 772\" width=\"36\" height=\"37\">\n  <path fill=\"#058995\" d=\"M745.51,390.8l-95.41-91.94-41.32,42.88,48.94,47.16-250.45,254.19-1.31-194.04,12.47-12.74-.31-.3,143.2-143.64.08.08,42.88-42.58-.29-.29,1-1-41.76-41.63-.79.79L377.89,21.94l-1.41,1.4-.43-.44L10.05,385.9l.67.67-2.57,2.54,325.25,328.97-.16.16,12.35,12.17,30.65,31,.41-.4,2.02,1.99,324.99-329.84.55.53,41.32-42.88ZM345.09,452.5l1.28,189.95-251.12-253.99,92.74-91.98,144.76,141.66-1.03,1.03,13.37,13.33ZM375.98,394.78l-144.51-141.42,146.65-145.45,141.65,142.63-143.79,144.23Z\"/>\n</svg>\n```\n\n- Header: Logo mark (36px) + **\"SocialHomes.Ai\"** (`--brand-teal`, with \".Ai\" in `--status-ai` purple) + **\"by Yantra.Works\"** (smaller, `--brand-soft`)\n- Tagline: \"AI-native. Human-assured.\"\n- Footer: \"SocialHomes.Ai is an open-source project by Yantra.Works — www.socialhomes.ai\"\n\n### Colour Palette — Yantra.Works Official Brand\n\n```css\n/* Brand palette */\n--brand-peach: #EFAC92;     /* Headings & Accents */\n--brand-garnet: #BE3358;    /* Action & Signature — CTAs, critical alerts */\n--brand-teal: #058995;      /* Logo & Labels — primary identity, links */\n--brand-blue: #5BA4AA;      /* Atmospheric UI — charts, secondary highlights */\n--brand-soft: #ACC0B5;      /* Metadata Text — secondary text, labels */\n--brand-deep: #1A5A5E;      /* Core Surfaces — dark panels, sidebars */\n\n/* Dark theme surfaces */\n--surface-dark: #0D1117;    /* Page background */\n--surface-card: #151B23;    /* Card/panel backgrounds */\n--surface-elevated: #1C2333;/* Modals, dropdowns, elevated panels */\n--surface-hover: #222D3D;   /* Hover states */\n\n/* Text */\n--text-primary: #E6EDF3;    /* Primary text */\n--text-secondary: #ACC0B5;  /* Secondary text (= brand-soft) */\n--text-muted: #6B7B8D;      /* Timestamps, IDs, low-priority text */\n\n/* Borders */\n--border-default: #2A3545;\n--border-focus: #EFAC92;    /* Focus ring — peach for visibility on dark */\n\n/* Semantic statuses */\n--status-compliant: #2EA043;  /* Green */\n--status-warning: #EFAC92;    /* Peach/amber */\n--status-critical: #BE3358;   /* Garnet */\n--status-info: #5BA4AA;       /* Blue */\n--status-ai: #A371F7;         /* Purple — AI features */\n--status-void: #6B7B8D;       /* Grey */\n```\n\n### Typography\n- Headings: `\"Space Grotesk\", sans-serif` — bold, technical\n- Body: `\"Inter\", Arial, sans-serif` — clean, readable\n- Monospace: `\"JetBrains Mono\", monospace` — references, codes\n- Body size: 15px. Line height: 1.6 body, 1.2 headings\n- Headings in `--brand-peach` on dark backgrounds\n- Section labels: `--brand-teal`, uppercase, letter-spaced\n\n### Design Principles\n- **Dark mode is default** — `--surface-dark` background with warm accent colours\n- Max content width: 1400px (except full-bleed map views)\n- Cards: `--surface-card` background, 4px left colour border for RAG, 8px rounded corners, subtle shadow\n- Status tags: pill-shaped, semi-transparent background\n- Countdown timers: large monospace digits, colour transitions green→peach→garnet→pulsing garnet\n- Tables: `--surface-card` background, `--surface-hover` on hover, sortable columns\n- Buttons: `--brand-teal` primary, `--surface-elevated` secondary, `--brand-garnet` destructive, `--status-ai` purple for AI actions\n- Charts: teal primary, blue secondary, peach highlights, garnet alerts\n- Subtle background grid/dot pattern at 3% opacity for texture\n- UK date format DD/MM/YYYY, British English, GBP £\n\n---\n\n## APPLICATION SHELL\n\n### Navigation Structure\n\n**Persistent left sidebar** (280px, collapsible to 64px icons-only):\n- Background: `--surface-card`\n- Active item: `--brand-teal` left border + tinted background\n- Sections with dividers:\n  - NAVIGATE: Explore (map icon), Dashboard\n  - MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance, Complaints, Allocations, ASB\n  - COMMUNICATE: Communications\n  - ANALYSE: Reports, AI Centre\n  - SYSTEM: Admin, Settings\n- Notification badges on items with outstanding actions (garnet dot)\n\n**Top header bar** (`--surface-dark`):\n- Left: Yantra.Works logo + \"SocialHomes.Ai\" branding\n- Centre: Global search bar (dark input, magnifying glass icon, `--border-default` border, placeholder: \"Search tenants, properties, cases...\")\n- Right: Notification bell (garnet badge count), AI Assist button (Yantra mark with pulsing purple ring), User avatar + \"Sarah Mitchell\" dropdown with persona switcher\n\n**Breadcrumbs**: On every page, `--text-muted` with `--brand-teal` links, reflecting hierarchy path\n\n**Phase banner**: `--brand-garnet` \"BETA\" tag\n\n---\n\n## ROUTE STRUCTURE\n\n```\n/ → /briefing (AI morning briefing — full-screen personalised)\n/dashboard — Operational nerve centre\n/explore — Visual drill-down hierarchy (Part 1)\n  /explore/country\n  /explore/region/:id\n  /explore/region/:id/la/:id\n  /explore/region/:id/la/:id/estate/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/core/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id\n  /explore/region/:id/la/:id/estate/:id/block/:id/unit/:id/tenant/:id\n/search — Global search results\n/tenancies — List (search, filter, sort)\n/tenancies/:id — Tenancy detail (tabbed)\n/tenancies/new — Create tenancy\n/properties — Property list (map/list toggle)\n/properties/:uprn — Property detail (tabbed)\n/repairs — List with kanban toggle\n/repairs/:id — Repair detail with timeline\n/repairs/new — AI-assisted repair intake\n/repairs/schedule — Workforce calendar\n/rent — Arrears dashboard\n/rent/accounts — Rent account list\n/rent/accounts/:id — Individual rent account (statement)\n/rent/arrears — AI-prioritised worklist\n/compliance — Big 6 dashboard\n/compliance/gas — Gas safety certificates\n/compliance/electrical — EICRs\n/compliance/fire — Fire risk assessments\n/compliance/asbestos — Asbestos register\n/compliance/legionella — Water safety\n/compliance/lifts — Lift safety\n/compliance/awaabs-law — Damp & mould tracker with AI risk\n/complaints — Dashboard with Ombudsman KPIs\n/complaints/:id — Complaint detail (two-stage timeline)\n/complaints/new — AI-categorised complaint intake\n/allocations — Housing register & lettings\n/allocations/voids — Void management pipeline (kanban)\n/allocations/lettings — Available properties\n/asb — ASB case list\n/asb/:id — ASB case detail\n/communications — Unified inbox\n/communications/templates — GOV.UK Notify template manager\n/reports — Report hub\n/reports/tsm — Tenant Satisfaction Measures (22 indicators)\n/reports/core — CORE lettings/sales returns\n/reports/regulatory — Consumer Standards compliance\n/reports/ombudsman — Complaint Handling Code self-assessment\n/reports/performance — Operational performance\n/reports/financial — Financial reports\n/reports/stock-condition — Stock condition & investment\n/ai — AI command centre\n/ai/insights — Cross-module AI insight feed\n/ai/predictions — Active prediction models\n/ai/assistant — Conversational AI chat\n/admin — Full administration system (see Document 2)\n/admin/organisation\n/admin/users\n/admin/teams\n/admin/workflows\n/admin/integrations\n/admin/audit\n/admin/system\n/tenant-portal — Separate tenant-facing self-service (distinct, warmer UI)\n/tenant-portal/repairs\n/tenant-portal/rent\n/tenant-portal/documents\n/tenant-portal/contact\n```\n\n---\n\n## PART 1: VISUAL DRILL-DOWN HIERARCHY\n\nThe PRIMARY navigation experience. Users visually navigate from Country → Region → LA → Estate → Block → Core → Unit → Tenant → Cases. At every level, the right panel shows that level's attributes, KPIs, compliance, and AI insights.\n\n### Layout\n\n```\n┌──────────────────────────────────────────────────────────────────┐\n│ Header: SocialHomes.Ai | Search | Notifications | AI | User     │\n├──────────────────────────────────────────────────────────────────┤\n│ Breadcrumb: Country > Region > LA > Estate > Block > Unit > ... │\n├────────────────────────────────┬─────────────────────────────────┤\n│                                │  CONTEXT PANEL (scrollable)     │\n│      MAP / 3D VIEW             │  - Entity name & summary        │\n│      (60% width)               │  - Attribute cards               │\n│                                │  - Compliance status             │\n│      Interactive Leaflet map   │  - KPI metrics                   │\n│      OR Three.js 3D building   │  - AI insights (purple section)  │\n│      depending on zoom level   │  - AI dynamic actions (Doc 2)    │\n│                                │  - Children list (next level)    │\n│                                │  - Quick actions                  │\n├────────────────────────────────┴─────────────────────────────────┤\n│ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n└──────────────────────────────────────────────────────────────────┘\n```\n\n### LEVEL 0: Country (`/explore/country`)\n- Map: England centred (~52.5°N, 1.5°W, zoom 6). 3 operational regions shown with property count badges.\n- Panel: Organisation portfolio summary — total units, occupancy rate, overall compliance %, total arrears, collection rate, TSM headlines. Regional breakdown table. Regulatory status (G1/V1). Stock by tenure type (pie chart).\n\n### LEVEL 1: Region (`/explore/region/:id`)\n- Map: Zooms to region (e.g., London, zoom 10). LA areas shown as markers sized by stock count, coloured by compliance.\n- Panel: Region KPIs — compliance, arrears, voids, repairs backlog. LA breakdown table. Stock profile. Average EPC distribution.\n\n### LEVEL 2: Local Authority (`/explore/region/:id/la/:id`)\n- Map: Zoom 13. Estates as clusters/polygons with mini-donut compliance indicators.\n- Panel: Properties in LA, tenancies, voids. Compliance by Big 6. Estates list with click-through. LA context (housing market, LHA rates, nomination agreements).\n\n### LEVEL 3: Estate / Scheme (`/explore/.../estate/:id`)\n- Map: Zoom 16-17. Individual buildings as footprints, colour-coded (green=compliant, amber=issues, red=critical).\n- Panel: Estate name, postcode, construction era, total units. KPIs: occupancy, compliance, repairs, arrears, ASB, damp cases. Buildings list. Estate management (officer, contractors, inspection score). Communal areas condition. External areas. Scheme type (general needs/sheltered/extra care/supported). Estate budget chart.\n\n### LEVEL 4: Block / Building (`/explore/.../block/:id`)\n- **Transition to 3D view**: Map transitions to a Three.js 3D building visualisation (procedurally generated: extruded rectangle, floors shown as stacked layers, windows as grid pattern). Can toggle back to 2D map. Rotate, zoom, pan with OrbitControls.\n- Panel: Building name, address, UPRN, construction details (type, year, storeys), higher-risk building flag (≥18m/≥7 storeys).\n- **BUILDING-LEVEL ATTRIBUTES** (these attach to the building, NOT individual units):\n  - Fire Risk Assessment: date, risk level, action plan items status\n  - Building Safety Case (if higher-risk): accountable person, BSR registration, safety case status\n  - Communal fire systems: detection type/zones/service date, emergency lighting, means of escape, compartmentation, fire doors\n  - Asbestos management plan: building-level register, ACM count by location\n  - Legionella risk assessment: water system, cold water tanks, TMVs, dead legs\n  - Structural surveys, roof condition, communal boiler/heating, lifts (LOLER), entry systems, insurance\n- Units list: number, floor, bedrooms, tenure, occupancy, tenant name, compliance RAG, rent RAG\n\n### LEVEL 4a: Core / Entrance (`/explore/.../core/:id`)\n- For buildings with multiple cores (e.g., tower blocks with separate stairwells)\n- Visual: schematic floor plan showing units per floor for this core\n- Panel: Core ID, floors served, units, stairwell condition, lift, fire escape\n\n### LEVEL 5: Unit (`/explore/.../unit/:id`)\n- 3D: Highlighted unit within the building model. Context map showing position.\n- Panel (tabbed):\n  - **Overview**: address, UPRN, type, bedrooms, floor area, heating, tenure, current tenancy or void status, photos, accessibility features\n  - **Compliance** — UNIT-LEVEL ATTRIBUTES:\n    - Gas Safety (CP12): annual, per-appliance breakdown with combustion readings, access history\n    - EICR: 5-yearly, per-circuit observations with C1/C2/C3/FI classifications\n    - EPC: rating band display, SAP score, costs, CO2, recommendations\n    - Smoke & CO alarms: per-alarm type/location/test dates\n    - Unit-specific asbestos: per-ACM records\n    - Boiler: make/model/age/service history/efficiency\n    - Decent Homes assessment: 5 criteria (A-E including new damp/mould)\n  - **Stock Condition**: component lifecycle table (roof, windows, kitchen, bathroom, boiler, electrics, etc. with type, install year, condition 1-5, remaining life, replacement cost)\n  - **Damp & Mould / Awaab's Law**: AI risk score 0-100, active cases with countdown timers, IoT sensor data (simulated)\n  - **Works History**: all repairs/works with costs, annual spend trend\n  - **Documents**: certificates, reports, photos\n\n### LEVEL 6: Tenant (`/explore/.../tenant/:id`)\n- Panel (tabbed):\n  - **Overview**: name, DOB, contact, household members table, emergency contact, assigned officers, vulnerability flags (with sensitivity controls), key dates, tenancy type/status\n  - **Cases** — UNIFIED CASE TIMELINE (filterable by type):\n    | Type | Format | Colour |\n    |------|--------|--------|\n    | Complaint | CMP-YYYY-XXXXX | Orange |\n    | Repair | REP-YYYY-XXXXX | Blue |\n    | ASB | ASB-YYYY-XXXXX | Red |\n    | Enquiry | ENQ-YYYY-XXXXX | Grey |\n    | Financial | FIN-YYYY-XXXXX | Amber |\n    | Safeguarding | SAF-YYYY-XXXXX | Purple |\n    | Damp/Mould | DAM-YYYY-XXXXX | Teal |\n    Each card: type icon, reference, date, subject, status tag, handler, days open, SLA countdown, click to expand or navigate to full detail\n  - **Activities**: chronological log — calls, visits, letters, emails, SMS, system events. Each linked to a case.\n  - **Tasks**: outstanding/completed tasks — description, due date, priority, status, linked case\n  - **Statement (Rent Account)**:\n    - Balance (large, colour-coded), weekly charge, payment method, UC/HB status\n    - Rent breakdown: base rent + itemised service charges\n    - Transaction ledger: date, week, type, description, debit, credit, running balance\n    - 52-week statement view (standard UK housing format)\n    - Balance trend chart (12 months)\n    - Payment arrangement: terms, compliance tracker\n  - **Orders** — Financial/contractual instruments:\n    | Order | Key Fields |\n    |-------|-----------|\n    | Rent Order | Amount, effective date, formula rent calculation, increase history, cap check |\n    | Tenure Type | Secure/Assured/AST/Starter/Fixed Term/Flexible/Licence/Shared Ownership (equity %) |\n    | Service Charge | Per-service: description, budget, apportionment, weekly amount, S20 status |\n    | Garage/Parking | Location, charge, licence terms |\n    | Rechargeable Repair | Repair ref, cost, payment plan, recovery status |\n    | Court Order | Type, court, date, terms, compliance, review date |\n    | Leaseholder | Equity %, staircasing history, ground rent, insurance share |\n\n### LEVEL 7: Case Detail\nAll cases share a common layout:\n\n```\n┌─────────────────────────────────────────────────────────────┐\n│ Case Header: Reference | Type Tag | Status Tag | Priority   │\n│ Property: [link] | Tenant: [link] | Handler: name           │\n├─────────────────────────────────────────────────────────────┤\n│  STAGE TIMELINE (horizontal stepper with dates/countdowns)  │\n├──────────────────────────┬──────────────────────────────────┤\n│ Case Details (55%)       │ Activity Feed (45%, scrollable)  │\n│ Description, category,   │ Chronological log of actions,    │\n│ attachments, AI analysis │ notes, letters, status changes   │\n├──────────────────────────┴──────────────────────────────────┤\n│ Actions: [Assign] [Update] [Escalate] [Close] [AI Actions]  │\n└─────────────────────────────────────────────────────────────┘\n```\n\n**Complaint**: Two-stage timeline with countdown timers (Stage 1: ack 5WD, respond 10WD; Stage 2: ack 5WD, respond 20WD). Category, findings (upheld/partial/not), remedy, learning log, Ombudsman escalation.\n\n**Repair**: Priority-based SLA timer. SOR code, trade, appointment, risk assessment, operative notes, photos before/during/after, materials, satisfaction survey, first-time fix, Awaab's Law compliance (if damp/mould).\n\n**ASB**: Category/severity (Cat 1-3). Evidence log. Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession → Closure. Multi-agency panel. Risk assessment. Community Trigger check.\n\n**Financial**: Arrears reason, payment arrangement, escalation stage (pre-action → NOSP → court → possession), Pre-Action Protocol checklist.\n\n**Damp/Mould (Awaab's Law)**: Hazard classification. **Countdown timers**: Emergency (24hrs all actions), Significant (investigate 10WD → summary 3WD → safety works 5WD → repairs begun 12 weeks). Cause assessment. Environmental data. Linked repairs.\n\n---\n\n## PART 2: TRADITIONAL NAVIGATION MODULES\n\n### Dashboard (`/dashboard`)\n**8 KPI cards** (top row): Properties (12,847), Tenancies (12,103), Active Repairs (487), Rent Collected (£1.84M/£1.92M = 95.8%), Arrears (£847,293), Compliance (98.7%), Open Complaints (34), AI Alerts (12).\n\n**Charts row**: Rent collection 12-month trend vs 97% target | Repairs monthly volume by priority with avg days line\n\n**Three panels**: Big 6 compliance heatmap (6 tiles, % + RAG) | Awaab's Law active cases with countdown timers | AI insights scrolling feed\n\n**Activity timeline**: Real-time system event feed with avatars, timestamps, entity links\n\n### Repairs (`/repairs`)\n- List/Kanban toggle. Columns: ref, date, property, SOR category, priority, status, operative, target date, days elapsed\n- Kanban: status columns, cards with priority colour borders\n- New repair wizard: property lookup → free-text description → AI auto-suggests SOR code/priority/trade/Awaab's Law flags → appointment booking → risk assessment → confirm\n- Schedule: weekly calendar, operative schedules, capacity indicators\n\n### Rent & Income (`/rent`)\n- Arrears dashboard: total, by band (chart), collection rate gauge, payment method breakdown\n- AI-prioritised worklist: each case with tenant details, arrears amount, 12-week sparkline, AI score (1-100), risk factors, recommended action, action buttons\n\n### Compliance (`/compliance`)\n- Dashboard: 6 Big 6 cards with %, counts, trends, RAG\n- Awaab's Law: active cases with timers, risk register (all properties with AI scores), proactive inspection programme\n- Each area page: certificate list, filters, no-access tracker, contractor performance\n\n### Complaints (`/complaints`)\n- Dashboard: Stage 1/2 counts, response % vs timescale, TSM CH01/CH02, categories pie, findings breakdown, learning tracker\n- New: tenant selection → free-text → AI categorises/assigns severity/checks history → handler assignment → auto-acknowledgement\n- Detail: two-stage timeline with countdowns\n\n### Allocations (`/allocations`)\n- Housing register: applicants by band (A-D), bedroom need, medical priority\n- Void kanban: Notice → Keys → Inspection → Works → Quality → Ready → Offer → Let. Cards with days void (RAG: green <14, amber 14-28, red >28), void rent loss\n\n### ASB (`/asb`)\n- Case list: ref, location, category, severity, status, handler, days open\n- Detail: escalation pipeline visual tracker, evidence log, multi-agency panel\n\n### Communications (`/communications`)\n- Unified inbox: all channels linked to tenant/property/case. AI triage: auto-categorise, priority, sentiment, suggested response.\n\n### AI Centre (`/ai`)\n- Insights feed: predictions, alerts, recommendations, analytics — with confidence %, affected entities, action buttons\n- Predictions: Arrears (scatter + top 50 + feature importance), Damp/Mould (heatmap + inspection list), Vulnerability (silent tenant detection)\n- Assistant: chat panel with natural language queries\n\n### Tenant Portal (`/tenant-portal`)\n- **Visually distinct**: lighter/warmer theme option, simpler layout, larger text, no jargon, large touch targets\n- Dashboard: welcome, quick actions (report repair, check balance, make payment, contact), active repairs, rent balance, appointments\n- Report repair: conversational wizard — room → problem category tiles → sub-category → photo → appointment → confirm. AI urgency detection.\n- Rent: clear balance, simple transactions, payment button\n\n---\n\n## PART 3: BASELINE REPORTING\n\n### Regulatory Returns\n- TSM Annual Return (22 measures with actuals, targets, sector medians, quartiles)\n- CORE Lettings/Sales Logs (field validation, CSV export)\n- Consumer Standards Self-Assessment (4 standards, evidence mapping)\n- Complaint Handling Code Self-Assessment (per-section compliance scoring)\n- Building Safety Act Returns (higher-risk buildings)\n- Statistical Data Return (SDR) for RSH\n\n### Operational Performance\n- Repairs: volume, SLA %, first-time fix, satisfaction, spend, top costliest properties\n- Voids: average relet days, rent loss, by stage, contractor performance\n- Arrears: collection rate, band movement, payment methods, UC performance, court pipeline\n- Complaints: volume, response %, findings, compensation, root causes, learning actions\n- ASB: cases opened/closed, resolution days, enforcement actions\n- Contact Centre: call volumes, wait times, channel usage, first contact resolution\n\n### Compliance Reports\n- Big 6 dashboard (daily/weekly per area)\n- Per-area: gas programme, electrical, fire, asbestos, legionella, lifts\n- Awaab's Law compliance (weekly)\n- Decent Homes (quarterly)\n- Stock Condition (quarterly/annual)\n- EPC / Energy (quarterly)\n\n### Financial Reports\n- Rent setting summary, service charge report, repairs expenditure, bad debt provision, void loss\n\n### Governance\n- Board performance pack (monthly/quarterly executive dashboard)\n- Risk register, regulatory compliance summary, H&S summary\n\n### Tenant-Facing\n- Annual report to tenants (TSM results, repairs, complaints, improvements)\n- Estate reports (quarterly per-estate)\n\n### Report Features\nEvery report supports: date range, property group, tenure type, comparison period, CSV/PDF export, drill-down from aggregates, benchmarking vs targets/previous/sector, AI-generated narrative summary, scheduled email distribution.\n\n---\n\n## SIMULATED DATA\n\n**Organisation**: Riverside Crescent Housing Association (RCHA), RP 4567, G1/V1, HQ Southwark. Stock across Southwark, Lewisham, Lambeth.\n\n**5 Estates:**\n1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n**50 properties, 45 active tenancies, 5 voids.** Realistic SE London postcodes, 12-digit UPRNs, diverse tenant names reflecting London demographics.\n\nRents: social £95-140/week, affordable £140-200/week. Service charges £5-35/week.\nPayment: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%.\nArrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k.\n\n**200 repairs** (5% emergency, 15% urgent, 70% routine, 10% planned). 95% emergency <24hrs, 88% urgent <5 days, 82% routine <28 days. FTF: 78%. Satisfaction: mean 3.8/5.\n\n**34 open complaints** (28 Stage 1, 6 Stage 2). Response within timescale: 91%.\n**12 ASB cases.** **8 damp/mould cases** (3 emergency, 5 significant). **25 financial cases.** **5 voids** at various stages.\n\nCompliance: Gas 99.4%, Electrical 97.8%, Fire 99.1%, Asbestos 98.5%, Legionella 99.0%, Lifts 100%.\n\n---\n\n## IMPLEMENTATION REQUIREMENTS\n\n1. **Every page fully functional** — no \"coming soon\" placeholders\n2. **Visual drill-down is the flagship** — smooth map-to-3D transitions, each level shows correct attributes\n3. **Data relationships consistent** — navigating hierarchy = same data as direct search\n4. **Countdown timers prominent** — Awaab's Law and complaints deadlines with colour-coded urgency\n5. **Dark mode default** — Yantra.Works brand palette throughout\n6. **Attributes at correct level** — building-level (FRA, building safety) vs unit-level (gas, EICR, EPC)\n7. **Tenant portal visually distinct** — simpler, warmer\n8. **UK conventions** — DD/MM/YYYY, British English, GBP, \"flat\" not \"apartment\"\n9. **Accessibility** — WCAG 2.2 AA contrast, keyboard navigation, aria-labels, visible focus states\n10. **Animations throughout** — staggered reveals, sliding panels, smooth transitions, pulsing alerts. The UI must feel alive.\n11. **Leave clear integration points** for Document 2's AI features: empty `<div id=\"ai-assist-panel\">` on every page, empty `<div id=\"ai-dynamic-actions\">` in every entity detail page, persona context in global state\n12. **Build as single self-contained file** using CDN imports\n\nNow build the complete SocialHomes.Ai base application.\n","numLines":482,"startLine":1,"totalLines":482}},"sourceToolAssistantUUID":"89762181-2b7d-4047-9123-746858aa32b3"}
{"parentUuid":"b32d01f0-2a34-4900-a0c9-909e3096fb0c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YLwVurPc7ZSC7rSikwBM4D","type":"tool_result","content":"     1→# DOCUMENT 2 OF 2: AI-NATIVE FEATURE REQUIREMENTS\n     2→# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n     3→\n     4→## INSTRUCTION TO AI\n     5→\n     6→This is the companion document to the Base Specification (Document 1). It defines what makes SocialHomes.Ai genuinely AI-NATIVE — not AI-bolted-on.\n     7→\n     8→**What \"AI-native\" means in SocialHomes.Ai:**\n     9→The AI doesn't just sit in a sidebar showing information. It dynamically reshapes the interface itself. Every page has standard fields, buttons, and layouts from Document 1 — but ALSO has **dynamic AI-generated buttons, fields, cards, and action prompts** that appear contextually based on the entity being viewed, the data about that entity, the user's persona, external factors, and predictive models. These dynamic elements don't exist in a static system — they are created by intelligence.\n    10→\n    11→Apply all features in this document to the base application built from Document 1.\n    12→\n    13→---\n    14→\n    15→## CORE PRINCIPLE: DYNAMIC AI INTERFACE ELEMENTS\n    16→\n    17→### How It Works\n    18→\n    19→Every entity page (tenant, property, building, case, etc.) has TWO zones:\n    20→\n    21→1. **Standard zone**: The fixed fields, tabs, buttons defined in Document 1 — always present, always in the same place\n    22→2. **AI Dynamic zone**: A clearly-marked section (subtle purple-tinted `--status-ai` left border, `--surface-elevated` background) that contains AI-generated elements that change based on context\n    23→\n    24→The AI Dynamic zone appears at the top of the right-side context panel (in drill-down view) or as a prominent card section at the top of entity detail pages (in traditional view). It contains:\n    25→\n    26→- **Dynamic action buttons** — actions that only appear when AI determines they're relevant\n    27→- **Dynamic info cards** — contextual information the system thinks the user needs NOW\n    28→- **Dynamic prompts** — questions the AI asks the user, where answering triggers automated workflows\n    29→- **Dynamic warnings** — alerts about this specific entity that require attention\n    30→\n    31→### Examples of Dynamic AI Elements by Entity Type\n    32→\n    33→**When viewing a TENANT who has been waiting 47 days for a repair:**\n    34→\n    35→```\n    36→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    37→│ ✦ Yantra has identified 3 actions for this tenant            │\n    38→│                                                               │\n    39→│ [📧 Send Holding Update]  [📞 Log Apology Call]              │\n    40→│  \"Mrs Chen has waited 47      \"AI has drafted a call         │\n    41→│   days for REP-2024-4521.      script acknowledging the      │\n    42→│   AI has drafted an update     delay with explanation and     │\n    43→│   email explaining the delay   compensation offer.\"           │\n    44→│   and new expected date.\"                                     │\n    45→│                                                               │\n    46→│ [⚠️ Escalate to Manager]                                     │\n    47→│  \"This repair has exceeded 2x the routine target.             │\n    48→│   Escalation recommended to prevent complaint.\"               │\n    49→│                                                               │\n    50→│ 🔮 PREDICTION: 72% probability this tenant will raise a      │\n    51→│    complaint within 14 days if repair not completed.          │\n    52→│    Estimated compensation liability: £150-£300.               │\n    53→└──────────────────────────────────────────────────────────────┘\n    54→```\n    55→\n    56→When the officer clicks **[Send Holding Update]**:\n    57→1. AI shows a pre-drafted email using the tenant's preferred communication method, referencing the specific repair, the delay reason (from contractor notes), and the new expected completion date (from schedule)\n    58→2. The officer can edit the draft or approve it\n    59→3. On sending, AI asks: **\"Would you like to create a follow-up task?\"** — Yes/No\n    60→4. If Yes: **\"When should the follow-up be?\"** — offers \"Day after expected completion\", \"3 working days\", \"1 week\", or custom date\n    61→5. AI auto-creates the task, assigns it to the officer, links it to the repair case, and sets a reminder\n    62→6. If the repair is STILL not done by the follow-up date, AI automatically escalates the priority and notifies the manager\n    63→\n    64→**When viewing a TENANT with arrears who just started a UC claim:**\n    65→\n    66→```\n    67→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    68→│ ✦ Context: UC claim started 3 weeks ago. First payment       │\n    69→│   expected in ~2 weeks. Current arrears: £487.                │\n    70→│                                                               │\n    71→│ [💬 Supportive Call Script]  [📋 Request APA]                 │\n    72→│  \"AI has drafted a call        \"Alternative Payment           │\n    73→│   script that acknowledges     Arrangement application        │\n    74→│   the UC transition, offers    pre-filled and ready to        │\n    75→│   reassurance, and checks      submit to DWP.\"                │\n    76→│   for income maximisation                                     │\n    77→│   opportunities.\"                                             │\n    78→│                                                               │\n    79→│ [🏦 Income Maximisation Check]  [📝 Create Payment Plan]     │\n    80→│  \"Run benefits entitlement      \"AI suggests: £15/week        │\n    81→│   estimate for this household   toward arrears based on       │\n    82→│   based on known composition    household income estimate     │\n    83→│   and tenure type.\"             and other commitments.\"       │\n    84→│                                                               │\n    85→│ ℹ️ DO NOT escalate to formal action — UC transition is a     │\n    86→│    recognised temporary cause. Pre-Action Protocol requires   │\n    87→│    verification of UC claim before any legal action.          │\n    88→└──────────────────────────────────────────────────────────────┘\n    89→```\n    90→\n    91→**When viewing a BUILDING with expiring compliance:**\n    92→\n    93→```\n    94→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n    95→│ ✦ 3 compliance items need attention for this building        │\n    96→│                                                               │\n    97→│ [🔧 Book Contractor Visit]                                    │\n    98→│  \"2 EICRs expired (Unit 12, Unit 18). AI has checked          │\n    99→│   contractor availability — next slot: Thursday 10am.         │\n   100→│   Pre-filled job ticket attached.\"                            │\n   101→│                                                               │\n   102→│ [📋 Generate FRA Action Report]                               │\n   103→│  \"Fire risk assessment is due for review in 45 days.          │\n   104→│   2 outstanding action items. AI has generated a status       │\n   105→│   report for the building safety lead.\"                       │\n   106→│                                                               │\n   107→│ [📧 Send Access Letters]                                      │\n   108→│  \"Unit 12 — Mrs Williams has refused access twice.            │\n   109→│   AI suggests: accompanied visit with support worker          │\n   110→│   (vulnerability flag: hoarding). Letter 3 template ready.\"  │\n   111→│                                                               │\n   112→│ 🔮 Based on contractor workload, if EICRs are not booked     │\n   113→│    this week, they won't be completed before TSM reporting    │\n   114→│    deadline. Impact: BS03 drops from 97.8% to 97.6%.         │\n   115→└──────────────────────────────────────────────────────────────┘\n   116→```\n   117→\n   118→**When viewing an ASB CASE where evidence is building:**\n   119→\n   120→```\n   121→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n   122→│ ✦ Case analysis for ASB-2024-00034                            │\n   123→│                                                               │\n   124→│ [📋 Generate Evidence Bundle]                                 │\n   125→│  \"AI has compiled: 14 diary entries, 3 witness statements,    │\n   126→│   noise recordings (4), photos (7). Formatted for court       │\n   127→│   if injunction is pursued.\"                                  │\n   128→│                                                               │\n   129→│ [🤝 Refer to Mediation]                                      │\n   130→│  \"Before legal escalation, mediation has 65% success rate     │\n   131→│   for noise cases in this category. Local mediation service   │\n   132→│   has availability next Tuesday.\"                             │\n   133→│                                                               │\n   134→│ [📞 Multi-Agency Referral]                                    │\n   135→│  \"Perpetrator profile suggests mental health involvement.     │\n   136→│   AI has pre-filled referral forms for Community Mental        │\n   137→│   Health Team and Safer Neighbourhood Team.\"                  │\n   138→│                                                               │\n   139→│ 🔮 PREDICTION: Based on case pattern, 60% probability this   │\n   140→│    will require CPN within 8 weeks. Evidence quality is       │\n   141→│    currently GOOD for legal threshold.                        │\n   142→└──────────────────────────────────────────────────────────────┘\n   143→```\n   144→\n   145→**When viewing a REPAIR CASE that has been completed:**\n   146→\n   147→Even on CLOSED cases, AI adds value:\n   148→\n   149→```\n   150→┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n   151→│ ✦ Post-completion analysis for REP-2024-03211                │\n   152→│                                                               │\n   153→│ [📊 Root Cause Analysis]                                      │\n   154→│  \"This is the 4th plumbing repair at this property in 12      │\n   155→│   months. Pattern: corroded supply pipe. Proactive            │\n   156→│   replacement cost: £800. Continued responsive cost:          │\n   157→│   projected £2,400/year.\"                                     │\n   158→│                                                               │\n   159→│ [📋 Create Capital Works Request]                             │\n   160→│  \"One click to create a planned works request for supply      │\n   161→│   pipe replacement, pre-filled with cost justification        │\n   162→│   from repair history analysis.\"                              │\n   163→│                                                               │\n   164→│ [📧 Send Satisfaction Follow-Up]                              │\n   165→│  \"Tenant rated this repair 2/5. AI has drafted a follow-up   │\n   166→│   message acknowledging the poor experience and explaining    │\n   167→│   what's being done to prevent recurrence.\"                   │\n   168→└──────────────────────────────────────────────────────────────┘\n   169→```\n   170→\n   171→### The AI Action Flow Pattern\n   172→\n   173→Every AI dynamic button follows this pattern:\n   174→\n   175→1. **PRESENT**: AI shows the button with a brief explanation of WHY it's suggesting this action\n   176→2. **PREVIEW**: Clicking the button shows a preview of what will happen — the drafted email, the pre-filled form, the suggested schedule\n   177→3. **EDIT**: The user can edit anything in the preview\n   178→4. **CONFIRM**: User approves the action\n   179→5. **FOLLOW-UP**: AI asks if the user wants to create follow-up tasks, linked cases, or notifications\n   180→6. **AUTO-CREATE**: If user says yes, AI asks only for genuinely missing information (not anything it already knows), then auto-creates everything — tasks, cases, calendar entries, reminders\n   181→7. **LEARN**: The system records whether the user accepted/modified/rejected the AI suggestion, feeding back into the model\n   182→\n   183→### Dynamic Fields\n   184→\n   185→In addition to dynamic buttons, AI also adds dynamic INFORMATION FIELDS that don't exist in the standard layout:\n   186→\n   187→- On a tenant page: \"Estimated household income: £24,000/year\" (derived from tenure type + bedroom size + UC status + employment indicators — used for affordability assessment)\n   188→- On a property page: \"Carbon emission estimate: 4.2 tonnes/year\" (derived from EPC + heating type + floor area — not stored, calculated live)\n   189→- On a repair page: \"Similar repair average cost: £385\" (from historical data — helps identify outlier costs)\n   190→- On a complaint page: \"Ombudsman determination risk: HIGH\" (based on category, delay, and comparison to published Ombudsman decisions)\n   191→- On a building page: \"Estimated retrofit cost to EPC C: £8,200/unit\" (derived from current EPC data + standard improvement measures)\n   192→\n   193→These appear as subtle cards with a `--status-ai` purple left border and a small \"✦ AI estimate\" label.\n   194→\n   195→---\n   196→\n   197→## YANTRA ASSIST — CONTEXTUAL AI PANEL\n   198→\n   199→### Appearance\n   200→- **Trigger**: Fixed button, bottom-left corner — Yantra.Works diamond mark at 32px with pulsing `--status-ai` purple glow when insights are available. Badge count for actionable items.\n   201→- **Panel**: Slides in from left (400px wide), overlaying sidebar. `--surface-elevated` background, `--status-ai` purple top border. Close button and pin button.\n   202→- **Content changes completely** based on (a) current page/entity and (b) user persona.\n   203→\n   204→### Panel Structure (every page)\n   205→\n   206→```\n   207→┌──────────────────────────────────────┐\n   208→│ ✦ Yantra Assist                      │\n   209→│ [Persona] • [Current page context]   │\n   210→├──────────────────────────────────────┤\n   211→│ 🔴 URGENT                            │\n   212→│ Items needing immediate action        │\n   213→│                                       │\n   214→│ 🟠 ATTENTION                          │\n   215→│ Items approaching deadlines           │\n   216→│                                       │\n   217→│ 💡 INSIGHTS                           │\n   218→│ AI predictions & recommendations      │\n   219→│                                       │\n   220→│ 📊 BRIEFING                           │\n   221→│ Contextual summary & key stats        │\n   222→│                                       │\n   223→│ 🌤️ EXTERNAL FACTORS                   │\n   224→│ Weather, UC changes, local context    │\n   225→├──────────────────────────────────────┤\n   226→│ [Ask Yantra...] chat input            │\n   227→└──────────────────────────────────────┘\n   228→```\n   229→\n   230→Each item is clickable — navigates to the relevant entity.\n   231→\n   232→### External Data Sources (simulated)\n   233→- Met Office weather: rain/temperature forecasts affecting damp risk and outdoor works\n   234→- DWP/UC: benefit changes, managed migration, impact on tenant income\n   235→- Regulator of Social Housing: inspection programme updates, sector benchmarks\n   236→- Housing Ombudsman: recent determinations, Code updates\n   237→- Energy prices: fuel poverty risk, tenant heating behaviour predictions\n   238→- Local authority: planning, roadworks, school terms (ASB patterns)\n   239→\n   240→### Chat Interface\n   241→At panel bottom — natural language queries:\n   242→- \"Which tenants haven't been contacted in 6 months?\"\n   243→- \"Total repair costs for 23 Maple Lane this year?\"\n   244→- \"Draft an arrears letter for Mrs Patel\"\n   245→- \"What if we don't complete the 12 overdue EICRs this month?\"\n   246→\n   247→---\n   248→\n   249→## PERSONA SYSTEM\n   250→\n   251→5 personas determine what Yantra Assist shows and which AI dynamic actions appear. User selects at login or switches via the user menu.\n   252→\n   253→### Persona 1: Chief Operating Officer / Director\n   254→- **Dashboard scope**: Entire organisation\n   255→- **Yantra Assist focus**: Strategic — regulatory risk, portfolio compliance trends, financial performance, TSM trajectory, Regulator inspection readiness\n   256→- **AI dynamic actions**: \"Generate board report\", \"Model rent increase scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n   257→- **Example insight**: \"AI predicts 15% increase in damp reports next month — weather + construction profile. Recommend: activate proactive inspection programme. Cost: £12K. Estimated saving in responsive repairs: £45K.\"\n   258→\n   259→### Persona 2: Head of Housing / Head of Service\n   260→- **Dashboard scope**: Their service area\n   261→- **Yantra Assist focus**: Operational — SLA performance, team capacity, complaint trends, void turnaround, allocations throughput\n   262→- **AI dynamic actions**: \"Rebalance team caseloads\", \"Generate team performance review\", \"Identify training needs from complaint patterns\"\n   263→- **Example insight**: \"8 'silent tenants' identified — no contact in 12+ months. Recommend: welfare check visits this week.\"\n   264→\n   265→### Persona 3: Team Manager / Patch Manager\n   266→- **Dashboard scope**: Their patch/team\n   267→- **Yantra Assist focus**: Team management — individual officer workload, case overdue list, skill gaps, cover arrangements\n   268→- **AI dynamic actions**: \"Reassign cases for officer on leave\", \"Generate patch briefing\", \"Schedule team catch-up based on workload gaps\"\n   269→- **Example insight**: \"Sarah has 47 open cases (average: 32). 3 cases are >30 days overdue. Rebalance recommended.\"\n   270→\n   271→### Persona 4: Housing Officer / Colleague (frontline) ← THE MOST IMPORTANT\n   272→- **Dashboard scope**: Their personal caseload/patch\n   273→- **Yantra Assist shows**: What to do TODAY — appointments, calls, tasks, cases needing action\n   274→- **AI dynamic actions**: The richest set — every tenant page has holding reply buttons, follow-up task creators, referral generators, communication drafters. Every property has booking buttons for contractor visits. Every case has escalation and resolution aids.\n   275→- **Morning briefing**: \"You have 3 urgent items, 12 tasks due, 2 tenancies predicted to enter arrears. Heavy rain Thursday — 4 properties at damp risk.\"\n   276→- **Example on a tenant page**: \"Mrs Chen called 3 times last week. Repair 47 days outstanding. AI suggests: [Send Holding Email] [Escalate Repair] [Log Compensation Offer]. Prediction: 72% complaint risk within 14 days.\"\n   277→\n   278→### Persona 5: Repairs Operative / Contractor\n   279→- **View**: Simplified mobile-optimised layout\n   280→- **Yantra Assist shows**: Today's jobs, access codes, risk alerts, vulnerability flags, previous repair history\n   281→- **AI dynamic actions**: \"Mark complete + take photo\", \"Order follow-on materials\", \"Flag as requiring follow-up inspection\"\n   282→- **No access to**: financial data, personal tenant details beyond what's needed for the job\n   283→\n   284→---\n   285→\n   286→## AI MORNING BRIEFING (`/briefing`)\n   287→\n   288→Full-screen, personalised briefing on login. Animated intro with Yantra mark, then:\n   289→\n   290→- Weather and environmental context for the day\n   291→- **URGENT**: Items needing immediate action (with countdown timers where applicable)\n   292→- **TODAY'S TASKS**: Appointments, calls, letters, case reviews — with count\n   293→- **AI PREDICTIONS**: What the model expects this week for the user's scope\n   294→- **PATCH/PORTFOLIO SNAPSHOT**: Key numbers with trend arrows\n   295→- **[Start my day →]** button → navigates to dashboard\n   296→- **[Skip briefing]** option (can be disabled in settings)\n   297→\n   298→Each item in the briefing is clickable, navigating directly to the relevant entity.\n   299→\n   300→---\n   301→\n   302→## AI-AUGMENTED WORKFLOWS\n   303→\n   304→### Logging a Repair (AI-augmented)\n   305→1. Tenant/operative describes issue (text or simulated voice input)\n   306→2. AI INSTANTLY: categorises (SOR code), assigns priority, identifies trade, checks asbestos register, checks vulnerability flags, checks for recurring pattern, estimates cost, suggests appointment, drafts access instructions, flags Awaab's Law if applicable\n   307→3. AI shows: \"Similar repair done 3 months ago at this property. Recurring issue? [Yes — create investigation case] [No — proceed as new]\"\n   308→4. On completion, AI asks: \"Create follow-up satisfaction call task in 48 hours? [Yes] [No]\"\n   309→\n   310→### Handling Inbound Contact (AI-augmented)\n   311→1. Officer receives email/call from tenant\n   312→2. AI reads/summarises the contact, categorises it:\n   313→   - Repair request → \"Create repair case? [Yes]\" (pre-filled from description)\n   314→   - Complaint → \"This sounds like a complaint. Create Stage 1 complaint? [Yes]\" (pre-categorised)\n   315→   - Arrears query → Shows rent account summary, suggests response\n   316→   - General enquiry → Suggests response from knowledge base\n   317→3. After handling, AI asks: \"Create follow-up task? What's the follow-up action?\"\n   318→4. If user says \"Call back in 3 days to check\", AI creates task, links it, sets reminder\n   319→\n   320→### Sending Any Communication (AI-augmented)\n   321→1. User triggers \"Send letter/email/SMS\" on any entity\n   322→2. AI generates draft using: correct template, tenant's name and details, plain English at appropriate reading level, legally required wording (for notices), correct dates and amounts\n   323→3. Tone options: [Supportive] [Formal] [Urgent] [Legally required] — AI adjusts language\n   324→4. After sending: \"Create follow-up task? [Yes — when?]\" and \"Link to an existing case? [Select case / Create new]\"\n   325→\n   326→### Reviewing Compliance (AI-augmented)\n   327→1. Officer views compliance page\n   328→2. AI doesn't just show expired certs — it shows:\n   329→   - What WILL expire (with timeline)\n   330→   - Impact on TSM scores if not resolved\n   331→   - Pre-drafted contractor instruction for each overdue item\n   332→   - Pre-booked appointment slot (from contractor availability)\n   333→   - No-access risk prediction per property (based on history)\n   334→3. One click: \"Send all appointment letters for gas safety programme this month\" → AI generates personalised letters for each property, queues via Notify\n   335→\n   336→---\n   337→\n   338→## PREDICTIVE INTELLIGENCE ENGINE\n   339→\n   340→8 prediction models, each with real-time scoring:\n   341→\n   342→| Model | Predicts | Inputs | Output | Action |\n   343→|-------|---------|--------|--------|--------|\n   344→| Arrears Risk | Tenancy enters arrears in 30/60/90 days | Payment history, UC status, seasonal patterns, life events | Risk score 0-100 per tenancy | Prioritised worklist + recommended intervention |\n   345→| Damp & Mould | Property develops damp/mould | Construction, orientation, EPC, weather, heating, historical repairs, sensors | Risk score 0-100 per property | Proactive inspection programme |\n   346→| Complaint Escalation | Complaint reaches Stage 2 or Ombudsman | Response time, category, tenant history, handler workload | Escalation probability % | Manager alert + resource reallocation |\n   347→| Void Duration | How long a void will take | Property age, condition survey, previous voids, works backlog | Estimated days | Realistic timeline + contractor pre-booking |\n   348→| Repair Recurrence | Repair will recur; root cause | Repair history, component age, weather, contractor quality | Recurrence probability + cause | Capital investment recommendation |\n   349→| Vulnerability | Tenant may be vulnerable but unidentified | Contact frequency, repair patterns, payment changes, household | Risk flags + evidence | Welfare check recommendation |\n   350→| ASB Escalation | Case requires legal action | Category, perpetrator history, evidence quality, location | Legal action probability | Evidence gathering checklist |\n   351→| Compliance Failure | Property fails compliance before cert expiry | Access history, tenant engagement, contractor availability | Failure probability | Pre-emptive access campaign |\n   352→\n   353→Each model shows on the AI Predictions page (`/ai/predictions`) with: scatter plot of scored entities, top-50 table, feature importance chart, model accuracy metrics (precision/recall/F1 as gauges), last trained date.\n   354→\n   355→---\n   356→\n   357→## 3D DIGITAL TWIN\n   358→\n   359→When drilling into a BUILDING in the visual hierarchy (Level 4), the 2D map transitions to a Three.js 3D building:\n   360→\n   361→- **Exterior**: Procedurally generated from metadata (storeys, footprint, construction type). Colour-coded facade by compliance. Rotate/zoom/pan with OrbitControls.\n   362→- **Exploded view**: Click to separate floors vertically\n   363→- **Floor plan**: Click a floor → units shown as coloured boxes:\n   364→  - Green: occupied, compliant, no issues\n   365→  - Blue: repair in progress\n   366→  - Amber: compliance approaching deadline\n   367→  - Red: overdue, active Awaab's Law, void >28 days\n   368→  - Purple: AI-flagged\n   369→  - Grey: void\n   370→- **Hover unit**: mini-card (tenant name, rent status, compliance, AI score)\n   371→- **Click unit**: navigates to full unit detail\n   372→\n   373→Built with Three.js r128, `<Canvas>` from React Three Fiber, `OrbitControls` and `Text` from drei. Geometry: `BoxGeometry` for building and units, `LineBasicMaterial` for floor separators. Not photorealistic — informative, interactive, visually striking.\n   374→\n   375→---\n   376→\n   377→## ADMINISTRATOR SYSTEM (`/admin`)\n   378→\n   379→### Admin Dashboard (`/admin`)\n   380→- System health: API response times, error rates, active users, storage usage (live charts)\n   381→- User activity: who's logged in, what they're viewing, last actions\n   382→- Data quality score: overall completeness % with drill-down by entity type\n   383→- Integration status: live connection indicators per external system\n   384→- AI model health: accuracy metrics, last training, drift alerts\n   385→\n   386→### Organisation Management (`/admin/organisation`)\n   387→- Profile: name, RP number, address, regulatory status, charity/company numbers\n   388→- Branding: logo, colours, email footer, letter header template\n   389→- Operational parameters (all editable, audit-trailed):\n   390→  - Repair targets per priority, void target, arrears bands, complaint targets, rent increase policy\n   391→  - Working day calendar (bank holidays, closedowns)\n   392→  - Financial year, rent week pattern\n   393→- Multi-organisation: parent/subsidiary group structures\n   394→\n   395→### User Management (`/admin/users`)\n   396→- RBAC with 10 default roles × permissions matrix (view/create/edit/delete/approve per module)\n   397→- Custom role builder\n   398→- User invitation flow, 2FA management, session control\n   399→- User impersonation (\"view as\") — fully audited\n   400→- Patch assignment, team assignment, caseload caps\n   401→\n   402→### Team & Patch Management (`/admin/teams`)\n   403→- Team hierarchies (Director → HoS → Manager → Officers)\n   404→- Patch definition: draw on map or assign by postcode/estate/ward\n   405→- Caseload balancing tool: visual workload distribution with rebalancing recommendations\n   406→- Cover/absence management: auto-reassign cases during leave\n   407→\n   408→### Workflow Engine (`/admin/workflows`)\n   409→- Visual builder (simulated drag-and-drop):\n   410→  - Triggers: system events (repair created, arrears threshold crossed, complaint Day 8, cert expires in 30 days)\n   411→  - Conditions: IF-THEN rules with entity attributes\n   412→  - Actions: send notification, create task, assign, escalate, send letter (Notify), create case, trigger AI analysis\n   413→  - SLA timers, approval gates\n   414→- Pre-built templates: arrears escalation, complaint handling, Awaab's Law, gas access programme, void pipeline, ASB escalation, new tenancy onboarding\n   415→\n   416→### Integration Hub (`/admin/integrations`)\n   417→Cards with logo, status, last sync, configuration:\n   418→- GOV.UK Notify (email/SMS/letters), OS Places API, EPC Open Data, DWP Landlord Portal, Open Banking, GOV.UK Pay, Companies House, HM Land Registry, Met Office, Contractor portals, CORE (MHCLG), HouseMark\n   419→- Webhook manager, API key management, data import/export wizard\n   420→\n   421→### Audit & Compliance (`/admin/audit`)\n   422→- Full audit trail: timestamp, user, entity, field, old value, new value, IP\n   423→- GDPR tools: Subject Access Request processor, Right to Erasure workflow, data retention policies, consent management, Data Processing Register\n   424→- Security log: failed logins, password changes, permission changes, admin actions\n   425→\n   426→### System Configuration (`/admin/system`)\n   427→- Reference data: editable lookup tables for all codelists (repair categories, SOR codes, complaint categories, vulnerability types, property types, tenure types, payment methods, etc.)\n   428→- Form builder (simulated): customise fields on key forms — drag, set required/optional, add validation\n   429→- Notification config: which events trigger email/SMS/push per role\n   430→- Reporting config: KPI targets, RAG thresholds, benchmarking peer group\n   431→- AI config: toggle models on/off, confidence thresholds, data source selection, prediction frequency\n   432→- White-label: for multi-HA deployment — each HA gets own branding overlaid on Yantra design\n   433→\n   434→---\n   435→\n   436→## KEY INTERACTIONS TO IMPLEMENT\n   437→\n   438→These are the signature moments that demonstrate the AI-native paradigm:\n   439→\n   440→### 1. The \"Holding Reply\" Flow\n   441→User views tenant with overdue repair → AI dynamic button \"Send Holding Update\" → pre-drafted email shown → user edits/approves → sent via Notify → AI asks \"Create follow-up task?\" → user says \"3 days\" → task auto-created linked to repair → if repair still not done at follow-up, auto-escalate\n   442→\n   443→### 2. The \"Inbound Email Triage\" Flow\n   444→Email arrives in unified inbox → AI reads it → categorises as repair request → shows \"Create repair? [Yes]\" with pre-filled SOR code and priority → officer confirms → repair case created, appointment suggested, confirmation sent to tenant → AI asks \"Anything else from this email?\" → officer says \"They also mentioned a leak in the hallway\" → AI creates second repair case linked to same contact\n   445→\n   446→### 3. The \"Proactive Damp Prevention\" Flow\n   447→Weather API shows heavy rain forecast → AI cross-references with building data (1960s concrete, north-facing, known penetrating damp history) → generates alert: \"4 properties at high damp risk this week\" → officer views → each property has dynamic button \"Send preventive advice letter\" → pre-drafted letter about ventilation, heating, reporting → sent to all 4 tenants in one click → follow-up inspection tasks auto-created for 2 weeks later\n   448→\n   449→### 4. The \"Compliance Cascade\" Flow\n   450→Admin views compliance dashboard → AI highlights: \"12 EICRs overdue, contractor available Thursday\" → [Book All] button → AI generates 12 job tickets, sends tenant appointment letters, creates calendar entries for contractor, sets follow-up reminders → if any tenant has no-access history, automatically generates escalated access letter instead of standard appointment\n   451→\n   452→### 5. The \"Complaint Prevention\" Flow\n   453→AI detects: tenant called 3 times about same repair, satisfaction declining, case open 42 days → generates Yantra Assist urgent item: \"Complaint likely within 14 days. Recommend: resolve repair this week + proactive apology call + goodwill gesture £50\" → officer clicks \"Execute prevention plan\" → AI: creates urgent repair escalation, drafts apology call script, prepares compensation authorisation for manager → tracks whether complaint was prevented (feeds back to model)\n   454→\n   455→---\n   456→\n   457→## IMPLEMENTATION NOTES FOR DOCUMENT 2\n   458→\n   459→1. **AI dynamic sections should be clearly visually distinct** — purple-tinted border, `--surface-elevated` background, \"✦\" symbol prefix on AI-generated content\n   460→2. **Every AI action button must explain WHY** — not just \"Send Email\" but \"Send holding update — tenant has waited 47 days, 72% complaint risk\"\n   461→3. **The follow-up prompt pattern is essential** — after EVERY action, ask about follow-ups and auto-create if confirmed\n   462→4. **AI elements must appear on EVERY entity page** — tenants, properties, buildings, cases, even closed cases\n   463→5. **Persona switching must immediately change** what's shown in Yantra Assist and what dynamic buttons appear\n   464→6. **Predictions should feel USEFUL, not creepy** — always explain WHY the AI is making a prediction with contributing factors visible\n   465→7. **The admin system must be COMPLETE** — not a settings page, but a full system management suite\n   466→8. **Closed cases still get AI analysis** — recurrence prediction, root cause analysis, trend identification\n   467→9. **External data (weather, DWP, regulator) should feel natural** — woven into insights, not shown as a separate section\n   468→10. **The morning briefing should feel personalised and warm** — not a data dump, but \"Good morning Sarah, here's what needs your attention today\"\n   469→\n   470→Now apply all of these AI-native features, dynamic interface elements, the persona system, admin system, and prediction models to the base application from Document 1. Every page should have both its standard layout AND the AI dynamic zone with contextually relevant buttons, fields, and prompts.\n   471→"}]},"uuid":"dba6d78c-a46f-440a-b960-ae5b80935032","timestamp":"2026-02-23T18:40:53.593Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/Doc2-SocialHomesAi-AI-Native-Features.txt","content":"# DOCUMENT 2 OF 2: AI-NATIVE FEATURE REQUIREMENTS\n# SocialHomes.Ai — AI-Native Housing Operating System by Yantra.Works\n\n## INSTRUCTION TO AI\n\nThis is the companion document to the Base Specification (Document 1). It defines what makes SocialHomes.Ai genuinely AI-NATIVE — not AI-bolted-on.\n\n**What \"AI-native\" means in SocialHomes.Ai:**\nThe AI doesn't just sit in a sidebar showing information. It dynamically reshapes the interface itself. Every page has standard fields, buttons, and layouts from Document 1 — but ALSO has **dynamic AI-generated buttons, fields, cards, and action prompts** that appear contextually based on the entity being viewed, the data about that entity, the user's persona, external factors, and predictive models. These dynamic elements don't exist in a static system — they are created by intelligence.\n\nApply all features in this document to the base application built from Document 1.\n\n---\n\n## CORE PRINCIPLE: DYNAMIC AI INTERFACE ELEMENTS\n\n### How It Works\n\nEvery entity page (tenant, property, building, case, etc.) has TWO zones:\n\n1. **Standard zone**: The fixed fields, tabs, buttons defined in Document 1 — always present, always in the same place\n2. **AI Dynamic zone**: A clearly-marked section (subtle purple-tinted `--status-ai` left border, `--surface-elevated` background) that contains AI-generated elements that change based on context\n\nThe AI Dynamic zone appears at the top of the right-side context panel (in drill-down view) or as a prominent card section at the top of entity detail pages (in traditional view). It contains:\n\n- **Dynamic action buttons** — actions that only appear when AI determines they're relevant\n- **Dynamic info cards** — contextual information the system thinks the user needs NOW\n- **Dynamic prompts** — questions the AI asks the user, where answering triggers automated workflows\n- **Dynamic warnings** — alerts about this specific entity that require attention\n\n### Examples of Dynamic AI Elements by Entity Type\n\n**When viewing a TENANT who has been waiting 47 days for a repair:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Yantra has identified 3 actions for this tenant            │\n│                                                               │\n│ [📧 Send Holding Update]  [📞 Log Apology Call]              │\n│  \"Mrs Chen has waited 47      \"AI has drafted a call         │\n│   days for REP-2024-4521.      script acknowledging the      │\n│   AI has drafted an update     delay with explanation and     │\n│   email explaining the delay   compensation offer.\"           │\n│   and new expected date.\"                                     │\n│                                                               │\n│ [⚠️ Escalate to Manager]                                     │\n│  \"This repair has exceeded 2x the routine target.             │\n│   Escalation recommended to prevent complaint.\"               │\n│                                                               │\n│ 🔮 PREDICTION: 72% probability this tenant will raise a      │\n│    complaint within 14 days if repair not completed.          │\n│    Estimated compensation liability: £150-£300.               │\n└──────────────────────────────────────────────────────────────┘\n```\n\nWhen the officer clicks **[Send Holding Update]**:\n1. AI shows a pre-drafted email using the tenant's preferred communication method, referencing the specific repair, the delay reason (from contractor notes), and the new expected completion date (from schedule)\n2. The officer can edit the draft or approve it\n3. On sending, AI asks: **\"Would you like to create a follow-up task?\"** — Yes/No\n4. If Yes: **\"When should the follow-up be?\"** — offers \"Day after expected completion\", \"3 working days\", \"1 week\", or custom date\n5. AI auto-creates the task, assigns it to the officer, links it to the repair case, and sets a reminder\n6. If the repair is STILL not done by the follow-up date, AI automatically escalates the priority and notifies the manager\n\n**When viewing a TENANT with arrears who just started a UC claim:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Context: UC claim started 3 weeks ago. First payment       │\n│   expected in ~2 weeks. Current arrears: £487.                │\n│                                                               │\n│ [💬 Supportive Call Script]  [📋 Request APA]                 │\n│  \"AI has drafted a call        \"Alternative Payment           │\n│   script that acknowledges     Arrangement application        │\n│   the UC transition, offers    pre-filled and ready to        │\n│   reassurance, and checks      submit to DWP.\"                │\n│   for income maximisation                                     │\n│   opportunities.\"                                             │\n│                                                               │\n│ [🏦 Income Maximisation Check]  [📝 Create Payment Plan]     │\n│  \"Run benefits entitlement      \"AI suggests: £15/week        │\n│   estimate for this household   toward arrears based on       │\n│   based on known composition    household income estimate     │\n│   and tenure type.\"             and other commitments.\"       │\n│                                                               │\n│ ℹ️ DO NOT escalate to formal action — UC transition is a     │\n│    recognised temporary cause. Pre-Action Protocol requires   │\n│    verification of UC claim before any legal action.          │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing a BUILDING with expiring compliance:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ 3 compliance items need attention for this building        │\n│                                                               │\n│ [🔧 Book Contractor Visit]                                    │\n│  \"2 EICRs expired (Unit 12, Unit 18). AI has checked          │\n│   contractor availability — next slot: Thursday 10am.         │\n│   Pre-filled job ticket attached.\"                            │\n│                                                               │\n│ [📋 Generate FRA Action Report]                               │\n│  \"Fire risk assessment is due for review in 45 days.          │\n│   2 outstanding action items. AI has generated a status       │\n│   report for the building safety lead.\"                       │\n│                                                               │\n│ [📧 Send Access Letters]                                      │\n│  \"Unit 12 — Mrs Williams has refused access twice.            │\n│   AI suggests: accompanied visit with support worker          │\n│   (vulnerability flag: hoarding). Letter 3 template ready.\"  │\n│                                                               │\n│ 🔮 Based on contractor workload, if EICRs are not booked     │\n│    this week, they won't be completed before TSM reporting    │\n│    deadline. Impact: BS03 drops from 97.8% to 97.6%.         │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing an ASB CASE where evidence is building:**\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Case analysis for ASB-2024-00034                            │\n│                                                               │\n│ [📋 Generate Evidence Bundle]                                 │\n│  \"AI has compiled: 14 diary entries, 3 witness statements,    │\n│   noise recordings (4), photos (7). Formatted for court       │\n│   if injunction is pursued.\"                                  │\n│                                                               │\n│ [🤝 Refer to Mediation]                                      │\n│  \"Before legal escalation, mediation has 65% success rate     │\n│   for noise cases in this category. Local mediation service   │\n│   has availability next Tuesday.\"                             │\n│                                                               │\n│ [📞 Multi-Agency Referral]                                    │\n│  \"Perpetrator profile suggests mental health involvement.     │\n│   AI has pre-filled referral forms for Community Mental        │\n│   Health Team and Safer Neighbourhood Team.\"                  │\n│                                                               │\n│ 🔮 PREDICTION: Based on case pattern, 60% probability this   │\n│    will require CPN within 8 weeks. Evidence quality is       │\n│    currently GOOD for legal threshold.                        │\n└──────────────────────────────────────────────────────────────┘\n```\n\n**When viewing a REPAIR CASE that has been completed:**\n\nEven on CLOSED cases, AI adds value:\n\n```\n┌─ AI ACTIONS ─────────────────────────────────────────────────┐\n│ ✦ Post-completion analysis for REP-2024-03211                │\n│                                                               │\n│ [📊 Root Cause Analysis]                                      │\n│  \"This is the 4th plumbing repair at this property in 12      │\n│   months. Pattern: corroded supply pipe. Proactive            │\n│   replacement cost: £800. Continued responsive cost:          │\n│   projected £2,400/year.\"                                     │\n│                                                               │\n│ [📋 Create Capital Works Request]                             │\n│  \"One click to create a planned works request for supply      │\n│   pipe replacement, pre-filled with cost justification        │\n│   from repair history analysis.\"                              │\n│                                                               │\n│ [📧 Send Satisfaction Follow-Up]                              │\n│  \"Tenant rated this repair 2/5. AI has drafted a follow-up   │\n│   message acknowledging the poor experience and explaining    │\n│   what's being done to prevent recurrence.\"                   │\n└──────────────────────────────────────────────────────────────┘\n```\n\n### The AI Action Flow Pattern\n\nEvery AI dynamic button follows this pattern:\n\n1. **PRESENT**: AI shows the button with a brief explanation of WHY it's suggesting this action\n2. **PREVIEW**: Clicking the button shows a preview of what will happen — the drafted email, the pre-filled form, the suggested schedule\n3. **EDIT**: The user can edit anything in the preview\n4. **CONFIRM**: User approves the action\n5. **FOLLOW-UP**: AI asks if the user wants to create follow-up tasks, linked cases, or notifications\n6. **AUTO-CREATE**: If user says yes, AI asks only for genuinely missing information (not anything it already knows), then auto-creates everything — tasks, cases, calendar entries, reminders\n7. **LEARN**: The system records whether the user accepted/modified/rejected the AI suggestion, feeding back into the model\n\n### Dynamic Fields\n\nIn addition to dynamic buttons, AI also adds dynamic INFORMATION FIELDS that don't exist in the standard layout:\n\n- On a tenant page: \"Estimated household income: £24,000/year\" (derived from tenure type + bedroom size + UC status + employment indicators — used for affordability assessment)\n- On a property page: \"Carbon emission estimate: 4.2 tonnes/year\" (derived from EPC + heating type + floor area — not stored, calculated live)\n- On a repair page: \"Similar repair average cost: £385\" (from historical data — helps identify outlier costs)\n- On a complaint page: \"Ombudsman determination risk: HIGH\" (based on category, delay, and comparison to published Ombudsman decisions)\n- On a building page: \"Estimated retrofit cost to EPC C: £8,200/unit\" (derived from current EPC data + standard improvement measures)\n\nThese appear as subtle cards with a `--status-ai` purple left border and a small \"✦ AI estimate\" label.\n\n---\n\n## YANTRA ASSIST — CONTEXTUAL AI PANEL\n\n### Appearance\n- **Trigger**: Fixed button, bottom-left corner — Yantra.Works diamond mark at 32px with pulsing `--status-ai` purple glow when insights are available. Badge count for actionable items.\n- **Panel**: Slides in from left (400px wide), overlaying sidebar. `--surface-elevated` background, `--status-ai` purple top border. Close button and pin button.\n- **Content changes completely** based on (a) current page/entity and (b) user persona.\n\n### Panel Structure (every page)\n\n```\n┌──────────────────────────────────────┐\n│ ✦ Yantra Assist                      │\n│ [Persona] • [Current page context]   │\n├──────────────────────────────────────┤\n│ 🔴 URGENT                            │\n│ Items needing immediate action        │\n│                                       │\n│ 🟠 ATTENTION                          │\n│ Items approaching deadlines           │\n│                                       │\n│ 💡 INSIGHTS                           │\n│ AI predictions & recommendations      │\n│                                       │\n│ 📊 BRIEFING                           │\n│ Contextual summary & key stats        │\n│                                       │\n│ 🌤️ EXTERNAL FACTORS                   │\n│ Weather, UC changes, local context    │\n├──────────────────────────────────────┤\n│ [Ask Yantra...] chat input            │\n└──────────────────────────────────────┘\n```\n\nEach item is clickable — navigates to the relevant entity.\n\n### External Data Sources (simulated)\n- Met Office weather: rain/temperature forecasts affecting damp risk and outdoor works\n- DWP/UC: benefit changes, managed migration, impact on tenant income\n- Regulator of Social Housing: inspection programme updates, sector benchmarks\n- Housing Ombudsman: recent determinations, Code updates\n- Energy prices: fuel poverty risk, tenant heating behaviour predictions\n- Local authority: planning, roadworks, school terms (ASB patterns)\n\n### Chat Interface\nAt panel bottom — natural language queries:\n- \"Which tenants haven't been contacted in 6 months?\"\n- \"Total repair costs for 23 Maple Lane this year?\"\n- \"Draft an arrears letter for Mrs Patel\"\n- \"What if we don't complete the 12 overdue EICRs this month?\"\n\n---\n\n## PERSONA SYSTEM\n\n5 personas determine what Yantra Assist shows and which AI dynamic actions appear. User selects at login or switches via the user menu.\n\n### Persona 1: Chief Operating Officer / Director\n- **Dashboard scope**: Entire organisation\n- **Yantra Assist focus**: Strategic — regulatory risk, portfolio compliance trends, financial performance, TSM trajectory, Regulator inspection readiness\n- **AI dynamic actions**: \"Generate board report\", \"Model rent increase scenarios\", \"Benchmark against sector\", \"Prepare regulatory self-assessment\"\n- **Example insight**: \"AI predicts 15% increase in damp reports next month — weather + construction profile. Recommend: activate proactive inspection programme. Cost: £12K. Estimated saving in responsive repairs: £45K.\"\n\n### Persona 2: Head of Housing / Head of Service\n- **Dashboard scope**: Their service area\n- **Yantra Assist focus**: Operational — SLA performance, team capacity, complaint trends, void turnaround, allocations throughput\n- **AI dynamic actions**: \"Rebalance team caseloads\", \"Generate team performance review\", \"Identify training needs from complaint patterns\"\n- **Example insight**: \"8 'silent tenants' identified — no contact in 12+ months. Recommend: welfare check visits this week.\"\n\n### Persona 3: Team Manager / Patch Manager\n- **Dashboard scope**: Their patch/team\n- **Yantra Assist focus**: Team management — individual officer workload, case overdue list, skill gaps, cover arrangements\n- **AI dynamic actions**: \"Reassign cases for officer on leave\", \"Generate patch briefing\", \"Schedule team catch-up based on workload gaps\"\n- **Example insight**: \"Sarah has 47 open cases (average: 32). 3 cases are >30 days overdue. Rebalance recommended.\"\n\n### Persona 4: Housing Officer / Colleague (frontline) ← THE MOST IMPORTANT\n- **Dashboard scope**: Their personal caseload/patch\n- **Yantra Assist shows**: What to do TODAY — appointments, calls, tasks, cases needing action\n- **AI dynamic actions**: The richest set — every tenant page has holding reply buttons, follow-up task creators, referral generators, communication drafters. Every property has booking buttons for contractor visits. Every case has escalation and resolution aids.\n- **Morning briefing**: \"You have 3 urgent items, 12 tasks due, 2 tenancies predicted to enter arrears. Heavy rain Thursday — 4 properties at damp risk.\"\n- **Example on a tenant page**: \"Mrs Chen called 3 times last week. Repair 47 days outstanding. AI suggests: [Send Holding Email] [Escalate Repair] [Log Compensation Offer]. Prediction: 72% complaint risk within 14 days.\"\n\n### Persona 5: Repairs Operative / Contractor\n- **View**: Simplified mobile-optimised layout\n- **Yantra Assist shows**: Today's jobs, access codes, risk alerts, vulnerability flags, previous repair history\n- **AI dynamic actions**: \"Mark complete + take photo\", \"Order follow-on materials\", \"Flag as requiring follow-up inspection\"\n- **No access to**: financial data, personal tenant details beyond what's needed for the job\n\n---\n\n## AI MORNING BRIEFING (`/briefing`)\n\nFull-screen, personalised briefing on login. Animated intro with Yantra mark, then:\n\n- Weather and environmental context for the day\n- **URGENT**: Items needing immediate action (with countdown timers where applicable)\n- **TODAY'S TASKS**: Appointments, calls, letters, case reviews — with count\n- **AI PREDICTIONS**: What the model expects this week for the user's scope\n- **PATCH/PORTFOLIO SNAPSHOT**: Key numbers with trend arrows\n- **[Start my day →]** button → navigates to dashboard\n- **[Skip briefing]** option (can be disabled in settings)\n\nEach item in the briefing is clickable, navigating directly to the relevant entity.\n\n---\n\n## AI-AUGMENTED WORKFLOWS\n\n### Logging a Repair (AI-augmented)\n1. Tenant/operative describes issue (text or simulated voice input)\n2. AI INSTANTLY: categorises (SOR code), assigns priority, identifies trade, checks asbestos register, checks vulnerability flags, checks for recurring pattern, estimates cost, suggests appointment, drafts access instructions, flags Awaab's Law if applicable\n3. AI shows: \"Similar repair done 3 months ago at this property. Recurring issue? [Yes — create investigation case] [No — proceed as new]\"\n4. On completion, AI asks: \"Create follow-up satisfaction call task in 48 hours? [Yes] [No]\"\n\n### Handling Inbound Contact (AI-augmented)\n1. Officer receives email/call from tenant\n2. AI reads/summarises the contact, categorises it:\n   - Repair request → \"Create repair case? [Yes]\" (pre-filled from description)\n   - Complaint → \"This sounds like a complaint. Create Stage 1 complaint? [Yes]\" (pre-categorised)\n   - Arrears query → Shows rent account summary, suggests response\n   - General enquiry → Suggests response from knowledge base\n3. After handling, AI asks: \"Create follow-up task? What's the follow-up action?\"\n4. If user says \"Call back in 3 days to check\", AI creates task, links it, sets reminder\n\n### Sending Any Communication (AI-augmented)\n1. User triggers \"Send letter/email/SMS\" on any entity\n2. AI generates draft using: correct template, tenant's name and details, plain English at appropriate reading level, legally required wording (for notices), correct dates and amounts\n3. Tone options: [Supportive] [Formal] [Urgent] [Legally required] — AI adjusts language\n4. After sending: \"Create follow-up task? [Yes — when?]\" and \"Link to an existing case? [Select case / Create new]\"\n\n### Reviewing Compliance (AI-augmented)\n1. Officer views compliance page\n2. AI doesn't just show expired certs — it shows:\n   - What WILL expire (with timeline)\n   - Impact on TSM scores if not resolved\n   - Pre-drafted contractor instruction for each overdue item\n   - Pre-booked appointment slot (from contractor availability)\n   - No-access risk prediction per property (based on history)\n3. One click: \"Send all appointment letters for gas safety programme this month\" → AI generates personalised letters for each property, queues via Notify\n\n---\n\n## PREDICTIVE INTELLIGENCE ENGINE\n\n8 prediction models, each with real-time scoring:\n\n| Model | Predicts | Inputs | Output | Action |\n|-------|---------|--------|--------|--------|\n| Arrears Risk | Tenancy enters arrears in 30/60/90 days | Payment history, UC status, seasonal patterns, life events | Risk score 0-100 per tenancy | Prioritised worklist + recommended intervention |\n| Damp & Mould | Property develops damp/mould | Construction, orientation, EPC, weather, heating, historical repairs, sensors | Risk score 0-100 per property | Proactive inspection programme |\n| Complaint Escalation | Complaint reaches Stage 2 or Ombudsman | Response time, category, tenant history, handler workload | Escalation probability % | Manager alert + resource reallocation |\n| Void Duration | How long a void will take | Property age, condition survey, previous voids, works backlog | Estimated days | Realistic timeline + contractor pre-booking |\n| Repair Recurrence | Repair will recur; root cause | Repair history, component age, weather, contractor quality | Recurrence probability + cause | Capital investment recommendation |\n| Vulnerability | Tenant may be vulnerable but unidentified | Contact frequency, repair patterns, payment changes, household | Risk flags + evidence | Welfare check recommendation |\n| ASB Escalation | Case requires legal action | Category, perpetrator history, evidence quality, location | Legal action probability | Evidence gathering checklist |\n| Compliance Failure | Property fails compliance before cert expiry | Access history, tenant engagement, contractor availability | Failure probability | Pre-emptive access campaign |\n\nEach model shows on the AI Predictions page (`/ai/predictions`) with: scatter plot of scored entities, top-50 table, feature importance chart, model accuracy metrics (precision/recall/F1 as gauges), last trained date.\n\n---\n\n## 3D DIGITAL TWIN\n\nWhen drilling into a BUILDING in the visual hierarchy (Level 4), the 2D map transitions to a Three.js 3D building:\n\n- **Exterior**: Procedurally generated from metadata (storeys, footprint, construction type). Colour-coded facade by compliance. Rotate/zoom/pan with OrbitControls.\n- **Exploded view**: Click to separate floors vertically\n- **Floor plan**: Click a floor → units shown as coloured boxes:\n  - Green: occupied, compliant, no issues\n  - Blue: repair in progress\n  - Amber: compliance approaching deadline\n  - Red: overdue, active Awaab's Law, void >28 days\n  - Purple: AI-flagged\n  - Grey: void\n- **Hover unit**: mini-card (tenant name, rent status, compliance, AI score)\n- **Click unit**: navigates to full unit detail\n\nBuilt with Three.js r128, `<Canvas>` from React Three Fiber, `OrbitControls` and `Text` from drei. Geometry: `BoxGeometry` for building and units, `LineBasicMaterial` for floor separators. Not photorealistic — informative, interactive, visually striking.\n\n---\n\n## ADMINISTRATOR SYSTEM (`/admin`)\n\n### Admin Dashboard (`/admin`)\n- System health: API response times, error rates, active users, storage usage (live charts)\n- User activity: who's logged in, what they're viewing, last actions\n- Data quality score: overall completeness % with drill-down by entity type\n- Integration status: live connection indicators per external system\n- AI model health: accuracy metrics, last training, drift alerts\n\n### Organisation Management (`/admin/organisation`)\n- Profile: name, RP number, address, regulatory status, charity/company numbers\n- Branding: logo, colours, email footer, letter header template\n- Operational parameters (all editable, audit-trailed):\n  - Repair targets per priority, void target, arrears bands, complaint targets, rent increase policy\n  - Working day calendar (bank holidays, closedowns)\n  - Financial year, rent week pattern\n- Multi-organisation: parent/subsidiary group structures\n\n### User Management (`/admin/users`)\n- RBAC with 10 default roles × permissions matrix (view/create/edit/delete/approve per module)\n- Custom role builder\n- User invitation flow, 2FA management, session control\n- User impersonation (\"view as\") — fully audited\n- Patch assignment, team assignment, caseload caps\n\n### Team & Patch Management (`/admin/teams`)\n- Team hierarchies (Director → HoS → Manager → Officers)\n- Patch definition: draw on map or assign by postcode/estate/ward\n- Caseload balancing tool: visual workload distribution with rebalancing recommendations\n- Cover/absence management: auto-reassign cases during leave\n\n### Workflow Engine (`/admin/workflows`)\n- Visual builder (simulated drag-and-drop):\n  - Triggers: system events (repair created, arrears threshold crossed, complaint Day 8, cert expires in 30 days)\n  - Conditions: IF-THEN rules with entity attributes\n  - Actions: send notification, create task, assign, escalate, send letter (Notify), create case, trigger AI analysis\n  - SLA timers, approval gates\n- Pre-built templates: arrears escalation, complaint handling, Awaab's Law, gas access programme, void pipeline, ASB escalation, new tenancy onboarding\n\n### Integration Hub (`/admin/integrations`)\nCards with logo, status, last sync, configuration:\n- GOV.UK Notify (email/SMS/letters), OS Places API, EPC Open Data, DWP Landlord Portal, Open Banking, GOV.UK Pay, Companies House, HM Land Registry, Met Office, Contractor portals, CORE (MHCLG), HouseMark\n- Webhook manager, API key management, data import/export wizard\n\n### Audit & Compliance (`/admin/audit`)\n- Full audit trail: timestamp, user, entity, field, old value, new value, IP\n- GDPR tools: Subject Access Request processor, Right to Erasure workflow, data retention policies, consent management, Data Processing Register\n- Security log: failed logins, password changes, permission changes, admin actions\n\n### System Configuration (`/admin/system`)\n- Reference data: editable lookup tables for all codelists (repair categories, SOR codes, complaint categories, vulnerability types, property types, tenure types, payment methods, etc.)\n- Form builder (simulated): customise fields on key forms — drag, set required/optional, add validation\n- Notification config: which events trigger email/SMS/push per role\n- Reporting config: KPI targets, RAG thresholds, benchmarking peer group\n- AI config: toggle models on/off, confidence thresholds, data source selection, prediction frequency\n- White-label: for multi-HA deployment — each HA gets own branding overlaid on Yantra design\n\n---\n\n## KEY INTERACTIONS TO IMPLEMENT\n\nThese are the signature moments that demonstrate the AI-native paradigm:\n\n### 1. The \"Holding Reply\" Flow\nUser views tenant with overdue repair → AI dynamic button \"Send Holding Update\" → pre-drafted email shown → user edits/approves → sent via Notify → AI asks \"Create follow-up task?\" → user says \"3 days\" → task auto-created linked to repair → if repair still not done at follow-up, auto-escalate\n\n### 2. The \"Inbound Email Triage\" Flow\nEmail arrives in unified inbox → AI reads it → categorises as repair request → shows \"Create repair? [Yes]\" with pre-filled SOR code and priority → officer confirms → repair case created, appointment suggested, confirmation sent to tenant → AI asks \"Anything else from this email?\" → officer says \"They also mentioned a leak in the hallway\" → AI creates second repair case linked to same contact\n\n### 3. The \"Proactive Damp Prevention\" Flow\nWeather API shows heavy rain forecast → AI cross-references with building data (1960s concrete, north-facing, known penetrating damp history) → generates alert: \"4 properties at high damp risk this week\" → officer views → each property has dynamic button \"Send preventive advice letter\" → pre-drafted letter about ventilation, heating, reporting → sent to all 4 tenants in one click → follow-up inspection tasks auto-created for 2 weeks later\n\n### 4. The \"Compliance Cascade\" Flow\nAdmin views compliance dashboard → AI highlights: \"12 EICRs overdue, contractor available Thursday\" → [Book All] button → AI generates 12 job tickets, sends tenant appointment letters, creates calendar entries for contractor, sets follow-up reminders → if any tenant has no-access history, automatically generates escalated access letter instead of standard appointment\n\n### 5. The \"Complaint Prevention\" Flow\nAI detects: tenant called 3 times about same repair, satisfaction declining, case open 42 days → generates Yantra Assist urgent item: \"Complaint likely within 14 days. Recommend: resolve repair this week + proactive apology call + goodwill gesture £50\" → officer clicks \"Execute prevention plan\" → AI: creates urgent repair escalation, drafts apology call script, prepares compensation authorisation for manager → tracks whether complaint was prevented (feeds back to model)\n\n---\n\n## IMPLEMENTATION NOTES FOR DOCUMENT 2\n\n1. **AI dynamic sections should be clearly visually distinct** — purple-tinted border, `--surface-elevated` background, \"✦\" symbol prefix on AI-generated content\n2. **Every AI action button must explain WHY** — not just \"Send Email\" but \"Send holding update — tenant has waited 47 days, 72% complaint risk\"\n3. **The follow-up prompt pattern is essential** — after EVERY action, ask about follow-ups and auto-create if confirmed\n4. **AI elements must appear on EVERY entity page** — tenants, properties, buildings, cases, even closed cases\n5. **Persona switching must immediately change** what's shown in Yantra Assist and what dynamic buttons appear\n6. **Predictions should feel USEFUL, not creepy** — always explain WHY the AI is making a prediction with contributing factors visible\n7. **The admin system must be COMPLETE** — not a settings page, but a full system management suite\n8. **Closed cases still get AI analysis** — recurrence prediction, root cause analysis, trend identification\n9. **External data (weather, DWP, regulator) should feel natural** — woven into insights, not shown as a separate section\n10. **The morning briefing should feel personalised and warm** — not a data dump, but \"Good morning Sarah, here's what needs your attention today\"\n\nNow apply all of these AI-native features, dynamic interface elements, the persona system, admin system, and prediction models to the base application from Document 1. Every page should have both its standard layout AND the AI dynamic zone with contextually relevant buttons, fields, and prompts.\n","numLines":471,"startLine":1,"totalLines":471}},"sourceToolAssistantUUID":"b32d01f0-2a34-4900-a0c9-909e3096fb0c"}
{"parentUuid":"dba6d78c-a46f-440a-b960-ae5b80935032","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01PUWkq9gaPoQkvL2GbaybnG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015sYxsjU2824rcauSLfGAfm","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":73986,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVPoGsfpTfEJzU3qW6B","type":"assistant","uuid":"b2d1a40a-3192-4c6f-8dc0-be2583f21da4","timestamp":"2026-02-23T18:40:53.901Z"}
{"parentUuid":"b2d1a40a-3192-4c6f-8dc0-be2583f21da4","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015sYxsjU2824rcauSLfGAfm","type":"tool_result","content":"     1→# SocialHomes.Ai — Dev Fix List\n     2→## Updated: 2026-02-21\n     3→\n     4→**Test Summary:** 331 tests | 330 PASS | 0 FAIL | 1 WARN | 99.7% pass rate\n     5→\n     6→---\n     7→\n     8→## CRITICAL BUGS — ALL RESOLVED\n     9→\n    10→### ~~BUG-001: Complaint Detail Page Crashes (React Error)~~ FIXED\n    11→- **Status:** RESOLVED — CM-10 passes, detail page loads correctly\n    12→- **Verified:** Screenshot shows full complaint detail with timeline, AI actions, action buttons\n    13→\n    14→### ~~BUG-002: Tenant Detail Crashes from Rent Worklist~~ FIXED\n    15→- **Status:** RESOLVED — All tenant detail tests pass including from rent navigation\n    16→\n    17→### ~~BUG-003: ASB Case Detail Not Navigating~~ FIXED\n    18→- **Status:** RESOLVED — ASB-10 passes, navigates to `/asb/asb-001`\n    19→\n    20→### ~~BUG-004: Dashboard Missing \"Void\" KPI~~ FIXED\n    21→- **Status:** RESOLVED — DASH-KPI-Void passes, 'Void' found in dashboard text\n    22→\n    23→---\n    24→\n    25→## WARNINGS — ALL RESOLVED\n    26→\n    27→### ~~WARN-001: Explore Map - Marker Popups Not Working~~ FIXED\n    28→- **Status:** RESOLVED — Popups now show on hover (mouseover/mouseout), click still drills down\n    29→- **Fix:** Changed popup trigger from click to mouseover; added dark-mode popup CSS overrides\n    30→- **Files:** `ExplorePage.tsx` (marker events), `index.css` (popup styles)\n    31→- **Note:** EX-05 test still uses click (WARN) — popup works correctly via hover in production\n    32→\n    33→### ~~WARN-002: Tenancies Search Not Filtering~~ FIXED\n    34→- **Status:** RESOLVED — Search now matches name, address, tenant ID, AND assigned officer\n    35→- **Fix:** Added `assignedOfficer` field to search filter; \"Mitchell\" now correctly filters results\n    36→- **Files:** `TenanciesPage.tsx` (search filter logic + placeholder text)\n    37→\n    38→### ~~WARN-003: API Cases Endpoint - Large Response~~ FIXED\n    39→- **Status:** RESOLVED — Added proper pagination with offset, page, pageSize, totalPages\n    40→- **Fix:** Default limit reduced from 200 to 50; added `offset` query parameter; response includes pagination metadata\n    41→- **Files:** `server/src/routes/cases.ts`\n    42→\n    43→---\n    44→\n    45→## UI IMPROVEMENTS\n    46→\n    47→### Help/Guide Drawer — Full-Screen Layout\n    48→- **Status:** COMPLETE — Guides now open full-screen for easier reading\n    49→- **Fix:** Changed drawer from half-width (`md:w-1/2`) to `fixed inset-0`; added `max-w-4xl mx-auto` content wrapper; TOC and Related Guides moved into scroll area; all topics collapsed by default\n    50→- **Files:** `HelpDrawer.tsx`\n    51→\n    52→---\n    53→\n    54→## WHAT'S WORKING WELL (330/331 tests passing)\n    55→\n    56→- Login/Authentication: Flawless (Firebase email + Google sign-in)\n    57→- All 14 sidebar navigation links: Present and clickable (29/29 tests)\n    58→- Header: Logo, persona, search, notifications all present (4/4)\n    59→- Dashboard: All KPIs (Properties, Tenancies, Repairs, Compliance, Arrears, Void), charts, activity, compliance overview (12/12)\n    60→- Briefing: Personalized greeting, AI alerts, action buttons, all sections (8/8)\n    61→- Tenancies: 68 rows, all headers, row click → detail works, all tabs, AI features (16/16)\n    62→- Properties: 75 rows, map, detail page with EPC/rent/type/beds/AI, tabs (14/14)\n    63→- Repairs: 200 rows, all stats, detail with full workflow, action buttons, filters (113/113)\n    64→- Complaints: 34 complaints, detail page with timeline, AI actions, deadlines, ombudsman (12/12)\n    65→- ASB: 12 cases, detail page with workflow elements (6/6)\n    66→- Rent & Income: Financial data, charts, worklist, UC tracking, tenant link navigation, sub-routes (11/11)\n    67→- Compliance: All Big 6 types, percentages, detail pages, Awaab's Law (15/15)\n    68→- Communications: 5 messages, AI analysis, actions (Reply/Forward/Archive), templates (13/13)\n    69→- Reports: All 27 reports load with data, TSM report works (30/30)\n    70→- AI Centre: Insights, Predictions, Assistant — all sub-routes work (7/7)\n    71→- Admin: All 7 sub-pages load with content (8/8)\n    72→- Tenant Portal: Self-service landing with action buttons, form inputs (4/4)\n    73→- Yantra Assist: AI chat trigger visible, panel opens with input (2/2)\n    74→- Mobile responsive: Dashboard renders on mobile viewport\n    75→- Breadcrumbs: Present and functional\n    76→- **Firestore Database:** All data served from live Firestore (15 collections, 460+ documents)\n    77→- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n    78→\n    79→---\n    80→\n    81→## USER-REPORTED ISSUES — ALL RESOLVED\n    82→\n    83→### ~~BUG-005: Property Detail Page Crashes (React Error #310)~~ FIXED\n    84→- **Status:** RESOLVED — `/properties/100023456001` renders fully with map, details, EPC, all tabs\n    85→- **Root Cause:** React Rules of Hooks violation — `usePropertyIntelligence()` hook was called AFTER a conditional `if (!property) return` early exit, causing React to see different hook counts on re-renders\n    86→- **Fix:** Moved `usePropertyIntelligence(property)` call before the early return guard\n    87→- **Files:** `app/src/pages/properties/PropertyDetailPage.tsx`\n    88→\n    89→### ~~BUG-006: Repair Detail Page Crashes (React Error #310)~~ FIXED\n    90→- **Status:** RESOLVED — `/repairs/rep-001` renders fully with AI estimates, timeline, case details, activity feed\n    91→- **Root Cause:** Same Rules of Hooks violation — `useRepairIntelligence()` and `useState()` called after conditional early return\n    92→- **Fix:** Moved `useRepairIntelligence(repair)` and `useState` calls before the `if (!repair) return` guard\n    93→- **Files:** `app/src/pages/repairs/RepairDetailPage.tsx`\n    94→\n    95→---\n    96→\n    97→## ALL AUTOMATED TESTS PASSING — 99.7%\n    98→"}]},"uuid":"626da851-22ab-4b2e-b71b-de7729cfba19","timestamp":"2026-02-23T18:40:53.921Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/DEV-FIX-LIST.md","content":"# SocialHomes.Ai — Dev Fix List\n## Updated: 2026-02-21\n\n**Test Summary:** 331 tests | 330 PASS | 0 FAIL | 1 WARN | 99.7% pass rate\n\n---\n\n## CRITICAL BUGS — ALL RESOLVED\n\n### ~~BUG-001: Complaint Detail Page Crashes (React Error)~~ FIXED\n- **Status:** RESOLVED — CM-10 passes, detail page loads correctly\n- **Verified:** Screenshot shows full complaint detail with timeline, AI actions, action buttons\n\n### ~~BUG-002: Tenant Detail Crashes from Rent Worklist~~ FIXED\n- **Status:** RESOLVED — All tenant detail tests pass including from rent navigation\n\n### ~~BUG-003: ASB Case Detail Not Navigating~~ FIXED\n- **Status:** RESOLVED — ASB-10 passes, navigates to `/asb/asb-001`\n\n### ~~BUG-004: Dashboard Missing \"Void\" KPI~~ FIXED\n- **Status:** RESOLVED — DASH-KPI-Void passes, 'Void' found in dashboard text\n\n---\n\n## WARNINGS — ALL RESOLVED\n\n### ~~WARN-001: Explore Map - Marker Popups Not Working~~ FIXED\n- **Status:** RESOLVED — Popups now show on hover (mouseover/mouseout), click still drills down\n- **Fix:** Changed popup trigger from click to mouseover; added dark-mode popup CSS overrides\n- **Files:** `ExplorePage.tsx` (marker events), `index.css` (popup styles)\n- **Note:** EX-05 test still uses click (WARN) — popup works correctly via hover in production\n\n### ~~WARN-002: Tenancies Search Not Filtering~~ FIXED\n- **Status:** RESOLVED — Search now matches name, address, tenant ID, AND assigned officer\n- **Fix:** Added `assignedOfficer` field to search filter; \"Mitchell\" now correctly filters results\n- **Files:** `TenanciesPage.tsx` (search filter logic + placeholder text)\n\n### ~~WARN-003: API Cases Endpoint - Large Response~~ FIXED\n- **Status:** RESOLVED — Added proper pagination with offset, page, pageSize, totalPages\n- **Fix:** Default limit reduced from 200 to 50; added `offset` query parameter; response includes pagination metadata\n- **Files:** `server/src/routes/cases.ts`\n\n---\n\n## UI IMPROVEMENTS\n\n### Help/Guide Drawer — Full-Screen Layout\n- **Status:** COMPLETE — Guides now open full-screen for easier reading\n- **Fix:** Changed drawer from half-width (`md:w-1/2`) to `fixed inset-0`; added `max-w-4xl mx-auto` content wrapper; TOC and Related Guides moved into scroll area; all topics collapsed by default\n- **Files:** `HelpDrawer.tsx`\n\n---\n\n## WHAT'S WORKING WELL (330/331 tests passing)\n\n- Login/Authentication: Flawless (Firebase email + Google sign-in)\n- All 14 sidebar navigation links: Present and clickable (29/29 tests)\n- Header: Logo, persona, search, notifications all present (4/4)\n- Dashboard: All KPIs (Properties, Tenancies, Repairs, Compliance, Arrears, Void), charts, activity, compliance overview (12/12)\n- Briefing: Personalized greeting, AI alerts, action buttons, all sections (8/8)\n- Tenancies: 68 rows, all headers, row click → detail works, all tabs, AI features (16/16)\n- Properties: 75 rows, map, detail page with EPC/rent/type/beds/AI, tabs (14/14)\n- Repairs: 200 rows, all stats, detail with full workflow, action buttons, filters (113/113)\n- Complaints: 34 complaints, detail page with timeline, AI actions, deadlines, ombudsman (12/12)\n- ASB: 12 cases, detail page with workflow elements (6/6)\n- Rent & Income: Financial data, charts, worklist, UC tracking, tenant link navigation, sub-routes (11/11)\n- Compliance: All Big 6 types, percentages, detail pages, Awaab's Law (15/15)\n- Communications: 5 messages, AI analysis, actions (Reply/Forward/Archive), templates (13/13)\n- Reports: All 27 reports load with data, TSM report works (30/30)\n- AI Centre: Insights, Predictions, Assistant — all sub-routes work (7/7)\n- Admin: All 7 sub-pages load with content (8/8)\n- Tenant Portal: Self-service landing with action buttons, form inputs (4/4)\n- Yantra Assist: AI chat trigger visible, panel opens with input (2/2)\n- Mobile responsive: Dashboard renders on mobile viewport\n- Breadcrumbs: Present and functional\n- **Firestore Database:** All data served from live Firestore (15 collections, 460+ documents)\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n## USER-REPORTED ISSUES — ALL RESOLVED\n\n### ~~BUG-005: Property Detail Page Crashes (React Error #310)~~ FIXED\n- **Status:** RESOLVED — `/properties/100023456001` renders fully with map, details, EPC, all tabs\n- **Root Cause:** React Rules of Hooks violation — `usePropertyIntelligence()` hook was called AFTER a conditional `if (!property) return` early exit, causing React to see different hook counts on re-renders\n- **Fix:** Moved `usePropertyIntelligence(property)` call before the early return guard\n- **Files:** `app/src/pages/properties/PropertyDetailPage.tsx`\n\n### ~~BUG-006: Repair Detail Page Crashes (React Error #310)~~ FIXED\n- **Status:** RESOLVED — `/repairs/rep-001` renders fully with AI estimates, timeline, case details, activity feed\n- **Root Cause:** Same Rules of Hooks violation — `useRepairIntelligence()` and `useState()` called after conditional early return\n- **Fix:** Moved `useRepairIntelligence(repair)` and `useState` calls before the `if (!repair) return` guard\n- **Files:** `app/src/pages/repairs/RepairDetailPage.tsx`\n\n---\n\n## ALL AUTOMATED TESTS PASSING — 99.7%\n","numLines":98,"startLine":1,"totalLines":98}},"sourceToolAssistantUUID":"b2d1a40a-3192-4c6f-8dc0-be2583f21da4"}
{"parentUuid":"626da851-22ab-4b2e-b71b-de7729cfba19","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01FbAxwK8UFcNeVc7u6Mo3h9","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a complete picture. The existing `docs/requirements/` docs are comprehensive and were created on 2026-02-18. The EXECUTION-PLAN.md already has Phase 5 with 32 tasks. Let me now create significantly updated and enhanced versions of all three docs, incorporating the full detail from the original root-level specs (Doc1, Doc2) and the current project state. I'll also enhance the EXECUTION-PLAN.md.\n\nLet me write all four files now:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":20699,"cache_read_input_tokens":74414,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20699},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVQGG6MqUY21GsjJHG2","type":"assistant","uuid":"ba28f183-3893-4920-8077-24b29d58d45c","timestamp":"2026-02-23T18:41:00.666Z"}
{"parentUuid":"ba28f183-3893-4920-8077-24b29d58d45c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01FbAxwK8UFcNeVc7u6Mo3h9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PTQdscU3uqRFbr7hCFYJ6V","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":20699,"cache_read_input_tokens":74414,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":20699},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVQGG6MqUY21GsjJHG2","type":"assistant","uuid":"ca459315-4c1e-449e-a5a6-7c9c475dd3d1","timestamp":"2026-02-23T18:41:05.477Z"}
{"parentUuid":"ca459315-4c1e-449e-a5a6-7c9c475dd3d1","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PTQdscU3uqRFbr7hCFYJ6V","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"bdac5178-9b25-49e7-805e-4a37d732092a","timestamp":"2026-02-23T18:41:05.479Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"ca459315-4c1e-449e-a5a6-7c9c475dd3d1"}
{"parentUuid":"bdac5178-9b25-49e7-805e-4a37d732092a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_011Z5om3t25ST4KHkxjMZpWF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TzQ4qZNJxYDcdGJaXHmVig","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (16 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n\n    Layout:\n    ┌────────────────────────────────┬─────────────────────────────────┐\n    │                                │  CONTEXT PANEL (scrollable)     │\n    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │\n    │                                │  - Attribute cards               │\n    │      Interactive Leaflet map   │  - Compliance status             │\n    │      OR Three.js 3D building   │  - KPI metrics                   │\n    │      depending on zoom level   │  - AI insights (purple section)  │\n    │                                │  - Children list (next level)    │\n    │                                │  - Quick actions                  │\n    ├────────────────────────────────┴─────────────────────────────────┤\n    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n    │ Data layer toggles: Crime / Damp Risk / Compliance               │\n    └──────────────────────────────────────────────────────────────────┘\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice → Keys → Inspection → Works → Quality\n      → Ready → Offer → Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day →] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles × permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room → problem → photo →\n      appointment → confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"✦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - 🔴 URGENT: Items needing immediate action\n    - 🟠 ATTENTION: Items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: Contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue → AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task\n    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference\n       → preventive advice letters → inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar\n    5. \"Complaint Prevention\" — pattern detection → prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP £\n\n6.6 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green → peach → garnet → pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n    - Screen-reader-only text\n    - Focus-visible outlines\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social £95-140/week, affordable £140-200/week\n    Service charges: £5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | 23,852          |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/32)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-23\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":539,"cache_read_input_tokens":95113,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":539},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVR8y5QufXnkABE94Sx","type":"assistant","uuid":"3a574609-d544-41d3-90cf-b9832738d956","timestamp":"2026-02-23T18:44:34.119Z"}
{"parentUuid":"3a574609-d544-41d3-90cf-b9832738d956","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TzQ4qZNJxYDcdGJaXHmVig","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt has been updated successfully."}]},"uuid":"1f755497-88e1-4012-98c3-fee5c82167d5","timestamp":"2026-02-23T18:44:34.210Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (16 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n\n    Layout:\n    ┌────────────────────────────────┬─────────────────────────────────┐\n    │                                │  CONTEXT PANEL (scrollable)     │\n    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │\n    │                                │  - Attribute cards               │\n    │      Interactive Leaflet map   │  - Compliance status             │\n    │      OR Three.js 3D building   │  - KPI metrics                   │\n    │      depending on zoom level   │  - AI insights (purple section)  │\n    │                                │  - Children list (next level)    │\n    │                                │  - Quick actions                  │\n    ├────────────────────────────────┴─────────────────────────────────┤\n    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n    │ Data layer toggles: Crime / Damp Risk / Compliance               │\n    └──────────────────────────────────────────────────────────────────┘\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice → Keys → Inspection → Works → Quality\n      → Ready → Offer → Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day →] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles × permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room → problem → photo →\n      appointment → confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"✦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - 🔴 URGENT: Items needing immediate action\n    - 🟠 ATTENTION: Items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: Contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue → AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task\n    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference\n       → preventive advice letters → inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar\n    5. \"Complaint Prevention\" — pattern detection → prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP £\n\n6.6 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green → peach → garnet → pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n    - Screen-reader-only text\n    - Focus-visible outlines\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social £95-140/week, affordable £140-200/week\n    Service charges: £5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | 23,852          |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/32)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-23\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc1 — SocialHomes.Ai Base Specification","-  Version: 2.0  |  Date: 2026-02-18","+  Version: 3.0  |  Date: 2026-02-23","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":12,"oldLines":6,"newStart":12,"newLines":7,"lines":[" "," 1.2 Tagline","     AI-native social housing management for UK housing associations.","+    Secondary: \"AI-native. Human-assured.\""," "," 1.3 Vision","     To be the first truly AI-native housing management system that embeds"]},{"oldStart":19,"oldLines":6,"newStart":20,"newLines":12,"lines":["     screen, workflow, and decision — transforming reactive housing operations","     into proactive, data-driven housing management."," ","+    This is NOT a legacy system with a fresh coat of paint. This must look and","+    feel like nothing the social housing sector has ever seen — think Bloomberg","+    Terminal meets Figma, not a government form. The sector is dominated by ugly,","+    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai","+    is the opposite: dark, fast, visually stunning, animated, intelligent.","+"," 1.4 Target Market","     UK Social Housing Providers:","     - Housing Associations (Registered Providers)"]},{"oldStart":28,"oldLines":111,"newStart":35,"newLines":169,"lines":[" "," 1.5 Simulated Organisation","     Name:           Riverside Crescent Housing Association (RCHA)","+    RP Number:      4567","+    Regulatory:     G1/V1","+    HQ:             Southwark","     Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands","     Stock:          75 properties, 68 tenants, 279+ cases","-    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)","+    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)","     UPRNs:          Realistic 12-digit references","     EPCs:           Mapped to real certificates where available"," ","+    5 Estates:","+    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues","+    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building","+    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces","+    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme","+    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s","+"," 1.6 Built By","     Yantra Works — an AI-native development studio."," "," ","-2. CORE FUNCTIONAL MODULES","+2. CORE FUNCTIONAL MODULES (16 modules)"," ================================================================================"," "," 2.1 Dashboard","     Route: /dashboard","     Purpose: Real-time operational overview with persona-scoped KPIs","     Features:","-    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)","+    - 8 KPI cards (properties, tenancies, active repairs, rent collected,","+      arrears, compliance %, open complaints, AI alerts)","     - KPI trend sparklines (12 months)","-    - Activity feed with live updates","+    - Charts row: rent collection 12-month trend vs 97% target;","+      repairs monthly volume by priority with avg days line","+    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases","+      with countdown timers | AI insights scrolling feed","+    - Activity timeline with real-time system event feed","     - Persona-scoped views (COO sees org-wide; Officer sees their patch)","     - Quick action buttons for common tasks"," ","-2.2 Visual Drill-Down Explorer","+2.2 Visual Drill-Down Explorer (Flagship Feature)","     Route: /explore","     Purpose: 7-level spatial hierarchy navigation","     Hierarchy:","       Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant","+","+    Layout:","+    ┌────────────────────────────────┬─────────────────────────────────┐","+    │                                │  CONTEXT PANEL (scrollable)     │","+    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │","+    │                                │  - Attribute cards               │","+    │      Interactive Leaflet map   │  - Compliance status             │","+    │      OR Three.js 3D building   │  - KPI metrics                   │","+    │      depending on zoom level   │  - AI insights (purple section)  │","+    │                                │  - Children list (next level)    │","+    │                                │  - Quick actions                  │","+    ├────────────────────────────────┴─────────────────────────────────┤","+    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │","+    │ Data layer toggles: Crime / Damp Risk / Compliance               │","+    └──────────────────────────────────────────────────────────────────┘","+","     Features:","-    - Interactive Leaflet map with property markers","-    - Three.js 3D building visualization (digital twin)","+    - Interactive Leaflet map with property markers (OpenStreetMap tiles)","+    - Three.js 3D building visualization (digital twin) at block level","     - Context panel with attributes, KPIs, compliance, AI insights","-    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)","+    - Color-coded units: green (compliant), amber (warning), red (critical),","+      purple (AI flag), grey (void)","     - Data layer toggles: Crime, Damp Risk, Compliance","     - Click-through navigation from any level"," ","+    Level Details:","+    L0 Country:     England centred, 3 regions, portfolio summary","+    L1 Region:      Zoomed to region, LA areas as markers","+    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts","+    L3 Estate:      Zoom 16-17, individual buildings as footprints","+    L4 Block:       Transition to 3D view (Three.js), building-level attributes","+                    (FRA, Building Safety Case, communal systems, asbestos plan,","+                    legionella, structural surveys)","+    L4a Core:       For multi-core buildings, schematic floor plan","+    L5 Unit:        Highlighted unit in building model, tabbed detail","+                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,","+                    Works History, Documents)","+    L6 Tenant:      Full tenant record with tabbed view","+    L7 Case:        Case detail with timeline","+"," 2.3 Tenancies Management","     Route: /tenancies, /tenancies/:id","     Purpose: Tenancy lifecycle management","     Features:","-    - Tenancy list with search, filter, sort","+    - Tenancy list with search (name, address, ID, officer), filter, sort","+    - 68 tenants with dynamic count subtitle","     - Tenancy detail: household composition, rent account, case timeline","     - Vulnerability detection (AI 7-factor scoring)","     - Benefits entitlement check","     - Arrears status with color-coded balance","     - 52-week transaction ledger with balance trend chart","     - Action workflows: arrears action, schedule visit, create case","+    - AI Dynamic Zone: holding reply buttons, follow-up task creators,","+      referral generators, communication drafters"," "," 2.4 Properties Management","-    Route: /properties, /properties/:id","+    Route: /properties, /properties/:id, /properties/:id/apply,","+           /properties/:id/book-viewing","     Purpose: Property and asset data management","     Features:","-    - Property list with mini Leaflet map","+    - Property list with mini Leaflet map in list view","+    - 75 properties with pagination","     - Property detail: building attributes, compliance certificates, case history","     - Property Passport (multi-source AI aggregation)","     - Damp Intelligence Panel (5-factor predictive score)","     - Compliance timeline (Big 6 certificates)","     - Viewing bookings and allocation workflow","     - Digital twin (3D block visualization)","+    - Application page for void properties"," "," 2.5 Repairs Management","     Route: /repairs, /repairs/:id","     Purpose: Responsive and planned repairs case management","     Features:","-    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)","+    - 200+ repair cases with list/kanban toggle","+    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete","     - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)","     - Appointment booking with time slots","     - Operative notes, before/after photos","-    - Contractor verification badges (Gas Safe, NICEIC)","+    - Contractor verification badges (Gas Safe green, NICEIC blue)","     - Satisfaction survey (post-completion)","     - Recurrence prediction (AI)","     - Cost tracking and authorisation workflow","+    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,","+      priority, trade, Awaab's Law flags"," "," 2.6 Compliance Management","-    Route: /compliance, /compliance/:type","+    Route: /compliance, /compliance/:type, /compliance/awaabs-law","     Purpose: Regulatory compliance tracking and Awaab's Law","     Features:","     - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts","     - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER","-    - Awaab's Law dedicated page (/compliance/awaabs-law):","+    - Awaab's Law dedicated page:","       - Emergency hazard response: 24-hour countdown timer","       - Significant hazard repair: 10–12 week countdown timer","       - Risk register with property-level assessments","       - Proactive inspection programme tracking","-    - Building-level compliance: Fire Risk Assessment, Building Safety Case","+    - Building-level compliance: FRA, Building Safety Case","     - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors","     - Compliance failure prediction (AI)","+    - No-access tracker, contractor performance"," "," 2.7 Complaints Management","     Route: /complaints, /complaints/:id","-    Purpose: Two-stage complaints handling (Housing Ombudsman code)","+    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)","     Features:","-    - Complaint list with status filtering","-    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)","+    - 34 complaints with status filtering","+    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)","     - Deadline countdown timers with color-coded urgency","     - Ombudsman escalation pathway","     - Complaint escalation prediction (AI)","     - Linked cases and evidence log","-    - TSM reporting integration","+    - TSM CH01/CH02 reporting integration","+    - Categories pie chart, findings breakdown, learning tracker"," "," 2.8 Anti-Social Behaviour (ASB)","     Route: /asb, /asb/:id","     Purpose: ASB case management with escalation pipeline","     Features:","-    - ASB case list with severity indicators","+    - 12 ASB cases with severity indicators","     - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession","     - Evidence log with timestamps and categories","     - Live Crime Context (Police.uk data correlation)"]},{"oldStart":140,"oldLines":6,"newStart":205,"newLines":7,"lines":["     - ASB escalation prediction (AI)","     - Witness/victim support tracking","     - Community Trigger threshold monitoring","+    - Multi-agency panel and referral forms"," "," 2.9 Rent & Arrears","     Route: /rent"]},{"oldStart":147,"oldLines":21,"newStart":213,"newLines":24,"lines":["     Features:","     - Arrears dashboard with band analysis","     - Pre-Action Protocol (PAP) checklist","-    - Arrears worklist with priority scoring","+    - Arrears worklist with AI-prioritised scoring (1-100)","     - Universal Credit tracking and verification","     - Payment arrangement management","     - Direct debit integration (GoCardless mock)","     - HB/UC transition tracking","     - Arrears risk prediction (AI)","     - 12-month payment trend analysis","+    - Collection rate gauge, payment method breakdown"," "," 2.10 Allocations & Lettings","     Route: /allocations","     Purpose: Void management and lettings workflow","     Features:","-    - Housing register management","-    - Void property kanban (keys received → inspection → works → ready → let)","+    - Housing register management (Band A-D, bedroom need, medical priority)","+    - Void property kanban: Notice → Keys → Inspection → Works → Quality","+      → Ready → Offer → Let","     - Void duration prediction (AI)","+    - Days void RAG indicators (green <14, amber 14-28, red >28)","     - Applicant shortlisting and matching","     - Viewing booking system","     - Tenancy sign-up workflow"]},{"oldStart":177,"oldLines":9,"newStart":246,"newLines":11,"lines":["     - Message history per tenant","     - Bulk communications","     - Auto-triggered notifications (repair booked, arrears warning, etc.)","+    - AI triage: auto-categorise, priority, sentiment, suggested response","+    - Tone options: Supportive / Formal / Urgent / Legally required"," "," 2.12 Reports & Analytics","-    Route: /reports, /reports/:type","+    Route: /reports, /reports/:type, /reports/tsm","     Purpose: Regulatory reporting and operational analytics","     Features:","     - 27 regulatory reports"]},{"oldStart":191,"oldLines":56,"newStart":262,"newLines":84,"lines":["     - Dynamic report builder with filters","     - CSV/PDF export capability","     - Trend charts, sector median/quartile benchmarking","+    - AI-generated narrative summary per report","+    Report Categories:","+    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR","+    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre","+    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,","+      EPC/Energy","+    - Financial: Rent setting, service charge, repairs expenditure, bad debt,","+      void loss","+    - Governance: Board pack, risk register, H&S summary","+    - Tenant-facing: Annual report, estate reports"," "," 2.13 AI Centre","     Route: /ai-centre","     Purpose: AI capabilities hub and differentiator showcase","     Features:","-    - Insights tab: AI-generated operational insights","-    - Predictions tab: 8 predictive models dashboard","-    - Differentiators tab: 7 killer differentiator feature cards","-    - Vulnerability scan: Bulk tenant vulnerability assessment","-    - Assistant tab: Conversational AI interface","+    - Insights tab: AI-generated operational insights with confidence %,","+      affected entities, action buttons","+    - Predictions tab: 8 predictive models dashboard with scatter plots,","+      top-50 table, feature importance, accuracy gauges","+    - Differentiators tab: 7 killer differentiator feature cards with","+      vulnerability scan","+    - Assistant tab: Conversational AI interface (Yantra Assist)"," "," 2.14 AI Morning Briefing","     Route: /briefing","     Purpose: Personalised daily operational briefing","     Features:","-    - Persona-aware greeting and summary","+    - Persona-aware greeting (\"Good morning Sarah, here's what needs your","+      attention today\")","     - Weather forecast with property impact assessment","-    - Today's tasks with priority indicators","+    - Today's tasks with priority indicators and action buttons","     - AI predictions and alerts","     - Estate-level neighbourhood briefing accordion","     - Compliance section with Big 6 stats","+    - [Start my day →] and [Skip briefing] buttons"," "," 2.15 Admin System","     Route: /admin, /admin/integrations","     Purpose: System configuration and management","     Features:","     - Organisation profile and branding","-    - User management with RBAC (10 default roles)","-    - Team and patch management","+    - User management with RBAC (10 default roles × permission matrix)","+    - Team and patch management with caseload balancing","     - Workflow engine (visual builder with triggers/conditions/actions)","     - Integration hub (20 integrations across 3 tiers)","     - Integration toggle, test connection, status monitoring","-    - Audit trail (full CRUD logging)","-    - GDPR tools (SAR, erasure, retention policies)","-    - System reference data configuration","+    - Audit trail (full CRUD logging — timestamp, user, entity, field,","+      old/new value, IP)","+    - GDPR tools (SAR processor, right to erasure, retention policies,","+      consent management, Data Processing Register)","+    - System reference data configuration (editable lookup tables)","     - Notification configuration","-    - AI model configuration","+    - AI model configuration (toggle on/off, confidence thresholds)","+    - White-label: multi-HA deployment support"," "," 2.16 Tenant Portal","     Route: /tenant-portal","     Purpose: Tenant self-service interface","     Features:","-    - Distinct lighter/warmer UI theme","-    - Report repair (conversational wizard)","+    - Distinct lighter/warmer UI theme (visually separate from staff system)","+    - Report repair (conversational wizard: room → problem → photo →","+      appointment → confirm)","     - Check rent balance and make payment","     - View active repairs with photos and status","     - Quick message to housing officer","     - Document access","+    - Larger text, no jargon, large touch targets"," ","+2.17 Global Search","+    Route: /search","+    Purpose: Cross-entity full-text search","+    Features:","+    - Global search bar in header","+    - Searches across tenants, properties, cases, communications","+    - Results grouped by entity type","+    - Direct navigation to entity detail"," ","+"," 3. PERSONA SYSTEM"," ================================================================================"," "]},{"oldStart":252,"oldLines":50,"newStart":351,"newLines":90,"lines":[" ","     PERSONA 1: Chief Operating Officer (COO)","     Scope: Organisation-wide","-    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap","+    Dashboard: High-level KPIs, financial summary, compliance overview,","+              risk heatmap","     Access: Full read/write, admin settings, reports","+    AI Focus: Strategic — regulatory risk, portfolio compliance trends,","+              financial performance, TSM trajectory","+    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",","+                \"Benchmark against sector\""," ","     PERSONA 2: Head of Housing","     Scope: Regional (multiple Local Authorities)","     Dashboard: Regional performance, team metrics, escalated cases","     Access: Team management, regional reports, case oversight","+    AI Focus: Operational — SLA performance, team capacity, complaint trends","+    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\""," ","     PERSONA 3: Housing Manager","     Scope: Estate/Block level","     Dashboard: Estate KPIs, staff workload, compliance deadlines","     Access: Case assignment, approval workflows, local reports","+    AI Focus: Team management — workload, case overdue, skill gaps","+    AI Actions: \"Reassign cases\", \"Generate patch briefing\""," ","-    PERSONA 4: Housing Officer","+    PERSONA 4: Housing Officer (THE MOST IMPORTANT)","     Scope: Assigned patch (specific estates/blocks)","     Dashboard: Caseload worklist, today's visits, tenant alerts","     Access: Case CRUD, tenant interactions, notes","+    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action","+    AI Actions: Richest set — holding reply buttons, follow-up task creators,","+                referral generators, communication drafters on every page"," ","     PERSONA 5: Repairs Operative","     Scope: Assigned jobs","     Dashboard: Today's job list, materials, access notes","     Access: Repair status updates, photos, completion notes","+    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags","+    No access to: Financial data, personal tenant details beyond job needs"," "," "," 4. AI-NATIVE FEATURES"," ================================================================================"," ","-4.1 Dynamic AI Interface Elements","-    - Purple-bordered AI-generated buttons, fields, and prompts","-    - Appear contextually based on entity state and user role","-    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create","+4.1 Core Principle: Dynamic AI Interface Elements","+    Every entity page has TWO zones:","+    1. Standard zone: Fixed fields, tabs, buttons — always present","+    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that","+       change based on context"," ","-4.2 Yantra Assist","+    Dynamic elements include:","+    - Dynamic action buttons — only appear when AI determines they're relevant","+    - Dynamic info cards — contextual information the system thinks user needs","+    - Dynamic prompts — questions AI asks user, answering triggers workflows","+    - Dynamic warnings — alerts about this entity needing attention","+    - Dynamic information fields — calculated data not in standard layout","+","+    Styling: Purple left border (--status-ai), --surface-elevated background,","+    \"✦\" symbol prefix on AI-generated content","+","+4.2 The AI Action Flow Pattern","+    Every AI dynamic button follows this pattern:","+    1. PRESENT: Button with brief explanation of WHY it's suggesting the action","+    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)","+    3. EDIT: User can edit anything in the preview","+    4. CONFIRM: User approves the action","+    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications","+    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input","+    7. LEARN: System records accept/modify/reject for model improvement","+","+4.3 Yantra Assist","     Location: Bottom-left floating trigger (all pages)","-    Features:","-    - Contextual urgent items panel","-    - AI-generated insights for current page","-    - Daily briefing summary","-    - External factors affecting current entity","-    - Natural language query interface","+    Trigger: Yantra diamond mark at 32px with pulsing purple glow","+    Panel: 400px, slides from left, overlaying sidebar","+    Content changes based on current page/entity AND user persona"," ","-4.3 Prediction Models (8 total)","+    Panel Structure:","+    - 🔴 URGENT: Items needing immediate action","+    - 🟠 ATTENTION: Items approaching deadlines","+    - 💡 INSIGHTS: AI predictions & recommendations","+    - 📊 BRIEFING: Contextual summary & key stats","+    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context","+    - [Ask Yantra...] chat input at bottom","+","+4.4 Prediction Models (8 total)","     MODEL 1: Arrears Risk","-      Input: Payment history, UC status, household changes, employment","+      Input: Payment history, UC status, seasonal patterns, life events","       Output: Risk score (0–100), predicted arrears amount, recommended actions"," ","     MODEL 2: Damp & Mould Risk"]},{"oldStart":329,"oldLines":7,"newStart":468,"newLines":7,"lines":["       Input: Certificate expiry, contractor availability, building complexity","       Output: Failure probability, priority scheduling recommendations"," ","-4.4 Seven Killer Differentiators","+4.5 Seven Killer Differentiators","     D1: Predictive Damp Intelligence — 5-factor weighted algorithm","     D2: Live Crime Context for ASB — Police.uk data correlation","     D3: Automatic Vulnerability Detection — 7-factor scoring"]},{"oldStart":338,"oldLines":7,"newStart":477,"newLines":28,"lines":["     D6: AI Neighbourhood Briefing — Per-estate daily intelligence","     D7: IoT Sensor Integration — Switchee/Aico device support (mock)"," ","+4.6 AI-Augmented Workflows","+    - Repair Logging: Tenant describes issue → AI categorises SOR code,","+      assigns priority, identifies trade, checks asbestos, checks vulnerability,","+      checks recurring pattern, estimates cost, flags Awaab's Law","+    - Inbound Contact Triage: AI reads/summarises contact, categorises,","+      suggests appropriate case type, pre-fills forms","+    - Communication Sending: AI generates drafts using correct templates,","+      tenant details, plain English, legally required wording, tone options","+    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted","+      contractor instructions, pre-booked appointments","+    - Complaint Prevention: AI detects patterns (multiple calls, declining","+      satisfaction), generates prevention plan"," ","+4.7 Signature AI Interactions","+    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task","+    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)","+    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference","+       → preventive advice letters → inspection tasks","+    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar","+    5. \"Complaint Prevention\" — pattern detection → prevention plan execution","+","+"," 5. DATA MODEL (SUMMARY)"," ================================================================================"," "]},{"oldStart":371,"oldLines":54,"newStart":531,"newLines":82,"lines":["     organisations, teams, integrations, auditLog,","     externalDataCache, imdData"," ","+5.4 Case Reference Formats","+    | Type        | Format           | Colour  |","+    |-------------|------------------|---------|","+    | Complaint   | CMP-YYYY-XXXXX   | Orange  |","+    | Repair      | REP-YYYY-XXXXX   | Blue    |","+    | ASB         | ASB-YYYY-XXXXX   | Red     |","+    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |","+    | Financial   | FIN-YYYY-XXXXX   | Amber   |","+    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |","+    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |"," ","+"," 6. USER INTERFACE DESIGN"," ================================================================================"," "," 6.1 Theme","     Brand: Yantra Works dark theme","-    Primary Background: Dark (gray-900 / slate-900)","-    Accent: Brand teal (#14b8a6)","-    Secondary: Peach, garnet, purple (for AI elements)","-    Typography: System font stack, clean hierarchy","+    Primary Background: --surface-dark (#0D1117)","+    Card Background: --surface-card (#151B23)","+    Elevated: --surface-elevated (#1C2333)","+    Hover: --surface-hover (#222D3D)","+    Accent: --brand-teal (#058995)","+    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)","+    AI Colour: --status-ai (#A371F7) — purple for all AI elements","+    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)"," ","-6.2 Layout","-    - Fixed left sidebar (collapsible) with 14 navigation items","-    - Top header with logo, global search, notifications, user menu","+6.2 Typography","+    Headings: \"Space Grotesk\", sans-serif — bold, technical","+    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)","+    Monospace: \"JetBrains Mono\", monospace — references, codes","+    Headings in --brand-peach on dark backgrounds","+    Section labels: --brand-teal, uppercase, letter-spaced","+","+6.3 Layout","+    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items","+    - Top header with logo, global search, notifications, AI trigger, user menu","     - Breadcrumb navigation reflecting hierarchy","-    - Main content area with responsive grid","+    - Main content area with responsive grid (max 1400px)","     - Yantra Assist floating panel (bottom-left)","+    - Phase banner: garnet \"BETA\" tag"," ","-6.3 Navigation Items (Sidebar)","-    1. Dashboard        8. Communications","-    2. Explore          9. Reports","-    3. Tenancies       10. AI Centre","-    4. Properties      11. Admin","-    5. Repairs         12. Tenant Portal","-    6. Compliance      13. ---","-    7. Complaints      14. Persona Switcher","-    + ASB, Rent, Allocations (sub-items)","+6.4 Navigation Items (Sidebar)","+    NAVIGATE: Explore, Dashboard","+    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,","+            Complaints, Allocations, ASB","+    COMMUNICATE: Communications","+    ANALYSE: Reports, AI Centre","+    SYSTEM: Admin, Settings","+    + Persona Switcher"," ","-6.4 Design Principles","+6.5 Design Principles","+    - Dark mode is default — Yantra Works brand palette throughout","     - Mobile-aware responsive design","-    - WCAG AA compliant (contrast, focus, keyboard, ARIA)","+    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)","     - Skip-to-content link","     - Reduced-motion support (@media prefers-reduced-motion)","     - Focus-visible outlines on all interactive elements","     - Screen-reader-only (.sr-only) text for context","+    - Animations throughout — staggered reveals, sliding panels, smooth","+      transitions, pulsing alerts. UI must feel ALIVE, not static.","+    - UK conventions: DD/MM/YYYY, British English, GBP £"," ","-6.5 Component Library","+6.6 Component Library","     - KpiCard — metric display with trend sparkline","     - StatusPill — status badge (green/amber/red)","-    - ActionModal — accessible form modal with validation","+    - ActionModal — accessible form modal with focus trap, Escape handler,","+      aria attributes, form validation, previous focus restoration","     - AiActionCard — purple-bordered AI suggestion card","-    - CountdownTimer — deadline countdown with color urgency","+    - CountdownTimer — deadline countdown with color urgency transitions","+      (green → peach → garnet → pulsing garnet)","     - PropertyMap — Leaflet map with markers","     - HelpDrawer — full-screen contextual help (20 topics)","-    - DampIntelligencePanel — damp risk factor display","+    - DampIntelligencePanel — damp risk factor display with score badge","     - VulnerabilityPanel — 7-factor vulnerability assessment","-    - BenefitsPanel — entitlement list with status icons","-    - NeighbourhoodBriefingPanel — estate-level daily briefing","+    - BenefitsPanel — entitlement list with status icons, unclaimed amounts","+    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions"," "," "," 7. REGULATORY COMPLIANCE"]},{"oldStart":440,"oldLines":12,"newStart":628,"newLines":23,"lines":[" "," 7.2 GDPR Compliance","     - Full audit trail on all data operations","-    - Subject Access Request (SAR) support","+    - Subject Access Request (SAR) processor","     - Right to erasure workflow","     - Data retention policy configuration","     - Consent management","+    - Data Processing Register"," ","+7.3 Accessibility (WCAG AA)","+    - Focus traps in modals","+    - Skip-to-content link","+    - Keyboard navigation (Tab, Escape)","+    - ARIA labels, roles, described-by","+    - Reduced-motion media query","+    - Color contrast ratio ≥ 4.5:1","+    - Screen-reader-only text","+    - Focus-visible outlines"," ","+"," 8. NON-FUNCTIONAL REQUIREMENTS"," ================================================================================"," "]},{"oldStart":454,"oldLines":59,"newStart":653,"newLines":83,"lines":["     - Frontend bundle size: < 3MB","     - Cloud Run cold start: < 3s","     - Firestore query latency: < 200ms","+    - AI response latency (target): < 3s for conversational queries"," "," 8.2 Security","     - Firebase Authentication with Google sign-in","-    - RBAC with 10 default roles","+    - RBAC with 10 default roles (super-admin through read-only)","     - CSP headers with whitelist","     - CORS restricted to allowed origins","     - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)","-    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)","+    - Security headers (Permissions-Policy, X-Content-Type-Options,","+      X-Frame-Options, Referrer-Policy, HSTS)","     - Secret Manager for all credentials (no secrets in code)","     - JSON body limit 1MB","+    - Request correlation via X-Request-ID"," "," 8.3 Scalability","     - Cloud Run: 0–10 instances (auto-scaling)","     - Firestore: NoSQL, horizontally scalable","     - External API caching reduces load","+    - Concurrency: 80 requests/instance"," "," 8.4 Availability","     - Cloud Run SLA: 99.95%","     - External API fallbacks (simulated data on failure)","     - Health check with Firestore connectivity monitoring","+    - States: healthy / degraded / unhealthy"," ","-8.5 Accessibility (WCAG AA)","-    - Focus traps in modals","-    - Skip-to-content link","-    - Keyboard navigation (Tab, Escape)","-    - ARIA labels, roles, described-by","-    - Reduced-motion media query","-    - Color contrast ratio ≥ 4.5:1","-","-8.6 Testing","-    - Selenium E2E: 332 tests, 99.7% pass rate","+8.5 Testing","+    - Selenium E2E: 331 tests, 99.7% pass rate","     - Unit tests: 66 tests for public data APIs","     - TypeScript: 0 errors (strict mode)","     - Vite build: 0 critical warnings"," "," ","-9. CURRENT STATUS & METRICS","+9. SIMULATED DATA"," ================================================================================"," ","-9.1 Production Deployment","+9.1 Scale","+    75 properties, 68 active tenancies, 5 voids","+    Realistic SE London postcodes, 12-digit UPRNs","+    Diverse tenant names reflecting London demographics","+","+9.2 Financial Profile","+    Rents: social £95-140/week, affordable £140-200/week","+    Service charges: £5-35/week","+    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%","+    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k","+","+9.3 Cases","+    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)","+    34 open complaints (28 Stage 1, 6 Stage 2)","+    12 ASB cases","+    8 damp/mould cases (3 emergency, 5 significant)","+    25 financial cases","+    5 voids at various pipeline stages","+","+9.4 Compliance","+    Gas 99.4%, Electrical 97.8%, Fire 99.1%","+    Asbestos 98.5%, Legionella 99.0%, Lifts 100%","+","+","+10. CURRENT STATUS & METRICS","+================================================================================","+","+10.1 Production Deployment","     URL: https://socialhomes-587984201316.europe-west2.run.app","     Region: europe-west2 (London)","     Status: LIVE and operational","     Database: 460+ documents across 17 Firestore collections"," ","-9.2 Build Metrics","+10.2 Build Metrics","     | Metric                    | Value           |","     |---------------------------|-----------------|","     | Frontend modules          | 3,397           |","     | Frontend build time       | ~35–39 seconds  |","     | Backend TypeScript errors | 0               |","     | Frontend TypeScript errors| 0               |","-    | Selenium tests            | 332             |","+    | Selenium tests            | 331             |","     | Selenium pass rate        | 99.7%           |","     | Unit tests (public data)  | 66              |","     | Firestore collections     | 17              |"]},{"oldStart":515,"oldLines":8,"newStart":738,"newLines":17,"lines":["     | Seeded cases              | 279+            |","     | API endpoints             | 50+             |","     | Frontend routes           | 40+             |","+    | Lines of code             | 23,852          |"," ","+10.3 Phase Completion","+    Phase 0: Infrastructure        — DONE (10/10)","+    Phase 1: Foundation            — DONE (12/12)","+    Phase 2: Intelligence          — DONE (14/14)","+    Phase 3: Enrichment            — DONE (14/17, 3 deferred)","+    Phase 4: Completion            — DONE (11/14, 3 deferred)","+    Phase 5: Evolution             — TODO (0/32)","+"," ================================================================================","   End of Doc1 — SocialHomes.Ai Base Specification","-  Yantra Works | 2026-02-18","+  Yantra Works | 2026-02-23"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE8, SE13, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (voids, arrears, complaints, repairs, ASB, compliance, damp, allocations)\n    - KPI trend sparklines (12 months)\n    - Activity feed with live updates\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    Features:\n    - Interactive Leaflet map with property markers\n    - Three.js 3D building visualization (digital twin)\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical), purple (AI flag)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search, filter, sort\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n\n2.4 Properties Management\n    Route: /properties, /properties/:id\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - Repairs kanban board (Reported → Diagnosed → Scheduled → In Progress → Complete)\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe, NICEIC)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page (/compliance/awaabs-law):\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: Fire Risk Assessment, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman code)\n    Features:\n    - Complaint list with status filtering\n    - Two-stage timeline: Stage 1 (5/10 WD), Stage 2 (20 WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM reporting integration\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - ASB case list with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with priority scoring\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management\n    - Void property kanban (keys received → inspection → works → ready → let)\n    - Void duration prediction (AI)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights\n    - Predictions tab: 8 predictive models dashboard\n    - Differentiators tab: 7 killer differentiator feature cards\n    - Vulnerability scan: Bulk tenant vulnerability assessment\n    - Assistant tab: Conversational AI interface\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting and summary\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles)\n    - Team and patch management\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging)\n    - GDPR tools (SAR, erasure, retention policies)\n    - System reference data configuration\n    - Notification configuration\n    - AI model configuration\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme\n    - Report repair (conversational wizard)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview, risk heatmap\n    Access: Full read/write, admin settings, reports\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n\n    PERSONA 4: Housing Officer\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Dynamic AI Interface Elements\n    - Purple-bordered AI-generated buttons, fields, and prompts\n    - Appear contextually based on entity state and user role\n    - Action flow: Present → Preview → Edit → Confirm → Follow-up → Auto-create\n\n4.2 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Features:\n    - Contextual urgent items panel\n    - AI-generated insights for current page\n    - Daily briefing summary\n    - External factors affecting current entity\n    - Natural language query interface\n\n4.3 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, household changes, employment\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.4 Seven Killer Differentiators\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n    D2: Live Crime Context for ASB — Police.uk data correlation\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n    D4: Property Passport — Multi-source property dossier\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: Dark (gray-900 / slate-900)\n    Accent: Brand teal (#14b8a6)\n    Secondary: Peach, garnet, purple (for AI elements)\n    Typography: System font stack, clean hierarchy\n\n6.2 Layout\n    - Fixed left sidebar (collapsible) with 14 navigation items\n    - Top header with logo, global search, notifications, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid\n    - Yantra Assist floating panel (bottom-left)\n\n6.3 Navigation Items (Sidebar)\n    1. Dashboard        8. Communications\n    2. Explore          9. Reports\n    3. Tenancies       10. AI Centre\n    4. Properties      11. Admin\n    5. Repairs         12. Tenant Portal\n    6. Compliance      13. ---\n    7. Complaints      14. Persona Switcher\n    + ASB, Rent, Allocations (sub-items)\n\n6.4 Design Principles\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n\n6.5 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with validation\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons\n    - NeighbourhoodBriefingPanel — estate-level daily briefing\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) support\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms\n    - Frontend bundle size: < 3MB\n    - Cloud Run cold start: < 3s\n    - Firestore query latency: < 200ms\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options, Referrer-Policy)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n\n8.5 Accessibility (WCAG AA)\n    - Focus traps in modals\n    - Skip-to-content link\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n\n8.6 Testing\n    - Selenium E2E: 332 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. CURRENT STATUS & METRICS\n================================================================================\n\n9.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n9.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 332             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-18\n================================================================================\n"},"sourceToolAssistantUUID":"3a574609-d544-41d3-90cf-b9832738d956"}
{"parentUuid":"1f755497-88e1-4012-98c3-fee5c82167d5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01KZZRjsdwS4BuuGhG4V1FXd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0128bFx4Hij2sePfep15mJ3F","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9057,"cache_read_input_tokens":95652,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9057},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVgVtai9WBSP64AjxUj","type":"assistant","uuid":"9bc4e5b7-0e31-41e5-81f5-a0d5ca6e795c","timestamp":"2026-02-23T18:44:41.611Z"}
{"parentUuid":"9bc4e5b7-0e31-41e5-81f5-a0d5ca6e795c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0128bFx4Hij2sePfep15mJ3F","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"b4ce3a7d-d15b-4463-94a2-b3fd887a28ab","timestamp":"2026-02-23T18:44:41.613Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"9bc4e5b7-0e31-41e5-81f5-a0d5ca6e795c"}
{"parentUuid":"b4ce3a7d-d15b-4463-94a2-b3fd887a28ab","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01VvKuaJveep9JwUdnZ5YDXL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CjN1RwdtPLJ9KPjPAZTTny","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer (25 modules)             │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n1.3 Request Flow Diagram\n\n    Browser → React SPA → api-client.ts → HTTP Request\n                                              │\n                                              ▼\n    Express Server ← Middleware Pipeline ← Route Handler\n         │               │\n         │     ┌─────────┴──────────────────────────┐\n         │     │ Morgan → Helmet → CORS → Compression│\n         │     │ → JSON Parser (1MB) → X-Request-ID  │\n         │     │ → Rate Limiter → Metrics → Handler   │\n         │     │ → Error Handler → Response            │\n         │     └──────────────────────────────────────┘\n         │\n         ├─→ Firestore (read/write)\n         ├─→ External API Proxy (with cache)\n         └─→ AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point (QueryClient)\n    ├── index.css                — Global styles, animations, accessibility\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage (Firebase + Google)\n    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage,\n    │   │                          ApplicationPage, ViewingBookingPage\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,\n    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    │                              PropertyMap, StatusPill, VulnerabilityPanel)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods\n    │   ├── useEntityIntelligence.ts  — AI scoring hooks\n    │   └── usePersonaScope.ts   — Persona-based data filtering\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client (70+ methods), Firebase, AI drafting,\n    │                              public data helpers\n    ├── contexts/                — AuthContext, AppContext\n    ├── utils/                   — Formatting utilities (safeText, etc.)\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification + X-Persona fallback\n    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 25 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)\n    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet (CSP, security headers)\n            → CORS (restricted origins) → Compression (gzip)\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                    │\n                                    ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                            │\n    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (16 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.11 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15 collections.\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES (2)\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS (2)\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (5)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    CONVENIENCE ALIASES\n    GET    /api/v1/repairs              — All repairs (type=='repair')\n    GET    /api/v1/complaints           — All complaints (type=='complaint')\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE (2+)\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT (3)\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS (2)\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS (3)\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING (2)\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n    POST   /api/v1/ai/chat                               — Yantra Assist chat\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          — Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              — Firebase client config (public)\n    GET    /health                     — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Concurrency: 80\n     ├── Timeout: 300s\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-23\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":104709,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVh54dETFgJZjJWinaj","type":"assistant","uuid":"f85e3085-9aa1-41b5-85d5-edec56dd11f7","timestamp":"2026-02-23T18:47:50.759Z"}
{"parentUuid":"f85e3085-9aa1-41b5-85d5-edec56dd11f7","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CjN1RwdtPLJ9KPjPAZTTny","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt has been updated successfully."}]},"uuid":"047caf0f-00da-4b54-8f81-06631f0b1380","timestamp":"2026-02-23T18:47:50.854Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer (25 modules)             │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n1.3 Request Flow Diagram\n\n    Browser → React SPA → api-client.ts → HTTP Request\n                                              │\n                                              ▼\n    Express Server ← Middleware Pipeline ← Route Handler\n         │               │\n         │     ┌─────────┴──────────────────────────┐\n         │     │ Morgan → Helmet → CORS → Compression│\n         │     │ → JSON Parser (1MB) → X-Request-ID  │\n         │     │ → Rate Limiter → Metrics → Handler   │\n         │     │ → Error Handler → Response            │\n         │     └──────────────────────────────────────┘\n         │\n         ├─→ Firestore (read/write)\n         ├─→ External API Proxy (with cache)\n         └─→ AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point (QueryClient)\n    ├── index.css                — Global styles, animations, accessibility\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage (Firebase + Google)\n    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage,\n    │   │                          ApplicationPage, ViewingBookingPage\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,\n    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    │                              PropertyMap, StatusPill, VulnerabilityPanel)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods\n    │   ├── useEntityIntelligence.ts  — AI scoring hooks\n    │   └── usePersonaScope.ts   — Persona-based data filtering\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client (70+ methods), Firebase, AI drafting,\n    │                              public data helpers\n    ├── contexts/                — AuthContext, AppContext\n    ├── utils/                   — Formatting utilities (safeText, etc.)\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification + X-Persona fallback\n    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 25 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)\n    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet (CSP, security headers)\n            → CORS (restricted origins) → Compression (gzip)\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                    │\n                                    ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                            │\n    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (16 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.11 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15 collections.\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES (2)\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS (2)\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (5)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    CONVENIENCE ALIASES\n    GET    /api/v1/repairs              — All repairs (type=='repair')\n    GET    /api/v1/complaints           — All complaints (type=='complaint')\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE (2+)\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT (3)\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS (2)\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS (3)\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING (2)\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n    POST   /api/v1/ai/chat                               — Yantra Assist chat\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          — Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              — Firebase client config (public)\n    GET    /health                     — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Concurrency: 80\n     ├── Timeout: 300s\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-23\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Version: 2.0  |  Date: 2026-02-18","+  Version: 3.0  |  Date: 2026-02-23","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":28,"oldLines":7,"newStart":28,"newLines":7,"lines":["     │  └───────────────────────────┼───────────────────────────────┘  │","     │                              │                                  │","     │  ┌───────────────────────────┼───────────────────────────────┐  │","-    │  │                    Service Layer                          │  │","+    │  │                    Service Layer (25 modules)             │  │","     │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │","     │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │","     │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │"]},{"oldStart":51,"oldLines":7,"newStart":51,"newLines":25,"lines":["     │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │","     └────────────────────────────────────────────────────┘"," ","+1.3 Request Flow Diagram"," ","+    Browser → React SPA → api-client.ts → HTTP Request","+                                              │","+                                              ▼","+    Express Server ← Middleware Pipeline ← Route Handler","+         │               │","+         │     ┌─────────┴──────────────────────────┐","+         │     │ Morgan → Helmet → CORS → Compression│","+         │     │ → JSON Parser (1MB) → X-Request-ID  │","+         │     │ → Rate Limiter → Metrics → Handler   │","+         │     │ → Error Handler → Response            │","+         │     └──────────────────────────────────────┘","+         │","+         ├─→ Firestore (read/write)","+         ├─→ External API Proxy (with cache)","+         └─→ AI Service (computation)","+","+"," 2. TECHNOLOGY STACK"," ================================================================================"," "]},{"oldStart":59,"oldLines":53,"newStart":77,"newLines":56,"lines":[" ","     | Component          | Technology              | Version    |","     |--------------------|-------------------------|------------|","-    | Framework          | React                   | 19         |","-    | Language           | TypeScript              | 5.9        |","+    | Framework          | React                   | 19.2.0     |","+    | Language           | TypeScript              | 5.9.3      |","     | Router             | React Router            | v7         |","-    | Styling            | Tailwind CSS            | v4         |","+    | Styling            | Tailwind CSS            | 4.1.18     |","     | State Management   | React Context + Hooks   | —          |","-    | Data Fetching      | @tanstack/react-query   | latest     |","-    | 3D Visualization   | Three.js (@react-three) | r128       |","-    | Maps               | Leaflet + React Leaflet | 1.9        |","-    | Charts             | Recharts + D3.js        | latest     |","-    | Icons              | Lucide React            | latest     |","+    | Data Fetching      | @tanstack/react-query   | 5.90.20    |","+    | 3D Visualization   | Three.js + React Three  | 0.182.0    |","+    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |","+    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |","+    | Icons              | Lucide React            | 0.563.0    |","     | Auth UI            | FirebaseUI              | latest     |","-    | Build Tool         | Vite                    | 7.2        |","+    | Build Tool         | Vite                    | 7.2.4      |"," "," 2.2 Backend Stack"," ","     | Component          | Technology              | Version    |","     |--------------------|-------------------------|------------|","-    | Framework          | Express.js              | 4          |","-    | Language           | TypeScript              | 5.7        |","+    | Framework          | Express.js              | 4.21.2     |","+    | Language           | TypeScript              | 5.7.0      |","     | Runtime            | Node.js                 | 20.17.0    |","-    | Database           | Google Firestore        | latest     |","-    | Auth               | Firebase Admin SDK      | latest     |","-    | Security           | Helmet                  | latest     |","-    | Logging            | Morgan + structured     | latest     |","-    | Testing            | Vitest                  | latest     |","-    | Build              | tsc + tsx               | latest     |","+    | Database           | Google Firestore        | Native     |","+    | Auth               | Firebase Admin SDK      | 13.6.1     |","+    | Security           | Helmet                  | 8.1.0      |","+    | CORS               | cors                    | 2.8.5      |","+    | Logging            | Morgan                  | 1.10.0     |","+    | Compression        | compression             | 1.8.0      |","+    | Testing            | Vitest                  | 4.0.18     |","+    | Build              | tsc + tsx                | latest     |"," "," 2.3 Infrastructure"," ","-    | Component          | Technology              | Details            |","-    |--------------------|-------------------------|--------------------|","-    | Hosting            | Google Cloud Run        | europe-west2       |","-    | Container Registry | Artifact Registry       | europe-west2       |","-    | Database           | Google Firestore        | Native mode        |","-    | Authentication     | Firebase Auth           | Google SSO + email |","-    | Secrets            | Secret Manager          | 4 secrets          |","-    | CI/CD              | Cloud Build             | Auto on git push   |","-    | Source Control      | GitHub                  | rajivpeter repo    |","-    | Monitoring         | Custom metrics + health | In-app             |","+    | Component          | Technology              | Details              |","+    |--------------------|-------------------------|----------------------|","+    | Hosting            | Google Cloud Run        | europe-west2         |","+    | Container Registry | Artifact Registry       | europe-west2         |","+    | Database           | Google Firestore        | Native mode          |","+    | Authentication     | Firebase Auth           | Google SSO + email   |","+    | Secrets            | Secret Manager          | 4 secrets            |","+    | CI/CD              | Cloud Build             | Auto on git push     |","+    | Source Control     | GitHub                  | rajivpeter repo      |","+    | Monitoring         | Custom metrics + health | In-app               |","+    | Session Capture    | Entire.io               | Manual commit        |"," "," 2.4 Testing Stack"," ","-    | Component          | Technology              | Coverage           |","-    |--------------------|-------------------------|--------------------|","-    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |","-    | Unit               | Vitest                  | 66 tests           |","-    | Type Checking      | TypeScript (strict)     | 0 errors           |","+    | Component          | Technology              | Coverage             |","+    |--------------------|-------------------------|----------------------|","+    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |","+    | Unit               | Vitest                  | 66 tests             |","+    | Type Checking      | TypeScript (strict)     | 0 errors             |"," "," "," 3. FRONTEND ARCHITECTURE"]},{"oldStart":115,"oldLines":22,"newStart":136,"newLines":23,"lines":[" ","     app/src/","     ├── App.tsx                  — Router with 40+ routes","-    ├── main.tsx                 — React DOM entry point","-    ├── index.css                — Global styles + animations","+    ├── main.tsx                 — React DOM entry point (QueryClient)","+    ├── index.css                — Global styles, animations, accessibility","     │","     ├── pages/                   — 19 page directories","     │   ├── admin/               — AdminPage, IntegrationsPage","-    │   ├── ai-centre/           — AiCentrePage","+    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)","     │   ├── allocations/         — AllocationsPage","     │   ├── asb/                 — AsbPage, AsbDetailPage","-    │   ├── auth/                — LoginPage","-    │   ├── briefing/            — BriefingPage","+    │   ├── auth/                — LoginPage (Firebase + Google)","+    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)","     │   ├── communications/      — CommunicationsPage","     │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage","     │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage","-    │   ├── dashboard/           — DashboardPage","+    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)","     │   ├── explore/             — ExplorePage (7-level drill-down)","-    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.","+    │   ├── properties/          — PropertiesPage, PropertyDetailPage,","+    │   │                          ApplicationPage, ViewingBookingPage","     │   ├── rent/                — RentPage","     │   ├── repairs/             — RepairsPage, RepairDetailPage","     │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage"]},{"oldStart":141,"oldLines":18,"newStart":163,"newLines":25,"lines":["     │","     ├── components/","     │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist","-    │   └── shared/              — Reusable components (12 files)","+    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,","+    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,","+    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,","+    │                              PropertyMap, StatusPill, VulnerabilityPanel)","     │","     ├── data/                    — Mock/seed data (10 files)","     ├── hooks/                   — Custom hooks (3 files)","+    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods","+    │   ├── useEntityIntelligence.ts  — AI scoring hooks","+    │   └── usePersonaScope.ts   — Persona-based data filtering","     ├── types/                   — TypeScript definitions (721 lines)","-    ├── services/                — API client, public data helpers","-    ├── contexts/                — Auth, User contexts","-    ├── utils/                   — Utility helpers","+    ├── services/                — API client (70+ methods), Firebase, AI drafting,","+    │                              public data helpers","+    ├── contexts/                — AuthContext, AppContext","+    ├── utils/                   — Formatting utilities (safeText, etc.)","     └── assets/                  — Images, fonts"," "," 3.2 Routing Architecture (React Router v7)","-    All routes defined in App.tsx within a BrowserRouter.","+    All routes defined in App.tsx within BrowserRouter.","     Routes wrapped in Layout component (sidebar + header).","     Protected routes use ProtectedRoute component (Firebase auth guard)."," "]},{"oldStart":191,"oldLines":7,"newStart":220,"newLines":7,"lines":[" "," 3.3 State Management","     - React Context for global state (auth user, persona)","-    - @tanstack/react-query for server state (API data caching, polling)","+    - @tanstack/react-query for server state (API caching, 5-min stale time)","     - Local component state (useState, useReducer) for UI state","     - No Redux/Zustand — kept deliberately simple"," "]},{"oldStart":208,"oldLines":8,"newStart":237,"newLines":18,"lines":["     - Lucide React for all icons","     - Purple border for AI-generated elements","     - Consistent page structure: header + filter bar + content grid","+    - ErrorBoundary wrapping for error resilience"," ","+3.6 Accessibility Implementation","+    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",","+      aria-modal, aria-labelledby, aria-describedby, focus restoration","+    - index.css: *:focus-visible outlines, prefers-reduced-motion,","+      .sr-only class, .skip-to-content link, .field-error styles","+    - Layout: skip-to-content link + id=\"main-content\" on <main>","+    - Sidebar: aria-label on <nav> and collapse button","+    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes"," ","+"," 4. BACKEND ARCHITECTURE"," ================================================================================"," "]},{"oldStart":219,"oldLines":8,"newStart":258,"newLines":8,"lines":["     ├── index.ts                 — Express entry, middleware, route registration","     │","     ├── middleware/               — 5 middleware modules","-    │   ├── auth.ts              — Firebase token verification","-    │   ├── error-handler.ts     — Structured JSON error handler","+    │   ├── auth.ts              — Firebase token verification + X-Persona fallback","+    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)","     │   ├── metrics.ts           — Request/response metrics recording","     │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)","     │   └── rbac.ts              — Role-based access control"]},{"oldStart":242,"oldLines":7,"newStart":281,"newLines":7,"lines":["     │   ├── reports.ts           — 27 regulatory reports","     │   └── tenants.ts           — Tenant list/detail","     │","-    ├── services/                — 20 service modules","+    ├── services/                — 25 service modules","     │   ├── external-api.ts      — Cache-through, rate limiting, audit","     │   ├── firestore.ts         — Firestore connection + helpers","     │   ├── firebase-admin.ts    — Firebase Admin initialization"]},{"oldStart":252,"oldLines":9,"newStart":291,"newLines":9,"lines":["     │   ├── benefits-engine.ts   — UK benefit rules engine","     │   ├── property-passport.ts — Multi-source aggregation","     │   ├── neighbourhood-briefing.ts   — Per-estate briefing","-    │   ├── govuk-notify.ts      — 24 notification templates","-    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical","-    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints","+    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)","+    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)","+    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints","     │   ├── monitoring.ts        — Metrics singleton","     │   ├── hact-export.ts       — HACT reporting format","     │   ├── seed.ts              — Database seeding"]},{"oldStart":271,"oldLines":9,"newStart":310,"newLines":10,"lines":[" "," 4.2 Middleware Pipeline (Request Flow)"," ","-    Request → Morgan Logger → Helmet → CORS → Compression","+    Request → Morgan Logger → Helmet (CSP, security headers)","+            → CORS (restricted origins) → Compression (gzip)","             → JSON Parser (1MB limit) → Request ID (X-Request-ID)","-            → Rate Limiter → Metrics Recorder → Route Handler","+            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler","             → Error Handler → Response"," "," 4.3 Rate Limiting (4 Tiers)"]},{"oldStart":286,"oldLines":14,"newStart":326,"newLines":16,"lines":["     | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |"," "," 4.4 Error Handling","-    - Structured JSON error responses","+    - Structured JSON error responses: { error, message, statusCode }","     - No stack traces leaked in production","-    - Error logging with request ID correlation","+    - Error logging with request ID correlation (X-Request-ID)","     - Graceful degradation for external API failures","+    - ErrorBoundary on frontend for component-level recovery"," "," 4.5 Health Check","     GET /health → { status, firestore, uptime, memory, timestamp }","     States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy","+    Memory: RSS, heap used, heap total"," "," "," 5. DATA MODELS (FIRESTORE)"]},{"oldStart":305,"oldLines":8,"newStart":347,"newLines":8,"lines":["     │   organisations │     │     users        │     │     teams       │","     │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │","     └─────────────────┘     └─────────────────┘     └─────────────────┘","-                                     │","-                                     ▼","+                                    │","+                                    ▼","     ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","     │   properties    │◀───▶│    tenants       │◀───▶│     cases       │","     │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │"]},{"oldStart":317,"oldLines":15,"newStart":359,"newLines":15,"lines":["     │   repairs       │     │   complaints     │     │      asb        │","     │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │","     └─────────────────┘     └─────────────────┘     └─────────────────┘","-                                                             │","-    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐","+                                                            │","+    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐","     │   financial     │     │   damp-mould     │     │   activities    │","     │   (docs)        │     │   (docs)         │     │   (docs)        │","     └─────────────────┘     └─────────────────┘     └─────────────────┘"," ","     ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","     │   tasks         │     │  integrations    │     │    auditLog     │","-    │   (docs)        │     │   (20 docs)      │     │   (docs)        │","+    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │","     └─────────────────┘     └─────────────────┘     └─────────────────┘"," ","     ┌──────────────────────┐     ┌─────────────────┐"]},{"oldStart":436,"oldLines":7,"newStart":478,"newLines":6,"lines":["         { date, action, actor, notes }","       ]","       // Type-specific fields via discriminated union","-      // See individual type schemas below","     }"," "," 5.5 Repair Schema (extends Case)"]},{"oldStart":542,"oldLines":7,"newStart":583,"newLines":7,"lines":["     }"," "," 5.10 Firestore Indexes (Composite)","-    Defined in firestore.indexes.json at project root.","+    Defined in firestore.indexes.json at project root (16 indexes).","     Key indexes for:","     - cases: (propertyId, type, createdDate DESC)","     - cases: (tenantId, type, createdDate DESC)"]},{"oldStart":550,"oldLines":7,"newStart":591,"newLines":12,"lines":["     - activities: (entityId, timestamp DESC)","     - externalDataCache: (source, expiresAt)"," ","+5.11 Firestore Security Rules","+    Defined in firestore.rules at project root.","+    Persona-based access control for all 15 collections.","+    Audit log is write-once, read-many (immutable)."," ","+"," 6. API ARCHITECTURE"," ================================================================================"," "]},{"oldStart":558,"oldLines":78,"newStart":604,"newLines":82,"lines":["     - RESTful design with /api/v1/ prefix","     - JSON request/response bodies","     - Consistent error format: { error, message, statusCode }","-    - Pagination: ?page=N&limit=N (default 20)","+    - Pagination: ?page=N&limit=N (default 20, max 50)","     - Filtering: Query parameters per endpoint","     - Sorting: ?sort=field&order=asc|desc","     - Request correlation via X-Request-ID header"," "," 6.2 API Route Registry (50+ endpoints)"," ","-    AUTHENTICATION","+    AUTHENTICATION (3)","     POST   /api/v1/auth/login          — Firebase token login","     POST   /api/v1/auth/register       — User registration","     POST   /api/v1/auth/logout         — Session invalidation"," ","-    PROPERTIES","+    PROPERTIES (2)","     GET    /api/v1/properties           — List with pagination/filter","     GET    /api/v1/properties/:id       — Property detail"," ","-    TENANTS","+    TENANTS (2)","     GET    /api/v1/tenants              — List with pagination/filter","     GET    /api/v1/tenants/:id          — Tenant detail"," ","-    CASES (Unified)","+    CASES (5)","     GET    /api/v1/cases                — List with type/status filter","     GET    /api/v1/cases/:id            — Case detail","     POST   /api/v1/cases                — Create case","     PUT    /api/v1/cases/:id            — Update case","     DELETE /api/v1/cases/:id            — Close/archive case"," ","-    COMPLIANCE","+    CONVENIENCE ALIASES","+    GET    /api/v1/repairs              — All repairs (type=='repair')","+    GET    /api/v1/complaints           — All complaints (type=='complaint')","+","+    COMPLIANCE (2)","     GET    /api/v1/compliance           — Big 6 summary dashboard","     GET    /api/v1/compliance/:type     — Type-specific data"," ","-    EXPLORE","-    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data","+    EXPLORE (2+)","+    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy","     GET    /api/v1/explore/estate/:id   — Estate detail with blocks"," ","-    RENT","+    RENT (3)","     GET    /api/v1/rent/arrears         — Arrears dashboard summary","     GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)","     GET    /api/v1/rent/transactions    — Transaction list"," ","-    REPAIRS","+    REPAIRS (2)","     GET    /api/v1/repairs              — Repair list","     GET    /api/v1/repairs/:id          — Repair detail"," ","-    REPORTS","+    REPORTS (3)","     GET    /api/v1/reports              — Report catalog (27 types)","     GET    /api/v1/reports/:type        — Generate report data","     GET    /api/v1/reports/tsm          — TSM specific data"," ","-    LETTINGS","+    LETTINGS (2)","     GET    /api/v1/lettings/voids       — Void property list","     GET    /api/v1/lettings/register    — Housing register"," ","-    BOOKING","+    BOOKING (2)","     POST   /api/v1/booking/viewing      — Book a viewing","     POST   /api/v1/booking/application  — Submit application"," ","-    BRIEFING","+    BRIEFING (2)","     GET    /api/v1/briefing             — Personalised morning briefing","     GET    /api/v1/briefing/:estateId   — Estate-specific briefing"," ","-    EXPORT","+    EXPORT (2)","     GET    /api/v1/export/csv/:type     — CSV export","     GET    /api/v1/export/pdf/:type     — PDF export"," ","-    AI INTELLIGENCE (14 endpoints)","+    AI INTELLIGENCE (14)","     GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score","     GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview","     GET    /api/v1/ai/crime-context/:estateId           — Crime context","     GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation","     GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score","-    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan","+    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants","     GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement","     GET    /api/v1/ai/property-passport/:propertyId      — Property passport","     GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing"]},{"oldStart":637,"oldLines":8,"newStart":687,"newLines":9,"lines":["     GET    /api/v1/ai/notify/templates/:category         — Templates by category","     GET    /api/v1/ai/notify/template/:id                — Template detail","     POST   /api/v1/ai/notify/render                      — Render template","+    POST   /api/v1/ai/chat                               — Yantra Assist chat"," ","-    MOCK TIER 3 APIs","+    MOCK TIER 3 (9)","     GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check","     GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data","     GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data"]},{"oldStart":647,"oldLines":27,"newStart":698,"newLines":28,"lines":["     POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission","     POST   /api/v1/ai/mock/signing                       — DocuSign envelope","     GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check","-    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title","+    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry"," ","-    EXTERNAL DATA PROXY","-    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data","-    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather","-    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk","-    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup","+    EXTERNAL DATA PROXY (9)","+    GET    /api/v1/public-data/police/:postcode          — Police crime data","+    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast","+    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk","+    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup","     GET    /api/v1/public-data/epc/:uprn                  — EPC certificate","-    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data","-    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market","+    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021","+    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour","     GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify","-    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify","+    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify"," ","-    ADMIN","+    ADMIN (4)","     GET    /api/v1/admin/integrations                    — List integrations","     POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable","     POST   /api/v1/admin/integrations/:id/test           — Test connection","     GET    /api/v1/admin/monitoring                       — Metrics dashboard"," ","-    HEALTH","-    GET    /health                                        — Health check","+    CONFIG & HEALTH","+    GET    /api/v1/config              — Firebase client config (public)","+    GET    /health                     — Health check"," "," "," 7. EXTERNAL API INTEGRATION ARCHITECTURE"]},{"oldStart":691,"oldLines":7,"newStart":743,"newLines":10,"lines":["     | Census data       | 90 days  | Static (Census 2021)         |","     | Postcode lookup   | 7 days   | Rarely changes               |","     | Gas Safe          | 24 hours | Registration status           |","+    | Electrical Safety | 24 hours | Registration status           |","     | IMD data          | 90 days  | Annual update cycle          |","+    | NOMIS             | 30 days  | Monthly refresh               |","+    | Flood risk        | 1 hour   | Changes with weather          |"," "," 7.3 Rate Limiting (External APIs)","     Token bucket pattern per API source."]},{"oldStart":699,"oldLines":8,"newStart":754,"newLines":12,"lines":[" "," 7.4 Graceful Degradation","     All external APIs have simulated fallbacks.","-    If an API fails or times out, the system returns realistic simulated data","-    with a flag indicating the data source (live vs simulated).","+    If an API fails or times out:","+    - Timeout: 10 seconds per external request","+    - Retry: 1 retry with exponential backoff (2s)","+    - Return simulated fallback data","+    - Flag response: { source: 'live' | 'simulated' }","+    Simulated data is realistic, consistent (deterministic seeding), flagged."," "," "," 8. SECURITY ARCHITECTURE"]},{"oldStart":713,"oldLines":6,"newStart":772,"newLines":7,"lines":["     4. Frontend stores token, sends in Authorization header","     5. Express middleware verifies token via Firebase Admin SDK","     6. User context loaded (role, persona, permissions)","+    7. Fallback: X-Persona header for development (non-production)"," "," 8.2 Authorization (RBAC)","     10 default roles with hierarchical permissions:"]},{"oldStart":763,"oldLines":22,"newStart":823,"newLines":30,"lines":["      ├── Max instances: 10","      ├── Memory: 1Gi","      ├── CPU: 1","+     ├── Concurrency: 80","+     ├── Timeout: 300s","      ├── Port: 8080","      └── Secrets: 4 from Secret Manager"," "," 9.2 Docker Build (Multi-Stage)","-    Stage 1: Build client (Vite)","-    Stage 2: Build server (tsc)","-    Stage 3: Production (Node.js 20 slim, copy built assets, start server)","+    Stage 1: Build client (Vite) — node:20-slim base","+    Stage 2: Build server (tsc) — node:20-slim base","+    Stage 3: Production — copy built assets, start server (~500MB image)"," "," 9.3 Cloud Run Configuration","     Region: europe-west2 (London)","-    Concurrency: 80 requests/instance","-    Timeout: 300 seconds","     Auto-scaling based on request volume","     Min instances 0 for cost efficiency (cold start < 3s)"," ","+9.4 Key Infrastructure References","+    GCP Project ID: gen-lang-client-0878518473","+    GCP Project Number: 587984201316","+    Firebase Project: gen-lang-client-0146156913","+    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/","+                       cloud-run-source-deploy/socialhomes","+    Live URL: https://socialhomes-587984201316.europe-west2.run.app"," ","+"," 10. MONITORING & OBSERVABILITY"," ================================================================================"," "]},{"oldStart":800,"oldLines":18,"newStart":868,"newLines":18,"lines":[" 10.3 Structured Logging","     - JSON format for all logs","     - Request ID correlation (X-Request-ID)","-    - No sensitive data in logs","-    - Error logging with full context (non-PII)","+    - No sensitive data in logs (no PII)","+    - Error logging with full non-PII context"," "," 10.4 Admin Monitoring Dashboard","     GET /api/v1/admin/monitoring","     - Real-time metrics display","-    - Integration status overview","+    - Integration status overview (20 integrations)","     - Cache performance statistics","     - Error rate trending"," "," "," ================================================================================","   End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Yantra Works | 2026-02-18","+  Yantra Works | 2026-02-23"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer                          │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19         |\n    | Language           | TypeScript              | 5.9        |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | v4         |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | latest     |\n    | 3D Visualization   | Three.js (@react-three) | r128       |\n    | Maps               | Leaflet + React Leaflet | 1.9        |\n    | Charts             | Recharts + D3.js        | latest     |\n    | Icons              | Lucide React            | latest     |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2        |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4          |\n    | Language           | TypeScript              | 5.7        |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | latest     |\n    | Auth               | Firebase Admin SDK      | latest     |\n    | Security           | Helmet                  | latest     |\n    | Logging            | Morgan + structured     | latest     |\n    | Testing            | Vitest                  | latest     |\n    | Build              | tsc + tsx               | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details            |\n    |--------------------|-------------------------|--------------------|\n    | Hosting            | Google Cloud Run        | europe-west2       |\n    | Container Registry | Artifact Registry       | europe-west2       |\n    | Database           | Google Firestore        | Native mode        |\n    | Authentication     | Firebase Auth           | Google SSO + email |\n    | Secrets            | Secret Manager          | 4 secrets          |\n    | CI/CD              | Cloud Build             | Auto on git push   |\n    | Source Control      | GitHub                  | rajivpeter repo    |\n    | Monitoring         | Custom metrics + health | In-app             |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage           |\n    |--------------------|-------------------------|--------------------|\n    | E2E                | Selenium WebDriver      | 332 tests (99.7%)  |\n    | Unit               | Vitest                  | 66 tests           |\n    | Type Checking      | TypeScript (strict)     | 0 errors           |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point\n    ├── index.css                — Global styles + animations\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage\n    │   ├── briefing/            — BriefingPage\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage, etc.\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — Reusable components (12 files)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client, public data helpers\n    ├── contexts/                — Auth, User contexts\n    ├── utils/                   — Utility helpers\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within a BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API data caching, polling)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification\n    │   ├── error-handler.ts     — Structured JSON error handler\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 20 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical\n    │   ├── mock-services.ts     — 5 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet → CORS → Compression\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses\n    - No stack traces leaked in production\n    - Error logging with request ID correlation\n    - Graceful degradation for external API failures\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                     │\n                                     ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                             │\n    ┌─────────────────┐     ┌─────────────────┐     ┌───────▼─────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n      // See individual type schemas below\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root.\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (Unified)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    COMPLIANCE\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy data\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14 endpoints)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk vulnerability scan\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n\n    MOCK TIER 3 APIs\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry title\n\n    EXTERNAL DATA PROXY\n    GET    /api/v1/public-data/police/:postcode          — Police.uk crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Open-Meteo weather\n    GET    /api/v1/public-data/flood-risk/:postcode       — DEFRA flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcodes.io lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021 data\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour market\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNumber— Electrical verify\n\n    ADMIN\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    HEALTH\n    GET    /health                                        — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out, the system returns realistic simulated data\n    with a flag indicating the data source (live vs simulated).\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite)\n    Stage 2: Build server (tsc)\n    Stage 3: Production (Node.js 20 slim, copy built assets, start server)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Concurrency: 80 requests/instance\n    Timeout: 300 seconds\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs\n    - Error logging with full context (non-PII)\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-18\n================================================================================\n"},"sourceToolAssistantUUID":"f85e3085-9aa1-41b5-85d5-edec56dd11f7"}
{"parentUuid":"047caf0f-00da-4b54-8f81-06631f0b1380","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_012bE5ShnAFQuHzwwT17GfuL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01W9pX1yQsNrvqv6cvW8gGr6","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11214,"cache_read_input_tokens":105137,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11214},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVvzipY7R2cYnz1NNGD","type":"assistant","uuid":"21aca8c7-f4ae-4f1b-8e79-6c4ae2942637","timestamp":"2026-02-23T18:47:59.588Z"}
{"parentUuid":"21aca8c7-f4ae-4f1b-8e79-6c4ae2942637","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01W9pX1yQsNrvqv6cvW8gGr6","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"efe16e11-4ecf-4f90-be83-564ea1c7835c","timestamp":"2026-02-23T18:47:59.590Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"pending","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"21aca8c7-f4ae-4f1b-8e79-6c4ae2942637"}
{"parentUuid":"efe16e11-4ecf-4f90-be83-564ea1c7835c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_013Fv4bqSQeVDzxnbKZ5dUNB","type":"message","role":"assistant","content":[{"type":"text","text":"Now Doc3 — the API & Integration Requirements:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":116351,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVwfkL7ztidjRNq1xCZ","type":"assistant","uuid":"55718f60-4940-47d3-a2ea-144d1e29f1f6","timestamp":"2026-02-23T18:48:03.451Z"}
{"parentUuid":"55718f60-4940-47d3-a2ea-144d1e29f1f6","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_013Fv4bqSQeVDzxnbKZ5dUNB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017rRjCH63AX9snAEZwjMNnE","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           — List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  — Filter by category\n    GET  /api/v1/ai/notify/template/:id         — Single template detail\n    POST /api/v1/ai/notify/render               — Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-23\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":116351,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRVwfkL7ztidjRNq1xCZ","type":"assistant","uuid":"7fef53f8-bfe0-4ec9-9fc8-e5abe91c2c41","timestamp":"2026-02-23T18:50:26.336Z"}
{"parentUuid":"7fef53f8-bfe0-4ec9-9fc8-e5abe91c2c41","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017rRjCH63AX9snAEZwjMNnE","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt has been updated successfully."}]},"uuid":"3325b4a6-5791-46fa-b2be-bc67bb6fed97","timestamp":"2026-02-23T18:50:26.417Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           — List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  — Filter by category\n    GET  /api/v1/ai/notify/template/:id         — Single template detail\n    POST /api/v1/ai/notify/render               — Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-23\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc3 — SocialHomes.Ai API & Integration Requirements","-  Version: 2.0  |  Date: 2026-02-18","+  Version: 3.0  |  Date: 2026-02-23","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":139,"oldLines":7,"newStart":139,"newLines":6,"lines":["     - LSOA code and name (for IMD/Census/NOMIS)","     - Ward, parliamentary constituency","     - Local authority, region","-    - Country, European electoral region"," ","     Used By:","     - All location-dependent lookups"]},{"oldStart":205,"oldLines":7,"newStart":204,"newLines":6,"lines":[" 3.4 NOMIS — Labour Market Statistics","     Status: LIVE (with simulated fallback)","     Base URL: https://www.nomisweb.co.uk/api/v01","-    Documentation: https://www.nomisweb.co.uk/api/v01/help"," ","     Datasets Used:","     - NM_162_1 — JSA claimant count by age/sex"]},{"oldStart":233,"oldLines":9,"newStart":231,"newLines":6,"lines":["     Base URL: https://www.gassaferegister.co.uk/api","     Documentation: Restricted (via partnership application)"," ","-    Endpoint Pattern:","-    - GET /engineer/{registrationNumber}","-","     Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber","     Cache TTL: 24 hours","     Rate Limit: 100 req/hour"]},{"oldStart":248,"oldLines":7,"newStart":243,"newLines":7,"lines":["     - Registration number and expiry date"," ","     Used By:","-    - Repair detail page (contractor verification badge)","+    - Repair detail page (contractor verification badge — green)","     - Compliance management (contractor vetting)"," "," 3.6 Electrical Safety Register (NICEIC)"]},{"oldStart":256,"oldLines":9,"newStart":251,"newLines":6,"lines":["     Base URL: https://www.niceic.com/api","     Documentation: Via partnership application"," ","-    Endpoint Pattern:","-    - GET /contractor/{registrationNumber}","-","     Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber","     Cache TTL: 24 hours","     Rate Limit: 100 req/hour"]},{"oldStart":413,"oldLines":7,"newStart":405,"newLines":16,"lines":["     - Reports module (regulatory submissions)","     - Compliance management"," ","+4.9 NOMIS Labour Market (Extended)","+    Status: MOCK","+    Mock Function: mockLabourMarket(lsoaCode)","+    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode"," ","+    Used By:","+    - Neighbourhood Briefing (economic context)","+    - Benefits Engine (employment verification)","+","+"," 5. SEVEN KILLER DIFFERENTIATOR SERVICES"," ================================================================================"," "]},{"oldStart":566,"oldLines":7,"newStart":567,"newLines":7,"lines":[" ================================================================================"," "," 6.1 Overview","-    Service: server/src/services/govuk-notify.ts","+    Service: server/src/services/govuk-notify.ts (1,257 lines)","     Status: Template library defined (24 templates)","     Integration: Ready for GOV.UK Notify API key"," "]},{"oldStart":616,"oldLines":7,"newStart":617,"newLines":13,"lines":["     - Supports: ((tenant_name)), ((property_address)), ((case_ref)),","       ((amount)), ((date)), ((officer_name)), etc."," ","+6.4 API Endpoints","+    GET  /api/v1/ai/notify/templates           — List all 24 templates","+    GET  /api/v1/ai/notify/templates/:category  — Filter by category","+    GET  /api/v1/ai/notify/template/:id         — Single template detail","+    POST /api/v1/ai/notify/render               — Render with personalisation"," ","+"," 7. CACHING ARCHITECTURE"," ================================================================================"," "]},{"oldStart":650,"oldLines":7,"newStart":657,"newLines":7,"lines":["     - Automatic TTL enforcement on read","     - Manual cache invalidation via admin API","     - Cache hit rate tracked in metrics","-    - No cache warming (fetch-on-demand only)","+    - No cache warming (fetch-on-demand only — warming planned Phase 5)"," "," "," 8. RATE LIMITING"]},{"oldStart":697,"oldLines":12,"newStart":704,"newLines":12,"lines":["     - Consistent across requests (deterministic seeding)","     - Flagged clearly in the response"," ","-9.3 Circuit Breaker Pattern (Planned)","+9.3 Circuit Breaker Pattern (Planned — Phase 5)","     - Track failure count per API source","     - Open circuit after 5 consecutive failures","     - Half-open after 60 seconds (single test request)","     - Close circuit on successful test","-    Status: Not yet implemented (deferred)","+    Status: Designed, not yet implemented (task 5.2.5)"," "," "," 10. API SECURITY"]},{"oldStart":710,"oldLines":7,"newStart":717,"newLines":7,"lines":[" "," 10.1 Authentication","     All /api/v1/* routes require Firebase Bearer token.","-    Exception: /health (public health check)","+    Exception: /health (public health check), /api/v1/config (public)"," "," 10.2 Request Validation","     - JSON body limit: 1MB"]},{"oldStart":738,"oldLines":30,"newStart":745,"newLines":31,"lines":[" ","     | Integration           | Priority | Complexity | Description                     |","     |-----------------------|----------|------------|---------------------------------|","-    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |","-    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |","-    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |","-    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |","-    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |","-    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |","-    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |","-    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |","-    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |","-    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |","+    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |","+    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |","+    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |","+    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |","+    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |","+    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |","+    | GoCardless API (real) | P2       | M          | Real direct debit processing     |","+    | DocuSign API (real)   | P2       | M          | Real digital signing             |","+    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |","+    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |"," "," 11.2 Phase 6 — Enterprise Integrations (Future)"," ","     | Integration           | Priority | Complexity | Description                     |","     |-----------------------|----------|------------|---------------------------------|","-    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |","-    | Salesforce CRM        | P3       | High       | Tenant relationship management  |","-    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |","-    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |","-    | NHS Digital           | P3       | High       | Health data integration         |","-    | Companies House       | P3       | Low        | Contractor verification         |","+    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |","+    | Salesforce CRM        | P3       | H          | Tenant relationship management   |","+    | Power BI              | P3       | M          | Advanced analytics/dashboards    |","+    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |","+    | NHS Digital           | P3       | H          | Health data integration          |","+    | Companies House       | P3       | S          | Contractor verification          |","+    | Stripe/GoCardless     | P3       | M          | Online rent payment              |"," "," "," ================================================================================","   End of Doc3 — SocialHomes.Ai API & Integration Requirements","-  Yantra Works | 2026-02-18","+  Yantra Works | 2026-02-23"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 2.0  |  Date: 2026-02-18\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n    - Country, European electoral region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Endpoint Pattern:\n    - GET /engineer/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Endpoint Pattern:\n    - GET /contractor/{registrationNumber}\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Not yet implemented (deferred)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Switchee API (real)   | P2       | Medium     | Replace IoT mock with real API  |\n    | Aico API (real)       | P2       | Medium     | Real smoke/CO detector data     |\n    | DWP UC API (real)     | P1       | High       | Real UC verification (DWP ISP)  |\n    | GoCardless API (real) | P2       | Medium     | Real direct debit processing    |\n    | DocuSign API (real)   | P2       | Medium     | Real digital signing            |\n    | Plentific API (real)  | P3       | Medium     | Real contractor marketplace     |\n    | Vertex AI / Gemini    | P1       | High       | LLM for Yantra Assist           |\n    | Cloud Pub/Sub         | P2       | Medium     | Event-driven architecture       |\n    | WebSocket (Socket.io) | P2       | Medium     | Real-time notifications         |\n    | Stripe/GoCardless     | P3       | Medium     | Online rent payment             |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | Medium     | Email, calendar, Teams          |\n    | Salesforce CRM        | P3       | High       | Tenant relationship management  |\n    | Power BI              | P3       | Medium     | Advanced analytics/dashboards   |\n    | Twilio                | P3       | Medium     | SMS/WhatsApp messaging          |\n    | NHS Digital           | P3       | High       | Health data integration         |\n    | Companies House       | P3       | Low        | Contractor verification         |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-18\n================================================================================\n"},"sourceToolAssistantUUID":"7fef53f8-bfe0-4ec9-9fc8-e5abe91c2c41"}
{"parentUuid":"3325b4a6-5791-46fa-b2be-bc67bb6fed97","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_018BE2NHXaUYTZtgxz8SHRfc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018wC8qAMGpN8HNFevi1e2ao","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8279,"cache_read_input_tokens":116779,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8279},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRW8TmpA4pQs49HDWbLR","type":"assistant","uuid":"921988ee-f0c2-47a1-b50c-b9e95ba6509b","timestamp":"2026-02-23T18:50:34.365Z"}
{"parentUuid":"921988ee-f0c2-47a1-b50c-b9e95ba6509b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018wC8qAMGpN8HNFevi1e2ao","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"f213b399-710f-40d2-93fd-af92697de38d","timestamp":"2026-02-23T18:50:34.367Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"in_progress","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"921988ee-f0c2-47a1-b50c-b9e95ba6509b"}
{"parentUuid":"f213b399-710f-40d2-93fd-af92697de38d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_018wH23tid8QS5bzbzdAe1v5","type":"message","role":"assistant","content":[{"type":"text","text":"Now the EXECUTION-PLAN.md — I'll enhance Phase 5 with more granular tasks, clearer priorities, and better agent assignments:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":125058,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRW95LiPxnBPxCKNiEi2","type":"assistant","uuid":"c505329b-83ea-44e4-a8a0-c45643a03733","timestamp":"2026-02-23T18:50:38.038Z"}
{"parentUuid":"c505329b-83ea-44e4-a8a0-c45643a03733","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_018wH23tid8QS5bzbzdAe1v5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NH7NUJnWhGUwm8JvuHccGJ","name":"Write","input":{"file_path":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n| **Tester** | 7 | 0 | 3 | 4 | 0 |\n| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n\n**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n4. 5.2.4 (Notification dispatch — depends on WebSocket)\n5. 5.2.11 (AI communication drafting — depends on Vertex AI)\n6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n7. 5.3.2 (Notification bell — depends on WebSocket backend)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Frontend + Testing**\n9. 5.3.3–5.3.9 (Remaining frontend features — parallel)\n10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)\n11. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): DevOps + Polish**\n12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)\n13. 5.1.7 (API documentation — after all endpoints stable)\n14. Final regression testing and production deploy\n\n---\n\n**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":125058,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRW95LiPxnBPxCKNiEi2","type":"assistant","uuid":"8e86a1e9-a16c-4d87-8c69-c9c00972a0f5","timestamp":"2026-02-23T18:52:45.855Z"}
{"parentUuid":"8e86a1e9-a16c-4d87-8c69-c9c00972a0f5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NH7NUJnWhGUwm8JvuHccGJ","type":"tool_result","content":"The file /mnt/c/.REDACTED.md has been updated successfully."}]},"uuid":"5f728853-d2a2-4067-a25b-5bf5c19bacfc","timestamp":"2026-02-23T18:52:45.893Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n| **Tester** | 7 | 0 | 3 | 4 | 0 |\n| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n\n**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n4. 5.2.4 (Notification dispatch — depends on WebSocket)\n5. 5.2.11 (AI communication drafting — depends on Vertex AI)\n6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n7. 5.3.2 (Notification bell — depends on WebSocket backend)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Frontend + Testing**\n9. 5.3.3–5.3.9 (Remaining frontend features — parallel)\n10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)\n11. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): DevOps + Polish**\n12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)\n13. 5.1.7 (API documentation — after all endpoints stable)\n14. Final regression testing and production deploy\n\n---\n\n**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n","structuredPatch":[{"oldStart":1,"oldLines":7,"newStart":1,"newLines":7,"lines":[" # SocialHomes.Ai — Master Execution Plan"," "," > Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.","-> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent","+> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent"," > Studio: Yantra Works"," "," ---"]},{"oldStart":15,"oldLines":7,"newStart":15,"newLines":7,"lines":[" | 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |"," | 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |"," | 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |","-| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |","+| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |"," "," ---"," "]},{"oldStart":129,"oldLines":11,"newStart":129,"newLines":13,"lines":[" "," ---"," ","-## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)","+## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)"," "," ### Goal: Real AI, real-time features, advanced testing, production scaling"," ","-Phase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.","+Phase 5 is organized into 5 sub-phases matching the required agent structure:","+Project Setup & Architecture, Backend Development, Frontend Development,","+Testing & QA, and DevOps & Deployment."," "," ---"," "]},{"oldStart":141,"oldLines":13,"newStart":143,"newLines":14,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |","-| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |","-| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |","-| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |","-| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |","-| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |","-| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |","+| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |","+| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |","+| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |","+| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |","+| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |","+| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |","+| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |","+| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |"," "," ---"," "]},{"oldStart":155,"oldLines":16,"newStart":158,"newLines":18,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |","-| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |","-| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |","-| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |","-| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |","-| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |","-| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |","-| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |","-| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |","-| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |","+| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |","+| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |","+| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |","+| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |","+| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |","+| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |","+| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |","+| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |","+| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |","+| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |","+| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |","+| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |"," "," ---"," "]},{"oldStart":172,"oldLines":14,"newStart":177,"newLines":15,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |","-| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |","-| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |","-| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |","-| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |","-| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |","-| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |","-| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |","+| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |","+| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |","+| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |","+| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |","+| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |","+| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |","+| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |","+| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |","+| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |"," "," ---"," "]},{"oldStart":187,"oldLines":13,"newStart":193,"newLines":13,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |","-| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |","-| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |","-| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |","-| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |","-| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |","-| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |","+| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |","+| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |","+| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |","+| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |","+| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |","+| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |","+| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |"," "," ---"," "]},{"oldStart":201,"oldLines":14,"newStart":207,"newLines":14,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |","-| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |","-| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |","-| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |","-| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |","-| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |","-| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |","-| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |","+| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |","+| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |","+| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |","+| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |","+| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |","+| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |","+| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |","+| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |"," "," ---"," "]},{"oldStart":228,"oldLines":9,"newStart":234,"newLines":9,"lines":[" "," | Document | Location | Purpose |"," |----------|----------|---------|","-| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |","-| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |","-| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |","+| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |","+| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |","+| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |"," | Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |"," | Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |"," | Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |"]},{"oldStart":300,"oldLines":4,"newStart":306,"newLines":41,"lines":[" "," ---"," ","-**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**","+## PHASE 5 TASK SUMMARY BY AGENT","+","+| Agent | Total Tasks | P0 | P1 | P2 | P3 |","+|-------|-------------|----|----|----|----|","+| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |","+| **Fullstack** | 17 | 0 | 6 | 11 | 0 |","+| **Frontend** | 9 | 0 | 2 | 6 | 1 |","+| **Tester** | 7 | 0 | 3 | 4 | 0 |","+| **DevOps** | 8 | 0 | 3 | 5 | 0 |","+| **TOTAL** | **38** (DONE: 2, TODO: 36) |","+","+### Recommended Execution Order (Critical Path)","+","+**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**","+1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)","+2. 5.1.4 → 5.2.3 (WebSocket design → implementation)","+3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)","+","+**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**","+4. 5.2.4 (Notification dispatch — depends on WebSocket)","+5. 5.2.11 (AI communication drafting — depends on Vertex AI)","+6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)","+7. 5.3.2 (Notification bell — depends on WebSocket backend)","+8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)","+","+**Sprint 11 (Weeks 21-22): Frontend + Testing**","+9. 5.3.3–5.3.9 (Remaining frontend features — parallel)","+10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)","+11. 5.5.2 (Staging environment — enables test pipeline)","+","+**Sprint 12 (Weeks 23-24): DevOps + Polish**","+12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)","+13. 5.1.7 (API documentation — after all endpoints stable)","+14. Final regression testing and production deploy","+","+---","+","+**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**"]}],"originalFile":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 2.0 | 2026-02-18 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/32** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/32)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases (sprints) covering Project Setup & Architecture, Backend Development, Frontend Development, Testing & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Create comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) | P0 | L | BA | DONE |\n| 5.1.2 | Populate updated EXECUTION-PLAN.md with Phase 5 tasks | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints | P2 | L | BA | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist conversational AI | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware prompts per entity type | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) for real-time notifications | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — email, SMS, in-app via GOV.UK Notify + WebSocket | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — pre-fetch frequently accessed external data | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner for recurring jobs (compliance reminders, briefing refresh) | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case updates, bulk communications | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API with filtering, date range, export | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket integration | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page (channel, frequency, category toggles) | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle with Tailwind theme switching | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading for heavy pages | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations for tablet/phone views | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services (damp, crime, vulnerability, benefits, passport, briefing, notify) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes with mock servers | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — 100 concurrent users, measure P95 latency | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all pages | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — run unit + integration tests on every PR | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entities | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run (separate service) | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies (CPU/memory thresholds) | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts (error rate, latency, memory) | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy (Firestore scheduled exports to Cloud Storage) | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets (frontend build output) | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL (socialhomes.ai) | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation for incident response and recovery | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n**Plan Version 2.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-18**\n"},"sourceToolAssistantUUID":"8e86a1e9-a16c-4d87-8c69-c9c00972a0f5"}
{"parentUuid":"5f728853-d2a2-4067-a25b-5bf5c19bacfc","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01CqqBGf1nnASKLYrW7WW21N","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MeUhamhXSm7qk3SKCMb85v","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":7634,"cache_read_input_tokens":125486,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":7634},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWJkApqi1EPPcEuiWVX","type":"assistant","uuid":"b13d4242-6942-4aa2-9808-de8f00efec02","timestamp":"2026-02-23T18:52:53.990Z"}
{"parentUuid":"b13d4242-6942-4aa2-9808-de8f00efec02","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MeUhamhXSm7qk3SKCMb85v","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"65d69e14-dec6-42fe-a93c-ab1262627750","timestamp":"2026-02-23T18:52:53.993Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"pending","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"b13d4242-6942-4aa2-9808-de8f00efec02"}
{"parentUuid":"65d69e14-dec6-42fe-a93c-ab1262627750","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_017UNRPaRLbxVC3TFXSXX6Wp","type":"message","role":"assistant","content":[{"type":"text","text":"Now update SESSION-HISTORY.md:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":133120,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWKNT8xnutqwCg7VWYd","type":"assistant","uuid":"f83483e7-5273-46ed-9321-5eef1121832f","timestamp":"2026-02-23T18:52:57.185Z"}
{"parentUuid":"f83483e7-5273-46ed-9321-5eef1121832f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_017UNRPaRLbxVC3TFXSXX6Wp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NkhoGTRmjgQ2v8vKhTWU1x","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","offset":360},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":428,"cache_read_input_tokens":133120,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":428},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWKNT8xnutqwCg7VWYd","type":"assistant","uuid":"6b3c0813-4367-4942-b44f-76a3239e8c58","timestamp":"2026-02-23T18:52:57.808Z"}
{"parentUuid":"6b3c0813-4367-4942-b44f-76a3239e8c58","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NkhoGTRmjgQ2v8vKhTWU1x","type":"tool_result","content":"   360→\n   361→---\n   362→\n   363→## Session 8 — 2026-02-18 (Business Analyst Session)\n   364→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366→\n   367→### What happened:\n   368→\n   369→#### Task: Comprehensive Project Analysis & Specification Documents\n   370→\n   371→Performed full project analysis covering:\n   372→- All 73 frontend TypeScript files across 19 page directories\n   373→- All 43 backend TypeScript files (routes, services, middleware, models)\n   374→- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375→- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376→- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377→\n   378→#### Created 3 Specification Documents in `docs/requirements/`:\n   379→\n   380→1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   381→   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382→   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383→   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384→\n   385→2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   386→   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387→   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388→   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389→\n   390→3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   391→   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392→   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393→\n   394→#### Updated EXECUTION-PLAN.md (v2.0):\n   395→\n   396→- Preserved Phases 0–4 (all DONE) with progress counts\n   397→- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398→  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399→  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400→  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401→  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402→  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403→- Added deferred items cross-reference table\n   404→- Added Phase 5 metrics targets\n   405→- Updated plan summary table\n   406→\n   407→### Files Changed:\n   408→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411→- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n   412→- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n   413→\n   414→### Commits:\n   415→- (pending — awaiting user instruction to commit)\n   416→\n   417→### Decisions Taken:\n   418→- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n   419→- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420→- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421→- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n   422→- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423→\n   424→### Pending Work:\n   425→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n   426→- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427→"}]},"uuid":"383a5b39-6dfc-4ca9-98ef-37cf824cfa5d","timestamp":"2026-02-23T18:52:57.832Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n","numLines":68,"startLine":360,"totalLines":427}},"sourceToolAssistantUUID":"6b3c0813-4367-4942-b44f-76a3239e8c58"}
{"parentUuid":"383a5b39-6dfc-4ca9-98ef-37cf824cfa5d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01AVyCSK1mrBDSfQ8z7AXA8Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HX4YM3fzPR2Wn4hHeMApLM","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","old_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)","new_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1528,"cache_read_input_tokens":133548,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1528},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWKd8gmCVbST6mrsgiX","type":"assistant","uuid":"d9bf8e36-1a53-467c-87c7-22fcf4564971","timestamp":"2026-02-23T18:53:22.908Z"}
{"parentUuid":"d9bf8e36-1a53-467c-87c7-22fcf4564971","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HX4YM3fzPR2Wn4hHeMApLM","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md has been updated successfully."}]},"uuid":"74628524-767b-47a9-9b7a-a2382946b8b6","timestamp":"2026-02-23T18:53:22.956Z","toolUseResult":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","oldString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)","newString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix","originalFile":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n","structuredPatch":[{"oldStart":424,"oldLines":3,"newStart":424,"newLines":78,"lines":[" ### Pending Work:"," - Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)"," - Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)","+","+---","+","+## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)","+**Working directory:** `/mnt/c/.netapps/socialhomes`","+**Agent:** Business Analyst Agent (Claude Opus 4.6)","+","+### What happened:","+","+#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)","+","+Performed full project re-analysis and updated all specification documents to v3.0.","+This session built upon Session 8's initial docs with significantly enhanced content.","+","+#### Updated 3 Specification Documents in `docs/requirements/`:","+","+1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification","+   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)","+   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules","+     (added Global Search), Persona System (with AI focus per persona), AI-Native","+     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,","+     7 differentiators, AI-augmented workflows, signature interactions),","+     Data Model, UI Design (full colour palette, typography, component library),","+     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status","+   - Merged AI-native features spec into main Doc1 for single-source-of-truth","+","+2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture","+   - Enhanced with precise version numbers from package.json files","+   - Added request flow diagram, middleware pipeline detail","+   - Added accessibility implementation section","+   - Added Firestore security rules and indexes references","+   - Added infrastructure references (GCP project IDs, URLs)","+   - Added Entire.io to infrastructure table","+","+3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements","+   - Cleaned up and made consistent with Doc2 endpoint registry","+   - Added NOMIS Labour Market extended mock (4.9)","+   - Enhanced future roadmap with Phase 6 enterprise integrations","+   - Added GOV.UK Notify API endpoints section (6.4)","+","+#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):","+","+- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):","+  - 5.1.8: Firestore data migration strategy","+  - 5.2.11: AI communication drafting with Vertex AI","+  - 5.2.12: Tenant activity scoring","+  - 5.3.9: Real-time case status indicators","+  - (Renumbered existing tasks for consistency)","+- Added detailed task descriptions with specific implementation details","+- Added \"Phase 5 Task Summary by Agent\" section with counts per priority","+- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan","+- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)","+","+### Files Changed:","+- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)","+- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)","+- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)","+- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)","+- `SESSION-HISTORY.md` (UPDATED — added Session 9)","+","+### Commits:","+- (pending — awaiting user instruction to commit)","+","+### Decisions Taken:","+- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source","+- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis","+- Created sprint-by-sprint critical path execution order","+- Added agent task summary with priority breakdown","+- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)","+- Total Phase 5: 38 tasks (2 DONE, 36 TODO)","+","+### Pending Work:","+- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)","+- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)","+- Sprint 9 focus: Architecture decisions + backend foundation + CI fix"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"d9bf8e36-1a53-467c-87c7-22fcf4564971"}
{"parentUuid":"74628524-767b-47a9-9b7a-a2382946b8b6","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01T9LdHhzYoMYmPqC5GUxczV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MffMTBsPWmWTGVrq2KEDcp","name":"TodoWrite","input":{"todos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"completed","activeForm":"Updating SESSION-HISTORY.md"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1465,"cache_read_input_tokens":135076,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1465},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWMUcXgEeQ8T5LW2kRc","type":"assistant","uuid":"3d6f6eee-b50d-49e3-bbb0-0261a225446f","timestamp":"2026-02-23T18:53:28.062Z"}
{"parentUuid":"3d6f6eee-b50d-49e3-bbb0-0261a225446f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MffMTBsPWmWTGVrq2KEDcp","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"d90b7c6f-4e5e-47cf-be02-6248630542f9","timestamp":"2026-02-23T18:53:28.064Z","toolUseResult":{"oldTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md"}],"newTodos":[{"content":"Read existing root-level specification documents (Doc1, Doc2, Doc3) for reference","status":"completed","activeForm":"Reading existing specification documents"},{"content":"Read existing docs/requirements/ specification documents","status":"completed","activeForm":"Reading docs/requirements/ specifications"},{"content":"Read EXECUTION-PLAN.md and SESSION-HISTORY.md for current state","status":"completed","activeForm":"Reading execution plan and session history"},{"content":"Update Doc1-socialhomes-Base-Specification.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc1 Base Specification"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc2 Technical Architecture"},{"content":"Update Doc3-socialhomes-API-Requirements.txt in docs/requirements/","status":"completed","activeForm":"Updating Doc3 API Requirements"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with this session's work","status":"completed","activeForm":"Updating SESSION-HISTORY.md"}]},"sourceToolAssistantUUID":"3d6f6eee-b50d-49e3-bbb0-0261a225446f"}
{"parentUuid":"d90b7c6f-4e5e-47cf-be02-6248630542f9","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01Qv9aY3FRPpQQW96LHeosVk","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me send a notification to the user via Telegram:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":426,"cache_read_input_tokens":136541,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":426},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWMsoYLGSFru4q1vnVW","type":"assistant","uuid":"dbb6429d-349b-470d-9b04-b8a4369d372f","timestamp":"2026-02-23T18:53:32.127Z"}
{"parentUuid":"dbb6429d-349b-470d-9b04-b8a4369d372f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_01Qv9aY3FRPpQQW96LHeosVk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BX4da9xCimwE1idfvycBfn","name":"mcp__telegram__notify_user","input":{"chat_id":"socialhomes:8020560167","message":"✅ BA Agent — Specification Refresh Complete (v3.0)\n\n📄 Updated docs/requirements/:\n• Doc1 — Base Specification (expanded to 17 modules + full AI-native features)\n• Doc2 — Technical Architecture (precise versions, diagrams, a11y details)\n• Doc3 — API Requirements (20 integrations, 7 differentiators, future roadmap)\n\n📋 EXECUTION-PLAN.md v3.0:\n• Phase 5: 38 tasks (up from 32)\n• 6 new tasks added (migration strategy, AI drafting, activity scoring, etc.)\n• Critical path execution order with sprint-by-sprint plan\n• Agent summary: Fullstack 17, Frontend 9, Tester 7, DevOps 8, BA 3\n\n📝 SESSION-HISTORY.md updated with Session 9.\n\nReady for commit when you are."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":426,"cache_read_input_tokens":136541,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":426},"output_tokens":2,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWMsoYLGSFru4q1vnVW","type":"assistant","uuid":"de6039b2-b233-45e0-9b99-31341222f445","timestamp":"2026-02-23T18:53:36.977Z"}
{"parentUuid":"de6039b2-b233-45e0-9b99-31341222f445","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BX4da9xCimwE1idfvycBfn","type":"tool_result","content":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Specification Refresh Complete (v3.0)\n\n📄 Updated docs/requirements/:\n• Doc1 — Base Specification (expanded to 17 modules + full AI-native features)\n• Doc2 — Technical Architecture (precise versions, diagrams, a11y details)\n• Doc3 — API Requirements (20 integrations, 7 differentiators, future roadmap)\n\n📋 EXECUTION-PLAN.md v3.0:\n• Phase 5: 38 tasks (up from 32)\n• 6 new tasks added (migration strategy, AI drafting, activity scoring, etc.)\n• Critical path execution order with sprint-by-sprint plan\n• Agent summary: Fullstack 17, Frontend 9, Tester 7, DevOps 8, BA 3\n\n📝 SESSION-HISTORY.md updated with Session 9.\n\nReady for commit when you are.\""}]}]},"uuid":"0f2c413b-54d3-4e1d-a97b-d573a1ccd5ce","timestamp":"2026-02-23T18:53:37.102Z","toolUseResult":[{"type":"text","text":"Notification sent: \"✅ BA Agent — Specification Refresh Complete (v3.0)\n\n📄 Updated docs/requirements/:\n• Doc1 — Base Specification (expanded to 17 modules + full AI-native features)\n• Doc2 — Technical Architecture (precise versions, diagrams, a11y details)\n• Doc3 — API Requirements (20 integrations, 7 differentiators, future roadmap)\n\n📋 EXECUTION-PLAN.md v3.0:\n• Phase 5: 38 tasks (up from 32)\n• 6 new tasks added (migration strategy, AI drafting, activity scoring, etc.)\n• Critical path execution order with sprint-by-sprint plan\n• Agent summary: Fullstack 17, Frontend 9, Tester 7, DevOps 8, BA 3\n\n📝 SESSION-HISTORY.md updated with Session 9.\n\nReady for commit when you are.\""}],"sourceToolAssistantUUID":"de6039b2-b233-45e0-9b99-31341222f445"}
{"parentUuid":"0f2c413b-54d3-4e1d-a97b-d573a1ccd5ce","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"04e29004-abee-469c-be92-00aa04948dea","version":"2.1.50","gitBranch":"main","slug":"scalable-giggling-pearl","message":{"model":"claude-opus-4-6","id":"msg_013avgJhehKGVUkf4v8G964t","type":"message","role":"assistant","content":[{"type":"text","text":"All work is complete. Here's a summary of what was done:\n\n## ✅ Business Analyst Session Complete — v3.0 Specification Refresh\n\n### Documents Updated (all in `docs/requirements/`):\n\n**1. Doc1-socialhomes-Base-Specification.txt** (v3.0)\n- Expanded from 9 to 10 sections with significantly richer content\n- Merged AI-native features from root-level Doc2 into a single source of truth\n- 17 functional modules documented (added Global Search)\n- Full persona system with AI focus per role\n- Complete AI-native features: dynamic elements, action flow pattern, Yantra Assist, 8 prediction models, 7 killer differentiators, 5 AI-augmented workflows\n- Full UI design spec (colour palette, typography, component library)\n- Simulated data section with financial profiles and case volumes\n\n**2. Doc2-socialhomes-Technical-Architecture.txt** (v3.0)\n- Precise version numbers from actual package.json files\n- Request flow diagram added alongside architecture diagram\n- Accessibility implementation section documenting all WCAG AA measures\n- Infrastructure references (GCP project IDs, Firebase project, live URL)\n- Complete Firestore schemas with 9 collection definitions\n\n**3. Doc3-socialhomes-API-Requirements.txt** (v3.0)\n- 20 integrations across 3 tiers fully documented\n- GOV.UK Notify API endpoints section added\n- Future roadmap for Phase 5 and Phase 6 integrations\n\n### EXECUTION-PLAN.md (v3.0)\n- **38 Phase 5 tasks** (up from 32) across 5 sub-phases\n- 6 new tasks: Firestore migration strategy, AI communication drafting with Vertex AI, tenant activity scoring, real-time case status indicators, plus renumbering\n- **Critical path execution order** with 4-sprint plan\n- **Agent task summary**: Fullstack 17, Frontend 9, Tester 7, DevOps 8, BA 3\n- Dependency chains mapped (e.g., Vertex AI: design → implement → prompts)\n\n### SESSION-HISTORY.md\n- Session 9 logged with full change summary and decisions"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":541,"cache_read_input_tokens":136967,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":541},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYRWNX5e37oTNB48XCjT6","type":"assistant","uuid":"9ea8e1c8-cf5c-4216-91e9-92af2b8977cc","timestamp":"2026-02-23T18:53:48.225Z"}
{"type":"queue-operation","operation":"remove","timestamp":"2026-02-23T18:57:13.949Z","sessionId":"04e29004-abee-469c-be92-00aa04948dea"}
