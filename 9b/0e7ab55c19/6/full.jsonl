{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-25T15:03:54.551Z","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-25T15:03:54.553Z","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"e0842746-45af-401c-a548-42e3f1ef38ec","toolUseID":"e0842746-45af-401c-a548-42e3f1ef38ec","timestamp":"2026-02-25T15:03:53.042Z","uuid":"2ec8f47e-9a93-4604-acc3-44c99a81b173"}
{"parentUuid":"2ec8f47e-9a93-4604-acc3-44c99a81b173","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"af8f6a56-fdfc-47f0-9c36-d3cde49dff20","timestamp":"2026-02-25T15:03:54.582Z","permissionMode":"bypassPermissions"}
{"parentUuid":"af8f6a56-fdfc-47f0-9c36-d3cde49dff20","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01DdeuTr8ZX1KUqox9qovriR","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to analyze the \"socialhomes\" project and create comprehensive specification documents and an execution plan. Let me start by exploring the existing codebase, reading any existing documentation, and understanding the project structure.\n\nLet me begin by reading existing files and exploring the project structure in parallel.","signature":"Ev4DCkYICxgCKkCpsY6UIQ2I3+UcV8G0in3wt7i6MiQ1hWWxNFlXFAAg3ONJ3tT4A2F+NyAlmSHaGaRVg4gAkstrvw/MGL2P1nqxEgyxcSKTmtkLd9ac8yUaDM+eIpQXjWmYBng7DyIwqaQVhExa00XWdDCXw/YvrIqRJDaGdZcoisFkGBCXYmtMuhL5wqlhTNqXTugFmlafKuUCEMYeMS+rlQ4Y6VF4ztTNvu//iVw76qBY7j1ugTOMQqHNAG/7aq2DG37Q+rG2K4zKww9agS8/PNk4LUEAmMqV06ne7qD018uTd4Z5LptLZTmbF8HqsTfNDvzLrEWHao8udUKvw97m1ZB+WkWwhUJvY79KhZrwx0dRfASxFElwvov6BfF0ASOmgNQ3IzIP+CgmMhgQc0Wd9fI4N5rO0dCuc32nTfQczml6Ztko7Bm8NY+YBU2KOSX++M/jqmN2FkeZt0fIbYEeVtkAzzWIQhutPn/oW0/Ula4aBYgjC+Wns3GXxtF72lfZxYegzQR44hvLZ1FIyRGOpBpLIHdtxtRzR8VawJ8vB55fppAal35GHccsqrHIe4qeP7djePMUjliy2cCSjDKPfSTe5FP8jVvrCDngbfxGokDnKNmpHU+Mh7p2ZGCvN8b7BFLxADLwiO72SXHfmgcwSlZT2UMSUewJP3lzGuigGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1EdNa67JqYB9myqc5H","type":"assistant","uuid":"dd219cf6-6282-48e5-b85e-8937e58c0e91","timestamp":"2026-02-25T15:14:04.270Z"}
{"parentUuid":"dd219cf6-6282-48e5-b85e-8937e58c0e91","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01DdeuTr8ZX1KUqox9qovriR","type":"message","role":"assistant","content":[{"type":"text","text":"I'll start by thoroughly exploring the existing project to understand what's already built and what documentation exists. Let me read multiple files in parallel."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1EdNa67JqYB9myqc5H","type":"assistant","uuid":"be3ede6c-f366-46af-ab7b-6fa79897e036","timestamp":"2026-02-25T15:14:05.112Z"}
{"parentUuid":"be3ede6c-f366-46af-ab7b-6fa79897e036","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01DdeuTr8ZX1KUqox9qovriR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A6EP1mbLF9PL2vScWxUKLY","name":"Task","input":{"subagent_type":"Explore","description":"Explore socialhomes codebase structure","prompt":"Do a very thorough exploration of /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all folders, key files)\n2. What frameworks/libraries are used (check package.json files)\n3. All existing documentation files (*.md, *.txt, Doc1*, Doc2*, Doc3*, etc.)\n4. The database models/schemas (Firestore collections)\n5. API routes (server/src/routes/)\n6. Frontend pages (app/src/pages/)\n7. Shared components (app/src/components/)\n8. Any existing EXECUTION-PLAN.md or SESSION-HISTORY.md\n9. Configuration files (Dockerfile, cloudbuild.yaml, etc.)\n10. Any existing docs/requirements/ folder\n\nBe extremely thorough - read package.json files, route files, page components, data models, and any specification documents. I need a complete picture of the project."},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":8,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1EdNa67JqYB9myqc5H","type":"assistant","uuid":"abb99008-cd3b-432e-834d-1beec4987b9d","timestamp":"2026-02-25T15:14:09.799Z"}
{"parentUuid":"abb99008-cd3b-432e-834d-1beec4987b9d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A6EP1mbLF9PL2vScWxUKLY","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have a complete picture. Let me create a comprehensive summary report:\n\n---\n\n## COMPREHENSIVE PROJECT EXPLORATION: SocialHomes.Ai\n\nI've completed a thorough exploration of `/mnt/c/.netapps/socialhomes`. Here's your complete project picture:\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native housing management platform for UK social housing providers (housing associations). Built with React 19 + Express + Firestore on Google Cloud Run (europe-west2).\n\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **Status:** 4 Phases DONE (Infrastructure, Foundation, Intelligence, Enrichment, Completion) + Phase 5 Evolution in progress\n- **Test Results:** 330/331 tests passing (99.7%)\n\n---\n\n### 2. FULL DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                           # React Frontend (Vite)\n│   ├── src/\n│   │   ├── pages/                 # 31 page components across 19 modules\n│   │   │   ├── admin/             # Admin Dashboard, Integrations\n│   │   │   ├── ai-centre/         # AI Insights, Predictions, Assistant\n│   │   │   ├── allocations/       # Property Allocations\n│   │   │   ├── asb/               # Anti-Social Behaviour cases\n│   │   │   ├── auth/              # Login/Firebase Auth\n│   │   │   ├── briefing/          # Daily briefing & intelligence\n│   │   │   ├── communications/    # Email/SMS/notifications\n│   │   │   ├── complaints/        # Complaint tracking (2-stage)\n│   │   │   ├── compliance/        # Regulatory (Big 6) compliance\n│   │   │   ├── dashboard/         # Executive KPIs & analytics\n│   │   │   ├── explore/           # Geographic map view (Leaflet)\n│   │   │   ├── properties/        # Property portfolio (75 properties)\n│   │   │   ├── rent/              # Rent management & arrears\n│   │   │   ├── repairs/           # Repair tracking (Awaab's Law)\n│   │   │   ├── reports/           # Dynamic reports + TSM reporting\n│   │   │   ├── search/            # Global search across all data\n│   │   │   ├── tenancies/         # Tenancy management (68 tenants)\n│   │   │   └── tenant-portal/     # Self-service tenant portal\n│   │   ├── components/\n│   │   │   ├── layout/            # Shell: Header, Sidebar, Layout, Breadcrumbs, YantraAssist\n│   │   │   └── shared/            # 12 reusable components (ActionModal, Panels, Maps, etc.)\n│   │   ├── services/\n│   │   │   ├── api-client.ts      # API request layer with Firestore timestamp sanitization\n│   │   │   └── firebase.ts        # Firebase Auth + config\n│   │   ├── hooks/                 # 3 custom React hooks (useApi, useEntityIntelligence, usePersonaScope)\n│   │   ├── contexts/              # React Context providers\n│   │   ├── utils/                 # Helper functions (safeText, formatting, etc.)\n│   │   ├── types/                 # TypeScript interfaces\n│   │   └── assets/                # SVGs, icons\n│   ├── dist/                      # Built output (3.0 MB)\n│   ├── package.json               # React 19, TypeScript 5.9, Tailwind 4, Vite 7\n│   └── vite.config.ts             # Vite configuration\n│\n├── server/                        # Express Backend (Node 20)\n│   ├── src/\n│   │   ├── routes/                # 16 API route files (50+ endpoints)\n│   │   │   ├── admin.ts           # Admin operations (integrations, monitoring)\n│   │   │   ├── ai.ts              # AI services (10 endpoints) + drafting + chat\n│   │   │   ├── auth.ts            # Firebase token verification\n│   │   │   ├── booking.ts         # Viewing bookings\n│   │   │   ├── briefing.ts        # Daily estate briefings\n│   │   │   ├── cases.ts           # Unified case management (CRUD)\n│   │   │   ├── compliance.ts      # Regulatory reporting\n│   │   │   ├── explore.ts         # Geographic hierarchy\n│   │   │   ├── export.ts          # Data exports (TSM, HACT)\n│   │   │   ├── lettings.ts        # Lettings workflow\n│   │   │   ├── properties.ts      # Property CRUD + filters\n│   │   │   ├── public-data.ts     # Census, NOMIS, Gas Safe, Electoral APIs\n│   │   │   ├── rent.ts            # Rent transactions + dashboards\n│   │   │   ├── reports.ts         # Dynamic reporting\n│   │   │   └── tenants.ts         # Tenant CRUD + activities + cases\n│   │   ├── services/              # 18 backend services\n│   │   │   ├── external-api.ts    # Shared cache, rate limiting, audit logging\n│   │   │   ├── firestore.ts       # Firestore client + query helpers\n│   │   │   ├── firebase-admin.ts  # Firebase Admin SDK\n│   │   │   ├── damp-prediction.ts # 5-factor weighted damp algorithm\n│   │   │   ├── crime-context.ts   # Police data + ASB correlation\n│   │   │   ├── vulnerability-detection.ts # 7-factor tenant vulnerability scoring\n│   │   │   ├── benefits-engine.ts # UK benefit rules (UC, PIP, AA, Pension Credit)\n│   │   │   ├── property-passport.ts # Multi-source property aggregation\n│   │   │   ├── neighbourhood-briefing.ts # Per-estate daily intelligence\n│   │   │   ├── govuk-notify.ts    # 24 notification templates across 7 categories\n│   │   │   ├── census-nomis.ts    # Census 2021 + labour market data\n│   │   │   ├── mock-services.ts   # 5 mock Tier 3 APIs (repairs, regulatory, signing, referencing, land registry)\n│   │   │   ├── monitoring.ts      # Metrics singleton (requests, latency, cache stats)\n│   │   │   ├── seed.ts + seed-data.ts # Test data generation\n│   │   │   └── hact-export.ts     # HACT data export format\n│   │   ├── middleware/\n│   │   │   ├── auth.ts            # Firebase JWT verification + persona extraction\n│   │   │   ├── rate-limiter.ts    # 4-tier rate limiting (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n│   │   │   ├── metrics.ts         # Request metrics collection\n│   │   │   └── error-handler.ts   # Structured JSON error responses\n│   │   ├── models/\n│   │   │   └── firestore-schemas.ts # 12 TypeScript interfaces for all Firestore documents\n│   │   ├── scripts/\n│   │   │   └── seed-imd.ts        # Deprivation index data loader\n│   │   ├── index.ts               # Express server setup, routing, middleware\n│   │   └── types.ts               # Global TypeScript types\n│   ├── dist/                      # Built output (968 KB)\n│   ├── package.json               # Express, Firebase Admin, TypeScript 5.7\n│   └── tsconfig.json              # TypeScript configuration\n│\n├── docs/requirements/             # Specification documents (v3.0)\n│   ├── Doc1-socialhomes-Base-Specification.txt\n│   ├── Doc2-socialhomes-Technical-Architecture.txt\n│   └── Doc3-socialhomes-API-Requirements.txt\n│\n├── Dockerfile                     # Multi-stage Docker build (Node 20 slim)\n├── cloudbuild.yaml                # Google Cloud Build CI/CD pipeline (NEEDS FIX: wrong Artifact Registry path)\n├── firestore.rules                # Security rules (persona-based access control)\n├── firestore.indexes.json         # 17 composite indexes for query optimization\n│\n├── CLAUDE.md                      # Project instructions for Claude Code\n├── DEV-FIX-LIST.md                # Bug tracker (all 99.7% resolved)\n├── DEVOPS.md                      # Deployment & infrastructure guide\n├── EXECUTION-PLAN.md              # Master execution plan (v3.0, Phase 0-5)\n├── SESSION-HISTORY.md             # Persistent session history (9 sessions)\n├── Doc1-SocialHomesAi-Base-Specification.txt  # Original spec (root)\n├── Doc2-SocialHomesAi-AI-Native-Features.txt  # Original AI spec (root)\n├── Doc3-Public-API-Integration-Requirements.txt # Original API requirements (root, 2,333 lines)\n├── Doc4-UI-UX-Audit-Build-Guide.md # Frontend audit guide (v1.0)\n│\n├── .claude/                       # Claude settings\n├── .entire/                       # Entire.io session tracking\n├── .mission-control/              # Mission Control agent config\n├── tests/                         # Selenium test suites + screenshots\n└── UK Housing Data Standard Version 3.5/ # Reference data (XLSX, JSON, XML)\n```\n\n**Code Statistics:**\n- Frontend (TypeScript/TSX): 13,395 lines\n- Backend (TypeScript): 10,457 lines\n- Total: ~23,852 lines\n\n---\n\n### 3. TECHNOLOGY STACK\n\n#### Frontend (React 19)\n```\nReact 19.2.0              UI framework\nTypeScript 5.9            Type safety\nVite 7.2.4                Build tool (dev/prod)\nTailwind CSS 4.1          Utility-first styling (dark theme)\nReact Router 6.30         Client-side routing\nFirebase 12.9.0           Auth + Firestore\nReact Query 5.90          Data fetching + caching\nRecharts 3.7              Business charts\nD3.js 7.9                 Advanced visualizations\nLeaflet 1.9.4 + React-Leaflet 5  Geographic maps\nThree.js 0.182 + React Three Fiber  3D visualizations\nLucide React 0.563        Icon system\ndate-fns 4.1              Date/time utilities\n```\n\n#### Backend (Express + Node 20)\n```\nExpress 4.21.2            HTTP server\nTypeScript 5.7            Type safety\nFirebase Admin 13.6.1     Firestore backend\nGoogle Cloud Firestore 7.11  Database\nHelmet 8.1                Security headers\nMorgan 1.10               Logging\nCORS 2.8.5                Cross-origin requests\nCompression 1.8           Gzip compression\ntsx 4.19                  TypeScript executor\nvitest 4.0                Unit testing framework\n```\n\n#### Infrastructure\n```\nGoogle Cloud Run          Serverless hosting (europe-west2)\nCloud Firestore           NoSQL database (live data: 460+ docs)\nCloud Secret Manager      Secrets storage\nArtifact Registry         Docker image registry\nCloud Build               CI/CD pipeline\nDocker                    Containerization (multi-stage)\nNode.js 20.17.0           Runtime\n```\n\n---\n\n### 4. API ROUTES (50+ Endpoints)\n\n**Authentication:**\n- `POST /api/v1/auth/verify` — Firebase JWT verification\n\n**Properties:**\n- `GET /api/v1/properties` (filters: regionId, estateId, blockId, type, isVoid, limit)\n- `GET /api/v1/properties/:id`\n- `PATCH /api/v1/properties/:id`\n- `GET /api/v1/properties/available`\n\n**Tenants:**\n- `GET /api/v1/tenants` (filters)\n- `GET /api/v1/tenants/:id`\n- `GET /api/v1/tenants/:id/activities`\n- `GET /api/v1/tenants/:id/cases`\n- `PATCH /api/v1/tenants/:id`\n\n**Cases (Unified):**\n- `GET /api/v1/cases` (filters: type, status, handler, priority)\n- `GET /api/v1/cases/:id`\n- `POST /api/v1/cases` (create)\n- `PATCH /api/v1/cases/:id` (update)\n- `GET /api/v1/cases/:id/activities`\n\n**AI Differentiator Services:**\n- `GET /api/v1/ai/damp-risk/:propertyId` — Predictive damp intelligence\n- `GET /api/v1/ai/damp-risk/estate/:estateId`\n- `GET /api/v1/ai/crime-context/:estateId` — Live crime context\n- `GET /api/v1/ai/crime-context/case/:caseId`\n- `GET /api/v1/ai/vulnerability/:tenantId` — Vulnerability detection\n- `POST /api/v1/ai/vulnerability/scan`\n- `GET /api/v1/ai/benefits-check/:tenantId` — Benefits entitlement engine\n- `GET /api/v1/ai/property-passport/:propertyId` — Property aggregation\n- `GET /api/v1/ai/briefing/:estateId` — AI neighbourhood briefing\n- `POST /api/v1/ai/draft-communication` — Draft communications\n- `POST /api/v1/ai/chat` — Conversational AI\n\n**GOV.UK Notify:**\n- `GET /api/v1/ai/notify/templates`\n- `GET /api/v1/ai/notify/templates/:category`\n- `GET /api/v1/ai/notify/template/:id`\n- `POST /api/v1/ai/notify/render`\n\n**Public Data APIs:**\n- `GET /api/v1/public-data/census/:lsoaCode` — Census 2021\n- `GET /api/v1/public-data/nomis/:lsoaCode` — Labour market stats\n- `GET /api/v1/public-data/gas-safe/:registrationNumber`\n- `GET /api/v1/public-data/electrical-safety/:registrationNumber`\n\n**Briefing & Insights:**\n- `GET /api/v1/briefing` — Estate briefing\n\n**Compliance:**\n- `GET /api/v1/compliance/overview` — Big 6 regulatory status\n\n**Rent & Arrears:**\n- `GET /api/v1/rent/dashboard`\n- `GET /api/v1/rent/transactions/:tenantId`\n\n**Reports:**\n- `GET /api/v1/reports/tsm` — Tenancy Services Manager report\n- `GET /api/v1/reports/regulatory` — Regulatory returns\n\n**Explore (Geographic):**\n- `GET /api/v1/explore/hierarchy` — Region → LA → Estate → Block → Property\n- `GET /api/v1/explore/regions`\n- `GET /api/v1/explore/estates/:id`\n- `GET /api/v1/explore/blocks/:id`\n\n**Admin:**\n- `GET /api/v1/admin/integrations` — Integration status\n- `POST /api/v1/admin/integrations/:id/toggle`\n- `POST /api/v1/admin/integrations/:id/test`\n- `GET /api/v1/admin/monitoring` — System metrics\n\n**Mock Tier 3 Services:**\n- `GET /api/v1/ai/mock/uc-verification/:tenantId` — DWP Universal Credit\n- `GET /api/v1/ai/mock/iot-sensors/:propertyId` — Switchee/Aico sensors\n- `GET /api/v1/ai/mock/direct-debit/:tenantId` — GoCardless\n- `GET /api/v1/ai/mock/labour-market/:lsoaCode` — NOMIS\n- `GET /api/v1/ai/mock/repairs-marketplace/:caseId` — Plentific/Fixflo\n- `GET /api/v1/ai/mock/regulatory/:type` — RSH/CORE/Ombudsman\n- `GET /api/v1/ai/mock/signing/:documentType` — DocuSign\n- `GET /api/v1/ai/mock/referencing/:applicantId` — Experian/TransUnion\n- `GET /api/v1/ai/mock/land-registry/:propertyId`\n\n**Built-in Endpoints:**\n- `GET /health` — Health check (Firestore connectivity, memory, uptime)\n- `GET /api/v1/config` — Frontend configuration (Firebase, demo credentials)\n\n---\n\n### 5. FIRESTORE DATABASE SCHEMA (12 Collections)\n\n**Geography (Hierarchical):**\n- `organisations` — Housing association metadata\n- `regions` — Geographic regions (5 seeded)\n- `localAuthorities` — Local authority areas\n- `estates` — Housing estates (5 seeded)\n- `blocks` — Buildings within estates (8 seeded)\n\n**Core Entities:**\n- `properties` — Housing units (75 seeded, all types: flat, bungalow, house, etc.)\n- `tenants` — Residents (68 seeded with vulnerability flags, UC status, arrears risk)\n\n**Case Management (Unified):**\n- `cases` — All cases (Repairs: 200, Complaints: 34, ASB: 12, Damp: ~50 seeded)\n  - Types: repair, complaint, asb, damp-mould, financial\n  - Awaab's Law compliance tracking for damp cases\n  - 2-stage complaint process with deadlines\n  - SLA tracking with breach status\n\n**Supporting Collections:**\n- `activities` — Notes, contact logs, timeline events (linked to cases/tenants)\n- `communications` — Email/SMS templates, sending history\n- `rentTransactions` — Payment history, arrears tracking\n- `auditLog` — Change tracking (all API calls logged)\n- `users` — Staff directory (persona-scoped)\n- `notifications` — In-app notification queue\n- `voidProperties` — Vacant properties tracking\n- `applicants` — Prospective tenants for lettings\n- `tsmMeasures` — Tenancy Services Manager metrics\n- `externalDataCache` — Cache for external APIs (postcodes.io, police.uk, DEFRA, etc.)\n- `hactCodes` — HACT data standard reference codes\n\n**Indexes:** 17 composite indexes for efficient filtering (type+status, estateId+type, arrearsRisk, etc.)\n\n---\n\n### 6. DATA MODELS (Core Types)\n\nSee `/mnt/c/.netapps/socialhomes/server/src/models/firestore-schemas.ts` (262 lines):\n\n**PropertyDoc:**\n- Identity: id, uprn, address, postcode, coordinates (lat/lng)\n- Geography: blockId, estateId, localAuthorityId, regionId\n- Housing: type, bedrooms, floor, floorArea, heatingType, tenureType\n- Compliance: epc, gasSafety, eicr, asbestos, smokeAlarms, coAlarms, boiler\n- Financial: weeklyRent, serviceCharge, dampRisk (0-100 score)\n- Status: isVoid, voidSince, currentTenancyId\n\n**TenantDoc:**\n- Identity: id, title, firstName, lastName, dob, email, phone, mobile\n- Tenancy: propertyId, tenancyId, tenancyStartDate, tenancyType, tenancyStatus\n- Household: household array, emergencyContact\n- Management: assignedOfficer, vulnerabilityFlags, communicationPreference\n- Financial: ucStatus, paymentMethod, rentBalance, weeklyCharge, arrearsRisk (0-100)\n- Engagement: lastContact, contactCount30Days\n\n**CaseDoc:**\n- Universal: id, reference, type, tenantId, propertyId, status, priority, handler, createdDate, daysOpen, slaStatus\n- Repair-specific: sorCode, trade, operative, appointmentDate, completionDate, cost, firstTimeFix, awaabsLaw tracking\n- Complaint-specific: stage (1-2), category, deadlines, findings, compensation, learningActions, ombudsmanEscalation\n- ASB-specific: severity, escalationStage, evidenceCount, multiAgencyPanel, communityTrigger\n- Damp-specific: hazardClassification, dampRiskScore, cause, linkedRepairs\n- Financial-specific: arrearsAmount, arrearsReason, paymentArrangement, preActionChecklist\n\n---\n\n### 7. FRONTEND PAGES (31 Total)\n\n**Dashboard & Navigation:**\n- `/dashboard` — Executive KPIs (properties, tenancies, repairs, compliance, arrears, voids), charts, activity feed\n- `/briefing` — Daily intelligence, estate briefing, compliance snapshot\n- `/search` — Global full-text search across all entities\n\n**Core Modules:**\n- `/properties` & `/properties/:id` — Portfolio view + detail (map, EPC, rent, compliance, damp intelligence panel)\n- `/tenancies` & `/tenancies/:id` — 68 tenants + detail (vulnerability panel, benefits panel, activities, cases)\n- `/repairs` & `/repairs/:id` — 200 repairs + detail (Awaab's Law compliance, appointment booking, SLA tracking, AI estimates)\n- `/complaints` & `/complaints/:id` — 34 complaints + detail (2-stage process, deadlines, ombudsman escalation, timeline)\n- `/asb` & `/asb/:id` — Anti-social behaviour cases + detail\n- `/explore` — Interactive geographic map (Leaflet/OSM) with data layers (crime, damp, compliance toggles)\n\n**Specialized Features:**\n- `/ai-centre` — AI Insights (Predictions tab, Assistant tab, Differentiators scan)\n- `/briefing` — Neighbourhood briefing with estate selector + compliance overview\n- `/compliance` — Big 6 regulatory tracking (Awaab's Law, Fire Safety, Asbestos, Legionella, Gas Safety, Electrical, Lifts)\n- `/rent` — Rent dashboard, UC tracking, worklist, arrears management\n- `/communications` — Message templates, send history, AI analysis\n- `/reports` — Dynamic reporting (27 reports), TSM reporting\n- `/admin` — 7 sub-pages: General, Integrations, Settings, Users, Audit, Compliance, Performance\n- `/allocations` — Void property allocations workflow\n- `/tenant-portal` — Self-service tenant interface\n- `/auth/login` — Firebase email/Google sign-in with demo credentials\n\n**Supporting Pages:**\n- `/properties/viewing-booking` — Viewing appointment booking\n- `/properties/applications` — Tenant application processing\n- `/shared/coming-soon` — Placeholder pages\n\n---\n\n### 8. SHARED COMPONENTS (12 Components)\n\n**Layout Components:**\n- `Header.tsx` — Logo, org name, search, persona dropdown, notifications, Yantra Assist button\n- `Sidebar.tsx` — 5 sections (NAVIGATE, MANAGE, COMMUNICATE, ANALYSE, CONFIGURE), 14 nav links, badges for case counts\n- `Layout.tsx` — App shell with header + sidebar + main content + YantraAssist panel\n- `Breadcrumbs.tsx` — Auto-generated from URL path with home link\n\n**Panels & Cards:**\n- `DampIntelligencePanel.tsx` — 5-factor damp prediction score with factor breakdown bar chart\n- `VulnerabilityPanel.tsx` — 7-factor tenant vulnerability assessment (deprivation, arrears, health, isolation, age, dependents, UC)\n- `BenefitsPanel.tsx` — Benefits entitlement list with unclaimed amounts and status icons\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards (Weather, Crime, Damp, Compliance, Vacancies, Income) + briefing text\n- `KpiCard.tsx` — Key performance indicator card with metric, value, trend, sparkline\n- `PropertyMap.tsx` — Leaflet map for property/estate visualization\n\n**Interaction Components:**\n- `ActionModal.tsx` — Modal dialog with form validation, WCAG AA compliance (focus trap, Escape key, ARIA attributes), inline error display\n- `AiActionCard.tsx` — AI-generated action card with icon, title, description, call-to-action\n- `StatusPill.tsx` — Status badge (compliant, warning, critical, info, AI, void)\n- `CountdownTimer.tsx` — Large monospace countdown (green → peach → garnet → pulsing when overdue)\n- `HelpDrawer.tsx` — Full-screen help system with table of contents, 20+ topic sections, related guides, search\n- `ProtectedRoute.tsx` — Auth guard, redirects to /login if not authenticated, checks persona\n\n**YantraAssist (AI Companion):**\n- `YantraAssist.tsx` — Slide-in panel (320px from right) with context-aware content, chat interface, urgency sections\n\n---\n\n### 9. HOOKS (3 Custom React Hooks)\n\n**`useApi.ts`:**\n- Encapsulates API calls with React Query\n- Manages loading, error, data states\n- Provides 30+ convenience methods (propertiesApi, tenantsApi, casesApi, aiApi, etc.)\n\n**`useEntityIntelligence.ts`:**\n- Fetches AI predictions for properties, tenants, cases\n- Caches results to reduce API calls\n- Returns damp risk, vulnerability score, benefits, briefing, property passport\n\n**`usePersonaScope.ts`:**\n- Manages persona context (COO, Head of Housing, Manager, Housing Officer, Operative)\n- Controls data visibility + feature access based on permission level\n- Persists persona to localStorage for session continuity\n\n---\n\n### 10. AUTHENTICATION & PERSONAS\n\n**5 Personas (Role-Based):**\n1. **COO** — Organisation-wide view (all regions, all data, admin functions)\n2. **Head of Housing** — Regional oversight (1+ regions, all estates, analytics, compliance)\n3. **Housing Manager** — Estate/block management (assigned estates, frontline cases, planning)\n4. **Housing Officer** — Frontline casework (assigned cases, tenant interaction, repairs, compliance)\n5. **Repairs Operative** — Job-level repairs (assigned repairs, appointment scheduling, completion)\n\n**Auth Method:**\n- Firebase Authentication (email + password, Google sign-in)\n- Demo User: `demo@socialhomes.ai` / `SocialHomes2026!`\n- JWT token passed in `Authorization: Bearer` header\n- Fallback to `X-Persona` header for persona identification\n- Firestore security rules enforce persona-based access\n\n---\n\n### 11. AI FEATURES & SERVICES (7 Killer Differentiators)\n\n**Backend Services (in `/server/src/services/`):**\n\n1. **Damp Prediction (`damp-prediction.ts`):**\n   - 5-factor weighted algorithm\n   - Weights: weather (0.25), building (0.25), history (0.20), sensor (0.20), occupancy (0.10)\n   - Output: 0-100 risk score + factor breakdown\n\n2. **Crime Context (`crime-context.ts`):**\n   - Police API data integration (street-level crime)\n   - Correlation with internal ASB cases\n   - Hotspot analysis per estate\n\n3. **Vulnerability Detection (`vulnerability-detection.ts`):**\n   - 7-factor tenant scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n   - Flags: vulnerable, at-risk, high-priority\n   - Output: 0-100 vulnerability score\n\n4. **Benefits Engine (`benefits-engine.ts`):**\n   - UK 2025/26 benefit rules (Universal Credit, PIP, Attendance Allowance, Pension Credit, JSA, ESA, HB)\n   - Entitlement checking\n   - Unclaimed benefits identification\n\n5. **Property Passport (`property-passport.ts`):**\n   - Multi-source aggregation: property data + compliance + crime + damp + demographics\n   - Single 360-degree property dossier\n\n6. **Neighbourhood Briefing (`neighbourhood-briefing.ts`):**\n   - Per-estate daily intelligence\n   - Combines: weather, crime, damp cases, compliance, void properties, income trends\n   - Generates text summary for officers\n\n7. **GOV.UK Notify (`govuk-notify.ts`):**\n   - 24 email/SMS templates across 7 categories:\n     - Rent Arrears (3 templates)\n     - Repairs (3 templates)\n     - ASB (3 templates)\n     - Compliance (3 templates)\n     - Tenancy (3 templates)\n     - Damp & Mould (3 templates)\n     - General (3 templates)\n   - Template rendering with `((field))` placeholder substitution\n\n---\n\n### 12. EXTERNAL API INTEGRATIONS (30+ APIs)\n\n**Tier 1 — Free, No Registration (3 live):**\n- `postcodes.io` — Postcode lookup, LSOA, lat/long\n- `uprn.uk` (Open UPRN) — UPRN lookup\n- `data.police.uk` — Street-level crime, ASB data\n- `open-meteo.com` — Weather (hourly + historical)\n- `data.gov.uk` (DEFRA) — Flood warnings per property\n\n**Tier 2 — Registration Required (6 live):**\n- Census 2021 (ONS via NOMIS) — Demographics, housing stock\n- NOMIS Labour Market (NM_162_1, NM_17_5) — Employment, skills\n- Gas Safe Register API — Contractor verification\n- Electrical Safety Register — NICEIC/ECA verification\n- Land Registry API — Title deeds, freehold/leasehold, price paid\n- DWP Universal Credit (mock) — Benefit verification\n\n**Tier 3 — Mock Services (8 mock endpoints for demo):**\n- Switchee/Aico IoT sensors\n- GoCardless direct debit\n- Plentific/Fixflo repairs marketplace\n- RSH/CORE/Ombudsman regulatory submissions\n- DocuSign digital signing\n- Experian/TransUnion referencing\n- NOMIS labour market stats (mock extension)\n\n**Infrastructure:**\n- Caching: externalDataCache Firestore collection with TTL management (cache-through pattern)\n- Rate limiting: In-memory token bucket (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Audit logging: Every external API call logged to auditLog collection\n\n---\n\n### 13. CONFIGURATION FILES\n\n**`cloudbuild.yaml`:** Google Cloud Build CI/CD pipeline\n- **ISSUE:** Pushes to `europe-west2-docker.pkg.dev/$PROJECT_ID/socialhomes/app` but actual repo is `cloud-run-source-deploy/socialhomes`\n- Deploys to Cloud Run region europe-west2\n- Sets env vars + secrets from Secret Manager\n\n**`Dockerfile`:** Multi-stage Docker build\n- Stage 1: Build React client (Vite)\n- Stage 2: Build Express server (TypeScript)\n- Stage 3: Production runtime (Node 20 slim, combines both)\n- Exposes port 8080\n\n**`firestore.rules`:** Firestore security rules\n- Persona-based access control (functions: isAuthenticated, hasPersona, isManager, isAdmin)\n- Collections: organisations, regions, estates, properties, tenants, cases, activities, communications, rentTransactions, users, auditLog, notifications, voidProperties, applicants, tsmMeasures\n\n**`firestore.indexes.json`:** 17 composite indexes\n- Optimizes queries: type+status, type+handler, estateId+type, tenantId+date, etc.\n\n---\n\n### 14. DOCUMENTATION FILES\n\n**Specification Documents (v3.0, in `/docs/requirements/`):**\n- `Doc1-socialhomes-Base-Specification.txt` (35,991 bytes) — Product overview, 17 modules, personas, AI features, data model, UI design, regulatory compliance, non-functional requirements\n- `Doc2-socialhomes-Technical-Architecture.txt` (42,355 bytes) — Tech stack, system architecture, middleware pipeline, Firestore schemas, API architecture, security, monitoring\n- `Doc3-socialhomes-API-Requirements.txt` (29,428 bytes) — API endpoints, Tier 1/2/3 integrations, 7 differentiators, GOV.UK Notify templates, caching, rate limiting\n\n**Original Root Documents:**\n- `Doc1-SocialHomesAi-Base-Specification.txt` (28,633 bytes)\n- `Doc2-SocialHomesAi-AI-Native-Features.txt` (32,377 bytes)\n- `Doc3-Public-API-Integration-Requirements.txt` (98,343 bytes, 2,333 lines)\n- `Doc4-UI-UX-Audit-Build-Guide.md` (15,588 bytes)\n\n**Project Management:**\n- `EXECUTION-PLAN.md` (22,414 bytes, v3.0) — 5 phases (0-4 DONE, 5 TODO with 38 tasks across 5 sub-phases)\n- `SESSION-HISTORY.md` (25,548 bytes) — 9 session summaries with decisions, commits, file changes\n- `DEV-FIX-LIST.md` (5,173 bytes) — Bug tracker: 4 critical bugs FIXED, 11 warnings FIXED, 330/331 tests passing\n\n**Infrastructure:**\n- `DEVOPS.md` (36,150 bytes) — GCP setup, Cloud Build, monitoring, scaling, backup strategy, on-call procedures\n- `CLAUDE.md` (2,218 bytes) — Claude Code project instructions\n- `README.md` (16 bytes) — Minimal\n\n---\n\n### 15. SECURITY & MONITORING\n\n**Security Measures:**\n- Content Security Policy (CSP) with Google APIs, Firebase, OSM tiles, Google Fonts whitelist\n- CORS tightened to localhost + Cloud Run URL\n- Helmet.js security headers (X-Content-Type-Options, Referrer-Policy, Permissions-Policy)\n- Rate limiting (4 tiers): API 100/min, Auth 10/min, AI 30/min, Admin 20/min\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- JSON body limit reduced to 1MB (from 10MB)\n- Firestore rules enforce persona-based access\n- No API keys/secrets in codebase (all in Secret Manager)\n\n**Monitoring:**\n- Health check endpoint: `/health` (Firestore connectivity, memory, uptime, degraded/unhealthy states)\n- Metrics service: request counts, response times, status codes, endpoint hits, cache stats\n- Admin endpoint: `GET /api/v1/admin/monitoring` for system metrics\n- Structured JSON error logging (no stack leaks in production)\n\n---\n\n### 16. BUILD & DEPLOYMENT\n\n**Frontend Build:**\n- `npm run build` → Vite builds to `/app/dist` (~3.0 MB)\n- TypeScript check: 0 errors\n- Bundle: ~2,580 KB JS (Vite reports)\n\n**Backend Build:**\n- `npm run build` → TypeScript compiles to `/server/dist` (~968 KB)\n- TypeScript check: 0 errors\n\n**Deployment:**\n- `git push origin main` → Cloud Build triggered\n- Dockerfile multi-stage builds both client + server\n- Images pushed to Artifact Registry (`cloud-run-source-deploy/socialhomes`)\n- Deployed to Cloud Run revision in europe-west2 region\n- Min instances: 0, Max instances: 10\n- Memory: 1GB, CPU: 1 vCPU\n- Secrets injected from Secret Manager: FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD\n\n**Live Service URL:**\n- https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n### 17. EXECUTION PLAN STATUS (Phase 0-5)\n\n**Phases 0-4: COMPLETED (59/59 tasks done)**\n- Phase 0: Infrastructure (10/10) ✅\n- Phase 1: Foundation (12/12) ✅ — External APIs + types\n- Phase 2: Intelligence (14/14) ✅ — 7 killer differentiators\n- Phase 3: Enrichment (14/17) ✅ — GOV.UK Notify, Census/NOMIS, accessibility (3 deferred)\n- Phase 4: Completion (11/14) ✅ — Mock services, admin dashboard, security, monitoring (3 deferred)\n\n**Phase 5: EVOLUTION (0/38 TODO)** — In progress\n- 5.1: Project Setup & Architecture (0/7)\n  - Vertex AI integration architecture\n  - WebSocket (Socket.io) design\n  - Event-driven (Cloud Pub/Sub) design\n  - Multi-tenant SaaS strategy\n  - OpenAPI/Swagger documentation\n  - Firestore migration strategy\n- 5.2: Backend Development (0/12)\n  - Vertex AI Gemini Pro integration\n  - Prompt engineering layer\n  - WebSocket server (Socket.io)\n  - Notification dispatch service\n  - Circuit breaker pattern\n  - Cache warming service\n  - Scheduled task runner\n  - Real-time Firestore listeners\n  - Bulk operations API\n  - Audit log query API\n  - AI communication drafting\n  - Tenant activity scoring\n- 5.3: Frontend Development (0/9)\n  - Yantra Assist chat UI (streaming)\n  - Real-time notification bell (WebSocket)\n  - Notification preferences page\n  - Interactive charts (drill-down)\n  - Workflow builder UI\n  - Dark/light theme toggle\n  - Progressive image loading\n  - Mobile-responsive adaptations\n  - Real-time case status indicators\n- 5.4: Testing & QA (0/7)\n  - Selenium regression suite (40+ routes)\n  - Unit tests for 7 AI services\n  - Integration tests for API proxy routes\n  - Load testing (100 concurrent users)\n  - Accessibility audit (aXe/Lighthouse)\n  - CI test pipeline (GitHub Actions/Cloud Build)\n  - Test data factory\n- 5.5: DevOps & Deployment (0/8)\n  - Fix cloudbuild.yaml (Artifact Registry path)\n  - Staging environment on Cloud Run\n  - Cloud Run auto-scaling policies\n  - Cloud Monitoring alerts\n  - Database backup strategy\n  - Cloud CDN for static assets\n  - Custom domain + SSL\n  - Runbook documentation\n\n---\n\n### 18. RECENT COMMITS (Last 20)\n\n```\n7b9b1b2 fix: resolve React Error #310 on Property Detail and Repair Detail pages\n57ac06c chore: add build marker and Docker no-cache flag for deploy debugging\nfddbf02 fix: move React hooks before conditional returns in detail pages\n3a54483 fix: help drawer rendering outside header to avoid backdrop-blur containment\ne023532 fix: make help drawer full-screen with centered content layout\n07d6845 fix: widen help drawer to half viewport for better readability\n9634838 feat: Phase 4 Completion — mock services, admin dashboard, security, monitoring\ne4aa674 feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility\n4ce6faa feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels\n8aae118 fix: resolve all 3 remaining warnings — search, map popups, API pagination\ne5054ac fix: solid opaque background for help drawer, expand first 3 topics\ne40f706 fix: update test suite for new Cloud Run URL and Firebase Auth login\ne777c4f feat: rebuild help system as left drawer with comprehensive user guide\nb4cdd4a feat: add end-to-end viewing bookings, applications, and property map\n0d1407e fix: tenancies search now matches name, address, and tenant ID\n4131b12 docs: add product brochure with page screenshots\n43ca6ac feat: complete Phase 1 — tests, help system, IMD seed, route fix\n6cdbcb2 feat: add Firestore database integration with seed script\n3995428 chore: update hooks paths, gitignore, and add project docs\nc37fe65 fix: align ASB test selector with other table-based tests\n```\n\n---\n\n### 19. KEY FACTS & NOTES\n\n- **Live Data:** 5 estates, 75 properties, 68 tenants, 279+ cases (repairs, complaints, ASB, damp)\n- **Test Pass Rate:** 99.7% (330/331 tests)\n- **TypeScript Errors:** 0\n- **Production Ready:** All 4 completed phases tested and live\n- **Node.js Version:** 20.17.0 (project uses ~20.19+ but 20.17 works fine)\n- **Firebase Compatibility:** firebaseui@6 declares peer firebase@^9||^10 but works with firebase@12 via compat layer\n- **Build Flags:** `--legacy-peer-deps` required for npm install (firebaseui conflict)\n- **Entire.io Integration:** CLI v0.4.4 installed, strategy: manual-commit, enabled for AI session tracking\n- **Telegram Bot:** @SocialHomesBot configured for async notifications (chat ID: socialhomes:8020560167)\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n\n---\n\n### 20. MISSION CONTROL INTEGRATION\n\nThe SocialHomes.Ai project is managed under **Mission Control** (the overarching orchestration layer at `/mnt/c/.netapps/mission-control`). Mission Control:\n- Monitors all projects under `/mnt/c/.netapps/`\n- Has a team of agents for each project\n- Manages abilities, skills, and work delegation\n- Uses persistent SESSION-HISTORY.md for context continuity\n\n---\n\nThis comprehensive exploration captures the complete state of the SocialHomes.Ai project as of 2026-02-25. All source code, specifications, deployment configs, and documentation are accounted for and detailed above."},{"type":"text","text":"agentId: a61b74b941366dc63 (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 80663\ntool_uses: 43\nduration_ms: 159462</usage>"}]}]},"uuid":"4b662ff4-f5ae-4d6c-824c-849298e151af","timestamp":"2026-02-25T15:20:07.785Z","toolUseResult":{"status":"completed","prompt":"Do a very thorough exploration of /mnt/c/.netapps/socialhomes. I need to understand:\n\n1. Full directory structure (all folders, key files)\n2. What frameworks/libraries are used (check package.json files)\n3. All existing documentation files (*.md, *.txt, Doc1*, Doc2*, Doc3*, etc.)\n4. The database models/schemas (Firestore collections)\n5. API routes (server/src/routes/)\n6. Frontend pages (app/src/pages/)\n7. Shared components (app/src/components/)\n8. Any existing EXECUTION-PLAN.md or SESSION-HISTORY.md\n9. Configuration files (Dockerfile, cloudbuild.yaml, etc.)\n10. Any existing docs/requirements/ folder\n\nBe extremely thorough - read package.json files, route files, page components, data models, and any specification documents. I need a complete picture of the project.","agentId":"a61b74b941366dc63","content":[{"type":"text","text":"Perfect! Now I have a complete picture. Let me create a comprehensive summary report:\n\n---\n\n## COMPREHENSIVE PROJECT EXPLORATION: SocialHomes.Ai\n\nI've completed a thorough exploration of `/mnt/c/.netapps/socialhomes`. Here's your complete project picture:\n\n### 1. PROJECT OVERVIEW\n\n**SocialHomes.Ai** is an AI-native housing management platform for UK social housing providers (housing associations). Built with React 19 + Express + Firestore on Google Cloud Run (europe-west2).\n\n- **Live URL:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **Status:** 4 Phases DONE (Infrastructure, Foundation, Intelligence, Enrichment, Completion) + Phase 5 Evolution in progress\n- **Test Results:** 330/331 tests passing (99.7%)\n\n---\n\n### 2. FULL DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                           # React Frontend (Vite)\n│   ├── src/\n│   │   ├── pages/                 # 31 page components across 19 modules\n│   │   │   ├── admin/             # Admin Dashboard, Integrations\n│   │   │   ├── ai-centre/         # AI Insights, Predictions, Assistant\n│   │   │   ├── allocations/       # Property Allocations\n│   │   │   ├── asb/               # Anti-Social Behaviour cases\n│   │   │   ├── auth/              # Login/Firebase Auth\n│   │   │   ├── briefing/          # Daily briefing & intelligence\n│   │   │   ├── communications/    # Email/SMS/notifications\n│   │   │   ├── complaints/        # Complaint tracking (2-stage)\n│   │   │   ├── compliance/        # Regulatory (Big 6) compliance\n│   │   │   ├── dashboard/         # Executive KPIs & analytics\n│   │   │   ├── explore/           # Geographic map view (Leaflet)\n│   │   │   ├── properties/        # Property portfolio (75 properties)\n│   │   │   ├── rent/              # Rent management & arrears\n│   │   │   ├── repairs/           # Repair tracking (Awaab's Law)\n│   │   │   ├── reports/           # Dynamic reports + TSM reporting\n│   │   │   ├── search/            # Global search across all data\n│   │   │   ├── tenancies/         # Tenancy management (68 tenants)\n│   │   │   └── tenant-portal/     # Self-service tenant portal\n│   │   ├── components/\n│   │   │   ├── layout/            # Shell: Header, Sidebar, Layout, Breadcrumbs, YantraAssist\n│   │   │   └── shared/            # 12 reusable components (ActionModal, Panels, Maps, etc.)\n│   │   ├── services/\n│   │   │   ├── api-client.ts      # API request layer with Firestore timestamp sanitization\n│   │   │   └── firebase.ts        # Firebase Auth + config\n│   │   ├── hooks/                 # 3 custom React hooks (useApi, useEntityIntelligence, usePersonaScope)\n│   │   ├── contexts/              # React Context providers\n│   │   ├── utils/                 # Helper functions (safeText, formatting, etc.)\n│   │   ├── types/                 # TypeScript interfaces\n│   │   └── assets/                # SVGs, icons\n│   ├── dist/                      # Built output (3.0 MB)\n│   ├── package.json               # React 19, TypeScript 5.9, Tailwind 4, Vite 7\n│   └── vite.config.ts             # Vite configuration\n│\n├── server/                        # Express Backend (Node 20)\n│   ├── src/\n│   │   ├── routes/                # 16 API route files (50+ endpoints)\n│   │   │   ├── admin.ts           # Admin operations (integrations, monitoring)\n│   │   │   ├── ai.ts              # AI services (10 endpoints) + drafting + chat\n│   │   │   ├── auth.ts            # Firebase token verification\n│   │   │   ├── booking.ts         # Viewing bookings\n│   │   │   ├── briefing.ts        # Daily estate briefings\n│   │   │   ├── cases.ts           # Unified case management (CRUD)\n│   │   │   ├── compliance.ts      # Regulatory reporting\n│   │   │   ├── explore.ts         # Geographic hierarchy\n│   │   │   ├── export.ts          # Data exports (TSM, HACT)\n│   │   │   ├── lettings.ts        # Lettings workflow\n│   │   │   ├── properties.ts      # Property CRUD + filters\n│   │   │   ├── public-data.ts     # Census, NOMIS, Gas Safe, Electoral APIs\n│   │   │   ├── rent.ts            # Rent transactions + dashboards\n│   │   │   ├── reports.ts         # Dynamic reporting\n│   │   │   └── tenants.ts         # Tenant CRUD + activities + cases\n│   │   ├── services/              # 18 backend services\n│   │   │   ├── external-api.ts    # Shared cache, rate limiting, audit logging\n│   │   │   ├── firestore.ts       # Firestore client + query helpers\n│   │   │   ├── firebase-admin.ts  # Firebase Admin SDK\n│   │   │   ├── damp-prediction.ts # 5-factor weighted damp algorithm\n│   │   │   ├── crime-context.ts   # Police data + ASB correlation\n│   │   │   ├── vulnerability-detection.ts # 7-factor tenant vulnerability scoring\n│   │   │   ├── benefits-engine.ts # UK benefit rules (UC, PIP, AA, Pension Credit)\n│   │   │   ├── property-passport.ts # Multi-source property aggregation\n│   │   │   ├── neighbourhood-briefing.ts # Per-estate daily intelligence\n│   │   │   ├── govuk-notify.ts    # 24 notification templates across 7 categories\n│   │   │   ├── census-nomis.ts    # Census 2021 + labour market data\n│   │   │   ├── mock-services.ts   # 5 mock Tier 3 APIs (repairs, regulatory, signing, referencing, land registry)\n│   │   │   ├── monitoring.ts      # Metrics singleton (requests, latency, cache stats)\n│   │   │   ├── seed.ts + seed-data.ts # Test data generation\n│   │   │   └── hact-export.ts     # HACT data export format\n│   │   ├── middleware/\n│   │   │   ├── auth.ts            # Firebase JWT verification + persona extraction\n│   │   │   ├── rate-limiter.ts    # 4-tier rate limiting (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n│   │   │   ├── metrics.ts         # Request metrics collection\n│   │   │   └── error-handler.ts   # Structured JSON error responses\n│   │   ├── models/\n│   │   │   └── firestore-schemas.ts # 12 TypeScript interfaces for all Firestore documents\n│   │   ├── scripts/\n│   │   │   └── seed-imd.ts        # Deprivation index data loader\n│   │   ├── index.ts               # Express server setup, routing, middleware\n│   │   └── types.ts               # Global TypeScript types\n│   ├── dist/                      # Built output (968 KB)\n│   ├── package.json               # Express, Firebase Admin, TypeScript 5.7\n│   └── tsconfig.json              # TypeScript configuration\n│\n├── docs/requirements/             # Specification documents (v3.0)\n│   ├── Doc1-socialhomes-Base-Specification.txt\n│   ├── Doc2-socialhomes-Technical-Architecture.txt\n│   └── Doc3-socialhomes-API-Requirements.txt\n│\n├── Dockerfile                     # Multi-stage Docker build (Node 20 slim)\n├── cloudbuild.yaml                # Google Cloud Build CI/CD pipeline (NEEDS FIX: wrong Artifact Registry path)\n├── firestore.rules                # Security rules (persona-based access control)\n├── firestore.indexes.json         # 17 composite indexes for query optimization\n│\n├── CLAUDE.md                      # Project instructions for Claude Code\n├── DEV-FIX-LIST.md                # Bug tracker (all 99.7% resolved)\n├── DEVOPS.md                      # Deployment & infrastructure guide\n├── EXECUTION-PLAN.md              # Master execution plan (v3.0, Phase 0-5)\n├── SESSION-HISTORY.md             # Persistent session history (9 sessions)\n├── Doc1-SocialHomesAi-Base-Specification.txt  # Original spec (root)\n├── Doc2-SocialHomesAi-AI-Native-Features.txt  # Original AI spec (root)\n├── Doc3-Public-API-Integration-Requirements.txt # Original API requirements (root, 2,333 lines)\n├── Doc4-UI-UX-Audit-Build-Guide.md # Frontend audit guide (v1.0)\n│\n├── .claude/                       # Claude settings\n├── .entire/                       # Entire.io session tracking\n├── .mission-control/              # Mission Control agent config\n├── tests/                         # Selenium test suites + screenshots\n└── UK Housing Data Standard Version 3.5/ # Reference data (XLSX, JSON, XML)\n```\n\n**Code Statistics:**\n- Frontend (TypeScript/TSX): 13,395 lines\n- Backend (TypeScript): 10,457 lines\n- Total: ~23,852 lines\n\n---\n\n### 3. TECHNOLOGY STACK\n\n#### Frontend (React 19)\n```\nReact 19.2.0              UI framework\nTypeScript 5.9            Type safety\nVite 7.2.4                Build tool (dev/prod)\nTailwind CSS 4.1          Utility-first styling (dark theme)\nReact Router 6.30         Client-side routing\nFirebase 12.9.0           Auth + Firestore\nReact Query 5.90          Data fetching + caching\nRecharts 3.7              Business charts\nD3.js 7.9                 Advanced visualizations\nLeaflet 1.9.4 + React-Leaflet 5  Geographic maps\nThree.js 0.182 + React Three Fiber  3D visualizations\nLucide React 0.563        Icon system\ndate-fns 4.1              Date/time utilities\n```\n\n#### Backend (Express + Node 20)\n```\nExpress 4.21.2            HTTP server\nTypeScript 5.7            Type safety\nFirebase Admin 13.6.1     Firestore backend\nGoogle Cloud Firestore 7.11  Database\nHelmet 8.1                Security headers\nMorgan 1.10               Logging\nCORS 2.8.5                Cross-origin requests\nCompression 1.8           Gzip compression\ntsx 4.19                  TypeScript executor\nvitest 4.0                Unit testing framework\n```\n\n#### Infrastructure\n```\nGoogle Cloud Run          Serverless hosting (europe-west2)\nCloud Firestore           NoSQL database (live data: 460+ docs)\nCloud Secret Manager      Secrets storage\nArtifact Registry         Docker image registry\nCloud Build               CI/CD pipeline\nDocker                    Containerization (multi-stage)\nNode.js 20.17.0           Runtime\n```\n\n---\n\n### 4. API ROUTES (50+ Endpoints)\n\n**Authentication:**\n- `POST /api/v1/auth/verify` — Firebase JWT verification\n\n**Properties:**\n- `GET /api/v1/properties` (filters: regionId, estateId, blockId, type, isVoid, limit)\n- `GET /api/v1/properties/:id`\n- `PATCH /api/v1/properties/:id`\n- `GET /api/v1/properties/available`\n\n**Tenants:**\n- `GET /api/v1/tenants` (filters)\n- `GET /api/v1/tenants/:id`\n- `GET /api/v1/tenants/:id/activities`\n- `GET /api/v1/tenants/:id/cases`\n- `PATCH /api/v1/tenants/:id`\n\n**Cases (Unified):**\n- `GET /api/v1/cases` (filters: type, status, handler, priority)\n- `GET /api/v1/cases/:id`\n- `POST /api/v1/cases` (create)\n- `PATCH /api/v1/cases/:id` (update)\n- `GET /api/v1/cases/:id/activities`\n\n**AI Differentiator Services:**\n- `GET /api/v1/ai/damp-risk/:propertyId` — Predictive damp intelligence\n- `GET /api/v1/ai/damp-risk/estate/:estateId`\n- `GET /api/v1/ai/crime-context/:estateId` — Live crime context\n- `GET /api/v1/ai/crime-context/case/:caseId`\n- `GET /api/v1/ai/vulnerability/:tenantId` — Vulnerability detection\n- `POST /api/v1/ai/vulnerability/scan`\n- `GET /api/v1/ai/benefits-check/:tenantId` — Benefits entitlement engine\n- `GET /api/v1/ai/property-passport/:propertyId` — Property aggregation\n- `GET /api/v1/ai/briefing/:estateId` — AI neighbourhood briefing\n- `POST /api/v1/ai/draft-communication` — Draft communications\n- `POST /api/v1/ai/chat` — Conversational AI\n\n**GOV.UK Notify:**\n- `GET /api/v1/ai/notify/templates`\n- `GET /api/v1/ai/notify/templates/:category`\n- `GET /api/v1/ai/notify/template/:id`\n- `POST /api/v1/ai/notify/render`\n\n**Public Data APIs:**\n- `GET /api/v1/public-data/census/:lsoaCode` — Census 2021\n- `GET /api/v1/public-data/nomis/:lsoaCode` — Labour market stats\n- `GET /api/v1/public-data/gas-safe/:registrationNumber`\n- `GET /api/v1/public-data/electrical-safety/:registrationNumber`\n\n**Briefing & Insights:**\n- `GET /api/v1/briefing` — Estate briefing\n\n**Compliance:**\n- `GET /api/v1/compliance/overview` — Big 6 regulatory status\n\n**Rent & Arrears:**\n- `GET /api/v1/rent/dashboard`\n- `GET /api/v1/rent/transactions/:tenantId`\n\n**Reports:**\n- `GET /api/v1/reports/tsm` — Tenancy Services Manager report\n- `GET /api/v1/reports/regulatory` — Regulatory returns\n\n**Explore (Geographic):**\n- `GET /api/v1/explore/hierarchy` — Region → LA → Estate → Block → Property\n- `GET /api/v1/explore/regions`\n- `GET /api/v1/explore/estates/:id`\n- `GET /api/v1/explore/blocks/:id`\n\n**Admin:**\n- `GET /api/v1/admin/integrations` — Integration status\n- `POST /api/v1/admin/integrations/:id/toggle`\n- `POST /api/v1/admin/integrations/:id/test`\n- `GET /api/v1/admin/monitoring` — System metrics\n\n**Mock Tier 3 Services:**\n- `GET /api/v1/ai/mock/uc-verification/:tenantId` — DWP Universal Credit\n- `GET /api/v1/ai/mock/iot-sensors/:propertyId` — Switchee/Aico sensors\n- `GET /api/v1/ai/mock/direct-debit/:tenantId` — GoCardless\n- `GET /api/v1/ai/mock/labour-market/:lsoaCode` — NOMIS\n- `GET /api/v1/ai/mock/repairs-marketplace/:caseId` — Plentific/Fixflo\n- `GET /api/v1/ai/mock/regulatory/:type` — RSH/CORE/Ombudsman\n- `GET /api/v1/ai/mock/signing/:documentType` — DocuSign\n- `GET /api/v1/ai/mock/referencing/:applicantId` — Experian/TransUnion\n- `GET /api/v1/ai/mock/land-registry/:propertyId`\n\n**Built-in Endpoints:**\n- `GET /health` — Health check (Firestore connectivity, memory, uptime)\n- `GET /api/v1/config` — Frontend configuration (Firebase, demo credentials)\n\n---\n\n### 5. FIRESTORE DATABASE SCHEMA (12 Collections)\n\n**Geography (Hierarchical):**\n- `organisations` — Housing association metadata\n- `regions` — Geographic regions (5 seeded)\n- `localAuthorities` — Local authority areas\n- `estates` — Housing estates (5 seeded)\n- `blocks` — Buildings within estates (8 seeded)\n\n**Core Entities:**\n- `properties` — Housing units (75 seeded, all types: flat, bungalow, house, etc.)\n- `tenants` — Residents (68 seeded with vulnerability flags, UC status, arrears risk)\n\n**Case Management (Unified):**\n- `cases` — All cases (Repairs: 200, Complaints: 34, ASB: 12, Damp: ~50 seeded)\n  - Types: repair, complaint, asb, damp-mould, financial\n  - Awaab's Law compliance tracking for damp cases\n  - 2-stage complaint process with deadlines\n  - SLA tracking with breach status\n\n**Supporting Collections:**\n- `activities` — Notes, contact logs, timeline events (linked to cases/tenants)\n- `communications` — Email/SMS templates, sending history\n- `rentTransactions` — Payment history, arrears tracking\n- `auditLog` — Change tracking (all API calls logged)\n- `users` — Staff directory (persona-scoped)\n- `notifications` — In-app notification queue\n- `voidProperties` — Vacant properties tracking\n- `applicants` — Prospective tenants for lettings\n- `tsmMeasures` — Tenancy Services Manager metrics\n- `externalDataCache` — Cache for external APIs (postcodes.io, police.uk, DEFRA, etc.)\n- `hactCodes` — HACT data standard reference codes\n\n**Indexes:** 17 composite indexes for efficient filtering (type+status, estateId+type, arrearsRisk, etc.)\n\n---\n\n### 6. DATA MODELS (Core Types)\n\nSee `/mnt/c/.netapps/socialhomes/server/src/models/firestore-schemas.ts` (262 lines):\n\n**PropertyDoc:**\n- Identity: id, uprn, address, postcode, coordinates (lat/lng)\n- Geography: blockId, estateId, localAuthorityId, regionId\n- Housing: type, bedrooms, floor, floorArea, heatingType, tenureType\n- Compliance: epc, gasSafety, eicr, asbestos, smokeAlarms, coAlarms, boiler\n- Financial: weeklyRent, serviceCharge, dampRisk (0-100 score)\n- Status: isVoid, voidSince, currentTenancyId\n\n**TenantDoc:**\n- Identity: id, title, firstName, lastName, dob, email, phone, mobile\n- Tenancy: propertyId, tenancyId, tenancyStartDate, tenancyType, tenancyStatus\n- Household: household array, emergencyContact\n- Management: assignedOfficer, vulnerabilityFlags, communicationPreference\n- Financial: ucStatus, paymentMethod, rentBalance, weeklyCharge, arrearsRisk (0-100)\n- Engagement: lastContact, contactCount30Days\n\n**CaseDoc:**\n- Universal: id, reference, type, tenantId, propertyId, status, priority, handler, createdDate, daysOpen, slaStatus\n- Repair-specific: sorCode, trade, operative, appointmentDate, completionDate, cost, firstTimeFix, awaabsLaw tracking\n- Complaint-specific: stage (1-2), category, deadlines, findings, compensation, learningActions, ombudsmanEscalation\n- ASB-specific: severity, escalationStage, evidenceCount, multiAgencyPanel, communityTrigger\n- Damp-specific: hazardClassification, dampRiskScore, cause, linkedRepairs\n- Financial-specific: arrearsAmount, arrearsReason, paymentArrangement, preActionChecklist\n\n---\n\n### 7. FRONTEND PAGES (31 Total)\n\n**Dashboard & Navigation:**\n- `/dashboard` — Executive KPIs (properties, tenancies, repairs, compliance, arrears, voids), charts, activity feed\n- `/briefing` — Daily intelligence, estate briefing, compliance snapshot\n- `/search` — Global full-text search across all entities\n\n**Core Modules:**\n- `/properties` & `/properties/:id` — Portfolio view + detail (map, EPC, rent, compliance, damp intelligence panel)\n- `/tenancies` & `/tenancies/:id` — 68 tenants + detail (vulnerability panel, benefits panel, activities, cases)\n- `/repairs` & `/repairs/:id` — 200 repairs + detail (Awaab's Law compliance, appointment booking, SLA tracking, AI estimates)\n- `/complaints` & `/complaints/:id` — 34 complaints + detail (2-stage process, deadlines, ombudsman escalation, timeline)\n- `/asb` & `/asb/:id` — Anti-social behaviour cases + detail\n- `/explore` — Interactive geographic map (Leaflet/OSM) with data layers (crime, damp, compliance toggles)\n\n**Specialized Features:**\n- `/ai-centre` — AI Insights (Predictions tab, Assistant tab, Differentiators scan)\n- `/briefing` — Neighbourhood briefing with estate selector + compliance overview\n- `/compliance` — Big 6 regulatory tracking (Awaab's Law, Fire Safety, Asbestos, Legionella, Gas Safety, Electrical, Lifts)\n- `/rent` — Rent dashboard, UC tracking, worklist, arrears management\n- `/communications` — Message templates, send history, AI analysis\n- `/reports` — Dynamic reporting (27 reports), TSM reporting\n- `/admin` — 7 sub-pages: General, Integrations, Settings, Users, Audit, Compliance, Performance\n- `/allocations` — Void property allocations workflow\n- `/tenant-portal` — Self-service tenant interface\n- `/auth/login` — Firebase email/Google sign-in with demo credentials\n\n**Supporting Pages:**\n- `/properties/viewing-booking` — Viewing appointment booking\n- `/properties/applications` — Tenant application processing\n- `/shared/coming-soon` — Placeholder pages\n\n---\n\n### 8. SHARED COMPONENTS (12 Components)\n\n**Layout Components:**\n- `Header.tsx` — Logo, org name, search, persona dropdown, notifications, Yantra Assist button\n- `Sidebar.tsx` — 5 sections (NAVIGATE, MANAGE, COMMUNICATE, ANALYSE, CONFIGURE), 14 nav links, badges for case counts\n- `Layout.tsx` — App shell with header + sidebar + main content + YantraAssist panel\n- `Breadcrumbs.tsx` — Auto-generated from URL path with home link\n\n**Panels & Cards:**\n- `DampIntelligencePanel.tsx` — 5-factor damp prediction score with factor breakdown bar chart\n- `VulnerabilityPanel.tsx` — 7-factor tenant vulnerability assessment (deprivation, arrears, health, isolation, age, dependents, UC)\n- `BenefitsPanel.tsx` — Benefits entitlement list with unclaimed amounts and status icons\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards (Weather, Crime, Damp, Compliance, Vacancies, Income) + briefing text\n- `KpiCard.tsx` — Key performance indicator card with metric, value, trend, sparkline\n- `PropertyMap.tsx` — Leaflet map for property/estate visualization\n\n**Interaction Components:**\n- `ActionModal.tsx` — Modal dialog with form validation, WCAG AA compliance (focus trap, Escape key, ARIA attributes), inline error display\n- `AiActionCard.tsx` — AI-generated action card with icon, title, description, call-to-action\n- `StatusPill.tsx` — Status badge (compliant, warning, critical, info, AI, void)\n- `CountdownTimer.tsx` — Large monospace countdown (green → peach → garnet → pulsing when overdue)\n- `HelpDrawer.tsx` — Full-screen help system with table of contents, 20+ topic sections, related guides, search\n- `ProtectedRoute.tsx` — Auth guard, redirects to /login if not authenticated, checks persona\n\n**YantraAssist (AI Companion):**\n- `YantraAssist.tsx` — Slide-in panel (320px from right) with context-aware content, chat interface, urgency sections\n\n---\n\n### 9. HOOKS (3 Custom React Hooks)\n\n**`useApi.ts`:**\n- Encapsulates API calls with React Query\n- Manages loading, error, data states\n- Provides 30+ convenience methods (propertiesApi, tenantsApi, casesApi, aiApi, etc.)\n\n**`useEntityIntelligence.ts`:**\n- Fetches AI predictions for properties, tenants, cases\n- Caches results to reduce API calls\n- Returns damp risk, vulnerability score, benefits, briefing, property passport\n\n**`usePersonaScope.ts`:**\n- Manages persona context (COO, Head of Housing, Manager, Housing Officer, Operative)\n- Controls data visibility + feature access based on permission level\n- Persists persona to localStorage for session continuity\n\n---\n\n### 10. AUTHENTICATION & PERSONAS\n\n**5 Personas (Role-Based):**\n1. **COO** — Organisation-wide view (all regions, all data, admin functions)\n2. **Head of Housing** — Regional oversight (1+ regions, all estates, analytics, compliance)\n3. **Housing Manager** — Estate/block management (assigned estates, frontline cases, planning)\n4. **Housing Officer** — Frontline casework (assigned cases, tenant interaction, repairs, compliance)\n5. **Repairs Operative** — Job-level repairs (assigned repairs, appointment scheduling, completion)\n\n**Auth Method:**\n- Firebase Authentication (email + password, Google sign-in)\n- Demo User: `demo@socialhomes.ai` / `SocialHomes2026!`\n- JWT token passed in `Authorization: Bearer` header\n- Fallback to `X-Persona` header for persona identification\n- Firestore security rules enforce persona-based access\n\n---\n\n### 11. AI FEATURES & SERVICES (7 Killer Differentiators)\n\n**Backend Services (in `/server/src/services/`):**\n\n1. **Damp Prediction (`damp-prediction.ts`):**\n   - 5-factor weighted algorithm\n   - Weights: weather (0.25), building (0.25), history (0.20), sensor (0.20), occupancy (0.10)\n   - Output: 0-100 risk score + factor breakdown\n\n2. **Crime Context (`crime-context.ts`):**\n   - Police API data integration (street-level crime)\n   - Correlation with internal ASB cases\n   - Hotspot analysis per estate\n\n3. **Vulnerability Detection (`vulnerability-detection.ts`):**\n   - 7-factor tenant scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n   - Flags: vulnerable, at-risk, high-priority\n   - Output: 0-100 vulnerability score\n\n4. **Benefits Engine (`benefits-engine.ts`):**\n   - UK 2025/26 benefit rules (Universal Credit, PIP, Attendance Allowance, Pension Credit, JSA, ESA, HB)\n   - Entitlement checking\n   - Unclaimed benefits identification\n\n5. **Property Passport (`property-passport.ts`):**\n   - Multi-source aggregation: property data + compliance + crime + damp + demographics\n   - Single 360-degree property dossier\n\n6. **Neighbourhood Briefing (`neighbourhood-briefing.ts`):**\n   - Per-estate daily intelligence\n   - Combines: weather, crime, damp cases, compliance, void properties, income trends\n   - Generates text summary for officers\n\n7. **GOV.UK Notify (`govuk-notify.ts`):**\n   - 24 email/SMS templates across 7 categories:\n     - Rent Arrears (3 templates)\n     - Repairs (3 templates)\n     - ASB (3 templates)\n     - Compliance (3 templates)\n     - Tenancy (3 templates)\n     - Damp & Mould (3 templates)\n     - General (3 templates)\n   - Template rendering with `((field))` placeholder substitution\n\n---\n\n### 12. EXTERNAL API INTEGRATIONS (30+ APIs)\n\n**Tier 1 — Free, No Registration (3 live):**\n- `postcodes.io` — Postcode lookup, LSOA, lat/long\n- `uprn.uk` (Open UPRN) — UPRN lookup\n- `data.police.uk` — Street-level crime, ASB data\n- `open-meteo.com` — Weather (hourly + historical)\n- `data.gov.uk` (DEFRA) — Flood warnings per property\n\n**Tier 2 — Registration Required (6 live):**\n- Census 2021 (ONS via NOMIS) — Demographics, housing stock\n- NOMIS Labour Market (NM_162_1, NM_17_5) — Employment, skills\n- Gas Safe Register API — Contractor verification\n- Electrical Safety Register — NICEIC/ECA verification\n- Land Registry API — Title deeds, freehold/leasehold, price paid\n- DWP Universal Credit (mock) — Benefit verification\n\n**Tier 3 — Mock Services (8 mock endpoints for demo):**\n- Switchee/Aico IoT sensors\n- GoCardless direct debit\n- Plentific/Fixflo repairs marketplace\n- RSH/CORE/Ombudsman regulatory submissions\n- DocuSign digital signing\n- Experian/TransUnion referencing\n- NOMIS labour market stats (mock extension)\n\n**Infrastructure:**\n- Caching: externalDataCache Firestore collection with TTL management (cache-through pattern)\n- Rate limiting: In-memory token bucket (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Audit logging: Every external API call logged to auditLog collection\n\n---\n\n### 13. CONFIGURATION FILES\n\n**`cloudbuild.yaml`:** Google Cloud Build CI/CD pipeline\n- **ISSUE:** Pushes to `europe-west2-docker.pkg.dev/$PROJECT_ID/socialhomes/app` but actual repo is `cloud-run-source-deploy/socialhomes`\n- Deploys to Cloud Run region europe-west2\n- Sets env vars + secrets from Secret Manager\n\n**`Dockerfile`:** Multi-stage Docker build\n- Stage 1: Build React client (Vite)\n- Stage 2: Build Express server (TypeScript)\n- Stage 3: Production runtime (Node 20 slim, combines both)\n- Exposes port 8080\n\n**`firestore.rules`:** Firestore security rules\n- Persona-based access control (functions: isAuthenticated, hasPersona, isManager, isAdmin)\n- Collections: organisations, regions, estates, properties, tenants, cases, activities, communications, rentTransactions, users, auditLog, notifications, voidProperties, applicants, tsmMeasures\n\n**`firestore.indexes.json`:** 17 composite indexes\n- Optimizes queries: type+status, type+handler, estateId+type, tenantId+date, etc.\n\n---\n\n### 14. DOCUMENTATION FILES\n\n**Specification Documents (v3.0, in `/docs/requirements/`):**\n- `Doc1-socialhomes-Base-Specification.txt` (35,991 bytes) — Product overview, 17 modules, personas, AI features, data model, UI design, regulatory compliance, non-functional requirements\n- `Doc2-socialhomes-Technical-Architecture.txt` (42,355 bytes) — Tech stack, system architecture, middleware pipeline, Firestore schemas, API architecture, security, monitoring\n- `Doc3-socialhomes-API-Requirements.txt` (29,428 bytes) — API endpoints, Tier 1/2/3 integrations, 7 differentiators, GOV.UK Notify templates, caching, rate limiting\n\n**Original Root Documents:**\n- `Doc1-SocialHomesAi-Base-Specification.txt` (28,633 bytes)\n- `Doc2-SocialHomesAi-AI-Native-Features.txt` (32,377 bytes)\n- `Doc3-Public-API-Integration-Requirements.txt` (98,343 bytes, 2,333 lines)\n- `Doc4-UI-UX-Audit-Build-Guide.md` (15,588 bytes)\n\n**Project Management:**\n- `EXECUTION-PLAN.md` (22,414 bytes, v3.0) — 5 phases (0-4 DONE, 5 TODO with 38 tasks across 5 sub-phases)\n- `SESSION-HISTORY.md` (25,548 bytes) — 9 session summaries with decisions, commits, file changes\n- `DEV-FIX-LIST.md` (5,173 bytes) — Bug tracker: 4 critical bugs FIXED, 11 warnings FIXED, 330/331 tests passing\n\n**Infrastructure:**\n- `DEVOPS.md` (36,150 bytes) — GCP setup, Cloud Build, monitoring, scaling, backup strategy, on-call procedures\n- `CLAUDE.md` (2,218 bytes) — Claude Code project instructions\n- `README.md` (16 bytes) — Minimal\n\n---\n\n### 15. SECURITY & MONITORING\n\n**Security Measures:**\n- Content Security Policy (CSP) with Google APIs, Firebase, OSM tiles, Google Fonts whitelist\n- CORS tightened to localhost + Cloud Run URL\n- Helmet.js security headers (X-Content-Type-Options, Referrer-Policy, Permissions-Policy)\n- Rate limiting (4 tiers): API 100/min, Auth 10/min, AI 30/min, Admin 20/min\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- JSON body limit reduced to 1MB (from 10MB)\n- Firestore rules enforce persona-based access\n- No API keys/secrets in codebase (all in Secret Manager)\n\n**Monitoring:**\n- Health check endpoint: `/health` (Firestore connectivity, memory, uptime, degraded/unhealthy states)\n- Metrics service: request counts, response times, status codes, endpoint hits, cache stats\n- Admin endpoint: `GET /api/v1/admin/monitoring` for system metrics\n- Structured JSON error logging (no stack leaks in production)\n\n---\n\n### 16. BUILD & DEPLOYMENT\n\n**Frontend Build:**\n- `npm run build` → Vite builds to `/app/dist` (~3.0 MB)\n- TypeScript check: 0 errors\n- Bundle: ~2,580 KB JS (Vite reports)\n\n**Backend Build:**\n- `npm run build` → TypeScript compiles to `/server/dist` (~968 KB)\n- TypeScript check: 0 errors\n\n**Deployment:**\n- `git push origin main` → Cloud Build triggered\n- Dockerfile multi-stage builds both client + server\n- Images pushed to Artifact Registry (`cloud-run-source-deploy/socialhomes`)\n- Deployed to Cloud Run revision in europe-west2 region\n- Min instances: 0, Max instances: 10\n- Memory: 1GB, CPU: 1 vCPU\n- Secrets injected from Secret Manager: FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD\n\n**Live Service URL:**\n- https://socialhomes-587984201316.europe-west2.run.app\n\n---\n\n### 17. EXECUTION PLAN STATUS (Phase 0-5)\n\n**Phases 0-4: COMPLETED (59/59 tasks done)**\n- Phase 0: Infrastructure (10/10) ✅\n- Phase 1: Foundation (12/12) ✅ — External APIs + types\n- Phase 2: Intelligence (14/14) ✅ — 7 killer differentiators\n- Phase 3: Enrichment (14/17) ✅ — GOV.UK Notify, Census/NOMIS, accessibility (3 deferred)\n- Phase 4: Completion (11/14) ✅ — Mock services, admin dashboard, security, monitoring (3 deferred)\n\n**Phase 5: EVOLUTION (0/38 TODO)** — In progress\n- 5.1: Project Setup & Architecture (0/7)\n  - Vertex AI integration architecture\n  - WebSocket (Socket.io) design\n  - Event-driven (Cloud Pub/Sub) design\n  - Multi-tenant SaaS strategy\n  - OpenAPI/Swagger documentation\n  - Firestore migration strategy\n- 5.2: Backend Development (0/12)\n  - Vertex AI Gemini Pro integration\n  - Prompt engineering layer\n  - WebSocket server (Socket.io)\n  - Notification dispatch service\n  - Circuit breaker pattern\n  - Cache warming service\n  - Scheduled task runner\n  - Real-time Firestore listeners\n  - Bulk operations API\n  - Audit log query API\n  - AI communication drafting\n  - Tenant activity scoring\n- 5.3: Frontend Development (0/9)\n  - Yantra Assist chat UI (streaming)\n  - Real-time notification bell (WebSocket)\n  - Notification preferences page\n  - Interactive charts (drill-down)\n  - Workflow builder UI\n  - Dark/light theme toggle\n  - Progressive image loading\n  - Mobile-responsive adaptations\n  - Real-time case status indicators\n- 5.4: Testing & QA (0/7)\n  - Selenium regression suite (40+ routes)\n  - Unit tests for 7 AI services\n  - Integration tests for API proxy routes\n  - Load testing (100 concurrent users)\n  - Accessibility audit (aXe/Lighthouse)\n  - CI test pipeline (GitHub Actions/Cloud Build)\n  - Test data factory\n- 5.5: DevOps & Deployment (0/8)\n  - Fix cloudbuild.yaml (Artifact Registry path)\n  - Staging environment on Cloud Run\n  - Cloud Run auto-scaling policies\n  - Cloud Monitoring alerts\n  - Database backup strategy\n  - Cloud CDN for static assets\n  - Custom domain + SSL\n  - Runbook documentation\n\n---\n\n### 18. RECENT COMMITS (Last 20)\n\n```\n7b9b1b2 fix: resolve React Error #310 on Property Detail and Repair Detail pages\n57ac06c chore: add build marker and Docker no-cache flag for deploy debugging\nfddbf02 fix: move React hooks before conditional returns in detail pages\n3a54483 fix: help drawer rendering outside header to avoid backdrop-blur containment\ne023532 fix: make help drawer full-screen with centered content layout\n07d6845 fix: widen help drawer to half viewport for better readability\n9634838 feat: Phase 4 Completion — mock services, admin dashboard, security, monitoring\ne4aa674 feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility\n4ce6faa feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels\n8aae118 fix: resolve all 3 remaining warnings — search, map popups, API pagination\ne5054ac fix: solid opaque background for help drawer, expand first 3 topics\ne40f706 fix: update test suite for new Cloud Run URL and Firebase Auth login\ne777c4f feat: rebuild help system as left drawer with comprehensive user guide\nb4cdd4a feat: add end-to-end viewing bookings, applications, and property map\n0d1407e fix: tenancies search now matches name, address, and tenant ID\n4131b12 docs: add product brochure with page screenshots\n43ca6ac feat: complete Phase 1 — tests, help system, IMD seed, route fix\n6cdbcb2 feat: add Firestore database integration with seed script\n3995428 chore: update hooks paths, gitignore, and add project docs\nc37fe65 fix: align ASB test selector with other table-based tests\n```\n\n---\n\n### 19. KEY FACTS & NOTES\n\n- **Live Data:** 5 estates, 75 properties, 68 tenants, 279+ cases (repairs, complaints, ASB, damp)\n- **Test Pass Rate:** 99.7% (330/331 tests)\n- **TypeScript Errors:** 0\n- **Production Ready:** All 4 completed phases tested and live\n- **Node.js Version:** 20.17.0 (project uses ~20.19+ but 20.17 works fine)\n- **Firebase Compatibility:** firebaseui@6 declares peer firebase@^9||^10 but works with firebase@12 via compat layer\n- **Build Flags:** `--legacy-peer-deps` required for npm install (firebaseui conflict)\n- **Entire.io Integration:** CLI v0.4.4 installed, strategy: manual-commit, enabled for AI session tracking\n- **Telegram Bot:** @SocialHomesBot configured for async notifications (chat ID: socialhomes:8020560167)\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n\n---\n\n### 20. MISSION CONTROL INTEGRATION\n\nThe SocialHomes.Ai project is managed under **Mission Control** (the overarching orchestration layer at `/mnt/c/.netapps/mission-control`). Mission Control:\n- Monitors all projects under `/mnt/c/.netapps/`\n- Has a team of agents for each project\n- Manages abilities, skills, and work delegation\n- Uses persistent SESSION-HISTORY.md for context continuity\n\n---\n\nThis comprehensive exploration captures the complete state of the SocialHomes.Ai project as of 2026-02-25. All source code, specifications, deployment configs, and documentation are accounted for and detailed above."}],"totalDurationMs":159462,"totalTokens":80663,"totalToolUseCount":43,"usage":{"input_tokens":7,"cache_creation_input_tokens":3215,"cache_read_input_tokens":66805,"output_tokens":10636,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":3215,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"abb99008-cd3b-432e-834d-1beec4987b9d"}
{"parentUuid":"4b662ff4-f5ae-4d6c-824c-849298e151af","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the existing specification documents to understand what's already there before creating updated versions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"87f220eb-8c0d-4a1f-a475-bc556389359b","timestamp":"2026-02-25T15:23:18.347Z"}
{"parentUuid":"87f220eb-8c0d-4a1f-a475-bc556389359b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HeEmikYXwrPHdSTpiE7Gzr","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"32db2642-74bc-4afb-89fb-35786abb3e38","timestamp":"2026-02-25T15:23:18.973Z"}
{"parentUuid":"32db2642-74bc-4afb-89fb-35786abb3e38","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HeEmikYXwrPHdSTpiE7Gzr","type":"tool_result","content":"     1→================================================================================\n     2→  Doc1 — SocialHomes.Ai Base Specification\n     3→  Version: 4.0  |  Date: 2026-02-24\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. PRODUCT OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Product Name\n    11→    SocialHomes.Ai\n    12→\n    13→1.2 Tagline\n    14→    AI-native social housing management for UK housing associations.\n    15→    Secondary: \"AI-native. Human-assured.\"\n    16→\n    17→1.3 Vision\n    18→    To be the first truly AI-native housing management system that embeds\n    19→    predictive intelligence, automation, and contextual assistance into every\n    20→    screen, workflow, and decision — transforming reactive housing operations\n    21→    into proactive, data-driven housing management.\n    22→\n    23→    This is NOT a legacy system with a fresh coat of paint. This must look and\n    24→    feel like nothing the social housing sector has ever seen — think Bloomberg\n    25→    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    26→    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    27→    is the opposite: dark, fast, visually stunning, animated, intelligent.\n    28→\n    29→1.4 Target Market\n    30→    UK Social Housing Providers:\n    31→    - Housing Associations (Registered Providers)\n    32→    - Local Authority housing departments\n    33→    - ALMOs (Arms Length Management Organisations)\n    34→    Typical scale: 5,000–20,000 housing units across multiple regions.\n    35→\n    36→1.5 Simulated Organisation\n    37→    Name:           Riverside Crescent Housing Association (RCHA)\n    38→    RP Number:      4567\n    39→    Regulatory:     G1/V1\n    40→    HQ:             Southwark\n    41→    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    42→    Stock:          75 properties, 68 tenants, 279+ cases\n    43→    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    44→    UPRNs:          Realistic 12-digit references\n    45→    EPCs:           Mapped to real certificates where available\n    46→\n    47→    5 Estates:\n    48→    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    49→    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    50→    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    51→    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    52→    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n    53→\n    54→1.6 Built By\n    55→    Yantra Works — an AI-native development studio.\n    56→\n    57→\n    58→2. CORE FUNCTIONAL MODULES (17 modules)\n    59→================================================================================\n    60→\n    61→2.1 Dashboard\n    62→    Route: /dashboard\n    63→    Purpose: Real-time operational overview with persona-scoped KPIs\n    64→    Features:\n    65→    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n    66→      arrears, compliance %, open complaints, AI alerts)\n    67→    - KPI trend sparklines (12 months)\n    68→    - Charts row: rent collection 12-month trend vs 97% target;\n    69→      repairs monthly volume by priority with avg days line\n    70→    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n    71→      with countdown timers | AI insights scrolling feed\n    72→    - Activity timeline with real-time system event feed\n    73→    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    74→    - Quick action buttons for common tasks\n    75→\n    76→2.2 Visual Drill-Down Explorer (Flagship Feature)\n    77→    Route: /explore\n    78→    Purpose: 7-level spatial hierarchy navigation\n    79→    Hierarchy:\n    80→      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n    81→\n    82→    Layout:\n    83→    ┌────────────────────────────────┬─────────────────────────────────┐\n    84→    │                                │  CONTEXT PANEL (scrollable)     │\n    85→    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │\n    86→    │                                │  - Attribute cards               │\n    87→    │      Interactive Leaflet map   │  - Compliance status             │\n    88→    │      OR Three.js 3D building   │  - KPI metrics                   │\n    89→    │      depending on zoom level   │  - AI insights (purple section)  │\n    90→    │                                │  - Children list (next level)    │\n    91→    │                                │  - Quick actions                  │\n    92→    ├────────────────────────────────┴─────────────────────────────────┤\n    93→    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n    94→    │ Data layer toggles: Crime / Damp Risk / Compliance               │\n    95→    └──────────────────────────────────────────────────────────────────┘\n    96→\n    97→    Features:\n    98→    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    99→    - Three.js 3D building visualization (digital twin) at block level\n   100→    - Context panel with attributes, KPIs, compliance, AI insights\n   101→    - Color-coded units: green (compliant), amber (warning), red (critical),\n   102→      purple (AI flag), grey (void)\n   103→    - Data layer toggles: Crime, Damp Risk, Compliance\n   104→    - Click-through navigation from any level\n   105→\n   106→    Level Details:\n   107→    L0 Country:     England centred, 3 regions, portfolio summary\n   108→    L1 Region:      Zoomed to region, LA areas as markers\n   109→    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n   110→    L3 Estate:      Zoom 16-17, individual buildings as footprints\n   111→    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n   112→                    (FRA, Building Safety Case, communal systems, asbestos plan,\n   113→                    legionella, structural surveys)\n   114→    L4a Core:       For multi-core buildings, schematic floor plan\n   115→    L5 Unit:        Highlighted unit in building model, tabbed detail\n   116→                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n   117→                    Works History, Documents)\n   118→    L6 Tenant:      Full tenant record with tabbed view\n   119→    L7 Case:        Case detail with timeline\n   120→\n   121→2.3 Tenancies Management\n   122→    Route: /tenancies, /tenancies/:id\n   123→    Purpose: Tenancy lifecycle management\n   124→    Features:\n   125→    - Tenancy list with search (name, address, ID, officer), filter, sort\n   126→    - 68 tenants with dynamic count subtitle\n   127→    - Tenancy detail: household composition, rent account, case timeline\n   128→    - Vulnerability detection (AI 7-factor scoring)\n   129→    - Benefits entitlement check\n   130→    - Arrears status with color-coded balance\n   131→    - 52-week transaction ledger with balance trend chart\n   132→    - Action workflows: arrears action, schedule visit, create case\n   133→    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n   134→      referral generators, communication drafters\n   135→\n   136→2.4 Properties Management\n   137→    Route: /properties, /properties/:id, /properties/:id/apply,\n   138→           /properties/:id/book-viewing\n   139→    Purpose: Property and asset data management\n   140→    Features:\n   141→    - Property list with mini Leaflet map in list view\n   142→    - 75 properties with pagination\n   143→    - Property detail: building attributes, compliance certificates, case history\n   144→    - Property Passport (multi-source AI aggregation)\n   145→    - Damp Intelligence Panel (5-factor predictive score)\n   146→    - Compliance timeline (Big 6 certificates)\n   147→    - Viewing bookings and allocation workflow\n   148→    - Digital twin (3D block visualization)\n   149→    - Application page for void properties\n   150→\n   151→2.5 Repairs Management\n   152→    Route: /repairs, /repairs/:id\n   153→    Purpose: Responsive and planned repairs case management\n   154→    Features:\n   155→    - 200+ repair cases with list/kanban toggle\n   156→    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete\n   157→    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n   158→    - Appointment booking with time slots\n   159→    - Operative notes, before/after photos\n   160→    - Contractor verification badges (Gas Safe green, NICEIC blue)\n   161→    - Satisfaction survey (post-completion)\n   162→    - Recurrence prediction (AI)\n   163→    - Cost tracking and authorisation workflow\n   164→    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,\n   165→      priority, trade, Awaab's Law flags\n   166→\n   167→2.6 Compliance Management\n   168→    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n   169→    Purpose: Regulatory compliance tracking and Awaab's Law\n   170→    Features:\n   171→    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n   172→    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n   173→    - Awaab's Law dedicated page:\n   174→      - Emergency hazard response: 24-hour countdown timer\n   175→      - Significant hazard repair: 10–12 week countdown timer\n   176→      - Risk register with property-level assessments\n   177→      - Proactive inspection programme tracking\n   178→    - Building-level compliance: FRA, Building Safety Case\n   179→    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n   180→    - Compliance failure prediction (AI)\n   181→    - No-access tracker, contractor performance\n   182→\n   183→2.7 Complaints Management\n   184→    Route: /complaints, /complaints/:id\n   185→    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n   186→    Features:\n   187→    - 34 complaints with status filtering\n   188→    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n   189→    - Deadline countdown timers with color-coded urgency\n   190→    - Ombudsman escalation pathway\n   191→    - Complaint escalation prediction (AI)\n   192→    - Linked cases and evidence log\n   193→    - TSM CH01/CH02 reporting integration\n   194→    - Categories pie chart, findings breakdown, learning tracker\n   195→\n   196→2.8 Anti-Social Behaviour (ASB)\n   197→    Route: /asb, /asb/:id\n   198→    Purpose: ASB case management with escalation pipeline\n   199→    Features:\n   200→    - 12 ASB cases with severity indicators\n   201→    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n   202→    - Evidence log with timestamps and categories\n   203→    - Live Crime Context (Police.uk data correlation)\n   204→    - ASB hotspot analysis per estate\n   205→    - ASB escalation prediction (AI)\n   206→    - Witness/victim support tracking\n   207→    - Community Trigger threshold monitoring\n   208→    - Multi-agency panel and referral forms\n   209→\n   210→2.9 Rent & Arrears\n   211→    Route: /rent\n   212→    Purpose: Rent management and arrears recovery\n   213→    Features:\n   214→    - Arrears dashboard with band analysis\n   215→    - Pre-Action Protocol (PAP) checklist\n   216→    - Arrears worklist with AI-prioritised scoring (1-100)\n   217→    - Universal Credit tracking and verification\n   218→    - Payment arrangement management\n   219→    - Direct debit integration (GoCardless mock)\n   220→    - HB/UC transition tracking\n   221→    - Arrears risk prediction (AI)\n   222→    - 12-month payment trend analysis\n   223→    - Collection rate gauge, payment method breakdown\n   224→\n   225→2.10 Allocations & Lettings\n   226→    Route: /allocations\n   227→    Purpose: Void management and lettings workflow\n   228→    Features:\n   229→    - Housing register management (Band A-D, bedroom need, medical priority)\n   230→    - Void property kanban: Notice → Keys → Inspection → Works → Quality\n   231→      → Ready → Offer → Let\n   232→    - Void duration prediction (AI)\n   233→    - Days void RAG indicators (green <14, amber 14-28, red >28)\n   234→    - Applicant shortlisting and matching\n   235→    - Viewing booking system\n   236→    - Tenancy sign-up workflow\n   237→    - CORE lettings/sales reporting\n   238→\n   239→2.11 Communications\n   240→    Route: /communications\n   241→    Purpose: Unified multi-channel inbox\n   242→    Features:\n   243→    - Unified inbox (email, SMS, letter, portal message)\n   244→    - GOV.UK Notify template integration (24 templates, 7 categories)\n   245→    - Template rendering with ((field)) personalisation\n   246→    - Message history per tenant\n   247→    - Bulk communications\n   248→    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n   249→    - AI triage: auto-categorise, priority, sentiment, suggested response\n   250→    - Tone options: Supportive / Formal / Urgent / Legally required\n   251→\n   252→2.12 Reports & Analytics\n   253→    Route: /reports, /reports/:type, /reports/tsm\n   254→    Purpose: Regulatory reporting and operational analytics\n   255→    Features:\n   256→    - 27 regulatory reports\n   257→    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n   258→    - CORE lettings and sales returns\n   259→    - Consumer Standards compliance scorecard\n   260→    - Housing Ombudsman reporting\n   261→    - Building Safety Act compliance reporting\n   262→    - Dynamic report builder with filters\n   263→    - CSV/PDF export capability\n   264→    - Trend charts, sector median/quartile benchmarking\n   265→    - AI-generated narrative summary per report\n   266→    Report Categories:\n   267→    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n   268→    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n   269→    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n   270→      EPC/Energy\n   271→    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n   272→      void loss\n   273→    - Governance: Board pack, risk register, H&S summary\n   274→    - Tenant-facing: Annual report, estate reports\n   275→\n   276→2.13 AI Centre\n   277→    Route: /ai-centre\n   278→    Purpose: AI capabilities hub and differentiator showcase\n   279→    Features:\n   280→    - Insights tab: AI-generated operational insights with confidence %,\n   281→      affected entities, action buttons\n   282→    - Predictions tab: 8 predictive models dashboard with scatter plots,\n   283→      top-50 table, feature importance, accuracy gauges\n   284→    - Differentiators tab: 7 killer differentiator feature cards with\n   285→      vulnerability scan\n   286→    - Assistant tab: Conversational AI interface (Yantra Assist)\n   287→\n   288→2.14 AI Morning Briefing\n   289→    Route: /briefing\n   290→    Purpose: Personalised daily operational briefing\n   291→    Features:\n   292→    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n   293→      attention today\")\n   294→    - Weather forecast with property impact assessment\n   295→    - Today's tasks with priority indicators and action buttons\n   296→    - AI predictions and alerts\n   297→    - Estate-level neighbourhood briefing accordion\n   298→    - Compliance section with Big 6 stats\n   299→    - [Start my day →] and [Skip briefing] buttons\n   300→\n   301→2.15 Admin System\n   302→    Route: /admin, /admin/integrations\n   303→    Purpose: System configuration and management\n   304→    Features:\n   305→    - Organisation profile and branding\n   306→    - User management with RBAC (10 default roles × permission matrix)\n   307→    - Team and patch management with caseload balancing\n   308→    - Workflow engine (visual builder with triggers/conditions/actions)\n   309→    - Integration hub (20 integrations across 3 tiers)\n   310→    - Integration toggle, test connection, status monitoring\n   311→    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n   312→      old/new value, IP)\n   313→    - GDPR tools (SAR processor, right to erasure, retention policies,\n   314→      consent management, Data Processing Register)\n   315→    - System reference data configuration (editable lookup tables)\n   316→    - Notification configuration\n   317→    - AI model configuration (toggle on/off, confidence thresholds)\n   318→    - White-label: multi-HA deployment support\n   319→\n   320→2.16 Tenant Portal\n   321→    Route: /tenant-portal\n   322→    Purpose: Tenant self-service interface\n   323→    Features:\n   324→    - Distinct lighter/warmer UI theme (visually separate from staff system)\n   325→    - Report repair (conversational wizard: room → problem → photo →\n   326→      appointment → confirm)\n   327→    - Check rent balance and make payment\n   328→    - View active repairs with photos and status\n   329→    - Quick message to housing officer\n   330→    - Document access\n   331→    - Larger text, no jargon, large touch targets\n   332→\n   333→2.17 Global Search\n   334→    Route: /search\n   335→    Purpose: Cross-entity full-text search\n   336→    Features:\n   337→    - Global search bar in header\n   338→    - Searches across tenants, properties, cases, communications\n   339→    - Results grouped by entity type\n   340→    - Direct navigation to entity detail\n   341→\n   342→\n   343→3. PERSONA SYSTEM\n   344→================================================================================\n   345→\n   346→3.1 Overview\n   347→    5 operational personas with scoped data visibility and dashboard layout.\n   348→    Persona selection via sidebar switcher. Persisted per session.\n   349→\n   350→3.2 Persona Definitions\n   351→\n   352→    PERSONA 1: Chief Operating Officer (COO)\n   353→    Scope: Organisation-wide\n   354→    Dashboard: High-level KPIs, financial summary, compliance overview,\n   355→              risk heatmap\n   356→    Access: Full read/write, admin settings, reports\n   357→    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n   358→              financial performance, TSM trajectory\n   359→    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n   360→                \"Benchmark against sector\"\n   361→\n   362→    PERSONA 2: Head of Housing\n   363→    Scope: Regional (multiple Local Authorities)\n   364→    Dashboard: Regional performance, team metrics, escalated cases\n   365→    Access: Team management, regional reports, case oversight\n   366→    AI Focus: Operational — SLA performance, team capacity, complaint trends\n   367→    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n   368→\n   369→    PERSONA 3: Housing Manager\n   370→    Scope: Estate/Block level\n   371→    Dashboard: Estate KPIs, staff workload, compliance deadlines\n   372→    Access: Case assignment, approval workflows, local reports\n   373→    AI Focus: Team management — workload, case overdue, skill gaps\n   374→    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n   375→\n   376→    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n   377→    Scope: Assigned patch (specific estates/blocks)\n   378→    Dashboard: Caseload worklist, today's visits, tenant alerts\n   379→    Access: Case CRUD, tenant interactions, notes\n   380→    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n   381→    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n   382→                referral generators, communication drafters on every page\n   383→\n   384→    PERSONA 5: Repairs Operative\n   385→    Scope: Assigned jobs\n   386→    Dashboard: Today's job list, materials, access notes\n   387→    Access: Repair status updates, photos, completion notes\n   388→    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n   389→    No access to: Financial data, personal tenant details beyond job needs\n   390→\n   391→\n   392→4. AI-NATIVE FEATURES\n   393→================================================================================\n   394→\n   395→4.1 Core Principle: Dynamic AI Interface Elements\n   396→    Every entity page has TWO zones:\n   397→    1. Standard zone: Fixed fields, tabs, buttons — always present\n   398→    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n   399→       change based on context\n   400→\n   401→    Dynamic elements include:\n   402→    - Dynamic action buttons — only appear when AI determines they're relevant\n   403→    - Dynamic info cards — contextual information the system thinks user needs\n   404→    - Dynamic prompts — questions AI asks user, answering triggers workflows\n   405→    - Dynamic warnings — alerts about this entity needing attention\n   406→    - Dynamic information fields — calculated data not in standard layout\n   407→\n   408→    Styling: Purple left border (--status-ai), --surface-elevated background,\n   409→    \"✦\" symbol prefix on AI-generated content\n   410→\n   411→4.2 The AI Action Flow Pattern\n   412→    Every AI dynamic button follows this pattern:\n   413→    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n   414→    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n   415→    3. EDIT: User can edit anything in the preview\n   416→    4. CONFIRM: User approves the action\n   417→    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n   418→    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n   419→    7. LEARN: System records accept/modify/reject for model improvement\n   420→\n   421→4.3 Yantra Assist\n   422→    Location: Bottom-left floating trigger (all pages)\n   423→    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n   424→    Panel: 400px, slides from left, overlaying sidebar\n   425→    Content changes based on current page/entity AND user persona\n   426→\n   427→    Panel Structure:\n   428→    - 🔴 URGENT: Items needing immediate action\n   429→    - 🟠 ATTENTION: Items approaching deadlines\n   430→    - 💡 INSIGHTS: AI predictions & recommendations\n   431→    - 📊 BRIEFING: Contextual summary & key stats\n   432→    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context\n   433→    - [Ask Yantra...] chat input at bottom\n   434→\n   435→    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n   436→\n   437→4.4 Prediction Models (8 total)\n   438→    MODEL 1: Arrears Risk\n   439→      Input: Payment history, UC status, seasonal patterns, life events\n   440→      Output: Risk score (0–100), predicted arrears amount, recommended actions\n   441→\n   442→    MODEL 2: Damp & Mould Risk\n   443→      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n   444→             IoT sensors (0.20), occupancy (0.10)\n   445→      Output: Risk score (0–100), factor breakdown, proactive recommendations\n   446→\n   447→    MODEL 3: Complaint Escalation\n   448→      Input: Response times, complaint category, tenant history, complexity\n   449→      Output: Escalation probability, recommended priority, deadline warnings\n   450→\n   451→    MODEL 4: Void Duration\n   452→      Input: Property type, condition, location, market demand, works needed\n   453→      Output: Predicted void days, optimal marketing strategy\n   454→\n   455→    MODEL 5: Repair Recurrence\n   456→      Input: Component age, repair history, building type, contractor quality\n   457→      Output: Recurrence probability, recommended planned maintenance\n   458→\n   459→    MODEL 6: Vulnerability Detection\n   460→      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n   461→             social isolation (0.15), age risk (0.10), dependents (0.10),\n   462→             UC transition (0.10)\n   463→      Output: Vulnerability score (0–100), detected flags, recommended support\n   464→\n   465→    MODEL 7: ASB Escalation\n   466→      Input: Case history, estate context, crime data, tenant profile\n   467→      Output: Escalation risk, recommended intervention level\n   468→\n   469→    MODEL 8: Compliance Failure\n   470→      Input: Certificate expiry, contractor availability, building complexity\n   471→      Output: Failure probability, priority scheduling recommendations\n   472→\n   473→4.5 Seven Killer Differentiators (All Implemented)\n   474→    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n   475→        Service: server/src/services/damp-prediction.ts\n   476→        Frontend: DampIntelligencePanel component on property detail\n   477→\n   478→    D2: Live Crime Context for ASB — Police.uk data correlation\n   479→        Service: server/src/services/crime-context.ts\n   480→        Frontend: Crime data layer on Explore map, ASB detail page\n   481→\n   482→    D3: Automatic Vulnerability Detection — 7-factor scoring\n   483→        Service: server/src/services/vulnerability-detection.ts\n   484→        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n   485→\n   486→    D4: Property Passport — Multi-source property dossier\n   487→        Service: server/src/services/property-passport.ts\n   488→        Frontend: Property detail page aggregation\n   489→\n   490→    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n   491→        Service: server/src/services/benefits-engine.ts\n   492→        Frontend: BenefitsPanel on tenancy detail\n   493→\n   494→    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n   495→        Service: server/src/services/neighbourhood-briefing.ts\n   496→        Frontend: NeighbourhoodBriefingPanel on briefing page\n   497→\n   498→    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n   499→        Service: server/src/services/mock-services.ts\n   500→        Frontend: Property detail page (sensor data display)\n   501→\n   502→4.6 AI-Augmented Workflows\n   503→    - Repair Logging: Tenant describes issue → AI categorises SOR code,\n   504→      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n   505→      checks recurring pattern, estimates cost, flags Awaab's Law\n   506→    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n   507→      suggests appropriate case type, pre-fills forms\n   508→    - Communication Sending: AI generates drafts using correct templates,\n   509→      tenant details, plain English, legally required wording, tone options\n   510→    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n   511→      contractor instructions, pre-booked appointments\n   512→    - Complaint Prevention: AI detects patterns (multiple calls, declining\n   513→      satisfaction), generates prevention plan\n   514→\n   515→4.7 Signature AI Interactions\n   516→    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task\n   517→    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)\n   518→    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference\n   519→       → preventive advice letters → inspection tasks\n   520→    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar\n   521→    5. \"Complaint Prevention\" — pattern detection → prevention plan execution\n   522→\n   523→\n   524→5. DATA MODEL (SUMMARY)\n   525→================================================================================\n   526→\n   527→5.1 Core Entities\n   528→    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n   529→    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n   530→    - Tenancy — property–tenant link, start date, type, rent, balance\n   531→    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n   532→    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n   533→    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n   534→    - ASB (12 records) — severity, escalation level, evidence log\n   535→    - Activity — timeline events for any entity\n   536→    - Task — assigned work items with due dates\n   537→\n   538→5.2 Supporting Entities\n   539→    - Organisation — RCHA metadata, branding, settings\n   540→    - Region (3) — London, South, Midlands\n   541→    - Local Authority — Southwark, Lewisham, Lambeth\n   542→    - Estate (5) — name, location, block count, manager\n   543→    - Block — floors, cores, unit count\n   544→    - User — auth profile, role, persona, team\n   545→    - Team — name, manager, patch, members\n   546→    - Integration — external service config (20 integrations)\n   547→    - Report — template definitions (27 reports)\n   548→    - ExternalDataCache — TTL-based cache for API responses\n   549→\n   550→5.3 Firestore Collections (17)\n   551→    users, properties, tenants, cases, activities, tasks,\n   552→    repairs, complaints, asb, financial, damp-mould,\n   553→    organisations, teams, integrations, auditLog,\n   554→    externalDataCache, imdData\n   555→\n   556→5.4 Case Reference Formats\n   557→    | Type        | Format           | Colour  |\n   558→    |-------------|------------------|---------|\n   559→    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n   560→    | Repair      | REP-YYYY-XXXXX   | Blue    |\n   561→    | ASB         | ASB-YYYY-XXXXX   | Red     |\n   562→    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n   563→    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n   564→    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n   565→    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n   566→\n   567→5.5 TypeScript Type System (721 lines)\n   568→    Frontend types defined in app/src/types/index.ts covering:\n   569→    - 6 persona/user types (Persona, User)\n   570→    - 7 geography types (Region, LocalAuthority, Estate, Block)\n   571→    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n   572→    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n   573→    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n   574→    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n   575→    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n   576→    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n   577→    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n   578→    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n   579→\n   580→\n   581→6. USER INTERFACE DESIGN\n   582→================================================================================\n   583→\n   584→6.1 Theme\n   585→    Brand: Yantra Works dark theme\n   586→    Primary Background: --surface-dark (#0D1117)\n   587→    Card Background: --surface-card (#151B23)\n   588→    Elevated: --surface-elevated (#1C2333)\n   589→    Hover: --surface-hover (#222D3D)\n   590→    Accent: --brand-teal (#058995)\n   591→    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n   592→    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n   593→    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n   594→\n   595→6.2 Typography\n   596→    Headings: \"Space Grotesk\", sans-serif — bold, technical\n   597→    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n   598→    Monospace: \"JetBrains Mono\", monospace — references, codes\n   599→    Headings in --brand-peach on dark backgrounds\n   600→    Section labels: --brand-teal, uppercase, letter-spaced\n   601→\n   602→6.3 Layout\n   603→    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n   604→    - Top header with logo, global search, notifications, AI trigger, user menu\n   605→    - Breadcrumb navigation reflecting hierarchy\n   606→    - Main content area with responsive grid (max 1400px)\n   607→    - Yantra Assist floating panel (bottom-left)\n   608→    - Phase banner: garnet \"BETA\" tag\n   609→\n   610→6.4 Navigation Items (Sidebar)\n   611→    NAVIGATE: Explore, Dashboard\n   612→    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n   613→            Complaints, Allocations, ASB\n   614→    COMMUNICATE: Communications\n   615→    ANALYSE: Reports, AI Centre\n   616→    SYSTEM: Admin, Settings\n   617→    + Persona Switcher\n   618→\n   619→6.5 Design Principles\n   620→    - Dark mode is default — Yantra Works brand palette throughout\n   621→    - Mobile-aware responsive design\n   622→    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)\n   623→    - Skip-to-content link\n   624→    - Reduced-motion support (@media prefers-reduced-motion)\n   625→    - Focus-visible outlines on all interactive elements\n   626→    - Screen-reader-only (.sr-only) text for context\n   627→    - Animations throughout — staggered reveals, sliding panels, smooth\n   628→      transitions, pulsing alerts. UI must feel ALIVE, not static.\n   629→    - UK conventions: DD/MM/YYYY, British English, GBP £\n   630→\n   631→6.6 Component Library\n   632→    - KpiCard — metric display with trend sparkline\n   633→    - StatusPill — status badge (green/amber/red)\n   634→    - ActionModal — accessible form modal with focus trap, Escape handler,\n   635→      aria attributes, form validation, previous focus restoration\n   636→    - AiActionCard — purple-bordered AI suggestion card\n   637→    - CountdownTimer — deadline countdown with color urgency transitions\n   638→      (green → peach → garnet → pulsing garnet)\n   639→    - PropertyMap — Leaflet map with markers\n   640→    - HelpDrawer — full-screen contextual help (20 topics)\n   641→    - DampIntelligencePanel — damp risk factor display with score badge\n   642→    - VulnerabilityPanel — 7-factor vulnerability assessment\n   643→    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n   644→    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n   645→    - ProtectedRoute — Firebase auth guard component\n   646→\n   647→\n   648→7. REGULATORY COMPLIANCE\n   649→================================================================================\n   650→\n   651→7.1 Housing Regulations Supported\n   652→    - Housing Ombudsman Complaint Handling Code (2024)\n   653→    - Awaab's Law (Social Housing Regulation Act 2023)\n   654→    - Building Safety Act 2022\n   655→    - Regulator of Social Housing (RSH) Consumer Standards\n   656→    - Tenant Satisfaction Measures (TSM) Standard\n   657→    - CORE lettings and sales data collection\n   658→    - Gas Safety (Installation and Use) Regulations 1998\n   659→    - Electrical Safety Standards in the Private Rented Sector\n   660→    - Regulatory Reform (Fire Safety) Order 2005\n   661→    - Control of Asbestos Regulations 2012\n   662→    - Legionella risk assessment (HSE ACoP L8)\n   663→    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n   664→\n   665→7.2 GDPR Compliance\n   666→    - Full audit trail on all data operations\n   667→    - Subject Access Request (SAR) processor\n   668→    - Right to erasure workflow\n   669→    - Data retention policy configuration\n   670→    - Consent management\n   671→    - Data Processing Register\n   672→\n   673→7.3 Accessibility (WCAG AA)\n   674→    - Focus traps in modals (ActionModal)\n   675→    - Skip-to-content link (Layout component)\n   676→    - Keyboard navigation (Tab, Escape)\n   677→    - ARIA labels, roles, described-by\n   678→    - Reduced-motion media query\n   679→    - Color contrast ratio ≥ 4.5:1\n   680→    - Screen-reader-only text (.sr-only)\n   681→    - Focus-visible outlines (*:focus-visible)\n   682→\n   683→\n   684→8. NON-FUNCTIONAL REQUIREMENTS\n   685→================================================================================\n   686→\n   687→8.1 Performance\n   688→    - API response time (P95): < 500ms (current ~200-300ms)\n   689→    - Frontend bundle size: < 3MB (current ~2.5MB)\n   690→    - Cloud Run cold start: < 3s (current < 2s)\n   691→    - Firestore query latency: < 200ms\n   692→    - AI response latency (target): < 3s for conversational queries\n   693→\n   694→8.2 Security\n   695→    - Firebase Authentication with Google sign-in\n   696→    - RBAC with 10 default roles (super-admin through read-only)\n   697→    - CSP headers with whitelist\n   698→    - CORS restricted to allowed origins\n   699→    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   700→    - Security headers (Permissions-Policy, X-Content-Type-Options,\n   701→      X-Frame-Options, Referrer-Policy, HSTS)\n   702→    - Secret Manager for all credentials (no secrets in code)\n   703→    - JSON body limit 1MB\n   704→    - Request correlation via X-Request-ID\n   705→\n   706→8.3 Scalability\n   707→    - Cloud Run: 0–10 instances (auto-scaling)\n   708→    - Firestore: NoSQL, horizontally scalable\n   709→    - External API caching reduces load\n   710→    - Concurrency: 80 requests/instance\n   711→\n   712→8.4 Availability\n   713→    - Cloud Run SLA: 99.95%\n   714→    - External API fallbacks (simulated data on failure)\n   715→    - Health check with Firestore connectivity monitoring\n   716→    - States: healthy / degraded / unhealthy\n   717→\n   718→8.5 Testing\n   719→    - Selenium E2E: 331 tests, 99.7% pass rate\n   720→    - Unit tests: 66 tests for public data APIs\n   721→    - TypeScript: 0 errors (strict mode)\n   722→    - Vite build: 0 critical warnings\n   723→\n   724→\n   725→9. SIMULATED DATA\n   726→================================================================================\n   727→\n   728→9.1 Scale\n   729→    75 properties, 68 active tenancies, 5 voids\n   730→    Realistic SE London postcodes, 12-digit UPRNs\n   731→    Diverse tenant names reflecting London demographics\n   732→\n   733→9.2 Financial Profile\n   734→    Rents: social £95-140/week, affordable £140-200/week\n   735→    Service charges: £5-35/week\n   736→    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n   737→    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n   738→\n   739→9.3 Cases\n   740→    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n   741→    34 open complaints (28 Stage 1, 6 Stage 2)\n   742→    12 ASB cases\n   743→    8 damp/mould cases (3 emergency, 5 significant)\n   744→    25 financial cases\n   745→    5 voids at various pipeline stages\n   746→\n   747→9.4 Compliance\n   748→    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n   749→    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n   750→\n   751→\n   752→10. CURRENT STATUS & METRICS\n   753→================================================================================\n   754→\n   755→10.1 Production Deployment\n   756→    URL: https://socialhomes-587984201316.europe-west2.run.app\n   757→    Region: europe-west2 (London)\n   758→    Status: LIVE and operational\n   759→    Database: 460+ documents across 17 Firestore collections\n   760→\n   761→10.2 Build Metrics\n   762→    | Metric                    | Value           |\n   763→    |---------------------------|-----------------|\n   764→    | Frontend modules          | 3,397           |\n   765→    | Frontend build time       | ~35–39 seconds  |\n   766→    | Backend TypeScript errors | 0               |\n   767→    | Frontend TypeScript errors| 0               |\n   768→    | Selenium tests            | 331             |\n   769→    | Selenium pass rate        | 99.7%           |\n   770→    | Unit tests (public data)  | 66              |\n   771→    | Firestore collections     | 17              |\n   772→    | Seeded properties         | 75              |\n   773→    | Seeded tenants            | 68              |\n   774→    | Seeded cases              | 279+            |\n   775→    | API endpoints             | 50+             |\n   776→    | Frontend routes           | 40+             |\n   777→    | Lines of code             | ~24,000         |\n   778→    | Frontend TypeScript files | 73              |\n   779→    | Backend TypeScript files  | 43              |\n   780→    | Type definitions          | 721 lines       |\n   781→\n   782→10.3 Phase Completion\n   783→    Phase 0: Infrastructure        — DONE (10/10)\n   784→    Phase 1: Foundation            — DONE (12/12)\n   785→    Phase 2: Intelligence          — DONE (14/14)\n   786→    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n   787→    Phase 4: Completion            — DONE (11/14, 3 deferred)\n   788→    Phase 5: Evolution             — TODO (0/36)\n   789→\n   790→================================================================================\n   791→  End of Doc1 — SocialHomes.Ai Base Specification\n   792→  Yantra Works | 2026-02-24\n   793→================================================================================\n   794→"}]},"uuid":"1812e06f-3115-4afb-8ffc-007110818f81","timestamp":"2026-02-25T15:23:19.253Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 4.0  |  Date: 2026-02-24\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n\n    Layout:\n    ┌────────────────────────────────┬─────────────────────────────────┐\n    │                                │  CONTEXT PANEL (scrollable)     │\n    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │\n    │                                │  - Attribute cards               │\n    │      Interactive Leaflet map   │  - Compliance status             │\n    │      OR Three.js 3D building   │  - KPI metrics                   │\n    │      depending on zoom level   │  - AI insights (purple section)  │\n    │                                │  - Children list (next level)    │\n    │                                │  - Quick actions                  │\n    ├────────────────────────────────┴─────────────────────────────────┤\n    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n    │ Data layer toggles: Crime / Damp Risk / Compliance               │\n    └──────────────────────────────────────────────────────────────────┘\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice → Keys → Inspection → Works → Quality\n      → Ready → Offer → Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day →] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles × permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room → problem → photo →\n      appointment → confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"✦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - 🔴 URGENT: Items needing immediate action\n    - 🟠 ATTENTION: Items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: Contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue → AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task\n    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference\n       → preventive advice letters → inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar\n    5. \"Complaint Prevention\" — pattern detection → prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP £\n\n6.6 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green → peach → garnet → pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social £95-140/week, affordable £140-200/week\n    Service charges: £5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/36)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-24\n================================================================================\n","numLines":794,"startLine":1,"totalLines":794}},"sourceToolAssistantUUID":"32db2642-74bc-4afb-89fb-35786abb3e38"}
{"parentUuid":"1812e06f-3115-4afb-8ffc-007110818f81","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QmbP9sVmmXuBaytYZEaaGa","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"ad3299ec-d553-40dd-a918-46b7b06b37df","timestamp":"2026-02-25T15:23:19.497Z"}
{"parentUuid":"ad3299ec-d553-40dd-a918-46b7b06b37df","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QmbP9sVmmXuBaytYZEaaGa","type":"tool_result","content":"     1→================================================================================\n     2→  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n     3→  Version: 3.0  |  Date: 2026-02-23\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. SYSTEM ARCHITECTURE OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Architecture Style\n    11→    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    12→    deployed as a single container on Google Cloud Run. The Express server\n    13→    serves both the API and the built React static assets.\n    14→\n    15→1.2 High-Level Architecture Diagram (ASCII)\n    16→\n    17→    ┌─────────────────────────────────────────────────────────────────┐\n    18→    │                        CLOUD RUN (europe-west2)                │\n    19→    │  ┌───────────────────────────────────────────────────────────┐  │\n    20→    │  │                    Express.js Server                      │  │\n    21→    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    22→    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    23→    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    24→    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    25→    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    26→    │  │  │ Output       │  │ modules      │  │               │  │  │\n    27→    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    28→    │  └───────────────────────────┼───────────────────────────────┘  │\n    29→    │                              │                                  │\n    30→    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    31→    │  │                    Service Layer (25 modules)             │  │\n    32→    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    33→    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    34→    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    35→    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    36→    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    37→    │  └───────────────────────────┼───────────────────────────────┘  │\n    38→    └──────────────────────────────┼──────────────────────────────────┘\n    39→                                   │\n    40→              ┌────────────────────┼────────────────────┐\n    41→              │                    │                     │\n    42→    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    43→    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    44→    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    45→    └────────────────┘  └────────────────┘  └────────────────┘\n    46→              │\n    47→    ┌─────────▼──────────────────────────────────────────┐\n    48→    │              External APIs (3 Tiers)               │\n    49→    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    50→    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    51→    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    52→    └────────────────────────────────────────────────────┘\n    53→\n    54→1.3 Request Flow Diagram\n    55→\n    56→    Browser → React SPA → api-client.ts → HTTP Request\n    57→                                              │\n    58→                                              ▼\n    59→    Express Server ← Middleware Pipeline ← Route Handler\n    60→         │               │\n    61→         │     ┌─────────┴──────────────────────────┐\n    62→         │     │ Morgan → Helmet → CORS → Compression│\n    63→         │     │ → JSON Parser (1MB) → X-Request-ID  │\n    64→         │     │ → Rate Limiter → Metrics → Handler   │\n    65→         │     │ → Error Handler → Response            │\n    66→         │     └──────────────────────────────────────┘\n    67→         │\n    68→         ├─→ Firestore (read/write)\n    69→         ├─→ External API Proxy (with cache)\n    70→         └─→ AI Service (computation)\n    71→\n    72→\n    73→2. TECHNOLOGY STACK\n    74→================================================================================\n    75→\n    76→2.1 Frontend Stack\n    77→\n    78→    | Component          | Technology              | Version    |\n    79→    |--------------------|-------------------------|------------|\n    80→    | Framework          | React                   | 19.2.0     |\n    81→    | Language           | TypeScript              | 5.9.3      |\n    82→    | Router             | React Router            | v7         |\n    83→    | Styling            | Tailwind CSS            | 4.1.18     |\n    84→    | State Management   | React Context + Hooks   | —          |\n    85→    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    86→    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    87→    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    88→    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    89→    | Icons              | Lucide React            | 0.563.0    |\n    90→    | Auth UI            | FirebaseUI              | latest     |\n    91→    | Build Tool         | Vite                    | 7.2.4      |\n    92→\n    93→2.2 Backend Stack\n    94→\n    95→    | Component          | Technology              | Version    |\n    96→    |--------------------|-------------------------|------------|\n    97→    | Framework          | Express.js              | 4.21.2     |\n    98→    | Language           | TypeScript              | 5.7.0      |\n    99→    | Runtime            | Node.js                 | 20.17.0    |\n   100→    | Database           | Google Firestore        | Native     |\n   101→    | Auth               | Firebase Admin SDK      | 13.6.1     |\n   102→    | Security           | Helmet                  | 8.1.0      |\n   103→    | CORS               | cors                    | 2.8.5      |\n   104→    | Logging            | Morgan                  | 1.10.0     |\n   105→    | Compression        | compression             | 1.8.0      |\n   106→    | Testing            | Vitest                  | 4.0.18     |\n   107→    | Build              | tsc + tsx                | latest     |\n   108→\n   109→2.3 Infrastructure\n   110→\n   111→    | Component          | Technology              | Details              |\n   112→    |--------------------|-------------------------|----------------------|\n   113→    | Hosting            | Google Cloud Run        | europe-west2         |\n   114→    | Container Registry | Artifact Registry       | europe-west2         |\n   115→    | Database           | Google Firestore        | Native mode          |\n   116→    | Authentication     | Firebase Auth           | Google SSO + email   |\n   117→    | Secrets            | Secret Manager          | 4 secrets            |\n   118→    | CI/CD              | Cloud Build             | Auto on git push     |\n   119→    | Source Control     | GitHub                  | rajivpeter repo      |\n   120→    | Monitoring         | Custom metrics + health | In-app               |\n   121→    | Session Capture    | Entire.io               | Manual commit        |\n   122→\n   123→2.4 Testing Stack\n   124→\n   125→    | Component          | Technology              | Coverage             |\n   126→    |--------------------|-------------------------|----------------------|\n   127→    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n   128→    | Unit               | Vitest                  | 66 tests             |\n   129→    | Type Checking      | TypeScript (strict)     | 0 errors             |\n   130→\n   131→\n   132→3. FRONTEND ARCHITECTURE\n   133→================================================================================\n   134→\n   135→3.1 Directory Structure\n   136→\n   137→    app/src/\n   138→    ├── App.tsx                  — Router with 40+ routes\n   139→    ├── main.tsx                 — React DOM entry point (QueryClient)\n   140→    ├── index.css                — Global styles, animations, accessibility\n   141→    │\n   142→    ├── pages/                   — 19 page directories\n   143→    │   ├── admin/               — AdminPage, IntegrationsPage\n   144→    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)\n   145→    │   ├── allocations/         — AllocationsPage\n   146→    │   ├── asb/                 — AsbPage, AsbDetailPage\n   147→    │   ├── auth/                — LoginPage (Firebase + Google)\n   148→    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)\n   149→    │   ├── communications/      — CommunicationsPage\n   150→    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n   151→    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n   152→    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)\n   153→    │   ├── explore/             — ExplorePage (7-level drill-down)\n   154→    │   ├── properties/          — PropertiesPage, PropertyDetailPage,\n   155→    │   │                          ApplicationPage, ViewingBookingPage\n   156→    │   ├── rent/                — RentPage\n   157→    │   ├── repairs/             — RepairsPage, RepairDetailPage\n   158→    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n   159→    │   ├── search/              — SearchPage\n   160→    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n   161→    │   ├── tenant-portal/       — TenantPortalPage\n   162→    │   └── shared/              — ComingSoonPage\n   163→    │\n   164→    ├── components/\n   165→    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n   166→    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,\n   167→    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n   168→    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n   169→    │                              PropertyMap, StatusPill, VulnerabilityPanel)\n   170→    │\n   171→    ├── data/                    — Mock/seed data (10 files)\n   172→    ├── hooks/                   — Custom hooks (3 files)\n   173→    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods\n   174→    │   ├── useEntityIntelligence.ts  — AI scoring hooks\n   175→    │   └── usePersonaScope.ts   — Persona-based data filtering\n   176→    ├── types/                   — TypeScript definitions (721 lines)\n   177→    ├── services/                — API client (70+ methods), Firebase, AI drafting,\n   178→    │                              public data helpers\n   179→    ├── contexts/                — AuthContext, AppContext\n   180→    ├── utils/                   — Formatting utilities (safeText, etc.)\n   181→    └── assets/                  — Images, fonts\n   182→\n   183→3.2 Routing Architecture (React Router v7)\n   184→    All routes defined in App.tsx within BrowserRouter.\n   185→    Routes wrapped in Layout component (sidebar + header).\n   186→    Protected routes use ProtectedRoute component (Firebase auth guard).\n   187→\n   188→    Key Route Groups:\n   189→    /                           → Redirect to /dashboard\n   190→    /login                      → LoginPage (public)\n   191→    /dashboard                  → DashboardPage\n   192→    /explore                    → ExplorePage\n   193→    /tenancies                  → TenanciesPage\n   194→    /tenancies/:id              → TenancyDetailPage\n   195→    /properties                 → PropertiesPage\n   196→    /properties/:id             → PropertyDetailPage\n   197→    /properties/:id/apply       → ApplicationPage\n   198→    /properties/:id/book-viewing→ ViewingBookingPage\n   199→    /repairs                    → RepairsPage\n   200→    /repairs/:id                → RepairDetailPage\n   201→    /compliance                 → CompliancePage\n   202→    /compliance/:type           → ComplianceTypePage\n   203→    /compliance/awaabs-law      → AwaabsLawPage\n   204→    /complaints                 → ComplaintsPage\n   205→    /complaints/:id             → ComplaintDetailPage\n   206→    /asb                        → AsbPage\n   207→    /asb/:id                    → AsbDetailPage\n   208→    /rent                       → RentPage\n   209→    /allocations                → AllocationsPage\n   210→    /communications             → CommunicationsPage\n   211→    /reports                    → ReportsPage\n   212→    /reports/:type              → DynamicReportPage\n   213→    /reports/tsm                → TsmReportPage\n   214→    /ai-centre                  → AiCentrePage\n   215→    /briefing                   → BriefingPage\n   216→    /admin                      → AdminPage\n   217→    /admin/integrations         → IntegrationsPage\n   218→    /tenant-portal              → TenantPortalPage\n   219→    /search                     → SearchPage\n   220→\n   221→3.3 State Management\n   222→    - React Context for global state (auth user, persona)\n   223→    - @tanstack/react-query for server state (API caching, 5-min stale time)\n   224→    - Local component state (useState, useReducer) for UI state\n   225→    - No Redux/Zustand — kept deliberately simple\n   226→\n   227→3.4 Data Fetching Layer\n   228→    - api-client.ts: 70+ typed API methods organized by domain\n   229→    - useApi.ts: React Query hooks wrapping api-client methods\n   230→    - useEntityIntelligence.ts: AI scoring hooks\n   231→    - usePersonaScope.ts: Persona-based data filtering\n   232→\n   233→3.5 Frontend Conventions\n   234→    - safeText() helper for rendering potentially undefined values\n   235→    - ?? [] for nullable arrays (prevents React Error #310)\n   236→    - Tailwind CSS utility classes (no CSS modules)\n   237→    - Lucide React for all icons\n   238→    - Purple border for AI-generated elements\n   239→    - Consistent page structure: header + filter bar + content grid\n   240→    - ErrorBoundary wrapping for error resilience\n   241→\n   242→3.6 Accessibility Implementation\n   243→    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n   244→      aria-modal, aria-labelledby, aria-describedby, focus restoration\n   245→    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n   246→      .sr-only class, .skip-to-content link, .field-error styles\n   247→    - Layout: skip-to-content link + id=\"main-content\" on <main>\n   248→    - Sidebar: aria-label on <nav> and collapse button\n   249→    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n   250→\n   251→\n   252→4. BACKEND ARCHITECTURE\n   253→================================================================================\n   254→\n   255→4.1 Directory Structure\n   256→\n   257→    server/src/\n   258→    ├── index.ts                 — Express entry, middleware, route registration\n   259→    │\n   260→    ├── middleware/               — 5 middleware modules\n   261→    │   ├── auth.ts              — Firebase token verification + X-Persona fallback\n   262→    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)\n   263→    │   ├── metrics.ts           — Request/response metrics recording\n   264→    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n   265→    │   └── rbac.ts              — Role-based access control\n   266→    │\n   267→    ├── routes/                  — 16 route modules (2,300+ lines)\n   268→    │   ├── admin.ts             — Integration management, monitoring\n   269→    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n   270→    │   ├── auth.ts              — Login, register, logout\n   271→    │   ├── briefing.ts          — Personalised morning briefing\n   272→    │   ├── booking.ts           — Viewing bookings, applications\n   273→    │   ├── cases.ts             — Unified case CRUD + pagination\n   274→    │   ├── compliance.ts        — Big 6 compliance data\n   275→    │   ├── explore.ts           — Hierarchy drill-down data\n   276→    │   ├── export.ts            — CSV/PDF exports\n   277→    │   ├── lettings.ts          — Void management, allocations\n   278→    │   ├── properties.ts        — Property list/detail\n   279→    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n   280→    │   ├── rent.ts              — Arrears, statements, transactions\n   281→    │   ├── reports.ts           — 27 regulatory reports\n   282→    │   └── tenants.ts           — Tenant list/detail\n   283→    │\n   284→    ├── services/                — 25 service modules\n   285→    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n   286→    │   ├── firestore.ts         — Firestore connection + helpers\n   287→    │   ├── firebase-admin.ts    — Firebase Admin initialization\n   288→    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n   289→    │   ├── crime-context.ts     — Police data correlation\n   290→    │   ├── vulnerability-detection.ts  — 7-factor scoring\n   291→    │   ├── benefits-engine.ts   — UK benefit rules engine\n   292→    │   ├── property-passport.ts — Multi-source aggregation\n   293→    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n   294→    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)\n   295→    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)\n   296→    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints\n   297→    │   ├── monitoring.ts        — Metrics singleton\n   298→    │   ├── hact-export.ts       — HACT reporting format\n   299→    │   ├── seed.ts              — Database seeding\n   300→    │   ├── seed-data.ts         — Seed data definitions\n   301→    │   └── hact-codes.ts        — SOR code definitions\n   302→    │\n   303→    ├── models/\n   304→    │   ├── firestore-schemas.ts — Firestore collection schemas\n   305→    │   └── hact-codes.ts        — Repair code models\n   306→    │\n   307→    └── scripts/\n   308→        ├── seed-imd.ts          — IMD data loader\n   309→        └── seed.ts              — Main seed runner\n   310→\n   311→4.2 Middleware Pipeline (Request Flow)\n   312→\n   313→    Request → Morgan Logger → Helmet (CSP, security headers)\n   314→            → CORS (restricted origins) → Compression (gzip)\n   315→            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n   316→            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler\n   317→            → Error Handler → Response\n   318→\n   319→4.3 Rate Limiting (4 Tiers)\n   320→\n   321→    | Tier    | Routes              | Limit        | Window  |\n   322→    |---------|---------------------|--------------|---------|\n   323→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   324→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   325→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   326→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   327→\n   328→4.4 Error Handling\n   329→    - Structured JSON error responses: { error, message, statusCode }\n   330→    - No stack traces leaked in production\n   331→    - Error logging with request ID correlation (X-Request-ID)\n   332→    - Graceful degradation for external API failures\n   333→    - ErrorBoundary on frontend for component-level recovery\n   334→\n   335→4.5 Health Check\n   336→    GET /health → { status, firestore, uptime, memory, timestamp }\n   337→    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n   338→    Memory: RSS, heap used, heap total\n   339→\n   340→\n   341→5. DATA MODELS (FIRESTORE)\n   342→================================================================================\n   343→\n   344→5.1 Collection Map (17 Collections)\n   345→\n   346→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   347→    │   organisations │     │     users        │     │     teams       │\n   348→    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n   349→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   350→                                    │\n   351→                                    ▼\n   352→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   353→    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n   354→    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n   355→    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n   356→             │                                               │\n   357→             ▼                                               ▼\n   358→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   359→    │   repairs       │     │   complaints     │     │      asb        │\n   360→    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n   361→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   362→                                                            │\n   363→    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐\n   364→    │   financial     │     │   damp-mould     │     │   activities    │\n   365→    │   (docs)        │     │   (docs)         │     │   (docs)        │\n   366→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   367→\n   368→    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n   369→    │   tasks         │     │  integrations    │     │    auditLog     │\n   370→    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │\n   371→    └─────────────────┘     └─────────────────┘     └─────────────────┘\n   372→\n   373→    ┌──────────────────────┐     ┌─────────────────┐\n   374→    │  externalDataCache   │     │    imdData       │\n   375→    │  (TTL-based cache)   │     │   (LSOA docs)    │\n   376→    └──────────────────────┘     └─────────────────┘\n   377→\n   378→5.2 Property Schema\n   379→\n   380→    {\n   381→      id: string                    // Firestore document ID\n   382→      uprn: string                  // 12-digit UPRN\n   383→      address: {\n   384→        line1: string\n   385→        line2?: string\n   386→        town: string\n   387→        postcode: string            // Real SE London postcode\n   388→        lat: number\n   389→        lng: number\n   390→        lsoaCode: string            // LSOA for IMD/Census\n   391→      }\n   392→      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n   393→      bedrooms: number\n   394→      floor?: number\n   395→      estateId: string\n   396→      blockId?: string\n   397→      buildYear: number\n   398→      heatingType: string\n   399→      wallType: string\n   400→      roofType: string\n   401→      epc: {\n   402→        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n   403→        score: number\n   404→        certificateNumber?: string\n   405→        expiryDate: string\n   406→      }\n   407→      compliance: {\n   408→        gasSafety: { status, expiryDate, certificateRef }\n   409→        electricalSafety: { status, expiryDate, certificateRef }\n   410→        fireRiskAssessment: { status, lastAssessmentDate }\n   411→        asbestos: { status, surveyDate }\n   412→        legionella: { status, assessmentDate }\n   413→        liftSafety?: { status, inspectionDate }\n   414→      }\n   415→      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n   416→      tenantId?: string\n   417→      createdAt: timestamp\n   418→      updatedAt: timestamp\n   419→    }\n   420→\n   421→5.3 Tenant Schema\n   422→\n   423→    {\n   424→      id: string\n   425→      title: string\n   426→      firstName: string\n   427→      lastName: string\n   428→      dateOfBirth: string\n   429→      email: string\n   430→      phone: string\n   431→      nino?: string                 // National Insurance Number\n   432→      propertyId: string\n   433→      tenancyId: string\n   434→      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n   435→      tenancyStartDate: string\n   436→      rent: {\n   437→        weeklyAmount: number\n   438→        balance: number             // Negative = arrears\n   439→        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n   440→        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n   441→      }\n   442→      household: [\n   443→        { name, relationship, dateOfBirth, isDependent }\n   444→      ]\n   445→      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n   446→      emergencyContact: {\n   447→        name: string\n   448→        phone: string\n   449→        relationship: string\n   450→      }\n   451→      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n   452→      createdAt: timestamp\n   453→      updatedAt: timestamp\n   454→    }\n   455→\n   456→5.4 Case Schema (Unified)\n   457→\n   458→    {\n   459→      id: string\n   460→      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n   461→             | 'safeguarding' | 'enquiry'\n   462→      reference: string             // e.g., REP-2025-001\n   463→      title: string\n   464→      description: string\n   465→      status: string                // Type-specific statuses\n   466→      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n   467→      propertyId: string\n   468→      tenantId: string\n   469→      assignedTo: string            // User ID\n   470→      createdDate: string\n   471→      updatedDate: string\n   472→      closedDate?: string\n   473→      sla: {\n   474→        targetDate: string\n   475→        breached: boolean\n   476→      }\n   477→      timeline: [\n   478→        { date, action, actor, notes }\n   479→      ]\n   480→      // Type-specific fields via discriminated union\n   481→    }\n   482→\n   483→5.5 Repair Schema (extends Case)\n   484→\n   485→    {\n   486→      ...Case,\n   487→      type: 'repair',\n   488→      sorCode: string               // HACT SOR code\n   489→      trade: string                 // plumbing, electrical, carpentry, etc.\n   490→      appointment: {\n   491→        date: string\n   492→        timeSlot: string\n   493→        confirmedBy: string\n   494→      }\n   495→      contractor: {\n   496→        name: string\n   497→        company: string\n   498→        gasSafeNumber?: string\n   499→        niceicNumber?: string\n   500→      }\n   501→      cost: {\n   502→        estimated: number\n   503→        actual?: number\n   504→        authorised: boolean\n   505→      }\n   506→      photos: {\n   507→        before: string[]\n   508→        after: string[]\n   509→      }\n   510→      satisfaction?: {\n   511→        rating: number              // 1-5\n   512→        feedback: string\n   513→        date: string\n   514→      }\n   515→    }\n   516→\n   517→5.6 Complaint Schema (extends Case)\n   518→\n   519→    {\n   520→      ...Case,\n   521→      type: 'complaint',\n   522→      stage: 1 | 2\n   523→      category: string\n   524→      deadlines: {\n   525→        stage1Acknowledgement: string   // 5 working days\n   526→        stage1Response: string          // 10 working days\n   527→        stage2Response?: string         // 20 working days\n   528→      }\n   529→      ombudsmanRef?: string\n   530→      escalatedDate?: string\n   531→      outcome?: string\n   532→      learningActions: string[]\n   533→    }\n   534→\n   535→5.7 ASB Schema (extends Case)\n   536→\n   537→    {\n   538→      ...Case,\n   539→      type: 'asb',\n   540→      severity: 'low' | 'medium' | 'high' | 'critical'\n   541→      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n   542→      evidenceLog: [\n   543→        { date, type, description, attachments }\n   544→      ]\n   545→      perpetratorId?: string\n   546→      victimIds: string[]\n   547→      communityTrigger: boolean\n   548→    }\n   549→\n   550→5.8 ExternalDataCache Schema\n   551→\n   552→    {\n   553→      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n   554→      source: string                // API source identifier\n   555→      data: object                  // Cached response payload\n   556→      fetchedAt: timestamp          // When data was fetched\n   557→      ttl: number                   // TTL in seconds\n   558→      expiresAt: timestamp          // Computed expiry\n   559→      requestParams: object         // Original request parameters\n   560→    }\n   561→\n   562→5.9 Integration Schema\n   563→\n   564→    {\n   565→      id: string\n   566→      name: string\n   567→      tier: 1 | 2 | 3\n   568→      category: string\n   569→      status: 'active' | 'inactive' | 'error' | 'pending'\n   570→      enabled: boolean\n   571→      config: {\n   572→        baseUrl: string\n   573→        apiKey?: string\n   574→        rateLimit: number\n   575→      }\n   576→      stats: {\n   577→        lastUsed: string\n   578→        requestCount: number\n   579→        avgResponseTime: number\n   580→        cacheHitRate: number\n   581→        errorRate: number\n   582→      }\n   583→    }\n   584→\n   585→5.10 Firestore Indexes (Composite)\n   586→    Defined in firestore.indexes.json at project root (16 indexes).\n   587→    Key indexes for:\n   588→    - cases: (propertyId, type, createdDate DESC)\n   589→    - cases: (tenantId, type, createdDate DESC)\n   590→    - cases: (status, priority, createdDate DESC)\n   591→    - activities: (entityId, timestamp DESC)\n   592→    - externalDataCache: (source, expiresAt)\n   593→\n   594→5.11 Firestore Security Rules\n   595→    Defined in firestore.rules at project root.\n   596→    Persona-based access control for all 15 collections.\n   597→    Audit log is write-once, read-many (immutable).\n   598→\n   599→\n   600→6. API ARCHITECTURE\n   601→================================================================================\n   602→\n   603→6.1 API Design Principles\n   604→    - RESTful design with /api/v1/ prefix\n   605→    - JSON request/response bodies\n   606→    - Consistent error format: { error, message, statusCode }\n   607→    - Pagination: ?page=N&limit=N (default 20, max 50)\n   608→    - Filtering: Query parameters per endpoint\n   609→    - Sorting: ?sort=field&order=asc|desc\n   610→    - Request correlation via X-Request-ID header\n   611→\n   612→6.2 API Route Registry (50+ endpoints)\n   613→\n   614→    AUTHENTICATION (3)\n   615→    POST   /api/v1/auth/login          — Firebase token login\n   616→    POST   /api/v1/auth/register       — User registration\n   617→    POST   /api/v1/auth/logout         — Session invalidation\n   618→\n   619→    PROPERTIES (2)\n   620→    GET    /api/v1/properties           — List with pagination/filter\n   621→    GET    /api/v1/properties/:id       — Property detail\n   622→\n   623→    TENANTS (2)\n   624→    GET    /api/v1/tenants              — List with pagination/filter\n   625→    GET    /api/v1/tenants/:id          — Tenant detail\n   626→\n   627→    CASES (5)\n   628→    GET    /api/v1/cases                — List with type/status filter\n   629→    GET    /api/v1/cases/:id            — Case detail\n   630→    POST   /api/v1/cases                — Create case\n   631→    PUT    /api/v1/cases/:id            — Update case\n   632→    DELETE /api/v1/cases/:id            — Close/archive case\n   633→\n   634→    CONVENIENCE ALIASES\n   635→    GET    /api/v1/repairs              — All repairs (type=='repair')\n   636→    GET    /api/v1/complaints           — All complaints (type=='complaint')\n   637→\n   638→    COMPLIANCE (2)\n   639→    GET    /api/v1/compliance           — Big 6 summary dashboard\n   640→    GET    /api/v1/compliance/:type     — Type-specific data\n   641→\n   642→    EXPLORE (2+)\n   643→    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy\n   644→    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n   645→\n   646→    RENT (3)\n   647→    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n   648→    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n   649→    GET    /api/v1/rent/transactions    — Transaction list\n   650→\n   651→    REPAIRS (2)\n   652→    GET    /api/v1/repairs              — Repair list\n   653→    GET    /api/v1/repairs/:id          — Repair detail\n   654→\n   655→    REPORTS (3)\n   656→    GET    /api/v1/reports              — Report catalog (27 types)\n   657→    GET    /api/v1/reports/:type        — Generate report data\n   658→    GET    /api/v1/reports/tsm          — TSM specific data\n   659→\n   660→    LETTINGS (2)\n   661→    GET    /api/v1/lettings/voids       — Void property list\n   662→    GET    /api/v1/lettings/register    — Housing register\n   663→\n   664→    BOOKING (2)\n   665→    POST   /api/v1/booking/viewing      — Book a viewing\n   666→    POST   /api/v1/booking/application  — Submit application\n   667→\n   668→    BRIEFING (2)\n   669→    GET    /api/v1/briefing             — Personalised morning briefing\n   670→    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n   671→\n   672→    EXPORT (2)\n   673→    GET    /api/v1/export/csv/:type     — CSV export\n   674→    GET    /api/v1/export/pdf/:type     — PDF export\n   675→\n   676→    AI INTELLIGENCE (14)\n   677→    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n   678→    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n   679→    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n   680→    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n   681→    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n   682→    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants\n   683→    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n   684→    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n   685→    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n   686→    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n   687→    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n   688→    GET    /api/v1/ai/notify/template/:id                — Template detail\n   689→    POST   /api/v1/ai/notify/render                      — Render template\n   690→    POST   /api/v1/ai/chat                               — Yantra Assist chat\n   691→\n   692→    MOCK TIER 3 (9)\n   693→    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n   694→    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n   695→    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n   696→    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n   697→    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n   698→    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n   699→    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n   700→    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n   701→    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry\n   702→\n   703→    EXTERNAL DATA PROXY (9)\n   704→    GET    /api/v1/public-data/police/:postcode          — Police crime data\n   705→    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast\n   706→    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk\n   707→    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup\n   708→    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n   709→    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021\n   710→    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour\n   711→    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n   712→    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify\n   713→\n   714→    ADMIN (4)\n   715→    GET    /api/v1/admin/integrations                    — List integrations\n   716→    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n   717→    POST   /api/v1/admin/integrations/:id/test           — Test connection\n   718→    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n   719→\n   720→    CONFIG & HEALTH\n   721→    GET    /api/v1/config              — Firebase client config (public)\n   722→    GET    /health                     — Health check\n   723→\n   724→\n   725→7. EXTERNAL API INTEGRATION ARCHITECTURE\n   726→================================================================================\n   727→\n   728→7.1 Server-Side Proxy Pattern\n   729→    All external API calls are proxied through the Express server.\n   730→    Frontend NEVER calls external APIs directly.\n   731→\n   732→    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n   733→\n   734→7.2 Caching Strategy (Firestore-based)\n   735→    Collection: externalDataCache\n   736→    Pattern: Cache-through with TTL\n   737→\n   738→    | Data Source       | TTL      | Rationale                    |\n   739→    |-------------------|----------|------------------------------|\n   740→    | Weather           | 1 hour   | Forecast changes frequently  |\n   741→    | Crime data        | 24 hours | Updated monthly by Police.uk |\n   742→    | EPC certificates  | 30 days  | Rarely changes               |\n   743→    | Census data       | 90 days  | Static (Census 2021)         |\n   744→    | Postcode lookup   | 7 days   | Rarely changes               |\n   745→    | Gas Safe          | 24 hours | Registration status           |\n   746→    | Electrical Safety | 24 hours | Registration status           |\n   747→    | IMD data          | 90 days  | Annual update cycle          |\n   748→    | NOMIS             | 30 days  | Monthly refresh               |\n   749→    | Flood risk        | 1 hour   | Changes with weather          |\n   750→\n   751→7.3 Rate Limiting (External APIs)\n   752→    Token bucket pattern per API source.\n   753→    Fair-use limit: 15 requests/second across all external APIs.\n   754→\n   755→7.4 Graceful Degradation\n   756→    All external APIs have simulated fallbacks.\n   757→    If an API fails or times out:\n   758→    - Timeout: 10 seconds per external request\n   759→    - Retry: 1 retry with exponential backoff (2s)\n   760→    - Return simulated fallback data\n   761→    - Flag response: { source: 'live' | 'simulated' }\n   762→    Simulated data is realistic, consistent (deterministic seeding), flagged.\n   763→\n   764→\n   765→8. SECURITY ARCHITECTURE\n   766→================================================================================\n   767→\n   768→8.1 Authentication Flow\n   769→    1. User visits /login\n   770→    2. FirebaseUI widget presents Google SSO or email/password\n   771→    3. Firebase returns ID token (JWT)\n   772→    4. Frontend stores token, sends in Authorization header\n   773→    5. Express middleware verifies token via Firebase Admin SDK\n   774→    6. User context loaded (role, persona, permissions)\n   775→    7. Fallback: X-Persona header for development (non-production)\n   776→\n   777→8.2 Authorization (RBAC)\n   778→    10 default roles with hierarchical permissions:\n   779→    - super-admin, org-admin, regional-manager, area-manager\n   780→    - housing-manager, senior-officer, housing-officer\n   781→    - repairs-coordinator, repairs-operative, read-only\n   782→\n   783→8.3 Security Headers\n   784→    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n   785→    - X-Content-Type-Options: nosniff\n   786→    - X-Frame-Options: DENY\n   787→    - Referrer-Policy: strict-origin-when-cross-origin\n   788→    - Permissions-Policy (camera, microphone, geolocation disabled)\n   789→    - Strict-Transport-Security: max-age=31536000\n   790→\n   791→8.4 Secrets Management\n   792→    All secrets stored in Google Secret Manager:\n   793→    - FIREBASE_API_KEY\n   794→    - FIREBASE_AUTH_DOMAIN\n   795→    - FIREBASE_PROJECT_ID\n   796→    - DEMO_USER_PASSWORD\n   797→    No secrets in source code or environment files.\n   798→\n   799→\n   800→9. DEPLOYMENT ARCHITECTURE\n   801→================================================================================\n   802→\n   803→9.1 Deployment Pipeline\n   804→\n   805→    Developer → git push origin main\n   806→                    │\n   807→                    ▼\n   808→    GitHub Repository (rajivpeter/SocialHomes_ai)\n   809→                    │\n   810→                    ▼\n   811→    Cloud Build (auto-triggered)\n   812→     ├── Step 1: Build React frontend (Vite)\n   813→     ├── Step 2: Build Express backend (tsc)\n   814→     └── Step 3: Build & push Docker image\n   815→                    │\n   816→                    ▼\n   817→    Artifact Registry (europe-west2)\n   818→     └── cloud-run-source-deploy/socialhomes:latest\n   819→                    │\n   820→                    ▼\n   821→    Cloud Run (europe-west2)\n   822→     ├── Min instances: 0\n   823→     ├── Max instances: 10\n   824→     ├── Memory: 1Gi\n   825→     ├── CPU: 1\n   826→     ├── Concurrency: 80\n   827→     ├── Timeout: 300s\n   828→     ├── Port: 8080\n   829→     └── Secrets: 4 from Secret Manager\n   830→\n   831→9.2 Docker Build (Multi-Stage)\n   832→    Stage 1: Build client (Vite) — node:20-slim base\n   833→    Stage 2: Build server (tsc) — node:20-slim base\n   834→    Stage 3: Production — copy built assets, start server (~500MB image)\n   835→\n   836→9.3 Cloud Run Configuration\n   837→    Region: europe-west2 (London)\n   838→    Auto-scaling based on request volume\n   839→    Min instances 0 for cost efficiency (cold start < 3s)\n   840→\n   841→9.4 Key Infrastructure References\n   842→    GCP Project ID: gen-lang-client-0878518473\n   843→    GCP Project Number: 587984201316\n   844→    Firebase Project: gen-lang-client-0146156913\n   845→    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n   846→                       cloud-run-source-deploy/socialhomes\n   847→    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n   848→\n   849→\n   850→10. MONITORING & OBSERVABILITY\n   851→================================================================================\n   852→\n   853→10.1 Custom Metrics (In-App)\n   854→    - Request count (by endpoint, method, status code)\n   855→    - Response time percentiles (P50, P95, P99)\n   856→    - Cache hit/miss rates per API source\n   857→    - Firestore query latency\n   858→    - Error rate and error types\n   859→    - Active concurrent requests\n   860→\n   861→10.2 Health Check\n   862→    GET /health\n   863→    - Firestore connectivity check with latency measurement\n   864→    - Memory usage (RSS, heap used, heap total)\n   865→    - Process uptime\n   866→    - Status: healthy | degraded | unhealthy\n   867→\n   868→10.3 Structured Logging\n   869→    - JSON format for all logs\n   870→    - Request ID correlation (X-Request-ID)\n   871→    - No sensitive data in logs (no PII)\n   872→    - Error logging with full non-PII context\n   873→\n   874→10.4 Admin Monitoring Dashboard\n   875→    GET /api/v1/admin/monitoring\n   876→    - Real-time metrics display\n   877→    - Integration status overview (20 integrations)\n   878→    - Cache performance statistics\n   879→    - Error rate trending\n   880→\n   881→\n   882→================================================================================\n   883→  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n   884→  Yantra Works | 2026-02-23\n   885→================================================================================\n   886→"}]},"uuid":"9554fd05-be8d-41fa-94f7-e1bc08485eb3","timestamp":"2026-02-25T15:23:19.750Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer (25 modules)             │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n1.3 Request Flow Diagram\n\n    Browser → React SPA → api-client.ts → HTTP Request\n                                              │\n                                              ▼\n    Express Server ← Middleware Pipeline ← Route Handler\n         │               │\n         │     ┌─────────┴──────────────────────────┐\n         │     │ Morgan → Helmet → CORS → Compression│\n         │     │ → JSON Parser (1MB) → X-Request-ID  │\n         │     │ → Rate Limiter → Metrics → Handler   │\n         │     │ → Error Handler → Response            │\n         │     └──────────────────────────────────────┘\n         │\n         ├─→ Firestore (read/write)\n         ├─→ External API Proxy (with cache)\n         └─→ AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point (QueryClient)\n    ├── index.css                — Global styles, animations, accessibility\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage (Firebase + Google)\n    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage,\n    │   │                          ApplicationPage, ViewingBookingPage\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,\n    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    │                              PropertyMap, StatusPill, VulnerabilityPanel)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods\n    │   ├── useEntityIntelligence.ts  — AI scoring hooks\n    │   └── usePersonaScope.ts   — Persona-based data filtering\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client (70+ methods), Firebase, AI drafting,\n    │                              public data helpers\n    ├── contexts/                — AuthContext, AppContext\n    ├── utils/                   — Formatting utilities (safeText, etc.)\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification + X-Persona fallback\n    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 25 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)\n    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet (CSP, security headers)\n            → CORS (restricted origins) → Compression (gzip)\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                    │\n                                    ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                            │\n    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (16 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.11 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15 collections.\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES (2)\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS (2)\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (5)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    CONVENIENCE ALIASES\n    GET    /api/v1/repairs              — All repairs (type=='repair')\n    GET    /api/v1/complaints           — All complaints (type=='complaint')\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE (2+)\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT (3)\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS (2)\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS (3)\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING (2)\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n    POST   /api/v1/ai/chat                               — Yantra Assist chat\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          — Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              — Firebase client config (public)\n    GET    /health                     — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Concurrency: 80\n     ├── Timeout: 300s\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-23\n================================================================================\n","numLines":886,"startLine":1,"totalLines":886}},"sourceToolAssistantUUID":"ad3299ec-d553-40dd-a918-46b7b06b37df"}
{"parentUuid":"9554fd05-be8d-41fa-94f7-e1bc08485eb3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01W7DzXRU2gW4BNyZVPYjLig","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"e3082456-939b-48f9-a8a9-d04987b13796","timestamp":"2026-02-25T15:23:19.980Z"}
{"parentUuid":"e3082456-939b-48f9-a8a9-d04987b13796","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01W7DzXRU2gW4BNyZVPYjLig","type":"tool_result","content":"     1→================================================================================\n     2→  Doc3 — SocialHomes.Ai API & Integration Requirements\n     3→  Version: 3.0  |  Date: 2026-02-23\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. API OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 API Strategy\n    11→    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    12→    integrations. The React frontend communicates exclusively with the Express\n    13→    backend, which handles external calls, caching, rate limiting, and\n    14→    graceful degradation.\n    15→\n    16→1.2 Integration Tiers\n    17→\n    18→    TIER 1 — Free, No API Key Required\n    19→    Publicly available APIs with no registration needed.\n    20→    Status: LIVE with real data\n    21→\n    22→    TIER 2 — Free, Registration Required\n    23→    APIs requiring account creation or key registration.\n    24→    Status: LIVE with real data (where keys available) + simulated fallbacks\n    25→\n    26→    TIER 3 — Subscription/Paid APIs\n    27→    Commercial APIs requiring contracts or paid subscriptions.\n    28→    Status: MOCK endpoints with realistic simulated data\n    29→\n    30→1.3 Current Integration Count\n    31→    Total: 20 integrations\n    32→    - Tier 1: 3 live\n    33→    - Tier 2: 6 live (with simulated fallbacks)\n    34→    - Tier 3: 5 mock services + 6 planned\n    35→\n    36→\n    37→2. TIER 1 INTEGRATIONS (Free, No Key)\n    38→================================================================================\n    39→\n    40→2.1 Police.uk — Street-Level Crime Data\n    41→    Status: LIVE\n    42→    Base URL: https://data.police.uk/api\n    43→    Documentation: https://data.police.uk/docs/\n    44→\n    45→    Endpoints Used:\n    46→    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    47→    - GET /crimes-at-location?location_id={id}\n    48→    - GET /outcomes-at-location?location_id={id}\n    49→\n    50→    Server Route: GET /api/v1/public-data/police/:postcode\n    51→    Cache TTL: 24 hours\n    52→    Rate Limit: 15 req/sec (fair-use)\n    53→    Fallback: Simulated crime data matching postcode area\n    54→\n    55→    Used By:\n    56→    - D2: Live Crime Context for ASB (crime-context.ts)\n    57→    - Explore page crime data layer\n    58→    - ASB case correlation\n    59→    - Neighbourhood Briefing crime section\n    60→\n    61→    Data Returned:\n    62→    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    63→    - Month, location (lat/lng), outcome status\n    64→    - 12-month historical data per location\n    65→\n    66→2.2 Open-Meteo — Weather Forecasting\n    67→    Status: LIVE\n    68→    Base URL: https://api.open-meteo.com/v1\n    69→    Documentation: https://open-meteo.com/en/docs\n    70→\n    71→    Endpoints Used:\n    72→    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n    73→          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n    74→          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n    75→          &timezone=Europe/London\n    76→\n    77→    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    78→    Cache TTL: 1 hour\n    79→    Rate Limit: 10,000 req/day (no key needed)\n    80→    Fallback: Static weather for London SE\n    81→\n    82→    Used By:\n    83→    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    84→    - AI Morning Briefing (weather section)\n    85→    - Neighbourhood Briefing (environmental context)\n    86→    - Property impact assessment\n    87→\n    88→    Data Returned:\n    89→    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    90→    - Daily: max/min temperature, precipitation sum\n    91→    - 7-day forecast + current conditions\n    92→\n    93→2.3 DEFRA Flood Risk API\n    94→    Status: LIVE\n    95→    Base URL: https://environment.data.gov.uk/flood-monitoring\n    96→    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n    97→\n    98→    Endpoints Used:\n    99→    - GET /id/floods?lat={lat}&long={lng}&dist=3\n   100→    - GET /id/stations?lat={lat}&long={lng}&dist=3\n   101→\n   102→    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n   103→    Cache TTL: 1 hour\n   104→    Rate Limit: No formal limit\n   105→    Fallback: \"No active warnings\" with zone classification\n   106→\n   107→    Used By:\n   108→    - Property Passport (flood risk section)\n   109→    - Neighbourhood Briefing (environmental alerts)\n   110→    - Property detail page (risk indicators)\n   111→\n   112→    Data Returned:\n   113→    - Active flood warnings/alerts\n   114→    - Flood risk zone classification\n   115→    - Nearest monitoring station readings\n   116→\n   117→\n   118→3. TIER 2 INTEGRATIONS (Registration Required)\n   119→================================================================================\n   120→\n   121→3.1 Postcodes.io — Postcode Lookup\n   122→    Status: LIVE\n   123→    Base URL: https://api.postcodes.io\n   124→    Documentation: https://postcodes.io/docs\n   125→    Registration: None (open API)\n   126→\n   127→    Endpoints Used:\n   128→    - GET /postcodes/{postcode}\n   129→    - GET /postcodes/{postcode}/nearest\n   130→    - POST /postcodes (bulk lookup)\n   131→\n   132→    Server Route: GET /api/v1/public-data/postcode/:postcode\n   133→    Cache TTL: 7 days\n   134→    Rate Limit: Generous (no formal limit)\n   135→    Fallback: Static mapping for SE London postcodes\n   136→\n   137→    Data Returned:\n   138→    - Latitude, longitude\n   139→    - LSOA code and name (for IMD/Census/NOMIS)\n   140→    - Ward, parliamentary constituency\n   141→    - Local authority, region\n   142→\n   143→    Used By:\n   144→    - All location-dependent lookups\n   145→    - LSOA resolution for Census/NOMIS/IMD\n   146→    - Property geocoding\n   147→\n   148→3.2 EPC Open Data\n   149→    Status: LIVE (with simulated fallback)\n   150→    Base URL: https://epc.opendatacommunities.org/api/v1\n   151→    Documentation: https://epc.opendatacommunities.org/docs/api\n   152→    Registration: API key via MHCLG portal\n   153→\n   154→    Endpoints Used:\n   155→    - GET /domestic/search?uprn={uprn}\n   156→    - GET /domestic/certificate/{lmk-key}\n   157→\n   158→    Server Route: GET /api/v1/public-data/epc/:uprn\n   159→    Cache TTL: 30 days\n   160→    Rate Limit: 1,000 req/month (free tier)\n   161→    Fallback: Generated EPC data matching property attributes\n   162→\n   163→    Data Returned:\n   164→    - Current energy rating (A–G) and score\n   165→    - Potential rating\n   166→    - Environmental impact rating\n   167→    - Floor area, wall/roof type\n   168→    - Heating type, hot water system\n   169→    - Recommendations for improvement\n   170→    - Certificate expiry date\n   171→\n   172→    Used By:\n   173→    - Property Passport (energy section)\n   174→    - Compliance page (EPC tracking)\n   175→    - Property detail page\n   176→    - D1: Damp prediction (building factor input)\n   177→\n   178→3.3 Census 2021 (ONS via NOMIS)\n   179→    Status: LIVE (with simulated fallback)\n   180→    Base URL: https://www.nomisweb.co.uk/api/v01\n   181→    Documentation: https://www.nomisweb.co.uk/api/v01/help\n   182→\n   183→    Datasets Used:\n   184→    - NM_2072_1 — Population by age/sex (Census 2021)\n   185→    - NM_2021_1 — Accommodation type (Census 2021)\n   186→\n   187→    Server Route: GET /api/v1/public-data/census/:lsoaCode\n   188→    Cache TTL: 90 days\n   189→    Rate Limit: 100,000 req/month\n   190→    Fallback: Simulated demographics for Southwark LSOA areas\n   191→\n   192→    Data Returned:\n   193→    - Population count and density\n   194→    - Age distribution (0–15, 16–64, 65+)\n   195→    - Household composition\n   196→    - Accommodation type breakdown\n   197→    - Ethnicity distribution\n   198→\n   199→    Used By:\n   200→    - Neighbourhood Briefing (demographics section)\n   201→    - Property Passport (area context)\n   202→    - D3: Vulnerability Detection (deprivation context)\n   203→\n   204→3.4 NOMIS — Labour Market Statistics\n   205→    Status: LIVE (with simulated fallback)\n   206→    Base URL: https://www.nomisweb.co.uk/api/v01\n   207→\n   208→    Datasets Used:\n   209→    - NM_162_1 — JSA claimant count by age/sex\n   210→    - NM_17_5  — Annual Population Survey (employment/unemployment)\n   211→\n   212→    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n   213→    Cache TTL: 30 days\n   214→    Rate Limit: 100,000 req/month\n   215→    Fallback: Simulated labour market data for SE London\n   216→\n   217→    Data Returned:\n   218→    - Employment rate, unemployment rate\n   219→    - Economic activity breakdown\n   220→    - Claimant count (JSA/UC)\n   221→    - Occupation types\n   222→    - Qualification levels\n   223→\n   224→    Used By:\n   225→    - D5: Benefits Entitlement Engine (employment context)\n   226→    - Neighbourhood Briefing (economic section)\n   227→    - D3: Vulnerability Detection (economic deprivation factor)\n   228→\n   229→3.5 Gas Safe Register\n   230→    Status: LIVE (with simulated fallback)\n   231→    Base URL: https://www.gassaferegister.co.uk/api\n   232→    Documentation: Restricted (via partnership application)\n   233→\n   234→    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n   235→    Cache TTL: 24 hours\n   236→    Rate Limit: 100 req/hour\n   237→    Fallback: Simulated verification with valid/expired/suspended status\n   238→\n   239→    Data Returned:\n   240→    - Engineer name and company\n   241→    - Registration status (valid/expired/suspended)\n   242→    - Qualifications (boiler, cooker, fire, etc.)\n   243→    - Registration number and expiry date\n   244→\n   245→    Used By:\n   246→    - Repair detail page (contractor verification badge — green)\n   247→    - Compliance management (contractor vetting)\n   248→\n   249→3.6 Electrical Safety Register (NICEIC)\n   250→    Status: LIVE (with simulated fallback)\n   251→    Base URL: https://www.niceic.com/api\n   252→    Documentation: Via partnership application\n   253→\n   254→    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n   255→    Cache TTL: 24 hours\n   256→    Rate Limit: 100 req/hour\n   257→    Fallback: Simulated verification with valid/expired/suspended status\n   258→\n   259→    Data Returned:\n   260→    - Contractor name and company\n   261→    - Registration status (valid/expired/suspended)\n   262→    - Scheme (NICEIC Approved Contractor / Competent Person)\n   263→    - Registration number and expiry date\n   264→\n   265→    Used By:\n   266→    - Repair detail page (contractor verification badge — blue)\n   267→    - Compliance management (electrical contractor vetting)\n   268→\n   269→\n   270→4. TIER 3 INTEGRATIONS (Mock/Subscription)\n   271→================================================================================\n   272→\n   273→4.1 DWP Universal Credit Verification\n   274→    Status: MOCK\n   275→    Mock Function: mockUcVerification(tenantId)\n   276→    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n   277→\n   278→    Mock Response:\n   279→    - UC claim status (active/pending/none)\n   280→    - Housing element amount\n   281→    - Payment frequency and next payment date\n   282→    - Managed payment status (direct to landlord)\n   283→    - Alternative Payment Arrangement (APA) eligibility\n   284→\n   285→    Used By:\n   286→    - D5: Benefits Entitlement Engine\n   287→    - Rent management (UC tracking)\n   288→    - Arrears prevention (early warning)\n   289→\n   290→4.2 IoT Sensor Integration (Switchee/Aico)\n   291→    Status: MOCK\n   292→    Mock Function: mockIotSensors(propertyId)\n   293→    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   294→\n   295→    Mock Response:\n   296→    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n   297→    - Humidity readings (per room)\n   298→    - CO2 levels\n   299→    - Smoke/CO detector status (OK/alert/battery-low)\n   300→    - Heating system status (on/off/hours today)\n   301→    - Alerts (high humidity, low temperature, CO detected)\n   302→\n   303→    Used By:\n   304→    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n   305→    - Property detail page (live sensor data)\n   306→    - Compliance monitoring (smoke/CO detector status)\n   307→\n   308→4.3 GoCardless — Direct Debit\n   309→    Status: MOCK\n   310→    Mock Function: mockDirectDebit(tenantId)\n   311→    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n   312→\n   313→    Mock Response:\n   314→    - Mandate status (active/pending/cancelled)\n   315→    - Bank details (last 4 digits only)\n   316→    - Next collection date and amount\n   317→    - Payment history (last 12 months)\n   318→    - Failed payment reasons\n   319→\n   320→    Used By:\n   321→    - Rent management (payment processing)\n   322→    - Arrears management (DD failure tracking)\n   323→    - Tenant detail (payment method)\n   324→\n   325→4.4 Plentific/Fixflo — Repairs Marketplace\n   326→    Status: MOCK\n   327→    Mock Function: mockRepairsMarketplace(caseId)\n   328→    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n   329→\n   330→    Mock Response:\n   331→    - Contractor quotes (3 quotes with price/availability)\n   332→    - Dispatch confirmation\n   333→    - Appointment scheduling\n   334→    - Job completion notification\n   335→    - Satisfaction survey trigger\n   336→\n   337→    Used By:\n   338→    - Repairs management (contractor dispatch)\n   339→    - Cost management (competitive quotes)\n   340→\n   341→4.5 DocuSign — Digital Signing\n   342→    Status: MOCK\n   343→    Mock Function: mockSigningEnvelope(documentType, tenantId)\n   344→    Server Route: POST /api/v1/ai/mock/signing\n   345→\n   346→    Mock Response:\n   347→    - Envelope ID and status (sent/delivered/signed/declined)\n   348→    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n   349→    - Recipients with signing status\n   350→    - Completion date\n   351→    - Signed document URL\n   352→\n   353→    Used By:\n   354→    - Tenancy sign-up workflow\n   355→    - Compliance certificate signing\n   356→    - Legal document execution\n   357→\n   358→4.6 Experian/TransUnion — Tenant Referencing\n   359→    Status: MOCK\n   360→    Mock Function: mockReferencingResult(applicantId)\n   361→    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n   362→\n   363→    Mock Response:\n   364→    - Credit score (300–850)\n   365→    - Affordability assessment (pass/refer/fail)\n   366→    - CCJ count and value\n   367→    - Previous addresses (last 3 years)\n   368→    - Employment verification\n   369→    - Recommendation (accept/refer/decline)\n   370→\n   371→    Used By:\n   372→    - Allocations (applicant vetting)\n   373→    - Lettings workflow (pre-tenancy checks)\n   374→\n   375→4.7 Land Registry — Title Data\n   376→    Status: MOCK\n   377→    Mock Function: mockLandRegistryTitle(propertyId)\n   378→    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n   379→\n   380→    Mock Response:\n   381→    - Title number\n   382→    - Tenure type (freehold/leasehold)\n   383→    - Price paid and date\n   384→    - Registered owner\n   385→    - Lease details (start, term, ground rent)\n   386→    - Restrictions and charges\n   387→\n   388→    Used By:\n   389→    - Property Passport (ownership section)\n   390→    - Property detail page\n   391→\n   392→4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n   393→    Status: MOCK\n   394→    Mock Function: mockRegulatorySubmission(type, refId)\n   395→    Server Route: POST /api/v1/ai/mock/regulatory\n   396→\n   397→    Submission Types:\n   398→    - IDA (Individual Data Return)\n   399→    - CORE lettings\n   400→    - CORE sales\n   401→    - Ombudsman escalation\n   402→    - Compliance score return\n   403→\n   404→    Used By:\n   405→    - Reports module (regulatory submissions)\n   406→    - Compliance management\n   407→\n   408→4.9 NOMIS Labour Market (Extended)\n   409→    Status: MOCK\n   410→    Mock Function: mockLabourMarket(lsoaCode)\n   411→    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n   412→\n   413→    Used By:\n   414→    - Neighbourhood Briefing (economic context)\n   415→    - Benefits Engine (employment verification)\n   416→\n   417→\n   418→5. SEVEN KILLER DIFFERENTIATOR SERVICES\n   419→================================================================================\n   420→\n   421→5.1 D1: Predictive Damp Intelligence\n   422→    Service: server/src/services/damp-prediction.ts\n   423→    API Route: GET /api/v1/ai/damp-risk/:propertyId\n   424→\n   425→    Algorithm: 5-Factor Weighted Score (0–100)\n   426→    ┌─────────────────────┬────────┬────────────────────────────────┐\n   427→    │ Factor              │ Weight │ Data Sources                   │\n   428→    ├─────────────────────┼────────┼────────────────────────────────┤\n   429→    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n   430→    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n   431→    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n   432→    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n   433→    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n   434→    └─────────────────────┴────────┴────────────────────────────────┘\n   435→\n   436→    Output:\n   437→    - Overall risk score (0–100)\n   438→    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n   439→    - Factor breakdown with individual scores\n   440→    - Proactive recommendations\n   441→    - Awaab's Law compliance status\n   442→\n   443→5.2 D2: Live Crime Context for ASB\n   444→    Service: server/src/services/crime-context.ts\n   445→    API Route: GET /api/v1/ai/crime-context/:estateId\n   446→\n   447→    Algorithm:\n   448→    - Fetch Police.uk data for estate location (12-month window)\n   449→    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n   450→    - Correlate with internal ASB cases\n   451→    - Identify hotspots and trends\n   452→    - Generate estate safety score\n   453→\n   454→    Output:\n   455→    - Crime summary by category (last 12 months)\n   456→    - Monthly trend (rising/stable/declining)\n   457→    - Hotspot locations within estate\n   458→    - Correlation with internal ASB cases\n   459→    - Recommended patrol priorities\n   460→\n   461→5.3 D3: Automatic Vulnerability Detection\n   462→    Service: server/src/services/vulnerability-detection.ts\n   463→    API Route: GET /api/v1/ai/vulnerability/:tenantId\n   464→\n   465→    Algorithm: 7-Factor Weighted Score (0–100)\n   466→    ┌──────────────────────────┬────────┬──────────────────────────┐\n   467→    │ Factor                   │ Weight │ Data Sources             │\n   468→    ├──────────────────────────┼────────┼──────────────────────────┤\n   469→    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n   470→    │ Arrears history          │  0.20  │ Rent account (balance)   │\n   471→    │ Health flags             │  0.15  │ Tenant vulnerability     │\n   472→    │ Social isolation         │  0.15  │ Household composition    │\n   473→    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n   474→    │ Dependents               │  0.10  │ Household members        │\n   475→    │ UC transition            │  0.10  │ UC status                │\n   476→    └──────────────────────────┴────────┴──────────────────────────┘\n   477→\n   478→    Output:\n   479→    - Vulnerability score (0–100)\n   480→    - Risk level: low / moderate / high / critical\n   481→    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n   482→    - Recommended support actions\n   483→    - Referral suggestions (social services, CAB, food bank)\n   484→\n   485→5.4 D4: Property Passport\n   486→    Service: server/src/services/property-passport.ts\n   487→    API Route: GET /api/v1/ai/property-passport/:propertyId\n   488→\n   489→    Aggregation Sources:\n   490→    - Property data (Firestore)\n   491→    - EPC certificate (Tier 2 API)\n   492→    - Compliance certificates (Firestore)\n   493→    - Repair history (Firestore cases)\n   494→    - Damp risk score (D1 service)\n   495→    - Flood risk (DEFRA API)\n   496→    - Crime context (D2 service)\n   497→    - Census demographics (NOMIS API)\n   498→    - Land Registry title (mock)\n   499→\n   500→    Output:\n   501→    - Comprehensive property dossier\n   502→    - Current condition assessment\n   503→    - Compliance status summary\n   504→    - Energy efficiency profile\n   505→    - Neighbourhood context\n   506→    - Investment recommendations\n   507→\n   508→5.5 D5: Benefits Entitlement Engine\n   509→    Service: server/src/services/benefits-engine.ts\n   510→    API Route: GET /api/v1/ai/benefits-check/:tenantId\n   511→\n   512→    Rules Engine (UK 2025/26):\n   513→    - Universal Credit (standard allowance, housing element, child element)\n   514→    - Personal Independence Payment (PIP)\n   515→    - Attendance Allowance\n   516→    - Pension Credit (guarantee, savings)\n   517→    - Council Tax Reduction\n   518→    - Discretionary Housing Payment\n   519→    - Warm Home Discount\n   520→    - Free school meals\n   521→\n   522→    Input:\n   523→    - Tenant age, household composition\n   524→    - Employment status, income\n   525→    - Disability/health conditions\n   526→    - Current benefit claims\n   527→\n   528→    Output:\n   529→    - List of potential entitlements\n   530→    - Estimated weekly/monthly amounts\n   531→    - Claim status (claimed/unclaimed/check-eligibility)\n   532→    - Total unclaimed benefits estimate\n   533→    - Next steps for each entitlement\n   534→\n   535→5.6 D6: AI Neighbourhood Briefing\n   536→    Service: server/src/services/neighbourhood-briefing.ts\n   537→    API Route: GET /api/v1/ai/briefing/:estateId\n   538→\n   539→    Data Sources Combined:\n   540→    - Weather forecast (Open-Meteo)\n   541→    - Crime data (Police.uk)\n   542→    - Active cases (Firestore)\n   543→    - Compliance status (Firestore)\n   544→    - Census demographics (NOMIS)\n   545→    - Damp risk aggregation (D1)\n   546→    - ASB incidents (Firestore + Police)\n   547→\n   548→    Output:\n   549→    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n   550→    - Officer briefing text (AI-generated narrative)\n   551→    - Action items prioritized by urgency\n   552→    - Trend comparisons (this week vs last)\n   553→\n   554→5.7 D7: IoT Sensor Integration\n   555→    Service: server/src/services/mock-services.ts\n   556→    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   557→\n   558→    Supported Devices:\n   559→    - Switchee smart thermostat (temperature, humidity, heating usage)\n   560→    - Aico smoke/CO detectors (status, battery, alerts)\n   561→    - Third-party humidity sensors\n   562→\n   563→    Status: MOCK (ready for real Switchee/Aico API integration)\n   564→\n   565→\n   566→6. GOV.UK NOTIFY INTEGRATION\n   567→================================================================================\n   568→\n   569→6.1 Overview\n   570→    Service: server/src/services/govuk-notify.ts (1,257 lines)\n   571→    Status: Template library defined (24 templates)\n   572→    Integration: Ready for GOV.UK Notify API key\n   573→\n   574→6.2 Template Categories (7)\n   575→\n   576→    CATEGORY 1: Rent Arrears (4 templates)\n   577→    - arrears-mild: Friendly reminder (1–2 weeks behind)\n   578→    - arrears-moderate: Formal notice (3–4 weeks)\n   579→    - arrears-severe: Pre-action warning (5+ weeks)\n   580→    - arrears-arrangement: Payment plan confirmation\n   581→\n   582→    CATEGORY 2: Repairs (4 templates)\n   583→    - repair-acknowledged: Repair reported acknowledgement\n   584→    - repair-appointment: Appointment booking confirmation\n   585→    - repair-completed: Completion notification + satisfaction link\n   586→    - repair-follow-up: Post-repair follow-up\n   587→\n   588→    CATEGORY 3: ASB (3 templates)\n   589→    - asb-reported: ASB report acknowledgement\n   590→    - asb-warning: Warning letter to perpetrator\n   591→    - asb-update: Case update to victim/reporter\n   592→\n   593→    CATEGORY 4: Compliance (3 templates)\n   594→    - compliance-access: Access request for inspection\n   595→    - compliance-reminder: Appointment reminder\n   596→    - compliance-certificate: Certificate available notification\n   597→\n   598→    CATEGORY 5: Tenancy (4 templates)\n   599→    - tenancy-welcome: New tenant welcome pack\n   600→    - tenancy-renewal: Renewal offer\n   601→    - tenancy-end: End of tenancy notification\n   602→    - tenancy-annual-visit: Annual visit scheduling\n   603→\n   604→    CATEGORY 6: Damp & Mould (3 templates)\n   605→    - damp-report-ack: Report acknowledged\n   606→    - damp-inspection: Inspection scheduled\n   607→    - damp-works: Works ordered notification (Awaab's Law timeline)\n   608→\n   609→    CATEGORY 7: General (3 templates)\n   610→    - general-update: Generic case update\n   611→    - general-survey: Satisfaction survey invitation\n   612→    - general-information: Information request\n   613→\n   614→6.3 Template Rendering\n   615→    - Personalisation fields use ((field)) syntax\n   616→    - Rendered server-side via /api/v1/ai/notify/render\n   617→    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n   618→      ((amount)), ((date)), ((officer_name)), etc.\n   619→\n   620→6.4 API Endpoints\n   621→    GET  /api/v1/ai/notify/templates           — List all 24 templates\n   622→    GET  /api/v1/ai/notify/templates/:category  — Filter by category\n   623→    GET  /api/v1/ai/notify/template/:id         — Single template detail\n   624→    POST /api/v1/ai/notify/render               — Render with personalisation\n   625→\n   626→\n   627→7. CACHING ARCHITECTURE\n   628→================================================================================\n   629→\n   630→7.1 Cache Collection: externalDataCache\n   631→    Stored in Firestore with TTL-based expiration.\n   632→    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n   633→\n   634→7.2 Cache-Through Pattern\n   635→    1. Check Firestore cache for key\n   636→    2. If found AND not expired → return cached data\n   637→    3. If missing OR expired → fetch from external API\n   638→    4. Store result in cache with TTL\n   639→    5. Return data to caller\n   640→\n   641→7.3 TTL Configuration\n   642→\n   643→    | Source              | TTL       | Key Format                 |\n   644→    |---------------------|-----------|----------------------------|\n   645→    | police              | 24 hours  | police:{postcode}          |\n   646→    | weather             | 1 hour    | weather:{lat},{lng}        |\n   647→    | flood-risk          | 1 hour    | flood:{postcode}           |\n   648→    | postcode            | 7 days    | postcode:{postcode}        |\n   649→    | epc                 | 30 days   | epc:{uprn}                 |\n   650→    | census              | 90 days   | census:{lsoaCode}          |\n   651→    | nomis               | 30 days   | nomis:{lsoaCode}           |\n   652→    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n   653→    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n   654→    | imd                 | 90 days   | imd:{lsoaCode}             |\n   655→\n   656→7.4 Cache Management\n   657→    - Automatic TTL enforcement on read\n   658→    - Manual cache invalidation via admin API\n   659→    - Cache hit rate tracked in metrics\n   660→    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n   661→\n   662→\n   663→8. RATE LIMITING\n   664→================================================================================\n   665→\n   666→8.1 Internal Rate Limits (per client IP)\n   667→\n   668→    | Tier    | Routes              | Limit        | Window  |\n   669→    |---------|---------------------|--------------|---------|\n   670→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   671→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   672→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   673→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   674→\n   675→8.2 External API Rate Limits\n   676→    Token bucket pattern per API source.\n   677→    Global fair-use: 15 req/sec across all external APIs.\n   678→\n   679→    | API               | Limit             | Enforced By       |\n   680→    |-------------------|-------------------|-------------------|\n   681→    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n   682→    | Open-Meteo        | 10,000 req/day    | No key needed     |\n   683→    | DEFRA             | No formal limit   | Fair-use          |\n   684→    | Postcodes.io      | No formal limit   | Fair-use          |\n   685→    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n   686→    | NOMIS             | 100,000 req/month | Fair-use          |\n   687→    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n   688→    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n   689→\n   690→\n   691→9. ERROR HANDLING & GRACEFUL DEGRADATION\n   692→================================================================================\n   693→\n   694→9.1 External API Error Handling\n   695→    - Timeout: 10 seconds per external request\n   696→    - Retry: 1 retry with exponential backoff (2s)\n   697→    - On failure: Return simulated fallback data\n   698→    - Flag: Response includes { source: 'live' | 'simulated' }\n   699→\n   700→9.2 Simulated Fallback Strategy\n   701→    Every external API has a corresponding simulated data generator.\n   702→    Simulated data is:\n   703→    - Realistic for the requested entity/location\n   704→    - Consistent across requests (deterministic seeding)\n   705→    - Flagged clearly in the response\n   706→\n   707→9.3 Circuit Breaker Pattern (Planned — Phase 5)\n   708→    - Track failure count per API source\n   709→    - Open circuit after 5 consecutive failures\n   710→    - Half-open after 60 seconds (single test request)\n   711→    - Close circuit on successful test\n   712→    Status: Designed, not yet implemented (task 5.2.5)\n   713→\n   714→\n   715→10. API SECURITY\n   716→================================================================================\n   717→\n   718→10.1 Authentication\n   719→    All /api/v1/* routes require Firebase Bearer token.\n   720→    Exception: /health (public health check), /api/v1/config (public)\n   721→\n   722→10.2 Request Validation\n   723→    - JSON body limit: 1MB\n   724→    - Content-Type: application/json enforced\n   725→    - Query parameter sanitization\n   726→    - Path parameter validation\n   727→\n   728→10.3 Response Security\n   729→    - No sensitive data in error responses (production)\n   730→    - CORS restricted to allowed origins\n   731→    - Request ID correlation (X-Request-ID)\n   732→    - Security headers on all responses\n   733→\n   734→10.4 API Key Management\n   735→    - No API keys in source code\n   736→    - All keys in Google Secret Manager\n   737→    - Environment variable injection at runtime\n   738→    - Key rotation support via Secret Manager versioning\n   739→\n   740→\n   741→11. FUTURE INTEGRATION ROADMAP\n   742→================================================================================\n   743→\n   744→11.1 Phase 5 — Real-Time & Advanced (Planned)\n   745→\n   746→    | Integration           | Priority | Complexity | Description                     |\n   747→    |-----------------------|----------|------------|---------------------------------|\n   748→    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n   749→    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n   750→    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n   751→    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n   752→    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n   753→    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n   754→    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n   755→    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n   756→    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n   757→    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n   758→\n   759→11.2 Phase 6 — Enterprise Integrations (Future)\n   760→\n   761→    | Integration           | Priority | Complexity | Description                     |\n   762→    |-----------------------|----------|------------|---------------------------------|\n   763→    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n   764→    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n   765→    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n   766→    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n   767→    | NHS Digital           | P3       | H          | Health data integration          |\n   768→    | Companies House       | P3       | S          | Contractor verification          |\n   769→    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n   770→\n   771→\n   772→================================================================================\n   773→  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n   774→  Yantra Works | 2026-02-23\n   775→================================================================================\n   776→"}]},"uuid":"0187477a-1ffb-4d6c-8c02-0afffab19298","timestamp":"2026-02-25T15:23:20.202Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           — List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  — Filter by category\n    GET  /api/v1/ai/notify/template/:id         — Single template detail\n    POST /api/v1/ai/notify/render               — Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-23\n================================================================================\n","numLines":776,"startLine":1,"totalLines":776}},"sourceToolAssistantUUID":"e3082456-939b-48f9-a8a9-d04987b13796"}
{"parentUuid":"0187477a-1ffb-4d6c-8c02-0afffab19298","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018hmfs98tYU3ACg3UJKNYpT","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"2a1dc8d1-7a48-4a79-8ab9-0cf6a16d4760","timestamp":"2026-02-25T15:23:20.480Z"}
{"parentUuid":"2a1dc8d1-7a48-4a79-8ab9-0cf6a16d4760","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018hmfs98tYU3ACg3UJKNYpT","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n     4→> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n     5→> Studio: Yantra Works\n     6→\n     7→---\n     8→\n     9→## PLAN SUMMARY\n    10→\n    11→| Phase | Name | Sprints | Status | Progress |\n    12→|-------|------|---------|--------|----------|\n    13→| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n    14→| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n    15→| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n    16→| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n    17→| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n    18→| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |\n    19→\n    20→---\n    21→\n    22→## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n    23→\n    24→| # | Task | Status | Agent |\n    25→|---|------|--------|-------|\n    26→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    27→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    28→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    29→| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n    30→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    31→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    32→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    33→| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    34→| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    35→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    36→\n    37→---\n    38→\n    39→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n    40→\n    41→### Goal: Core external API infrastructure + free API integrations\n    42→\n    43→| # | Task | Priority | Complexity | Agent | Status |\n    44→|---|------|----------|------------|-------|--------|\n    45→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n    46→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n    47→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n    48→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n    49→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n    50→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n    51→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n    52→| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n    53→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n    54→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n    55→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n    56→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n    57→\n    58→---\n    59→\n    60→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n    61→\n    62→### Goal: 7 killer differentiators + Tier 2 API registrations\n    63→\n    64→| # | Task | Priority | Complexity | Agent | Status |\n    65→|---|------|----------|------------|-------|--------|\n    66→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n    67→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n    68→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n    69→| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n    70→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n    71→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n    72→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n    73→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n    74→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n    75→| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n    76→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n    77→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n    78→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n    79→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n    80→\n    81→---\n    82→\n    83→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n    84→\n    85→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    86→\n    87→| # | Task | Priority | Complexity | Agent | Status |\n    88→|---|------|----------|------------|-------|--------|\n    89→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n    90→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n    91→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n    92→| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    93→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n    94→| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n    95→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n    96→| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n    97→| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n    98→| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    99→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n   100→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n   101→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n   102→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n   103→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n   104→| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n   105→| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n   106→\n   107→---\n   108→\n   109→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n   110→\n   111→### Goal: Mock services + polish + production hardening\n   112→\n   113→| # | Task | Priority | Complexity | Agent | Status |\n   114→|---|------|----------|------------|-------|--------|\n   115→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n   116→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n   117→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n   118→| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n   119→| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n   120→| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n   121→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n   122→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n   123→| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n   124→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n   125→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n   126→| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n   127→| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n   128→| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n   129→\n   130→---\n   131→\n   132→## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)\n   133→\n   134→### Goal: Real AI, real-time features, advanced testing, production scaling\n   135→\n   136→Phase 5 is organized into 5 sub-phases matching the required agent structure:\n   137→Project Setup & Architecture, Backend Development, Frontend Development,\n   138→Testing & QA, and DevOps & Deployment.\n   139→\n   140→---\n   141→\n   142→### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n   143→\n   144→| # | Task | Priority | Complexity | Agent | Status |\n   145→|---|------|----------|------------|-------|--------|\n   146→| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n   147→| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n   148→| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n   149→| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n   150→| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n   151→| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n   152→| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n   153→| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n   154→\n   155→---\n   156→\n   157→### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n   158→\n   159→| # | Task | Priority | Complexity | Agent | Status |\n   160→|---|------|----------|------------|-------|--------|\n   161→| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n   162→| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n   163→| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n   164→| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n   165→| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n   166→| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n   167→| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n   168→| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n   169→| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n   170→| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n   171→| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n   172→| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n   173→\n   174→---\n   175→\n   176→### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n   177→\n   178→| # | Task | Priority | Complexity | Agent | Status |\n   179→|---|------|----------|------------|-------|--------|\n   180→| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n   181→| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n   182→| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n   183→| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n   184→| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n   185→| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n   186→| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n   187→| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n   188→| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n   189→\n   190→---\n   191→\n   192→### PHASE 5.4: TESTING & QA (Sprint 11)\n   193→\n   194→| # | Task | Priority | Complexity | Agent | Status |\n   195→|---|------|----------|------------|-------|--------|\n   196→| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n   197→| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n   198→| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n   199→| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n   200→| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n   201→| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n   202→| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n   203→\n   204→---\n   205→\n   206→### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n   207→\n   208→| # | Task | Priority | Complexity | Agent | Status |\n   209→|---|------|----------|------------|-------|--------|\n   210→| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n   211→| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n   212→| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n   213→| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n   214→| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n   215→| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n   216→| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |\n   217→| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n   218→\n   219→---\n   220→\n   221→## AGENT ROLES\n   222→\n   223→| Agent | Responsibility | Key Files |\n   224→|-------|---------------|-----------|\n   225→| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   226→| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   227→| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n   228→| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   229→| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n   230→\n   231→---\n   232→\n   233→## KEY DOCUMENTS\n   234→\n   235→| Document | Location | Purpose |\n   236→|----------|----------|---------|\n   237→| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n   238→| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n   239→| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n   240→| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n   241→| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n   242→| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n   243→| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n   244→| CLAUDE.md | Project root | Claude Code project instructions |\n   245→| SESSION-HISTORY.md | Project root | Persistent conversation history |\n   246→| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n   247→| DEVOPS.md | Project root | DevOps and deployment guide |\n   248→| EXECUTION-PLAN.md | Project root | This document |\n   249→\n   250→---\n   251→\n   252→## COMMUNICATION\n   253→\n   254→### Telegram (@SocialHomesBot)\n   255→- **Async notifications**: Build status, deployment confirmations, test results\n   256→- **Permission requests**: Routed via Telegram when user is away from desk\n   257→- **Progress updates**: Phase/sprint completion summaries\n   258→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   259→\n   260→### Session Continuity\n   261→- Update `SESSION-HISTORY.md` at end of every session\n   262→- `CLAUDE.md` provides context for new sessions\n   263→- Entire.io captures checkpoints on commits\n   264→\n   265→---\n   266→\n   267→## METRICS & SUCCESS CRITERIA\n   268→\n   269→| Metric | Target | Current |\n   270→|--------|--------|---------|\n   271→| Selenium test pass rate | > 98% | 99.7% ✅ |\n   272→| TypeScript errors | 0 | 0 ✅ |\n   273→| Vite build warnings | 0 critical | 0 ✅ |\n   274→| API response time (P95) | < 500ms | ~200-300ms ✅ |\n   275→| WCAG AA compliance | 100% | 100% ✅ |\n   276→| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n   277→| Bundle size | < 3MB | ~2.5MB ✅ |\n   278→| Cloud Run cold start | < 3s | < 2s ✅ |\n   279→\n   280→### Phase 5 Additional Targets\n   281→\n   282→| Metric | Target |\n   283→|--------|--------|\n   284→| AI response latency (Vertex AI) | < 3s for conversational queries |\n   285→| WebSocket connection stability | > 99.9% uptime |\n   286→| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n   287→| Selenium test coverage | > 95% of routes |\n   288→| Unit test coverage (services) | > 80% line coverage |\n   289→| Staging deployment frequency | Every PR |\n   290→| Database backup frequency | Daily automated |\n   291→| Lighthouse accessibility score | > 90 on all pages |\n   292→\n   293→---\n   294→\n   295→## DEFERRED ITEMS (From Phases 3-4)\n   296→\n   297→Items deferred from earlier phases, now included in Phase 5:\n   298→\n   299→| Original ID | Task | New Phase 5 ID |\n   300→|-------------|------|----------------|\n   301→| 3.17 | E2E testing for all new features | 5.4.1 |\n   302→| 4.12 | Full regression test suite | 5.4.1 |\n   303→| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n   304→| 4.14 | API reference documentation | 5.1.7 |\n   305→| 4.9 | Cache warming, batch updates | 5.2.6 |\n   306→\n   307→---\n   308→\n   309→## PHASE 5 TASK SUMMARY BY AGENT\n   310→\n   311→| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n   312→|-------|-------------|----|----|----|----|\n   313→| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n   314→| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n   315→| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n   316→| **Tester** | 7 | 0 | 3 | 4 | 0 |\n   317→| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n   318→| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n   319→\n   320→### Recommended Execution Order (Critical Path)\n   321→\n   322→**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n   323→1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n   324→2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n   325→3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n   326→\n   327→**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n   328→4. 5.2.4 (Notification dispatch — depends on WebSocket)\n   329→5. 5.2.11 (AI communication drafting — depends on Vertex AI)\n   330→6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n   331→7. 5.3.2 (Notification bell — depends on WebSocket backend)\n   332→8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n   333→\n   334→**Sprint 11 (Weeks 21-22): Frontend + Testing**\n   335→9. 5.3.3–5.3.9 (Remaining frontend features — parallel)\n   336→10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)\n   337→11. 5.5.2 (Staging environment — enables test pipeline)\n   338→\n   339→**Sprint 12 (Weeks 23-24): DevOps + Polish**\n   340→12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)\n   341→13. 5.1.7 (API documentation — after all endpoints stable)\n   342→14. Final regression testing and production deploy\n   343→\n   344→---\n   345→\n   346→**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n   347→"}]},"uuid":"d73688a8-aff9-42af-8337-a43df9560022","timestamp":"2026-02-25T15:23:20.500Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n| **Tester** | 7 | 0 | 3 | 4 | 0 |\n| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n\n**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n4. 5.2.4 (Notification dispatch — depends on WebSocket)\n5. 5.2.11 (AI communication drafting — depends on Vertex AI)\n6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n7. 5.3.2 (Notification bell — depends on WebSocket backend)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Frontend + Testing**\n9. 5.3.3–5.3.9 (Remaining frontend features — parallel)\n10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)\n11. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): DevOps + Polish**\n12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)\n13. 5.1.7 (API documentation — after all endpoints stable)\n14. Final regression testing and production deploy\n\n---\n\n**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n","numLines":347,"startLine":1,"totalLines":347}},"sourceToolAssistantUUID":"2a1dc8d1-7a48-4a79-8ab9-0cf6a16d4760"}
{"parentUuid":"d73688a8-aff9-42af-8337-a43df9560022","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AjNeLPftJ9LPeBwGMnFhtW","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RYbxPUg77z8Yo8nzDYS24f","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11116,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11116},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1wviFJ574pa4HafgaM","type":"assistant","uuid":"72556380-4f5d-4608-aa52-80cc093de3ae","timestamp":"2026-02-25T15:23:20.922Z"}
{"parentUuid":"72556380-4f5d-4608-aa52-80cc093de3ae","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RYbxPUg77z8Yo8nzDYS24f","type":"tool_result","content":"     1→# SocialHomes.Ai — Session History\n     2→\n     3→> Persistent conversation log across all Claude Code sessions.\n     4→> Updated at the end of each session to preserve context.\n     5→\n     6→---\n     7→\n     8→## Session 1 — 2026-02-12 (Google Drive path)\n     9→**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10→**Agent:** Claude Opus 4.6\n    11→\n    12→### What happened:\n    13→- Initial project setup and exploration\n    14→- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15→- Comprehensive Selenium testing initiated (17 test classes)\n    16→- Project overview sent to Telegram\n    17→\n    18→### Key decisions:\n    19→- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20→- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21→- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22→\n    23→---\n    24→\n    25→## Session 2 — 2026-02-13 (Migrated to C: drive)\n    26→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27→**Agent:** Claude Opus 4.6\n    28→\n    29→### What happened:\n    30→- Security cleanup: removed all exposed API keys and secrets from codebase\n    31→- Added full workflow actions and cross-entity navigation\n    32→- Eliminated all React Error #310 instances\n    33→- Redesigned login page\n    34→- Polished dashboard\n    35→- Updated DEVOPS.md\n    36→\n    37→### Commits:\n    38→- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n    39→- `944e952` — feat: add full workflow actions & cross-entity navigation\n    40→- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n    41→- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42→- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n    43→\n    44→---\n    45→\n    46→## Session 3 — 2026-02-14\n    47→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48→**Agent:** Claude Opus 4.6\n    49→\n    50→### What happened:\n    51→\n    52→#### Task 1: Verified 4 previous bug fixes\n    53→- BUG-001: ComplaintDetailPage.tsx — null checks intact\n    54→- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n    55→- BUG-003: AsbPage.tsx — navigation handlers intact\n    56→- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n    57→\n    58→#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59→| Warning | File | Fix |\n    60→|---------|------|-----|\n    61→| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62→| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63→| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64→| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65→| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66→| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67→| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68→| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69→| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70→| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71→| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72→\n    73→#### Task 3: Installed Entire.io CLI\n    74→- Installed v0.4.4 at ~/.local/bin/entire\n    75→- Strategy: manual-commit\n    76→- Fixed all 4 git hooks with PATH export\n    77→\n    78→#### Task 4: Build and deploy\n    79→- TypeScript: 0 errors\n    80→- Vite build: 2,580.62 kB JS bundle\n    81→- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82→- Push: succeeded → Cloud Build triggered\n    83→\n    84→---\n    85→\n    86→## Session 4 — 2026-02-14 (current)\n    87→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88→**Agent:** Claude Opus 4.6\n    89→\n    90→### What happened:\n    91→\n    92→#### Task 5: Telegram notifications setup\n    93→- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94→- Created .mcp.json with telegram MCP server config\n    95→- Added .mcp.json to .gitignore (contains bot token)\n    96→- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97→\n    98→#### Task 6: Persistent conversation history\n    99→- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100→- Added to .gitignore (local dev reference only)\n   101→\n   102→#### Task 7: Entire.io repo\n   103→- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104→- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105→- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106→- Entire.io dashboard: https://app.entire.io (login required)\n   107→\n   108→#### Task 8: UI/UX Audit Document (in progress)\n   109→- Frontend UI engineer agent reviewing all pages, components, interactions\n   110→- Output: comprehensive audit for fullstack and tester agents\n   111→\n   112→#### Task 9: BA Requirements — Public API Integrations (in progress)\n   113→- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114→- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115→- 7 killer differentiators documented\n   116→\n   117→#### Task 10: Master Execution Plan (pending)\n   118→- Will be created after Tasks 8 and 9 complete\n   119→\n   120→---\n   121→\n   122→## Architecture Reference\n   123→\n   124→### Tech Stack\n   125→- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126→- **Backend:** Express.js + TypeScript\n   127→- **Database:** Google Firestore\n   128→- **Hosting:** Google Cloud Run (europe-west2)\n   129→- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n   130→- **Maps:** Leaflet.js + OpenStreetMap\n   131→- **3D:** Three.js\n   132→- **Charts:** Recharts\n   133→- **AI:** YantraAssist (contextual AI assistant)\n   134→\n   135→### Key URLs\n   136→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137→- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138→- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139→- **Firebase Project:** gen-lang-client-0146156913\n   140→- **Entire.io dashboard:** https://app.entire.io\n   141→\n   142→### Personas\n   143→1. COO — Organisation-wide view\n   144→2. Head of Housing — Regional oversight\n   145→3. Housing Manager — Estate/block management\n   146→4. Housing Officer — Frontline casework\n   147→5. Repairs Operative — Job-level repairs\n   148→\n   149→### Telegram Bot\n   150→- Bot: @SocialHomesBot\n   151→- Chat ID: socialhomes:8020560167\n   152→- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153→\n   154→---\n   155→\n   156→## Session 5 — 2026-02-15\n   157→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158→**Agent:** Claude Opus 4.6\n   159→\n   160→### What happened:\n   161→\n   162→#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163→\n   164→**Backend Services Created (7 new files):**\n   165→| Service | File | Description |\n   166→|---------|------|-------------|\n   167→| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168→| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169→| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170→| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171→| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172→| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173→| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174→\n   175→**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176→- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177→- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178→- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179→- D4: `GET /benefits-check/:tenantId`\n   180→- D5: `GET /property-passport/:propertyId`\n   181→- D6: `GET /briefing/:estateId`\n   182→- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183→\n   184→**Frontend Components Created (4 new panels):**\n   185→- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n   186→- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n   187→- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n   188→- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n   189→\n   190→**Frontend Pages Updated:**\n   191→- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n   192→- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n   193→- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n   194→- `api-client.ts` — 13 new AI API methods\n   195→- `useApi.ts` — 10 new React Query hooks\n   196→\n   197→### Build Results:\n   198→- TypeScript (server): 0 errors\n   199→- TypeScript (app): 0 errors\n   200→- Vite build: 3,395 modules, 38.43s\n   201→- All clean on first attempt\n   202→\n   203→### Commits:\n   204→- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205→\n   206→### EXECUTION-PLAN.md updated:\n   207→- Phase 2 marked as DONE (all 14 tasks)\n   208→\n   209→---\n   210→\n   211→## Session 6 — 2026-02-16\n   212→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213→**Agent:** Claude Opus 4.6\n   214→\n   215→### What happened:\n   216→\n   217→#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n   218→\n   219→**New Backend Services (2 files):**\n   220→| Service | File | Lines | Description |\n   221→|---------|------|-------|-------------|\n   222→| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223→| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n   224→\n   225→**API Routes Added (8 new endpoints):**\n   226→- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227→- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228→\n   229→**Frontend Enhancements (5 files modified):**\n   230→- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231→- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232→- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233→- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n   234→\n   235→**Accessibility Fixes (WCAG AA):**\n   236→- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237→- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238→- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239→- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240→\n   241→### Build Results:\n   242→- TypeScript (server): 0 errors\n   243→- TypeScript (app): 0 errors\n   244→- Vite build: 3,396 modules, 39.22s — all clean\n   245→- Server build: clean\n   246→\n   247→### Files Changed: 13 modified + 2 new (523 insertions)\n   248→\n   249→### Commits:\n   250→- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251→\n   252→### EXECUTION-PLAN.md updated:\n   253→- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254→\n   255→---\n   256→\n   257→#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n   258→\n   259→**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260→| Service | Function | Description |\n   261→|---------|----------|-------------|\n   262→| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263→| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264→| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n   265→| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266→| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267→\n   268→**Admin Integration Dashboard:**\n   269→- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270→- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271→- Toggle enable/disable + Test Connection buttons\n   272→- Summary bar: total, active, issues, avg response time\n   273→- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274→- Updated App.tsx routing to use IntegrationsPage\n   275→\n   276→**Security Hardening:**\n   277→- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278→- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279→- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280→- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281→- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282→- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283→- JSON body limit reduced from 10mb to 1mb\n   284→\n   285→**Production Monitoring:**\n   286→- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287→- New `server/src/middleware/metrics.ts` — records every request on res.finish\n   288→- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289→- New admin route: GET /api/v1/admin/monitoring\n   290→- Frontend API client: adminApi.monitoring()\n   291→\n   292→**API Routes Added (8 new):**\n   293→- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294→- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295→\n   296→### Build Results:\n   297→- TypeScript (server): 0 errors\n   298→- TypeScript (app): 0 errors\n   299→- Vite build: 3,397 modules, 35.59s — all clean\n   300→- Server build: clean\n   301→\n   302→### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303→### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304→\n   305→### EXECUTION-PLAN.md updated:\n   306→- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307→\n   308→---\n   309→\n   310→## Session 7 — 2026-02-16 (Cloud Run Deployment)\n   311→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312→**Agent:** Claude Opus 4.6\n   313→\n   314→### What happened:\n   315→\n   316→#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n   317→\n   318→**Problem:** Previous deployment attempts failed:\n   319→1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320→2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321→\n   322→**Resolution:**\n   323→1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324→2. Created 4 secrets in Secret Manager:\n   325→   | Secret | Value Source |\n   326→   |--------|-------------|\n   327→   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328→   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329→   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330→   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331→3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332→4. Deployed using pre-built image from Artifact Registry:\n   333→   ```\n   334→   gcloud run deploy socialhomes \\\n   335→     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336→     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337→     --min-instances=0 --max-instances=10 --port=8080 \\\n   338→     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339→   ```\n   340→\n   341→**Result:**\n   342→- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n   343→- Health check: `healthy`, Firestore connected (984ms latency)\n   344→- Firebase config endpoint: secrets injected correctly\n   345→- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346→\n   347→### Key Discoveries:\n   348→- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349→- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→\n   361→---\n   362→\n   363→## Session 8 — 2026-02-18 (Business Analyst Session)\n   364→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366→\n   367→### What happened:\n   368→\n   369→#### Task: Comprehensive Project Analysis & Specification Documents\n   370→\n   371→Performed full project analysis covering:\n   372→- All 73 frontend TypeScript files across 19 page directories\n   373→- All 43 backend TypeScript files (routes, services, middleware, models)\n   374→- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375→- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376→- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377→\n   378→#### Created 3 Specification Documents in `docs/requirements/`:\n   379→\n   380→1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   381→   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382→   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383→   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384→\n   385→2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   386→   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387→   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388→   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389→\n   390→3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   391→   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392→   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393→\n   394→#### Updated EXECUTION-PLAN.md (v2.0):\n   395→\n   396→- Preserved Phases 0–4 (all DONE) with progress counts\n   397→- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398→  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399→  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400→  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401→  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402→  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403→- Added deferred items cross-reference table\n   404→- Added Phase 5 metrics targets\n   405→- Updated plan summary table\n   406→\n   407→### Files Changed:\n   408→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411→- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n   412→- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n   413→\n   414→### Commits:\n   415→- (pending — awaiting user instruction to commit)\n   416→\n   417→### Decisions Taken:\n   418→- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n   419→- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420→- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421→- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n   422→- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423→\n   424→### Pending Work:\n   425→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n   426→- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427→\n   428→---\n   429→\n   430→## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n   431→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   432→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   433→\n   434→### What happened:\n   435→\n   436→#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n   437→\n   438→Performed full project re-analysis and updated all specification documents to v3.0.\n   439→This session built upon Session 8's initial docs with significantly enhanced content.\n   440→\n   441→#### Updated 3 Specification Documents in `docs/requirements/`:\n   442→\n   443→1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   444→   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   445→   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n   446→     (added Global Search), Persona System (with AI focus per persona), AI-Native\n   447→     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n   448→     7 differentiators, AI-augmented workflows, signature interactions),\n   449→     Data Model, UI Design (full colour palette, typography, component library),\n   450→     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   451→   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n   452→\n   453→2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   454→   - Enhanced with precise version numbers from package.json files\n   455→   - Added request flow diagram, middleware pipeline detail\n   456→   - Added accessibility implementation section\n   457→   - Added Firestore security rules and indexes references\n   458→   - Added infrastructure references (GCP project IDs, URLs)\n   459→   - Added Entire.io to infrastructure table\n   460→\n   461→3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   462→   - Cleaned up and made consistent with Doc2 endpoint registry\n   463→   - Added NOMIS Labour Market extended mock (4.9)\n   464→   - Enhanced future roadmap with Phase 6 enterprise integrations\n   465→   - Added GOV.UK Notify API endpoints section (6.4)\n   466→\n   467→#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n   468→\n   469→- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n   470→  - 5.1.8: Firestore data migration strategy\n   471→  - 5.2.11: AI communication drafting with Vertex AI\n   472→  - 5.2.12: Tenant activity scoring\n   473→  - 5.3.9: Real-time case status indicators\n   474→  - (Renumbered existing tasks for consistency)\n   475→- Added detailed task descriptions with specific implementation details\n   476→- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n   477→- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n   478→- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n   479→\n   480→### Files Changed:\n   481→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n   482→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n   483→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n   484→- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n   485→- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n   486→\n   487→### Commits:\n   488→- (pending — awaiting user instruction to commit)\n   489→\n   490→### Decisions Taken:\n   491→- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n   492→- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n   493→- Created sprint-by-sprint critical path execution order\n   494→- Added agent task summary with priority breakdown\n   495→- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n   496→- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n   497→\n   498→### Pending Work:\n   499→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n   500→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   501→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   502→"}]},"uuid":"042e1edf-352b-4bd1-9af8-7c83a75107e6","timestamp":"2026-02-25T15:23:21.120Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n","numLines":502,"startLine":1,"totalLines":502}},"sourceToolAssistantUUID":"72556380-4f5d-4608-aa52-80cc093de3ae"}
{"parentUuid":"042e1edf-352b-4bd1-9af8-7c83a75107e6","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01E5XPQPZKgoAmLAAkv1gpaH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A6DtYM5uhk7o8t5NBtdFbb","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":55050,"cache_read_input_tokens":30259,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":55050},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1xNKctsqsUXH1uRGcg","type":"assistant","uuid":"c3f96948-a1c7-4cdf-bb7c-88998da57892","timestamp":"2026-02-25T15:23:27.363Z"}
{"parentUuid":"c3f96948-a1c7-4cdf-bb7c-88998da57892","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A6DtYM5uhk7o8t5NBtdFbb","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"4280d447-7277-48cb-a36f-783033432a1a","timestamp":"2026-02-25T15:23:27.369Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"c3f96948-a1c7-4cdf-bb7c-88998da57892"}
{"parentUuid":"4280d447-7277-48cb-a36f-783033432a1a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01CvVjDykfrxPnmP1g5hubN3","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent. I now have a thorough understanding of the entire project. The existing docs are at v3.0/v4.0. Let me create comprehensive v5.0 updates that fully capture the current state of the system and add detailed Phase 5 tasks. I'll write all three spec documents and the execution plan."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":85309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1xsiCNrqEmSydpkRap","type":"assistant","uuid":"5073ada7-ad4d-4704-9099-696150d3209a","timestamp":"2026-02-25T15:23:32.229Z"}
{"parentUuid":"5073ada7-ad4d-4704-9099-696150d3209a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01CvVjDykfrxPnmP1g5hubN3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0112bdSyCymEtNtF7dn1mX1d","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/44)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":85309,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":3,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV1xsiCNrqEmSydpkRap","type":"assistant","uuid":"e674b858-0574-4e22-9ebd-73a39ba15f68","timestamp":"2026-02-25T15:27:15.503Z"}
{"parentUuid":"e674b858-0574-4e22-9ebd-73a39ba15f68","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0112bdSyCymEtNtF7dn1mX1d","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt has been updated successfully."}]},"uuid":"575d02a7-7dd3-492b-8321-acae83653a42","timestamp":"2026-02-25T15:27:15.586Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/44)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc1 — SocialHomes.Ai Base Specification","-  Version: 4.0  |  Date: 2026-02-24","+  Version: 5.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":31,"oldLines":7,"newStart":31,"newLines":7,"lines":["     - Housing Associations (Registered Providers)","     - Local Authority housing departments","     - ALMOs (Arms Length Management Organisations)","-    Typical scale: 5,000–20,000 housing units across multiple regions.","+    Typical scale: 5,000-20,000 housing units across multiple regions."," "," 1.5 Simulated Organisation","     Name:           Riverside Crescent Housing Association (RCHA)"]},{"oldStart":54,"oldLines":7,"newStart":54,"newLines":13,"lines":[" 1.6 Built By","     Yantra Works — an AI-native development studio."," ","+1.7 Live Deployment","+    URL:            https://socialhomes-587984201316.europe-west2.run.app","+    Region:         europe-west2 (London)","+    Status:         LIVE and operational","+    GitHub:         https://github.com/rajivpeter/SocialHomes_ai"," ","+"," 2. CORE FUNCTIONAL MODULES (17 modules)"," ================================================================================"," "]},{"oldStart":77,"oldLines":22,"newStart":83,"newLines":22,"lines":["     Route: /explore","     Purpose: 7-level spatial hierarchy navigation","     Hierarchy:","-      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant","+      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant"," ","     Layout:","-    ┌────────────────────────────────┬─────────────────────────────────┐","-    │                                │  CONTEXT PANEL (scrollable)     │","-    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │","-    │                                │  - Attribute cards               │","-    │      Interactive Leaflet map   │  - Compliance status             │","-    │      OR Three.js 3D building   │  - KPI metrics                   │","-    │      depending on zoom level   │  - AI insights (purple section)  │","-    │                                │  - Children list (next level)    │","-    │                                │  - Quick actions                  │","-    ├────────────────────────────────┴─────────────────────────────────┤","-    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │","-    │ Data layer toggles: Crime / Damp Risk / Compliance               │","-    └──────────────────────────────────────────────────────────────────┘","+    +--------------------------------+---------------------------------+","+    |                                |  CONTEXT PANEL (scrollable)     |","+    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |","+    |                                |  - Attribute cards               |","+    |      Interactive Leaflet map   |  - Compliance status             |","+    |      OR Three.js 3D building   |  - KPI metrics                   |","+    |      depending on zoom level   |  - AI insights (purple section)  |","+    |                                |  - Children list (next level)    |","+    |                                |  - Quick actions                  |","+    +--------------------------------+---------------------------------+","+    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |","+    | Data layer toggles: Crime / Damp Risk / Compliance               |","+    +------------------------------------------------------------------+"," ","     Features:","     - Interactive Leaflet map with property markers (OpenStreetMap tiles)"]},{"oldStart":153,"oldLines":7,"newStart":159,"newLines":7,"lines":["     Purpose: Responsive and planned repairs case management","     Features:","     - 200+ repair cases with list/kanban toggle","-    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete","+    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete","     - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)","     - Appointment booking with time slots","     - Operative notes, before/after photos"]},{"oldStart":161,"oldLines":7,"newStart":167,"newLines":7,"lines":["     - Satisfaction survey (post-completion)","     - Recurrence prediction (AI)","     - Cost tracking and authorisation workflow","-    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,","+    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,","       priority, trade, Awaab's Law flags"," "," 2.6 Compliance Management"]},{"oldStart":172,"oldLines":7,"newStart":178,"newLines":7,"lines":["     - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER","     - Awaab's Law dedicated page:","       - Emergency hazard response: 24-hour countdown timer","-      - Significant hazard repair: 10–12 week countdown timer","+      - Significant hazard repair: 10-12 week countdown timer","       - Risk register with property-level assessments","       - Proactive inspection programme tracking","     - Building-level compliance: FRA, Building Safety Case"]},{"oldStart":198,"oldLines":7,"newStart":204,"newLines":7,"lines":["     Purpose: ASB case management with escalation pipeline","     Features:","     - 12 ASB cases with severity indicators","-    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession","+    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession","     - Evidence log with timestamps and categories","     - Live Crime Context (Police.uk data correlation)","     - ASB hotspot analysis per estate"]},{"oldStart":227,"oldLines":8,"newStart":233,"newLines":8,"lines":["     Purpose: Void management and lettings workflow","     Features:","     - Housing register management (Band A-D, bedroom need, medical priority)","-    - Void property kanban: Notice → Keys → Inspection → Works → Quality","-      → Ready → Offer → Let","+    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality","+      -> Ready -> Offer -> Let","     - Void duration prediction (AI)","     - Days void RAG indicators (green <14, amber 14-28, red >28)","     - Applicant shortlisting and matching"]},{"oldStart":296,"oldLines":14,"newStart":302,"newLines":14,"lines":["     - AI predictions and alerts","     - Estate-level neighbourhood briefing accordion","     - Compliance section with Big 6 stats","-    - [Start my day →] and [Skip briefing] buttons","+    - [Start my day ->] and [Skip briefing] buttons"," "," 2.15 Admin System","     Route: /admin, /admin/integrations","     Purpose: System configuration and management","     Features:","     - Organisation profile and branding","-    - User management with RBAC (10 default roles × permission matrix)","+    - User management with RBAC (10 default roles x permission matrix)","     - Team and patch management with caseload balancing","     - Workflow engine (visual builder with triggers/conditions/actions)","     - Integration hub (20 integrations across 3 tiers)"]},{"oldStart":322,"oldLines":8,"newStart":328,"newLines":8,"lines":["     Purpose: Tenant self-service interface","     Features:","     - Distinct lighter/warmer UI theme (visually separate from staff system)","-    - Report repair (conversational wizard: room → problem → photo →","-      appointment → confirm)","+    - Report repair (conversational wizard: room -> problem -> photo ->","+      appointment -> confirm)","     - Check rent balance and make payment","     - View active repairs with photos and status","     - Quick message to housing officer"]},{"oldStart":406,"oldLines":7,"newStart":412,"newLines":7,"lines":["     - Dynamic information fields — calculated data not in standard layout"," ","     Styling: Purple left border (--status-ai), --surface-elevated background,","-    \"✦\" symbol prefix on AI-generated content","+    \"*\" symbol prefix on AI-generated content"," "," 4.2 The AI Action Flow Pattern","     Every AI dynamic button follows this pattern:"]},{"oldStart":425,"oldLines":11,"newStart":431,"newLines":11,"lines":["     Content changes based on current page/entity AND user persona"," ","     Panel Structure:","-    - 🔴 URGENT: Items needing immediate action","-    - 🟠 ATTENTION: Items approaching deadlines","-    - 💡 INSIGHTS: AI predictions & recommendations","-    - 📊 BRIEFING: Contextual summary & key stats","-    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context","+    - RED URGENT: Items needing immediate action","+    - ORANGE ATTENTION: Items approaching deadlines","+    - INSIGHTS: AI predictions & recommendations","+    - BRIEFING: Contextual summary & key stats","+    - EXTERNAL FACTORS: Weather, UC changes, local context","     - [Ask Yantra...] chat input at bottom"," ","     Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)"]},{"oldStart":437,"oldLines":12,"newStart":443,"newLines":12,"lines":[" 4.4 Prediction Models (8 total)","     MODEL 1: Arrears Risk","       Input: Payment history, UC status, seasonal patterns, life events","-      Output: Risk score (0–100), predicted arrears amount, recommended actions","+      Output: Risk score (0-100), predicted arrears amount, recommended actions"," ","     MODEL 2: Damp & Mould Risk","       Input: Weather (0.25), building age/type (0.25), repair history (0.20),","              IoT sensors (0.20), occupancy (0.10)","-      Output: Risk score (0–100), factor breakdown, proactive recommendations","+      Output: Risk score (0-100), factor breakdown, proactive recommendations"," ","     MODEL 3: Complaint Escalation","       Input: Response times, complaint category, tenant history, complexity"]},{"oldStart":460,"oldLines":7,"newStart":466,"newLines":7,"lines":["       Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),","              social isolation (0.15), age risk (0.10), dependents (0.10),","              UC transition (0.10)","-      Output: Vulnerability score (0–100), detected flags, recommended support","+      Output: Vulnerability score (0-100), detected flags, recommended support"," ","     MODEL 7: ASB Escalation","       Input: Case history, estate context, crime data, tenant profile"]},{"oldStart":500,"oldLines":7,"newStart":506,"newLines":7,"lines":["         Frontend: Property detail page (sensor data display)"," "," 4.6 AI-Augmented Workflows","-    - Repair Logging: Tenant describes issue → AI categorises SOR code,","+    - Repair Logging: Tenant describes issue -> AI categorises SOR code,","       assigns priority, identifies trade, checks asbestos, checks vulnerability,","       checks recurring pattern, estimates cost, flags Awaab's Law","     - Inbound Contact Triage: AI reads/summarises contact, categorises,"]},{"oldStart":513,"oldLines":12,"newStart":519,"newLines":12,"lines":["       satisfaction), generates prevention plan"," "," 4.7 Signature AI Interactions","-    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task","-    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)","-    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference","-       → preventive advice letters → inspection tasks","-    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar","-    5. \"Complaint Prevention\" — pattern detection → prevention plan execution","+    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task","+    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)","+    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference","+       -> preventive advice letters -> inspection tasks","+    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar","+    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution"," "," "," 5. DATA MODEL (SUMMARY)"]},{"oldStart":527,"oldLines":7,"newStart":533,"newLines":7,"lines":[" 5.1 Core Entities","     - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance","     - Tenant (68 records) — name, contact, vulnerability, household, UC status","-    - Tenancy — property–tenant link, start date, type, rent, balance","+    - Tenancy — property-tenant link, start date, type, rent, balance","     - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould","     - Repair (200 records) — SOR code, priority, SLA, appointments, contractor","     - Complaint (34 records) — stage, deadlines, Ombudsman reference"]},{"oldStart":537,"oldLines":21,"newStart":543,"newLines":22,"lines":[" "," 5.2 Supporting Entities","     - Organisation — RCHA metadata, branding, settings","-    - Region (3) — London, South, Midlands","+    - Region (5 seeded) — London, South, Midlands, etc.","     - Local Authority — Southwark, Lewisham, Lambeth","     - Estate (5) — name, location, block count, manager","-    - Block — floors, cores, unit count","+    - Block (8) — floors, cores, unit count","     - User — auth profile, role, persona, team","     - Team — name, manager, patch, members","     - Integration — external service config (20 integrations)","     - Report — template definitions (27 reports)","     - ExternalDataCache — TTL-based cache for API responses"," ","-5.3 Firestore Collections (17)","-    users, properties, tenants, cases, activities, tasks,","-    repairs, complaints, asb, financial, damp-mould,","-    organisations, teams, integrations, auditLog,","-    externalDataCache, imdData","+5.3 Firestore Collections (17+)","+    organisations, regions, localAuthorities, estates, blocks,","+    properties, tenants, cases, activities, communications,","+    rentTransactions, users, auditLog, notifications,","+    voidProperties, applicants, tsmMeasures, externalDataCache,","+    hactCodes, imdData"," "," 5.4 Case Reference Formats","     | Type        | Format           | Colour  |"]},{"oldStart":619,"oldLines":23,"newStart":626,"newLines":23,"lines":[" 6.5 Design Principles","     - Dark mode is default — Yantra Works brand palette throughout","     - Mobile-aware responsive design","-    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)","+    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)","     - Skip-to-content link","     - Reduced-motion support (@media prefers-reduced-motion)","     - Focus-visible outlines on all interactive elements","     - Screen-reader-only (.sr-only) text for context","     - Animations throughout — staggered reveals, sliding panels, smooth","       transitions, pulsing alerts. UI must feel ALIVE, not static.","-    - UK conventions: DD/MM/YYYY, British English, GBP £","+    - UK conventions: DD/MM/YYYY, British English, GBP"," ","-6.6 Component Library","+6.6 Component Library (16 shared components)","     - KpiCard — metric display with trend sparkline","     - StatusPill — status badge (green/amber/red)","     - ActionModal — accessible form modal with focus trap, Escape handler,","       aria attributes, form validation, previous focus restoration","     - AiActionCard — purple-bordered AI suggestion card","     - CountdownTimer — deadline countdown with color urgency transitions","-      (green → peach → garnet → pulsing garnet)","+      (green -> peach -> garnet -> pulsing garnet)","     - PropertyMap — Leaflet map with markers","     - HelpDrawer — full-screen contextual help (20 topics)","     - DampIntelligencePanel — damp risk factor display with score badge"]},{"oldStart":643,"oldLines":6,"newStart":650,"newLines":8,"lines":["     - BenefitsPanel — entitlement list with status icons, unclaimed amounts","     - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions","     - ProtectedRoute — Firebase auth guard component","+    - YantraAssist — slide-in panel (320px from right) with context-aware","+      content, chat interface, urgency sections"," "," "," 7. REGULATORY COMPLIANCE"]},{"oldStart":676,"oldLines":7,"newStart":685,"newLines":7,"lines":["     - Keyboard navigation (Tab, Escape)","     - ARIA labels, roles, described-by","     - Reduced-motion media query","-    - Color contrast ratio ≥ 4.5:1","+    - Color contrast ratio >= 4.5:1","     - Screen-reader-only text (.sr-only)","     - Focus-visible outlines (*:focus-visible)"," "]},{"oldStart":704,"oldLines":7,"newStart":713,"newLines":7,"lines":["     - Request correlation via X-Request-ID"," "," 8.3 Scalability","-    - Cloud Run: 0–10 instances (auto-scaling)","+    - Cloud Run: 0-10 instances (auto-scaling)","     - Firestore: NoSQL, horizontally scalable","     - External API caching reduces load","     - Concurrency: 80 requests/instance"]},{"oldStart":731,"oldLines":10,"newStart":740,"newLines":10,"lines":["     Diverse tenant names reflecting London demographics"," "," 9.2 Financial Profile","-    Rents: social £95-140/week, affordable £140-200/week","-    Service charges: £5-35/week","+    Rents: social GBP 95-140/week, affordable GBP 140-200/week","+    Service charges: GBP 5-35/week","     Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%","-    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k","+    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k"," "," 9.3 Cases","     200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)"]},{"oldStart":756,"oldLines":19,"newStart":765,"newLines":19,"lines":["     URL: https://socialhomes-587984201316.europe-west2.run.app","     Region: europe-west2 (London)","     Status: LIVE and operational","-    Database: 460+ documents across 17 Firestore collections","+    Database: 460+ documents across 17+ Firestore collections"," "," 10.2 Build Metrics","     | Metric                    | Value           |","     |---------------------------|-----------------|","     | Frontend modules          | 3,397           |","-    | Frontend build time       | ~35–39 seconds  |","+    | Frontend build time       | ~35-39 seconds  |","     | Backend TypeScript errors | 0               |","     | Frontend TypeScript errors| 0               |","     | Selenium tests            | 331             |","     | Selenium pass rate        | 99.7%           |","     | Unit tests (public data)  | 66              |","-    | Firestore collections     | 17              |","+    | Firestore collections     | 17+             |","     | Seeded properties         | 75              |","     | Seeded tenants            | 68              |","     | Seeded cases              | 279+            |"]},{"oldStart":785,"oldLines":9,"newStart":794,"newLines":9,"lines":["     Phase 2: Intelligence          — DONE (14/14)","     Phase 3: Enrichment            — DONE (14/17, 3 deferred)","     Phase 4: Completion            — DONE (11/14, 3 deferred)","-    Phase 5: Evolution             — TODO (0/36)","+    Phase 5: Evolution             — TODO (0/44)"," "," ================================================================================","   End of Doc1 — SocialHomes.Ai Base Specification","-  Yantra Works | 2026-02-24","+  Yantra Works | 2026-02-25"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 4.0  |  Date: 2026-02-24\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000–20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country → Region → Local Authority → Estate → Block → Core → Unit → Tenant\n\n    Layout:\n    ┌────────────────────────────────┬─────────────────────────────────┐\n    │                                │  CONTEXT PANEL (scrollable)     │\n    │      MAP / 3D VIEW (60%)       │  - Entity name & summary        │\n    │                                │  - Attribute cards               │\n    │      Interactive Leaflet map   │  - Compliance status             │\n    │      OR Three.js 3D building   │  - KPI metrics                   │\n    │      depending on zoom level   │  - AI insights (purple section)  │\n    │                                │  - Children list (next level)    │\n    │                                │  - Quick actions                  │\n    ├────────────────────────────────┴─────────────────────────────────┤\n    │ Bottom bar: Level summary stats | Toggle: Map/List/3D view       │\n    │ Data layer toggles: Crime / Damp Risk / Compliance               │\n    └──────────────────────────────────────────────────────────────────┘\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported → Diagnosed → Scheduled → In Progress → Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text → AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10–12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning → ABC → CPW → CPN → Injunction → Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice → Keys → Inspection → Works → Quality\n      → Ready → Offer → Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day →] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles × permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room → problem → photo →\n      appointment → confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"✦\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - 🔴 URGENT: Items needing immediate action\n    - 🟠 ATTENTION: Items approaching deadlines\n    - 💡 INSIGHTS: AI predictions & recommendations\n    - 📊 BRIEFING: Contextual summary & key stats\n    - 🌤️ EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0–100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0–100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0–100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue → AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email → edit → send → follow-up task\n    2. \"Inbound Email Triage\" — AI reads → categorises → creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast → risk cross-reference\n       → preventive advice letters → inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking → letters → calendar\n    5. \"Complaint Prevention\" — pattern detection → prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property–tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (3) — London, South, Midlands\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17)\n    users, properties, tenants, cases, activities, tasks,\n    repairs, complaints, asb, financial, damp-mould,\n    organisations, teams, integrations, auditLog,\n    externalDataCache, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast ≥ 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP £\n\n6.6 Component Library\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green → peach → garnet → pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio ≥ 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0–10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social £95-140/week, affordable £140-200/week\n    Service charges: £5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <£250, 10% £250-500, 5% £500-1k, 5% >£1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17 Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35–39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17              |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/36)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-24\n================================================================================\n"},"sourceToolAssistantUUID":"e674b858-0574-4e22-9ebd-73a39ba15f68"}
{"parentUuid":"575d02a7-7dd3-492b-8321-acae83653a42","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_019FBduoAVC5fPjacT9dtR5L","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011GWDAHv9tq1vAB2ARngAMY","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9809,"cache_read_input_tokens":85675,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9809},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2FezhAiBLFWafdTN2Q","type":"assistant","uuid":"802d71e6-43c2-43ca-9138-fda4a55f707d","timestamp":"2026-02-25T15:27:21.877Z"}
{"parentUuid":"802d71e6-43c2-43ca-9138-fda4a55f707d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011GWDAHv9tq1vAB2ARngAMY","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"c803a654-3bd8-455f-bb9e-8d03499a3e3f","timestamp":"2026-02-25T15:27:21.883Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"802d71e6-43c2-43ca-9138-fda4a55f707d"}
{"parentUuid":"c803a654-3bd8-455f-bb9e-8d03499a3e3f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01EGF1ezcWtzcMp4GGYQZPVV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UnREUA5XnrseoaDkKmeyu2","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                               |\n                                                      +--------v---------+\n                                                      |    blocks (8)    |\n                                                      +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":95484,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2GASkWqZJnR5B5HXme","type":"assistant","uuid":"309e48d1-170e-46a4-8c4d-6403c601cba0","timestamp":"2026-02-25T15:30:45.592Z"}
{"parentUuid":"309e48d1-170e-46a4-8c4d-6403c601cba0","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UnREUA5XnrseoaDkKmeyu2","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt has been updated successfully."}]},"uuid":"30b23012-856a-4d70-a152-78993edc669a","timestamp":"2026-02-25T15:30:45.710Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                               |\n                                                      +--------v---------+\n                                                      |    blocks (8)    |\n                                                      +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Version: 3.0  |  Date: 2026-02-23","+  Version: 5.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":14,"oldLines":60,"newStart":14,"newLines":60,"lines":[" "," 1.2 High-Level Architecture Diagram (ASCII)"," ","-    ┌─────────────────────────────────────────────────────────────────┐","-    │                        CLOUD RUN (europe-west2)                │","-    │  ┌───────────────────────────────────────────────────────────┐  │","-    │  │                    Express.js Server                      │  │","-    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │","-    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │","-    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │","-    │  │  │              │  │              │  │ Rate Limit/   │  │  │","-    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │","-    │  │  │ Output       │  │ modules      │  │               │  │  │","-    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │","-    │  └───────────────────────────┼───────────────────────────────┘  │","-    │                              │                                  │","-    │  ┌───────────────────────────┼───────────────────────────────┐  │","-    │  │                    Service Layer (25 modules)             │  │","-    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │","-    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │","-    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │","-    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │","-    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │","-    │  └───────────────────────────┼───────────────────────────────┘  │","-    └──────────────────────────────┼──────────────────────────────────┘","-                                   │","-              ┌────────────────────┼────────────────────┐","-              │                    │                     │","-    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐","-    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │","-    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │","-    └────────────────┘  └────────────────┘  └────────────────┘","-              │","-    ┌─────────▼──────────────────────────────────────────┐","-    │              External APIs (3 Tiers)               │","-    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │","-    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │","-    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │","-    └────────────────────────────────────────────────────┘","+    +-------------------------------------------------------------+","+    |                        CLOUD RUN (europe-west2)              |","+    |  +-----------------------------------------------------------+","+    |  |                    Express.js Server                      |","+    |  |  +--------------+  +--------------+  +---------------+   |","+    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |","+    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |","+    |  |  |              |  |              |  | Rate Limit/   |   |","+    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |","+    |  |  | Output       |  | modules      |  |               |   |","+    |  |  +--------------+  +------+-------+  +---------------+   |","+    |  +---------------------------+-------------------------------+","+    |                              |                                |","+    |  +---------------------------+-------------------------------+","+    |  |                    Service Layer (25 modules)             |","+    |  |  +---------+ +----------+ +----------+ +-------------+   |","+    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |","+    |  |  | Services| | API      | | Notify   | | Services    |   |","+    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |","+    |  |  +---------+ +----------+ +----------+ +-------------+   |","+    |  +---------------------------+-------------------------------+","+    +------------------------------+--------------------------------+","+                                   |","+              +--------------------+--------------------+","+              |                    |                     |","+    +---------v------+  +---------v------+  +----------v-----+","+    |   Firestore    |  |  Firebase Auth |  | Secret Manager |","+    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |","+    +----------------+  +----------------+  +----------------+","+              |","+    +---------v--------------------------------------------+","+    |              External APIs (3 Tiers)                 |","+    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |","+    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |","+    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |","+    +------------------------------------------------------+"," "," 1.3 Request Flow Diagram"," ","-    Browser → React SPA → api-client.ts → HTTP Request","-                                              │","-                                              ▼","-    Express Server ← Middleware Pipeline ← Route Handler","-         │               │","-         │     ┌─────────┴──────────────────────────┐","-         │     │ Morgan → Helmet → CORS → Compression│","-         │     │ → JSON Parser (1MB) → X-Request-ID  │","-         │     │ → Rate Limiter → Metrics → Handler   │","-         │     │ → Error Handler → Response            │","-         │     └──────────────────────────────────────┘","-         │","-         ├─→ Firestore (read/write)","-         ├─→ External API Proxy (with cache)","-         └─→ AI Service (computation)","+    Browser -> React SPA -> api-client.ts -> HTTP Request","+                                              |","+                                              v","+    Express Server <- Middleware Pipeline <- Route Handler","+         |               |","+         |     +-------------------------------------------+","+         |     | Morgan -> Helmet -> CORS -> Compression   |","+         |     | -> JSON Parser (1MB) -> X-Request-ID      |","+         |     | -> Rate Limiter -> Metrics -> Handler     |","+         |     | -> Error Handler -> Response               |","+         |     +-------------------------------------------+","+         |","+         +---> Firestore (read/write)","+         +---> External API Proxy (with cache)","+         +---> AI Service (computation)"," "," "," 2. TECHNOLOGY STACK"]},{"oldStart":81,"oldLines":7,"newStart":81,"newLines":7,"lines":["     | Language           | TypeScript              | 5.9.3      |","     | Router             | React Router            | v7         |","     | Styling            | Tailwind CSS            | 4.1.18     |","-    | State Management   | React Context + Hooks   | —          |","+    | State Management   | React Context + Hooks   | --         |","     | Data Fetching      | @tanstack/react-query   | 5.90.20    |","     | 3D Visualization   | Three.js + React Three  | 0.182.0    |","     | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |"]},{"oldStart":135,"oldLines":50,"newStart":135,"newLines":50,"lines":[" 3.1 Directory Structure"," ","     app/src/","-    ├── App.tsx                  — Router with 40+ routes","-    ├── main.tsx                 — React DOM entry point (QueryClient)","-    ├── index.css                — Global styles, animations, accessibility","-    │","-    ├── pages/                   — 19 page directories","-    │   ├── admin/               — AdminPage, IntegrationsPage","-    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)","-    │   ├── allocations/         — AllocationsPage","-    │   ├── asb/                 — AsbPage, AsbDetailPage","-    │   ├── auth/                — LoginPage (Firebase + Google)","-    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)","-    │   ├── communications/      — CommunicationsPage","-    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage","-    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage","-    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)","-    │   ├── explore/             — ExplorePage (7-level drill-down)","-    │   ├── properties/          — PropertiesPage, PropertyDetailPage,","-    │   │                          ApplicationPage, ViewingBookingPage","-    │   ├── rent/                — RentPage","-    │   ├── repairs/             — RepairsPage, RepairDetailPage","-    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage","-    │   ├── search/              — SearchPage","-    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage","-    │   ├── tenant-portal/       — TenantPortalPage","-    │   └── shared/              — ComingSoonPage","-    │","-    ├── components/","-    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist","-    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,","-    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,","-    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,","-    │                              PropertyMap, StatusPill, VulnerabilityPanel)","-    │","-    ├── data/                    — Mock/seed data (10 files)","-    ├── hooks/                   — Custom hooks (3 files)","-    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods","-    │   ├── useEntityIntelligence.ts  — AI scoring hooks","-    │   └── usePersonaScope.ts   — Persona-based data filtering","-    ├── types/                   — TypeScript definitions (721 lines)","-    ├── services/                — API client (70+ methods), Firebase, AI drafting,","-    │                              public data helpers","-    ├── contexts/                — AuthContext, AppContext","-    ├── utils/                   — Formatting utilities (safeText, etc.)","-    └── assets/                  — Images, fonts","+    +-- App.tsx                  -- Router with 40+ routes","+    +-- main.tsx                 -- React DOM entry point (QueryClient)","+    +-- index.css                -- Global styles, animations, accessibility","+    |","+    +-- pages/                   -- 19 page directories","+    |   +-- admin/               -- AdminPage, IntegrationsPage","+    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)","+    |   +-- allocations/         -- AllocationsPage","+    |   +-- asb/                 -- AsbPage, AsbDetailPage","+    |   +-- auth/                -- LoginPage (Firebase + Google)","+    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)","+    |   +-- communications/      -- CommunicationsPage","+    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage","+    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage","+    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)","+    |   +-- explore/             -- ExplorePage (7-level drill-down)","+    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,","+    |   |                          ApplicationPage, ViewingBookingPage","+    |   +-- rent/                -- RentPage","+    |   +-- repairs/             -- RepairsPage, RepairDetailPage","+    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage","+    |   +-- search/              -- SearchPage","+    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage","+    |   +-- tenant-portal/       -- TenantPortalPage","+    |   +-- shared/              -- ComingSoonPage","+    |","+    +-- components/","+    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist","+    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,","+    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,","+    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,","+    |                              PropertyMap, StatusPill, VulnerabilityPanel)","+    |","+    +-- data/                    -- Mock/seed data (10 files)","+    +-- hooks/                   -- Custom hooks (3 files)","+    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods","+    |   +-- useEntityIntelligence.ts  -- AI scoring hooks","+    |   +-- usePersonaScope.ts   -- Persona-based data filtering","+    +-- types/                   -- TypeScript definitions (721 lines)","+    +-- services/                -- API client (70+ methods), Firebase, AI drafting,","+    |                              public data helpers","+    +-- contexts/                -- AuthContext, AppContext","+    +-- utils/                   -- Formatting utilities (safeText, etc.)","+    +-- assets/                  -- Images, fonts"," "," 3.2 Routing Architecture (React Router v7)","     All routes defined in App.tsx within BrowserRouter."]},{"oldStart":186,"oldLines":37,"newStart":186,"newLines":37,"lines":["     Protected routes use ProtectedRoute component (Firebase auth guard)."," ","     Key Route Groups:","-    /                           → Redirect to /dashboard","-    /login                      → LoginPage (public)","-    /dashboard                  → DashboardPage","-    /explore                    → ExplorePage","-    /tenancies                  → TenanciesPage","-    /tenancies/:id              → TenancyDetailPage","-    /properties                 → PropertiesPage","-    /properties/:id             → PropertyDetailPage","-    /properties/:id/apply       → ApplicationPage","-    /properties/:id/book-viewing→ ViewingBookingPage","-    /repairs                    → RepairsPage","-    /repairs/:id                → RepairDetailPage","-    /compliance                 → CompliancePage","-    /compliance/:type           → ComplianceTypePage","-    /compliance/awaabs-law      → AwaabsLawPage","-    /complaints                 → ComplaintsPage","-    /complaints/:id             → ComplaintDetailPage","-    /asb                        → AsbPage","-    /asb/:id                    → AsbDetailPage","-    /rent                       → RentPage","-    /allocations                → AllocationsPage","-    /communications             → CommunicationsPage","-    /reports                    → ReportsPage","-    /reports/:type              → DynamicReportPage","-    /reports/tsm                → TsmReportPage","-    /ai-centre                  → AiCentrePage","-    /briefing                   → BriefingPage","-    /admin                      → AdminPage","-    /admin/integrations         → IntegrationsPage","-    /tenant-portal              → TenantPortalPage","-    /search                     → SearchPage","+    /                            -> Redirect to /dashboard","+    /login                       -> LoginPage (public)","+    /dashboard                   -> DashboardPage","+    /explore                     -> ExplorePage","+    /tenancies                   -> TenanciesPage","+    /tenancies/:id               -> TenancyDetailPage","+    /properties                  -> PropertiesPage","+    /properties/:id              -> PropertyDetailPage","+    /properties/:id/apply        -> ApplicationPage","+    /properties/:id/book-viewing -> ViewingBookingPage","+    /repairs                     -> RepairsPage","+    /repairs/:id                 -> RepairDetailPage","+    /compliance                  -> CompliancePage","+    /compliance/:type            -> ComplianceTypePage","+    /compliance/awaabs-law       -> AwaabsLawPage","+    /complaints                  -> ComplaintsPage","+    /complaints/:id              -> ComplaintDetailPage","+    /asb                         -> AsbPage","+    /asb/:id                     -> AsbDetailPage","+    /rent                        -> RentPage","+    /allocations                 -> AllocationsPage","+    /communications              -> CommunicationsPage","+    /reports                     -> ReportsPage","+    /reports/:type               -> DynamicReportPage","+    /reports/tsm                 -> TsmReportPage","+    /ai-centre                   -> AiCentrePage","+    /briefing                    -> BriefingPage","+    /admin                       -> AdminPage","+    /admin/integrations          -> IntegrationsPage","+    /tenant-portal               -> TenantPortalPage","+    /search                      -> SearchPage"," "," 3.3 State Management","     - React Context for global state (auth user, persona)"]},{"oldStart":229,"oldLines":6,"newStart":229,"newLines":7,"lines":["     - useApi.ts: React Query hooks wrapping api-client methods","     - useEntityIntelligence.ts: AI scoring hooks","     - usePersonaScope.ts: Persona-based data filtering","+    - Timestamp sanitization in api-client to handle Firestore timestamps"," "," 3.5 Frontend Conventions","     - safeText() helper for rendering potentially undefined values"]},{"oldStart":255,"oldLines":66,"newStart":256,"newLines":66,"lines":[" 4.1 Directory Structure"," ","     server/src/","-    ├── index.ts                 — Express entry, middleware, route registration","-    │","-    ├── middleware/               — 5 middleware modules","-    │   ├── auth.ts              — Firebase token verification + X-Persona fallback","-    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)","-    │   ├── metrics.ts           — Request/response metrics recording","-    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)","-    │   └── rbac.ts              — Role-based access control","-    │","-    ├── routes/                  — 16 route modules (2,300+ lines)","-    │   ├── admin.ts             — Integration management, monitoring","-    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints","-    │   ├── auth.ts              — Login, register, logout","-    │   ├── briefing.ts          — Personalised morning briefing","-    │   ├── booking.ts           — Viewing bookings, applications","-    │   ├── cases.ts             — Unified case CRUD + pagination","-    │   ├── compliance.ts        — Big 6 compliance data","-    │   ├── explore.ts           — Hierarchy drill-down data","-    │   ├── export.ts            — CSV/PDF exports","-    │   ├── lettings.ts          — Void management, allocations","-    │   ├── properties.ts        — Property list/detail","-    │   ├── public-data.ts       — External API proxy (Tier 1-2)","-    │   ├── rent.ts              — Arrears, statements, transactions","-    │   ├── reports.ts           — 27 regulatory reports","-    │   └── tenants.ts           — Tenant list/detail","-    │","-    ├── services/                — 25 service modules","-    │   ├── external-api.ts      — Cache-through, rate limiting, audit","-    │   ├── firestore.ts         — Firestore connection + helpers","-    │   ├── firebase-admin.ts    — Firebase Admin initialization","-    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm","-    │   ├── crime-context.ts     — Police data correlation","-    │   ├── vulnerability-detection.ts  — 7-factor scoring","-    │   ├── benefits-engine.ts   — UK benefit rules engine","-    │   ├── property-passport.ts — Multi-source aggregation","-    │   ├── neighbourhood-briefing.ts   — Per-estate briefing","-    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)","-    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)","-    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints","-    │   ├── monitoring.ts        — Metrics singleton","-    │   ├── hact-export.ts       — HACT reporting format","-    │   ├── seed.ts              — Database seeding","-    │   ├── seed-data.ts         — Seed data definitions","-    │   └── hact-codes.ts        — SOR code definitions","-    │","-    ├── models/","-    │   ├── firestore-schemas.ts — Firestore collection schemas","-    │   └── hact-codes.ts        — Repair code models","-    │","-    └── scripts/","-        ├── seed-imd.ts          — IMD data loader","-        └── seed.ts              — Main seed runner","+    +-- index.ts                 -- Express entry, middleware, route registration","+    |","+    +-- middleware/               -- 5 middleware modules","+    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback","+    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)","+    |   +-- metrics.ts           -- Request/response metrics recording","+    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)","+    |   +-- rbac.ts              -- Role-based access control","+    |","+    +-- routes/                  -- 16 route modules (2,300+ lines)","+    |   +-- admin.ts             -- Integration management, monitoring","+    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints","+    |   +-- auth.ts              -- Login, register, logout","+    |   +-- briefing.ts          -- Personalised morning briefing","+    |   +-- booking.ts           -- Viewing bookings, applications","+    |   +-- cases.ts             -- Unified case CRUD + pagination","+    |   +-- compliance.ts        -- Big 6 compliance data","+    |   +-- explore.ts           -- Hierarchy drill-down data","+    |   +-- export.ts            -- CSV/PDF exports","+    |   +-- lettings.ts          -- Void management, allocations","+    |   +-- properties.ts        -- Property list/detail","+    |   +-- public-data.ts       -- External API proxy (Tier 1-2)","+    |   +-- rent.ts              -- Arrears, statements, transactions","+    |   +-- reports.ts           -- 27 regulatory reports","+    |   +-- tenants.ts           -- Tenant list/detail","+    |","+    +-- services/                -- 25 service modules","+    |   +-- external-api.ts      -- Cache-through, rate limiting, audit","+    |   +-- firestore.ts         -- Firestore connection + helpers","+    |   +-- firebase-admin.ts    -- Firebase Admin initialization","+    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm","+    |   +-- crime-context.ts     -- Police data correlation","+    |   +-- vulnerability-detection.ts  -- 7-factor scoring","+    |   +-- benefits-engine.ts   -- UK benefit rules engine","+    |   +-- property-passport.ts -- Multi-source aggregation","+    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing","+    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)","+    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)","+    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints","+    |   +-- monitoring.ts        -- Metrics singleton","+    |   +-- hact-export.ts       -- HACT reporting format","+    |   +-- seed.ts              -- Database seeding","+    |   +-- seed-data.ts         -- Seed data definitions","+    |   +-- hact-codes.ts        -- SOR code definitions","+    |","+    +-- models/","+    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)","+    |   +-- hact-codes.ts        -- Repair code models","+    |","+    +-- scripts/","+        +-- seed-imd.ts          -- IMD data loader","+        +-- seed.ts              -- Main seed runner"," "," 4.2 Middleware Pipeline (Request Flow)"," ","-    Request → Morgan Logger → Helmet (CSP, security headers)","-            → CORS (restricted origins) → Compression (gzip)","-            → JSON Parser (1MB limit) → Request ID (X-Request-ID)","-            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler","-            → Error Handler → Response","+    Request -> Morgan Logger -> Helmet (CSP, security headers)","+            -> CORS (restricted origins) -> Compression (gzip)","+            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)","+            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler","+            -> Error Handler -> Response"," "," 4.3 Rate Limiting (4 Tiers)"," "]},{"oldStart":333,"oldLines":7,"newStart":334,"newLines":7,"lines":["     - ErrorBoundary on frontend for component-level recovery"," "," 4.5 Health Check","-    GET /health → { status, firestore, uptime, memory, timestamp }","+    GET /health -> { status, firestore, uptime, memory, timestamp }","     States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy","     Memory: RSS, heap used, heap total"," "]},{"oldStart":341,"oldLines":40,"newStart":342,"newLines":49,"lines":[" 5. DATA MODELS (FIRESTORE)"," ================================================================================"," ","-5.1 Collection Map (17 Collections)","+5.1 Collection Map (17+ Collections)"," ","-    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","-    │   organisations │     │     users        │     │     teams       │","-    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │","-    └─────────────────┘     └─────────────────┘     └─────────────────┘","-                                    │","-                                    ▼","-    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","-    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │","-    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │","-    └────────┬────────┘     └─────────────────┘     └────────┬────────┘","-             │                                               │","-             ▼                                               ▼","-    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","-    │   repairs       │     │   complaints     │     │      asb        │","-    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │","-    └─────────────────┘     └─────────────────┘     └─────────────────┘","-                                                            │","-    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐","-    │   financial     │     │   damp-mould     │     │   activities    │","-    │   (docs)        │     │   (docs)         │     │   (docs)        │","-    └─────────────────┘     └─────────────────┘     └─────────────────┘","+    +------------------+     +------------------+     +------------------+","+    |   organisations  |     |      users       |     |      teams       |","+    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |","+    +------------------+     +------------------+     +------------------+","+                                    |","+                                    v","+    +------------------+     +------------------+     +------------------+","+    |   properties     |<--->|     tenants      |<--->|      cases       |","+    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |","+    +--------+---------+     +------------------+     +--------+---------+","+             |                                                 |","+             v                                                 v","+    +------------------+     +------------------+     +------------------+","+    |   repairs        |     |   complaints     |     |       asb        |","+    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |","+    +------------------+     +------------------+     +------------------+","+                                                              |","+    +------------------+     +------------------+     +-------v----------+","+    |   financial      |     |   damp-mould     |     |   activities     |","+    |   (docs)         |     |   (docs)         |     |   (docs)         |","+    +------------------+     +------------------+     +------------------+"," ","-    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐","-    │   tasks         │     │  integrations    │     │    auditLog     │","-    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │","-    └─────────────────┘     └─────────────────┘     └─────────────────┘","+    +------------------+     +------------------+     +------------------+","+    |   tasks          |     |  integrations    |     |    auditLog      |","+    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |","+    +------------------+     +------------------+     +------------------+"," ","-    ┌──────────────────────┐     ┌─────────────────┐","-    │  externalDataCache   │     │    imdData       │","-    │  (TTL-based cache)   │     │   (LSOA docs)    │","-    └──────────────────────┘     └─────────────────┘","+    +----------------------+     +------------------+","+    |  externalDataCache   |     |    imdData       |","+    |  (TTL-based cache)   |     |   (LSOA docs)    |","+    +----------------------+     +------------------+"," ","+    Geography Hierarchy:","+    +------------------+     +------------------+     +------------------+","+    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |","+    +------------------+     +------------------+     +--------+---------+","+                                                               |","+                                                      +--------v---------+","+                                                      |    blocks (8)    |","+                                                      +------------------+","+"," 5.2 Property Schema"," ","     {"]},{"oldStart":392,"oldLines":8,"newStart":402,"newLines":11,"lines":["       type: 'house' | 'flat' | 'maisonette' | 'bungalow'","       bedrooms: number","       floor?: number","+      floorArea?: number","       estateId: string","       blockId?: string","+      regionId: string","+      localAuthorityId: string","       buildYear: number","       heatingType: string","       wallType: string"]},{"oldStart":413,"oldLines":7,"newStart":426,"newLines":13,"lines":["         liftSafety?: { status, inspectionDate }","       }","       status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'","+      isVoid: boolean","+      voidSince?: string","+      currentTenancyId?: string","       tenantId?: string","+      weeklyRent: number","+      serviceCharge: number","+      dampRisk?: number             // 0-100 computed score","       createdAt: timestamp","       updatedAt: timestamp","     }"]},{"oldStart":428,"oldLines":17,"newStart":447,"newLines":23,"lines":["       dateOfBirth: string","       email: string","       phone: string","+      mobile?: string","       nino?: string                 // National Insurance Number","       propertyId: string","       tenancyId: string","       tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'","       tenancyStartDate: string","+      tenancyStatus: string","+      assignedOfficer: string","       rent: {","         weeklyAmount: number","         balance: number             // Negative = arrears","         paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'","         ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'","       }","+      weeklyCharge: number","+      rentBalance: number","+      arrearsRisk: number           // 0-100 score","       household: [","         { name, relationship, dateOfBirth, isDependent }","       ]"]},{"oldStart":449,"oldLines":6,"newStart":474,"newLines":8,"lines":["         relationship: string","       }","       communicationPreference: 'email' | 'sms' | 'letter' | 'portal'","+      lastContact?: string","+      contactCount30Days?: number","       createdAt: timestamp","       updatedAt: timestamp","     }"]},{"oldStart":466,"oldLines":14,"newStart":493,"newLines":17,"lines":["       priority: 'emergency' | 'urgent' | 'routine' | 'planned'","       propertyId: string","       tenantId: string","+      handler: string               // Assigned officer","       assignedTo: string            // User ID","       createdDate: string","       updatedDate: string","       closedDate?: string","+      daysOpen: number","       sla: {","         targetDate: string","         breached: boolean","       }","+      slaStatus: 'on-track' | 'at-risk' | 'breached'","       timeline: [","         { date, action, actor, notes }","       ]"]},{"oldStart":487,"oldLines":11,"newStart":517,"newLines":14,"lines":["       type: 'repair',","       sorCode: string               // HACT SOR code","       trade: string                 // plumbing, electrical, carpentry, etc.","+      operative?: string","       appointment: {","         date: string","         timeSlot: string","         confirmedBy: string","       }","+      appointmentDate?: string","+      completionDate?: string","       contractor: {","         name: string","         company: string"]},{"oldStart":503,"oldLines":6,"newStart":536,"newLines":7,"lines":["         actual?: number","         authorised: boolean","       }","+      firstTimeFix?: boolean","       photos: {","         before: string[]","         after: string[]"]},{"oldStart":512,"oldLines":6,"newStart":546,"newLines":13,"lines":["         feedback: string","         date: string","       }","+      awaabsLaw?: {                 // For damp/mould repairs","+        isHazard: boolean","+        hazardType: string","+        responseDeadline: string","+        repairDeadline: string","+        compliant: boolean","+      }","     }"," "," 5.6 Complaint Schema (extends Case)"]},{"oldStart":526,"oldLines":10,"newStart":567,"newLines":13,"lines":["         stage1Response: string          // 10 working days","         stage2Response?: string         // 20 working days","       }","+      findings?: string","+      compensation?: number","+      learningActions: string[]","       ombudsmanRef?: string","+      ombudsmanEscalation?: boolean","       escalatedDate?: string","       outcome?: string","-      learningActions: string[]","     }"," "," 5.7 ASB Schema (extends Case)"]},{"oldStart":538,"oldLines":18,"newStart":582,"newLines":50,"lines":["       ...Case,","       type: 'asb',","       severity: 'low' | 'medium' | 'high' | 'critical'","-      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'","+      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'","+      evidenceCount: number","       evidenceLog: [","         { date, type, description, attachments }","       ]","       perpetratorId?: string","       victimIds: string[]","       communityTrigger: boolean","+      multiAgencyPanel?: boolean","     }"," ","-5.8 ExternalDataCache Schema","+5.8 Financial Case Schema (extends Case)"," ","     {","+      ...Case,","+      type: 'financial',","+      arrearsAmount: number","+      arrearsReason: string","+      paymentArrangement?: {","+        amount: number","+        frequency: string","+        startDate: string","+      }","+      preActionChecklist?: {","+        item: string","+        completed: boolean","+        date?: string","+      }[]","+    }","+","+5.9 Damp-Mould Case Schema (extends Case)","+","+    {","+      ...Case,","+      type: 'damp-mould',","+      hazardClassification: string","+      dampRiskScore: number","+      cause: string","+      linkedRepairs: string[]       // repair case IDs","+    }","+","+5.10 ExternalDataCache Schema","+","+    {","       id: string                    // Cache key (e.g., \"police:SE17+1RY\")","       source: string                // API source identifier","       data: object                  // Cached response payload"]},{"oldStart":559,"oldLines":7,"newStart":635,"newLines":7,"lines":["       requestParams: object         // Original request parameters","     }"," ","-5.9 Integration Schema","+5.11 Integration Schema"," ","     {","       id: string"]},{"oldStart":582,"oldLines":18,"newStart":658,"newLines":23,"lines":["       }","     }"," ","-5.10 Firestore Indexes (Composite)","-    Defined in firestore.indexes.json at project root (16 indexes).","+5.12 Firestore Indexes (Composite)","+    Defined in firestore.indexes.json at project root (17 indexes).","     Key indexes for:","     - cases: (propertyId, type, createdDate DESC)","     - cases: (tenantId, type, createdDate DESC)","     - cases: (status, priority, createdDate DESC)","+    - cases: (type, status, createdDate DESC)","+    - cases: (type, handler, createdDate DESC)","+    - cases: (estateId, type, createdDate DESC)","     - activities: (entityId, timestamp DESC)","+    - tenants: (arrearsRisk DESC)","     - externalDataCache: (source, expiresAt)"," ","-5.11 Firestore Security Rules","+5.13 Firestore Security Rules","     Defined in firestore.rules at project root.","-    Persona-based access control for all 15 collections.","+    Persona-based access control for all 15+ collections.","+    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()","     Audit log is write-once, read-many (immutable)."," "," "]},{"oldStart":612,"oldLines":114,"newStart":693,"newLines":114,"lines":[" 6.2 API Route Registry (50+ endpoints)"," ","     AUTHENTICATION (3)","-    POST   /api/v1/auth/login          — Firebase token login","-    POST   /api/v1/auth/register       — User registration","-    POST   /api/v1/auth/logout         — Session invalidation","+    POST   /api/v1/auth/login          -- Firebase token login","+    POST   /api/v1/auth/register       -- User registration","+    POST   /api/v1/auth/logout         -- Session invalidation"," ","-    PROPERTIES (2)","-    GET    /api/v1/properties           — List with pagination/filter","-    GET    /api/v1/properties/:id       — Property detail","+    PROPERTIES (4)","+    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)","+    GET    /api/v1/properties/:id       -- Property detail","+    PATCH  /api/v1/properties/:id       -- Update property","+    GET    /api/v1/properties/available -- Available properties"," ","-    TENANTS (2)","-    GET    /api/v1/tenants              — List with pagination/filter","-    GET    /api/v1/tenants/:id          — Tenant detail","+    TENANTS (5)","+    GET    /api/v1/tenants              -- List with pagination/filter","+    GET    /api/v1/tenants/:id          -- Tenant detail","+    PATCH  /api/v1/tenants/:id          -- Update tenant","+    GET    /api/v1/tenants/:id/activities  -- Tenant activities","+    GET    /api/v1/tenants/:id/cases    -- Tenant cases"," ","     CASES (5)","-    GET    /api/v1/cases                — List with type/status filter","-    GET    /api/v1/cases/:id            — Case detail","-    POST   /api/v1/cases                — Create case","-    PUT    /api/v1/cases/:id            — Update case","-    DELETE /api/v1/cases/:id            — Close/archive case","+    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)","+    GET    /api/v1/cases/:id            -- Case detail","+    POST   /api/v1/cases                -- Create case","+    PATCH  /api/v1/cases/:id            -- Update case","+    GET    /api/v1/cases/:id/activities -- Case activities"," ","-    CONVENIENCE ALIASES","-    GET    /api/v1/repairs              — All repairs (type=='repair')","-    GET    /api/v1/complaints           — All complaints (type=='complaint')","-","     COMPLIANCE (2)","-    GET    /api/v1/compliance           — Big 6 summary dashboard","-    GET    /api/v1/compliance/:type     — Type-specific data","+    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard","+    GET    /api/v1/compliance/:type     -- Type-specific data"," ","-    EXPLORE (2+)","-    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy","-    GET    /api/v1/explore/estate/:id   — Estate detail with blocks","+    EXPLORE (4)","+    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy","+    GET    /api/v1/explore/regions      -- List regions","+    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks","+    GET    /api/v1/explore/blocks/:id   -- Block detail"," ","-    RENT (3)","-    GET    /api/v1/rent/arrears         — Arrears dashboard summary","-    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)","-    GET    /api/v1/rent/transactions    — Transaction list","+    RENT (2)","+    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary","+    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions"," ","-    REPAIRS (2)","-    GET    /api/v1/repairs              — Repair list","-    GET    /api/v1/repairs/:id          — Repair detail","-","     REPORTS (3)","-    GET    /api/v1/reports              — Report catalog (27 types)","-    GET    /api/v1/reports/:type        — Generate report data","-    GET    /api/v1/reports/tsm          — TSM specific data","+    GET    /api/v1/reports              -- Report catalog (27 types)","+    GET    /api/v1/reports/:type        -- Generate report data","+    GET    /api/v1/reports/tsm          -- TSM specific data"," ","     LETTINGS (2)","-    GET    /api/v1/lettings/voids       — Void property list","-    GET    /api/v1/lettings/register    — Housing register","+    GET    /api/v1/lettings/voids       -- Void property list","+    GET    /api/v1/lettings/register    -- Housing register"," ","     BOOKING (2)","-    POST   /api/v1/booking/viewing      — Book a viewing","-    POST   /api/v1/booking/application  — Submit application","+    POST   /api/v1/booking/viewing      -- Book a viewing","+    POST   /api/v1/booking/application  -- Submit application"," ","-    BRIEFING (2)","-    GET    /api/v1/briefing             — Personalised morning briefing","-    GET    /api/v1/briefing/:estateId   — Estate-specific briefing","+    BRIEFING (1)","+    GET    /api/v1/briefing             -- Personalised morning briefing"," ","     EXPORT (2)","-    GET    /api/v1/export/csv/:type     — CSV export","-    GET    /api/v1/export/pdf/:type     — PDF export","+    GET    /api/v1/export/csv/:type     -- CSV export","+    GET    /api/v1/export/pdf/:type     -- PDF export"," ","-    AI INTELLIGENCE (14)","-    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score","-    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview","-    GET    /api/v1/ai/crime-context/:estateId           — Crime context","-    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation","-    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score","-    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants","-    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement","-    GET    /api/v1/ai/property-passport/:propertyId      — Property passport","-    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing","-    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates","-    GET    /api/v1/ai/notify/templates/:category         — Templates by category","-    GET    /api/v1/ai/notify/template/:id                — Template detail","-    POST   /api/v1/ai/notify/render                      — Render template","-    POST   /api/v1/ai/chat                               — Yantra Assist chat","+    AI INTELLIGENCE (12)","+    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score","+    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview","+    GET    /api/v1/ai/crime-context/:estateId          -- Crime context","+    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation","+    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score","+    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants","+    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement","+    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport","+    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing","+    POST   /api/v1/ai/draft-communication               -- Draft communication","+    POST   /api/v1/ai/chat                              -- Yantra Assist chat"," ","+    GOV.UK NOTIFY (4)","+    GET    /api/v1/ai/notify/templates                  -- List all 24 templates","+    GET    /api/v1/ai/notify/templates/:category        -- Filter by category","+    GET    /api/v1/ai/notify/template/:id               -- Template detail","+    POST   /api/v1/ai/notify/render                     -- Render template","+","     MOCK TIER 3 (9)","-    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check","-    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data","-    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data","-    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data","-    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific","-    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission","-    POST   /api/v1/ai/mock/signing                       — DocuSign envelope","-    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check","-    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry","+    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check","+    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data","+    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data","+    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data","+    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific","+    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission","+    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope","+    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check","+    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry"," ","     EXTERNAL DATA PROXY (9)","-    GET    /api/v1/public-data/police/:postcode          — Police crime data","-    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast","-    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk","-    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup","-    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate","-    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021","-    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour","-    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify","-    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify","+    GET    /api/v1/public-data/police/:postcode          -- Police crime data","+    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast","+    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk","+    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup","+    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate","+    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021","+    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour","+    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify","+    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify"," ","     ADMIN (4)","-    GET    /api/v1/admin/integrations                    — List integrations","-    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable","-    POST   /api/v1/admin/integrations/:id/test           — Test connection","-    GET    /api/v1/admin/monitoring                       — Metrics dashboard","+    GET    /api/v1/admin/integrations                   -- List integrations","+    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable","+    POST   /api/v1/admin/integrations/:id/test          -- Test connection","+    GET    /api/v1/admin/monitoring                      -- Metrics dashboard"," ","     CONFIG & HEALTH","-    GET    /api/v1/config              — Firebase client config (public)","-    GET    /health                     — Health check","+    GET    /api/v1/config              -- Firebase client config (public)","+    GET    /health                     -- Health check"," "," "," 7. EXTERNAL API INTEGRATION ARCHITECTURE"]},{"oldStart":729,"oldLines":7,"newStart":810,"newLines":7,"lines":["     All external API calls are proxied through the Express server.","     Frontend NEVER calls external APIs directly."," ","-    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API","+    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API"," "," 7.2 Caching Strategy (Firestore-based)","     Collection: externalDataCache"]},{"oldStart":802,"oldLines":31,"newStart":883,"newLines":31,"lines":[" "," 9.1 Deployment Pipeline"," ","-    Developer → git push origin main","-                    │","-                    ▼","+    Developer -> git push origin main","+                    |","+                    v","     GitHub Repository (rajivpeter/SocialHomes_ai)","-                    │","-                    ▼","+                    |","+                    v","     Cloud Build (auto-triggered)","-     ├── Step 1: Build React frontend (Vite)","-     ├── Step 2: Build Express backend (tsc)","-     └── Step 3: Build & push Docker image","-                    │","-                    ▼","+     +-- Step 1: Build React frontend (Vite)","+     +-- Step 2: Build Express backend (tsc)","+     +-- Step 3: Build & push Docker image","+                    |","+                    v","     Artifact Registry (europe-west2)","-     └── cloud-run-source-deploy/socialhomes:latest","-                    │","-                    ▼","+     +-- cloud-run-source-deploy/socialhomes:latest","+                    |","+                    v","     Cloud Run (europe-west2)","-     ├── Min instances: 0","-     ├── Max instances: 10","-     ├── Memory: 1Gi","-     ├── CPU: 1","-     ├── Concurrency: 80","-     ├── Timeout: 300s","-     ├── Port: 8080","-     └── Secrets: 4 from Secret Manager","+     +-- Min instances: 0","+     +-- Max instances: 10","+     +-- Memory: 1Gi","+     +-- CPU: 1","+     +-- Concurrency: 80","+     +-- Timeout: 300s","+     +-- Port: 8080","+     +-- Secrets: 4 from Secret Manager"," "," 9.2 Docker Build (Multi-Stage)","     Stage 1: Build client (Vite) — node:20-slim base"]},{"oldStart":881,"oldLines":5,"newStart":962,"newLines":5,"lines":[" "," ================================================================================","   End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Yantra Works | 2026-02-23","+  Yantra Works | 2026-02-25"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    ┌─────────────────────────────────────────────────────────────────┐\n    │                        CLOUD RUN (europe-west2)                │\n    │  ┌───────────────────────────────────────────────────────────┐  │\n    │  │                    Express.js Server                      │  │\n    │  │  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │  │\n    │  │  │ Static Files │  │   API v1     │  │  Middleware    │  │  │\n    │  │  │ (React SPA)  │  │  /api/v1/*   │  │ Auth/RBAC/    │  │  │\n    │  │  │              │  │              │  │ Rate Limit/   │  │  │\n    │  │  │ Vite Build   │  │ 16 route     │  │ Metrics/CSP   │  │  │\n    │  │  │ Output       │  │ modules      │  │               │  │  │\n    │  │  └──────────────┘  └──────┬───────┘  └───────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    │                              │                                  │\n    │  ┌───────────────────────────┼───────────────────────────────┐  │\n    │  │                    Service Layer (25 modules)             │  │\n    │  │  ┌─────────┐ ┌──────────┐ ┌──────────┐ ┌─────────────┐  │  │\n    │  │  │ AI      │ │ External │ │ GOV.UK   │ │ Mock        │  │  │\n    │  │  │ Services│ │ API      │ │ Notify   │ │ Services    │  │  │\n    │  │  │ (7)     │ │ Proxy    │ │ (24 tmpl)│ │ (5 Tier 3)  │  │  │\n    │  │  └─────────┘ └──────────┘ └──────────┘ └─────────────┘  │  │\n    │  └───────────────────────────┼───────────────────────────────┘  │\n    └──────────────────────────────┼──────────────────────────────────┘\n                                   │\n              ┌────────────────────┼────────────────────┐\n              │                    │                     │\n    ┌─────────▼──────┐  ┌─────────▼──────┐  ┌──────────▼─────┐\n    │   Firestore    │  │  Firebase Auth │  │ Secret Manager │\n    │  (17 colls)    │  │  (Google SSO)  │  │  (4 secrets)   │\n    └────────────────┘  └────────────────┘  └────────────────┘\n              │\n    ┌─────────▼──────────────────────────────────────────┐\n    │              External APIs (3 Tiers)               │\n    │  Tier 1: Police.uk, Open-Meteo, DEFRA             │\n    │  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc. │\n    │  Tier 3: DWP, IoT, GoCardless, etc. (mocked)      │\n    └────────────────────────────────────────────────────┘\n\n1.3 Request Flow Diagram\n\n    Browser → React SPA → api-client.ts → HTTP Request\n                                              │\n                                              ▼\n    Express Server ← Middleware Pipeline ← Route Handler\n         │               │\n         │     ┌─────────┴──────────────────────────┐\n         │     │ Morgan → Helmet → CORS → Compression│\n         │     │ → JSON Parser (1MB) → X-Request-ID  │\n         │     │ → Rate Limiter → Metrics → Handler   │\n         │     │ → Error Handler → Response            │\n         │     └──────────────────────────────────────┘\n         │\n         ├─→ Firestore (read/write)\n         ├─→ External API Proxy (with cache)\n         └─→ AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | —          |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    ├── App.tsx                  — Router with 40+ routes\n    ├── main.tsx                 — React DOM entry point (QueryClient)\n    ├── index.css                — Global styles, animations, accessibility\n    │\n    ├── pages/                   — 19 page directories\n    │   ├── admin/               — AdminPage, IntegrationsPage\n    │   ├── ai-centre/           — AiCentrePage (Insights/Predictions/Differentiators)\n    │   ├── allocations/         — AllocationsPage\n    │   ├── asb/                 — AsbPage, AsbDetailPage\n    │   ├── auth/                — LoginPage (Firebase + Google)\n    │   ├── briefing/            — BriefingPage (morning briefing + neighbourhood)\n    │   ├── communications/      — CommunicationsPage\n    │   ├── complaints/          — ComplaintsPage, ComplaintDetailPage\n    │   ├── compliance/          — CompliancePage, ComplianceTypePage, AwaabsLawPage\n    │   ├── dashboard/           — DashboardPage (8 KPIs, charts, activity)\n    │   ├── explore/             — ExplorePage (7-level drill-down)\n    │   ├── properties/          — PropertiesPage, PropertyDetailPage,\n    │   │                          ApplicationPage, ViewingBookingPage\n    │   ├── rent/                — RentPage\n    │   ├── repairs/             — RepairsPage, RepairDetailPage\n    │   ├── reports/             — ReportsPage, DynamicReportPage, TsmReportPage\n    │   ├── search/              — SearchPage\n    │   ├── tenancies/           — TenanciesPage, TenancyDetailPage\n    │   ├── tenant-portal/       — TenantPortalPage\n    │   └── shared/              — ComingSoonPage\n    │\n    ├── components/\n    │   ├── layout/              — Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    │   └── shared/              — 12 reusable components (ActionModal, AiActionCard,\n    │                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    │                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    │                              PropertyMap, StatusPill, VulnerabilityPanel)\n    │\n    ├── data/                    — Mock/seed data (10 files)\n    ├── hooks/                   — Custom hooks (3 files)\n    │   ├── useApi.ts            — 23 React Query hooks wrapping API methods\n    │   ├── useEntityIntelligence.ts  — AI scoring hooks\n    │   └── usePersonaScope.ts   — Persona-based data filtering\n    ├── types/                   — TypeScript definitions (721 lines)\n    ├── services/                — API client (70+ methods), Firebase, AI drafting,\n    │                              public data helpers\n    ├── contexts/                — AuthContext, AppContext\n    ├── utils/                   — Formatting utilities (safeText, etc.)\n    └── assets/                  — Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                           → Redirect to /dashboard\n    /login                      → LoginPage (public)\n    /dashboard                  → DashboardPage\n    /explore                    → ExplorePage\n    /tenancies                  → TenanciesPage\n    /tenancies/:id              → TenancyDetailPage\n    /properties                 → PropertiesPage\n    /properties/:id             → PropertyDetailPage\n    /properties/:id/apply       → ApplicationPage\n    /properties/:id/book-viewing→ ViewingBookingPage\n    /repairs                    → RepairsPage\n    /repairs/:id                → RepairDetailPage\n    /compliance                 → CompliancePage\n    /compliance/:type           → ComplianceTypePage\n    /compliance/awaabs-law      → AwaabsLawPage\n    /complaints                 → ComplaintsPage\n    /complaints/:id             → ComplaintDetailPage\n    /asb                        → AsbPage\n    /asb/:id                    → AsbDetailPage\n    /rent                       → RentPage\n    /allocations                → AllocationsPage\n    /communications             → CommunicationsPage\n    /reports                    → ReportsPage\n    /reports/:type              → DynamicReportPage\n    /reports/tsm                → TsmReportPage\n    /ai-centre                  → AiCentrePage\n    /briefing                   → BriefingPage\n    /admin                      → AdminPage\n    /admin/integrations         → IntegrationsPage\n    /tenant-portal              → TenantPortalPage\n    /search                     → SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    ├── index.ts                 — Express entry, middleware, route registration\n    │\n    ├── middleware/               — 5 middleware modules\n    │   ├── auth.ts              — Firebase token verification + X-Persona fallback\n    │   ├── error-handler.ts     — Structured JSON error handler (no stack leaks)\n    │   ├── metrics.ts           — Request/response metrics recording\n    │   ├── rate-limiter.ts      — Sliding window rate limiter (4 tiers)\n    │   └── rbac.ts              — Role-based access control\n    │\n    ├── routes/                  — 16 route modules (2,300+ lines)\n    │   ├── admin.ts             — Integration management, monitoring\n    │   ├── ai.ts                — 14 AI endpoints + 4 GOV.UK Notify endpoints\n    │   ├── auth.ts              — Login, register, logout\n    │   ├── briefing.ts          — Personalised morning briefing\n    │   ├── booking.ts           — Viewing bookings, applications\n    │   ├── cases.ts             — Unified case CRUD + pagination\n    │   ├── compliance.ts        — Big 6 compliance data\n    │   ├── explore.ts           — Hierarchy drill-down data\n    │   ├── export.ts            — CSV/PDF exports\n    │   ├── lettings.ts          — Void management, allocations\n    │   ├── properties.ts        — Property list/detail\n    │   ├── public-data.ts       — External API proxy (Tier 1-2)\n    │   ├── rent.ts              — Arrears, statements, transactions\n    │   ├── reports.ts           — 27 regulatory reports\n    │   └── tenants.ts           — Tenant list/detail\n    │\n    ├── services/                — 25 service modules\n    │   ├── external-api.ts      — Cache-through, rate limiting, audit\n    │   ├── firestore.ts         — Firestore connection + helpers\n    │   ├── firebase-admin.ts    — Firebase Admin initialization\n    │   ├── damp-prediction.ts   — 5-factor damp risk algorithm\n    │   ├── crime-context.ts     — Police data correlation\n    │   ├── vulnerability-detection.ts  — 7-factor scoring\n    │   ├── benefits-engine.ts   — UK benefit rules engine\n    │   ├── property-passport.ts — Multi-source aggregation\n    │   ├── neighbourhood-briefing.ts   — Per-estate briefing\n    │   ├── govuk-notify.ts      — 24 notification templates (1,257 lines)\n    │   ├── census-nomis.ts      — Census + NOMIS + Gas/Electrical (493 lines)\n    │   ├── mock-services.ts     — 9 Tier 3 mock endpoints\n    │   ├── monitoring.ts        — Metrics singleton\n    │   ├── hact-export.ts       — HACT reporting format\n    │   ├── seed.ts              — Database seeding\n    │   ├── seed-data.ts         — Seed data definitions\n    │   └── hact-codes.ts        — SOR code definitions\n    │\n    ├── models/\n    │   ├── firestore-schemas.ts — Firestore collection schemas\n    │   └── hact-codes.ts        — Repair code models\n    │\n    └── scripts/\n        ├── seed-imd.ts          — IMD data loader\n        └── seed.ts              — Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request → Morgan Logger → Helmet (CSP, security headers)\n            → CORS (restricted origins) → Compression (gzip)\n            → JSON Parser (1MB limit) → Request ID (X-Request-ID)\n            → Rate Limiter (4 tiers) → Metrics Recorder → Route Handler\n            → Error Handler → Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health → { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17 Collections)\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   organisations │     │     users        │     │     teams       │\n    │   (1 doc)       │────▶│   (10+ docs)     │────▶│   (5+ docs)    │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                    │\n                                    ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   properties    │◀───▶│    tenants       │◀───▶│     cases       │\n    │   (75 docs)     │     │   (68 docs)      │     │  (279+ docs)    │\n    └────────┬────────┘     └─────────────────┘     └────────┬────────┘\n             │                                               │\n             ▼                                               ▼\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   repairs       │     │   complaints     │     │      asb        │\n    │  (200 docs)     │     │   (34 docs)      │     │   (12 docs)     │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n                                                            │\n    ┌─────────────────┐     ┌─────────────────┐     ┌──────▼──────────┐\n    │   financial     │     │   damp-mould     │     │   activities    │\n    │   (docs)        │     │   (docs)         │     │   (docs)        │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐\n    │   tasks         │     │  integrations    │     │    auditLog     │\n    │   (docs)        │     │   (20 docs)      │     │  (write-once)   │\n    └─────────────────┘     └─────────────────┘     └─────────────────┘\n\n    ┌──────────────────────┐     ┌─────────────────┐\n    │  externalDataCache   │     │    imdData       │\n    │  (TTL-based cache)   │     │   (LSOA docs)    │\n    └──────────────────────┘     └─────────────────┘\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      estateId: string\n      blockId?: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      tenantId?: string\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      ombudsmanRef?: string\n      escalatedDate?: string\n      outcome?: string\n      learningActions: string[]\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationLevel: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n    }\n\n5.8 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.9 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.10 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (16 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.11 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15 collections.\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          — Firebase token login\n    POST   /api/v1/auth/register       — User registration\n    POST   /api/v1/auth/logout         — Session invalidation\n\n    PROPERTIES (2)\n    GET    /api/v1/properties           — List with pagination/filter\n    GET    /api/v1/properties/:id       — Property detail\n\n    TENANTS (2)\n    GET    /api/v1/tenants              — List with pagination/filter\n    GET    /api/v1/tenants/:id          — Tenant detail\n\n    CASES (5)\n    GET    /api/v1/cases                — List with type/status filter\n    GET    /api/v1/cases/:id            — Case detail\n    POST   /api/v1/cases                — Create case\n    PUT    /api/v1/cases/:id            — Update case\n    DELETE /api/v1/cases/:id            — Close/archive case\n\n    CONVENIENCE ALIASES\n    GET    /api/v1/repairs              — All repairs (type=='repair')\n    GET    /api/v1/complaints           — All complaints (type=='complaint')\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance           — Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     — Type-specific data\n\n    EXPLORE (2+)\n    GET    /api/v1/explore/hierarchy    — Full drill-down hierarchy\n    GET    /api/v1/explore/estate/:id   — Estate detail with blocks\n\n    RENT (3)\n    GET    /api/v1/rent/arrears         — Arrears dashboard summary\n    GET    /api/v1/rent/statements/:id  — Tenant statement (52 weeks)\n    GET    /api/v1/rent/transactions    — Transaction list\n\n    REPAIRS (2)\n    GET    /api/v1/repairs              — Repair list\n    GET    /api/v1/repairs/:id          — Repair detail\n\n    REPORTS (3)\n    GET    /api/v1/reports              — Report catalog (27 types)\n    GET    /api/v1/reports/:type        — Generate report data\n    GET    /api/v1/reports/tsm          — TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       — Void property list\n    GET    /api/v1/lettings/register    — Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      — Book a viewing\n    POST   /api/v1/booking/application  — Submit application\n\n    BRIEFING (2)\n    GET    /api/v1/briefing             — Personalised morning briefing\n    GET    /api/v1/briefing/:estateId   — Estate-specific briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     — CSV export\n    GET    /api/v1/export/pdf/:type     — PDF export\n\n    AI INTELLIGENCE (14)\n    GET    /api/v1/ai/damp-risk/:propertyId            — Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       — Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId           — Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId        — Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId            — Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                 — Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId           — Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId      — Property passport\n    GET    /api/v1/ai/briefing/:estateId                 — Neighbourhood briefing\n    GET    /api/v1/ai/notify/templates                   — List GOV.UK templates\n    GET    /api/v1/ai/notify/templates/:category         — Templates by category\n    GET    /api/v1/ai/notify/template/:id                — Template detail\n    POST   /api/v1/ai/notify/render                      — Render template\n    POST   /api/v1/ai/chat                               — Yantra Assist chat\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId     — DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId       — IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId        — GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode       — NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId   — Plentific\n    POST   /api/v1/ai/mock/regulatory                    — RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                       — DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId      — Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId     — Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          — Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng          — Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode       — Flood risk\n    GET    /api/v1/public-data/postcode/:postcode         — Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                  — EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode            — Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode             — NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber         — Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo    — Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                    — List integrations\n    POST   /api/v1/admin/integrations/:id/toggle         — Enable/disable\n    POST   /api/v1/admin/integrations/:id/test           — Test connection\n    GET    /api/v1/admin/monitoring                       — Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              — Firebase client config (public)\n    GET    /health                     — Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend → api-client.ts → /api/v1/public-data/* → external-api.ts → External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer → git push origin main\n                    │\n                    ▼\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    │\n                    ▼\n    Cloud Build (auto-triggered)\n     ├── Step 1: Build React frontend (Vite)\n     ├── Step 2: Build Express backend (tsc)\n     └── Step 3: Build & push Docker image\n                    │\n                    ▼\n    Artifact Registry (europe-west2)\n     └── cloud-run-source-deploy/socialhomes:latest\n                    │\n                    ▼\n    Cloud Run (europe-west2)\n     ├── Min instances: 0\n     ├── Max instances: 10\n     ├── Memory: 1Gi\n     ├── CPU: 1\n     ├── Concurrency: 80\n     ├── Timeout: 300s\n     ├── Port: 8080\n     └── Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-23\n================================================================================\n"},"sourceToolAssistantUUID":"309e48d1-170e-46a4-8c4d-6403c601cba0"}
{"parentUuid":"30b23012-856a-4d70-a152-78993edc669a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01GA97wGPUKLivQwKZs8dtke","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012Hj7MWC73aw5QhyNcbwRVS","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"in_progress","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11369,"cache_read_input_tokens":95850,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11369},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2X9PAp3QJsDB9zwEFD","type":"assistant","uuid":"c45a54cf-5c1d-4f4f-a7e1-fd7b28ed03be","timestamp":"2026-02-25T15:30:52.355Z"}
{"parentUuid":"c45a54cf-5c1d-4f4f-a7e1-fd7b28ed03be","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012Hj7MWC73aw5QhyNcbwRVS","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"157be42a-aa8a-408b-8913-4ee345840c2c","timestamp":"2026-02-25T15:30:52.359Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"in_progress","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"c45a54cf-5c1d-4f4f-a7e1-fd7b28ed03be"}
{"parentUuid":"157be42a-aa8a-408b-8913-4ee345840c2c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_011Cf1FVd3wToVahPdDhnZrx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FHBYJMSKPngQ5Morry4i8M","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":107219,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2XgQyQh37iZWC6dMWo","type":"assistant","uuid":"4e250cc4-7a09-4e1e-8c11-4c73fd68a585","timestamp":"2026-02-25T15:33:17.807Z"}
{"parentUuid":"4e250cc4-7a09-4e1e-8c11-4c73fd68a585","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FHBYJMSKPngQ5Morry4i8M","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt has been updated successfully."}]},"uuid":"b4225311-81ae-456d-ae00-97fb6cb9f4bf","timestamp":"2026-02-25T15:33:17.902Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc3 — SocialHomes.Ai API & Integration Requirements","-  Version: 3.0  |  Date: 2026-02-23","+  Version: 5.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":161,"oldLines":7,"newStart":161,"newLines":7,"lines":["     Fallback: Generated EPC data matching property attributes"," ","     Data Returned:","-    - Current energy rating (A–G) and score","+    - Current energy rating (A-G) and score","     - Potential rating","     - Environmental impact rating","     - Floor area, wall/roof type"]},{"oldStart":191,"oldLines":7,"newStart":191,"newLines":7,"lines":[" ","     Data Returned:","     - Population count and density","-    - Age distribution (0–15, 16–64, 65+)","+    - Age distribution (0-15, 16-64, 65+)","     - Household composition","     - Accommodation type breakdown","     - Ethnicity distribution"]},{"oldStart":361,"oldLines":7,"newStart":361,"newLines":7,"lines":["     Server Route: GET /api/v1/ai/mock/referencing/:applicantId"," ","     Mock Response:","-    - Credit score (300–850)","+    - Credit score (300-850)","     - Affordability assessment (pass/refer/fail)","     - CCJ count and value","     - Previous addresses (last 3 years)"]},{"oldStart":422,"oldLines":20,"newStart":422,"newLines":20,"lines":["     Service: server/src/services/damp-prediction.ts","     API Route: GET /api/v1/ai/damp-risk/:propertyId"," ","-    Algorithm: 5-Factor Weighted Score (0–100)","-    ┌─────────────────────┬────────┬────────────────────────────────┐","-    │ Factor              │ Weight │ Data Sources                   │","-    ├─────────────────────┼────────┼────────────────────────────────┤","-    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │","-    │ Building attributes │  0.25  │ Property data (age, type, EPC) │","-    │ Repair history      │  0.20  │ Case data (damp/mould reports) │","-    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │","-    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │","-    └─────────────────────┴────────┴────────────────────────────────┘","+    Algorithm: 5-Factor Weighted Score (0-100)","+    +---------------------+--------+--------------------------------+","+    | Factor              | Weight | Data Sources                   |","+    +---------------------+--------+--------------------------------+","+    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |","+    | Building attributes |  0.25  | Property data (age, type, EPC) |","+    | Repair history      |  0.20  | Case data (damp/mould reports) |","+    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |","+    | Occupancy patterns  |  0.10  | Tenant data (household size)   |","+    +---------------------+--------+--------------------------------+"," ","     Output:","-    - Overall risk score (0–100)","-    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)","+    - Overall risk score (0-100)","+    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)","     - Factor breakdown with individual scores","     - Proactive recommendations","     - Awaab's Law compliance status"]},{"oldStart":462,"oldLines":21,"newStart":462,"newLines":21,"lines":["     Service: server/src/services/vulnerability-detection.ts","     API Route: GET /api/v1/ai/vulnerability/:tenantId"," ","-    Algorithm: 7-Factor Weighted Score (0–100)","-    ┌──────────────────────────┬────────┬──────────────────────────┐","-    │ Factor                   │ Weight │ Data Sources             │","-    ├──────────────────────────┼────────┼──────────────────────────┤","-    │ IMD deprivation          │  0.20  │ IMD data (decile)        │","-    │ Arrears history          │  0.20  │ Rent account (balance)   │","-    │ Health flags             │  0.15  │ Tenant vulnerability     │","-    │ Social isolation         │  0.15  │ Household composition    │","-    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │","-    │ Dependents               │  0.10  │ Household members        │","-    │ UC transition            │  0.10  │ UC status                │","-    └──────────────────────────┴────────┴──────────────────────────┘","+    Algorithm: 7-Factor Weighted Score (0-100)","+    +--------------------------+--------+--------------------------+","+    | Factor                   | Weight | Data Sources             |","+    +--------------------------+--------+--------------------------+","+    | IMD deprivation          |  0.20  | IMD data (decile)        |","+    | Arrears history          |  0.20  | Rent account (balance)   |","+    | Health flags             |  0.15  | Tenant vulnerability     |","+    | Social isolation         |  0.15  | Household composition    |","+    | Age risk (elderly/young) |  0.10  | Tenant DOB              |","+    | Dependents               |  0.10  | Household members        |","+    | UC transition            |  0.10  | UC status                |","+    +--------------------------+--------+--------------------------+"," ","     Output:","-    - Vulnerability score (0–100)","+    - Vulnerability score (0-100)","     - Risk level: low / moderate / high / critical","     - Detected flags (e.g., elderly, mental-health, financial-hardship)","     - Recommended support actions"]},{"oldStart":574,"oldLines":8,"newStart":574,"newLines":8,"lines":[" 6.2 Template Categories (7)"," ","     CATEGORY 1: Rent Arrears (4 templates)","-    - arrears-mild: Friendly reminder (1–2 weeks behind)","-    - arrears-moderate: Formal notice (3–4 weeks)","+    - arrears-mild: Friendly reminder (1-2 weeks behind)","+    - arrears-moderate: Formal notice (3-4 weeks)","     - arrears-severe: Pre-action warning (5+ weeks)","     - arrears-arrangement: Payment plan confirmation"," "]},{"oldStart":618,"oldLines":10,"newStart":618,"newLines":10,"lines":["       ((amount)), ((date)), ((officer_name)), etc."," "," 6.4 API Endpoints","-    GET  /api/v1/ai/notify/templates           — List all 24 templates","-    GET  /api/v1/ai/notify/templates/:category  — Filter by category","-    GET  /api/v1/ai/notify/template/:id         — Single template detail","-    POST /api/v1/ai/notify/render               — Render with personalisation","+    GET  /api/v1/ai/notify/templates           -- List all 24 templates","+    GET  /api/v1/ai/notify/templates/:category  -- Filter by category","+    GET  /api/v1/ai/notify/template/:id         -- Single template detail","+    POST /api/v1/ai/notify/render               -- Render with personalisation"," "," "," 7. CACHING ARCHITECTURE"]},{"oldStart":633,"oldLines":8,"newStart":633,"newLines":8,"lines":[" "," 7.2 Cache-Through Pattern","     1. Check Firestore cache for key","-    2. If found AND not expired → return cached data","-    3. If missing OR expired → fetch from external API","+    2. If found AND not expired -> return cached data","+    3. If missing OR expired -> fetch from external API","     4. Store result in cache with TTL","     5. Return data to caller"," "]},{"oldStart":771,"oldLines":5,"newStart":771,"newLines":5,"lines":[" "," ================================================================================","   End of Doc3 — SocialHomes.Ai API & Integration Requirements","-  Yantra Works | 2026-02-23","+  Yantra Works | 2026-02-25"," ================================================================================"]}],"originalFile":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 3.0  |  Date: 2026-02-23\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A–G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0–15, 16–64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300–850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0–100)\n    ┌─────────────────────┬────────┬────────────────────────────────┐\n    │ Factor              │ Weight │ Data Sources                   │\n    ├─────────────────────┼────────┼────────────────────────────────┤\n    │ Weather conditions  │  0.25  │ Open-Meteo (humidity, rain)    │\n    │ Building attributes │  0.25  │ Property data (age, type, EPC) │\n    │ Repair history      │  0.20  │ Case data (damp/mould reports) │\n    │ IoT sensors         │  0.20  │ Switchee/Aico (temp, humidity) │\n    │ Occupancy patterns  │  0.10  │ Tenant data (household size)   │\n    └─────────────────────┴────────┴────────────────────────────────┘\n\n    Output:\n    - Overall risk score (0–100)\n    - Risk level: low (0–25), moderate (26–50), high (51–75), critical (76–100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0–100)\n    ┌──────────────────────────┬────────┬──────────────────────────┐\n    │ Factor                   │ Weight │ Data Sources             │\n    ├──────────────────────────┼────────┼──────────────────────────┤\n    │ IMD deprivation          │  0.20  │ IMD data (decile)        │\n    │ Arrears history          │  0.20  │ Rent account (balance)   │\n    │ Health flags             │  0.15  │ Tenant vulnerability     │\n    │ Social isolation         │  0.15  │ Household composition    │\n    │ Age risk (elderly/young) │  0.10  │ Tenant DOB              │\n    │ Dependents               │  0.10  │ Household members        │\n    │ UC transition            │  0.10  │ UC status                │\n    └──────────────────────────┴────────┴──────────────────────────┘\n\n    Output:\n    - Vulnerability score (0–100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1–2 weeks behind)\n    - arrears-moderate: Formal notice (3–4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           — List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  — Filter by category\n    GET  /api/v1/ai/notify/template/:id         — Single template detail\n    POST /api/v1/ai/notify/render               — Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired → return cached data\n    3. If missing OR expired → fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-23\n================================================================================\n"},"sourceToolAssistantUUID":"4e250cc4-7a09-4e1e-8c11-4c73fd68a585"}
{"parentUuid":"b4225311-81ae-456d-ae00-97fb6cb9f4bf","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01AEZXkrSbsp2AgK7Zv8Y2Hh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UohWtmHbKMAoRxw5hN7dLW","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8141,"cache_read_input_tokens":107585,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8141},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2iN8gqLcLDhd2bzep4","type":"assistant","uuid":"c417d066-c76f-4bbb-877c-7c300b33ca1e","timestamp":"2026-02-25T15:33:24.333Z"}
{"parentUuid":"c417d066-c76f-4bbb-877c-7c300b33ca1e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UohWtmHbKMAoRxw5hN7dLW","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"7a69702b-e2cf-46b9-bc2c-aa6c8a82ad62","timestamp":"2026-02-25T15:33:24.337Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"in_progress","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing project codebase and documentation","status":"completed","activeForm":"Analyzing existing project codebase and documentation"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v5.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v5.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v5.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v5.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v5.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v5.0"},{"content":"Update EXECUTION-PLAN.md with comprehensive Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with detailed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"c417d066-c76f-4bbb-877c-7c300b33ca1e"}
{"parentUuid":"7a69702b-e2cf-46b9-bc2c-aa6c8a82ad62","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01X4p7fAsM5DVsT2Empc3roj","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me write the comprehensive EXECUTION-PLAN.md with expanded Phase 5 tasks:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":115726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2itpQAyzzJaUHKqJMK","type":"assistant","uuid":"d4a5026a-c025-4125-aee0-dcf44e337300","timestamp":"2026-02-25T15:33:27.804Z"}
{"parentUuid":"d4a5026a-c025-4125-aee0-dcf44e337300","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","message":{"model":"claude-opus-4-6","id":"msg_01X4p7fAsM5DVsT2Empc3roj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AHgjxPLahPmzkhdWsdEAWa","name":"Write","input":{"file_path":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 20 | 0 | 8 | 12 | 0 |\n| **Frontend** | 10 | 0 | 2 | 7 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **44** (DONE: 2, TODO: 42) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n11. 5.3.2 (Notification bell — depends on WebSocket backend)\n12. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n13. 5.3.3–5.3.10 (Remaining frontend features — parallel)\n14. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n15. 5.4.6 (CI test pipeline — enables automated testing)\n16. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)\n18. 5.4.8 (Security testing)\n19. 5.5.4 (Cloud Monitoring alerts)\n20. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n22. 5.5.8, 5.5.9 (Runbook, log monitoring)\n23. 5.1.7 (API documentation — after all endpoints stable)\n24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n25. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)\n    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)\n    → 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)\n    → 5.3.2 (notification bell) → 5.3.9 (real-time status)\n    → 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)\n    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)\n    → 5.5.5 (backups) → 5.5.7 (custom domain)\n```\n\n---\n\n**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":366,"cache_read_input_tokens":115726,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":366},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYV2itpQAyzzJaUHKqJMK","type":"assistant","uuid":"5ba9cdf6-5e34-4558-b22a-b28820caac2c","timestamp":"2026-02-25T15:36:27.264Z"}
{"parentUuid":"5ba9cdf6-5e34-4558-b22a-b28820caac2c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AHgjxPLahPmzkhdWsdEAWa","type":"tool_result","content":"The file /mnt/c/.REDACTED.md has been updated successfully."}]},"uuid":"ed9de28d-a0a6-462e-b36f-d680b72a5934","timestamp":"2026-02-25T15:36:27.332Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 20 | 0 | 8 | 12 | 0 |\n| **Frontend** | 10 | 0 | 2 | 7 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **44** (DONE: 2, TODO: 42) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n11. 5.3.2 (Notification bell — depends on WebSocket backend)\n12. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n13. 5.3.3–5.3.10 (Remaining frontend features — parallel)\n14. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n15. 5.4.6 (CI test pipeline — enables automated testing)\n16. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)\n18. 5.4.8 (Security testing)\n19. 5.5.4 (Cloud Monitoring alerts)\n20. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n22. 5.5.8, 5.5.9 (Runbook, log monitoring)\n23. 5.1.7 (API documentation — after all endpoints stable)\n24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n25. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)\n    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)\n    → 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)\n    → 5.3.2 (notification bell) → 5.3.9 (real-time status)\n    → 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)\n    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)\n    → 5.5.5 (backups) → 5.5.7 (custom domain)\n```\n\n---\n\n**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n","structuredPatch":[{"oldStart":1,"oldLines":7,"newStart":1,"newLines":7,"lines":[" # SocialHomes.Ai — Master Execution Plan"," "," > Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.","-> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent","+> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent"," > Studio: Yantra Works"," "," ---"]},{"oldStart":15,"oldLines":7,"newStart":15,"newLines":7,"lines":[" | 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |"," | 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |"," | 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |","-| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |","+| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |"," "," ---"," "]},{"oldStart":129,"oldLines":9,"newStart":129,"newLines":9,"lines":[" "," ---"," ","-## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)","+## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)"," ","-### Goal: Real AI, real-time features, advanced testing, production scaling","+### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness"," "," Phase 5 is organized into 5 sub-phases matching the required agent structure:"," Project Setup & Architecture, Backend Development, Frontend Development,"]},{"oldStart":143,"oldLines":78,"newStart":143,"newLines":84,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |","-| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |","-| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |","-| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |","-| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |","-| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |","-| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |","-| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |","+| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |","+| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |","+| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |","+| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |","+| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |","+| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |","+| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |","+| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |","+| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |"," "," ---"," ","-### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)","+### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |","-| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |","-| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |","-| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |","-| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |","-| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |","-| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |","-| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |","-| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |","-| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |","-| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |","-| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |","+| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |","+| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |","+| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |","+| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |","+| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |","+| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |","+| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |","+| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |","+| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |","+| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |","+| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |","+| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |","+| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |","+| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |"," "," ---"," ","-### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)","+### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |","-| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |","-| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |","-| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |","-| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |","-| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |","-| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |","-| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |","-| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |","+| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |","+| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |","+| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |","+| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |","+| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |","+| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |","+| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |","+| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |","+| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |","+| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |"," "," ---"," ","-### PHASE 5.4: TESTING & QA (Sprint 11)","+### PHASE 5.4: TESTING & QA (Sprints 12-13)"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |","-| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |","-| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |","-| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |","-| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |","-| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |","-| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |","+| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |","+| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |","+| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |","+| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |","+| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |","+| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |","+| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |","+| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |"," "," ---"," ","-### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)","+### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)"," "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |","-| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |","-| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |","-| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |","-| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |","-| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |","-| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |","-| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |","+| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |","+| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |","+| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |","+| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |","+| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |","+| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |","+| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |","+| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |","+| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |"," "," ---"," "]},{"oldStart":234,"oldLines":9,"newStart":240,"newLines":9,"lines":[" "," | Document | Location | Purpose |"," |----------|----------|---------|","-| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |","-| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |","-| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |","+| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |","+| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |","+| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |"," | Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |"," | Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |"," | Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |"]},{"oldStart":282,"oldLines":6,"newStart":288,"newLines":7,"lines":[" | Metric | Target |"," |--------|--------|"," | AI response latency (Vertex AI) | < 3s for conversational queries |","+| AI response latency (streaming first token) | < 500ms |"," | WebSocket connection stability | > 99.9% uptime |"," | Load test (100 concurrent users) | P95 < 1s, 0 errors |"," | Selenium test coverage | > 95% of routes |"]},{"oldStart":289,"oldLines":6,"newStart":296,"newLines":7,"lines":[" | Staging deployment frequency | Every PR |"," | Database backup frequency | Daily automated |"," | Lighthouse accessibility score | > 90 on all pages |","+| Lighthouse performance score | > 80 on all pages |"," "," ---"," "]},{"oldStart":311,"oldLines":11,"newStart":319,"newLines":11,"lines":[" | Agent | Total Tasks | P0 | P1 | P2 | P3 |"," |-------|-------------|----|----|----|----|"," | **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |","-| **Fullstack** | 17 | 0 | 6 | 11 | 0 |","-| **Frontend** | 9 | 0 | 2 | 6 | 1 |","-| **Tester** | 7 | 0 | 3 | 4 | 0 |","-| **DevOps** | 8 | 0 | 3 | 5 | 0 |","-| **TOTAL** | **38** (DONE: 2, TODO: 36) |","+| **Fullstack** | 20 | 0 | 8 | 12 | 0 |","+| **Frontend** | 10 | 0 | 2 | 7 | 1 |","+| **Tester** | 8 | 0 | 4 | 4 | 0 |","+| **DevOps** | 9 | 0 | 3 | 6 | 0 |","+| **TOTAL** | **44** (DONE: 2, TODO: 42) |"," "," ### Recommended Execution Order (Critical Path)"," "]},{"oldStart":323,"oldLines":24,"newStart":331,"newLines":63,"lines":[" 1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)"," 2. 5.1.4 → 5.2.3 (WebSocket design → implementation)"," 3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)","+4. 5.1.8 (Firestore migration strategy — enables schema evolution)"," ","-**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**","-4. 5.2.4 (Notification dispatch — depends on WebSocket)","-5. 5.2.11 (AI communication drafting — depends on Vertex AI)","-6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)","-7. 5.3.2 (Notification bell — depends on WebSocket backend)","+**Sprint 10 (Weeks 19-20): Backend Features**","+5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)","+6. 5.2.11 (AI communication drafting — depends on Vertex AI)","+7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)"," 8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)"," ","-**Sprint 11 (Weeks 21-22): Frontend + Testing**","-9. 5.3.3–5.3.9 (Remaining frontend features — parallel)","-10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)","-11. 5.5.2 (Staging environment — enables test pipeline)","+**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**","+9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)","+10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)","+11. 5.3.2 (Notification bell — depends on WebSocket backend)","+12. 5.5.2 (Staging environment — enables test pipeline)"," ","-**Sprint 12 (Weeks 23-24): DevOps + Polish**","-12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)","-13. 5.1.7 (API documentation — after all endpoints stable)","-14. Final regression testing and production deploy","+**Sprint 12 (Weeks 23-24): Frontend + Testing Start**","+13. 5.3.3–5.3.10 (Remaining frontend features — parallel)","+14. 5.4.1 (Selenium regression suite — can begin once features stabilise)","+15. 5.4.6 (CI test pipeline — enables automated testing)","+16. 5.4.7 (Test data factory — enables isolated testing)"," ","+**Sprint 13 (Weeks 25-26): Testing + QA**","+17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)","+18. 5.4.8 (Security testing)","+19. 5.5.4 (Cloud Monitoring alerts)","+20. 5.5.5 (Database backup strategy)","+","+**Sprint 14 (Weeks 27-28): DevOps + Polish**","+21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)","+22. 5.5.8, 5.5.9 (Runbook, log monitoring)","+23. 5.1.7 (API documentation — after all endpoints stable)","+24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)","+25. Final regression testing and production deploy","+"," ---"," ","-**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**","+## DEPENDENCY GRAPH (Key Chains)","+","+```","+Vertex AI Chain:","+  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)","+    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)","+    → 5.2.14 (AI repair intake)","+","+WebSocket Chain:","+  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)","+    → 5.3.2 (notification bell) → 5.3.9 (real-time status)","+    → 5.2.8 (Firestore listeners)","+","+Testing Chain:","+  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)","+    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)","+","+DevOps Chain:","+  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)","+    → 5.5.5 (backups) → 5.5.7 (custom domain)","+```","+","+---","+","+**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**"]}],"originalFile":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 3.0 | 2026-02-23 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–12** | **🔵 TODO** | **0/38** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-12, Weeks 17-24) — 🔵 TODO (0/38)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v3.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v3.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions, reconnection strategy, message format | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics, subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-10)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses, context window management, conversation history | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, etc.), few-shot examples, safety guardrails | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake, room management (per-user, per-estate, per-org), heartbeat | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS, in-app WebSocket push, notification queue, delivery tracking, retry logic | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), fallback activation | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), background job runner | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before expiry), daily briefing refresh, weekly report generation | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions, change detection, WebSocket broadcast to connected clients | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates, bulk communication send (all tenants in estate), batch compliance certificate upload | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, pagination, CSV export, GDPR SAR aggregation | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based drafts with LLM-generated personalised emails, tone selection, legal compliance check | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history, payment behaviour, engagement score for vulnerability detection | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 10-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display, message history, context indicator, typing animation, copy/share responses | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown, unread count badge, mark-as-read, notification categories, click-to-navigate | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app), frequency settings (immediate/daily digest/weekly), category subscriptions | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive charts — clickable chart elements drill into filtered views, Recharts event handlers, breadcrumb-aware navigation from chart to list | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection, condition builder, action configuration, flow preview | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind theme variables, CSS custom properties swap, preference persistence, smooth transition animation | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive image loading and lazy loading — Suspense boundaries on heavy pages, skeleton screens, intersection observer for below-fold content | P2 | S | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar on tablet, stacked KPIs on mobile, touch-friendly map controls, responsive tables | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven status pills that update live, optimistic UI updates, conflict resolution for concurrent edits | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprint 11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations, navigation flows, error states | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts, crime-context.ts, vulnerability-detection.ts, benefits-engine.ts, property-passport.ts, neighbourhood-briefing.ts, govuk-notify.ts | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers, test cache-through pattern, verify fallback behaviour, test rate limiting | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery/k6 scripts for 100 concurrent users, measure P95 latency, identify bottlenecks, test Cloud Run auto-scaling | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe/Lighthouse automated scan on all 40+ pages, fix violations, achieve >90 Lighthouse a11y score | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions or Cloud Build step running unit + integration tests on every PR, fail-on-error, test report generation | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — generate realistic test fixtures for all entity types, parameterised builders, consistent seed data for test isolation | P2 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprint 12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) and multi-stage build steps | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets, deploy-on-PR workflow | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger, min/max instance tuning | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore quota warning, PagerDuty/email integration | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily), retention policy (30 days), point-in-time recovery testing | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN, cache-control headers, invalidation on deploy | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate, HTTP→HTTPS redirect | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures, rollback process, database recovery, secret rotation, scaling playbook, on-call guide | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v3.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v3.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v3.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 17 | 0 | 6 | 11 | 0 |\n| **Frontend** | 9 | 0 | 2 | 6 | 1 |\n| **Tester** | 7 | 0 | 3 | 4 | 0 |\n| **DevOps** | 8 | 0 | 3 | 5 | 0 |\n| **TOTAL** | **38** (DONE: 2, TODO: 36) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n\n**Sprint 10 (Weeks 19-20): Backend Features + Frontend Start**\n4. 5.2.4 (Notification dispatch — depends on WebSocket)\n5. 5.2.11 (AI communication drafting — depends on Vertex AI)\n6. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n7. 5.3.2 (Notification bell — depends on WebSocket backend)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Frontend + Testing**\n9. 5.3.3–5.3.9 (Remaining frontend features — parallel)\n10. 5.4.1–5.4.7 (Testing suite — parallel with frontend)\n11. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): DevOps + Polish**\n12. 5.5.3–5.5.8 (Infrastructure hardening — parallel)\n13. 5.1.7 (API documentation — after all endpoints stable)\n14. Final regression testing and production deploy\n\n---\n\n**Plan Version 3.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-23**\n"},"sourceToolAssistantUUID":"5ba9cdf6-5e34-4558-b22a-b28820caac2c"}
{"parentUuid":"ed9de28d-a0a6-462e-b36f-d680b72a5934","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"e4d2a73b-3d53-4b3b-bc97-1e8a3fa219a6","version":"2.1.56","gitBranch":"main","slug":"snoopy-seeking-petal","type":"assistant","uuid":"9ee56fbf-b643-4836-8e02-38ba8a56e3e3","timestamp":"2026-02-25T15:36:27.706Z","message":{"id":"d8b673c2-c824-498d-b0a6-7ba2544ee809","container":null,"model":"<synthetic>","role":"assistant","stop_reason":"stop_sequence","stop_sequence":"","type":"message","usage":{"input_tokens":0,"output_tokens":0,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":null,"cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":0},"inference_geo":null,"iterations":null,"speed":null},"content":[{"type":"text","text":"You've hit your limit · resets 7pm (Europe/London)"}],"context_management":null},"error":"rate_limit","isApiErrorMessage":true}
