{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-25T19:03:38.247Z","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."}
{"type":"queue-operation","operation":"dequeue","timestamp":"2026-02-25T19:03:38.250Z","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5"}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"PATH=/home/rajiv/.local/bin:$PATH /home/rajiv/.local/bin/entire hooks claude-code session-start"},"parentToolUseID":"ed81c87d-7f94-4797-9828-1124edd4411a","toolUseID":"ed81c87d-7f94-4797-9828-1124edd4411a","timestamp":"2026-02-25T19:03:35.063Z","uuid":"0c305357-a842-49aa-9862-793d977dd296"}
{"parentUuid":"0c305357-a842-49aa-9862-793d977dd296","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","type":"user","message":{"role":"user","content":"Analyze the project \"socialhomes\" and create comprehensive specification documents (Doc1, Doc2, Doc3) in docs/requirements/. Then populate EXECUTION-PLAN.md with detailed tasks for all 5 phases. Read any existing description or requirements files first."},"uuid":"4c28f77b-f817-42a7-ab32-87849062d95f","timestamp":"2026-02-25T19:03:38.301Z","permissionMode":"bypassPermissions"}
{"parentUuid":"4c28f77b-f817-42a7-ab32-87849062d95f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01P2F3CZ7ndipw9vMvjbSzQ3","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to analyze the socialhomes project and create comprehensive specification documents and an execution plan. Let me start by exploring the existing codebase to understand what's already there.\n\nLet me:\n1. Read existing specification documents and project files\n2. Explore the codebase structure\n3. Create the specification documents in docs/requirements/\n4. Create the EXECUTION-PLAN.md","signature":"ErkECkYICxgCKkB37f8wEaVOcFRzcMz+dw9X5+SB0lyUzK2bqNyElnKk1n/hX6Yix6B9gzcWINQ+0IWpinonGeoHVZnv6Fq5rJ+VEgyqA3UNgRoeVfZ/qUcaDNe41qbZ1ig2IoD1HiIw3E6wWo28+avUjhG0xup1NOBosUs38b6xtUF8Hs4W01UUPCjuAnbctU6MHj+wObGsKqADCHx5RVZSWhpJf/FjpHd6SculEYct3szSkueBOmExGP3GNVeGQ0DL1iABQuDGdx+o2ME0YRtc2Kf1+NOlIEKwEgjaMLkFp558N6dXH/65V+EQoCbtw4Tbs4jTIXDL8g6IyLYmNWGSEGOlZWUuUffcYJUcwdMgLjGDz4y+FjNSsuxtuwC6hFxbRkPG/b6qLYa6l71NJdDUukUBtnB3kqoYbzLwRIJJ9stcMvneFBW5c5FpeynsjC8V9EyHNhsdg6cfovoHHMvWPfdJxTw8Y7V40gQC0Akp/PbdTmO4pBXL6Xh3/dp7KmpQohlFj4V57Cgz8KOloYRn1IpNRXWGIDNXuUef9zmvVuGW+lhn39XX9Fqgwnuu5Y77/qFcaSF2qI08k0uUE5AS986GnQwqNV33IjBC9t7m/fR19d4DMF3wn+E+l4IFCdNKUX6fDsG751e2aq/rF5UjpeNT8cN4PS7hLlthj6KaaG5YJY4FOd+zYDSzK4D99joN0rrfP0E2q2pmeLDRQkjwPGct+Tm9/9sWAinrtmP1TaOXAN0r8ZQYkGoYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVKWv1UuUad8GURCjKnr","type":"assistant","uuid":"a0bdad38-dccb-4c2a-8449-479348dc8525","timestamp":"2026-02-25T19:13:41.951Z"}
{"parentUuid":"a0bdad38-dccb-4c2a-8449-479348dc8525","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01P2F3CZ7ndipw9vMvjbSzQ3","type":"message","role":"assistant","content":[{"type":"text","text":"I'll start by exploring the project structure and reading all existing documentation to understand the current state of socialhomes."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVKWv1UuUad8GURCjKnr","type":"assistant","uuid":"5701b0d2-47f1-4cc2-afc6-8a043df520a8","timestamp":"2026-02-25T19:13:42.857Z"}
{"parentUuid":"5701b0d2-47f1-4cc2-afc6-8a043df520a8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","message":{"model":"claude-opus-4-6","id":"msg_01P2F3CZ7ndipw9vMvjbSzQ3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014xMewWaGgpmRmUJWCtCBdP","name":"Task","input":{"description":"Explore socialhomes codebase","prompt":"Thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n1. Full directory structure (all folders, key files)\n2. What frameworks/libraries are used (check package.json files)\n3. What pages/routes exist in the frontend\n4. What API routes exist in the server\n5. What data models/schemas exist\n6. What existing specification docs exist (Doc1, Doc2, Doc3 or any .txt/.md files in root)\n7. The contents of SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, CLAUDE.md\n8. Database/Firestore structure from code\n9. Authentication setup\n10. Any existing EXECUTION-PLAN.md\n\nBe very thorough - read key files in full. Report back everything you find.","subagent_type":"Explore","max_turns":30},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4835,"cache_read_input_tokens":14308,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":4835},"output_tokens":6,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVKWv1UuUad8GURCjKnr","type":"assistant","uuid":"5e44498b-7a4e-4101-8695-1860136caadf","timestamp":"2026-02-25T19:13:47.362Z"}
{"type":"queue-operation","operation":"enqueue","timestamp":"2026-02-25T19:22:11.196Z","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","content":"<task-notification>\n<task-id>bcb2c8b</task-id>\n<tool-use-id>toolu_01XjLJqSRtaQ5Fw4h5xPPx8P</tool-use-id>\n<output-file>/tmp/claude-1000/-mnt-c--netapps-socialhomes/tasks/bcb2c8b.output</output-file>\n<status>completed</status>\n<summary>Background command \"Show directory sizes\" completed (exit code 0)</summary>\n</task-notification>\nRead the output file to retrieve the result: /tmp/claude-1000/-mnt-c--netapps-socialhomes/tasks/bcb2c8b.output"}
{"parentUuid":"5e44498b-7a4e-4101-8695-1860136caadf","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014xMewWaGgpmRmUJWCtCBdP","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have all the information I need. Let me compile a comprehensive exploration report:\n\n## COMPREHENSIVE SOCIALHOMES.AI PROJECT EXPLORATION\n\nI have thoroughly explored the SocialHomes.Ai project. Here is the complete breakdown:\n\n---\n\n### 1. DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                          # React 19 frontend (Vite)\n│   ├── src/\n│   │   ├── pages/               # 31 page components (17 directories)\n│   │   ├── components/          # 17 shared & layout components\n│   │   ├── hooks/               # 3 custom hooks\n│   │   ├── data/                # 11 static data files\n│   │   ├── services/            # API client (318 lines)\n│   │   ├── contexts/            # AuthContext, AppContext\n│   │   └── assets/\n│   ├── dist/                    # Built output\n│   └── package.json\n├── server/                      # Express.js backend\n│   ├── src/\n│   │   ├── routes/             # 15 route files\n│   │   ├── services/           # 16 service files (AI, APIs, seeding)\n│   │   ├── middleware/         # Error handler, metrics, rate limiter\n│   │   └── models/             # 2 schema definition files\n│   ├── dist/                   # Built output\n│   └── package.json\n├── docs/\n│   └── requirements/           # 3 specification docs (v5.0)\n├── tests/                      # Selenium test scripts + results\n├── firestore.rules             # Firestore security rules\n├── firestore.indexes.json      # 17 composite indexes\n├── CLAUDE.md                   # Project instructions\n├── SESSION-HISTORY.md          # 9 session log (persistent memory)\n├── DEV-FIX-LIST.md            # Bug tracker (all resolved)\n├── EXECUTION-PLAN.md          # Master plan (v5.0, Phases 0-5)\n├── DEVOPS.md                  # Infrastructure guide\n├── cloudbuild.yaml            # Cloud Build CI/CD config\n├── Dockerfile                 # Container definition\n└── README.md\n```\n\n---\n\n### 2. FRAMEWORKS & LIBRARIES\n\n**Frontend Stack:**\n- React 19.2.0 + React Router 6.30.3\n- Vite 7.2.4 (build tool)\n- TypeScript 5.9.3\n- Tailwind CSS 4.1.18 (dark theme)\n- TanStack React Query 5.90.20 (data fetching)\n- Leaflet 1.9.4 + Lucide React icons\n- Three.js 0.182.0 (3D visualization)\n- Recharts 3.7.0 + D3.js 7.9.0 (charts)\n- Firebase 12.9.0 + FirebaseUI 6.1.0 (authentication)\n\n**Backend Stack:**\n- Express 4.21.2 (server framework)\n- TypeScript 5.7.0\n- Google Cloud Firestore 7.11.0 (database)\n- Firebase Admin 13.6.1\n- Helmet 8.1.0 (security headers)\n- Morgan 1.10.0 (logging)\n- Compression 1.8.0, CORS 2.8.5\n\n**Testing & DevOps:**\n- Vitest 4.0.18 (unit testing)\n- Puppeteer (E2E testing)\n- Google Cloud Run (production hosting)\n- Cloud Build (CI/CD pipeline)\n- Entire.io (agent session tracking)\n\n---\n\n### 3. FRONTEND PAGES/ROUTES (31 total)\n\n| Category | Pages | Route Patterns |\n|----------|-------|----------------|\n| **Core** | Login, Dashboard, Explore, Search | /login, /dashboard, /explore, /search |\n| **Tenancies** | List, Detail | /tenancies, /tenancies/:id |\n| **Properties** | List, Detail, Viewing, Application | /properties, /properties/:id, /properties/:id/book-viewing, /apply |\n| **Repairs** | List, Detail | /repairs, /repairs/:id |\n| **Rent & Income** | List, Accounts, Arrears | /rent, /rent/accounts, /rent/arrears |\n| **Compliance** | Overview, Type Details, Awaab's Law | /compliance, /compliance/:type, /compliance/awaabs-law |\n| **Cases** | Complaints List/Detail, ASB List/Detail, Allocations | /complaints, /asb, /allocations |\n| **Communications** | Messages, Templates | /communications |\n| **Reports** | List, TSM, Dynamic Reports | /reports, /reports/tsm, /reports/:slug |\n| **AI Centre** | Insights, Predictions, Assistant | /ai, /ai/insights, /ai/predictions, /ai/assistant |\n| **Tenant Portal** | Self-service portal | /tenant-portal |\n| **Admin** | 8 sub-pages (Org, Users, Teams, Workflows, Integrations, Audit, System, Briefing) | /admin/* |\n\n**Total:** 31 page components across 19 directories + 17 shared components\n\n---\n\n### 4. API ROUTES/ENDPOINTS (14 route files, 50+ endpoints)\n\n| Route Module | Endpoints | Purpose |\n|--------------|-----------|---------|\n| **auth.ts** | Login, logout, Firebase config | Authentication |\n| **properties.ts** | List, get, update | Property management |\n| **tenants.ts** | List, get, update, activities, cases | Tenant management |\n| **cases.ts** | CRUD, activities, status updates | Case management (repairs, complaints, ASB) |\n| **explore.ts** | Hierarchy, regions, estates, blocks | Spatial navigation |\n| **briefing.ts** | AI briefing, neighborhood intelligence | Estate briefing |\n| **compliance.ts** | Big 6 status, Awaab's Law, certificates | Regulatory compliance |\n| **rent.ts** | Transactions, arrears, collections | Financial management |\n| **reports.ts** | 27+ dynamic reports, TSM export | Business reporting |\n| **ai.ts** | 14 AI endpoints (damp, crime, vulnerability, benefits, briefing, notify, census, mock services) | AI-native features |\n| **admin.ts** | Integrations, monitoring, toggle, test | Admin dashboard |\n| **public-data.ts** | Census, NOMIS, Gas Safe, Electrical | Public data APIs |\n| **export.ts** | CSV export, data extraction | Data export |\n| **lettings.ts** | Allocations, applications | Lettings management |\n| **booking.ts** | Viewing bookings | Property viewings |\n\n**Rate Limiting Tiers:**\n- Auth: 10 req/min\n- AI: 30 req/min\n- Admin: 20 req/min\n- General: 100 req/min\n\n---\n\n### 5. DATA MODELS & FIRESTORE COLLECTIONS\n\n**17 Firestore Collections:**\n- organisations\n- regions, localAuthorities, estates, blocks (geography)\n- properties, tenants (core entities)\n- cases (repairs, complaints, ASB, damp, financial — polymorphic)\n- activities (audit trail)\n- communications, notifications\n- rentTransactions\n- users, auditLog\n- hactCodes (reference data)\n- voidProperties, applicants\n- tsmMeasures, externalDataCache\n\n**Composite Indexes:** 17 indexes on cases, properties, tenants, activities, rentTransactions, auditLog, geography hierarchies\n\n**Security Rules:** Role-based access control (5 personas: COO, Head of Service, Manager, Housing Officer, Operative) via Firestore custom claims\n\n---\n\n### 6. SPECIFICATION DOCUMENTS\n\n**Root Level (Original):**\n- `Doc1-SocialHomesAi-Base-Specification.txt` (28.6 KB) — Base product spec\n- `Doc2-SocialHomesAi-AI-Native-Features.txt` (32.4 KB) — AI features & dynamic patterns\n- `Doc3-Public-API-Integration-Requirements.txt` (98.3 KB) — External API integrations (Tier 1/2/3)\n- `Doc4-UI-UX-Audit-Build-Guide.md` (15.6 KB) — UI/UX audit\n\n**Updated Docs (docs/requirements/ - v5.0):**\n- `Doc1-socialhomes-Base-Specification.txt` (802 lines) — Merged v3.0 (product + AI-native)\n- `Doc2-socialhomes-Technical-Architecture.txt` (966 lines) — System architecture, tech stack, data models\n- `Doc3-socialhomes-API-Requirements.txt` (775 lines) — All 50+ endpoints documented (2,543 lines total)\n\n---\n\n### 7. SESSION HISTORY & KEY DOCUMENTS\n\n**SESSION-HISTORY.md (25.5 KB):**\n- 9 recorded sessions from 2026-02-12 to 2026-02-25\n- Phases 0-4 complete (70 tasks done)\n- Phase 5 (Evolution) 44 tasks TODO (Vertex AI, WebSocket, testing, devops)\n- Architecture decisions documented\n- Persistent memory for cross-session context\n\n**DEV-FIX-LIST.md (5.2 KB):**\n- Status: 331 tests | 330 PASS | 1 WARN | 99.7% pass rate\n- All 6 critical bugs FIXED (React Error #310 resolved)\n- All 11 warnings FIXED\n- Live deployment: https://socialhomes-587984201316.europe-west2.run.app\n\n**DEVOPS.md (36.1 KB):**\n- Cloud Run service in europe-west2\n- GCP Project: gen-lang-client-0878518473 (project number: 587984201316)\n- Firestore default database\n- Secret Manager for environment variables\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n\n**EXECUTION-PLAN.md (30 KB - v5.0):**\n- Phases 0-4: DONE (70/70 tasks)\n- Phase 5: Evolution (44 tasks across 5 sub-phases)\n  - 5.1: Project Setup & Architecture (9 tasks)\n  - 5.2: Backend Development (14 tasks)\n  - 5.3: Frontend Development (10 tasks)\n  - 5.4: Testing & QA (8 tasks)\n  - 5.5: DevOps & Deployment (9 tasks)\n- Critical path documented with dependencies\n- Metrics targets included (P95 latency <500ms, 99.7% test pass rate, etc.)\n\n---\n\n### 8. AUTHENTICATION & SECURITY\n\n**Authentication:**\n- Firebase Authentication (email + Google sign-in)\n- Custom claims for persona/role (COO, Head of Service, Manager, Housing Officer, Operative)\n- Firebase JWT tokens + X-Persona fallback header\n- Protected routes via ProtectedRoute component\n- Session persistence via Firebase client SDK\n\n**Security Hardening (Phase 4 Complete):**\n- Helmet CSP with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS restricted to localhost + Cloud Run URL (with fallback for same-origin)\n- Rate limiting: 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID (X-Request-ID)\n- JSON body limit: 1MB\n- No exposed API keys (removed from git history)\n\n**Firestore Rules:**\n- Role-based authorization via custom claims\n- Persona-scoped read/write permissions\n- Audit log append-only (no deletes)\n- User self-update allowed for own records\n\n---\n\n### 9. EXISTING FEATURES & AI CAPABILITIES\n\n**7 Killer Differentiators (Phase 2 Complete):**\n1. **Predictive Damp Intelligence** — 5-factor weighted algorithm (weather, building, history, sensors, occupancy)\n2. **Live Crime Context for ASB** — Police.uk correlation + hotspot analysis\n3. **Automatic Vulnerability Detection** — 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Benefits Entitlement Engine** — UK 2025/26 benefit rules (UC, PIP, AA, Pension Credit, etc.)\n5. **Property Passport** — Multi-source aggregation (EPC, crime, damp, compliance, demographics)\n6. **AI Neighbourhood Briefing** — Per-estate daily intelligence (weather, crime, damp, compliance, financial)\n7. **Mock Tier 3 Services** — DWP UC verification, IoT sensors, GoCardless, NOMIS labour market\n\n**API Integrations:**\n- **Tier 1 (Live):** Postcodes.io, Open UPRN, Police.uk, Open-Meteo, DEFRA Flood Risk\n- **Tier 2 (Live):** GOV.UK Notify (24 templates), Census/NOMIS, Gas Safe Register, Electrical Safety Register\n- **Tier 3 (Mock):** Plentific/Fixflo, RSH/CORE/Ombudsman, DocuSign, Experian/TransUnion, Land Registry\n\n**Admin & Monitoring:**\n- 20 integrations management dashboard\n- Health check endpoint with Firestore connectivity\n- Request/response metrics + status code tracking\n- Production monitoring service (uptime, latency, error rates)\n\n---\n\n### 10. BUILD & DEPLOYMENT\n\n**Development Commands:**\n- `cd app && npm run dev` — Frontend dev server (port 5173)\n- `cd server && npm run dev` — Backend dev server (port 8080)\n- `cd app && npm run build` — Vite build (3,395 modules, 38.43s)\n- `cd server && npm run build` — TypeScript compilation\n- `cd server && npm run seed` — Firestore data seeding (75 properties, 68 tenants, 279+ cases)\n\n**Production Deployment:**\n- `git push origin main` — Triggers Cloud Build automatically\n- Cloud Run service: europe-west2 region\n- Docker image built via Dockerfile\n- Static React SPA served from Express server\n- Build markers and no-cache flags for debugging\n\n**Cloud Configuration:**\n- GCP Project: gen-lang-client-0878518473\n- Cloud Run: socialhomes service (1 CPU, 1GB memory)\n- Secret Manager: 4 secrets (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n- Firestore: default database in Firebase project gen-lang-client-0146156913\n- Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes\n\n---\n\n### 11. PROJECT SIZE & METRICS\n\n- **Total Files:** 73 frontend TypeScript files + 43 backend TypeScript files = 116 core files\n- **Total Code:** ~4,100+ lines in data/hooks + ~2,500+ lines in services + 50+ API endpoints\n- **Specification:** 2,543 lines across 3 requirement documents (v5.0)\n- **Test Coverage:** 331 Selenium tests (99.7% pass rate, 330/331 passing)\n- **Live Deployment:** https://socialhomes-587984201316.europe-west2.run.app\n- **Bundle Size:** ~2.5MB (all assets included)\n- **Cloud Run Cold Start:** <2s\n\n---\n\n### 12. ARCHITECTURE OVERVIEW\n\n```\nInternet\n   ↓\nGoogle Cloud Run (europe-west2)\n   ├── Express.js Server (:8080)\n   │   ├── Authentication routes (Firebase JWT)\n   │   ├── 12 API modules (50+ endpoints)\n   │   ├── AI services (7 differentiators)\n   │   ├── External API proxy (with caching)\n   │   ├── Rate limiting middleware\n   │   ├── Metrics & monitoring\n   │   └── React SPA static file serving\n   └── Google Cloud Firestore\n       ├── 17 collections\n       ├── ~550 documents (seeded)\n       ├── 17 composite indexes\n       └── Role-based security rules\n\nFrontend: React 19 + Vite + Tailwind CSS (dark theme)\nMaps: Leaflet.js + OpenStreetMap (free)\n3D: Three.js (digital twin)\nCharts: Recharts + D3.js\nState: React Context + React Query\nAuth: Firebase Authentication\nCI/CD: GitHub → Cloud Build → Artifact Registry → Cloud Run\nMonitoring: Cloud Logging + Cloud Monitoring + Entire.io\n```\n\n---\n\n### 13. KEY TECHNOLOGIES & PATTERNS\n\n- **TypeScript:** Full type coverage, zero errors\n- **React Hooks:** Custom hooks for API, entity intelligence, persona scoping\n- **Error Boundary:** Runtime error catching\n- **React Router:** Nested routes, protected routes, lazy loading\n- **Firestore Timestamp Sanitization:** Prevents React Error #310\n- **QueryString Building:** Type-safe query parameters\n- **Context API:** Global app state + authentication state\n- **Tailwind Dark Mode:** CSS custom properties + brand colour palette\n- **API Caching:** External data cache with TTL management\n- **Fallback Patterns:** Static data fallback when API unavailable\n\n---\n\n### 14. REGULATORY & COMPLIANCE\n\n- **Regulatory Framework:** UK Housing Ombudsman Code compliance\n- **Awaab's Law:** Automatic deadline calculation + SLA breach detection\n- **Big 6 Compliance:** Gas, Electrical, Fire, Asbestos, Legionella, Lift safety\n- **WCAG AA:** Full accessibility (focus traps, skip links, ARIA labels, motion settings)\n- **GDPR:** PII masking, audit trails, data export\n- **Firestore Security Rules:** Row-level security via custom claims\n\n---\n\n### 15. SIMULATED ORGANISATION\n\n- **Name:** Riverside Crescent Housing Association (RCHA)\n- **RP Number:** 4567\n- **Regulatory:** G1/V1\n- **Headquarters:** Southwark\n- **Regions:** London (Southwark, Lewisham, Lambeth), South, Midlands\n- **Stock:** 75 properties, 68 tenants, 279+ cases\n- **Estates:** 5 (Oak Park, Riverside Crescent, Elm Gardens, Birch Court, Maple Lane)\n- **Test Data:** Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n\n---\n\n### SUMMARY\n\nSocialHomes.Ai is a **production-ready, AI-native social housing management platform** with:\n\n✅ 31 frontend pages covering all housing management functions\n✅ 50+ API endpoints across 14 route modules  \n✅ 7 proprietary AI differentiators with live integrations\n✅ Full Firestore backend with 17 collections + 17 composite indexes\n✅ Complete security hardening (CSP, CORS, rate limiting, encryption)\n✅ 99.7% test pass rate (331 Selenium tests)\n✅ Live deployment on Google Cloud Run (europe-west2)\n✅ Dark, modern UI (Yantra.Works brand) with WCAG AA accessibility\n✅ Comprehensive specification docs (v5.0) + master execution plan\n✅ 5 personas with role-based access control\n\n**Current Status:** Phases 0-4 complete (production MVP). Phase 5 (Evolution) queued with 44 tasks for Vertex AI integration, WebSocket real-time features, advanced testing, and DevOps hardening."},{"type":"text","text":"agentId: a680cacc84df8b6e4 (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 80724\ntool_uses: 40\nduration_ms: 245488</usage>"}]}]},"uuid":"347370fa-4e76-407f-b842-d6e0de1d7d94","timestamp":"2026-02-25T19:22:48.301Z","toolUseResult":{"status":"completed","prompt":"Thoroughly explore the socialhomes project at /mnt/c/.netapps/socialhomes. I need to understand:\n1. Full directory structure (all folders, key files)\n2. What frameworks/libraries are used (check package.json files)\n3. What pages/routes exist in the frontend\n4. What API routes exist in the server\n5. What data models/schemas exist\n6. What existing specification docs exist (Doc1, Doc2, Doc3 or any .txt/.md files in root)\n7. The contents of SESSION-HISTORY.md, DEV-FIX-LIST.md, DEVOPS.md, CLAUDE.md\n8. Database/Firestore structure from code\n9. Authentication setup\n10. Any existing EXECUTION-PLAN.md\n\nBe very thorough - read key files in full. Report back everything you find.","agentId":"a680cacc84df8b6e4","content":[{"type":"text","text":"Perfect! Now I have all the information I need. Let me compile a comprehensive exploration report:\n\n## COMPREHENSIVE SOCIALHOMES.AI PROJECT EXPLORATION\n\nI have thoroughly explored the SocialHomes.Ai project. Here is the complete breakdown:\n\n---\n\n### 1. DIRECTORY STRUCTURE\n\n```\n/mnt/c/.netapps/socialhomes/\n├── app/                          # React 19 frontend (Vite)\n│   ├── src/\n│   │   ├── pages/               # 31 page components (17 directories)\n│   │   ├── components/          # 17 shared & layout components\n│   │   ├── hooks/               # 3 custom hooks\n│   │   ├── data/                # 11 static data files\n│   │   ├── services/            # API client (318 lines)\n│   │   ├── contexts/            # AuthContext, AppContext\n│   │   └── assets/\n│   ├── dist/                    # Built output\n│   └── package.json\n├── server/                      # Express.js backend\n│   ├── src/\n│   │   ├── routes/             # 15 route files\n│   │   ├── services/           # 16 service files (AI, APIs, seeding)\n│   │   ├── middleware/         # Error handler, metrics, rate limiter\n│   │   └── models/             # 2 schema definition files\n│   ├── dist/                   # Built output\n│   └── package.json\n├── docs/\n│   └── requirements/           # 3 specification docs (v5.0)\n├── tests/                      # Selenium test scripts + results\n├── firestore.rules             # Firestore security rules\n├── firestore.indexes.json      # 17 composite indexes\n├── CLAUDE.md                   # Project instructions\n├── SESSION-HISTORY.md          # 9 session log (persistent memory)\n├── DEV-FIX-LIST.md            # Bug tracker (all resolved)\n├── EXECUTION-PLAN.md          # Master plan (v5.0, Phases 0-5)\n├── DEVOPS.md                  # Infrastructure guide\n├── cloudbuild.yaml            # Cloud Build CI/CD config\n├── Dockerfile                 # Container definition\n└── README.md\n```\n\n---\n\n### 2. FRAMEWORKS & LIBRARIES\n\n**Frontend Stack:**\n- React 19.2.0 + React Router 6.30.3\n- Vite 7.2.4 (build tool)\n- TypeScript 5.9.3\n- Tailwind CSS 4.1.18 (dark theme)\n- TanStack React Query 5.90.20 (data fetching)\n- Leaflet 1.9.4 + Lucide React icons\n- Three.js 0.182.0 (3D visualization)\n- Recharts 3.7.0 + D3.js 7.9.0 (charts)\n- Firebase 12.9.0 + FirebaseUI 6.1.0 (authentication)\n\n**Backend Stack:**\n- Express 4.21.2 (server framework)\n- TypeScript 5.7.0\n- Google Cloud Firestore 7.11.0 (database)\n- Firebase Admin 13.6.1\n- Helmet 8.1.0 (security headers)\n- Morgan 1.10.0 (logging)\n- Compression 1.8.0, CORS 2.8.5\n\n**Testing & DevOps:**\n- Vitest 4.0.18 (unit testing)\n- Puppeteer (E2E testing)\n- Google Cloud Run (production hosting)\n- Cloud Build (CI/CD pipeline)\n- Entire.io (agent session tracking)\n\n---\n\n### 3. FRONTEND PAGES/ROUTES (31 total)\n\n| Category | Pages | Route Patterns |\n|----------|-------|----------------|\n| **Core** | Login, Dashboard, Explore, Search | /login, /dashboard, /explore, /search |\n| **Tenancies** | List, Detail | /tenancies, /tenancies/:id |\n| **Properties** | List, Detail, Viewing, Application | /properties, /properties/:id, /properties/:id/book-viewing, /apply |\n| **Repairs** | List, Detail | /repairs, /repairs/:id |\n| **Rent & Income** | List, Accounts, Arrears | /rent, /rent/accounts, /rent/arrears |\n| **Compliance** | Overview, Type Details, Awaab's Law | /compliance, /compliance/:type, /compliance/awaabs-law |\n| **Cases** | Complaints List/Detail, ASB List/Detail, Allocations | /complaints, /asb, /allocations |\n| **Communications** | Messages, Templates | /communications |\n| **Reports** | List, TSM, Dynamic Reports | /reports, /reports/tsm, /reports/:slug |\n| **AI Centre** | Insights, Predictions, Assistant | /ai, /ai/insights, /ai/predictions, /ai/assistant |\n| **Tenant Portal** | Self-service portal | /tenant-portal |\n| **Admin** | 8 sub-pages (Org, Users, Teams, Workflows, Integrations, Audit, System, Briefing) | /admin/* |\n\n**Total:** 31 page components across 19 directories + 17 shared components\n\n---\n\n### 4. API ROUTES/ENDPOINTS (14 route files, 50+ endpoints)\n\n| Route Module | Endpoints | Purpose |\n|--------------|-----------|---------|\n| **auth.ts** | Login, logout, Firebase config | Authentication |\n| **properties.ts** | List, get, update | Property management |\n| **tenants.ts** | List, get, update, activities, cases | Tenant management |\n| **cases.ts** | CRUD, activities, status updates | Case management (repairs, complaints, ASB) |\n| **explore.ts** | Hierarchy, regions, estates, blocks | Spatial navigation |\n| **briefing.ts** | AI briefing, neighborhood intelligence | Estate briefing |\n| **compliance.ts** | Big 6 status, Awaab's Law, certificates | Regulatory compliance |\n| **rent.ts** | Transactions, arrears, collections | Financial management |\n| **reports.ts** | 27+ dynamic reports, TSM export | Business reporting |\n| **ai.ts** | 14 AI endpoints (damp, crime, vulnerability, benefits, briefing, notify, census, mock services) | AI-native features |\n| **admin.ts** | Integrations, monitoring, toggle, test | Admin dashboard |\n| **public-data.ts** | Census, NOMIS, Gas Safe, Electrical | Public data APIs |\n| **export.ts** | CSV export, data extraction | Data export |\n| **lettings.ts** | Allocations, applications | Lettings management |\n| **booking.ts** | Viewing bookings | Property viewings |\n\n**Rate Limiting Tiers:**\n- Auth: 10 req/min\n- AI: 30 req/min\n- Admin: 20 req/min\n- General: 100 req/min\n\n---\n\n### 5. DATA MODELS & FIRESTORE COLLECTIONS\n\n**17 Firestore Collections:**\n- organisations\n- regions, localAuthorities, estates, blocks (geography)\n- properties, tenants (core entities)\n- cases (repairs, complaints, ASB, damp, financial — polymorphic)\n- activities (audit trail)\n- communications, notifications\n- rentTransactions\n- users, auditLog\n- hactCodes (reference data)\n- voidProperties, applicants\n- tsmMeasures, externalDataCache\n\n**Composite Indexes:** 17 indexes on cases, properties, tenants, activities, rentTransactions, auditLog, geography hierarchies\n\n**Security Rules:** Role-based access control (5 personas: COO, Head of Service, Manager, Housing Officer, Operative) via Firestore custom claims\n\n---\n\n### 6. SPECIFICATION DOCUMENTS\n\n**Root Level (Original):**\n- `Doc1-SocialHomesAi-Base-Specification.txt` (28.6 KB) — Base product spec\n- `Doc2-SocialHomesAi-AI-Native-Features.txt` (32.4 KB) — AI features & dynamic patterns\n- `Doc3-Public-API-Integration-Requirements.txt` (98.3 KB) — External API integrations (Tier 1/2/3)\n- `Doc4-UI-UX-Audit-Build-Guide.md` (15.6 KB) — UI/UX audit\n\n**Updated Docs (docs/requirements/ - v5.0):**\n- `Doc1-socialhomes-Base-Specification.txt` (802 lines) — Merged v3.0 (product + AI-native)\n- `Doc2-socialhomes-Technical-Architecture.txt` (966 lines) — System architecture, tech stack, data models\n- `Doc3-socialhomes-API-Requirements.txt` (775 lines) — All 50+ endpoints documented (2,543 lines total)\n\n---\n\n### 7. SESSION HISTORY & KEY DOCUMENTS\n\n**SESSION-HISTORY.md (25.5 KB):**\n- 9 recorded sessions from 2026-02-12 to 2026-02-25\n- Phases 0-4 complete (70 tasks done)\n- Phase 5 (Evolution) 44 tasks TODO (Vertex AI, WebSocket, testing, devops)\n- Architecture decisions documented\n- Persistent memory for cross-session context\n\n**DEV-FIX-LIST.md (5.2 KB):**\n- Status: 331 tests | 330 PASS | 1 WARN | 99.7% pass rate\n- All 6 critical bugs FIXED (React Error #310 resolved)\n- All 11 warnings FIXED\n- Live deployment: https://socialhomes-587984201316.europe-west2.run.app\n\n**DEVOPS.md (36.1 KB):**\n- Cloud Run service in europe-west2\n- GCP Project: gen-lang-client-0878518473 (project number: 587984201316)\n- Firestore default database\n- Secret Manager for environment variables\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n\n**EXECUTION-PLAN.md (30 KB - v5.0):**\n- Phases 0-4: DONE (70/70 tasks)\n- Phase 5: Evolution (44 tasks across 5 sub-phases)\n  - 5.1: Project Setup & Architecture (9 tasks)\n  - 5.2: Backend Development (14 tasks)\n  - 5.3: Frontend Development (10 tasks)\n  - 5.4: Testing & QA (8 tasks)\n  - 5.5: DevOps & Deployment (9 tasks)\n- Critical path documented with dependencies\n- Metrics targets included (P95 latency <500ms, 99.7% test pass rate, etc.)\n\n---\n\n### 8. AUTHENTICATION & SECURITY\n\n**Authentication:**\n- Firebase Authentication (email + Google sign-in)\n- Custom claims for persona/role (COO, Head of Service, Manager, Housing Officer, Operative)\n- Firebase JWT tokens + X-Persona fallback header\n- Protected routes via ProtectedRoute component\n- Session persistence via Firebase client SDK\n\n**Security Hardening (Phase 4 Complete):**\n- Helmet CSP with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS restricted to localhost + Cloud Run URL (with fallback for same-origin)\n- Rate limiting: 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID (X-Request-ID)\n- JSON body limit: 1MB\n- No exposed API keys (removed from git history)\n\n**Firestore Rules:**\n- Role-based authorization via custom claims\n- Persona-scoped read/write permissions\n- Audit log append-only (no deletes)\n- User self-update allowed for own records\n\n---\n\n### 9. EXISTING FEATURES & AI CAPABILITIES\n\n**7 Killer Differentiators (Phase 2 Complete):**\n1. **Predictive Damp Intelligence** — 5-factor weighted algorithm (weather, building, history, sensors, occupancy)\n2. **Live Crime Context for ASB** — Police.uk correlation + hotspot analysis\n3. **Automatic Vulnerability Detection** — 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition)\n4. **Benefits Entitlement Engine** — UK 2025/26 benefit rules (UC, PIP, AA, Pension Credit, etc.)\n5. **Property Passport** — Multi-source aggregation (EPC, crime, damp, compliance, demographics)\n6. **AI Neighbourhood Briefing** — Per-estate daily intelligence (weather, crime, damp, compliance, financial)\n7. **Mock Tier 3 Services** — DWP UC verification, IoT sensors, GoCardless, NOMIS labour market\n\n**API Integrations:**\n- **Tier 1 (Live):** Postcodes.io, Open UPRN, Police.uk, Open-Meteo, DEFRA Flood Risk\n- **Tier 2 (Live):** GOV.UK Notify (24 templates), Census/NOMIS, Gas Safe Register, Electrical Safety Register\n- **Tier 3 (Mock):** Plentific/Fixflo, RSH/CORE/Ombudsman, DocuSign, Experian/TransUnion, Land Registry\n\n**Admin & Monitoring:**\n- 20 integrations management dashboard\n- Health check endpoint with Firestore connectivity\n- Request/response metrics + status code tracking\n- Production monitoring service (uptime, latency, error rates)\n\n---\n\n### 10. BUILD & DEPLOYMENT\n\n**Development Commands:**\n- `cd app && npm run dev` — Frontend dev server (port 5173)\n- `cd server && npm run dev` — Backend dev server (port 8080)\n- `cd app && npm run build` — Vite build (3,395 modules, 38.43s)\n- `cd server && npm run build` — TypeScript compilation\n- `cd server && npm run seed` — Firestore data seeding (75 properties, 68 tenants, 279+ cases)\n\n**Production Deployment:**\n- `git push origin main` — Triggers Cloud Build automatically\n- Cloud Run service: europe-west2 region\n- Docker image built via Dockerfile\n- Static React SPA served from Express server\n- Build markers and no-cache flags for debugging\n\n**Cloud Configuration:**\n- GCP Project: gen-lang-client-0878518473\n- Cloud Run: socialhomes service (1 CPU, 1GB memory)\n- Secret Manager: 4 secrets (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n- Firestore: default database in Firebase project gen-lang-client-0146156913\n- Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes\n\n---\n\n### 11. PROJECT SIZE & METRICS\n\n- **Total Files:** 73 frontend TypeScript files + 43 backend TypeScript files = 116 core files\n- **Total Code:** ~4,100+ lines in data/hooks + ~2,500+ lines in services + 50+ API endpoints\n- **Specification:** 2,543 lines across 3 requirement documents (v5.0)\n- **Test Coverage:** 331 Selenium tests (99.7% pass rate, 330/331 passing)\n- **Live Deployment:** https://socialhomes-587984201316.europe-west2.run.app\n- **Bundle Size:** ~2.5MB (all assets included)\n- **Cloud Run Cold Start:** <2s\n\n---\n\n### 12. ARCHITECTURE OVERVIEW\n\n```\nInternet\n   ↓\nGoogle Cloud Run (europe-west2)\n   ├── Express.js Server (:8080)\n   │   ├── Authentication routes (Firebase JWT)\n   │   ├── 12 API modules (50+ endpoints)\n   │   ├── AI services (7 differentiators)\n   │   ├── External API proxy (with caching)\n   │   ├── Rate limiting middleware\n   │   ├── Metrics & monitoring\n   │   └── React SPA static file serving\n   └── Google Cloud Firestore\n       ├── 17 collections\n       ├── ~550 documents (seeded)\n       ├── 17 composite indexes\n       └── Role-based security rules\n\nFrontend: React 19 + Vite + Tailwind CSS (dark theme)\nMaps: Leaflet.js + OpenStreetMap (free)\n3D: Three.js (digital twin)\nCharts: Recharts + D3.js\nState: React Context + React Query\nAuth: Firebase Authentication\nCI/CD: GitHub → Cloud Build → Artifact Registry → Cloud Run\nMonitoring: Cloud Logging + Cloud Monitoring + Entire.io\n```\n\n---\n\n### 13. KEY TECHNOLOGIES & PATTERNS\n\n- **TypeScript:** Full type coverage, zero errors\n- **React Hooks:** Custom hooks for API, entity intelligence, persona scoping\n- **Error Boundary:** Runtime error catching\n- **React Router:** Nested routes, protected routes, lazy loading\n- **Firestore Timestamp Sanitization:** Prevents React Error #310\n- **QueryString Building:** Type-safe query parameters\n- **Context API:** Global app state + authentication state\n- **Tailwind Dark Mode:** CSS custom properties + brand colour palette\n- **API Caching:** External data cache with TTL management\n- **Fallback Patterns:** Static data fallback when API unavailable\n\n---\n\n### 14. REGULATORY & COMPLIANCE\n\n- **Regulatory Framework:** UK Housing Ombudsman Code compliance\n- **Awaab's Law:** Automatic deadline calculation + SLA breach detection\n- **Big 6 Compliance:** Gas, Electrical, Fire, Asbestos, Legionella, Lift safety\n- **WCAG AA:** Full accessibility (focus traps, skip links, ARIA labels, motion settings)\n- **GDPR:** PII masking, audit trails, data export\n- **Firestore Security Rules:** Row-level security via custom claims\n\n---\n\n### 15. SIMULATED ORGANISATION\n\n- **Name:** Riverside Crescent Housing Association (RCHA)\n- **RP Number:** 4567\n- **Regulatory:** G1/V1\n- **Headquarters:** Southwark\n- **Regions:** London (Southwark, Lewisham, Lambeth), South, Midlands\n- **Stock:** 75 properties, 68 tenants, 279+ cases\n- **Estates:** 5 (Oak Park, Riverside Crescent, Elm Gardens, Birch Court, Maple Lane)\n- **Test Data:** Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n\n---\n\n### SUMMARY\n\nSocialHomes.Ai is a **production-ready, AI-native social housing management platform** with:\n\n✅ 31 frontend pages covering all housing management functions\n✅ 50+ API endpoints across 14 route modules  \n✅ 7 proprietary AI differentiators with live integrations\n✅ Full Firestore backend with 17 collections + 17 composite indexes\n✅ Complete security hardening (CSP, CORS, rate limiting, encryption)\n✅ 99.7% test pass rate (331 Selenium tests)\n✅ Live deployment on Google Cloud Run (europe-west2)\n✅ Dark, modern UI (Yantra.Works brand) with WCAG AA accessibility\n✅ Comprehensive specification docs (v5.0) + master execution plan\n✅ 5 personas with role-based access control\n\n**Current Status:** Phases 0-4 complete (production MVP). Phase 5 (Evolution) queued with 44 tasks for Vertex AI integration, WebSocket real-time features, advanced testing, and DevOps hardening."}],"totalDurationMs":245488,"totalTokens":80724,"totalToolUseCount":40,"usage":{"input_tokens":7,"cache_creation_input_tokens":6409,"cache_read_input_tokens":69402,"output_tokens":4906,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":6409,"ephemeral_5m_input_tokens":0},"inference_geo":"","iterations":[],"speed":"standard"}},"sourceToolAssistantUUID":"5e44498b-7a4e-4101-8695-1860136caadf"}
{"type":"queue-operation","operation":"remove","timestamp":"2026-02-25T19:28:24.148Z","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5"}
{"parentUuid":"347370fa-4e76-407f-b842-d6e0de1d7d94","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I now have a comprehensive understanding of the socialhomes project. Let me now read the existing specification documents in docs/requirements/ to understand what's already there, and then I'll create updated, comprehensive versions.\n\nLet me read the existing docs and EXECUTION-PLAN.md to understand what's already in place.","signature":"EuwDCkYICxgCKkAsWmAQz/YAQKD+udXVYCseZ1jhEnIi5UQNPkueCc2c4Sv97NXMoXG60AQPV0sFZRrPBjw0z2neVc/rEWCaj51REgxzFuYgdFHmr/Ny0ToaDDrmnbe+qs6fpfZkKyIwRHYHIMjJ5rDC4IyBSXNLkRXKeNCK9FCIP7yZyI+n7DDXtCpWgOYthW1CyMgp9/tAKtMCT0FN58dhJVpHZ0juY7jvBJ3FZ1cs8uO67oNbivyUIPJyv0QvMGinTogiz13/Va91cIPdi9JM70xYnATjHgGdYhcWvSuDqtHRoZKbQrxcDWKrbKjrZsbs6P4qXG7id+WndDeQPhUTKjFqgP2wd50za5e2VLIWRCtPLtGZ3NmWEudGYPAIzF5DyBAJYy7vbl/MXFHUMohayE9RnTfEBA+lo9cJswSbcy+dCXfTCyWvGuh/ZVHJWoXLYf7QR5hKygGXFDRPbpAdXliO2D3LnN8LPg8Q1YsqNcSujfzw5AUcpEENWr2xazN2dAa/xYCQ2ncmnw9TlGs/SqxPRuAEtl2ILKss03NB5ZQXxZmuakzhHW2uHk2RIvmjqXViN56LN2fssprBV9Ss6dYilkuUHAIzCMgJFYiyQQfCb4UA+XcsG4Rj+QYzZqfBIr4Qv/0RkBv3juedGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"0e00a3bf-b9b3-49d5-b424-92dd0f8b0c61","timestamp":"2026-02-25T19:28:28.320Z"}
{"parentUuid":"0e00a3bf-b9b3-49d5-b424-92dd0f8b0c61","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent — I have a thorough understanding of the project. Now let me read the existing specification documents and execution plan to understand what's already written, so I can create comprehensive updated versions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"17afa3e1-2f8c-4292-9b9d-f7f138e276d6","timestamp":"2026-02-25T19:28:29.046Z"}
{"parentUuid":"17afa3e1-2f8c-4292-9b9d-f7f138e276d6","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UqBxBKaiZbziFfzyeT14UQ","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"f86a82f3-877f-4695-80d3-eb5049f6c435","timestamp":"2026-02-25T19:28:29.668Z"}
{"parentUuid":"f86a82f3-877f-4695-80d3-eb5049f6c435","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UqBxBKaiZbziFfzyeT14UQ","type":"tool_result","content":"     1→================================================================================\n     2→  Doc1 — SocialHomes.Ai Base Specification\n     3→  Version: 5.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. PRODUCT OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Product Name\n    11→    SocialHomes.Ai\n    12→\n    13→1.2 Tagline\n    14→    AI-native social housing management for UK housing associations.\n    15→    Secondary: \"AI-native. Human-assured.\"\n    16→\n    17→1.3 Vision\n    18→    To be the first truly AI-native housing management system that embeds\n    19→    predictive intelligence, automation, and contextual assistance into every\n    20→    screen, workflow, and decision — transforming reactive housing operations\n    21→    into proactive, data-driven housing management.\n    22→\n    23→    This is NOT a legacy system with a fresh coat of paint. This must look and\n    24→    feel like nothing the social housing sector has ever seen — think Bloomberg\n    25→    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    26→    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    27→    is the opposite: dark, fast, visually stunning, animated, intelligent.\n    28→\n    29→1.4 Target Market\n    30→    UK Social Housing Providers:\n    31→    - Housing Associations (Registered Providers)\n    32→    - Local Authority housing departments\n    33→    - ALMOs (Arms Length Management Organisations)\n    34→    Typical scale: 5,000-20,000 housing units across multiple regions.\n    35→\n    36→1.5 Simulated Organisation\n    37→    Name:           Riverside Crescent Housing Association (RCHA)\n    38→    RP Number:      4567\n    39→    Regulatory:     G1/V1\n    40→    HQ:             Southwark\n    41→    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    42→    Stock:          75 properties, 68 tenants, 279+ cases\n    43→    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    44→    UPRNs:          Realistic 12-digit references\n    45→    EPCs:           Mapped to real certificates where available\n    46→\n    47→    5 Estates:\n    48→    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    49→    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    50→    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    51→    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    52→    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n    53→\n    54→1.6 Built By\n    55→    Yantra Works — an AI-native development studio.\n    56→\n    57→1.7 Live Deployment\n    58→    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    59→    Region:         europe-west2 (London)\n    60→    Status:         LIVE and operational\n    61→    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n    62→\n    63→\n    64→2. CORE FUNCTIONAL MODULES (17 modules)\n    65→================================================================================\n    66→\n    67→2.1 Dashboard\n    68→    Route: /dashboard\n    69→    Purpose: Real-time operational overview with persona-scoped KPIs\n    70→    Features:\n    71→    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n    72→      arrears, compliance %, open complaints, AI alerts)\n    73→    - KPI trend sparklines (12 months)\n    74→    - Charts row: rent collection 12-month trend vs 97% target;\n    75→      repairs monthly volume by priority with avg days line\n    76→    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n    77→      with countdown timers | AI insights scrolling feed\n    78→    - Activity timeline with real-time system event feed\n    79→    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    80→    - Quick action buttons for common tasks\n    81→\n    82→2.2 Visual Drill-Down Explorer (Flagship Feature)\n    83→    Route: /explore\n    84→    Purpose: 7-level spatial hierarchy navigation\n    85→    Hierarchy:\n    86→      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n    87→\n    88→    Layout:\n    89→    +--------------------------------+---------------------------------+\n    90→    |                                |  CONTEXT PANEL (scrollable)     |\n    91→    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    92→    |                                |  - Attribute cards               |\n    93→    |      Interactive Leaflet map   |  - Compliance status             |\n    94→    |      OR Three.js 3D building   |  - KPI metrics                   |\n    95→    |      depending on zoom level   |  - AI insights (purple section)  |\n    96→    |                                |  - Children list (next level)    |\n    97→    |                                |  - Quick actions                  |\n    98→    +--------------------------------+---------------------------------+\n    99→    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n   100→    | Data layer toggles: Crime / Damp Risk / Compliance               |\n   101→    +------------------------------------------------------------------+\n   102→\n   103→    Features:\n   104→    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n   105→    - Three.js 3D building visualization (digital twin) at block level\n   106→    - Context panel with attributes, KPIs, compliance, AI insights\n   107→    - Color-coded units: green (compliant), amber (warning), red (critical),\n   108→      purple (AI flag), grey (void)\n   109→    - Data layer toggles: Crime, Damp Risk, Compliance\n   110→    - Click-through navigation from any level\n   111→\n   112→    Level Details:\n   113→    L0 Country:     England centred, 3 regions, portfolio summary\n   114→    L1 Region:      Zoomed to region, LA areas as markers\n   115→    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n   116→    L3 Estate:      Zoom 16-17, individual buildings as footprints\n   117→    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n   118→                    (FRA, Building Safety Case, communal systems, asbestos plan,\n   119→                    legionella, structural surveys)\n   120→    L4a Core:       For multi-core buildings, schematic floor plan\n   121→    L5 Unit:        Highlighted unit in building model, tabbed detail\n   122→                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n   123→                    Works History, Documents)\n   124→    L6 Tenant:      Full tenant record with tabbed view\n   125→    L7 Case:        Case detail with timeline\n   126→\n   127→2.3 Tenancies Management\n   128→    Route: /tenancies, /tenancies/:id\n   129→    Purpose: Tenancy lifecycle management\n   130→    Features:\n   131→    - Tenancy list with search (name, address, ID, officer), filter, sort\n   132→    - 68 tenants with dynamic count subtitle\n   133→    - Tenancy detail: household composition, rent account, case timeline\n   134→    - Vulnerability detection (AI 7-factor scoring)\n   135→    - Benefits entitlement check\n   136→    - Arrears status with color-coded balance\n   137→    - 52-week transaction ledger with balance trend chart\n   138→    - Action workflows: arrears action, schedule visit, create case\n   139→    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n   140→      referral generators, communication drafters\n   141→\n   142→2.4 Properties Management\n   143→    Route: /properties, /properties/:id, /properties/:id/apply,\n   144→           /properties/:id/book-viewing\n   145→    Purpose: Property and asset data management\n   146→    Features:\n   147→    - Property list with mini Leaflet map in list view\n   148→    - 75 properties with pagination\n   149→    - Property detail: building attributes, compliance certificates, case history\n   150→    - Property Passport (multi-source AI aggregation)\n   151→    - Damp Intelligence Panel (5-factor predictive score)\n   152→    - Compliance timeline (Big 6 certificates)\n   153→    - Viewing bookings and allocation workflow\n   154→    - Digital twin (3D block visualization)\n   155→    - Application page for void properties\n   156→\n   157→2.5 Repairs Management\n   158→    Route: /repairs, /repairs/:id\n   159→    Purpose: Responsive and planned repairs case management\n   160→    Features:\n   161→    - 200+ repair cases with list/kanban toggle\n   162→    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n   163→    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n   164→    - Appointment booking with time slots\n   165→    - Operative notes, before/after photos\n   166→    - Contractor verification badges (Gas Safe green, NICEIC blue)\n   167→    - Satisfaction survey (post-completion)\n   168→    - Recurrence prediction (AI)\n   169→    - Cost tracking and authorisation workflow\n   170→    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n   171→      priority, trade, Awaab's Law flags\n   172→\n   173→2.6 Compliance Management\n   174→    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n   175→    Purpose: Regulatory compliance tracking and Awaab's Law\n   176→    Features:\n   177→    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n   178→    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n   179→    - Awaab's Law dedicated page:\n   180→      - Emergency hazard response: 24-hour countdown timer\n   181→      - Significant hazard repair: 10-12 week countdown timer\n   182→      - Risk register with property-level assessments\n   183→      - Proactive inspection programme tracking\n   184→    - Building-level compliance: FRA, Building Safety Case\n   185→    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n   186→    - Compliance failure prediction (AI)\n   187→    - No-access tracker, contractor performance\n   188→\n   189→2.7 Complaints Management\n   190→    Route: /complaints, /complaints/:id\n   191→    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n   192→    Features:\n   193→    - 34 complaints with status filtering\n   194→    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n   195→    - Deadline countdown timers with color-coded urgency\n   196→    - Ombudsman escalation pathway\n   197→    - Complaint escalation prediction (AI)\n   198→    - Linked cases and evidence log\n   199→    - TSM CH01/CH02 reporting integration\n   200→    - Categories pie chart, findings breakdown, learning tracker\n   201→\n   202→2.8 Anti-Social Behaviour (ASB)\n   203→    Route: /asb, /asb/:id\n   204→    Purpose: ASB case management with escalation pipeline\n   205→    Features:\n   206→    - 12 ASB cases with severity indicators\n   207→    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n   208→    - Evidence log with timestamps and categories\n   209→    - Live Crime Context (Police.uk data correlation)\n   210→    - ASB hotspot analysis per estate\n   211→    - ASB escalation prediction (AI)\n   212→    - Witness/victim support tracking\n   213→    - Community Trigger threshold monitoring\n   214→    - Multi-agency panel and referral forms\n   215→\n   216→2.9 Rent & Arrears\n   217→    Route: /rent\n   218→    Purpose: Rent management and arrears recovery\n   219→    Features:\n   220→    - Arrears dashboard with band analysis\n   221→    - Pre-Action Protocol (PAP) checklist\n   222→    - Arrears worklist with AI-prioritised scoring (1-100)\n   223→    - Universal Credit tracking and verification\n   224→    - Payment arrangement management\n   225→    - Direct debit integration (GoCardless mock)\n   226→    - HB/UC transition tracking\n   227→    - Arrears risk prediction (AI)\n   228→    - 12-month payment trend analysis\n   229→    - Collection rate gauge, payment method breakdown\n   230→\n   231→2.10 Allocations & Lettings\n   232→    Route: /allocations\n   233→    Purpose: Void management and lettings workflow\n   234→    Features:\n   235→    - Housing register management (Band A-D, bedroom need, medical priority)\n   236→    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n   237→      -> Ready -> Offer -> Let\n   238→    - Void duration prediction (AI)\n   239→    - Days void RAG indicators (green <14, amber 14-28, red >28)\n   240→    - Applicant shortlisting and matching\n   241→    - Viewing booking system\n   242→    - Tenancy sign-up workflow\n   243→    - CORE lettings/sales reporting\n   244→\n   245→2.11 Communications\n   246→    Route: /communications\n   247→    Purpose: Unified multi-channel inbox\n   248→    Features:\n   249→    - Unified inbox (email, SMS, letter, portal message)\n   250→    - GOV.UK Notify template integration (24 templates, 7 categories)\n   251→    - Template rendering with ((field)) personalisation\n   252→    - Message history per tenant\n   253→    - Bulk communications\n   254→    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n   255→    - AI triage: auto-categorise, priority, sentiment, suggested response\n   256→    - Tone options: Supportive / Formal / Urgent / Legally required\n   257→\n   258→2.12 Reports & Analytics\n   259→    Route: /reports, /reports/:type, /reports/tsm\n   260→    Purpose: Regulatory reporting and operational analytics\n   261→    Features:\n   262→    - 27 regulatory reports\n   263→    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n   264→    - CORE lettings and sales returns\n   265→    - Consumer Standards compliance scorecard\n   266→    - Housing Ombudsman reporting\n   267→    - Building Safety Act compliance reporting\n   268→    - Dynamic report builder with filters\n   269→    - CSV/PDF export capability\n   270→    - Trend charts, sector median/quartile benchmarking\n   271→    - AI-generated narrative summary per report\n   272→    Report Categories:\n   273→    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n   274→    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n   275→    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n   276→      EPC/Energy\n   277→    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n   278→      void loss\n   279→    - Governance: Board pack, risk register, H&S summary\n   280→    - Tenant-facing: Annual report, estate reports\n   281→\n   282→2.13 AI Centre\n   283→    Route: /ai-centre\n   284→    Purpose: AI capabilities hub and differentiator showcase\n   285→    Features:\n   286→    - Insights tab: AI-generated operational insights with confidence %,\n   287→      affected entities, action buttons\n   288→    - Predictions tab: 8 predictive models dashboard with scatter plots,\n   289→      top-50 table, feature importance, accuracy gauges\n   290→    - Differentiators tab: 7 killer differentiator feature cards with\n   291→      vulnerability scan\n   292→    - Assistant tab: Conversational AI interface (Yantra Assist)\n   293→\n   294→2.14 AI Morning Briefing\n   295→    Route: /briefing\n   296→    Purpose: Personalised daily operational briefing\n   297→    Features:\n   298→    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n   299→      attention today\")\n   300→    - Weather forecast with property impact assessment\n   301→    - Today's tasks with priority indicators and action buttons\n   302→    - AI predictions and alerts\n   303→    - Estate-level neighbourhood briefing accordion\n   304→    - Compliance section with Big 6 stats\n   305→    - [Start my day ->] and [Skip briefing] buttons\n   306→\n   307→2.15 Admin System\n   308→    Route: /admin, /admin/integrations\n   309→    Purpose: System configuration and management\n   310→    Features:\n   311→    - Organisation profile and branding\n   312→    - User management with RBAC (10 default roles x permission matrix)\n   313→    - Team and patch management with caseload balancing\n   314→    - Workflow engine (visual builder with triggers/conditions/actions)\n   315→    - Integration hub (20 integrations across 3 tiers)\n   316→    - Integration toggle, test connection, status monitoring\n   317→    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n   318→      old/new value, IP)\n   319→    - GDPR tools (SAR processor, right to erasure, retention policies,\n   320→      consent management, Data Processing Register)\n   321→    - System reference data configuration (editable lookup tables)\n   322→    - Notification configuration\n   323→    - AI model configuration (toggle on/off, confidence thresholds)\n   324→    - White-label: multi-HA deployment support\n   325→\n   326→2.16 Tenant Portal\n   327→    Route: /tenant-portal\n   328→    Purpose: Tenant self-service interface\n   329→    Features:\n   330→    - Distinct lighter/warmer UI theme (visually separate from staff system)\n   331→    - Report repair (conversational wizard: room -> problem -> photo ->\n   332→      appointment -> confirm)\n   333→    - Check rent balance and make payment\n   334→    - View active repairs with photos and status\n   335→    - Quick message to housing officer\n   336→    - Document access\n   337→    - Larger text, no jargon, large touch targets\n   338→\n   339→2.17 Global Search\n   340→    Route: /search\n   341→    Purpose: Cross-entity full-text search\n   342→    Features:\n   343→    - Global search bar in header\n   344→    - Searches across tenants, properties, cases, communications\n   345→    - Results grouped by entity type\n   346→    - Direct navigation to entity detail\n   347→\n   348→\n   349→3. PERSONA SYSTEM\n   350→================================================================================\n   351→\n   352→3.1 Overview\n   353→    5 operational personas with scoped data visibility and dashboard layout.\n   354→    Persona selection via sidebar switcher. Persisted per session.\n   355→\n   356→3.2 Persona Definitions\n   357→\n   358→    PERSONA 1: Chief Operating Officer (COO)\n   359→    Scope: Organisation-wide\n   360→    Dashboard: High-level KPIs, financial summary, compliance overview,\n   361→              risk heatmap\n   362→    Access: Full read/write, admin settings, reports\n   363→    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n   364→              financial performance, TSM trajectory\n   365→    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n   366→                \"Benchmark against sector\"\n   367→\n   368→    PERSONA 2: Head of Housing\n   369→    Scope: Regional (multiple Local Authorities)\n   370→    Dashboard: Regional performance, team metrics, escalated cases\n   371→    Access: Team management, regional reports, case oversight\n   372→    AI Focus: Operational — SLA performance, team capacity, complaint trends\n   373→    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n   374→\n   375→    PERSONA 3: Housing Manager\n   376→    Scope: Estate/Block level\n   377→    Dashboard: Estate KPIs, staff workload, compliance deadlines\n   378→    Access: Case assignment, approval workflows, local reports\n   379→    AI Focus: Team management — workload, case overdue, skill gaps\n   380→    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n   381→\n   382→    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n   383→    Scope: Assigned patch (specific estates/blocks)\n   384→    Dashboard: Caseload worklist, today's visits, tenant alerts\n   385→    Access: Case CRUD, tenant interactions, notes\n   386→    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n   387→    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n   388→                referral generators, communication drafters on every page\n   389→\n   390→    PERSONA 5: Repairs Operative\n   391→    Scope: Assigned jobs\n   392→    Dashboard: Today's job list, materials, access notes\n   393→    Access: Repair status updates, photos, completion notes\n   394→    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n   395→    No access to: Financial data, personal tenant details beyond job needs\n   396→\n   397→\n   398→4. AI-NATIVE FEATURES\n   399→================================================================================\n   400→\n   401→4.1 Core Principle: Dynamic AI Interface Elements\n   402→    Every entity page has TWO zones:\n   403→    1. Standard zone: Fixed fields, tabs, buttons — always present\n   404→    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n   405→       change based on context\n   406→\n   407→    Dynamic elements include:\n   408→    - Dynamic action buttons — only appear when AI determines they're relevant\n   409→    - Dynamic info cards — contextual information the system thinks user needs\n   410→    - Dynamic prompts — questions AI asks user, answering triggers workflows\n   411→    - Dynamic warnings — alerts about this entity needing attention\n   412→    - Dynamic information fields — calculated data not in standard layout\n   413→\n   414→    Styling: Purple left border (--status-ai), --surface-elevated background,\n   415→    \"*\" symbol prefix on AI-generated content\n   416→\n   417→4.2 The AI Action Flow Pattern\n   418→    Every AI dynamic button follows this pattern:\n   419→    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n   420→    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n   421→    3. EDIT: User can edit anything in the preview\n   422→    4. CONFIRM: User approves the action\n   423→    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n   424→    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n   425→    7. LEARN: System records accept/modify/reject for model improvement\n   426→\n   427→4.3 Yantra Assist\n   428→    Location: Bottom-left floating trigger (all pages)\n   429→    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n   430→    Panel: 400px, slides from left, overlaying sidebar\n   431→    Content changes based on current page/entity AND user persona\n   432→\n   433→    Panel Structure:\n   434→    - RED URGENT: Items needing immediate action\n   435→    - ORANGE ATTENTION: Items approaching deadlines\n   436→    - INSIGHTS: AI predictions & recommendations\n   437→    - BRIEFING: Contextual summary & key stats\n   438→    - EXTERNAL FACTORS: Weather, UC changes, local context\n   439→    - [Ask Yantra...] chat input at bottom\n   440→\n   441→    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n   442→\n   443→4.4 Prediction Models (8 total)\n   444→    MODEL 1: Arrears Risk\n   445→      Input: Payment history, UC status, seasonal patterns, life events\n   446→      Output: Risk score (0-100), predicted arrears amount, recommended actions\n   447→\n   448→    MODEL 2: Damp & Mould Risk\n   449→      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n   450→             IoT sensors (0.20), occupancy (0.10)\n   451→      Output: Risk score (0-100), factor breakdown, proactive recommendations\n   452→\n   453→    MODEL 3: Complaint Escalation\n   454→      Input: Response times, complaint category, tenant history, complexity\n   455→      Output: Escalation probability, recommended priority, deadline warnings\n   456→\n   457→    MODEL 4: Void Duration\n   458→      Input: Property type, condition, location, market demand, works needed\n   459→      Output: Predicted void days, optimal marketing strategy\n   460→\n   461→    MODEL 5: Repair Recurrence\n   462→      Input: Component age, repair history, building type, contractor quality\n   463→      Output: Recurrence probability, recommended planned maintenance\n   464→\n   465→    MODEL 6: Vulnerability Detection\n   466→      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n   467→             social isolation (0.15), age risk (0.10), dependents (0.10),\n   468→             UC transition (0.10)\n   469→      Output: Vulnerability score (0-100), detected flags, recommended support\n   470→\n   471→    MODEL 7: ASB Escalation\n   472→      Input: Case history, estate context, crime data, tenant profile\n   473→      Output: Escalation risk, recommended intervention level\n   474→\n   475→    MODEL 8: Compliance Failure\n   476→      Input: Certificate expiry, contractor availability, building complexity\n   477→      Output: Failure probability, priority scheduling recommendations\n   478→\n   479→4.5 Seven Killer Differentiators (All Implemented)\n   480→    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n   481→        Service: server/src/services/damp-prediction.ts\n   482→        Frontend: DampIntelligencePanel component on property detail\n   483→\n   484→    D2: Live Crime Context for ASB — Police.uk data correlation\n   485→        Service: server/src/services/crime-context.ts\n   486→        Frontend: Crime data layer on Explore map, ASB detail page\n   487→\n   488→    D3: Automatic Vulnerability Detection — 7-factor scoring\n   489→        Service: server/src/services/vulnerability-detection.ts\n   490→        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n   491→\n   492→    D4: Property Passport — Multi-source property dossier\n   493→        Service: server/src/services/property-passport.ts\n   494→        Frontend: Property detail page aggregation\n   495→\n   496→    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n   497→        Service: server/src/services/benefits-engine.ts\n   498→        Frontend: BenefitsPanel on tenancy detail\n   499→\n   500→    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n   501→        Service: server/src/services/neighbourhood-briefing.ts\n   502→        Frontend: NeighbourhoodBriefingPanel on briefing page\n   503→\n   504→    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n   505→        Service: server/src/services/mock-services.ts\n   506→        Frontend: Property detail page (sensor data display)\n   507→\n   508→4.6 AI-Augmented Workflows\n   509→    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n   510→      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n   511→      checks recurring pattern, estimates cost, flags Awaab's Law\n   512→    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n   513→      suggests appropriate case type, pre-fills forms\n   514→    - Communication Sending: AI generates drafts using correct templates,\n   515→      tenant details, plain English, legally required wording, tone options\n   516→    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n   517→      contractor instructions, pre-booked appointments\n   518→    - Complaint Prevention: AI detects patterns (multiple calls, declining\n   519→      satisfaction), generates prevention plan\n   520→\n   521→4.7 Signature AI Interactions\n   522→    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n   523→    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n   524→    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n   525→       -> preventive advice letters -> inspection tasks\n   526→    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n   527→    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n   528→\n   529→\n   530→5. DATA MODEL (SUMMARY)\n   531→================================================================================\n   532→\n   533→5.1 Core Entities\n   534→    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n   535→    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n   536→    - Tenancy — property-tenant link, start date, type, rent, balance\n   537→    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n   538→    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n   539→    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n   540→    - ASB (12 records) — severity, escalation level, evidence log\n   541→    - Activity — timeline events for any entity\n   542→    - Task — assigned work items with due dates\n   543→\n   544→5.2 Supporting Entities\n   545→    - Organisation — RCHA metadata, branding, settings\n   546→    - Region (5 seeded) — London, South, Midlands, etc.\n   547→    - Local Authority — Southwark, Lewisham, Lambeth\n   548→    - Estate (5) — name, location, block count, manager\n   549→    - Block (8) — floors, cores, unit count\n   550→    - User — auth profile, role, persona, team\n   551→    - Team — name, manager, patch, members\n   552→    - Integration — external service config (20 integrations)\n   553→    - Report — template definitions (27 reports)\n   554→    - ExternalDataCache — TTL-based cache for API responses\n   555→\n   556→5.3 Firestore Collections (17+)\n   557→    organisations, regions, localAuthorities, estates, blocks,\n   558→    properties, tenants, cases, activities, communications,\n   559→    rentTransactions, users, auditLog, notifications,\n   560→    voidProperties, applicants, tsmMeasures, externalDataCache,\n   561→    hactCodes, imdData\n   562→\n   563→5.4 Case Reference Formats\n   564→    | Type        | Format           | Colour  |\n   565→    |-------------|------------------|---------|\n   566→    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n   567→    | Repair      | REP-YYYY-XXXXX   | Blue    |\n   568→    | ASB         | ASB-YYYY-XXXXX   | Red     |\n   569→    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n   570→    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n   571→    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n   572→    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n   573→\n   574→5.5 TypeScript Type System (721 lines)\n   575→    Frontend types defined in app/src/types/index.ts covering:\n   576→    - 6 persona/user types (Persona, User)\n   577→    - 7 geography types (Region, LocalAuthority, Estate, Block)\n   578→    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n   579→    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n   580→    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n   581→    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n   582→    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n   583→    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n   584→    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n   585→    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n   586→\n   587→\n   588→6. USER INTERFACE DESIGN\n   589→================================================================================\n   590→\n   591→6.1 Theme\n   592→    Brand: Yantra Works dark theme\n   593→    Primary Background: --surface-dark (#0D1117)\n   594→    Card Background: --surface-card (#151B23)\n   595→    Elevated: --surface-elevated (#1C2333)\n   596→    Hover: --surface-hover (#222D3D)\n   597→    Accent: --brand-teal (#058995)\n   598→    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n   599→    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n   600→    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n   601→\n   602→6.2 Typography\n   603→    Headings: \"Space Grotesk\", sans-serif — bold, technical\n   604→    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n   605→    Monospace: \"JetBrains Mono\", monospace — references, codes\n   606→    Headings in --brand-peach on dark backgrounds\n   607→    Section labels: --brand-teal, uppercase, letter-spaced\n   608→\n   609→6.3 Layout\n   610→    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n   611→    - Top header with logo, global search, notifications, AI trigger, user menu\n   612→    - Breadcrumb navigation reflecting hierarchy\n   613→    - Main content area with responsive grid (max 1400px)\n   614→    - Yantra Assist floating panel (bottom-left)\n   615→    - Phase banner: garnet \"BETA\" tag\n   616→\n   617→6.4 Navigation Items (Sidebar)\n   618→    NAVIGATE: Explore, Dashboard\n   619→    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n   620→            Complaints, Allocations, ASB\n   621→    COMMUNICATE: Communications\n   622→    ANALYSE: Reports, AI Centre\n   623→    SYSTEM: Admin, Settings\n   624→    + Persona Switcher\n   625→\n   626→6.5 Design Principles\n   627→    - Dark mode is default — Yantra Works brand palette throughout\n   628→    - Mobile-aware responsive design\n   629→    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n   630→    - Skip-to-content link\n   631→    - Reduced-motion support (@media prefers-reduced-motion)\n   632→    - Focus-visible outlines on all interactive elements\n   633→    - Screen-reader-only (.sr-only) text for context\n   634→    - Animations throughout — staggered reveals, sliding panels, smooth\n   635→      transitions, pulsing alerts. UI must feel ALIVE, not static.\n   636→    - UK conventions: DD/MM/YYYY, British English, GBP\n   637→\n   638→6.6 Component Library (16 shared components)\n   639→    - KpiCard — metric display with trend sparkline\n   640→    - StatusPill — status badge (green/amber/red)\n   641→    - ActionModal — accessible form modal with focus trap, Escape handler,\n   642→      aria attributes, form validation, previous focus restoration\n   643→    - AiActionCard — purple-bordered AI suggestion card\n   644→    - CountdownTimer — deadline countdown with color urgency transitions\n   645→      (green -> peach -> garnet -> pulsing garnet)\n   646→    - PropertyMap — Leaflet map with markers\n   647→    - HelpDrawer — full-screen contextual help (20 topics)\n   648→    - DampIntelligencePanel — damp risk factor display with score badge\n   649→    - VulnerabilityPanel — 7-factor vulnerability assessment\n   650→    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n   651→    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n   652→    - ProtectedRoute — Firebase auth guard component\n   653→    - YantraAssist — slide-in panel (320px from right) with context-aware\n   654→      content, chat interface, urgency sections\n   655→\n   656→\n   657→7. REGULATORY COMPLIANCE\n   658→================================================================================\n   659→\n   660→7.1 Housing Regulations Supported\n   661→    - Housing Ombudsman Complaint Handling Code (2024)\n   662→    - Awaab's Law (Social Housing Regulation Act 2023)\n   663→    - Building Safety Act 2022\n   664→    - Regulator of Social Housing (RSH) Consumer Standards\n   665→    - Tenant Satisfaction Measures (TSM) Standard\n   666→    - CORE lettings and sales data collection\n   667→    - Gas Safety (Installation and Use) Regulations 1998\n   668→    - Electrical Safety Standards in the Private Rented Sector\n   669→    - Regulatory Reform (Fire Safety) Order 2005\n   670→    - Control of Asbestos Regulations 2012\n   671→    - Legionella risk assessment (HSE ACoP L8)\n   672→    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n   673→\n   674→7.2 GDPR Compliance\n   675→    - Full audit trail on all data operations\n   676→    - Subject Access Request (SAR) processor\n   677→    - Right to erasure workflow\n   678→    - Data retention policy configuration\n   679→    - Consent management\n   680→    - Data Processing Register\n   681→\n   682→7.3 Accessibility (WCAG AA)\n   683→    - Focus traps in modals (ActionModal)\n   684→    - Skip-to-content link (Layout component)\n   685→    - Keyboard navigation (Tab, Escape)\n   686→    - ARIA labels, roles, described-by\n   687→    - Reduced-motion media query\n   688→    - Color contrast ratio >= 4.5:1\n   689→    - Screen-reader-only text (.sr-only)\n   690→    - Focus-visible outlines (*:focus-visible)\n   691→\n   692→\n   693→8. NON-FUNCTIONAL REQUIREMENTS\n   694→================================================================================\n   695→\n   696→8.1 Performance\n   697→    - API response time (P95): < 500ms (current ~200-300ms)\n   698→    - Frontend bundle size: < 3MB (current ~2.5MB)\n   699→    - Cloud Run cold start: < 3s (current < 2s)\n   700→    - Firestore query latency: < 200ms\n   701→    - AI response latency (target): < 3s for conversational queries\n   702→\n   703→8.2 Security\n   704→    - Firebase Authentication with Google sign-in\n   705→    - RBAC with 10 default roles (super-admin through read-only)\n   706→    - CSP headers with whitelist\n   707→    - CORS restricted to allowed origins\n   708→    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   709→    - Security headers (Permissions-Policy, X-Content-Type-Options,\n   710→      X-Frame-Options, Referrer-Policy, HSTS)\n   711→    - Secret Manager for all credentials (no secrets in code)\n   712→    - JSON body limit 1MB\n   713→    - Request correlation via X-Request-ID\n   714→\n   715→8.3 Scalability\n   716→    - Cloud Run: 0-10 instances (auto-scaling)\n   717→    - Firestore: NoSQL, horizontally scalable\n   718→    - External API caching reduces load\n   719→    - Concurrency: 80 requests/instance\n   720→\n   721→8.4 Availability\n   722→    - Cloud Run SLA: 99.95%\n   723→    - External API fallbacks (simulated data on failure)\n   724→    - Health check with Firestore connectivity monitoring\n   725→    - States: healthy / degraded / unhealthy\n   726→\n   727→8.5 Testing\n   728→    - Selenium E2E: 331 tests, 99.7% pass rate\n   729→    - Unit tests: 66 tests for public data APIs\n   730→    - TypeScript: 0 errors (strict mode)\n   731→    - Vite build: 0 critical warnings\n   732→\n   733→\n   734→9. SIMULATED DATA\n   735→================================================================================\n   736→\n   737→9.1 Scale\n   738→    75 properties, 68 active tenancies, 5 voids\n   739→    Realistic SE London postcodes, 12-digit UPRNs\n   740→    Diverse tenant names reflecting London demographics\n   741→\n   742→9.2 Financial Profile\n   743→    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n   744→    Service charges: GBP 5-35/week\n   745→    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n   746→    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n   747→\n   748→9.3 Cases\n   749→    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n   750→    34 open complaints (28 Stage 1, 6 Stage 2)\n   751→    12 ASB cases\n   752→    8 damp/mould cases (3 emergency, 5 significant)\n   753→    25 financial cases\n   754→    5 voids at various pipeline stages\n   755→\n   756→9.4 Compliance\n   757→    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n   758→    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n   759→\n   760→\n   761→10. CURRENT STATUS & METRICS\n   762→================================================================================\n   763→\n   764→10.1 Production Deployment\n   765→    URL: https://socialhomes-587984201316.europe-west2.run.app\n   766→    Region: europe-west2 (London)\n   767→    Status: LIVE and operational\n   768→    Database: 460+ documents across 17+ Firestore collections\n   769→\n   770→10.2 Build Metrics\n   771→    | Metric                    | Value           |\n   772→    |---------------------------|-----------------|\n   773→    | Frontend modules          | 3,397           |\n   774→    | Frontend build time       | ~35-39 seconds  |\n   775→    | Backend TypeScript errors | 0               |\n   776→    | Frontend TypeScript errors| 0               |\n   777→    | Selenium tests            | 331             |\n   778→    | Selenium pass rate        | 99.7%           |\n   779→    | Unit tests (public data)  | 66              |\n   780→    | Firestore collections     | 17+             |\n   781→    | Seeded properties         | 75              |\n   782→    | Seeded tenants            | 68              |\n   783→    | Seeded cases              | 279+            |\n   784→    | API endpoints             | 50+             |\n   785→    | Frontend routes           | 40+             |\n   786→    | Lines of code             | ~24,000         |\n   787→    | Frontend TypeScript files | 73              |\n   788→    | Backend TypeScript files  | 43              |\n   789→    | Type definitions          | 721 lines       |\n   790→\n   791→10.3 Phase Completion\n   792→    Phase 0: Infrastructure        — DONE (10/10)\n   793→    Phase 1: Foundation            — DONE (12/12)\n   794→    Phase 2: Intelligence          — DONE (14/14)\n   795→    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n   796→    Phase 4: Completion            — DONE (11/14, 3 deferred)\n   797→    Phase 5: Evolution             — TODO (0/44)\n   798→\n   799→================================================================================\n   800→  End of Doc1 — SocialHomes.Ai Base Specification\n   801→  Yantra Works | 2026-02-25\n   802→================================================================================\n   803→"}]},"uuid":"8ef3192b-7791-484d-b41e-7413f7bf0ef3","timestamp":"2026-02-25T19:28:29.980Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/44)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n","numLines":803,"startLine":1,"totalLines":803}},"sourceToolAssistantUUID":"f86a82f3-877f-4695-80d3-eb5049f6c435"}
{"parentUuid":"8ef3192b-7791-484d-b41e-7413f7bf0ef3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Dqnqxkz2mzcJkUbjr1aLvq","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"a1824b5a-aaf6-4b77-a2c7-5ff1c47764b8","timestamp":"2026-02-25T19:28:30.449Z"}
{"parentUuid":"a1824b5a-aaf6-4b77-a2c7-5ff1c47764b8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013VZ2dPXogBuVSHyB26gZnY","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"17c18d8a-da2f-4c2e-b39b-fb7ff8ea856d","timestamp":"2026-02-25T19:28:30.639Z"}
{"parentUuid":"a1824b5a-aaf6-4b77-a2c7-5ff1c47764b8","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Dqnqxkz2mzcJkUbjr1aLvq","type":"tool_result","content":"     1→================================================================================\n     2→  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n     3→  Version: 5.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. SYSTEM ARCHITECTURE OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 Architecture Style\n    11→    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    12→    deployed as a single container on Google Cloud Run. The Express server\n    13→    serves both the API and the built React static assets.\n    14→\n    15→1.2 High-Level Architecture Diagram (ASCII)\n    16→\n    17→    +-------------------------------------------------------------+\n    18→    |                        CLOUD RUN (europe-west2)              |\n    19→    |  +-----------------------------------------------------------+\n    20→    |  |                    Express.js Server                      |\n    21→    |  |  +--------------+  +--------------+  +---------------+   |\n    22→    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    23→    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    24→    |  |  |              |  |              |  | Rate Limit/   |   |\n    25→    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    26→    |  |  | Output       |  | modules      |  |               |   |\n    27→    |  |  +--------------+  +------+-------+  +---------------+   |\n    28→    |  +---------------------------+-------------------------------+\n    29→    |                              |                                |\n    30→    |  +---------------------------+-------------------------------+\n    31→    |  |                    Service Layer (25 modules)             |\n    32→    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    33→    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    34→    |  |  | Services| | API      | | Notify   | | Services    |   |\n    35→    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    36→    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    37→    |  +---------------------------+-------------------------------+\n    38→    +------------------------------+--------------------------------+\n    39→                                   |\n    40→              +--------------------+--------------------+\n    41→              |                    |                     |\n    42→    +---------v------+  +---------v------+  +----------v-----+\n    43→    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    44→    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    45→    +----------------+  +----------------+  +----------------+\n    46→              |\n    47→    +---------v--------------------------------------------+\n    48→    |              External APIs (3 Tiers)                 |\n    49→    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    50→    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    51→    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    52→    +------------------------------------------------------+\n    53→\n    54→1.3 Request Flow Diagram\n    55→\n    56→    Browser -> React SPA -> api-client.ts -> HTTP Request\n    57→                                              |\n    58→                                              v\n    59→    Express Server <- Middleware Pipeline <- Route Handler\n    60→         |               |\n    61→         |     +-------------------------------------------+\n    62→         |     | Morgan -> Helmet -> CORS -> Compression   |\n    63→         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n    64→         |     | -> Rate Limiter -> Metrics -> Handler     |\n    65→         |     | -> Error Handler -> Response               |\n    66→         |     +-------------------------------------------+\n    67→         |\n    68→         +---> Firestore (read/write)\n    69→         +---> External API Proxy (with cache)\n    70→         +---> AI Service (computation)\n    71→\n    72→\n    73→2. TECHNOLOGY STACK\n    74→================================================================================\n    75→\n    76→2.1 Frontend Stack\n    77→\n    78→    | Component          | Technology              | Version    |\n    79→    |--------------------|-------------------------|------------|\n    80→    | Framework          | React                   | 19.2.0     |\n    81→    | Language           | TypeScript              | 5.9.3      |\n    82→    | Router             | React Router            | v7         |\n    83→    | Styling            | Tailwind CSS            | 4.1.18     |\n    84→    | State Management   | React Context + Hooks   | --         |\n    85→    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    86→    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    87→    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    88→    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    89→    | Icons              | Lucide React            | 0.563.0    |\n    90→    | Auth UI            | FirebaseUI              | latest     |\n    91→    | Build Tool         | Vite                    | 7.2.4      |\n    92→\n    93→2.2 Backend Stack\n    94→\n    95→    | Component          | Technology              | Version    |\n    96→    |--------------------|-------------------------|------------|\n    97→    | Framework          | Express.js              | 4.21.2     |\n    98→    | Language           | TypeScript              | 5.7.0      |\n    99→    | Runtime            | Node.js                 | 20.17.0    |\n   100→    | Database           | Google Firestore        | Native     |\n   101→    | Auth               | Firebase Admin SDK      | 13.6.1     |\n   102→    | Security           | Helmet                  | 8.1.0      |\n   103→    | CORS               | cors                    | 2.8.5      |\n   104→    | Logging            | Morgan                  | 1.10.0     |\n   105→    | Compression        | compression             | 1.8.0      |\n   106→    | Testing            | Vitest                  | 4.0.18     |\n   107→    | Build              | tsc + tsx                | latest     |\n   108→\n   109→2.3 Infrastructure\n   110→\n   111→    | Component          | Technology              | Details              |\n   112→    |--------------------|-------------------------|----------------------|\n   113→    | Hosting            | Google Cloud Run        | europe-west2         |\n   114→    | Container Registry | Artifact Registry       | europe-west2         |\n   115→    | Database           | Google Firestore        | Native mode          |\n   116→    | Authentication     | Firebase Auth           | Google SSO + email   |\n   117→    | Secrets            | Secret Manager          | 4 secrets            |\n   118→    | CI/CD              | Cloud Build             | Auto on git push     |\n   119→    | Source Control     | GitHub                  | rajivpeter repo      |\n   120→    | Monitoring         | Custom metrics + health | In-app               |\n   121→    | Session Capture    | Entire.io               | Manual commit        |\n   122→\n   123→2.4 Testing Stack\n   124→\n   125→    | Component          | Technology              | Coverage             |\n   126→    |--------------------|-------------------------|----------------------|\n   127→    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n   128→    | Unit               | Vitest                  | 66 tests             |\n   129→    | Type Checking      | TypeScript (strict)     | 0 errors             |\n   130→\n   131→\n   132→3. FRONTEND ARCHITECTURE\n   133→================================================================================\n   134→\n   135→3.1 Directory Structure\n   136→\n   137→    app/src/\n   138→    +-- App.tsx                  -- Router with 40+ routes\n   139→    +-- main.tsx                 -- React DOM entry point (QueryClient)\n   140→    +-- index.css                -- Global styles, animations, accessibility\n   141→    |\n   142→    +-- pages/                   -- 19 page directories\n   143→    |   +-- admin/               -- AdminPage, IntegrationsPage\n   144→    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n   145→    |   +-- allocations/         -- AllocationsPage\n   146→    |   +-- asb/                 -- AsbPage, AsbDetailPage\n   147→    |   +-- auth/                -- LoginPage (Firebase + Google)\n   148→    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n   149→    |   +-- communications/      -- CommunicationsPage\n   150→    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n   151→    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n   152→    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n   153→    |   +-- explore/             -- ExplorePage (7-level drill-down)\n   154→    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n   155→    |   |                          ApplicationPage, ViewingBookingPage\n   156→    |   +-- rent/                -- RentPage\n   157→    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n   158→    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n   159→    |   +-- search/              -- SearchPage\n   160→    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n   161→    |   +-- tenant-portal/       -- TenantPortalPage\n   162→    |   +-- shared/              -- ComingSoonPage\n   163→    |\n   164→    +-- components/\n   165→    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n   166→    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n   167→    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n   168→    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n   169→    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n   170→    |\n   171→    +-- data/                    -- Mock/seed data (10 files)\n   172→    +-- hooks/                   -- Custom hooks (3 files)\n   173→    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n   174→    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n   175→    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n   176→    +-- types/                   -- TypeScript definitions (721 lines)\n   177→    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n   178→    |                              public data helpers\n   179→    +-- contexts/                -- AuthContext, AppContext\n   180→    +-- utils/                   -- Formatting utilities (safeText, etc.)\n   181→    +-- assets/                  -- Images, fonts\n   182→\n   183→3.2 Routing Architecture (React Router v7)\n   184→    All routes defined in App.tsx within BrowserRouter.\n   185→    Routes wrapped in Layout component (sidebar + header).\n   186→    Protected routes use ProtectedRoute component (Firebase auth guard).\n   187→\n   188→    Key Route Groups:\n   189→    /                            -> Redirect to /dashboard\n   190→    /login                       -> LoginPage (public)\n   191→    /dashboard                   -> DashboardPage\n   192→    /explore                     -> ExplorePage\n   193→    /tenancies                   -> TenanciesPage\n   194→    /tenancies/:id               -> TenancyDetailPage\n   195→    /properties                  -> PropertiesPage\n   196→    /properties/:id              -> PropertyDetailPage\n   197→    /properties/:id/apply        -> ApplicationPage\n   198→    /properties/:id/book-viewing -> ViewingBookingPage\n   199→    /repairs                     -> RepairsPage\n   200→    /repairs/:id                 -> RepairDetailPage\n   201→    /compliance                  -> CompliancePage\n   202→    /compliance/:type            -> ComplianceTypePage\n   203→    /compliance/awaabs-law       -> AwaabsLawPage\n   204→    /complaints                  -> ComplaintsPage\n   205→    /complaints/:id              -> ComplaintDetailPage\n   206→    /asb                         -> AsbPage\n   207→    /asb/:id                     -> AsbDetailPage\n   208→    /rent                        -> RentPage\n   209→    /allocations                 -> AllocationsPage\n   210→    /communications              -> CommunicationsPage\n   211→    /reports                     -> ReportsPage\n   212→    /reports/:type               -> DynamicReportPage\n   213→    /reports/tsm                 -> TsmReportPage\n   214→    /ai-centre                   -> AiCentrePage\n   215→    /briefing                    -> BriefingPage\n   216→    /admin                       -> AdminPage\n   217→    /admin/integrations          -> IntegrationsPage\n   218→    /tenant-portal               -> TenantPortalPage\n   219→    /search                      -> SearchPage\n   220→\n   221→3.3 State Management\n   222→    - React Context for global state (auth user, persona)\n   223→    - @tanstack/react-query for server state (API caching, 5-min stale time)\n   224→    - Local component state (useState, useReducer) for UI state\n   225→    - No Redux/Zustand — kept deliberately simple\n   226→\n   227→3.4 Data Fetching Layer\n   228→    - api-client.ts: 70+ typed API methods organized by domain\n   229→    - useApi.ts: React Query hooks wrapping api-client methods\n   230→    - useEntityIntelligence.ts: AI scoring hooks\n   231→    - usePersonaScope.ts: Persona-based data filtering\n   232→    - Timestamp sanitization in api-client to handle Firestore timestamps\n   233→\n   234→3.5 Frontend Conventions\n   235→    - safeText() helper for rendering potentially undefined values\n   236→    - ?? [] for nullable arrays (prevents React Error #310)\n   237→    - Tailwind CSS utility classes (no CSS modules)\n   238→    - Lucide React for all icons\n   239→    - Purple border for AI-generated elements\n   240→    - Consistent page structure: header + filter bar + content grid\n   241→    - ErrorBoundary wrapping for error resilience\n   242→\n   243→3.6 Accessibility Implementation\n   244→    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n   245→      aria-modal, aria-labelledby, aria-describedby, focus restoration\n   246→    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n   247→      .sr-only class, .skip-to-content link, .field-error styles\n   248→    - Layout: skip-to-content link + id=\"main-content\" on <main>\n   249→    - Sidebar: aria-label on <nav> and collapse button\n   250→    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n   251→\n   252→\n   253→4. BACKEND ARCHITECTURE\n   254→================================================================================\n   255→\n   256→4.1 Directory Structure\n   257→\n   258→    server/src/\n   259→    +-- index.ts                 -- Express entry, middleware, route registration\n   260→    |\n   261→    +-- middleware/               -- 5 middleware modules\n   262→    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n   263→    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n   264→    |   +-- metrics.ts           -- Request/response metrics recording\n   265→    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n   266→    |   +-- rbac.ts              -- Role-based access control\n   267→    |\n   268→    +-- routes/                  -- 16 route modules (2,300+ lines)\n   269→    |   +-- admin.ts             -- Integration management, monitoring\n   270→    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n   271→    |   +-- auth.ts              -- Login, register, logout\n   272→    |   +-- briefing.ts          -- Personalised morning briefing\n   273→    |   +-- booking.ts           -- Viewing bookings, applications\n   274→    |   +-- cases.ts             -- Unified case CRUD + pagination\n   275→    |   +-- compliance.ts        -- Big 6 compliance data\n   276→    |   +-- explore.ts           -- Hierarchy drill-down data\n   277→    |   +-- export.ts            -- CSV/PDF exports\n   278→    |   +-- lettings.ts          -- Void management, allocations\n   279→    |   +-- properties.ts        -- Property list/detail\n   280→    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n   281→    |   +-- rent.ts              -- Arrears, statements, transactions\n   282→    |   +-- reports.ts           -- 27 regulatory reports\n   283→    |   +-- tenants.ts           -- Tenant list/detail\n   284→    |\n   285→    +-- services/                -- 25 service modules\n   286→    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n   287→    |   +-- firestore.ts         -- Firestore connection + helpers\n   288→    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n   289→    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n   290→    |   +-- crime-context.ts     -- Police data correlation\n   291→    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n   292→    |   +-- benefits-engine.ts   -- UK benefit rules engine\n   293→    |   +-- property-passport.ts -- Multi-source aggregation\n   294→    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n   295→    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n   296→    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n   297→    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n   298→    |   +-- monitoring.ts        -- Metrics singleton\n   299→    |   +-- hact-export.ts       -- HACT reporting format\n   300→    |   +-- seed.ts              -- Database seeding\n   301→    |   +-- seed-data.ts         -- Seed data definitions\n   302→    |   +-- hact-codes.ts        -- SOR code definitions\n   303→    |\n   304→    +-- models/\n   305→    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n   306→    |   +-- hact-codes.ts        -- Repair code models\n   307→    |\n   308→    +-- scripts/\n   309→        +-- seed-imd.ts          -- IMD data loader\n   310→        +-- seed.ts              -- Main seed runner\n   311→\n   312→4.2 Middleware Pipeline (Request Flow)\n   313→\n   314→    Request -> Morgan Logger -> Helmet (CSP, security headers)\n   315→            -> CORS (restricted origins) -> Compression (gzip)\n   316→            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n   317→            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n   318→            -> Error Handler -> Response\n   319→\n   320→4.3 Rate Limiting (4 Tiers)\n   321→\n   322→    | Tier    | Routes              | Limit        | Window  |\n   323→    |---------|---------------------|--------------|---------|\n   324→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   325→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   326→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   327→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   328→\n   329→4.4 Error Handling\n   330→    - Structured JSON error responses: { error, message, statusCode }\n   331→    - No stack traces leaked in production\n   332→    - Error logging with request ID correlation (X-Request-ID)\n   333→    - Graceful degradation for external API failures\n   334→    - ErrorBoundary on frontend for component-level recovery\n   335→\n   336→4.5 Health Check\n   337→    GET /health -> { status, firestore, uptime, memory, timestamp }\n   338→    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n   339→    Memory: RSS, heap used, heap total\n   340→\n   341→\n   342→5. DATA MODELS (FIRESTORE)\n   343→================================================================================\n   344→\n   345→5.1 Collection Map (17+ Collections)\n   346→\n   347→    +------------------+     +------------------+     +------------------+\n   348→    |   organisations  |     |      users       |     |      teams       |\n   349→    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n   350→    +------------------+     +------------------+     +------------------+\n   351→                                    |\n   352→                                    v\n   353→    +------------------+     +------------------+     +------------------+\n   354→    |   properties     |<--->|     tenants      |<--->|      cases       |\n   355→    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n   356→    +--------+---------+     +------------------+     +--------+---------+\n   357→             |                                                 |\n   358→             v                                                 v\n   359→    +------------------+     +------------------+     +------------------+\n   360→    |   repairs        |     |   complaints     |     |       asb        |\n   361→    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n   362→    +------------------+     +------------------+     +------------------+\n   363→                                                              |\n   364→    +------------------+     +------------------+     +-------v----------+\n   365→    |   financial      |     |   damp-mould     |     |   activities     |\n   366→    |   (docs)         |     |   (docs)         |     |   (docs)         |\n   367→    +------------------+     +------------------+     +------------------+\n   368→\n   369→    +------------------+     +------------------+     +------------------+\n   370→    |   tasks          |     |  integrations    |     |    auditLog      |\n   371→    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n   372→    +------------------+     +------------------+     +------------------+\n   373→\n   374→    +----------------------+     +------------------+\n   375→    |  externalDataCache   |     |    imdData       |\n   376→    |  (TTL-based cache)   |     |   (LSOA docs)    |\n   377→    +----------------------+     +------------------+\n   378→\n   379→    Geography Hierarchy:\n   380→    +------------------+     +------------------+     +------------------+\n   381→    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n   382→    +------------------+     +------------------+     +--------+---------+\n   383→                                                               |\n   384→                                                      +--------v---------+\n   385→                                                      |    blocks (8)    |\n   386→                                                      +------------------+\n   387→\n   388→5.2 Property Schema\n   389→\n   390→    {\n   391→      id: string                    // Firestore document ID\n   392→      uprn: string                  // 12-digit UPRN\n   393→      address: {\n   394→        line1: string\n   395→        line2?: string\n   396→        town: string\n   397→        postcode: string            // Real SE London postcode\n   398→        lat: number\n   399→        lng: number\n   400→        lsoaCode: string            // LSOA for IMD/Census\n   401→      }\n   402→      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n   403→      bedrooms: number\n   404→      floor?: number\n   405→      floorArea?: number\n   406→      estateId: string\n   407→      blockId?: string\n   408→      regionId: string\n   409→      localAuthorityId: string\n   410→      buildYear: number\n   411→      heatingType: string\n   412→      wallType: string\n   413→      roofType: string\n   414→      epc: {\n   415→        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n   416→        score: number\n   417→        certificateNumber?: string\n   418→        expiryDate: string\n   419→      }\n   420→      compliance: {\n   421→        gasSafety: { status, expiryDate, certificateRef }\n   422→        electricalSafety: { status, expiryDate, certificateRef }\n   423→        fireRiskAssessment: { status, lastAssessmentDate }\n   424→        asbestos: { status, surveyDate }\n   425→        legionella: { status, assessmentDate }\n   426→        liftSafety?: { status, inspectionDate }\n   427→      }\n   428→      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n   429→      isVoid: boolean\n   430→      voidSince?: string\n   431→      currentTenancyId?: string\n   432→      tenantId?: string\n   433→      weeklyRent: number\n   434→      serviceCharge: number\n   435→      dampRisk?: number             // 0-100 computed score\n   436→      createdAt: timestamp\n   437→      updatedAt: timestamp\n   438→    }\n   439→\n   440→5.3 Tenant Schema\n   441→\n   442→    {\n   443→      id: string\n   444→      title: string\n   445→      firstName: string\n   446→      lastName: string\n   447→      dateOfBirth: string\n   448→      email: string\n   449→      phone: string\n   450→      mobile?: string\n   451→      nino?: string                 // National Insurance Number\n   452→      propertyId: string\n   453→      tenancyId: string\n   454→      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n   455→      tenancyStartDate: string\n   456→      tenancyStatus: string\n   457→      assignedOfficer: string\n   458→      rent: {\n   459→        weeklyAmount: number\n   460→        balance: number             // Negative = arrears\n   461→        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n   462→        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n   463→      }\n   464→      weeklyCharge: number\n   465→      rentBalance: number\n   466→      arrearsRisk: number           // 0-100 score\n   467→      household: [\n   468→        { name, relationship, dateOfBirth, isDependent }\n   469→      ]\n   470→      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n   471→      emergencyContact: {\n   472→        name: string\n   473→        phone: string\n   474→        relationship: string\n   475→      }\n   476→      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n   477→      lastContact?: string\n   478→      contactCount30Days?: number\n   479→      createdAt: timestamp\n   480→      updatedAt: timestamp\n   481→    }\n   482→\n   483→5.4 Case Schema (Unified)\n   484→\n   485→    {\n   486→      id: string\n   487→      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n   488→             | 'safeguarding' | 'enquiry'\n   489→      reference: string             // e.g., REP-2025-001\n   490→      title: string\n   491→      description: string\n   492→      status: string                // Type-specific statuses\n   493→      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n   494→      propertyId: string\n   495→      tenantId: string\n   496→      handler: string               // Assigned officer\n   497→      assignedTo: string            // User ID\n   498→      createdDate: string\n   499→      updatedDate: string\n   500→      closedDate?: string\n   501→      daysOpen: number\n   502→      sla: {\n   503→        targetDate: string\n   504→        breached: boolean\n   505→      }\n   506→      slaStatus: 'on-track' | 'at-risk' | 'breached'\n   507→      timeline: [\n   508→        { date, action, actor, notes }\n   509→      ]\n   510→      // Type-specific fields via discriminated union\n   511→    }\n   512→\n   513→5.5 Repair Schema (extends Case)\n   514→\n   515→    {\n   516→      ...Case,\n   517→      type: 'repair',\n   518→      sorCode: string               // HACT SOR code\n   519→      trade: string                 // plumbing, electrical, carpentry, etc.\n   520→      operative?: string\n   521→      appointment: {\n   522→        date: string\n   523→        timeSlot: string\n   524→        confirmedBy: string\n   525→      }\n   526→      appointmentDate?: string\n   527→      completionDate?: string\n   528→      contractor: {\n   529→        name: string\n   530→        company: string\n   531→        gasSafeNumber?: string\n   532→        niceicNumber?: string\n   533→      }\n   534→      cost: {\n   535→        estimated: number\n   536→        actual?: number\n   537→        authorised: boolean\n   538→      }\n   539→      firstTimeFix?: boolean\n   540→      photos: {\n   541→        before: string[]\n   542→        after: string[]\n   543→      }\n   544→      satisfaction?: {\n   545→        rating: number              // 1-5\n   546→        feedback: string\n   547→        date: string\n   548→      }\n   549→      awaabsLaw?: {                 // For damp/mould repairs\n   550→        isHazard: boolean\n   551→        hazardType: string\n   552→        responseDeadline: string\n   553→        repairDeadline: string\n   554→        compliant: boolean\n   555→      }\n   556→    }\n   557→\n   558→5.6 Complaint Schema (extends Case)\n   559→\n   560→    {\n   561→      ...Case,\n   562→      type: 'complaint',\n   563→      stage: 1 | 2\n   564→      category: string\n   565→      deadlines: {\n   566→        stage1Acknowledgement: string   // 5 working days\n   567→        stage1Response: string          // 10 working days\n   568→        stage2Response?: string         // 20 working days\n   569→      }\n   570→      findings?: string\n   571→      compensation?: number\n   572→      learningActions: string[]\n   573→      ombudsmanRef?: string\n   574→      ombudsmanEscalation?: boolean\n   575→      escalatedDate?: string\n   576→      outcome?: string\n   577→    }\n   578→\n   579→5.7 ASB Schema (extends Case)\n   580→\n   581→    {\n   582→      ...Case,\n   583→      type: 'asb',\n   584→      severity: 'low' | 'medium' | 'high' | 'critical'\n   585→      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n   586→      evidenceCount: number\n   587→      evidenceLog: [\n   588→        { date, type, description, attachments }\n   589→      ]\n   590→      perpetratorId?: string\n   591→      victimIds: string[]\n   592→      communityTrigger: boolean\n   593→      multiAgencyPanel?: boolean\n   594→    }\n   595→\n   596→5.8 Financial Case Schema (extends Case)\n   597→\n   598→    {\n   599→      ...Case,\n   600→      type: 'financial',\n   601→      arrearsAmount: number\n   602→      arrearsReason: string\n   603→      paymentArrangement?: {\n   604→        amount: number\n   605→        frequency: string\n   606→        startDate: string\n   607→      }\n   608→      preActionChecklist?: {\n   609→        item: string\n   610→        completed: boolean\n   611→        date?: string\n   612→      }[]\n   613→    }\n   614→\n   615→5.9 Damp-Mould Case Schema (extends Case)\n   616→\n   617→    {\n   618→      ...Case,\n   619→      type: 'damp-mould',\n   620→      hazardClassification: string\n   621→      dampRiskScore: number\n   622→      cause: string\n   623→      linkedRepairs: string[]       // repair case IDs\n   624→    }\n   625→\n   626→5.10 ExternalDataCache Schema\n   627→\n   628→    {\n   629→      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n   630→      source: string                // API source identifier\n   631→      data: object                  // Cached response payload\n   632→      fetchedAt: timestamp          // When data was fetched\n   633→      ttl: number                   // TTL in seconds\n   634→      expiresAt: timestamp          // Computed expiry\n   635→      requestParams: object         // Original request parameters\n   636→    }\n   637→\n   638→5.11 Integration Schema\n   639→\n   640→    {\n   641→      id: string\n   642→      name: string\n   643→      tier: 1 | 2 | 3\n   644→      category: string\n   645→      status: 'active' | 'inactive' | 'error' | 'pending'\n   646→      enabled: boolean\n   647→      config: {\n   648→        baseUrl: string\n   649→        apiKey?: string\n   650→        rateLimit: number\n   651→      }\n   652→      stats: {\n   653→        lastUsed: string\n   654→        requestCount: number\n   655→        avgResponseTime: number\n   656→        cacheHitRate: number\n   657→        errorRate: number\n   658→      }\n   659→    }\n   660→\n   661→5.12 Firestore Indexes (Composite)\n   662→    Defined in firestore.indexes.json at project root (17 indexes).\n   663→    Key indexes for:\n   664→    - cases: (propertyId, type, createdDate DESC)\n   665→    - cases: (tenantId, type, createdDate DESC)\n   666→    - cases: (status, priority, createdDate DESC)\n   667→    - cases: (type, status, createdDate DESC)\n   668→    - cases: (type, handler, createdDate DESC)\n   669→    - cases: (estateId, type, createdDate DESC)\n   670→    - activities: (entityId, timestamp DESC)\n   671→    - tenants: (arrearsRisk DESC)\n   672→    - externalDataCache: (source, expiresAt)\n   673→\n   674→5.13 Firestore Security Rules\n   675→    Defined in firestore.rules at project root.\n   676→    Persona-based access control for all 15+ collections.\n   677→    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n   678→    Audit log is write-once, read-many (immutable).\n   679→\n   680→\n   681→6. API ARCHITECTURE\n   682→================================================================================\n   683→\n   684→6.1 API Design Principles\n   685→    - RESTful design with /api/v1/ prefix\n   686→    - JSON request/response bodies\n   687→    - Consistent error format: { error, message, statusCode }\n   688→    - Pagination: ?page=N&limit=N (default 20, max 50)\n   689→    - Filtering: Query parameters per endpoint\n   690→    - Sorting: ?sort=field&order=asc|desc\n   691→    - Request correlation via X-Request-ID header\n   692→\n   693→6.2 API Route Registry (50+ endpoints)\n   694→\n   695→    AUTHENTICATION (3)\n   696→    POST   /api/v1/auth/login          -- Firebase token login\n   697→    POST   /api/v1/auth/register       -- User registration\n   698→    POST   /api/v1/auth/logout         -- Session invalidation\n   699→\n   700→    PROPERTIES (4)\n   701→    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n   702→    GET    /api/v1/properties/:id       -- Property detail\n   703→    PATCH  /api/v1/properties/:id       -- Update property\n   704→    GET    /api/v1/properties/available -- Available properties\n   705→\n   706→    TENANTS (5)\n   707→    GET    /api/v1/tenants              -- List with pagination/filter\n   708→    GET    /api/v1/tenants/:id          -- Tenant detail\n   709→    PATCH  /api/v1/tenants/:id          -- Update tenant\n   710→    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n   711→    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n   712→\n   713→    CASES (5)\n   714→    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n   715→    GET    /api/v1/cases/:id            -- Case detail\n   716→    POST   /api/v1/cases                -- Create case\n   717→    PATCH  /api/v1/cases/:id            -- Update case\n   718→    GET    /api/v1/cases/:id/activities -- Case activities\n   719→\n   720→    COMPLIANCE (2)\n   721→    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n   722→    GET    /api/v1/compliance/:type     -- Type-specific data\n   723→\n   724→    EXPLORE (4)\n   725→    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n   726→    GET    /api/v1/explore/regions      -- List regions\n   727→    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n   728→    GET    /api/v1/explore/blocks/:id   -- Block detail\n   729→\n   730→    RENT (2)\n   731→    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n   732→    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n   733→\n   734→    REPORTS (3)\n   735→    GET    /api/v1/reports              -- Report catalog (27 types)\n   736→    GET    /api/v1/reports/:type        -- Generate report data\n   737→    GET    /api/v1/reports/tsm          -- TSM specific data\n   738→\n   739→    LETTINGS (2)\n   740→    GET    /api/v1/lettings/voids       -- Void property list\n   741→    GET    /api/v1/lettings/register    -- Housing register\n   742→\n   743→    BOOKING (2)\n   744→    POST   /api/v1/booking/viewing      -- Book a viewing\n   745→    POST   /api/v1/booking/application  -- Submit application\n   746→\n   747→    BRIEFING (1)\n   748→    GET    /api/v1/briefing             -- Personalised morning briefing\n   749→\n   750→    EXPORT (2)\n   751→    GET    /api/v1/export/csv/:type     -- CSV export\n   752→    GET    /api/v1/export/pdf/:type     -- PDF export\n   753→\n   754→    AI INTELLIGENCE (12)\n   755→    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n   756→    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n   757→    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n   758→    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n   759→    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n   760→    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n   761→    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n   762→    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n   763→    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n   764→    POST   /api/v1/ai/draft-communication               -- Draft communication\n   765→    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n   766→\n   767→    GOV.UK NOTIFY (4)\n   768→    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n   769→    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n   770→    GET    /api/v1/ai/notify/template/:id               -- Template detail\n   771→    POST   /api/v1/ai/notify/render                     -- Render template\n   772→\n   773→    MOCK TIER 3 (9)\n   774→    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n   775→    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n   776→    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n   777→    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n   778→    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n   779→    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n   780→    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n   781→    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n   782→    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n   783→\n   784→    EXTERNAL DATA PROXY (9)\n   785→    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n   786→    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n   787→    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n   788→    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n   789→    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n   790→    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n   791→    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n   792→    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n   793→    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n   794→\n   795→    ADMIN (4)\n   796→    GET    /api/v1/admin/integrations                   -- List integrations\n   797→    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n   798→    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n   799→    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n   800→\n   801→    CONFIG & HEALTH\n   802→    GET    /api/v1/config              -- Firebase client config (public)\n   803→    GET    /health                     -- Health check\n   804→\n   805→\n   806→7. EXTERNAL API INTEGRATION ARCHITECTURE\n   807→================================================================================\n   808→\n   809→7.1 Server-Side Proxy Pattern\n   810→    All external API calls are proxied through the Express server.\n   811→    Frontend NEVER calls external APIs directly.\n   812→\n   813→    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n   814→\n   815→7.2 Caching Strategy (Firestore-based)\n   816→    Collection: externalDataCache\n   817→    Pattern: Cache-through with TTL\n   818→\n   819→    | Data Source       | TTL      | Rationale                    |\n   820→    |-------------------|----------|------------------------------|\n   821→    | Weather           | 1 hour   | Forecast changes frequently  |\n   822→    | Crime data        | 24 hours | Updated monthly by Police.uk |\n   823→    | EPC certificates  | 30 days  | Rarely changes               |\n   824→    | Census data       | 90 days  | Static (Census 2021)         |\n   825→    | Postcode lookup   | 7 days   | Rarely changes               |\n   826→    | Gas Safe          | 24 hours | Registration status           |\n   827→    | Electrical Safety | 24 hours | Registration status           |\n   828→    | IMD data          | 90 days  | Annual update cycle          |\n   829→    | NOMIS             | 30 days  | Monthly refresh               |\n   830→    | Flood risk        | 1 hour   | Changes with weather          |\n   831→\n   832→7.3 Rate Limiting (External APIs)\n   833→    Token bucket pattern per API source.\n   834→    Fair-use limit: 15 requests/second across all external APIs.\n   835→\n   836→7.4 Graceful Degradation\n   837→    All external APIs have simulated fallbacks.\n   838→    If an API fails or times out:\n   839→    - Timeout: 10 seconds per external request\n   840→    - Retry: 1 retry with exponential backoff (2s)\n   841→    - Return simulated fallback data\n   842→    - Flag response: { source: 'live' | 'simulated' }\n   843→    Simulated data is realistic, consistent (deterministic seeding), flagged.\n   844→\n   845→\n   846→8. SECURITY ARCHITECTURE\n   847→================================================================================\n   848→\n   849→8.1 Authentication Flow\n   850→    1. User visits /login\n   851→    2. FirebaseUI widget presents Google SSO or email/password\n   852→    3. Firebase returns ID token (JWT)\n   853→    4. Frontend stores token, sends in Authorization header\n   854→    5. Express middleware verifies token via Firebase Admin SDK\n   855→    6. User context loaded (role, persona, permissions)\n   856→    7. Fallback: X-Persona header for development (non-production)\n   857→\n   858→8.2 Authorization (RBAC)\n   859→    10 default roles with hierarchical permissions:\n   860→    - super-admin, org-admin, regional-manager, area-manager\n   861→    - housing-manager, senior-officer, housing-officer\n   862→    - repairs-coordinator, repairs-operative, read-only\n   863→\n   864→8.3 Security Headers\n   865→    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n   866→    - X-Content-Type-Options: nosniff\n   867→    - X-Frame-Options: DENY\n   868→    - Referrer-Policy: strict-origin-when-cross-origin\n   869→    - Permissions-Policy (camera, microphone, geolocation disabled)\n   870→    - Strict-Transport-Security: max-age=31536000\n   871→\n   872→8.4 Secrets Management\n   873→    All secrets stored in Google Secret Manager:\n   874→    - FIREBASE_API_KEY\n   875→    - FIREBASE_AUTH_DOMAIN\n   876→    - FIREBASE_PROJECT_ID\n   877→    - DEMO_USER_PASSWORD\n   878→    No secrets in source code or environment files.\n   879→\n   880→\n   881→9. DEPLOYMENT ARCHITECTURE\n   882→================================================================================\n   883→\n   884→9.1 Deployment Pipeline\n   885→\n   886→    Developer -> git push origin main\n   887→                    |\n   888→                    v\n   889→    GitHub Repository (rajivpeter/SocialHomes_ai)\n   890→                    |\n   891→                    v\n   892→    Cloud Build (auto-triggered)\n   893→     +-- Step 1: Build React frontend (Vite)\n   894→     +-- Step 2: Build Express backend (tsc)\n   895→     +-- Step 3: Build & push Docker image\n   896→                    |\n   897→                    v\n   898→    Artifact Registry (europe-west2)\n   899→     +-- cloud-run-source-deploy/socialhomes:latest\n   900→                    |\n   901→                    v\n   902→    Cloud Run (europe-west2)\n   903→     +-- Min instances: 0\n   904→     +-- Max instances: 10\n   905→     +-- Memory: 1Gi\n   906→     +-- CPU: 1\n   907→     +-- Concurrency: 80\n   908→     +-- Timeout: 300s\n   909→     +-- Port: 8080\n   910→     +-- Secrets: 4 from Secret Manager\n   911→\n   912→9.2 Docker Build (Multi-Stage)\n   913→    Stage 1: Build client (Vite) — node:20-slim base\n   914→    Stage 2: Build server (tsc) — node:20-slim base\n   915→    Stage 3: Production — copy built assets, start server (~500MB image)\n   916→\n   917→9.3 Cloud Run Configuration\n   918→    Region: europe-west2 (London)\n   919→    Auto-scaling based on request volume\n   920→    Min instances 0 for cost efficiency (cold start < 3s)\n   921→\n   922→9.4 Key Infrastructure References\n   923→    GCP Project ID: gen-lang-client-0878518473\n   924→    GCP Project Number: 587984201316\n   925→    Firebase Project: gen-lang-client-0146156913\n   926→    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n   927→                       cloud-run-source-deploy/socialhomes\n   928→    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n   929→\n   930→\n   931→10. MONITORING & OBSERVABILITY\n   932→================================================================================\n   933→\n   934→10.1 Custom Metrics (In-App)\n   935→    - Request count (by endpoint, method, status code)\n   936→    - Response time percentiles (P50, P95, P99)\n   937→    - Cache hit/miss rates per API source\n   938→    - Firestore query latency\n   939→    - Error rate and error types\n   940→    - Active concurrent requests\n   941→\n   942→10.2 Health Check\n   943→    GET /health\n   944→    - Firestore connectivity check with latency measurement\n   945→    - Memory usage (RSS, heap used, heap total)\n   946→    - Process uptime\n   947→    - Status: healthy | degraded | unhealthy\n   948→\n   949→10.3 Structured Logging\n   950→    - JSON format for all logs\n   951→    - Request ID correlation (X-Request-ID)\n   952→    - No sensitive data in logs (no PII)\n   953→    - Error logging with full non-PII context\n   954→\n   955→10.4 Admin Monitoring Dashboard\n   956→    GET /api/v1/admin/monitoring\n   957→    - Real-time metrics display\n   958→    - Integration status overview (20 integrations)\n   959→    - Cache performance statistics\n   960→    - Error rate trending\n   961→\n   962→\n   963→================================================================================\n   964→  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n   965→  Yantra Works | 2026-02-25\n   966→================================================================================\n   967→"}]},"uuid":"785f5852-8c48-405f-a356-1bbc4c0a42cb","timestamp":"2026-02-25T19:28:30.715Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                               |\n                                                      +--------v---------+\n                                                      |    blocks (8)    |\n                                                      +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n","numLines":967,"startLine":1,"totalLines":967}},"sourceToolAssistantUUID":"a1824b5a-aaf6-4b77-a2c7-5ff1c47764b8"}
{"parentUuid":"17c18d8a-da2f-4c2e-b39b-fb7ff8ea856d","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013VZ2dPXogBuVSHyB26gZnY","type":"tool_result","content":"     1→================================================================================\n     2→  Doc3 — SocialHomes.Ai API & Integration Requirements\n     3→  Version: 5.0  |  Date: 2026-02-25\n     4→  Author: Business Analyst Agent  |  Studio: Yantra Works\n     5→================================================================================\n     6→\n     7→1. API OVERVIEW\n     8→================================================================================\n     9→\n    10→1.1 API Strategy\n    11→    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    12→    integrations. The React frontend communicates exclusively with the Express\n    13→    backend, which handles external calls, caching, rate limiting, and\n    14→    graceful degradation.\n    15→\n    16→1.2 Integration Tiers\n    17→\n    18→    TIER 1 — Free, No API Key Required\n    19→    Publicly available APIs with no registration needed.\n    20→    Status: LIVE with real data\n    21→\n    22→    TIER 2 — Free, Registration Required\n    23→    APIs requiring account creation or key registration.\n    24→    Status: LIVE with real data (where keys available) + simulated fallbacks\n    25→\n    26→    TIER 3 — Subscription/Paid APIs\n    27→    Commercial APIs requiring contracts or paid subscriptions.\n    28→    Status: MOCK endpoints with realistic simulated data\n    29→\n    30→1.3 Current Integration Count\n    31→    Total: 20 integrations\n    32→    - Tier 1: 3 live\n    33→    - Tier 2: 6 live (with simulated fallbacks)\n    34→    - Tier 3: 5 mock services + 6 planned\n    35→\n    36→\n    37→2. TIER 1 INTEGRATIONS (Free, No Key)\n    38→================================================================================\n    39→\n    40→2.1 Police.uk — Street-Level Crime Data\n    41→    Status: LIVE\n    42→    Base URL: https://data.police.uk/api\n    43→    Documentation: https://data.police.uk/docs/\n    44→\n    45→    Endpoints Used:\n    46→    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    47→    - GET /crimes-at-location?location_id={id}\n    48→    - GET /outcomes-at-location?location_id={id}\n    49→\n    50→    Server Route: GET /api/v1/public-data/police/:postcode\n    51→    Cache TTL: 24 hours\n    52→    Rate Limit: 15 req/sec (fair-use)\n    53→    Fallback: Simulated crime data matching postcode area\n    54→\n    55→    Used By:\n    56→    - D2: Live Crime Context for ASB (crime-context.ts)\n    57→    - Explore page crime data layer\n    58→    - ASB case correlation\n    59→    - Neighbourhood Briefing crime section\n    60→\n    61→    Data Returned:\n    62→    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    63→    - Month, location (lat/lng), outcome status\n    64→    - 12-month historical data per location\n    65→\n    66→2.2 Open-Meteo — Weather Forecasting\n    67→    Status: LIVE\n    68→    Base URL: https://api.open-meteo.com/v1\n    69→    Documentation: https://open-meteo.com/en/docs\n    70→\n    71→    Endpoints Used:\n    72→    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n    73→          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n    74→          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n    75→          &timezone=Europe/London\n    76→\n    77→    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    78→    Cache TTL: 1 hour\n    79→    Rate Limit: 10,000 req/day (no key needed)\n    80→    Fallback: Static weather for London SE\n    81→\n    82→    Used By:\n    83→    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    84→    - AI Morning Briefing (weather section)\n    85→    - Neighbourhood Briefing (environmental context)\n    86→    - Property impact assessment\n    87→\n    88→    Data Returned:\n    89→    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    90→    - Daily: max/min temperature, precipitation sum\n    91→    - 7-day forecast + current conditions\n    92→\n    93→2.3 DEFRA Flood Risk API\n    94→    Status: LIVE\n    95→    Base URL: https://environment.data.gov.uk/flood-monitoring\n    96→    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n    97→\n    98→    Endpoints Used:\n    99→    - GET /id/floods?lat={lat}&long={lng}&dist=3\n   100→    - GET /id/stations?lat={lat}&long={lng}&dist=3\n   101→\n   102→    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n   103→    Cache TTL: 1 hour\n   104→    Rate Limit: No formal limit\n   105→    Fallback: \"No active warnings\" with zone classification\n   106→\n   107→    Used By:\n   108→    - Property Passport (flood risk section)\n   109→    - Neighbourhood Briefing (environmental alerts)\n   110→    - Property detail page (risk indicators)\n   111→\n   112→    Data Returned:\n   113→    - Active flood warnings/alerts\n   114→    - Flood risk zone classification\n   115→    - Nearest monitoring station readings\n   116→\n   117→\n   118→3. TIER 2 INTEGRATIONS (Registration Required)\n   119→================================================================================\n   120→\n   121→3.1 Postcodes.io — Postcode Lookup\n   122→    Status: LIVE\n   123→    Base URL: https://api.postcodes.io\n   124→    Documentation: https://postcodes.io/docs\n   125→    Registration: None (open API)\n   126→\n   127→    Endpoints Used:\n   128→    - GET /postcodes/{postcode}\n   129→    - GET /postcodes/{postcode}/nearest\n   130→    - POST /postcodes (bulk lookup)\n   131→\n   132→    Server Route: GET /api/v1/public-data/postcode/:postcode\n   133→    Cache TTL: 7 days\n   134→    Rate Limit: Generous (no formal limit)\n   135→    Fallback: Static mapping for SE London postcodes\n   136→\n   137→    Data Returned:\n   138→    - Latitude, longitude\n   139→    - LSOA code and name (for IMD/Census/NOMIS)\n   140→    - Ward, parliamentary constituency\n   141→    - Local authority, region\n   142→\n   143→    Used By:\n   144→    - All location-dependent lookups\n   145→    - LSOA resolution for Census/NOMIS/IMD\n   146→    - Property geocoding\n   147→\n   148→3.2 EPC Open Data\n   149→    Status: LIVE (with simulated fallback)\n   150→    Base URL: https://epc.opendatacommunities.org/api/v1\n   151→    Documentation: https://epc.opendatacommunities.org/docs/api\n   152→    Registration: API key via MHCLG portal\n   153→\n   154→    Endpoints Used:\n   155→    - GET /domestic/search?uprn={uprn}\n   156→    - GET /domestic/certificate/{lmk-key}\n   157→\n   158→    Server Route: GET /api/v1/public-data/epc/:uprn\n   159→    Cache TTL: 30 days\n   160→    Rate Limit: 1,000 req/month (free tier)\n   161→    Fallback: Generated EPC data matching property attributes\n   162→\n   163→    Data Returned:\n   164→    - Current energy rating (A-G) and score\n   165→    - Potential rating\n   166→    - Environmental impact rating\n   167→    - Floor area, wall/roof type\n   168→    - Heating type, hot water system\n   169→    - Recommendations for improvement\n   170→    - Certificate expiry date\n   171→\n   172→    Used By:\n   173→    - Property Passport (energy section)\n   174→    - Compliance page (EPC tracking)\n   175→    - Property detail page\n   176→    - D1: Damp prediction (building factor input)\n   177→\n   178→3.3 Census 2021 (ONS via NOMIS)\n   179→    Status: LIVE (with simulated fallback)\n   180→    Base URL: https://www.nomisweb.co.uk/api/v01\n   181→    Documentation: https://www.nomisweb.co.uk/api/v01/help\n   182→\n   183→    Datasets Used:\n   184→    - NM_2072_1 — Population by age/sex (Census 2021)\n   185→    - NM_2021_1 — Accommodation type (Census 2021)\n   186→\n   187→    Server Route: GET /api/v1/public-data/census/:lsoaCode\n   188→    Cache TTL: 90 days\n   189→    Rate Limit: 100,000 req/month\n   190→    Fallback: Simulated demographics for Southwark LSOA areas\n   191→\n   192→    Data Returned:\n   193→    - Population count and density\n   194→    - Age distribution (0-15, 16-64, 65+)\n   195→    - Household composition\n   196→    - Accommodation type breakdown\n   197→    - Ethnicity distribution\n   198→\n   199→    Used By:\n   200→    - Neighbourhood Briefing (demographics section)\n   201→    - Property Passport (area context)\n   202→    - D3: Vulnerability Detection (deprivation context)\n   203→\n   204→3.4 NOMIS — Labour Market Statistics\n   205→    Status: LIVE (with simulated fallback)\n   206→    Base URL: https://www.nomisweb.co.uk/api/v01\n   207→\n   208→    Datasets Used:\n   209→    - NM_162_1 — JSA claimant count by age/sex\n   210→    - NM_17_5  — Annual Population Survey (employment/unemployment)\n   211→\n   212→    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n   213→    Cache TTL: 30 days\n   214→    Rate Limit: 100,000 req/month\n   215→    Fallback: Simulated labour market data for SE London\n   216→\n   217→    Data Returned:\n   218→    - Employment rate, unemployment rate\n   219→    - Economic activity breakdown\n   220→    - Claimant count (JSA/UC)\n   221→    - Occupation types\n   222→    - Qualification levels\n   223→\n   224→    Used By:\n   225→    - D5: Benefits Entitlement Engine (employment context)\n   226→    - Neighbourhood Briefing (economic section)\n   227→    - D3: Vulnerability Detection (economic deprivation factor)\n   228→\n   229→3.5 Gas Safe Register\n   230→    Status: LIVE (with simulated fallback)\n   231→    Base URL: https://www.gassaferegister.co.uk/api\n   232→    Documentation: Restricted (via partnership application)\n   233→\n   234→    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n   235→    Cache TTL: 24 hours\n   236→    Rate Limit: 100 req/hour\n   237→    Fallback: Simulated verification with valid/expired/suspended status\n   238→\n   239→    Data Returned:\n   240→    - Engineer name and company\n   241→    - Registration status (valid/expired/suspended)\n   242→    - Qualifications (boiler, cooker, fire, etc.)\n   243→    - Registration number and expiry date\n   244→\n   245→    Used By:\n   246→    - Repair detail page (contractor verification badge — green)\n   247→    - Compliance management (contractor vetting)\n   248→\n   249→3.6 Electrical Safety Register (NICEIC)\n   250→    Status: LIVE (with simulated fallback)\n   251→    Base URL: https://www.niceic.com/api\n   252→    Documentation: Via partnership application\n   253→\n   254→    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n   255→    Cache TTL: 24 hours\n   256→    Rate Limit: 100 req/hour\n   257→    Fallback: Simulated verification with valid/expired/suspended status\n   258→\n   259→    Data Returned:\n   260→    - Contractor name and company\n   261→    - Registration status (valid/expired/suspended)\n   262→    - Scheme (NICEIC Approved Contractor / Competent Person)\n   263→    - Registration number and expiry date\n   264→\n   265→    Used By:\n   266→    - Repair detail page (contractor verification badge — blue)\n   267→    - Compliance management (electrical contractor vetting)\n   268→\n   269→\n   270→4. TIER 3 INTEGRATIONS (Mock/Subscription)\n   271→================================================================================\n   272→\n   273→4.1 DWP Universal Credit Verification\n   274→    Status: MOCK\n   275→    Mock Function: mockUcVerification(tenantId)\n   276→    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n   277→\n   278→    Mock Response:\n   279→    - UC claim status (active/pending/none)\n   280→    - Housing element amount\n   281→    - Payment frequency and next payment date\n   282→    - Managed payment status (direct to landlord)\n   283→    - Alternative Payment Arrangement (APA) eligibility\n   284→\n   285→    Used By:\n   286→    - D5: Benefits Entitlement Engine\n   287→    - Rent management (UC tracking)\n   288→    - Arrears prevention (early warning)\n   289→\n   290→4.2 IoT Sensor Integration (Switchee/Aico)\n   291→    Status: MOCK\n   292→    Mock Function: mockIotSensors(propertyId)\n   293→    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   294→\n   295→    Mock Response:\n   296→    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n   297→    - Humidity readings (per room)\n   298→    - CO2 levels\n   299→    - Smoke/CO detector status (OK/alert/battery-low)\n   300→    - Heating system status (on/off/hours today)\n   301→    - Alerts (high humidity, low temperature, CO detected)\n   302→\n   303→    Used By:\n   304→    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n   305→    - Property detail page (live sensor data)\n   306→    - Compliance monitoring (smoke/CO detector status)\n   307→\n   308→4.3 GoCardless — Direct Debit\n   309→    Status: MOCK\n   310→    Mock Function: mockDirectDebit(tenantId)\n   311→    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n   312→\n   313→    Mock Response:\n   314→    - Mandate status (active/pending/cancelled)\n   315→    - Bank details (last 4 digits only)\n   316→    - Next collection date and amount\n   317→    - Payment history (last 12 months)\n   318→    - Failed payment reasons\n   319→\n   320→    Used By:\n   321→    - Rent management (payment processing)\n   322→    - Arrears management (DD failure tracking)\n   323→    - Tenant detail (payment method)\n   324→\n   325→4.4 Plentific/Fixflo — Repairs Marketplace\n   326→    Status: MOCK\n   327→    Mock Function: mockRepairsMarketplace(caseId)\n   328→    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n   329→\n   330→    Mock Response:\n   331→    - Contractor quotes (3 quotes with price/availability)\n   332→    - Dispatch confirmation\n   333→    - Appointment scheduling\n   334→    - Job completion notification\n   335→    - Satisfaction survey trigger\n   336→\n   337→    Used By:\n   338→    - Repairs management (contractor dispatch)\n   339→    - Cost management (competitive quotes)\n   340→\n   341→4.5 DocuSign — Digital Signing\n   342→    Status: MOCK\n   343→    Mock Function: mockSigningEnvelope(documentType, tenantId)\n   344→    Server Route: POST /api/v1/ai/mock/signing\n   345→\n   346→    Mock Response:\n   347→    - Envelope ID and status (sent/delivered/signed/declined)\n   348→    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n   349→    - Recipients with signing status\n   350→    - Completion date\n   351→    - Signed document URL\n   352→\n   353→    Used By:\n   354→    - Tenancy sign-up workflow\n   355→    - Compliance certificate signing\n   356→    - Legal document execution\n   357→\n   358→4.6 Experian/TransUnion — Tenant Referencing\n   359→    Status: MOCK\n   360→    Mock Function: mockReferencingResult(applicantId)\n   361→    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n   362→\n   363→    Mock Response:\n   364→    - Credit score (300-850)\n   365→    - Affordability assessment (pass/refer/fail)\n   366→    - CCJ count and value\n   367→    - Previous addresses (last 3 years)\n   368→    - Employment verification\n   369→    - Recommendation (accept/refer/decline)\n   370→\n   371→    Used By:\n   372→    - Allocations (applicant vetting)\n   373→    - Lettings workflow (pre-tenancy checks)\n   374→\n   375→4.7 Land Registry — Title Data\n   376→    Status: MOCK\n   377→    Mock Function: mockLandRegistryTitle(propertyId)\n   378→    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n   379→\n   380→    Mock Response:\n   381→    - Title number\n   382→    - Tenure type (freehold/leasehold)\n   383→    - Price paid and date\n   384→    - Registered owner\n   385→    - Lease details (start, term, ground rent)\n   386→    - Restrictions and charges\n   387→\n   388→    Used By:\n   389→    - Property Passport (ownership section)\n   390→    - Property detail page\n   391→\n   392→4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n   393→    Status: MOCK\n   394→    Mock Function: mockRegulatorySubmission(type, refId)\n   395→    Server Route: POST /api/v1/ai/mock/regulatory\n   396→\n   397→    Submission Types:\n   398→    - IDA (Individual Data Return)\n   399→    - CORE lettings\n   400→    - CORE sales\n   401→    - Ombudsman escalation\n   402→    - Compliance score return\n   403→\n   404→    Used By:\n   405→    - Reports module (regulatory submissions)\n   406→    - Compliance management\n   407→\n   408→4.9 NOMIS Labour Market (Extended)\n   409→    Status: MOCK\n   410→    Mock Function: mockLabourMarket(lsoaCode)\n   411→    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n   412→\n   413→    Used By:\n   414→    - Neighbourhood Briefing (economic context)\n   415→    - Benefits Engine (employment verification)\n   416→\n   417→\n   418→5. SEVEN KILLER DIFFERENTIATOR SERVICES\n   419→================================================================================\n   420→\n   421→5.1 D1: Predictive Damp Intelligence\n   422→    Service: server/src/services/damp-prediction.ts\n   423→    API Route: GET /api/v1/ai/damp-risk/:propertyId\n   424→\n   425→    Algorithm: 5-Factor Weighted Score (0-100)\n   426→    +---------------------+--------+--------------------------------+\n   427→    | Factor              | Weight | Data Sources                   |\n   428→    +---------------------+--------+--------------------------------+\n   429→    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n   430→    | Building attributes |  0.25  | Property data (age, type, EPC) |\n   431→    | Repair history      |  0.20  | Case data (damp/mould reports) |\n   432→    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n   433→    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n   434→    +---------------------+--------+--------------------------------+\n   435→\n   436→    Output:\n   437→    - Overall risk score (0-100)\n   438→    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n   439→    - Factor breakdown with individual scores\n   440→    - Proactive recommendations\n   441→    - Awaab's Law compliance status\n   442→\n   443→5.2 D2: Live Crime Context for ASB\n   444→    Service: server/src/services/crime-context.ts\n   445→    API Route: GET /api/v1/ai/crime-context/:estateId\n   446→\n   447→    Algorithm:\n   448→    - Fetch Police.uk data for estate location (12-month window)\n   449→    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n   450→    - Correlate with internal ASB cases\n   451→    - Identify hotspots and trends\n   452→    - Generate estate safety score\n   453→\n   454→    Output:\n   455→    - Crime summary by category (last 12 months)\n   456→    - Monthly trend (rising/stable/declining)\n   457→    - Hotspot locations within estate\n   458→    - Correlation with internal ASB cases\n   459→    - Recommended patrol priorities\n   460→\n   461→5.3 D3: Automatic Vulnerability Detection\n   462→    Service: server/src/services/vulnerability-detection.ts\n   463→    API Route: GET /api/v1/ai/vulnerability/:tenantId\n   464→\n   465→    Algorithm: 7-Factor Weighted Score (0-100)\n   466→    +--------------------------+--------+--------------------------+\n   467→    | Factor                   | Weight | Data Sources             |\n   468→    +--------------------------+--------+--------------------------+\n   469→    | IMD deprivation          |  0.20  | IMD data (decile)        |\n   470→    | Arrears history          |  0.20  | Rent account (balance)   |\n   471→    | Health flags             |  0.15  | Tenant vulnerability     |\n   472→    | Social isolation         |  0.15  | Household composition    |\n   473→    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n   474→    | Dependents               |  0.10  | Household members        |\n   475→    | UC transition            |  0.10  | UC status                |\n   476→    +--------------------------+--------+--------------------------+\n   477→\n   478→    Output:\n   479→    - Vulnerability score (0-100)\n   480→    - Risk level: low / moderate / high / critical\n   481→    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n   482→    - Recommended support actions\n   483→    - Referral suggestions (social services, CAB, food bank)\n   484→\n   485→5.4 D4: Property Passport\n   486→    Service: server/src/services/property-passport.ts\n   487→    API Route: GET /api/v1/ai/property-passport/:propertyId\n   488→\n   489→    Aggregation Sources:\n   490→    - Property data (Firestore)\n   491→    - EPC certificate (Tier 2 API)\n   492→    - Compliance certificates (Firestore)\n   493→    - Repair history (Firestore cases)\n   494→    - Damp risk score (D1 service)\n   495→    - Flood risk (DEFRA API)\n   496→    - Crime context (D2 service)\n   497→    - Census demographics (NOMIS API)\n   498→    - Land Registry title (mock)\n   499→\n   500→    Output:\n   501→    - Comprehensive property dossier\n   502→    - Current condition assessment\n   503→    - Compliance status summary\n   504→    - Energy efficiency profile\n   505→    - Neighbourhood context\n   506→    - Investment recommendations\n   507→\n   508→5.5 D5: Benefits Entitlement Engine\n   509→    Service: server/src/services/benefits-engine.ts\n   510→    API Route: GET /api/v1/ai/benefits-check/:tenantId\n   511→\n   512→    Rules Engine (UK 2025/26):\n   513→    - Universal Credit (standard allowance, housing element, child element)\n   514→    - Personal Independence Payment (PIP)\n   515→    - Attendance Allowance\n   516→    - Pension Credit (guarantee, savings)\n   517→    - Council Tax Reduction\n   518→    - Discretionary Housing Payment\n   519→    - Warm Home Discount\n   520→    - Free school meals\n   521→\n   522→    Input:\n   523→    - Tenant age, household composition\n   524→    - Employment status, income\n   525→    - Disability/health conditions\n   526→    - Current benefit claims\n   527→\n   528→    Output:\n   529→    - List of potential entitlements\n   530→    - Estimated weekly/monthly amounts\n   531→    - Claim status (claimed/unclaimed/check-eligibility)\n   532→    - Total unclaimed benefits estimate\n   533→    - Next steps for each entitlement\n   534→\n   535→5.6 D6: AI Neighbourhood Briefing\n   536→    Service: server/src/services/neighbourhood-briefing.ts\n   537→    API Route: GET /api/v1/ai/briefing/:estateId\n   538→\n   539→    Data Sources Combined:\n   540→    - Weather forecast (Open-Meteo)\n   541→    - Crime data (Police.uk)\n   542→    - Active cases (Firestore)\n   543→    - Compliance status (Firestore)\n   544→    - Census demographics (NOMIS)\n   545→    - Damp risk aggregation (D1)\n   546→    - ASB incidents (Firestore + Police)\n   547→\n   548→    Output:\n   549→    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n   550→    - Officer briefing text (AI-generated narrative)\n   551→    - Action items prioritized by urgency\n   552→    - Trend comparisons (this week vs last)\n   553→\n   554→5.7 D7: IoT Sensor Integration\n   555→    Service: server/src/services/mock-services.ts\n   556→    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n   557→\n   558→    Supported Devices:\n   559→    - Switchee smart thermostat (temperature, humidity, heating usage)\n   560→    - Aico smoke/CO detectors (status, battery, alerts)\n   561→    - Third-party humidity sensors\n   562→\n   563→    Status: MOCK (ready for real Switchee/Aico API integration)\n   564→\n   565→\n   566→6. GOV.UK NOTIFY INTEGRATION\n   567→================================================================================\n   568→\n   569→6.1 Overview\n   570→    Service: server/src/services/govuk-notify.ts (1,257 lines)\n   571→    Status: Template library defined (24 templates)\n   572→    Integration: Ready for GOV.UK Notify API key\n   573→\n   574→6.2 Template Categories (7)\n   575→\n   576→    CATEGORY 1: Rent Arrears (4 templates)\n   577→    - arrears-mild: Friendly reminder (1-2 weeks behind)\n   578→    - arrears-moderate: Formal notice (3-4 weeks)\n   579→    - arrears-severe: Pre-action warning (5+ weeks)\n   580→    - arrears-arrangement: Payment plan confirmation\n   581→\n   582→    CATEGORY 2: Repairs (4 templates)\n   583→    - repair-acknowledged: Repair reported acknowledgement\n   584→    - repair-appointment: Appointment booking confirmation\n   585→    - repair-completed: Completion notification + satisfaction link\n   586→    - repair-follow-up: Post-repair follow-up\n   587→\n   588→    CATEGORY 3: ASB (3 templates)\n   589→    - asb-reported: ASB report acknowledgement\n   590→    - asb-warning: Warning letter to perpetrator\n   591→    - asb-update: Case update to victim/reporter\n   592→\n   593→    CATEGORY 4: Compliance (3 templates)\n   594→    - compliance-access: Access request for inspection\n   595→    - compliance-reminder: Appointment reminder\n   596→    - compliance-certificate: Certificate available notification\n   597→\n   598→    CATEGORY 5: Tenancy (4 templates)\n   599→    - tenancy-welcome: New tenant welcome pack\n   600→    - tenancy-renewal: Renewal offer\n   601→    - tenancy-end: End of tenancy notification\n   602→    - tenancy-annual-visit: Annual visit scheduling\n   603→\n   604→    CATEGORY 6: Damp & Mould (3 templates)\n   605→    - damp-report-ack: Report acknowledged\n   606→    - damp-inspection: Inspection scheduled\n   607→    - damp-works: Works ordered notification (Awaab's Law timeline)\n   608→\n   609→    CATEGORY 7: General (3 templates)\n   610→    - general-update: Generic case update\n   611→    - general-survey: Satisfaction survey invitation\n   612→    - general-information: Information request\n   613→\n   614→6.3 Template Rendering\n   615→    - Personalisation fields use ((field)) syntax\n   616→    - Rendered server-side via /api/v1/ai/notify/render\n   617→    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n   618→      ((amount)), ((date)), ((officer_name)), etc.\n   619→\n   620→6.4 API Endpoints\n   621→    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n   622→    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n   623→    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n   624→    POST /api/v1/ai/notify/render               -- Render with personalisation\n   625→\n   626→\n   627→7. CACHING ARCHITECTURE\n   628→================================================================================\n   629→\n   630→7.1 Cache Collection: externalDataCache\n   631→    Stored in Firestore with TTL-based expiration.\n   632→    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n   633→\n   634→7.2 Cache-Through Pattern\n   635→    1. Check Firestore cache for key\n   636→    2. If found AND not expired -> return cached data\n   637→    3. If missing OR expired -> fetch from external API\n   638→    4. Store result in cache with TTL\n   639→    5. Return data to caller\n   640→\n   641→7.3 TTL Configuration\n   642→\n   643→    | Source              | TTL       | Key Format                 |\n   644→    |---------------------|-----------|----------------------------|\n   645→    | police              | 24 hours  | police:{postcode}          |\n   646→    | weather             | 1 hour    | weather:{lat},{lng}        |\n   647→    | flood-risk          | 1 hour    | flood:{postcode}           |\n   648→    | postcode            | 7 days    | postcode:{postcode}        |\n   649→    | epc                 | 30 days   | epc:{uprn}                 |\n   650→    | census              | 90 days   | census:{lsoaCode}          |\n   651→    | nomis               | 30 days   | nomis:{lsoaCode}           |\n   652→    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n   653→    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n   654→    | imd                 | 90 days   | imd:{lsoaCode}             |\n   655→\n   656→7.4 Cache Management\n   657→    - Automatic TTL enforcement on read\n   658→    - Manual cache invalidation via admin API\n   659→    - Cache hit rate tracked in metrics\n   660→    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n   661→\n   662→\n   663→8. RATE LIMITING\n   664→================================================================================\n   665→\n   666→8.1 Internal Rate Limits (per client IP)\n   667→\n   668→    | Tier    | Routes              | Limit        | Window  |\n   669→    |---------|---------------------|--------------|---------|\n   670→    | API     | /api/v1/*           | 100 req/min  | Sliding |\n   671→    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n   672→    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n   673→    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n   674→\n   675→8.2 External API Rate Limits\n   676→    Token bucket pattern per API source.\n   677→    Global fair-use: 15 req/sec across all external APIs.\n   678→\n   679→    | API               | Limit             | Enforced By       |\n   680→    |-------------------|-------------------|-------------------|\n   681→    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n   682→    | Open-Meteo        | 10,000 req/day    | No key needed     |\n   683→    | DEFRA             | No formal limit   | Fair-use          |\n   684→    | Postcodes.io      | No formal limit   | Fair-use          |\n   685→    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n   686→    | NOMIS             | 100,000 req/month | Fair-use          |\n   687→    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n   688→    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n   689→\n   690→\n   691→9. ERROR HANDLING & GRACEFUL DEGRADATION\n   692→================================================================================\n   693→\n   694→9.1 External API Error Handling\n   695→    - Timeout: 10 seconds per external request\n   696→    - Retry: 1 retry with exponential backoff (2s)\n   697→    - On failure: Return simulated fallback data\n   698→    - Flag: Response includes { source: 'live' | 'simulated' }\n   699→\n   700→9.2 Simulated Fallback Strategy\n   701→    Every external API has a corresponding simulated data generator.\n   702→    Simulated data is:\n   703→    - Realistic for the requested entity/location\n   704→    - Consistent across requests (deterministic seeding)\n   705→    - Flagged clearly in the response\n   706→\n   707→9.3 Circuit Breaker Pattern (Planned — Phase 5)\n   708→    - Track failure count per API source\n   709→    - Open circuit after 5 consecutive failures\n   710→    - Half-open after 60 seconds (single test request)\n   711→    - Close circuit on successful test\n   712→    Status: Designed, not yet implemented (task 5.2.5)\n   713→\n   714→\n   715→10. API SECURITY\n   716→================================================================================\n   717→\n   718→10.1 Authentication\n   719→    All /api/v1/* routes require Firebase Bearer token.\n   720→    Exception: /health (public health check), /api/v1/config (public)\n   721→\n   722→10.2 Request Validation\n   723→    - JSON body limit: 1MB\n   724→    - Content-Type: application/json enforced\n   725→    - Query parameter sanitization\n   726→    - Path parameter validation\n   727→\n   728→10.3 Response Security\n   729→    - No sensitive data in error responses (production)\n   730→    - CORS restricted to allowed origins\n   731→    - Request ID correlation (X-Request-ID)\n   732→    - Security headers on all responses\n   733→\n   734→10.4 API Key Management\n   735→    - No API keys in source code\n   736→    - All keys in Google Secret Manager\n   737→    - Environment variable injection at runtime\n   738→    - Key rotation support via Secret Manager versioning\n   739→\n   740→\n   741→11. FUTURE INTEGRATION ROADMAP\n   742→================================================================================\n   743→\n   744→11.1 Phase 5 — Real-Time & Advanced (Planned)\n   745→\n   746→    | Integration           | Priority | Complexity | Description                     |\n   747→    |-----------------------|----------|------------|---------------------------------|\n   748→    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n   749→    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n   750→    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n   751→    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n   752→    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n   753→    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n   754→    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n   755→    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n   756→    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n   757→    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n   758→\n   759→11.2 Phase 6 — Enterprise Integrations (Future)\n   760→\n   761→    | Integration           | Priority | Complexity | Description                     |\n   762→    |-----------------------|----------|------------|---------------------------------|\n   763→    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n   764→    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n   765→    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n   766→    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n   767→    | NHS Digital           | P3       | H          | Health data integration          |\n   768→    | Companies House       | P3       | S          | Contractor verification          |\n   769→    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n   770→\n   771→\n   772→================================================================================\n   773→  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n   774→  Yantra Works | 2026-02-25\n   775→================================================================================\n   776→"}]},"uuid":"b6e28b9b-b80d-4b26-b73e-f77ed5bd548e","timestamp":"2026-02-25T19:28:30.898Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n","numLines":776,"startLine":1,"totalLines":776}},"sourceToolAssistantUUID":"17c18d8a-da2f-4c2e-b39b-fb7ff8ea856d"}
{"parentUuid":"b6e28b9b-b80d-4b26-b73e-f77ed5bd548e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VnMZLUUjnB7hDmCjTj7BkE","name":"Read","input":{"file_path":"/mnt/c/.REDACTED.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"5fe9d6bc-6a6b-4e93-b119-f82a67bc7d6b","timestamp":"2026-02-25T19:28:31.016Z"}
{"parentUuid":"5fe9d6bc-6a6b-4e93-b119-f82a67bc7d6b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VnMZLUUjnB7hDmCjTj7BkE","type":"tool_result","content":"     1→# SocialHomes.Ai — Master Execution Plan\n     2→\n     3→> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n     4→> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent\n     5→> Studio: Yantra Works\n     6→\n     7→---\n     8→\n     9→## PLAN SUMMARY\n    10→\n    11→| Phase | Name | Sprints | Status | Progress |\n    12→|-------|------|---------|--------|----------|\n    13→| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n    14→| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n    15→| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n    16→| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n    17→| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n    18→| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |\n    19→\n    20→---\n    21→\n    22→## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n    23→\n    24→| # | Task | Status | Agent |\n    25→|---|------|--------|-------|\n    26→| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n    27→| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n    28→| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n    29→| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n    30→| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n    31→| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n    32→| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n    33→| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n    34→| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n    35→| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n    36→\n    37→---\n    38→\n    39→## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n    40→\n    41→### Goal: Core external API infrastructure + free API integrations\n    42→\n    43→| # | Task | Priority | Complexity | Agent | Status |\n    44→|---|------|----------|------------|-------|--------|\n    45→| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n    46→| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n    47→| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n    48→| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n    49→| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n    50→| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n    51→| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n    52→| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n    53→| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n    54→| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n    55→| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n    56→| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n    57→\n    58→---\n    59→\n    60→## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n    61→\n    62→### Goal: 7 killer differentiators + Tier 2 API registrations\n    63→\n    64→| # | Task | Priority | Complexity | Agent | Status |\n    65→|---|------|----------|------------|-------|--------|\n    66→| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n    67→| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n    68→| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n    69→| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n    70→| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n    71→| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n    72→| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n    73→| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n    74→| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n    75→| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n    76→| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n    77→| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n    78→| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n    79→| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n    80→\n    81→---\n    82→\n    83→## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n    84→\n    85→### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n    86→\n    87→| # | Task | Priority | Complexity | Agent | Status |\n    88→|---|------|----------|------------|-------|--------|\n    89→| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n    90→| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n    91→| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n    92→| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n    93→| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n    94→| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n    95→| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n    96→| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n    97→| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n    98→| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n    99→| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n   100→| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n   101→| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n   102→| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n   103→| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n   104→| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n   105→| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n   106→\n   107→---\n   108→\n   109→## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n   110→\n   111→### Goal: Mock services + polish + production hardening\n   112→\n   113→| # | Task | Priority | Complexity | Agent | Status |\n   114→|---|------|----------|------------|-------|--------|\n   115→| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n   116→| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n   117→| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n   118→| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n   119→| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n   120→| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n   121→| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n   122→| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n   123→| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n   124→| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n   125→| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n   126→| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n   127→| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n   128→| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n   129→\n   130→---\n   131→\n   132→## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)\n   133→\n   134→### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n   135→\n   136→Phase 5 is organized into 5 sub-phases matching the required agent structure:\n   137→Project Setup & Architecture, Backend Development, Frontend Development,\n   138→Testing & QA, and DevOps & Deployment.\n   139→\n   140→---\n   141→\n   142→### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n   143→\n   144→| # | Task | Priority | Complexity | Agent | Status |\n   145→|---|------|----------|------------|-------|--------|\n   146→| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |\n   147→| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |\n   148→| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n   149→| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n   150→| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n   151→| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n   152→| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n   153→| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n   154→| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n   155→\n   156→---\n   157→\n   158→### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n   159→\n   160→| # | Task | Priority | Complexity | Agent | Status |\n   161→|---|------|----------|------------|-------|--------|\n   162→| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n   163→| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n   164→| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n   165→| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n   166→| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n   167→| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n   168→| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n   169→| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n   170→| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n   171→| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n   172→| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n   173→| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n   174→| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n   175→| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n   176→\n   177→---\n   178→\n   179→### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n   180→\n   181→| # | Task | Priority | Complexity | Agent | Status |\n   182→|---|------|----------|------------|-------|--------|\n   183→| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n   184→| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n   185→| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n   186→| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n   187→| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n   188→| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n   189→| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n   190→| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n   191→| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n   192→| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n   193→\n   194→---\n   195→\n   196→### PHASE 5.4: TESTING & QA (Sprints 12-13)\n   197→\n   198→| # | Task | Priority | Complexity | Agent | Status |\n   199→|---|------|----------|------------|-------|--------|\n   200→| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n   201→| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n   202→| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n   203→| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |\n   204→| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n   205→| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n   206→| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n   207→| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n   208→\n   209→---\n   210→\n   211→### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n   212→\n   213→| # | Task | Priority | Complexity | Agent | Status |\n   214→|---|------|----------|------------|-------|--------|\n   215→| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n   216→| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n   217→| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n   218→| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n   219→| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n   220→| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n   221→| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n   222→| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n   223→| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n   224→\n   225→---\n   226→\n   227→## AGENT ROLES\n   228→\n   229→| Agent | Responsibility | Key Files |\n   230→|-------|---------------|-----------|\n   231→| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n   232→| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n   233→| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n   234→| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n   235→| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n   236→\n   237→---\n   238→\n   239→## KEY DOCUMENTS\n   240→\n   241→| Document | Location | Purpose |\n   242→|----------|----------|---------|\n   243→| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |\n   244→| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |\n   245→| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |\n   246→| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n   247→| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n   248→| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n   249→| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n   250→| CLAUDE.md | Project root | Claude Code project instructions |\n   251→| SESSION-HISTORY.md | Project root | Persistent conversation history |\n   252→| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n   253→| DEVOPS.md | Project root | DevOps and deployment guide |\n   254→| EXECUTION-PLAN.md | Project root | This document |\n   255→\n   256→---\n   257→\n   258→## COMMUNICATION\n   259→\n   260→### Telegram (@SocialHomesBot)\n   261→- **Async notifications**: Build status, deployment confirmations, test results\n   262→- **Permission requests**: Routed via Telegram when user is away from desk\n   263→- **Progress updates**: Phase/sprint completion summaries\n   264→- **MCP config**: `.mcp.json` (not committed — contains bot token)\n   265→\n   266→### Session Continuity\n   267→- Update `SESSION-HISTORY.md` at end of every session\n   268→- `CLAUDE.md` provides context for new sessions\n   269→- Entire.io captures checkpoints on commits\n   270→\n   271→---\n   272→\n   273→## METRICS & SUCCESS CRITERIA\n   274→\n   275→| Metric | Target | Current |\n   276→|--------|--------|---------|\n   277→| Selenium test pass rate | > 98% | 99.7% ✅ |\n   278→| TypeScript errors | 0 | 0 ✅ |\n   279→| Vite build warnings | 0 critical | 0 ✅ |\n   280→| API response time (P95) | < 500ms | ~200-300ms ✅ |\n   281→| WCAG AA compliance | 100% | 100% ✅ |\n   282→| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n   283→| Bundle size | < 3MB | ~2.5MB ✅ |\n   284→| Cloud Run cold start | < 3s | < 2s ✅ |\n   285→\n   286→### Phase 5 Additional Targets\n   287→\n   288→| Metric | Target |\n   289→|--------|--------|\n   290→| AI response latency (Vertex AI) | < 3s for conversational queries |\n   291→| AI response latency (streaming first token) | < 500ms |\n   292→| WebSocket connection stability | > 99.9% uptime |\n   293→| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n   294→| Selenium test coverage | > 95% of routes |\n   295→| Unit test coverage (services) | > 80% line coverage |\n   296→| Staging deployment frequency | Every PR |\n   297→| Database backup frequency | Daily automated |\n   298→| Lighthouse accessibility score | > 90 on all pages |\n   299→| Lighthouse performance score | > 80 on all pages |\n   300→\n   301→---\n   302→\n   303→## DEFERRED ITEMS (From Phases 3-4)\n   304→\n   305→Items deferred from earlier phases, now included in Phase 5:\n   306→\n   307→| Original ID | Task | New Phase 5 ID |\n   308→|-------------|------|----------------|\n   309→| 3.17 | E2E testing for all new features | 5.4.1 |\n   310→| 4.12 | Full regression test suite | 5.4.1 |\n   311→| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n   312→| 4.14 | API reference documentation | 5.1.7 |\n   313→| 4.9 | Cache warming, batch updates | 5.2.6 |\n   314→\n   315→---\n   316→\n   317→## PHASE 5 TASK SUMMARY BY AGENT\n   318→\n   319→| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n   320→|-------|-------------|----|----|----|----|\n   321→| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n   322→| **Fullstack** | 20 | 0 | 8 | 12 | 0 |\n   323→| **Frontend** | 10 | 0 | 2 | 7 | 1 |\n   324→| **Tester** | 8 | 0 | 4 | 4 | 0 |\n   325→| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n   326→| **TOTAL** | **44** (DONE: 2, TODO: 42) |\n   327→\n   328→### Recommended Execution Order (Critical Path)\n   329→\n   330→**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n   331→1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n   332→2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n   333→3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n   334→4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n   335→\n   336→**Sprint 10 (Weeks 19-20): Backend Features**\n   337→5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n   338→6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n   339→7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n   340→8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n   341→\n   342→**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n   343→9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n   344→10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n   345→11. 5.3.2 (Notification bell — depends on WebSocket backend)\n   346→12. 5.5.2 (Staging environment — enables test pipeline)\n   347→\n   348→**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n   349→13. 5.3.3–5.3.10 (Remaining frontend features — parallel)\n   350→14. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n   351→15. 5.4.6 (CI test pipeline — enables automated testing)\n   352→16. 5.4.7 (Test data factory — enables isolated testing)\n   353→\n   354→**Sprint 13 (Weeks 25-26): Testing + QA**\n   355→17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)\n   356→18. 5.4.8 (Security testing)\n   357→19. 5.5.4 (Cloud Monitoring alerts)\n   358→20. 5.5.5 (Database backup strategy)\n   359→\n   360→**Sprint 14 (Weeks 27-28): DevOps + Polish**\n   361→21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n   362→22. 5.5.8, 5.5.9 (Runbook, log monitoring)\n   363→23. 5.1.7 (API documentation — after all endpoints stable)\n   364→24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n   365→25. Final regression testing and production deploy\n   366→\n   367→---\n   368→\n   369→## DEPENDENCY GRAPH (Key Chains)\n   370→\n   371→```\n   372→Vertex AI Chain:\n   373→  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)\n   374→    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)\n   375→    → 5.2.14 (AI repair intake)\n   376→\n   377→WebSocket Chain:\n   378→  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)\n   379→    → 5.3.2 (notification bell) → 5.3.9 (real-time status)\n   380→    → 5.2.8 (Firestore listeners)\n   381→\n   382→Testing Chain:\n   383→  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)\n   384→    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n   385→\n   386→DevOps Chain:\n   387→  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)\n   388→    → 5.5.5 (backups) → 5.5.7 (custom domain)\n   389→```\n   390→\n   391→---\n   392→\n   393→**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n   394→"}]},"uuid":"fcbf66e6-b8ed-449a-9c4e-f04c0dd99a7e","timestamp":"2026-02-25T19:28:31.199Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 20 | 0 | 8 | 12 | 0 |\n| **Frontend** | 10 | 0 | 2 | 7 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **44** (DONE: 2, TODO: 42) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n11. 5.3.2 (Notification bell — depends on WebSocket backend)\n12. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n13. 5.3.3–5.3.10 (Remaining frontend features — parallel)\n14. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n15. 5.4.6 (CI test pipeline — enables automated testing)\n16. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)\n18. 5.4.8 (Security testing)\n19. 5.5.4 (Cloud Monitoring alerts)\n20. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n22. 5.5.8, 5.5.9 (Runbook, log monitoring)\n23. 5.1.7 (API documentation — after all endpoints stable)\n24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n25. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)\n    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)\n    → 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)\n    → 5.3.2 (notification bell) → 5.3.9 (real-time status)\n    → 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)\n    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)\n    → 5.5.5 (backups) → 5.5.7 (custom domain)\n```\n\n---\n\n**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n","numLines":394,"startLine":1,"totalLines":394}},"sourceToolAssistantUUID":"5fe9d6bc-6a6b-4e93-b119-f82a67bc7d6b"}
{"parentUuid":"fcbf66e6-b8ed-449a-9c4e-f04c0dd99a7e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_014yRxnfKHsqDQDtyd7BSViG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MueH1i5i8BvjYem3AUNscs","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":5608,"cache_read_input_tokens":19143,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":5608},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLeC5vgnFoeCMabPEZq","type":"assistant","uuid":"d5796c00-a680-4a97-86a6-701c833a4f6f","timestamp":"2026-02-25T19:28:31.448Z"}
{"parentUuid":"d5796c00-a680-4a97-86a6-701c833a4f6f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MueH1i5i8BvjYem3AUNscs","type":"tool_result","content":"     1→# SocialHomes.Ai — Session History\n     2→\n     3→> Persistent conversation log across all Claude Code sessions.\n     4→> Updated at the end of each session to preserve context.\n     5→\n     6→---\n     7→\n     8→## Session 1 — 2026-02-12 (Google Drive path)\n     9→**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n    10→**Agent:** Claude Opus 4.6\n    11→\n    12→### What happened:\n    13→- Initial project setup and exploration\n    14→- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n    15→- Comprehensive Selenium testing initiated (17 test classes)\n    16→- Project overview sent to Telegram\n    17→\n    18→### Key decisions:\n    19→- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n    20→- AI-native features: YantraAssist, entity intelligence, dynamic fields\n    21→- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n    22→\n    23→---\n    24→\n    25→## Session 2 — 2026-02-13 (Migrated to C: drive)\n    26→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    27→**Agent:** Claude Opus 4.6\n    28→\n    29→### What happened:\n    30→- Security cleanup: removed all exposed API keys and secrets from codebase\n    31→- Added full workflow actions and cross-entity navigation\n    32→- Eliminated all React Error #310 instances\n    33→- Redesigned login page\n    34→- Polished dashboard\n    35→- Updated DEVOPS.md\n    36→\n    37→### Commits:\n    38→- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n    39→- `944e952` — feat: add full workflow actions & cross-entity navigation\n    40→- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n    41→- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n    42→- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n    43→\n    44→---\n    45→\n    46→## Session 3 — 2026-02-14\n    47→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    48→**Agent:** Claude Opus 4.6\n    49→\n    50→### What happened:\n    51→\n    52→#### Task 1: Verified 4 previous bug fixes\n    53→- BUG-001: ComplaintDetailPage.tsx — null checks intact\n    54→- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n    55→- BUG-003: AsbPage.tsx — navigation handlers intact\n    56→- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n    57→\n    58→#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n    59→| Warning | File | Fix |\n    60→|---------|------|-----|\n    61→| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n    62→| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n    63→| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n    64→| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n    65→| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n    66→| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n    67→| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n    68→| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n    69→| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n    70→| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n    71→| WARN-011 | (no fix) | 131KB API response is expected behavior |\n    72→\n    73→#### Task 3: Installed Entire.io CLI\n    74→- Installed v0.4.4 at ~/.local/bin/entire\n    75→- Strategy: manual-commit\n    76→- Fixed all 4 git hooks with PATH export\n    77→\n    78→#### Task 4: Build and deploy\n    79→- TypeScript: 0 errors\n    80→- Vite build: 2,580.62 kB JS bundle\n    81→- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n    82→- Push: succeeded → Cloud Build triggered\n    83→\n    84→---\n    85→\n    86→## Session 4 — 2026-02-14 (current)\n    87→**Working directory:** `/mnt/c/.netapps/socialhomes`\n    88→**Agent:** Claude Opus 4.6\n    89→\n    90→### What happened:\n    91→\n    92→#### Task 5: Telegram notifications setup\n    93→- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n    94→- Created .mcp.json with telegram MCP server config\n    95→- Added .mcp.json to .gitignore (contains bot token)\n    96→- MCP tools: send_message, continue_chat, notify_user, end_chat\n    97→\n    98→#### Task 6: Persistent conversation history\n    99→- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n   100→- Added to .gitignore (local dev reference only)\n   101→\n   102→#### Task 7: Entire.io repo\n   103→- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n   104→- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n   105→- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n   106→- Entire.io dashboard: https://app.entire.io (login required)\n   107→\n   108→#### Task 8: UI/UX Audit Document (in progress)\n   109→- Frontend UI engineer agent reviewing all pages, components, interactions\n   110→- Output: comprehensive audit for fullstack and tester agents\n   111→\n   112→#### Task 9: BA Requirements — Public API Integrations (in progress)\n   113→- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n   114→- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n   115→- 7 killer differentiators documented\n   116→\n   117→#### Task 10: Master Execution Plan (pending)\n   118→- Will be created after Tasks 8 and 9 complete\n   119→\n   120→---\n   121→\n   122→## Architecture Reference\n   123→\n   124→### Tech Stack\n   125→- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n   126→- **Backend:** Express.js + TypeScript\n   127→- **Database:** Google Firestore\n   128→- **Hosting:** Google Cloud Run (europe-west2)\n   129→- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n   130→- **Maps:** Leaflet.js + OpenStreetMap\n   131→- **3D:** Three.js\n   132→- **Charts:** Recharts\n   133→- **AI:** YantraAssist (contextual AI assistant)\n   134→\n   135→### Key URLs\n   136→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   137→- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n   138→- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n   139→- **Firebase Project:** gen-lang-client-0146156913\n   140→- **Entire.io dashboard:** https://app.entire.io\n   141→\n   142→### Personas\n   143→1. COO — Organisation-wide view\n   144→2. Head of Housing — Regional oversight\n   145→3. Housing Manager — Estate/block management\n   146→4. Housing Officer — Frontline casework\n   147→5. Repairs Operative — Job-level repairs\n   148→\n   149→### Telegram Bot\n   150→- Bot: @SocialHomesBot\n   151→- Chat ID: socialhomes:8020560167\n   152→- MCP tools: send_message, continue_chat, notify_user, end_chat\n   153→\n   154→---\n   155→\n   156→## Session 5 — 2026-02-15\n   157→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   158→**Agent:** Claude Opus 4.6\n   159→\n   160→### What happened:\n   161→\n   162→#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n   163→\n   164→**Backend Services Created (7 new files):**\n   165→| Service | File | Description |\n   166→|---------|------|-------------|\n   167→| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n   168→| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n   169→| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n   170→| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n   171→| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n   172→| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n   173→| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n   174→\n   175→**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n   176→- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n   177→- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n   178→- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n   179→- D4: `GET /benefits-check/:tenantId`\n   180→- D5: `GET /property-passport/:propertyId`\n   181→- D6: `GET /briefing/:estateId`\n   182→- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n   183→\n   184→**Frontend Components Created (4 new panels):**\n   185→- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n   186→- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n   187→- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n   188→- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n   189→\n   190→**Frontend Pages Updated:**\n   191→- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n   192→- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n   193→- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n   194→- `api-client.ts` — 13 new AI API methods\n   195→- `useApi.ts` — 10 new React Query hooks\n   196→\n   197→### Build Results:\n   198→- TypeScript (server): 0 errors\n   199→- TypeScript (app): 0 errors\n   200→- Vite build: 3,395 modules, 38.43s\n   201→- All clean on first attempt\n   202→\n   203→### Commits:\n   204→- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n   205→\n   206→### EXECUTION-PLAN.md updated:\n   207→- Phase 2 marked as DONE (all 14 tasks)\n   208→\n   209→---\n   210→\n   211→## Session 6 — 2026-02-16\n   212→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   213→**Agent:** Claude Opus 4.6\n   214→\n   215→### What happened:\n   216→\n   217→#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n   218→\n   219→**New Backend Services (2 files):**\n   220→| Service | File | Lines | Description |\n   221→|---------|------|-------|-------------|\n   222→| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n   223→| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n   224→\n   225→**API Routes Added (8 new endpoints):**\n   226→- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n   227→- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n   228→\n   229→**Frontend Enhancements (5 files modified):**\n   230→- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n   231→- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n   232→- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n   233→- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n   234→\n   235→**Accessibility Fixes (WCAG AA):**\n   236→- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n   237→- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n   238→- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n   239→- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n   240→\n   241→### Build Results:\n   242→- TypeScript (server): 0 errors\n   243→- TypeScript (app): 0 errors\n   244→- Vite build: 3,396 modules, 39.22s — all clean\n   245→- Server build: clean\n   246→\n   247→### Files Changed: 13 modified + 2 new (523 insertions)\n   248→\n   249→### Commits:\n   250→- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n   251→\n   252→### EXECUTION-PLAN.md updated:\n   253→- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n   254→\n   255→---\n   256→\n   257→#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n   258→\n   259→**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n   260→| Service | Function | Description |\n   261→|---------|----------|-------------|\n   262→| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n   263→| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n   264→| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n   265→| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n   266→| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n   267→\n   268→**Admin Integration Dashboard:**\n   269→- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n   270→- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n   271→- Toggle enable/disable + Test Connection buttons\n   272→- Summary bar: total, active, issues, avg response time\n   273→- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n   274→- Updated App.tsx routing to use IntegrationsPage\n   275→\n   276→**Security Hardening:**\n   277→- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n   278→- CORS tightened to allowed origins (localhost + Cloud Run URL)\n   279→- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n   280→- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n   281→- Request correlation ID via X-Request-ID (crypto.randomUUID)\n   282→- Enhanced error handler: structured JSON logging, no stack leaks in production\n   283→- JSON body limit reduced from 10mb to 1mb\n   284→\n   285→**Production Monitoring:**\n   286→- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n   287→- New `server/src/middleware/metrics.ts` — records every request on res.finish\n   288→- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n   289→- New admin route: GET /api/v1/admin/monitoring\n   290→- Frontend API client: adminApi.monitoring()\n   291→\n   292→**API Routes Added (8 new):**\n   293→- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n   294→- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n   295→\n   296→### Build Results:\n   297→- TypeScript (server): 0 errors\n   298→- TypeScript (app): 0 errors\n   299→- Vite build: 3,397 modules, 35.59s — all clean\n   300→- Server build: clean\n   301→\n   302→### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n   303→### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n   304→\n   305→### EXECUTION-PLAN.md updated:\n   306→- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n   307→\n   308→---\n   309→\n   310→## Session 7 — 2026-02-16 (Cloud Run Deployment)\n   311→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   312→**Agent:** Claude Opus 4.6\n   313→\n   314→### What happened:\n   315→\n   316→#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n   317→\n   318→**Problem:** Previous deployment attempts failed:\n   319→1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n   320→2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n   321→\n   322→**Resolution:**\n   323→1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n   324→2. Created 4 secrets in Secret Manager:\n   325→   | Secret | Value Source |\n   326→   |--------|-------------|\n   327→   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   328→   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   329→   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   330→   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n   331→3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n   332→4. Deployed using pre-built image from Artifact Registry:\n   333→   ```\n   334→   gcloud run deploy socialhomes \\\n   335→     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n   336→     --region=europe-west2 --memory=1Gi --cpu=1 \\\n   337→     --min-instances=0 --max-instances=10 --port=8080 \\\n   338→     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   339→   ```\n   340→\n   341→**Result:**\n   342→- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n   343→- Health check: `healthy`, Firestore connected (984ms latency)\n   344→- Firebase config endpoint: secrets injected correctly\n   345→- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n   346→\n   347→### Key Discoveries:\n   348→- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n   349→- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n   350→- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n   351→- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n   352→\n   353→### Architecture Reference (updated):\n   354→- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n   355→- **GCP Project ID:** gen-lang-client-0878518473\n   356→- **GCP Project Number:** 587984201316\n   357→- **Firebase Project:** gen-lang-client-0146156913\n   358→- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n   359→- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n   360→\n   361→---\n   362→\n   363→## Session 8 — 2026-02-18 (Business Analyst Session)\n   364→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   365→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   366→\n   367→### What happened:\n   368→\n   369→#### Task: Comprehensive Project Analysis & Specification Documents\n   370→\n   371→Performed full project analysis covering:\n   372→- All 73 frontend TypeScript files across 19 page directories\n   373→- All 43 backend TypeScript files (routes, services, middleware, models)\n   374→- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n   375→- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n   376→- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n   377→\n   378→#### Created 3 Specification Documents in `docs/requirements/`:\n   379→\n   380→1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   381→   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   382→   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   383→   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n   384→\n   385→2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   386→   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   387→   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   388→   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n   389→\n   390→3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   391→   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   392→   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n   393→\n   394→#### Updated EXECUTION-PLAN.md (v2.0):\n   395→\n   396→- Preserved Phases 0–4 (all DONE) with progress counts\n   397→- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n   398→  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n   399→  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n   400→  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n   401→  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n   402→  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n   403→- Added deferred items cross-reference table\n   404→- Added Phase 5 metrics targets\n   405→- Updated plan summary table\n   406→\n   407→### Files Changed:\n   408→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n   409→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n   410→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n   411→- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n   412→- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n   413→\n   414→### Commits:\n   415→- (pending — awaiting user instruction to commit)\n   416→\n   417→### Decisions Taken:\n   418→- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n   419→- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n   420→- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n   421→- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n   422→- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n   423→\n   424→### Pending Work:\n   425→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n   426→- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n   427→\n   428→---\n   429→\n   430→## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n   431→**Working directory:** `/mnt/c/.netapps/socialhomes`\n   432→**Agent:** Business Analyst Agent (Claude Opus 4.6)\n   433→\n   434→### What happened:\n   435→\n   436→#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n   437→\n   438→Performed full project re-analysis and updated all specification documents to v3.0.\n   439→This session built upon Session 8's initial docs with significantly enhanced content.\n   440→\n   441→#### Updated 3 Specification Documents in `docs/requirements/`:\n   442→\n   443→1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   444→   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   445→   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n   446→     (added Global Search), Persona System (with AI focus per persona), AI-Native\n   447→     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n   448→     7 differentiators, AI-augmented workflows, signature interactions),\n   449→     Data Model, UI Design (full colour palette, typography, component library),\n   450→     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   451→   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n   452→\n   453→2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   454→   - Enhanced with precise version numbers from package.json files\n   455→   - Added request flow diagram, middleware pipeline detail\n   456→   - Added accessibility implementation section\n   457→   - Added Firestore security rules and indexes references\n   458→   - Added infrastructure references (GCP project IDs, URLs)\n   459→   - Added Entire.io to infrastructure table\n   460→\n   461→3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   462→   - Cleaned up and made consistent with Doc2 endpoint registry\n   463→   - Added NOMIS Labour Market extended mock (4.9)\n   464→   - Enhanced future roadmap with Phase 6 enterprise integrations\n   465→   - Added GOV.UK Notify API endpoints section (6.4)\n   466→\n   467→#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n   468→\n   469→- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n   470→  - 5.1.8: Firestore data migration strategy\n   471→  - 5.2.11: AI communication drafting with Vertex AI\n   472→  - 5.2.12: Tenant activity scoring\n   473→  - 5.3.9: Real-time case status indicators\n   474→  - (Renumbered existing tasks for consistency)\n   475→- Added detailed task descriptions with specific implementation details\n   476→- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n   477→- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n   478→- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n   479→\n   480→### Files Changed:\n   481→- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n   482→- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n   483→- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n   484→- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n   485→- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n   486→\n   487→### Commits:\n   488→- (pending — awaiting user instruction to commit)\n   489→\n   490→### Decisions Taken:\n   491→- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n   492→- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n   493→- Created sprint-by-sprint critical path execution order\n   494→- Added agent task summary with priority breakdown\n   495→- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n   496→- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n   497→\n   498→### Pending Work:\n   499→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n   500→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   501→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   502→"}]},"uuid":"4b3d0d55-1df2-47e3-9ed8-38e77887df89","timestamp":"2026-02-25T19:28:31.650Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n","numLines":502,"startLine":1,"totalLines":502}},"sourceToolAssistantUUID":"d5796c00-a680-4a97-86a6-701c833a4f6f"}
{"parentUuid":"4b3d0d55-1df2-47e3-9ed8-38e77887df89","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01ULbgCcM58hApsgR5g7vapi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JpVF6bBvDMroVTJokDqdxh","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":57756,"cache_read_input_tokens":24751,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":57756},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLek624pUPGTsqCAaCc","type":"assistant","uuid":"0ee21326-dda3-495b-96de-81b869b1d21a","timestamp":"2026-02-25T19:28:37.748Z"}
{"parentUuid":"0ee21326-dda3-495b-96de-81b869b1d21a","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JpVF6bBvDMroVTJokDqdxh","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"c39168c2-1514-49b7-95b9-e3d3deee9f40","timestamp":"2026-02-25T19:28:37.757Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"0ee21326-dda3-495b-96de-81b869b1d21a"}
{"parentUuid":"c39168c2-1514-49b7-95b9-e3d3deee9f40","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01RBpdNHd1NPYXB8iCC4PSAs","type":"message","role":"assistant","content":[{"type":"text","text":"I now have a complete picture of the project. The existing docs are already at v5.0 and are comprehensive. I'll update them to v6.0 with refinements based on my fresh deep-dive analysis, then refresh the EXECUTION-PLAN.md. Let me create all the updated documents."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":82507,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLfFrvQWJbiYjSM2zba","type":"assistant","uuid":"f77034b0-3a7f-41e7-9383-0d84b3f4d52e","timestamp":"2026-02-25T19:28:42.744Z"}
{"parentUuid":"f77034b0-3a7f-41e7-9383-0d84b3f4d52e","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01RBpdNHd1NPYXB8iCC4PSAs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XLYcFB7d3pmKwdU9csJ73t","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/50)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":82507,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLfFrvQWJbiYjSM2zba","type":"assistant","uuid":"8643111b-2899-4499-ac80-2f03ffde38ca","timestamp":"2026-02-25T19:32:26.493Z"}
{"parentUuid":"8643111b-2899-4499-ac80-2f03ffde38ca","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XLYcFB7d3pmKwdU9csJ73t","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt has been updated successfully."}]},"uuid":"5c8dca1b-d4e4-42eb-96cc-255eb496babe","timestamp":"2026-02-25T19:32:26.661Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc1-socialhomes-Base-Specification.txt","content":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/50)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc1 — SocialHomes.Ai Base Specification","-  Version: 5.0  |  Date: 2026-02-25","+  Version: 6.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":794,"oldLines":7,"newStart":794,"newLines":7,"lines":["     Phase 2: Intelligence          — DONE (14/14)","     Phase 3: Enrichment            — DONE (14/17, 3 deferred)","     Phase 4: Completion            — DONE (11/14, 3 deferred)","-    Phase 5: Evolution             — TODO (0/44)","+    Phase 5: Evolution             — TODO (0/50)"," "," ================================================================================","   End of Doc1 — SocialHomes.Ai Base Specification"]}],"originalFile":"================================================================================\n  Doc1 — SocialHomes.Ai Base Specification\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. PRODUCT OVERVIEW\n================================================================================\n\n1.1 Product Name\n    SocialHomes.Ai\n\n1.2 Tagline\n    AI-native social housing management for UK housing associations.\n    Secondary: \"AI-native. Human-assured.\"\n\n1.3 Vision\n    To be the first truly AI-native housing management system that embeds\n    predictive intelligence, automation, and contextual assistance into every\n    screen, workflow, and decision — transforming reactive housing operations\n    into proactive, data-driven housing management.\n\n    This is NOT a legacy system with a fresh coat of paint. This must look and\n    feel like nothing the social housing sector has ever seen — think Bloomberg\n    Terminal meets Figma, not a government form. The sector is dominated by ugly,\n    slow, form-heavy systems (Civica Cx, NEC/Northgate, Aareon). SocialHomes.Ai\n    is the opposite: dark, fast, visually stunning, animated, intelligent.\n\n1.4 Target Market\n    UK Social Housing Providers:\n    - Housing Associations (Registered Providers)\n    - Local Authority housing departments\n    - ALMOs (Arms Length Management Organisations)\n    Typical scale: 5,000-20,000 housing units across multiple regions.\n\n1.5 Simulated Organisation\n    Name:           Riverside Crescent Housing Association (RCHA)\n    RP Number:      4567\n    Regulatory:     G1/V1\n    HQ:             Southwark\n    Regions:        London (Southwark, Lewisham, Lambeth), South, Midlands\n    Stock:          75 properties, 68 tenants, 279+ cases\n    Postcodes:      Real SE London postcodes (SE1, SE5, SE6, SE8, SE13, SE15, SE17, SE24)\n    UPRNs:          Realistic 12-digit references\n    EPCs:           Mapped to real certificates where available\n\n    5 Estates:\n    1. Oak Park Estate (SE15) — 3 blocks, 96 flats, 1960s concrete panel, known damp issues\n    2. Riverside Crescent (SE1) — 2 blocks, 48 flats, 2005 new build, higher-risk building\n    3. Elm Gardens (SE13) — street properties, 35 houses/maisonettes, 1930s terraces\n    4. Birch Court (SE6) — 1 block 24 flats + 8 bungalows, 1970s sheltered scheme\n    5. Maple Lane (SE24) — 1 block 20 flats + 12 houses, mixed 1980s-90s\n\n1.6 Built By\n    Yantra Works — an AI-native development studio.\n\n1.7 Live Deployment\n    URL:            https://socialhomes-587984201316.europe-west2.run.app\n    Region:         europe-west2 (London)\n    Status:         LIVE and operational\n    GitHub:         https://github.com/rajivpeter/SocialHomes_ai\n\n\n2. CORE FUNCTIONAL MODULES (17 modules)\n================================================================================\n\n2.1 Dashboard\n    Route: /dashboard\n    Purpose: Real-time operational overview with persona-scoped KPIs\n    Features:\n    - 8 KPI cards (properties, tenancies, active repairs, rent collected,\n      arrears, compliance %, open complaints, AI alerts)\n    - KPI trend sparklines (12 months)\n    - Charts row: rent collection 12-month trend vs 97% target;\n      repairs monthly volume by priority with avg days line\n    - Three panels: Big 6 compliance heatmap | Awaab's Law active cases\n      with countdown timers | AI insights scrolling feed\n    - Activity timeline with real-time system event feed\n    - Persona-scoped views (COO sees org-wide; Officer sees their patch)\n    - Quick action buttons for common tasks\n\n2.2 Visual Drill-Down Explorer (Flagship Feature)\n    Route: /explore\n    Purpose: 7-level spatial hierarchy navigation\n    Hierarchy:\n      Country -> Region -> Local Authority -> Estate -> Block -> Core -> Unit -> Tenant\n\n    Layout:\n    +--------------------------------+---------------------------------+\n    |                                |  CONTEXT PANEL (scrollable)     |\n    |      MAP / 3D VIEW (60%)       |  - Entity name & summary        |\n    |                                |  - Attribute cards               |\n    |      Interactive Leaflet map   |  - Compliance status             |\n    |      OR Three.js 3D building   |  - KPI metrics                   |\n    |      depending on zoom level   |  - AI insights (purple section)  |\n    |                                |  - Children list (next level)    |\n    |                                |  - Quick actions                  |\n    +--------------------------------+---------------------------------+\n    | Bottom bar: Level summary stats | Toggle: Map/List/3D view       |\n    | Data layer toggles: Crime / Damp Risk / Compliance               |\n    +------------------------------------------------------------------+\n\n    Features:\n    - Interactive Leaflet map with property markers (OpenStreetMap tiles)\n    - Three.js 3D building visualization (digital twin) at block level\n    - Context panel with attributes, KPIs, compliance, AI insights\n    - Color-coded units: green (compliant), amber (warning), red (critical),\n      purple (AI flag), grey (void)\n    - Data layer toggles: Crime, Damp Risk, Compliance\n    - Click-through navigation from any level\n\n    Level Details:\n    L0 Country:     England centred, 3 regions, portfolio summary\n    L1 Region:      Zoomed to region, LA areas as markers\n    L2 Local Auth:  Zoom 13, estates as clusters with mini-donuts\n    L3 Estate:      Zoom 16-17, individual buildings as footprints\n    L4 Block:       Transition to 3D view (Three.js), building-level attributes\n                    (FRA, Building Safety Case, communal systems, asbestos plan,\n                    legionella, structural surveys)\n    L4a Core:       For multi-core buildings, schematic floor plan\n    L5 Unit:        Highlighted unit in building model, tabbed detail\n                    (Overview, Compliance, Stock Condition, Damp/Awaab's Law,\n                    Works History, Documents)\n    L6 Tenant:      Full tenant record with tabbed view\n    L7 Case:        Case detail with timeline\n\n2.3 Tenancies Management\n    Route: /tenancies, /tenancies/:id\n    Purpose: Tenancy lifecycle management\n    Features:\n    - Tenancy list with search (name, address, ID, officer), filter, sort\n    - 68 tenants with dynamic count subtitle\n    - Tenancy detail: household composition, rent account, case timeline\n    - Vulnerability detection (AI 7-factor scoring)\n    - Benefits entitlement check\n    - Arrears status with color-coded balance\n    - 52-week transaction ledger with balance trend chart\n    - Action workflows: arrears action, schedule visit, create case\n    - AI Dynamic Zone: holding reply buttons, follow-up task creators,\n      referral generators, communication drafters\n\n2.4 Properties Management\n    Route: /properties, /properties/:id, /properties/:id/apply,\n           /properties/:id/book-viewing\n    Purpose: Property and asset data management\n    Features:\n    - Property list with mini Leaflet map in list view\n    - 75 properties with pagination\n    - Property detail: building attributes, compliance certificates, case history\n    - Property Passport (multi-source AI aggregation)\n    - Damp Intelligence Panel (5-factor predictive score)\n    - Compliance timeline (Big 6 certificates)\n    - Viewing bookings and allocation workflow\n    - Digital twin (3D block visualization)\n    - Application page for void properties\n\n2.5 Repairs Management\n    Route: /repairs, /repairs/:id\n    Purpose: Responsive and planned repairs case management\n    Features:\n    - 200+ repair cases with list/kanban toggle\n    - Kanban: Reported -> Diagnosed -> Scheduled -> In Progress -> Complete\n    - Priority-based SLA tracking (Emergency 24h, Urgent 5 days, Routine 28 days)\n    - Appointment booking with time slots\n    - Operative notes, before/after photos\n    - Contractor verification badges (Gas Safe green, NICEIC blue)\n    - Satisfaction survey (post-completion)\n    - Recurrence prediction (AI)\n    - Cost tracking and authorisation workflow\n    - AI-assisted repair intake: free-text -> AI auto-suggests SOR code,\n      priority, trade, Awaab's Law flags\n\n2.6 Compliance Management\n    Route: /compliance, /compliance/:type, /compliance/awaabs-law\n    Purpose: Regulatory compliance tracking and Awaab's Law\n    Features:\n    - Big 6 Dashboard: Gas, Electrical, Fire, Asbestos, Legionella, Lifts\n    - Certificate management: CP12, EICR, FRA, asbestos register, EPC, LOLER\n    - Awaab's Law dedicated page:\n      - Emergency hazard response: 24-hour countdown timer\n      - Significant hazard repair: 10-12 week countdown timer\n      - Risk register with property-level assessments\n      - Proactive inspection programme tracking\n    - Building-level compliance: FRA, Building Safety Case\n    - Unit-level compliance: Gas Safety, EICR, EPC, smoke/CO detectors\n    - Compliance failure prediction (AI)\n    - No-access tracker, contractor performance\n\n2.7 Complaints Management\n    Route: /complaints, /complaints/:id\n    Purpose: Two-stage complaints handling (Housing Ombudsman Code 2024)\n    Features:\n    - 34 complaints with status filtering\n    - Two-stage timeline: Stage 1 (ack 5WD, respond 10WD), Stage 2 (20WD)\n    - Deadline countdown timers with color-coded urgency\n    - Ombudsman escalation pathway\n    - Complaint escalation prediction (AI)\n    - Linked cases and evidence log\n    - TSM CH01/CH02 reporting integration\n    - Categories pie chart, findings breakdown, learning tracker\n\n2.8 Anti-Social Behaviour (ASB)\n    Route: /asb, /asb/:id\n    Purpose: ASB case management with escalation pipeline\n    Features:\n    - 12 ASB cases with severity indicators\n    - Escalation pipeline: Warning -> ABC -> CPW -> CPN -> Injunction -> Possession\n    - Evidence log with timestamps and categories\n    - Live Crime Context (Police.uk data correlation)\n    - ASB hotspot analysis per estate\n    - ASB escalation prediction (AI)\n    - Witness/victim support tracking\n    - Community Trigger threshold monitoring\n    - Multi-agency panel and referral forms\n\n2.9 Rent & Arrears\n    Route: /rent\n    Purpose: Rent management and arrears recovery\n    Features:\n    - Arrears dashboard with band analysis\n    - Pre-Action Protocol (PAP) checklist\n    - Arrears worklist with AI-prioritised scoring (1-100)\n    - Universal Credit tracking and verification\n    - Payment arrangement management\n    - Direct debit integration (GoCardless mock)\n    - HB/UC transition tracking\n    - Arrears risk prediction (AI)\n    - 12-month payment trend analysis\n    - Collection rate gauge, payment method breakdown\n\n2.10 Allocations & Lettings\n    Route: /allocations\n    Purpose: Void management and lettings workflow\n    Features:\n    - Housing register management (Band A-D, bedroom need, medical priority)\n    - Void property kanban: Notice -> Keys -> Inspection -> Works -> Quality\n      -> Ready -> Offer -> Let\n    - Void duration prediction (AI)\n    - Days void RAG indicators (green <14, amber 14-28, red >28)\n    - Applicant shortlisting and matching\n    - Viewing booking system\n    - Tenancy sign-up workflow\n    - CORE lettings/sales reporting\n\n2.11 Communications\n    Route: /communications\n    Purpose: Unified multi-channel inbox\n    Features:\n    - Unified inbox (email, SMS, letter, portal message)\n    - GOV.UK Notify template integration (24 templates, 7 categories)\n    - Template rendering with ((field)) personalisation\n    - Message history per tenant\n    - Bulk communications\n    - Auto-triggered notifications (repair booked, arrears warning, etc.)\n    - AI triage: auto-categorise, priority, sentiment, suggested response\n    - Tone options: Supportive / Formal / Urgent / Legally required\n\n2.12 Reports & Analytics\n    Route: /reports, /reports/:type, /reports/tsm\n    Purpose: Regulatory reporting and operational analytics\n    Features:\n    - 27 regulatory reports\n    - TSM (Tenant Satisfaction Measures) — 22 measures with benchmarking\n    - CORE lettings and sales returns\n    - Consumer Standards compliance scorecard\n    - Housing Ombudsman reporting\n    - Building Safety Act compliance reporting\n    - Dynamic report builder with filters\n    - CSV/PDF export capability\n    - Trend charts, sector median/quartile benchmarking\n    - AI-generated narrative summary per report\n    Report Categories:\n    - Regulatory: TSM, CORE, Consumer Standards, Ombudsman, BSA, SDR\n    - Operational: Repairs, Voids, Arrears, Complaints, ASB, Contact Centre\n    - Compliance: Big 6 daily/weekly, Awaab's Law, Decent Homes, Stock,\n      EPC/Energy\n    - Financial: Rent setting, service charge, repairs expenditure, bad debt,\n      void loss\n    - Governance: Board pack, risk register, H&S summary\n    - Tenant-facing: Annual report, estate reports\n\n2.13 AI Centre\n    Route: /ai-centre\n    Purpose: AI capabilities hub and differentiator showcase\n    Features:\n    - Insights tab: AI-generated operational insights with confidence %,\n      affected entities, action buttons\n    - Predictions tab: 8 predictive models dashboard with scatter plots,\n      top-50 table, feature importance, accuracy gauges\n    - Differentiators tab: 7 killer differentiator feature cards with\n      vulnerability scan\n    - Assistant tab: Conversational AI interface (Yantra Assist)\n\n2.14 AI Morning Briefing\n    Route: /briefing\n    Purpose: Personalised daily operational briefing\n    Features:\n    - Persona-aware greeting (\"Good morning Sarah, here's what needs your\n      attention today\")\n    - Weather forecast with property impact assessment\n    - Today's tasks with priority indicators and action buttons\n    - AI predictions and alerts\n    - Estate-level neighbourhood briefing accordion\n    - Compliance section with Big 6 stats\n    - [Start my day ->] and [Skip briefing] buttons\n\n2.15 Admin System\n    Route: /admin, /admin/integrations\n    Purpose: System configuration and management\n    Features:\n    - Organisation profile and branding\n    - User management with RBAC (10 default roles x permission matrix)\n    - Team and patch management with caseload balancing\n    - Workflow engine (visual builder with triggers/conditions/actions)\n    - Integration hub (20 integrations across 3 tiers)\n    - Integration toggle, test connection, status monitoring\n    - Audit trail (full CRUD logging — timestamp, user, entity, field,\n      old/new value, IP)\n    - GDPR tools (SAR processor, right to erasure, retention policies,\n      consent management, Data Processing Register)\n    - System reference data configuration (editable lookup tables)\n    - Notification configuration\n    - AI model configuration (toggle on/off, confidence thresholds)\n    - White-label: multi-HA deployment support\n\n2.16 Tenant Portal\n    Route: /tenant-portal\n    Purpose: Tenant self-service interface\n    Features:\n    - Distinct lighter/warmer UI theme (visually separate from staff system)\n    - Report repair (conversational wizard: room -> problem -> photo ->\n      appointment -> confirm)\n    - Check rent balance and make payment\n    - View active repairs with photos and status\n    - Quick message to housing officer\n    - Document access\n    - Larger text, no jargon, large touch targets\n\n2.17 Global Search\n    Route: /search\n    Purpose: Cross-entity full-text search\n    Features:\n    - Global search bar in header\n    - Searches across tenants, properties, cases, communications\n    - Results grouped by entity type\n    - Direct navigation to entity detail\n\n\n3. PERSONA SYSTEM\n================================================================================\n\n3.1 Overview\n    5 operational personas with scoped data visibility and dashboard layout.\n    Persona selection via sidebar switcher. Persisted per session.\n\n3.2 Persona Definitions\n\n    PERSONA 1: Chief Operating Officer (COO)\n    Scope: Organisation-wide\n    Dashboard: High-level KPIs, financial summary, compliance overview,\n              risk heatmap\n    Access: Full read/write, admin settings, reports\n    AI Focus: Strategic — regulatory risk, portfolio compliance trends,\n              financial performance, TSM trajectory\n    AI Actions: \"Generate board report\", \"Model rent increase scenarios\",\n                \"Benchmark against sector\"\n\n    PERSONA 2: Head of Housing\n    Scope: Regional (multiple Local Authorities)\n    Dashboard: Regional performance, team metrics, escalated cases\n    Access: Team management, regional reports, case oversight\n    AI Focus: Operational — SLA performance, team capacity, complaint trends\n    AI Actions: \"Rebalance team caseloads\", \"Generate performance review\"\n\n    PERSONA 3: Housing Manager\n    Scope: Estate/Block level\n    Dashboard: Estate KPIs, staff workload, compliance deadlines\n    Access: Case assignment, approval workflows, local reports\n    AI Focus: Team management — workload, case overdue, skill gaps\n    AI Actions: \"Reassign cases\", \"Generate patch briefing\"\n\n    PERSONA 4: Housing Officer (THE MOST IMPORTANT)\n    Scope: Assigned patch (specific estates/blocks)\n    Dashboard: Caseload worklist, today's visits, tenant alerts\n    Access: Case CRUD, tenant interactions, notes\n    AI Focus: What to do TODAY — appointments, calls, tasks, cases needing action\n    AI Actions: Richest set — holding reply buttons, follow-up task creators,\n                referral generators, communication drafters on every page\n\n    PERSONA 5: Repairs Operative\n    Scope: Assigned jobs\n    Dashboard: Today's job list, materials, access notes\n    Access: Repair status updates, photos, completion notes\n    AI Focus: Today's jobs, access codes, risk alerts, vulnerability flags\n    No access to: Financial data, personal tenant details beyond job needs\n\n\n4. AI-NATIVE FEATURES\n================================================================================\n\n4.1 Core Principle: Dynamic AI Interface Elements\n    Every entity page has TWO zones:\n    1. Standard zone: Fixed fields, tabs, buttons — always present\n    2. AI Dynamic zone: Purple-tinted border, AI-generated elements that\n       change based on context\n\n    Dynamic elements include:\n    - Dynamic action buttons — only appear when AI determines they're relevant\n    - Dynamic info cards — contextual information the system thinks user needs\n    - Dynamic prompts — questions AI asks user, answering triggers workflows\n    - Dynamic warnings — alerts about this entity needing attention\n    - Dynamic information fields — calculated data not in standard layout\n\n    Styling: Purple left border (--status-ai), --surface-elevated background,\n    \"*\" symbol prefix on AI-generated content\n\n4.2 The AI Action Flow Pattern\n    Every AI dynamic button follows this pattern:\n    1. PRESENT: Button with brief explanation of WHY it's suggesting the action\n    2. PREVIEW: Click shows preview (drafted email, pre-filled form, etc.)\n    3. EDIT: User can edit anything in the preview\n    4. CONFIRM: User approves the action\n    5. FOLLOW-UP: AI asks about follow-up tasks, linked cases, notifications\n    6. AUTO-CREATE: If confirmed, AI creates everything with minimal input\n    7. LEARN: System records accept/modify/reject for model improvement\n\n4.3 Yantra Assist\n    Location: Bottom-left floating trigger (all pages)\n    Trigger: Yantra diamond mark at 32px with pulsing purple glow\n    Panel: 400px, slides from left, overlaying sidebar\n    Content changes based on current page/entity AND user persona\n\n    Panel Structure:\n    - RED URGENT: Items needing immediate action\n    - ORANGE ATTENTION: Items approaching deadlines\n    - INSIGHTS: AI predictions & recommendations\n    - BRIEFING: Contextual summary & key stats\n    - EXTERNAL FACTORS: Weather, UC changes, local context\n    - [Ask Yantra...] chat input at bottom\n\n    Current State: Mock chat interface (Phase 5 adds real Vertex AI / Gemini)\n\n4.4 Prediction Models (8 total)\n    MODEL 1: Arrears Risk\n      Input: Payment history, UC status, seasonal patterns, life events\n      Output: Risk score (0-100), predicted arrears amount, recommended actions\n\n    MODEL 2: Damp & Mould Risk\n      Input: Weather (0.25), building age/type (0.25), repair history (0.20),\n             IoT sensors (0.20), occupancy (0.10)\n      Output: Risk score (0-100), factor breakdown, proactive recommendations\n\n    MODEL 3: Complaint Escalation\n      Input: Response times, complaint category, tenant history, complexity\n      Output: Escalation probability, recommended priority, deadline warnings\n\n    MODEL 4: Void Duration\n      Input: Property type, condition, location, market demand, works needed\n      Output: Predicted void days, optimal marketing strategy\n\n    MODEL 5: Repair Recurrence\n      Input: Component age, repair history, building type, contractor quality\n      Output: Recurrence probability, recommended planned maintenance\n\n    MODEL 6: Vulnerability Detection\n      Input: IMD deprivation (0.20), arrears history (0.20), health flags (0.15),\n             social isolation (0.15), age risk (0.10), dependents (0.10),\n             UC transition (0.10)\n      Output: Vulnerability score (0-100), detected flags, recommended support\n\n    MODEL 7: ASB Escalation\n      Input: Case history, estate context, crime data, tenant profile\n      Output: Escalation risk, recommended intervention level\n\n    MODEL 8: Compliance Failure\n      Input: Certificate expiry, contractor availability, building complexity\n      Output: Failure probability, priority scheduling recommendations\n\n4.5 Seven Killer Differentiators (All Implemented)\n    D1: Predictive Damp Intelligence — 5-factor weighted algorithm\n        Service: server/src/services/damp-prediction.ts\n        Frontend: DampIntelligencePanel component on property detail\n\n    D2: Live Crime Context for ASB — Police.uk data correlation\n        Service: server/src/services/crime-context.ts\n        Frontend: Crime data layer on Explore map, ASB detail page\n\n    D3: Automatic Vulnerability Detection — 7-factor scoring\n        Service: server/src/services/vulnerability-detection.ts\n        Frontend: VulnerabilityPanel on tenancy detail, AI Centre scan\n\n    D4: Property Passport — Multi-source property dossier\n        Service: server/src/services/property-passport.ts\n        Frontend: Property detail page aggregation\n\n    D5: Benefits Entitlement Engine — UK 2025/26 benefit rules\n        Service: server/src/services/benefits-engine.ts\n        Frontend: BenefitsPanel on tenancy detail\n\n    D6: AI Neighbourhood Briefing — Per-estate daily intelligence\n        Service: server/src/services/neighbourhood-briefing.ts\n        Frontend: NeighbourhoodBriefingPanel on briefing page\n\n    D7: IoT Sensor Integration — Switchee/Aico device support (mock)\n        Service: server/src/services/mock-services.ts\n        Frontend: Property detail page (sensor data display)\n\n4.6 AI-Augmented Workflows\n    - Repair Logging: Tenant describes issue -> AI categorises SOR code,\n      assigns priority, identifies trade, checks asbestos, checks vulnerability,\n      checks recurring pattern, estimates cost, flags Awaab's Law\n    - Inbound Contact Triage: AI reads/summarises contact, categorises,\n      suggests appropriate case type, pre-fills forms\n    - Communication Sending: AI generates drafts using correct templates,\n      tenant details, plain English, legally required wording, tone options\n    - Compliance Review: AI shows what will expire, impact on TSM, pre-drafted\n      contractor instructions, pre-booked appointments\n    - Complaint Prevention: AI detects patterns (multiple calls, declining\n      satisfaction), generates prevention plan\n\n4.7 Signature AI Interactions\n    1. \"Holding Reply\" Flow — pre-drafted email -> edit -> send -> follow-up task\n    2. \"Inbound Email Triage\" — AI reads -> categorises -> creates case(s)\n    3. \"Proactive Damp Prevention\" — weather forecast -> risk cross-reference\n       -> preventive advice letters -> inspection tasks\n    4. \"Compliance Cascade\" — batch contractor booking -> letters -> calendar\n    5. \"Complaint Prevention\" — pattern detection -> prevention plan execution\n\n\n5. DATA MODEL (SUMMARY)\n================================================================================\n\n5.1 Core Entities\n    - Property (75 records) — address, UPRN, type, bedrooms, EPC, compliance\n    - Tenant (68 records) — name, contact, vulnerability, household, UC status\n    - Tenancy — property-tenant link, start date, type, rent, balance\n    - Case (279+ records) — unified: repair, complaint, ASB, financial, damp-mould\n    - Repair (200 records) — SOR code, priority, SLA, appointments, contractor\n    - Complaint (34 records) — stage, deadlines, Ombudsman reference\n    - ASB (12 records) — severity, escalation level, evidence log\n    - Activity — timeline events for any entity\n    - Task — assigned work items with due dates\n\n5.2 Supporting Entities\n    - Organisation — RCHA metadata, branding, settings\n    - Region (5 seeded) — London, South, Midlands, etc.\n    - Local Authority — Southwark, Lewisham, Lambeth\n    - Estate (5) — name, location, block count, manager\n    - Block (8) — floors, cores, unit count\n    - User — auth profile, role, persona, team\n    - Team — name, manager, patch, members\n    - Integration — external service config (20 integrations)\n    - Report — template definitions (27 reports)\n    - ExternalDataCache — TTL-based cache for API responses\n\n5.3 Firestore Collections (17+)\n    organisations, regions, localAuthorities, estates, blocks,\n    properties, tenants, cases, activities, communications,\n    rentTransactions, users, auditLog, notifications,\n    voidProperties, applicants, tsmMeasures, externalDataCache,\n    hactCodes, imdData\n\n5.4 Case Reference Formats\n    | Type        | Format           | Colour  |\n    |-------------|------------------|---------|\n    | Complaint   | CMP-YYYY-XXXXX   | Orange  |\n    | Repair      | REP-YYYY-XXXXX   | Blue    |\n    | ASB         | ASB-YYYY-XXXXX   | Red     |\n    | Enquiry     | ENQ-YYYY-XXXXX   | Grey    |\n    | Financial   | FIN-YYYY-XXXXX   | Amber   |\n    | Safeguarding| SAF-YYYY-XXXXX   | Purple  |\n    | Damp/Mould  | DAM-YYYY-XXXXX   | Teal    |\n\n5.5 TypeScript Type System (721 lines)\n    Frontend types defined in app/src/types/index.ts covering:\n    - 6 persona/user types (Persona, User)\n    - 7 geography types (Region, LocalAuthority, Estate, Block)\n    - 10 property types (Property, ComplianceStatus, StockComponent, etc.)\n    - 8 tenant types (Tenant, HouseholdMember, VulnerabilityFlag, etc.)\n    - 12 case types (Case, Repair, Complaint, AsbCase, FinancialCase, DampMouldCase)\n    - 8 activity/task types (Activity, Task, RentTransaction, etc.)\n    - 6 AI types (AiInsight, AiAction, AiWorkflowStep, etc.)\n    - 4 admin types (AuditEntry, WorkflowTemplate, Integration, etc.)\n    - 8 external API types (CrimeIncident, DeprivationProfile, WeatherDetail, etc.)\n    - 4 composite types (DampRiskBreakdown, VulnerabilityAssessment, etc.)\n\n\n6. USER INTERFACE DESIGN\n================================================================================\n\n6.1 Theme\n    Brand: Yantra Works dark theme\n    Primary Background: --surface-dark (#0D1117)\n    Card Background: --surface-card (#151B23)\n    Elevated: --surface-elevated (#1C2333)\n    Hover: --surface-hover (#222D3D)\n    Accent: --brand-teal (#058995)\n    Secondary Accents: --brand-peach (#EFAC92), --brand-garnet (#BE3358)\n    AI Colour: --status-ai (#A371F7) — purple for all AI elements\n    Status: green (#2EA043), amber (#EFAC92), red (#BE3358), info (#5BA4AA)\n\n6.2 Typography\n    Headings: \"Space Grotesk\", sans-serif — bold, technical\n    Body: \"Inter\", Arial, sans-serif — clean, readable (15px, line-height 1.6)\n    Monospace: \"JetBrains Mono\", monospace — references, codes\n    Headings in --brand-peach on dark backgrounds\n    Section labels: --brand-teal, uppercase, letter-spaced\n\n6.3 Layout\n    - Fixed left sidebar (280px, collapsible to 64px) with 14+ navigation items\n    - Top header with logo, global search, notifications, AI trigger, user menu\n    - Breadcrumb navigation reflecting hierarchy\n    - Main content area with responsive grid (max 1400px)\n    - Yantra Assist floating panel (bottom-left)\n    - Phase banner: garnet \"BETA\" tag\n\n6.4 Navigation Items (Sidebar)\n    NAVIGATE: Explore, Dashboard\n    MANAGE: Tenancies, Properties, Repairs, Rent & Income, Compliance,\n            Complaints, Allocations, ASB\n    COMMUNICATE: Communications\n    ANALYSE: Reports, AI Centre\n    SYSTEM: Admin, Settings\n    + Persona Switcher\n\n6.5 Design Principles\n    - Dark mode is default — Yantra Works brand palette throughout\n    - Mobile-aware responsive design\n    - WCAG AA compliant (contrast >= 4.5:1, focus, keyboard, ARIA)\n    - Skip-to-content link\n    - Reduced-motion support (@media prefers-reduced-motion)\n    - Focus-visible outlines on all interactive elements\n    - Screen-reader-only (.sr-only) text for context\n    - Animations throughout — staggered reveals, sliding panels, smooth\n      transitions, pulsing alerts. UI must feel ALIVE, not static.\n    - UK conventions: DD/MM/YYYY, British English, GBP\n\n6.6 Component Library (16 shared components)\n    - KpiCard — metric display with trend sparkline\n    - StatusPill — status badge (green/amber/red)\n    - ActionModal — accessible form modal with focus trap, Escape handler,\n      aria attributes, form validation, previous focus restoration\n    - AiActionCard — purple-bordered AI suggestion card\n    - CountdownTimer — deadline countdown with color urgency transitions\n      (green -> peach -> garnet -> pulsing garnet)\n    - PropertyMap — Leaflet map with markers\n    - HelpDrawer — full-screen contextual help (20 topics)\n    - DampIntelligencePanel — damp risk factor display with score badge\n    - VulnerabilityPanel — 7-factor vulnerability assessment\n    - BenefitsPanel — entitlement list with status icons, unclaimed amounts\n    - NeighbourhoodBriefingPanel — 6 summary cards, officer briefing, actions\n    - ProtectedRoute — Firebase auth guard component\n    - YantraAssist — slide-in panel (320px from right) with context-aware\n      content, chat interface, urgency sections\n\n\n7. REGULATORY COMPLIANCE\n================================================================================\n\n7.1 Housing Regulations Supported\n    - Housing Ombudsman Complaint Handling Code (2024)\n    - Awaab's Law (Social Housing Regulation Act 2023)\n    - Building Safety Act 2022\n    - Regulator of Social Housing (RSH) Consumer Standards\n    - Tenant Satisfaction Measures (TSM) Standard\n    - CORE lettings and sales data collection\n    - Gas Safety (Installation and Use) Regulations 1998\n    - Electrical Safety Standards in the Private Rented Sector\n    - Regulatory Reform (Fire Safety) Order 2005\n    - Control of Asbestos Regulations 2012\n    - Legionella risk assessment (HSE ACoP L8)\n    - LOLER (Lifting Operations and Lifting Equipment Regulations)\n\n7.2 GDPR Compliance\n    - Full audit trail on all data operations\n    - Subject Access Request (SAR) processor\n    - Right to erasure workflow\n    - Data retention policy configuration\n    - Consent management\n    - Data Processing Register\n\n7.3 Accessibility (WCAG AA)\n    - Focus traps in modals (ActionModal)\n    - Skip-to-content link (Layout component)\n    - Keyboard navigation (Tab, Escape)\n    - ARIA labels, roles, described-by\n    - Reduced-motion media query\n    - Color contrast ratio >= 4.5:1\n    - Screen-reader-only text (.sr-only)\n    - Focus-visible outlines (*:focus-visible)\n\n\n8. NON-FUNCTIONAL REQUIREMENTS\n================================================================================\n\n8.1 Performance\n    - API response time (P95): < 500ms (current ~200-300ms)\n    - Frontend bundle size: < 3MB (current ~2.5MB)\n    - Cloud Run cold start: < 3s (current < 2s)\n    - Firestore query latency: < 200ms\n    - AI response latency (target): < 3s for conversational queries\n\n8.2 Security\n    - Firebase Authentication with Google sign-in\n    - RBAC with 10 default roles (super-admin through read-only)\n    - CSP headers with whitelist\n    - CORS restricted to allowed origins\n    - Rate limiting (4 tiers: API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n    - Security headers (Permissions-Policy, X-Content-Type-Options,\n      X-Frame-Options, Referrer-Policy, HSTS)\n    - Secret Manager for all credentials (no secrets in code)\n    - JSON body limit 1MB\n    - Request correlation via X-Request-ID\n\n8.3 Scalability\n    - Cloud Run: 0-10 instances (auto-scaling)\n    - Firestore: NoSQL, horizontally scalable\n    - External API caching reduces load\n    - Concurrency: 80 requests/instance\n\n8.4 Availability\n    - Cloud Run SLA: 99.95%\n    - External API fallbacks (simulated data on failure)\n    - Health check with Firestore connectivity monitoring\n    - States: healthy / degraded / unhealthy\n\n8.5 Testing\n    - Selenium E2E: 331 tests, 99.7% pass rate\n    - Unit tests: 66 tests for public data APIs\n    - TypeScript: 0 errors (strict mode)\n    - Vite build: 0 critical warnings\n\n\n9. SIMULATED DATA\n================================================================================\n\n9.1 Scale\n    75 properties, 68 active tenancies, 5 voids\n    Realistic SE London postcodes, 12-digit UPRNs\n    Diverse tenant names reflecting London demographics\n\n9.2 Financial Profile\n    Rents: social GBP 95-140/week, affordable GBP 140-200/week\n    Service charges: GBP 5-35/week\n    Payment methods: DD 35%, UC 30%, SO 15%, Card 10%, Cash 5%, HB 5%\n    Arrears: 60% nil, 20% <GBP250, 10% GBP250-500, 5% GBP500-1k, 5% >GBP1k\n\n9.3 Cases\n    200 repairs (5% emergency, 15% urgent, 70% routine, 10% planned)\n    34 open complaints (28 Stage 1, 6 Stage 2)\n    12 ASB cases\n    8 damp/mould cases (3 emergency, 5 significant)\n    25 financial cases\n    5 voids at various pipeline stages\n\n9.4 Compliance\n    Gas 99.4%, Electrical 97.8%, Fire 99.1%\n    Asbestos 98.5%, Legionella 99.0%, Lifts 100%\n\n\n10. CURRENT STATUS & METRICS\n================================================================================\n\n10.1 Production Deployment\n    URL: https://socialhomes-587984201316.europe-west2.run.app\n    Region: europe-west2 (London)\n    Status: LIVE and operational\n    Database: 460+ documents across 17+ Firestore collections\n\n10.2 Build Metrics\n    | Metric                    | Value           |\n    |---------------------------|-----------------|\n    | Frontend modules          | 3,397           |\n    | Frontend build time       | ~35-39 seconds  |\n    | Backend TypeScript errors | 0               |\n    | Frontend TypeScript errors| 0               |\n    | Selenium tests            | 331             |\n    | Selenium pass rate        | 99.7%           |\n    | Unit tests (public data)  | 66              |\n    | Firestore collections     | 17+             |\n    | Seeded properties         | 75              |\n    | Seeded tenants            | 68              |\n    | Seeded cases              | 279+            |\n    | API endpoints             | 50+             |\n    | Frontend routes           | 40+             |\n    | Lines of code             | ~24,000         |\n    | Frontend TypeScript files | 73              |\n    | Backend TypeScript files  | 43              |\n    | Type definitions          | 721 lines       |\n\n10.3 Phase Completion\n    Phase 0: Infrastructure        — DONE (10/10)\n    Phase 1: Foundation            — DONE (12/12)\n    Phase 2: Intelligence          — DONE (14/14)\n    Phase 3: Enrichment            — DONE (14/17, 3 deferred)\n    Phase 4: Completion            — DONE (11/14, 3 deferred)\n    Phase 5: Evolution             — TODO (0/44)\n\n================================================================================\n  End of Doc1 — SocialHomes.Ai Base Specification\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"8643111b-2899-4499-ac80-2f03ffde38ca"}
{"parentUuid":"5c8dca1b-d4e4-42eb-96cc-255eb496babe","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01P2kCSCrWgxnyhKraCiCjNh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BvnjZ4c5MxpKdWa1cCRhav","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":9805,"cache_read_input_tokens":82875,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9805},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLx5FAmYMWhehZQYoUu","type":"assistant","uuid":"07d24aee-96d3-44f8-a40c-57e0b702c100","timestamp":"2026-02-25T19:32:32.981Z"}
{"parentUuid":"07d24aee-96d3-44f8-a40c-57e0b702c100","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BvnjZ4c5MxpKdWa1cCRhav","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"27842b25-2b52-4c67-ba4b-57bfefc14095","timestamp":"2026-02-25T19:32:32.987Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"in_progress","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"pending","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"07d24aee-96d3-44f8-a40c-57e0b702c100"}
{"parentUuid":"27842b25-2b52-4c67-ba4b-57bfefc14095","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_017NPUSJGsRe8Xv3w5Sx3oFw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0127TnsUKg22Tt719a15djVQ","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                              |\n                                                     +--------v---------+\n                                                     |    blocks (8)    |\n                                                     +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":92680,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVLxdE2J1A2khSWMj53z","type":"assistant","uuid":"91df4ebc-16a7-4f88-9f84-a775bec71bc5","timestamp":"2026-02-25T19:35:59.158Z"}
{"parentUuid":"91df4ebc-16a7-4f88-9f84-a775bec71bc5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0127TnsUKg22Tt719a15djVQ","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt has been updated successfully."}]},"uuid":"9a503c14-e0d9-4df5-941d-a3ddcf88f570","timestamp":"2026-02-25T19:35:59.328Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc2-socialhomes-Technical-Architecture.txt","content":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                              |\n                                                     +--------v---------+\n                                                     |    blocks (8)    |\n                                                     +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc2 — SocialHomes.Ai Technical Architecture & Data Models","-  Version: 5.0  |  Date: 2026-02-25","+  Version: 6.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]},{"oldStart":380,"oldLines":10,"newStart":380,"newLines":10,"lines":["     +------------------+     +------------------+     +------------------+","     |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |","     +------------------+     +------------------+     +--------+---------+","-                                                               |","-                                                      +--------v---------+","-                                                      |    blocks (8)    |","-                                                      +------------------+","+                                                              |","+                                                     +--------v---------+","+                                                     |    blocks (8)    |","+                                                     +------------------+"," "," 5.2 Property Schema"," "]}],"originalFile":"================================================================================\n  Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. SYSTEM ARCHITECTURE OVERVIEW\n================================================================================\n\n1.1 Architecture Style\n    Monorepo with separate frontend (SPA) and backend (REST API) builds,\n    deployed as a single container on Google Cloud Run. The Express server\n    serves both the API and the built React static assets.\n\n1.2 High-Level Architecture Diagram (ASCII)\n\n    +-------------------------------------------------------------+\n    |                        CLOUD RUN (europe-west2)              |\n    |  +-----------------------------------------------------------+\n    |  |                    Express.js Server                      |\n    |  |  +--------------+  +--------------+  +---------------+   |\n    |  |  | Static Files |  |   API v1     |  |  Middleware    |   |\n    |  |  | (React SPA)  |  |  /api/v1/*   |  | Auth/RBAC/    |   |\n    |  |  |              |  |              |  | Rate Limit/   |   |\n    |  |  | Vite Build   |  | 16 route     |  | Metrics/CSP   |   |\n    |  |  | Output       |  | modules      |  |               |   |\n    |  |  +--------------+  +------+-------+  +---------------+   |\n    |  +---------------------------+-------------------------------+\n    |                              |                                |\n    |  +---------------------------+-------------------------------+\n    |  |                    Service Layer (25 modules)             |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  |  | AI      | | External | | GOV.UK   | | Mock        |   |\n    |  |  | Services| | API      | | Notify   | | Services    |   |\n    |  |  | (7)     | | Proxy    | | (24 tmpl)| | (5 Tier 3)  |   |\n    |  |  +---------+ +----------+ +----------+ +-------------+   |\n    |  +---------------------------+-------------------------------+\n    +------------------------------+--------------------------------+\n                                   |\n              +--------------------+--------------------+\n              |                    |                     |\n    +---------v------+  +---------v------+  +----------v-----+\n    |   Firestore    |  |  Firebase Auth |  | Secret Manager |\n    |  (17+ colls)   |  |  (Google SSO)  |  |  (4 secrets)   |\n    +----------------+  +----------------+  +----------------+\n              |\n    +---------v--------------------------------------------+\n    |              External APIs (3 Tiers)                 |\n    |  Tier 1: Police.uk, Open-Meteo, DEFRA               |\n    |  Tier 2: Postcodes.io, EPC, NOMIS, Gas Safe, etc.   |\n    |  Tier 3: DWP, IoT, GoCardless, etc. (mocked)        |\n    +------------------------------------------------------+\n\n1.3 Request Flow Diagram\n\n    Browser -> React SPA -> api-client.ts -> HTTP Request\n                                              |\n                                              v\n    Express Server <- Middleware Pipeline <- Route Handler\n         |               |\n         |     +-------------------------------------------+\n         |     | Morgan -> Helmet -> CORS -> Compression   |\n         |     | -> JSON Parser (1MB) -> X-Request-ID      |\n         |     | -> Rate Limiter -> Metrics -> Handler     |\n         |     | -> Error Handler -> Response               |\n         |     +-------------------------------------------+\n         |\n         +---> Firestore (read/write)\n         +---> External API Proxy (with cache)\n         +---> AI Service (computation)\n\n\n2. TECHNOLOGY STACK\n================================================================================\n\n2.1 Frontend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | React                   | 19.2.0     |\n    | Language           | TypeScript              | 5.9.3      |\n    | Router             | React Router            | v7         |\n    | Styling            | Tailwind CSS            | 4.1.18     |\n    | State Management   | React Context + Hooks   | --         |\n    | Data Fetching      | @tanstack/react-query   | 5.90.20    |\n    | 3D Visualization   | Three.js + React Three  | 0.182.0    |\n    | Maps               | Leaflet + React Leaflet | 1.9.4/5.0  |\n    | Charts             | Recharts + D3.js        | 3.7.0/7.9  |\n    | Icons              | Lucide React            | 0.563.0    |\n    | Auth UI            | FirebaseUI              | latest     |\n    | Build Tool         | Vite                    | 7.2.4      |\n\n2.2 Backend Stack\n\n    | Component          | Technology              | Version    |\n    |--------------------|-------------------------|------------|\n    | Framework          | Express.js              | 4.21.2     |\n    | Language           | TypeScript              | 5.7.0      |\n    | Runtime            | Node.js                 | 20.17.0    |\n    | Database           | Google Firestore        | Native     |\n    | Auth               | Firebase Admin SDK      | 13.6.1     |\n    | Security           | Helmet                  | 8.1.0      |\n    | CORS               | cors                    | 2.8.5      |\n    | Logging            | Morgan                  | 1.10.0     |\n    | Compression        | compression             | 1.8.0      |\n    | Testing            | Vitest                  | 4.0.18     |\n    | Build              | tsc + tsx                | latest     |\n\n2.3 Infrastructure\n\n    | Component          | Technology              | Details              |\n    |--------------------|-------------------------|----------------------|\n    | Hosting            | Google Cloud Run        | europe-west2         |\n    | Container Registry | Artifact Registry       | europe-west2         |\n    | Database           | Google Firestore        | Native mode          |\n    | Authentication     | Firebase Auth           | Google SSO + email   |\n    | Secrets            | Secret Manager          | 4 secrets            |\n    | CI/CD              | Cloud Build             | Auto on git push     |\n    | Source Control     | GitHub                  | rajivpeter repo      |\n    | Monitoring         | Custom metrics + health | In-app               |\n    | Session Capture    | Entire.io               | Manual commit        |\n\n2.4 Testing Stack\n\n    | Component          | Technology              | Coverage             |\n    |--------------------|-------------------------|----------------------|\n    | E2E                | Selenium WebDriver      | 331 tests (99.7%)    |\n    | Unit               | Vitest                  | 66 tests             |\n    | Type Checking      | TypeScript (strict)     | 0 errors             |\n\n\n3. FRONTEND ARCHITECTURE\n================================================================================\n\n3.1 Directory Structure\n\n    app/src/\n    +-- App.tsx                  -- Router with 40+ routes\n    +-- main.tsx                 -- React DOM entry point (QueryClient)\n    +-- index.css                -- Global styles, animations, accessibility\n    |\n    +-- pages/                   -- 19 page directories\n    |   +-- admin/               -- AdminPage, IntegrationsPage\n    |   +-- ai-centre/           -- AiCentrePage (Insights/Predictions/Differentiators)\n    |   +-- allocations/         -- AllocationsPage\n    |   +-- asb/                 -- AsbPage, AsbDetailPage\n    |   +-- auth/                -- LoginPage (Firebase + Google)\n    |   +-- briefing/            -- BriefingPage (morning briefing + neighbourhood)\n    |   +-- communications/      -- CommunicationsPage\n    |   +-- complaints/          -- ComplaintsPage, ComplaintDetailPage\n    |   +-- compliance/          -- CompliancePage, ComplianceTypePage, AwaabsLawPage\n    |   +-- dashboard/           -- DashboardPage (8 KPIs, charts, activity)\n    |   +-- explore/             -- ExplorePage (7-level drill-down)\n    |   +-- properties/          -- PropertiesPage, PropertyDetailPage,\n    |   |                          ApplicationPage, ViewingBookingPage\n    |   +-- rent/                -- RentPage\n    |   +-- repairs/             -- RepairsPage, RepairDetailPage\n    |   +-- reports/             -- ReportsPage, DynamicReportPage, TsmReportPage\n    |   +-- search/              -- SearchPage\n    |   +-- tenancies/           -- TenanciesPage, TenancyDetailPage\n    |   +-- tenant-portal/       -- TenantPortalPage\n    |   +-- shared/              -- ComingSoonPage\n    |\n    +-- components/\n    |   +-- layout/              -- Layout, Header, Sidebar, Breadcrumbs, YantraAssist\n    |   +-- shared/              -- 12 reusable components (ActionModal, AiActionCard,\n    |                              BenefitsPanel, CountdownTimer, DampIntelligencePanel,\n    |                              HelpDrawer, KpiCard, NeighbourhoodBriefingPanel,\n    |                              PropertyMap, StatusPill, VulnerabilityPanel)\n    |\n    +-- data/                    -- Mock/seed data (10 files)\n    +-- hooks/                   -- Custom hooks (3 files)\n    |   +-- useApi.ts            -- 23 React Query hooks wrapping API methods\n    |   +-- useEntityIntelligence.ts  -- AI scoring hooks\n    |   +-- usePersonaScope.ts   -- Persona-based data filtering\n    +-- types/                   -- TypeScript definitions (721 lines)\n    +-- services/                -- API client (70+ methods), Firebase, AI drafting,\n    |                              public data helpers\n    +-- contexts/                -- AuthContext, AppContext\n    +-- utils/                   -- Formatting utilities (safeText, etc.)\n    +-- assets/                  -- Images, fonts\n\n3.2 Routing Architecture (React Router v7)\n    All routes defined in App.tsx within BrowserRouter.\n    Routes wrapped in Layout component (sidebar + header).\n    Protected routes use ProtectedRoute component (Firebase auth guard).\n\n    Key Route Groups:\n    /                            -> Redirect to /dashboard\n    /login                       -> LoginPage (public)\n    /dashboard                   -> DashboardPage\n    /explore                     -> ExplorePage\n    /tenancies                   -> TenanciesPage\n    /tenancies/:id               -> TenancyDetailPage\n    /properties                  -> PropertiesPage\n    /properties/:id              -> PropertyDetailPage\n    /properties/:id/apply        -> ApplicationPage\n    /properties/:id/book-viewing -> ViewingBookingPage\n    /repairs                     -> RepairsPage\n    /repairs/:id                 -> RepairDetailPage\n    /compliance                  -> CompliancePage\n    /compliance/:type            -> ComplianceTypePage\n    /compliance/awaabs-law       -> AwaabsLawPage\n    /complaints                  -> ComplaintsPage\n    /complaints/:id              -> ComplaintDetailPage\n    /asb                         -> AsbPage\n    /asb/:id                     -> AsbDetailPage\n    /rent                        -> RentPage\n    /allocations                 -> AllocationsPage\n    /communications              -> CommunicationsPage\n    /reports                     -> ReportsPage\n    /reports/:type               -> DynamicReportPage\n    /reports/tsm                 -> TsmReportPage\n    /ai-centre                   -> AiCentrePage\n    /briefing                    -> BriefingPage\n    /admin                       -> AdminPage\n    /admin/integrations          -> IntegrationsPage\n    /tenant-portal               -> TenantPortalPage\n    /search                      -> SearchPage\n\n3.3 State Management\n    - React Context for global state (auth user, persona)\n    - @tanstack/react-query for server state (API caching, 5-min stale time)\n    - Local component state (useState, useReducer) for UI state\n    - No Redux/Zustand — kept deliberately simple\n\n3.4 Data Fetching Layer\n    - api-client.ts: 70+ typed API methods organized by domain\n    - useApi.ts: React Query hooks wrapping api-client methods\n    - useEntityIntelligence.ts: AI scoring hooks\n    - usePersonaScope.ts: Persona-based data filtering\n    - Timestamp sanitization in api-client to handle Firestore timestamps\n\n3.5 Frontend Conventions\n    - safeText() helper for rendering potentially undefined values\n    - ?? [] for nullable arrays (prevents React Error #310)\n    - Tailwind CSS utility classes (no CSS modules)\n    - Lucide React for all icons\n    - Purple border for AI-generated elements\n    - Consistent page structure: header + filter bar + content grid\n    - ErrorBoundary wrapping for error resilience\n\n3.6 Accessibility Implementation\n    - ActionModal: focus trap (Tab wrapping), Escape key, role=\"dialog\",\n      aria-modal, aria-labelledby, aria-describedby, focus restoration\n    - index.css: *:focus-visible outlines, prefers-reduced-motion,\n      .sr-only class, .skip-to-content link, .field-error styles\n    - Layout: skip-to-content link + id=\"main-content\" on <main>\n    - Sidebar: aria-label on <nav> and collapse button\n    - Breadcrumbs: aria-label=\"breadcrumb\" with breadcrumb-* classes\n\n\n4. BACKEND ARCHITECTURE\n================================================================================\n\n4.1 Directory Structure\n\n    server/src/\n    +-- index.ts                 -- Express entry, middleware, route registration\n    |\n    +-- middleware/               -- 5 middleware modules\n    |   +-- auth.ts              -- Firebase token verification + X-Persona fallback\n    |   +-- error-handler.ts     -- Structured JSON error handler (no stack leaks)\n    |   +-- metrics.ts           -- Request/response metrics recording\n    |   +-- rate-limiter.ts      -- Sliding window rate limiter (4 tiers)\n    |   +-- rbac.ts              -- Role-based access control\n    |\n    +-- routes/                  -- 16 route modules (2,300+ lines)\n    |   +-- admin.ts             -- Integration management, monitoring\n    |   +-- ai.ts                -- 14 AI endpoints + 4 GOV.UK Notify endpoints\n    |   +-- auth.ts              -- Login, register, logout\n    |   +-- briefing.ts          -- Personalised morning briefing\n    |   +-- booking.ts           -- Viewing bookings, applications\n    |   +-- cases.ts             -- Unified case CRUD + pagination\n    |   +-- compliance.ts        -- Big 6 compliance data\n    |   +-- explore.ts           -- Hierarchy drill-down data\n    |   +-- export.ts            -- CSV/PDF exports\n    |   +-- lettings.ts          -- Void management, allocations\n    |   +-- properties.ts        -- Property list/detail\n    |   +-- public-data.ts       -- External API proxy (Tier 1-2)\n    |   +-- rent.ts              -- Arrears, statements, transactions\n    |   +-- reports.ts           -- 27 regulatory reports\n    |   +-- tenants.ts           -- Tenant list/detail\n    |\n    +-- services/                -- 25 service modules\n    |   +-- external-api.ts      -- Cache-through, rate limiting, audit\n    |   +-- firestore.ts         -- Firestore connection + helpers\n    |   +-- firebase-admin.ts    -- Firebase Admin initialization\n    |   +-- damp-prediction.ts   -- 5-factor damp risk algorithm\n    |   +-- crime-context.ts     -- Police data correlation\n    |   +-- vulnerability-detection.ts  -- 7-factor scoring\n    |   +-- benefits-engine.ts   -- UK benefit rules engine\n    |   +-- property-passport.ts -- Multi-source aggregation\n    |   +-- neighbourhood-briefing.ts   -- Per-estate briefing\n    |   +-- govuk-notify.ts      -- 24 notification templates (1,257 lines)\n    |   +-- census-nomis.ts      -- Census + NOMIS + Gas/Electrical (493 lines)\n    |   +-- mock-services.ts     -- 9 Tier 3 mock endpoints\n    |   +-- monitoring.ts        -- Metrics singleton\n    |   +-- hact-export.ts       -- HACT reporting format\n    |   +-- seed.ts              -- Database seeding\n    |   +-- seed-data.ts         -- Seed data definitions\n    |   +-- hact-codes.ts        -- SOR code definitions\n    |\n    +-- models/\n    |   +-- firestore-schemas.ts -- Firestore collection schemas (262 lines)\n    |   +-- hact-codes.ts        -- Repair code models\n    |\n    +-- scripts/\n        +-- seed-imd.ts          -- IMD data loader\n        +-- seed.ts              -- Main seed runner\n\n4.2 Middleware Pipeline (Request Flow)\n\n    Request -> Morgan Logger -> Helmet (CSP, security headers)\n            -> CORS (restricted origins) -> Compression (gzip)\n            -> JSON Parser (1MB limit) -> Request ID (X-Request-ID)\n            -> Rate Limiter (4 tiers) -> Metrics Recorder -> Route Handler\n            -> Error Handler -> Response\n\n4.3 Rate Limiting (4 Tiers)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n4.4 Error Handling\n    - Structured JSON error responses: { error, message, statusCode }\n    - No stack traces leaked in production\n    - Error logging with request ID correlation (X-Request-ID)\n    - Graceful degradation for external API failures\n    - ErrorBoundary on frontend for component-level recovery\n\n4.5 Health Check\n    GET /health -> { status, firestore, uptime, memory, timestamp }\n    States: healthy (Firestore < 5s), degraded (Firestore slow), unhealthy\n    Memory: RSS, heap used, heap total\n\n\n5. DATA MODELS (FIRESTORE)\n================================================================================\n\n5.1 Collection Map (17+ Collections)\n\n    +------------------+     +------------------+     +------------------+\n    |   organisations  |     |      users       |     |      teams       |\n    |   (1 doc)        |---->|    (10+ docs)    |---->|    (5+ docs)     |\n    +------------------+     +------------------+     +------------------+\n                                    |\n                                    v\n    +------------------+     +------------------+     +------------------+\n    |   properties     |<--->|     tenants      |<--->|      cases       |\n    |   (75 docs)      |     |    (68 docs)     |     |   (279+ docs)    |\n    +--------+---------+     +------------------+     +--------+---------+\n             |                                                 |\n             v                                                 v\n    +------------------+     +------------------+     +------------------+\n    |   repairs        |     |   complaints     |     |       asb        |\n    |  (200 docs)      |     |   (34 docs)      |     |    (12 docs)     |\n    +------------------+     +------------------+     +------------------+\n                                                              |\n    +------------------+     +------------------+     +-------v----------+\n    |   financial      |     |   damp-mould     |     |   activities     |\n    |   (docs)         |     |   (docs)         |     |   (docs)         |\n    +------------------+     +------------------+     +------------------+\n\n    +------------------+     +------------------+     +------------------+\n    |   tasks          |     |  integrations    |     |    auditLog      |\n    |   (docs)         |     |   (20 docs)      |     |  (write-once)    |\n    +------------------+     +------------------+     +------------------+\n\n    +----------------------+     +------------------+\n    |  externalDataCache   |     |    imdData       |\n    |  (TTL-based cache)   |     |   (LSOA docs)    |\n    +----------------------+     +------------------+\n\n    Geography Hierarchy:\n    +------------------+     +------------------+     +------------------+\n    |   regions (5)    |---->| localAuthorities |---->|   estates (5)    |\n    +------------------+     +------------------+     +--------+---------+\n                                                               |\n                                                      +--------v---------+\n                                                      |    blocks (8)    |\n                                                      +------------------+\n\n5.2 Property Schema\n\n    {\n      id: string                    // Firestore document ID\n      uprn: string                  // 12-digit UPRN\n      address: {\n        line1: string\n        line2?: string\n        town: string\n        postcode: string            // Real SE London postcode\n        lat: number\n        lng: number\n        lsoaCode: string            // LSOA for IMD/Census\n      }\n      type: 'house' | 'flat' | 'maisonette' | 'bungalow'\n      bedrooms: number\n      floor?: number\n      floorArea?: number\n      estateId: string\n      blockId?: string\n      regionId: string\n      localAuthorityId: string\n      buildYear: number\n      heatingType: string\n      wallType: string\n      roofType: string\n      epc: {\n        rating: 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G'\n        score: number\n        certificateNumber?: string\n        expiryDate: string\n      }\n      compliance: {\n        gasSafety: { status, expiryDate, certificateRef }\n        electricalSafety: { status, expiryDate, certificateRef }\n        fireRiskAssessment: { status, lastAssessmentDate }\n        asbestos: { status, surveyDate }\n        legionella: { status, assessmentDate }\n        liftSafety?: { status, inspectionDate }\n      }\n      status: 'occupied' | 'void' | 'under-repair' | 'pending-allocation'\n      isVoid: boolean\n      voidSince?: string\n      currentTenancyId?: string\n      tenantId?: string\n      weeklyRent: number\n      serviceCharge: number\n      dampRisk?: number             // 0-100 computed score\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.3 Tenant Schema\n\n    {\n      id: string\n      title: string\n      firstName: string\n      lastName: string\n      dateOfBirth: string\n      email: string\n      phone: string\n      mobile?: string\n      nino?: string                 // National Insurance Number\n      propertyId: string\n      tenancyId: string\n      tenancyType: 'secure' | 'assured' | 'introductory' | 'starter'\n      tenancyStartDate: string\n      tenancyStatus: string\n      assignedOfficer: string\n      rent: {\n        weeklyAmount: number\n        balance: number             // Negative = arrears\n        paymentMethod: 'direct-debit' | 'standing-order' | 'uc-direct' | 'manual'\n        ucStatus: 'not-applicable' | 'claiming' | 'transitioning' | 'verified'\n      }\n      weeklyCharge: number\n      rentBalance: number\n      arrearsRisk: number           // 0-100 score\n      household: [\n        { name, relationship, dateOfBirth, isDependent }\n      ]\n      vulnerabilityFlags: string[]  // e.g., ['mental-health', 'elderly', 'disability']\n      emergencyContact: {\n        name: string\n        phone: string\n        relationship: string\n      }\n      communicationPreference: 'email' | 'sms' | 'letter' | 'portal'\n      lastContact?: string\n      contactCount30Days?: number\n      createdAt: timestamp\n      updatedAt: timestamp\n    }\n\n5.4 Case Schema (Unified)\n\n    {\n      id: string\n      type: 'repair' | 'complaint' | 'asb' | 'financial' | 'damp-mould'\n             | 'safeguarding' | 'enquiry'\n      reference: string             // e.g., REP-2025-001\n      title: string\n      description: string\n      status: string                // Type-specific statuses\n      priority: 'emergency' | 'urgent' | 'routine' | 'planned'\n      propertyId: string\n      tenantId: string\n      handler: string               // Assigned officer\n      assignedTo: string            // User ID\n      createdDate: string\n      updatedDate: string\n      closedDate?: string\n      daysOpen: number\n      sla: {\n        targetDate: string\n        breached: boolean\n      }\n      slaStatus: 'on-track' | 'at-risk' | 'breached'\n      timeline: [\n        { date, action, actor, notes }\n      ]\n      // Type-specific fields via discriminated union\n    }\n\n5.5 Repair Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'repair',\n      sorCode: string               // HACT SOR code\n      trade: string                 // plumbing, electrical, carpentry, etc.\n      operative?: string\n      appointment: {\n        date: string\n        timeSlot: string\n        confirmedBy: string\n      }\n      appointmentDate?: string\n      completionDate?: string\n      contractor: {\n        name: string\n        company: string\n        gasSafeNumber?: string\n        niceicNumber?: string\n      }\n      cost: {\n        estimated: number\n        actual?: number\n        authorised: boolean\n      }\n      firstTimeFix?: boolean\n      photos: {\n        before: string[]\n        after: string[]\n      }\n      satisfaction?: {\n        rating: number              // 1-5\n        feedback: string\n        date: string\n      }\n      awaabsLaw?: {                 // For damp/mould repairs\n        isHazard: boolean\n        hazardType: string\n        responseDeadline: string\n        repairDeadline: string\n        compliant: boolean\n      }\n    }\n\n5.6 Complaint Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'complaint',\n      stage: 1 | 2\n      category: string\n      deadlines: {\n        stage1Acknowledgement: string   // 5 working days\n        stage1Response: string          // 10 working days\n        stage2Response?: string         // 20 working days\n      }\n      findings?: string\n      compensation?: number\n      learningActions: string[]\n      ombudsmanRef?: string\n      ombudsmanEscalation?: boolean\n      escalatedDate?: string\n      outcome?: string\n    }\n\n5.7 ASB Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'asb',\n      severity: 'low' | 'medium' | 'high' | 'critical'\n      escalationStage: 'warning' | 'abc' | 'cpw' | 'cpn' | 'injunction' | 'possession'\n      evidenceCount: number\n      evidenceLog: [\n        { date, type, description, attachments }\n      ]\n      perpetratorId?: string\n      victimIds: string[]\n      communityTrigger: boolean\n      multiAgencyPanel?: boolean\n    }\n\n5.8 Financial Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'financial',\n      arrearsAmount: number\n      arrearsReason: string\n      paymentArrangement?: {\n        amount: number\n        frequency: string\n        startDate: string\n      }\n      preActionChecklist?: {\n        item: string\n        completed: boolean\n        date?: string\n      }[]\n    }\n\n5.9 Damp-Mould Case Schema (extends Case)\n\n    {\n      ...Case,\n      type: 'damp-mould',\n      hazardClassification: string\n      dampRiskScore: number\n      cause: string\n      linkedRepairs: string[]       // repair case IDs\n    }\n\n5.10 ExternalDataCache Schema\n\n    {\n      id: string                    // Cache key (e.g., \"police:SE17+1RY\")\n      source: string                // API source identifier\n      data: object                  // Cached response payload\n      fetchedAt: timestamp          // When data was fetched\n      ttl: number                   // TTL in seconds\n      expiresAt: timestamp          // Computed expiry\n      requestParams: object         // Original request parameters\n    }\n\n5.11 Integration Schema\n\n    {\n      id: string\n      name: string\n      tier: 1 | 2 | 3\n      category: string\n      status: 'active' | 'inactive' | 'error' | 'pending'\n      enabled: boolean\n      config: {\n        baseUrl: string\n        apiKey?: string\n        rateLimit: number\n      }\n      stats: {\n        lastUsed: string\n        requestCount: number\n        avgResponseTime: number\n        cacheHitRate: number\n        errorRate: number\n      }\n    }\n\n5.12 Firestore Indexes (Composite)\n    Defined in firestore.indexes.json at project root (17 indexes).\n    Key indexes for:\n    - cases: (propertyId, type, createdDate DESC)\n    - cases: (tenantId, type, createdDate DESC)\n    - cases: (status, priority, createdDate DESC)\n    - cases: (type, status, createdDate DESC)\n    - cases: (type, handler, createdDate DESC)\n    - cases: (estateId, type, createdDate DESC)\n    - activities: (entityId, timestamp DESC)\n    - tenants: (arrearsRisk DESC)\n    - externalDataCache: (source, expiresAt)\n\n5.13 Firestore Security Rules\n    Defined in firestore.rules at project root.\n    Persona-based access control for all 15+ collections.\n    Helper functions: isAuthenticated(), hasPersona(), isManager(), isAdmin()\n    Audit log is write-once, read-many (immutable).\n\n\n6. API ARCHITECTURE\n================================================================================\n\n6.1 API Design Principles\n    - RESTful design with /api/v1/ prefix\n    - JSON request/response bodies\n    - Consistent error format: { error, message, statusCode }\n    - Pagination: ?page=N&limit=N (default 20, max 50)\n    - Filtering: Query parameters per endpoint\n    - Sorting: ?sort=field&order=asc|desc\n    - Request correlation via X-Request-ID header\n\n6.2 API Route Registry (50+ endpoints)\n\n    AUTHENTICATION (3)\n    POST   /api/v1/auth/login          -- Firebase token login\n    POST   /api/v1/auth/register       -- User registration\n    POST   /api/v1/auth/logout         -- Session invalidation\n\n    PROPERTIES (4)\n    GET    /api/v1/properties           -- List (filters: regionId, estateId, blockId, type, isVoid, limit)\n    GET    /api/v1/properties/:id       -- Property detail\n    PATCH  /api/v1/properties/:id       -- Update property\n    GET    /api/v1/properties/available -- Available properties\n\n    TENANTS (5)\n    GET    /api/v1/tenants              -- List with pagination/filter\n    GET    /api/v1/tenants/:id          -- Tenant detail\n    PATCH  /api/v1/tenants/:id          -- Update tenant\n    GET    /api/v1/tenants/:id/activities  -- Tenant activities\n    GET    /api/v1/tenants/:id/cases    -- Tenant cases\n\n    CASES (5)\n    GET    /api/v1/cases                -- List (filters: type, status, handler, priority)\n    GET    /api/v1/cases/:id            -- Case detail\n    POST   /api/v1/cases                -- Create case\n    PATCH  /api/v1/cases/:id            -- Update case\n    GET    /api/v1/cases/:id/activities -- Case activities\n\n    COMPLIANCE (2)\n    GET    /api/v1/compliance/overview  -- Big 6 summary dashboard\n    GET    /api/v1/compliance/:type     -- Type-specific data\n\n    EXPLORE (4)\n    GET    /api/v1/explore/hierarchy    -- Full drill-down hierarchy\n    GET    /api/v1/explore/regions      -- List regions\n    GET    /api/v1/explore/estates/:id  -- Estate detail with blocks\n    GET    /api/v1/explore/blocks/:id   -- Block detail\n\n    RENT (2)\n    GET    /api/v1/rent/dashboard       -- Arrears dashboard summary\n    GET    /api/v1/rent/transactions/:tenantId -- Tenant transactions\n\n    REPORTS (3)\n    GET    /api/v1/reports              -- Report catalog (27 types)\n    GET    /api/v1/reports/:type        -- Generate report data\n    GET    /api/v1/reports/tsm          -- TSM specific data\n\n    LETTINGS (2)\n    GET    /api/v1/lettings/voids       -- Void property list\n    GET    /api/v1/lettings/register    -- Housing register\n\n    BOOKING (2)\n    POST   /api/v1/booking/viewing      -- Book a viewing\n    POST   /api/v1/booking/application  -- Submit application\n\n    BRIEFING (1)\n    GET    /api/v1/briefing             -- Personalised morning briefing\n\n    EXPORT (2)\n    GET    /api/v1/export/csv/:type     -- CSV export\n    GET    /api/v1/export/pdf/:type     -- PDF export\n\n    AI INTELLIGENCE (12)\n    GET    /api/v1/ai/damp-risk/:propertyId            -- Damp risk score\n    GET    /api/v1/ai/damp-risk/estate/:estateId       -- Estate damp overview\n    GET    /api/v1/ai/crime-context/:estateId          -- Crime context\n    GET    /api/v1/ai/crime-context/case/:caseId       -- Case crime correlation\n    GET    /api/v1/ai/vulnerability/:tenantId           -- Vulnerability score\n    POST   /api/v1/ai/vulnerability/scan                -- Bulk scan all tenants\n    GET    /api/v1/ai/benefits-check/:tenantId          -- Benefits entitlement\n    GET    /api/v1/ai/property-passport/:propertyId     -- Property passport\n    GET    /api/v1/ai/briefing/:estateId                -- Neighbourhood briefing\n    POST   /api/v1/ai/draft-communication               -- Draft communication\n    POST   /api/v1/ai/chat                              -- Yantra Assist chat\n\n    GOV.UK NOTIFY (4)\n    GET    /api/v1/ai/notify/templates                  -- List all 24 templates\n    GET    /api/v1/ai/notify/templates/:category        -- Filter by category\n    GET    /api/v1/ai/notify/template/:id               -- Template detail\n    POST   /api/v1/ai/notify/render                     -- Render template\n\n    MOCK TIER 3 (9)\n    GET    /api/v1/ai/mock/uc-verification/:tenantId    -- DWP UC check\n    GET    /api/v1/ai/mock/iot-sensors/:propertyId      -- IoT sensor data\n    GET    /api/v1/ai/mock/direct-debit/:tenantId       -- GoCardless data\n    GET    /api/v1/ai/mock/labour-market/:lsoaCode      -- NOMIS data\n    GET    /api/v1/ai/mock/repairs-marketplace/:caseId  -- Plentific\n    POST   /api/v1/ai/mock/regulatory                   -- RSH/CORE submission\n    POST   /api/v1/ai/mock/signing                      -- DocuSign envelope\n    GET    /api/v1/ai/mock/referencing/:applicantId     -- Experian check\n    GET    /api/v1/ai/mock/land-registry/:propertyId    -- Land Registry\n\n    EXTERNAL DATA PROXY (9)\n    GET    /api/v1/public-data/police/:postcode          -- Police crime data\n    GET    /api/v1/public-data/weather/:lat/:lng         -- Weather forecast\n    GET    /api/v1/public-data/flood-risk/:postcode      -- Flood risk\n    GET    /api/v1/public-data/postcode/:postcode        -- Postcode lookup\n    GET    /api/v1/public-data/epc/:uprn                 -- EPC certificate\n    GET    /api/v1/public-data/census/:lsoaCode          -- Census 2021\n    GET    /api/v1/public-data/nomis/:lsoaCode           -- NOMIS labour\n    GET    /api/v1/public-data/gas-safe/:regNumber       -- Gas Safe verify\n    GET    /api/v1/public-data/electrical-safety/:regNo  -- Electrical verify\n\n    ADMIN (4)\n    GET    /api/v1/admin/integrations                   -- List integrations\n    POST   /api/v1/admin/integrations/:id/toggle        -- Enable/disable\n    POST   /api/v1/admin/integrations/:id/test          -- Test connection\n    GET    /api/v1/admin/monitoring                      -- Metrics dashboard\n\n    CONFIG & HEALTH\n    GET    /api/v1/config              -- Firebase client config (public)\n    GET    /health                     -- Health check\n\n\n7. EXTERNAL API INTEGRATION ARCHITECTURE\n================================================================================\n\n7.1 Server-Side Proxy Pattern\n    All external API calls are proxied through the Express server.\n    Frontend NEVER calls external APIs directly.\n\n    Frontend -> api-client.ts -> /api/v1/public-data/* -> external-api.ts -> External API\n\n7.2 Caching Strategy (Firestore-based)\n    Collection: externalDataCache\n    Pattern: Cache-through with TTL\n\n    | Data Source       | TTL      | Rationale                    |\n    |-------------------|----------|------------------------------|\n    | Weather           | 1 hour   | Forecast changes frequently  |\n    | Crime data        | 24 hours | Updated monthly by Police.uk |\n    | EPC certificates  | 30 days  | Rarely changes               |\n    | Census data       | 90 days  | Static (Census 2021)         |\n    | Postcode lookup   | 7 days   | Rarely changes               |\n    | Gas Safe          | 24 hours | Registration status           |\n    | Electrical Safety | 24 hours | Registration status           |\n    | IMD data          | 90 days  | Annual update cycle          |\n    | NOMIS             | 30 days  | Monthly refresh               |\n    | Flood risk        | 1 hour   | Changes with weather          |\n\n7.3 Rate Limiting (External APIs)\n    Token bucket pattern per API source.\n    Fair-use limit: 15 requests/second across all external APIs.\n\n7.4 Graceful Degradation\n    All external APIs have simulated fallbacks.\n    If an API fails or times out:\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - Return simulated fallback data\n    - Flag response: { source: 'live' | 'simulated' }\n    Simulated data is realistic, consistent (deterministic seeding), flagged.\n\n\n8. SECURITY ARCHITECTURE\n================================================================================\n\n8.1 Authentication Flow\n    1. User visits /login\n    2. FirebaseUI widget presents Google SSO or email/password\n    3. Firebase returns ID token (JWT)\n    4. Frontend stores token, sends in Authorization header\n    5. Express middleware verifies token via Firebase Admin SDK\n    6. User context loaded (role, persona, permissions)\n    7. Fallback: X-Persona header for development (non-production)\n\n8.2 Authorization (RBAC)\n    10 default roles with hierarchical permissions:\n    - super-admin, org-admin, regional-manager, area-manager\n    - housing-manager, senior-officer, housing-officer\n    - repairs-coordinator, repairs-operative, read-only\n\n8.3 Security Headers\n    - Content-Security-Policy (whitelist for APIs, fonts, tiles)\n    - X-Content-Type-Options: nosniff\n    - X-Frame-Options: DENY\n    - Referrer-Policy: strict-origin-when-cross-origin\n    - Permissions-Policy (camera, microphone, geolocation disabled)\n    - Strict-Transport-Security: max-age=31536000\n\n8.4 Secrets Management\n    All secrets stored in Google Secret Manager:\n    - FIREBASE_API_KEY\n    - FIREBASE_AUTH_DOMAIN\n    - FIREBASE_PROJECT_ID\n    - DEMO_USER_PASSWORD\n    No secrets in source code or environment files.\n\n\n9. DEPLOYMENT ARCHITECTURE\n================================================================================\n\n9.1 Deployment Pipeline\n\n    Developer -> git push origin main\n                    |\n                    v\n    GitHub Repository (rajivpeter/SocialHomes_ai)\n                    |\n                    v\n    Cloud Build (auto-triggered)\n     +-- Step 1: Build React frontend (Vite)\n     +-- Step 2: Build Express backend (tsc)\n     +-- Step 3: Build & push Docker image\n                    |\n                    v\n    Artifact Registry (europe-west2)\n     +-- cloud-run-source-deploy/socialhomes:latest\n                    |\n                    v\n    Cloud Run (europe-west2)\n     +-- Min instances: 0\n     +-- Max instances: 10\n     +-- Memory: 1Gi\n     +-- CPU: 1\n     +-- Concurrency: 80\n     +-- Timeout: 300s\n     +-- Port: 8080\n     +-- Secrets: 4 from Secret Manager\n\n9.2 Docker Build (Multi-Stage)\n    Stage 1: Build client (Vite) — node:20-slim base\n    Stage 2: Build server (tsc) — node:20-slim base\n    Stage 3: Production — copy built assets, start server (~500MB image)\n\n9.3 Cloud Run Configuration\n    Region: europe-west2 (London)\n    Auto-scaling based on request volume\n    Min instances 0 for cost efficiency (cold start < 3s)\n\n9.4 Key Infrastructure References\n    GCP Project ID: gen-lang-client-0878518473\n    GCP Project Number: 587984201316\n    Firebase Project: gen-lang-client-0146156913\n    Artifact Registry: europe-west2-docker.pkg.dev/gen-lang-client-0878518473/\n                       cloud-run-source-deploy/socialhomes\n    Live URL: https://socialhomes-587984201316.europe-west2.run.app\n\n\n10. MONITORING & OBSERVABILITY\n================================================================================\n\n10.1 Custom Metrics (In-App)\n    - Request count (by endpoint, method, status code)\n    - Response time percentiles (P50, P95, P99)\n    - Cache hit/miss rates per API source\n    - Firestore query latency\n    - Error rate and error types\n    - Active concurrent requests\n\n10.2 Health Check\n    GET /health\n    - Firestore connectivity check with latency measurement\n    - Memory usage (RSS, heap used, heap total)\n    - Process uptime\n    - Status: healthy | degraded | unhealthy\n\n10.3 Structured Logging\n    - JSON format for all logs\n    - Request ID correlation (X-Request-ID)\n    - No sensitive data in logs (no PII)\n    - Error logging with full non-PII context\n\n10.4 Admin Monitoring Dashboard\n    GET /api/v1/admin/monitoring\n    - Real-time metrics display\n    - Integration status overview (20 integrations)\n    - Cache performance statistics\n    - Error rate trending\n\n\n================================================================================\n  End of Doc2 — SocialHomes.Ai Technical Architecture & Data Models\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"91df4ebc-16a7-4f88-9f84-a775bec71bc5"}
{"parentUuid":"9a503c14-e0d9-4df5-941d-a3ddcf88f570","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01QMBbwv972VQDmsWKmXLNGu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Xyq6BmqsFfpUS2r5un4EeL","name":"Write","input":{"file_path":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":11369,"cache_read_input_tokens":93048,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":11369},"output_tokens":18,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMDkcCH6icZw7tYEx9A","type":"assistant","uuid":"3301a1ae-9309-46a1-b1ff-f7b0f860c3e3","timestamp":"2026-02-25T19:38:24.314Z"}
{"parentUuid":"3301a1ae-9309-46a1-b1ff-f7b0f860c3e3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Xyq6BmqsFfpUS2r5un4EeL","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt has been updated successfully."}]},"uuid":"44edcae9-a8f2-4ae5-838f-b052ea0be05b","timestamp":"2026-02-25T19:38:24.484Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.netapps/socialhomes/docs/requirements/Doc3-socialhomes-API-Requirements.txt","content":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 6.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n","structuredPatch":[{"oldStart":1,"oldLines":6,"newStart":1,"newLines":6,"lines":[" ================================================================================","   Doc3 — SocialHomes.Ai API & Integration Requirements","-  Version: 5.0  |  Date: 2026-02-25","+  Version: 6.0  |  Date: 2026-02-25","   Author: Business Analyst Agent  |  Studio: Yantra Works"," ================================================================================"," "]}],"originalFile":"================================================================================\n  Doc3 — SocialHomes.Ai API & Integration Requirements\n  Version: 5.0  |  Date: 2026-02-25\n  Author: Business Analyst Agent  |  Studio: Yantra Works\n================================================================================\n\n1. API OVERVIEW\n================================================================================\n\n1.1 API Strategy\n    SocialHomes.Ai uses a server-side proxy pattern for ALL external API\n    integrations. The React frontend communicates exclusively with the Express\n    backend, which handles external calls, caching, rate limiting, and\n    graceful degradation.\n\n1.2 Integration Tiers\n\n    TIER 1 — Free, No API Key Required\n    Publicly available APIs with no registration needed.\n    Status: LIVE with real data\n\n    TIER 2 — Free, Registration Required\n    APIs requiring account creation or key registration.\n    Status: LIVE with real data (where keys available) + simulated fallbacks\n\n    TIER 3 — Subscription/Paid APIs\n    Commercial APIs requiring contracts or paid subscriptions.\n    Status: MOCK endpoints with realistic simulated data\n\n1.3 Current Integration Count\n    Total: 20 integrations\n    - Tier 1: 3 live\n    - Tier 2: 6 live (with simulated fallbacks)\n    - Tier 3: 5 mock services + 6 planned\n\n\n2. TIER 1 INTEGRATIONS (Free, No Key)\n================================================================================\n\n2.1 Police.uk — Street-Level Crime Data\n    Status: LIVE\n    Base URL: https://data.police.uk/api\n    Documentation: https://data.police.uk/docs/\n\n    Endpoints Used:\n    - GET /crimes-street/all-crime?lat={lat}&lng={lng}&date={YYYY-MM}\n    - GET /crimes-at-location?location_id={id}\n    - GET /outcomes-at-location?location_id={id}\n\n    Server Route: GET /api/v1/public-data/police/:postcode\n    Cache TTL: 24 hours\n    Rate Limit: 15 req/sec (fair-use)\n    Fallback: Simulated crime data matching postcode area\n\n    Used By:\n    - D2: Live Crime Context for ASB (crime-context.ts)\n    - Explore page crime data layer\n    - ASB case correlation\n    - Neighbourhood Briefing crime section\n\n    Data Returned:\n    - Crime category (anti-social-behaviour, burglary, criminal-damage, etc.)\n    - Month, location (lat/lng), outcome status\n    - 12-month historical data per location\n\n2.2 Open-Meteo — Weather Forecasting\n    Status: LIVE\n    Base URL: https://api.open-meteo.com/v1\n    Documentation: https://open-meteo.com/en/docs\n\n    Endpoints Used:\n    - GET /forecast?latitude={lat}&longitude={lng}&hourly=temperature_2m,\n          relative_humidity_2m,precipitation,weathercode,windspeed_10m\n          &daily=temperature_2m_max,temperature_2m_min,precipitation_sum\n          &timezone=Europe/London\n\n    Server Route: GET /api/v1/public-data/weather/:lat/:lng\n    Cache TTL: 1 hour\n    Rate Limit: 10,000 req/day (no key needed)\n    Fallback: Static weather for London SE\n\n    Used By:\n    - D1: Predictive Damp Intelligence (weather factor 0.25 weight)\n    - AI Morning Briefing (weather section)\n    - Neighbourhood Briefing (environmental context)\n    - Property impact assessment\n\n    Data Returned:\n    - Hourly: temperature, humidity, precipitation, wind speed, weather code\n    - Daily: max/min temperature, precipitation sum\n    - 7-day forecast + current conditions\n\n2.3 DEFRA Flood Risk API\n    Status: LIVE\n    Base URL: https://environment.data.gov.uk/flood-monitoring\n    Documentation: https://environment.data.gov.uk/flood-monitoring/doc/reference\n\n    Endpoints Used:\n    - GET /id/floods?lat={lat}&long={lng}&dist=3\n    - GET /id/stations?lat={lat}&long={lng}&dist=3\n\n    Server Route: GET /api/v1/public-data/flood-risk/:postcode\n    Cache TTL: 1 hour\n    Rate Limit: No formal limit\n    Fallback: \"No active warnings\" with zone classification\n\n    Used By:\n    - Property Passport (flood risk section)\n    - Neighbourhood Briefing (environmental alerts)\n    - Property detail page (risk indicators)\n\n    Data Returned:\n    - Active flood warnings/alerts\n    - Flood risk zone classification\n    - Nearest monitoring station readings\n\n\n3. TIER 2 INTEGRATIONS (Registration Required)\n================================================================================\n\n3.1 Postcodes.io — Postcode Lookup\n    Status: LIVE\n    Base URL: https://api.postcodes.io\n    Documentation: https://postcodes.io/docs\n    Registration: None (open API)\n\n    Endpoints Used:\n    - GET /postcodes/{postcode}\n    - GET /postcodes/{postcode}/nearest\n    - POST /postcodes (bulk lookup)\n\n    Server Route: GET /api/v1/public-data/postcode/:postcode\n    Cache TTL: 7 days\n    Rate Limit: Generous (no formal limit)\n    Fallback: Static mapping for SE London postcodes\n\n    Data Returned:\n    - Latitude, longitude\n    - LSOA code and name (for IMD/Census/NOMIS)\n    - Ward, parliamentary constituency\n    - Local authority, region\n\n    Used By:\n    - All location-dependent lookups\n    - LSOA resolution for Census/NOMIS/IMD\n    - Property geocoding\n\n3.2 EPC Open Data\n    Status: LIVE (with simulated fallback)\n    Base URL: https://epc.opendatacommunities.org/api/v1\n    Documentation: https://epc.opendatacommunities.org/docs/api\n    Registration: API key via MHCLG portal\n\n    Endpoints Used:\n    - GET /domestic/search?uprn={uprn}\n    - GET /domestic/certificate/{lmk-key}\n\n    Server Route: GET /api/v1/public-data/epc/:uprn\n    Cache TTL: 30 days\n    Rate Limit: 1,000 req/month (free tier)\n    Fallback: Generated EPC data matching property attributes\n\n    Data Returned:\n    - Current energy rating (A-G) and score\n    - Potential rating\n    - Environmental impact rating\n    - Floor area, wall/roof type\n    - Heating type, hot water system\n    - Recommendations for improvement\n    - Certificate expiry date\n\n    Used By:\n    - Property Passport (energy section)\n    - Compliance page (EPC tracking)\n    - Property detail page\n    - D1: Damp prediction (building factor input)\n\n3.3 Census 2021 (ONS via NOMIS)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n    Documentation: https://www.nomisweb.co.uk/api/v01/help\n\n    Datasets Used:\n    - NM_2072_1 — Population by age/sex (Census 2021)\n    - NM_2021_1 — Accommodation type (Census 2021)\n\n    Server Route: GET /api/v1/public-data/census/:lsoaCode\n    Cache TTL: 90 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated demographics for Southwark LSOA areas\n\n    Data Returned:\n    - Population count and density\n    - Age distribution (0-15, 16-64, 65+)\n    - Household composition\n    - Accommodation type breakdown\n    - Ethnicity distribution\n\n    Used By:\n    - Neighbourhood Briefing (demographics section)\n    - Property Passport (area context)\n    - D3: Vulnerability Detection (deprivation context)\n\n3.4 NOMIS — Labour Market Statistics\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.nomisweb.co.uk/api/v01\n\n    Datasets Used:\n    - NM_162_1 — JSA claimant count by age/sex\n    - NM_17_5  — Annual Population Survey (employment/unemployment)\n\n    Server Route: GET /api/v1/public-data/nomis/:lsoaCode\n    Cache TTL: 30 days\n    Rate Limit: 100,000 req/month\n    Fallback: Simulated labour market data for SE London\n\n    Data Returned:\n    - Employment rate, unemployment rate\n    - Economic activity breakdown\n    - Claimant count (JSA/UC)\n    - Occupation types\n    - Qualification levels\n\n    Used By:\n    - D5: Benefits Entitlement Engine (employment context)\n    - Neighbourhood Briefing (economic section)\n    - D3: Vulnerability Detection (economic deprivation factor)\n\n3.5 Gas Safe Register\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.gassaferegister.co.uk/api\n    Documentation: Restricted (via partnership application)\n\n    Server Route: GET /api/v1/public-data/gas-safe/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Engineer name and company\n    - Registration status (valid/expired/suspended)\n    - Qualifications (boiler, cooker, fire, etc.)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — green)\n    - Compliance management (contractor vetting)\n\n3.6 Electrical Safety Register (NICEIC)\n    Status: LIVE (with simulated fallback)\n    Base URL: https://www.niceic.com/api\n    Documentation: Via partnership application\n\n    Server Route: GET /api/v1/public-data/electrical-safety/:registrationNumber\n    Cache TTL: 24 hours\n    Rate Limit: 100 req/hour\n    Fallback: Simulated verification with valid/expired/suspended status\n\n    Data Returned:\n    - Contractor name and company\n    - Registration status (valid/expired/suspended)\n    - Scheme (NICEIC Approved Contractor / Competent Person)\n    - Registration number and expiry date\n\n    Used By:\n    - Repair detail page (contractor verification badge — blue)\n    - Compliance management (electrical contractor vetting)\n\n\n4. TIER 3 INTEGRATIONS (Mock/Subscription)\n================================================================================\n\n4.1 DWP Universal Credit Verification\n    Status: MOCK\n    Mock Function: mockUcVerification(tenantId)\n    Server Route: GET /api/v1/ai/mock/uc-verification/:tenantId\n\n    Mock Response:\n    - UC claim status (active/pending/none)\n    - Housing element amount\n    - Payment frequency and next payment date\n    - Managed payment status (direct to landlord)\n    - Alternative Payment Arrangement (APA) eligibility\n\n    Used By:\n    - D5: Benefits Entitlement Engine\n    - Rent management (UC tracking)\n    - Arrears prevention (early warning)\n\n4.2 IoT Sensor Integration (Switchee/Aico)\n    Status: MOCK\n    Mock Function: mockIotSensors(propertyId)\n    Server Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Mock Response:\n    - Temperature readings (per room: living, bedroom, kitchen, bathroom)\n    - Humidity readings (per room)\n    - CO2 levels\n    - Smoke/CO detector status (OK/alert/battery-low)\n    - Heating system status (on/off/hours today)\n    - Alerts (high humidity, low temperature, CO detected)\n\n    Used By:\n    - D1: Predictive Damp Intelligence (sensor factor 0.20 weight)\n    - Property detail page (live sensor data)\n    - Compliance monitoring (smoke/CO detector status)\n\n4.3 GoCardless — Direct Debit\n    Status: MOCK\n    Mock Function: mockDirectDebit(tenantId)\n    Server Route: GET /api/v1/ai/mock/direct-debit/:tenantId\n\n    Mock Response:\n    - Mandate status (active/pending/cancelled)\n    - Bank details (last 4 digits only)\n    - Next collection date and amount\n    - Payment history (last 12 months)\n    - Failed payment reasons\n\n    Used By:\n    - Rent management (payment processing)\n    - Arrears management (DD failure tracking)\n    - Tenant detail (payment method)\n\n4.4 Plentific/Fixflo — Repairs Marketplace\n    Status: MOCK\n    Mock Function: mockRepairsMarketplace(caseId)\n    Server Route: GET /api/v1/ai/mock/repairs-marketplace/:caseId\n\n    Mock Response:\n    - Contractor quotes (3 quotes with price/availability)\n    - Dispatch confirmation\n    - Appointment scheduling\n    - Job completion notification\n    - Satisfaction survey trigger\n\n    Used By:\n    - Repairs management (contractor dispatch)\n    - Cost management (competitive quotes)\n\n4.5 DocuSign — Digital Signing\n    Status: MOCK\n    Mock Function: mockSigningEnvelope(documentType, tenantId)\n    Server Route: POST /api/v1/ai/mock/signing\n\n    Mock Response:\n    - Envelope ID and status (sent/delivered/signed/declined)\n    - Document type (tenancy-agreement, section-21, gas-cert, atp)\n    - Recipients with signing status\n    - Completion date\n    - Signed document URL\n\n    Used By:\n    - Tenancy sign-up workflow\n    - Compliance certificate signing\n    - Legal document execution\n\n4.6 Experian/TransUnion — Tenant Referencing\n    Status: MOCK\n    Mock Function: mockReferencingResult(applicantId)\n    Server Route: GET /api/v1/ai/mock/referencing/:applicantId\n\n    Mock Response:\n    - Credit score (300-850)\n    - Affordability assessment (pass/refer/fail)\n    - CCJ count and value\n    - Previous addresses (last 3 years)\n    - Employment verification\n    - Recommendation (accept/refer/decline)\n\n    Used By:\n    - Allocations (applicant vetting)\n    - Lettings workflow (pre-tenancy checks)\n\n4.7 Land Registry — Title Data\n    Status: MOCK\n    Mock Function: mockLandRegistryTitle(propertyId)\n    Server Route: GET /api/v1/ai/mock/land-registry/:propertyId\n\n    Mock Response:\n    - Title number\n    - Tenure type (freehold/leasehold)\n    - Price paid and date\n    - Registered owner\n    - Lease details (start, term, ground rent)\n    - Restrictions and charges\n\n    Used By:\n    - Property Passport (ownership section)\n    - Property detail page\n\n4.8 RSH/CORE/Ombudsman — Regulatory Submissions\n    Status: MOCK\n    Mock Function: mockRegulatorySubmission(type, refId)\n    Server Route: POST /api/v1/ai/mock/regulatory\n\n    Submission Types:\n    - IDA (Individual Data Return)\n    - CORE lettings\n    - CORE sales\n    - Ombudsman escalation\n    - Compliance score return\n\n    Used By:\n    - Reports module (regulatory submissions)\n    - Compliance management\n\n4.9 NOMIS Labour Market (Extended)\n    Status: MOCK\n    Mock Function: mockLabourMarket(lsoaCode)\n    Server Route: GET /api/v1/ai/mock/labour-market/:lsoaCode\n\n    Used By:\n    - Neighbourhood Briefing (economic context)\n    - Benefits Engine (employment verification)\n\n\n5. SEVEN KILLER DIFFERENTIATOR SERVICES\n================================================================================\n\n5.1 D1: Predictive Damp Intelligence\n    Service: server/src/services/damp-prediction.ts\n    API Route: GET /api/v1/ai/damp-risk/:propertyId\n\n    Algorithm: 5-Factor Weighted Score (0-100)\n    +---------------------+--------+--------------------------------+\n    | Factor              | Weight | Data Sources                   |\n    +---------------------+--------+--------------------------------+\n    | Weather conditions  |  0.25  | Open-Meteo (humidity, rain)    |\n    | Building attributes |  0.25  | Property data (age, type, EPC) |\n    | Repair history      |  0.20  | Case data (damp/mould reports) |\n    | IoT sensors         |  0.20  | Switchee/Aico (temp, humidity) |\n    | Occupancy patterns  |  0.10  | Tenant data (household size)   |\n    +---------------------+--------+--------------------------------+\n\n    Output:\n    - Overall risk score (0-100)\n    - Risk level: low (0-25), moderate (26-50), high (51-75), critical (76-100)\n    - Factor breakdown with individual scores\n    - Proactive recommendations\n    - Awaab's Law compliance status\n\n5.2 D2: Live Crime Context for ASB\n    Service: server/src/services/crime-context.ts\n    API Route: GET /api/v1/ai/crime-context/:estateId\n\n    Algorithm:\n    - Fetch Police.uk data for estate location (12-month window)\n    - Categorize by type (ASB, violence, drugs, criminal damage, etc.)\n    - Correlate with internal ASB cases\n    - Identify hotspots and trends\n    - Generate estate safety score\n\n    Output:\n    - Crime summary by category (last 12 months)\n    - Monthly trend (rising/stable/declining)\n    - Hotspot locations within estate\n    - Correlation with internal ASB cases\n    - Recommended patrol priorities\n\n5.3 D3: Automatic Vulnerability Detection\n    Service: server/src/services/vulnerability-detection.ts\n    API Route: GET /api/v1/ai/vulnerability/:tenantId\n\n    Algorithm: 7-Factor Weighted Score (0-100)\n    +--------------------------+--------+--------------------------+\n    | Factor                   | Weight | Data Sources             |\n    +--------------------------+--------+--------------------------+\n    | IMD deprivation          |  0.20  | IMD data (decile)        |\n    | Arrears history          |  0.20  | Rent account (balance)   |\n    | Health flags             |  0.15  | Tenant vulnerability     |\n    | Social isolation         |  0.15  | Household composition    |\n    | Age risk (elderly/young) |  0.10  | Tenant DOB              |\n    | Dependents               |  0.10  | Household members        |\n    | UC transition            |  0.10  | UC status                |\n    +--------------------------+--------+--------------------------+\n\n    Output:\n    - Vulnerability score (0-100)\n    - Risk level: low / moderate / high / critical\n    - Detected flags (e.g., elderly, mental-health, financial-hardship)\n    - Recommended support actions\n    - Referral suggestions (social services, CAB, food bank)\n\n5.4 D4: Property Passport\n    Service: server/src/services/property-passport.ts\n    API Route: GET /api/v1/ai/property-passport/:propertyId\n\n    Aggregation Sources:\n    - Property data (Firestore)\n    - EPC certificate (Tier 2 API)\n    - Compliance certificates (Firestore)\n    - Repair history (Firestore cases)\n    - Damp risk score (D1 service)\n    - Flood risk (DEFRA API)\n    - Crime context (D2 service)\n    - Census demographics (NOMIS API)\n    - Land Registry title (mock)\n\n    Output:\n    - Comprehensive property dossier\n    - Current condition assessment\n    - Compliance status summary\n    - Energy efficiency profile\n    - Neighbourhood context\n    - Investment recommendations\n\n5.5 D5: Benefits Entitlement Engine\n    Service: server/src/services/benefits-engine.ts\n    API Route: GET /api/v1/ai/benefits-check/:tenantId\n\n    Rules Engine (UK 2025/26):\n    - Universal Credit (standard allowance, housing element, child element)\n    - Personal Independence Payment (PIP)\n    - Attendance Allowance\n    - Pension Credit (guarantee, savings)\n    - Council Tax Reduction\n    - Discretionary Housing Payment\n    - Warm Home Discount\n    - Free school meals\n\n    Input:\n    - Tenant age, household composition\n    - Employment status, income\n    - Disability/health conditions\n    - Current benefit claims\n\n    Output:\n    - List of potential entitlements\n    - Estimated weekly/monthly amounts\n    - Claim status (claimed/unclaimed/check-eligibility)\n    - Total unclaimed benefits estimate\n    - Next steps for each entitlement\n\n5.6 D6: AI Neighbourhood Briefing\n    Service: server/src/services/neighbourhood-briefing.ts\n    API Route: GET /api/v1/ai/briefing/:estateId\n\n    Data Sources Combined:\n    - Weather forecast (Open-Meteo)\n    - Crime data (Police.uk)\n    - Active cases (Firestore)\n    - Compliance status (Firestore)\n    - Census demographics (NOMIS)\n    - Damp risk aggregation (D1)\n    - ASB incidents (Firestore + Police)\n\n    Output:\n    - 6 summary cards (weather, crime, cases, compliance, demographics, risk)\n    - Officer briefing text (AI-generated narrative)\n    - Action items prioritized by urgency\n    - Trend comparisons (this week vs last)\n\n5.7 D7: IoT Sensor Integration\n    Service: server/src/services/mock-services.ts\n    API Route: GET /api/v1/ai/mock/iot-sensors/:propertyId\n\n    Supported Devices:\n    - Switchee smart thermostat (temperature, humidity, heating usage)\n    - Aico smoke/CO detectors (status, battery, alerts)\n    - Third-party humidity sensors\n\n    Status: MOCK (ready for real Switchee/Aico API integration)\n\n\n6. GOV.UK NOTIFY INTEGRATION\n================================================================================\n\n6.1 Overview\n    Service: server/src/services/govuk-notify.ts (1,257 lines)\n    Status: Template library defined (24 templates)\n    Integration: Ready for GOV.UK Notify API key\n\n6.2 Template Categories (7)\n\n    CATEGORY 1: Rent Arrears (4 templates)\n    - arrears-mild: Friendly reminder (1-2 weeks behind)\n    - arrears-moderate: Formal notice (3-4 weeks)\n    - arrears-severe: Pre-action warning (5+ weeks)\n    - arrears-arrangement: Payment plan confirmation\n\n    CATEGORY 2: Repairs (4 templates)\n    - repair-acknowledged: Repair reported acknowledgement\n    - repair-appointment: Appointment booking confirmation\n    - repair-completed: Completion notification + satisfaction link\n    - repair-follow-up: Post-repair follow-up\n\n    CATEGORY 3: ASB (3 templates)\n    - asb-reported: ASB report acknowledgement\n    - asb-warning: Warning letter to perpetrator\n    - asb-update: Case update to victim/reporter\n\n    CATEGORY 4: Compliance (3 templates)\n    - compliance-access: Access request for inspection\n    - compliance-reminder: Appointment reminder\n    - compliance-certificate: Certificate available notification\n\n    CATEGORY 5: Tenancy (4 templates)\n    - tenancy-welcome: New tenant welcome pack\n    - tenancy-renewal: Renewal offer\n    - tenancy-end: End of tenancy notification\n    - tenancy-annual-visit: Annual visit scheduling\n\n    CATEGORY 6: Damp & Mould (3 templates)\n    - damp-report-ack: Report acknowledged\n    - damp-inspection: Inspection scheduled\n    - damp-works: Works ordered notification (Awaab's Law timeline)\n\n    CATEGORY 7: General (3 templates)\n    - general-update: Generic case update\n    - general-survey: Satisfaction survey invitation\n    - general-information: Information request\n\n6.3 Template Rendering\n    - Personalisation fields use ((field)) syntax\n    - Rendered server-side via /api/v1/ai/notify/render\n    - Supports: ((tenant_name)), ((property_address)), ((case_ref)),\n      ((amount)), ((date)), ((officer_name)), etc.\n\n6.4 API Endpoints\n    GET  /api/v1/ai/notify/templates           -- List all 24 templates\n    GET  /api/v1/ai/notify/templates/:category  -- Filter by category\n    GET  /api/v1/ai/notify/template/:id         -- Single template detail\n    POST /api/v1/ai/notify/render               -- Render with personalisation\n\n\n7. CACHING ARCHITECTURE\n================================================================================\n\n7.1 Cache Collection: externalDataCache\n    Stored in Firestore with TTL-based expiration.\n    Cache key format: \"{source}:{params}\" (e.g., \"police:SE17+1RY\")\n\n7.2 Cache-Through Pattern\n    1. Check Firestore cache for key\n    2. If found AND not expired -> return cached data\n    3. If missing OR expired -> fetch from external API\n    4. Store result in cache with TTL\n    5. Return data to caller\n\n7.3 TTL Configuration\n\n    | Source              | TTL       | Key Format                 |\n    |---------------------|-----------|----------------------------|\n    | police              | 24 hours  | police:{postcode}          |\n    | weather             | 1 hour    | weather:{lat},{lng}        |\n    | flood-risk          | 1 hour    | flood:{postcode}           |\n    | postcode            | 7 days    | postcode:{postcode}        |\n    | epc                 | 30 days   | epc:{uprn}                 |\n    | census              | 90 days   | census:{lsoaCode}          |\n    | nomis               | 30 days   | nomis:{lsoaCode}           |\n    | gas-safe            | 24 hours  | gas-safe:{regNumber}       |\n    | electrical-safety   | 24 hours  | electrical:{regNumber}     |\n    | imd                 | 90 days   | imd:{lsoaCode}             |\n\n7.4 Cache Management\n    - Automatic TTL enforcement on read\n    - Manual cache invalidation via admin API\n    - Cache hit rate tracked in metrics\n    - No cache warming (fetch-on-demand only — warming planned Phase 5)\n\n\n8. RATE LIMITING\n================================================================================\n\n8.1 Internal Rate Limits (per client IP)\n\n    | Tier    | Routes              | Limit        | Window  |\n    |---------|---------------------|--------------|---------|\n    | API     | /api/v1/*           | 100 req/min  | Sliding |\n    | Auth    | /api/v1/auth/*      | 10 req/min   | Sliding |\n    | AI      | /api/v1/ai/*        | 30 req/min   | Sliding |\n    | Admin   | /api/v1/admin/*     | 20 req/min   | Sliding |\n\n8.2 External API Rate Limits\n    Token bucket pattern per API source.\n    Global fair-use: 15 req/sec across all external APIs.\n\n    | API               | Limit             | Enforced By       |\n    |-------------------|-------------------|-------------------|\n    | Police.uk         | 15 req/sec        | Fair-use + cache  |\n    | Open-Meteo        | 10,000 req/day    | No key needed     |\n    | DEFRA             | No formal limit   | Fair-use          |\n    | Postcodes.io      | No formal limit   | Fair-use          |\n    | EPC Open Data     | 1,000 req/month   | API key + cache   |\n    | NOMIS             | 100,000 req/month | Fair-use          |\n    | Gas Safe          | 100 req/hour      | Fair-use + cache  |\n    | Electrical Safety | 100 req/hour      | Fair-use + cache  |\n\n\n9. ERROR HANDLING & GRACEFUL DEGRADATION\n================================================================================\n\n9.1 External API Error Handling\n    - Timeout: 10 seconds per external request\n    - Retry: 1 retry with exponential backoff (2s)\n    - On failure: Return simulated fallback data\n    - Flag: Response includes { source: 'live' | 'simulated' }\n\n9.2 Simulated Fallback Strategy\n    Every external API has a corresponding simulated data generator.\n    Simulated data is:\n    - Realistic for the requested entity/location\n    - Consistent across requests (deterministic seeding)\n    - Flagged clearly in the response\n\n9.3 Circuit Breaker Pattern (Planned — Phase 5)\n    - Track failure count per API source\n    - Open circuit after 5 consecutive failures\n    - Half-open after 60 seconds (single test request)\n    - Close circuit on successful test\n    Status: Designed, not yet implemented (task 5.2.5)\n\n\n10. API SECURITY\n================================================================================\n\n10.1 Authentication\n    All /api/v1/* routes require Firebase Bearer token.\n    Exception: /health (public health check), /api/v1/config (public)\n\n10.2 Request Validation\n    - JSON body limit: 1MB\n    - Content-Type: application/json enforced\n    - Query parameter sanitization\n    - Path parameter validation\n\n10.3 Response Security\n    - No sensitive data in error responses (production)\n    - CORS restricted to allowed origins\n    - Request ID correlation (X-Request-ID)\n    - Security headers on all responses\n\n10.4 API Key Management\n    - No API keys in source code\n    - All keys in Google Secret Manager\n    - Environment variable injection at runtime\n    - Key rotation support via Secret Manager versioning\n\n\n11. FUTURE INTEGRATION ROADMAP\n================================================================================\n\n11.1 Phase 5 — Real-Time & Advanced (Planned)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Vertex AI / Gemini    | P1       | XL         | LLM for Yantra Assist chat      |\n    | WebSocket (Socket.io) | P1       | L          | Real-time notifications          |\n    | GOV.UK Notify (live)  | P1       | M          | Dispatch emails/SMS via API key  |\n    | Switchee API (real)   | P2       | M          | Replace IoT mock with real API   |\n    | Aico API (real)       | P2       | M          | Real smoke/CO detector data      |\n    | DWP UC API (real)     | P1       | H          | Real UC verification (DWP ISP)   |\n    | GoCardless API (real) | P2       | M          | Real direct debit processing     |\n    | DocuSign API (real)   | P2       | M          | Real digital signing             |\n    | Cloud Pub/Sub         | P2       | M          | Event-driven architecture        |\n    | Plentific API (real)  | P3       | M          | Real contractor marketplace      |\n\n11.2 Phase 6 — Enterprise Integrations (Future)\n\n    | Integration           | Priority | Complexity | Description                     |\n    |-----------------------|----------|------------|---------------------------------|\n    | Microsoft 365         | P3       | M          | Email, calendar, Teams           |\n    | Salesforce CRM        | P3       | H          | Tenant relationship management   |\n    | Power BI              | P3       | M          | Advanced analytics/dashboards    |\n    | Twilio                | P3       | M          | SMS/WhatsApp messaging           |\n    | NHS Digital           | P3       | H          | Health data integration          |\n    | Companies House       | P3       | S          | Contractor verification          |\n    | Stripe/GoCardless     | P3       | M          | Online rent payment              |\n\n\n================================================================================\n  End of Doc3 — SocialHomes.Ai API & Integration Requirements\n  Yantra Works | 2026-02-25\n================================================================================\n"},"sourceToolAssistantUUID":"3301a1ae-9309-46a1-b1ff-f7b0f860c3e3"}
{"parentUuid":"44edcae9-a8f2-4ae5-838f-b052ea0be05b","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_013ULjvTPKCDRQA6BgdpRr8t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012okHAPGQJQYcx7sxUmJYHR","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":8141,"cache_read_input_tokens":104417,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8141},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMQT2ag9ToVgbjfq2iH","type":"assistant","uuid":"3b071af6-108a-489a-aab1-8ffb6acdb625","timestamp":"2026-02-25T19:38:30.782Z"}
{"parentUuid":"3b071af6-108a-489a-aab1-8ffb6acdb625","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012okHAPGQJQYcx7sxUmJYHR","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"6d5edafc-0d54-4e3f-b209-3f7f6a82c7aa","timestamp":"2026-02-25T19:38:30.795Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"in_progress","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"pending","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"pending","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"3b071af6-108a-489a-aab1-8ffb6acdb625"}
{"parentUuid":"6d5edafc-0d54-4e3f-b209-3f7f6a82c7aa","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01Jc95jb8aFJNzgWkVxGwBk2","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me write the updated EXECUTION-PLAN.md with expanded Phase 5 tasks (adding 6 new tasks to bring it to 50):"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":112558,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMR1fd4g6KfXxoTaMT7","type":"assistant","uuid":"b9533344-9210-4999-a869-e33b55ab1eeb","timestamp":"2026-02-25T19:38:35.460Z"}
{"parentUuid":"b9533344-9210-4999-a869-e33b55ab1eeb","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01Jc95jb8aFJNzgWkVxGwBk2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01P6gp2fCMJMJTre1H7qxq4U","name":"Write","input":{"file_path":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 2, TODO: 48) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":112558,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMR1fd4g6KfXxoTaMT7","type":"assistant","uuid":"272bc390-883c-4bc3-a103-0b37b9d2a519","timestamp":"2026-02-25T19:41:47.976Z"}
{"parentUuid":"272bc390-883c-4bc3-a103-0b37b9d2a519","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01P6gp2fCMJMJTre1H7qxq4U","type":"tool_result","content":"The file /mnt/c/.REDACTED.md has been updated successfully."}]},"uuid":"fc2fe25f-8828-4462-b96b-94ad0b38b744","timestamp":"2026-02-25T19:41:48.079Z","toolUseResult":{"type":"update","filePath":"/mnt/c/.REDACTED.md","content":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | DONE | 10/10 |\n| 1 | Foundation | 1-2 | DONE | 12/12 |\n| 2 | Intelligence | 3-4 | DONE | 14/14 |\n| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |\n| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |\n| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% |\n| TypeScript errors | 0 | 0 |\n| Vite build warnings | 0 critical | 0 |\n| API response time (P95) | < 500ms | ~200-300ms |\n| WCAG AA compliance | 100% | 100% |\n| External API uptime | > 99.5% (with fallback) | 100% |\n| Bundle size | < 3MB | ~2.5MB |\n| Cloud Run cold start | < 3s | < 2s |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 23 | 0 | 8 | 15 | 0 |\n| **Frontend** | 12 | 0 | 2 | 9 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **50** (DONE: 2, TODO: 48) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)\n2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)\n11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n12. 5.3.2 (Notification bell — depends on WebSocket backend)\n13. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n14. 5.3.3-5.3.12 (Remaining frontend features — parallel)\n15. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n16. 5.4.6 (CI test pipeline — enables automated testing)\n17. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)\n19. 5.4.8 (Security testing)\n20. 5.5.4 (Cloud Monitoring alerts)\n21. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n23. 5.5.8, 5.5.9 (Runbook, log monitoring)\n24. 5.1.7 (API documentation — after all endpoints stable)\n25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n26. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)\n    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)\n    -> 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)\n    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)\n    -> 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)\n    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)\n    -> 5.5.5 (backups) -> 5.5.7 (custom domain)\n\nFile/Data Chain:\n  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)\n  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)\n  5.2.10 (audit log API) -> 5.3.11 (user management)\n```\n\n---\n\n**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n","structuredPatch":[{"oldStart":1,"oldLines":7,"newStart":1,"newLines":7,"lines":[" # SocialHomes.Ai — Master Execution Plan"," "," > Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.","-> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent","+> Version 6.0 | 2026-02-25 | Updated by Business Analyst Agent"," > Studio: Yantra Works"," "," ---"]},{"oldStart":10,"oldLines":33,"newStart":10,"newLines":33,"lines":[" "," | Phase | Name | Sprints | Status | Progress |"," |-------|------|---------|--------|----------|","-| 0 | Infrastructure | — | ✅ DONE | 10/10 |","-| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |","-| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |","-| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |","-| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |","-| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |","+| 0 | Infrastructure | — | DONE | 10/10 |","+| 1 | Foundation | 1-2 | DONE | 12/12 |","+| 2 | Intelligence | 3-4 | DONE | 14/14 |","+| 3 | Enrichment | 5-6 | DONE | 14/17 (3 deferred) |","+| 4 | Completion | 7-8 | DONE | 11/14 (3 deferred) |","+| **5** | **Evolution** | **9-14** | **TODO** | **0/50** |"," "," ---"," ","-## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)","+## PHASE 0: INFRASTRUCTURE — DONE (10/10)"," "," | # | Task | Status | Agent |"," |---|------|--------|-------|"," | 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |"," | 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |"," | 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |","-| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |","+| 0.4 | Build and deploy via git push -> Cloud Build | DONE | Claude Code |"," | 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |"," | 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |"," | 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |","-| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |","-| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |","+| 0.8 | UI/UX Audit -> Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |","+| 0.9 | BA Requirements -> Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |"," | 0.10 | Master Execution Plan (this document) | DONE | Claude Code |"," "," ---"," ","-## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)","+## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — DONE (12/12)"," "," ### Goal: Core external API infrastructure + free API integrations"," "]},{"oldStart":49,"oldLines":7,"newStart":49,"newLines":7,"lines":[" | 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |"," | 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |"," | 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |","-| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |","+| 1.8 | Load IMD data (ONS CSV -> Firestore) | P1 | M | Fullstack | DONE |"," | 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |"," | 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |"," | 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |"]},{"oldStart":57,"oldLines":7,"newStart":57,"newLines":7,"lines":[" "," ---"," ","-## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)","+## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — DONE (14/14)"," "," ### Goal: 7 killer differentiators + Tier 2 API registrations"," "]},{"oldStart":80,"oldLines":7,"newStart":80,"newLines":7,"lines":[" "," ---"," ","-## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)","+## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — DONE (14/17)"," "," ### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI"," "]},{"oldStart":106,"oldLines":7,"newStart":106,"newLines":7,"lines":[" "," ---"," ","-## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)","+## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — DONE (11/14)"," "," ### Goal: Mock services + polish + production hardening"," "]},{"oldStart":129,"oldLines":7,"newStart":129,"newLines":7,"lines":[" "," ---"," ","-## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)","+## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — TODO (0/50)"," "," ### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness"," "]},{"oldStart":143,"oldLines":8,"newStart":143,"newLines":8,"lines":[" "," | # | Task | Priority | Complexity | Agent | Status |"," |---|------|----------|------------|-------|--------|","-| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |","-| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |","+| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v6.0 | P0 | L | BA | DONE |","+| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v6.0) | P0 | M | BA | DONE |"," | 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |"," | 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |"," | 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |"]},{"oldStart":173,"oldLines":6,"newStart":173,"newLines":8,"lines":[" | 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |"," | 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |"," | 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |","+| 5.2.15 | Build file upload service — photo attachment for repairs (before/after), document uploads for compliance certificates, tenant document storage, Cloud Storage integration, image resize/compression, virus scanning, presigned URLs for secure access | P2 | M | Fullstack | TODO |","+| 5.2.16 | Implement GDPR data export pipeline — automated SAR request processing, tenant data collation across all collections, PII redaction for non-subject data, PDF generation with cover letter, right-to-erasure cascade across collections | P2 | M | Fullstack | TODO |"," "," ---"," "]},{"oldStart":183,"oldLines":13,"newStart":185,"newLines":15,"lines":[" | 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |"," | 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |"," | 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |","-| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |","+| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar -> filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |"," | 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |"," | 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |"," | 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |"," | 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |"," | 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |"," | 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |","+| 5.3.11 | Build admin user management page — CRUD for user accounts, role assignment from 10 predefined roles, team assignment, patch allocation, bulk import from CSV, password reset, account deactivation, last login tracking, session management | P2 | M | Frontend | TODO |","+| 5.3.12 | Build GDPR compliance dashboard — SAR request tracker (received/processing/complete), data retention policy viewer, consent management interface, Data Processing Register view, right-to-erasure request workflow, export audit trail | P2 | M | Frontend | TODO |"," "," ---"," "]},{"oldStart":199,"oldLines":8,"newStart":203,"newLines":8,"lines":[" |---|------|----------|------------|-------|--------|"," | 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |"," | 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |","-| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |","-| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |","+| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss -> API call -> cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |","+| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 -> 10 instances) | P2 | M | Tester | TODO |"," | 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |"," | 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |"," | 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |"]},{"oldStart":214,"oldLines":11,"newStart":218,"newLines":11,"lines":[" |---|------|----------|------------|-------|--------|"," | 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |"," | 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |","-| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |","+| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms -> scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 -> optimal), startup probe and liveness check | P2 | M | DevOps | TODO |"," | 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |"," | 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |"," | 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |","-| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |","+| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP->HTTPS redirect, www->non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |"," | 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |"," | 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |"," "]},{"oldStart":240,"oldLines":9,"newStart":244,"newLines":9,"lines":[" "," | Document | Location | Purpose |"," |----------|----------|---------|","-| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |","-| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |","-| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |","+| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v6.0) |","+| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v6.0) |","+| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v6.0) |"," | Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |"," | Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |"," | Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |"]},{"oldStart":274,"oldLines":14,"newStart":278,"newLines":14,"lines":[" "," | Metric | Target | Current |"," |--------|--------|---------|","-| Selenium test pass rate | > 98% | 99.7% ✅ |","-| TypeScript errors | 0 | 0 ✅ |","-| Vite build warnings | 0 critical | 0 ✅ |","-| API response time (P95) | < 500ms | ~200-300ms ✅ |","-| WCAG AA compliance | 100% | 100% ✅ |","-| External API uptime | > 99.5% (with fallback) | 100% ✅ |","-| Bundle size | < 3MB | ~2.5MB ✅ |","-| Cloud Run cold start | < 3s | < 2s ✅ |","+| Selenium test pass rate | > 98% | 99.7% |","+| TypeScript errors | 0 | 0 |","+| Vite build warnings | 0 critical | 0 |","+| API response time (P95) | < 500ms | ~200-300ms |","+| WCAG AA compliance | 100% | 100% |","+| External API uptime | > 99.5% (with fallback) | 100% |","+| Bundle size | < 3MB | ~2.5MB |","+| Cloud Run cold start | < 3s | < 2s |"," "," ### Phase 5 Additional Targets"," "]},{"oldStart":319,"oldLines":17,"newStart":323,"newLines":17,"lines":[" | Agent | Total Tasks | P0 | P1 | P2 | P3 |"," |-------|-------------|----|----|----|----|"," | **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |","-| **Fullstack** | 20 | 0 | 8 | 12 | 0 |","-| **Frontend** | 10 | 0 | 2 | 7 | 1 |","+| **Fullstack** | 23 | 0 | 8 | 15 | 0 |","+| **Frontend** | 12 | 0 | 2 | 9 | 1 |"," | **Tester** | 8 | 0 | 4 | 4 | 0 |"," | **DevOps** | 9 | 0 | 3 | 6 | 0 |","-| **TOTAL** | **44** (DONE: 2, TODO: 42) |","+| **TOTAL** | **50** (DONE: 2, TODO: 48) |"," "," ### Recommended Execution Order (Critical Path)"," "," **Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**","-1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)","-2. 5.1.4 → 5.2.3 (WebSocket design → implementation)","+1. 5.1.3 -> 5.2.1 -> 5.2.2 (Vertex AI architecture -> implementation -> prompts)","+2. 5.1.4 -> 5.2.3 (WebSocket design -> implementation)"," 3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)"," 4. 5.1.8 (Firestore migration strategy — enables schema evolution)"," "]},{"oldStart":341,"oldLines":28,"newStart":345,"newLines":29,"lines":[" "," **Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**"," 9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)","-10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)","-11. 5.3.2 (Notification bell — depends on WebSocket backend)","-12. 5.5.2 (Staging environment — enables test pipeline)","+10. 5.2.15, 5.2.16 (File upload + GDPR pipeline)","+11. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)","+12. 5.3.2 (Notification bell — depends on WebSocket backend)","+13. 5.5.2 (Staging environment — enables test pipeline)"," "," **Sprint 12 (Weeks 23-24): Frontend + Testing Start**","-13. 5.3.3–5.3.10 (Remaining frontend features — parallel)","-14. 5.4.1 (Selenium regression suite — can begin once features stabilise)","-15. 5.4.6 (CI test pipeline — enables automated testing)","-16. 5.4.7 (Test data factory — enables isolated testing)","+14. 5.3.3-5.3.12 (Remaining frontend features — parallel)","+15. 5.4.1 (Selenium regression suite — can begin once features stabilise)","+16. 5.4.6 (CI test pipeline — enables automated testing)","+17. 5.4.7 (Test data factory — enables isolated testing)"," "," **Sprint 13 (Weeks 25-26): Testing + QA**","-17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)","-18. 5.4.8 (Security testing)","-19. 5.5.4 (Cloud Monitoring alerts)","-20. 5.5.5 (Database backup strategy)","+18. 5.4.2-5.4.5 (Unit, integration, load, accessibility tests — parallel)","+19. 5.4.8 (Security testing)","+20. 5.5.4 (Cloud Monitoring alerts)","+21. 5.5.5 (Database backup strategy)"," "," **Sprint 14 (Weeks 27-28): DevOps + Polish**","-21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)","-22. 5.5.8, 5.5.9 (Runbook, log monitoring)","-23. 5.1.7 (API documentation — after all endpoints stable)","-24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)","-25. Final regression testing and production deploy","+22. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)","+23. 5.5.8, 5.5.9 (Runbook, log monitoring)","+24. 5.1.7 (API documentation — after all endpoints stable)","+25. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)","+26. Final regression testing and production deploy"," "," ---"," "]},{"oldStart":370,"oldLines":24,"newStart":375,"newLines":29,"lines":[" "," ```"," Vertex AI Chain:","-  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)","-    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)","-    → 5.2.14 (AI repair intake)","+  5.1.3 (architecture) -> 5.2.1 (SDK integration) -> 5.2.2 (prompts)","+    -> 5.2.11 (AI drafting) -> 5.3.1 (chat UI)","+    -> 5.2.14 (AI repair intake)"," "," WebSocket Chain:","-  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)","-    → 5.3.2 (notification bell) → 5.3.9 (real-time status)","-    → 5.2.8 (Firestore listeners)","+  5.1.4 (architecture) -> 5.2.3 (Socket.io server) -> 5.2.4 (notifications)","+    -> 5.3.2 (notification bell) -> 5.3.9 (real-time status)","+    -> 5.2.8 (Firestore listeners)"," "," Testing Chain:","-  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)","-    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)","+  5.5.2 (staging env) -> 5.4.6 (CI pipeline) -> 5.4.7 (test factory)","+    -> 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)"," "," DevOps Chain:","-  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)","-    → 5.5.5 (backups) → 5.5.7 (custom domain)","+  5.5.1 (cloudbuild fix) -> 5.5.2 (staging) -> 5.5.4 (monitoring)","+    -> 5.5.5 (backups) -> 5.5.7 (custom domain)","+","+File/Data Chain:","+  5.2.15 (file upload) -> 5.3.10 (tenant portal photos)","+  5.2.16 (GDPR pipeline) -> 5.3.12 (GDPR dashboard)","+  5.2.10 (audit log API) -> 5.3.11 (user management)"," ```"," "," ---"," ","-**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**","+**Plan Version 6.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**"]}],"originalFile":"# SocialHomes.Ai — Master Execution Plan\n\n> Multi-agent orchestration plan for building SocialHomes.Ai to production readiness and beyond.\n> Version 5.0 | 2026-02-25 | Updated by Business Analyst Agent\n> Studio: Yantra Works\n\n---\n\n## PLAN SUMMARY\n\n| Phase | Name | Sprints | Status | Progress |\n|-------|------|---------|--------|----------|\n| 0 | Infrastructure | — | ✅ DONE | 10/10 |\n| 1 | Foundation | 1–2 | ✅ DONE | 12/12 |\n| 2 | Intelligence | 3–4 | ✅ DONE | 14/14 |\n| 3 | Enrichment | 5–6 | ✅ DONE | 14/17 (3 deferred) |\n| 4 | Completion | 7–8 | ✅ DONE | 11/14 (3 deferred) |\n| **5** | **Evolution** | **9–14** | **🔵 TODO** | **0/44** |\n\n---\n\n## PHASE 0: INFRASTRUCTURE — ✅ DONE (10/10)\n\n| # | Task | Status | Agent |\n|---|------|--------|-------|\n| 0.1 | Verify 4 bug fixes from Selenium testing | DONE | Claude Code |\n| 0.2 | Fix 11 Selenium test warnings (WARN-001 to WARN-011) | DONE | Claude Code |\n| 0.3 | Install and configure Entire.io CLI | DONE | Claude Code |\n| 0.4 | Build and deploy via git push → Cloud Build | DONE | Claude Code |\n| 0.5 | Configure Telegram MCP (@SocialHomesBot) | DONE | Claude Code |\n| 0.6 | Create persistent SESSION-HISTORY.md | DONE | Claude Code |\n| 0.7 | Create CLAUDE.md project instructions | DONE | Claude Code |\n| 0.8 | UI/UX Audit → Doc4-UI-UX-Audit-Build-Guide.md | DONE | Frontend Agent |\n| 0.9 | BA Requirements → Doc3-Public-API-Integration-Requirements.txt | DONE | BA Agent |\n| 0.10 | Master Execution Plan (this document) | DONE | Claude Code |\n\n---\n\n## PHASE 1: FOUNDATION (Sprints 1-2, Weeks 1-4) — ✅ DONE (12/12)\n\n### Goal: Core external API infrastructure + free API integrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 1.1 | Create `server/src/services/external-api.ts` — shared caching, rate limiting, audit logging | P1 | M | Fullstack | DONE |\n| 1.2 | Create `externalDataCache` Firestore collection + TTL management | P1 | M | Fullstack | DONE |\n| 1.3 | Integrate postcodes.io — postcode lookup, LSOA, lat/long | P1 | S | Fullstack | DONE |\n| 1.4 | Integrate Open UPRN (uprn.uk) — UPRN lookup | P1 | S | Fullstack | DONE |\n| 1.5 | Integrate data.police.uk — street-level crime, ASB data | P1 | M | Fullstack | DONE |\n| 1.6 | Integrate Open-Meteo API — enhanced weather (hourly + historical) | P1 | S | Fullstack | DONE |\n| 1.7 | Integrate DEFRA Flood Risk API — flood warnings per property | P1 | S | Fullstack | DONE |\n| 1.8 | Load IMD data (ONS CSV → Firestore) | P1 | M | Fullstack | DONE |\n| 1.9 | Extend TypeScript types (14 new interfaces + property/tenant/estate extensions) | P1 | M | Fullstack | DONE |\n| 1.10 | Unit tests for all Tier 1 API integrations (66 tests, 3 files) | P1 | M | Tester | DONE |\n| 1.11 | Selenium regression test for Phase 1 APIs | P1 | M | Tester | DONE |\n| 1.12 | Contextual user manual help system (20 pages, HelpDrawer) | P1 | M | Documentation | DONE |\n\n---\n\n## PHASE 2: INTELLIGENCE (Sprints 3-4, Weeks 5-8) — ✅ DONE (14/14)\n\n### Goal: 7 killer differentiators + Tier 2 API registrations\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 2.1 | **Predictive Damp Intelligence** — 5-factor weighted algorithm | P1 | L | Fullstack | DONE |\n| 2.2 | **Live Crime Context for ASB** — police data correlation | P1 | L | Fullstack | DONE |\n| 2.3 | **Automatic Vulnerability Detection** — 7-factor scoring | P1 | L | Fullstack | DONE |\n| 2.4 | **Property Passport** — multi-source aggregation | P1 | L | Fullstack | DONE |\n| 2.5 | **Benefits Entitlement Engine** — UK benefit rules analysis | P1 | L | Fullstack | DONE |\n| 2.6 | **AI Neighbourhood Briefing** — per-estate daily intelligence | P1 | L | Fullstack | DONE |\n| 2.7 | Create DWP Universal Credit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.8 | Create IoT sensor mock endpoints (Switchee/Aico) | P2 | M | Fullstack | DONE |\n| 2.9 | Create GoCardless direct debit mock endpoints | P2 | M | Fullstack | DONE |\n| 2.10 | Create NOMIS labour market mock endpoints | P2 | M | Fullstack | DONE |\n| 2.11 | Frontend: Damp Intelligence panel on property detail | P1 | M | Frontend | DONE |\n| 2.12 | Frontend: Vulnerability + Benefits panels on tenant detail | P1 | M | Frontend | DONE |\n| 2.13 | Frontend: AI Centre Differentiators hub with scan | P1 | L | Frontend | DONE |\n| 2.14 | Frontend: Neighbourhood Briefing panel component | P1 | M | Frontend | DONE |\n\n---\n\n## PHASE 3: ENRICHMENT (Sprints 5-6, Weeks 9-12) — ✅ DONE (14/17)\n\n### Goal: Remaining differentiators + Tier 2 APIs + enhanced UI\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 3.1 | **Benefits Entitlement Engine** — NOMIS + IMD + household | P2 | L | Fullstack | DONE (via NOMIS integration) |\n| 3.2 | **AI Neighbourhood Briefing** — per-estate weekly briefing | P1 | L | Fullstack | DONE |\n| 3.3 | **GOV.UK Notify templates** — full template library (24 templates, 7 categories) | P1 | M | Fullstack | DONE |\n| 3.4 | Register and integrate Met Office DataHub | P2 | M | Fullstack | DEFERRED (Open-Meteo sufficient) |\n| 3.5 | Integrate Census 2021 API (ONS via NOMIS) | P2 | M | Fullstack | DONE |\n| 3.6 | Integrate NOMIS API — labour market stats | P2 | M | Fullstack | DONE |\n| 3.7 | Register OS Places/Maps API (PSGA) | P2 | M | Fullstack | DEFERRED (OSM tiles sufficient) |\n| 3.8 | Integrate Gas Safe Register | P2 | S | Fullstack | DONE |\n| 3.9 | Integrate Electrical Safety Register | P2 | S | Fullstack | DONE |\n| 3.10 | Integrate Twilio (free tier) | P2 | M | Fullstack | DEFERRED (GOV.UK Notify preferred) |\n| 3.11 | Frontend: Benefits check card on tenant detail | P2 | M | Frontend | DONE (Phase 2) |\n| 3.12 | Frontend: Neighbourhood briefing accordion on briefing page | P1 | M | Frontend | DONE |\n| 3.13 | Frontend: Enhanced Explore map with data layer toggles | P2 | M | Frontend | DONE |\n| 3.14 | Frontend: Contractor verification badges (Gas Safe + NICEIC) | P2 | S | Frontend | DONE |\n| 3.15 | Fix accessibility gaps (focus traps, skip links, ARIA, motion) | P2 | M | Frontend | DONE |\n| 3.16 | Fix form validation across ActionModal | P2 | M | Frontend | DONE |\n| 3.17 | E2E testing for all new features | P1 | L | Tester | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 4: COMPLETION (Sprints 7-8, Weeks 13-16) — ✅ DONE (11/14)\n\n### Goal: Mock services + polish + production hardening\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 4.1 | GoCardless/Allpay mock payment endpoints | P3 | M | Fullstack | DONE (Phase 2) |\n| 4.2 | Plentific/Fixflo mock repairs marketplace | P3 | M | Fullstack | DONE |\n| 4.3 | RSH/CORE/Ombudsman mock regulatory submissions | P3 | M | Fullstack | DONE |\n| 4.4 | DocuSign mock digital signing | P3 | M | Fullstack | DONE |\n| 4.5 | Experian/TransUnion mock referencing | P3 | M | Fullstack | DONE |\n| 4.6 | Land Registry data integration | P3 | S | Fullstack | DONE |\n| 4.7 | Admin: Integration management dashboard (20 integrations, 3 tiers) | P2 | M | Frontend | DONE |\n| 4.8 | Admin: Toggle integrations on/off + test connection | P2 | S | Frontend | DONE |\n| 4.9 | Performance: Cache warming, batch updates | P2 | M | Fullstack | DEFERRED (cache-through sufficient) |\n| 4.10 | Security audit (CSP, CORS, rate limiting, security headers) | P1 | M | Fullstack | DONE |\n| 4.11 | Production monitoring (metrics, health checks, structured logging) | P1 | M | DevOps | DONE |\n| 4.12 | Full regression test suite | P1 | L | Tester | DEFERRED to Phase 5 |\n| 4.13 | Load testing (100 concurrent users) | P2 | M | Tester | DEFERRED to Phase 5 |\n| 4.14 | Documentation: API reference for integrations | P2 | M | BA | DEFERRED to Phase 5 |\n\n---\n\n## PHASE 5: EVOLUTION (Sprints 9-14, Weeks 17-28) — 🔵 TODO (0/44)\n\n### Goal: Real AI, real-time features, advanced testing, production scaling, SaaS readiness\n\nPhase 5 is organized into 5 sub-phases matching the required agent structure:\nProject Setup & Architecture, Backend Development, Frontend Development,\nTesting & QA, and DevOps & Deployment.\n\n---\n\n### PHASE 5.1: PROJECT SETUP & ARCHITECTURE (Sprint 9)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.1.1 | Update comprehensive BA specification docs in `docs/requirements/` (Doc1, Doc2, Doc3) v5.0 | P0 | L | BA | DONE |\n| 5.1.2 | Update EXECUTION-PLAN.md with Phase 5 detailed tasks (v5.0) | P0 | M | BA | DONE |\n| 5.1.3 | Define Vertex AI / Gemini integration architecture for Yantra Assist — design prompt templates, context injection, token management, streaming response pattern, model selection (Gemini Pro vs Flash), safety settings, grounding with housing data | P1 | L | Fullstack | TODO |\n| 5.1.4 | Design WebSocket (Socket.io) architecture for real-time notifications — connection management, room-based subscriptions (per-user, per-estate, per-org), reconnection strategy, message format, authentication handshake via Firebase token | P1 | M | Fullstack | TODO |\n| 5.1.5 | Design event-driven architecture using Cloud Pub/Sub — define topics (case-created, case-updated, compliance-expiring, arrears-threshold, damp-alert), subscriptions, dead letter queues, message schemas for async workflows | P2 | L | Fullstack | TODO |\n| 5.1.6 | Define multi-tenant data isolation strategy for SaaS deployment — organisation-scoped Firestore queries, tenant context middleware, data partitioning, branding customisation, per-org configuration, billing model design | P2 | XL | Fullstack | TODO |\n| 5.1.7 | Create API reference documentation (OpenAPI/Swagger spec) for all 50+ endpoints — request/response schemas, authentication docs, example payloads, error codes, rate limit documentation | P2 | L | BA | TODO |\n| 5.1.8 | Design Firestore data migration strategy — version schema changes, backward compatibility, migration scripts, rollback procedures, zero-downtime migration patterns | P2 | M | Fullstack | TODO |\n| 5.1.9 | Design AI model versioning and A/B testing framework — model registry, feature flags for AI features, confidence threshold tuning, model performance tracking, feedback loop architecture | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.2: BACKEND DEVELOPMENT (Sprints 9-11)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.2.1 | Integrate Vertex AI (Gemini Pro) for Yantra Assist — server-side SDK, streaming responses via Server-Sent Events, context window management (property/tenant/case data injection), conversation history with Firestore persistence, token counting and budget enforcement | P1 | XL | Fullstack | TODO |\n| 5.2.2 | Build AI prompt engineering layer — context-aware system prompts per entity type (tenant, property, case, compliance, rent), few-shot examples for housing domain, safety guardrails (PII masking, hallucination prevention), persona-scoped response formatting | P1 | L | Fullstack | TODO |\n| 5.2.3 | Implement WebSocket server (Socket.io) — connection lifecycle, authentication handshake with Firebase JWT, room management (per-user, per-estate, per-org), heartbeat, graceful disconnect, Cloud Run sticky sessions configuration | P1 | L | Fullstack | TODO |\n| 5.2.4 | Build notification dispatch service — orchestrate GOV.UK Notify email/SMS (API key integration), in-app WebSocket push, notification queue (Firestore-based), delivery tracking, retry logic (3 retries with backoff), notification preferences enforcement | P1 | L | Fullstack | TODO |\n| 5.2.5 | Implement circuit breaker pattern for external API resilience — per-source failure tracking, state machine (closed/open/half-open), configurable thresholds (5 failures to open, 60s half-open), fallback activation, metrics integration, admin dashboard visibility | P2 | M | Fullstack | TODO |\n| 5.2.6 | Add cache warming service — scheduled pre-fetch for frequently accessed estate data (weather, crime, demographics), Cloud Scheduler trigger (every 2 hours for weather, daily for crime), background job runner with Firestore lock to prevent duplicates | P2 | M | Fullstack | TODO |\n| 5.2.7 | Build scheduled task runner (Cloud Scheduler / cron) — compliance reminders (30/14/7 days before certificate expiry), daily briefing pre-computation, weekly TSM metric refresh, monthly regulatory report generation, arrears escalation triggers | P2 | M | Fullstack | TODO |\n| 5.2.8 | Implement Firestore real-time listeners for case updates — server-side onSnapshot subscriptions on cases collection, change detection (status transitions, SLA breaches), WebSocket broadcast to connected clients, optimistic locking for concurrent edits | P2 | M | Fullstack | TODO |\n| 5.2.9 | Add bulk operations API — batch case status updates (bulk close resolved repairs), bulk communication send (all tenants in estate), batch compliance certificate upload, batch arrears action (PAP letters), progress tracking via WebSocket | P2 | M | Fullstack | TODO |\n| 5.2.10 | Build audit log query API — filtering by entity/user/action/date range, full-text search, pagination, CSV export for GDPR SAR requests, aggregation queries (actions per user per day), retention policy enforcement (auto-delete after 7 years) | P2 | M | Fullstack | TODO |\n| 5.2.11 | Implement AI communication drafting with Vertex AI — replace rule-based template drafts with LLM-generated personalised emails, tone selection (supportive/formal/urgent/legal), legal compliance check against Housing Ombudsman Code, template suggestion based on case context | P1 | L | Fullstack | TODO |\n| 5.2.12 | Add tenant activity scoring — calculate contact frequency, case history patterns, payment behaviour, engagement score (0-100), correlation with vulnerability score, proactive outreach triggers for disengaged tenants | P2 | M | Fullstack | TODO |\n| 5.2.13 | Implement real-time Awaab's Law compliance engine — automatic deadline calculation on damp/mould case creation, SLA breach detection with automatic escalation, proactive notification chain (tenant, officer, manager, regulator), compliance audit trail | P1 | L | Fullstack | TODO |\n| 5.2.14 | Build AI-powered repair intake service — free-text description analysis with Vertex AI, automatic SOR code suggestion, priority assignment, trade identification, asbestos flag check, recurring pattern detection, cost estimation, Awaab's Law flag | P2 | L | Fullstack | TODO |\n\n---\n\n### PHASE 5.3: FRONTEND DEVELOPMENT (Sprints 11-12)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.3.1 | Build Yantra Assist conversational UI — chat panel with streaming text display (SSE), message history with Firestore persistence, context indicator showing current entity, typing animation, copy/share responses, suggested follow-up questions, markdown rendering | P1 | L | Frontend | TODO |\n| 5.3.2 | Implement real-time notification bell with WebSocket — notification dropdown in header, unread count badge (animated), mark-as-read on click, notification categories (case/compliance/arrears/system), click-to-navigate to source entity, sound alert option | P1 | M | Frontend | TODO |\n| 5.3.3 | Build notification preferences page — per-channel toggles (email/SMS/in-app/portal), frequency settings (immediate/daily digest/weekly summary), category subscriptions (repairs/complaints/compliance/arrears/ASB), quiet hours configuration | P2 | M | Frontend | TODO |\n| 5.3.4 | Add interactive chart drill-downs — clickable chart elements on dashboard drill into filtered list views (click repair bar → filtered repairs list), Recharts onClick handlers, breadcrumb-aware navigation, chart-to-table transition animation | P2 | M | Frontend | TODO |\n| 5.3.5 | Build workflow builder UI — visual drag-and-drop for admin workflow engine, trigger selection (case created, SLA approaching, arrears threshold), condition builder (if type=repair AND priority=emergency), action configuration (send email, create task, assign case), flow preview and test mode | P2 | XL | Frontend | TODO |\n| 5.3.6 | Implement dark/light theme toggle — Tailwind CSS custom property swap, system preference detection (prefers-color-scheme), manual override with localStorage persistence, smooth 300ms transition animation, ensure all 40+ pages render correctly in both modes | P3 | M | Frontend | TODO |\n| 5.3.7 | Add progressive loading and performance optimisation — React.lazy() + Suspense boundaries on heavy pages (Explore 3D, AI Centre), skeleton screens matching page layout, intersection observer for below-fold content, image lazy loading, route-level code splitting | P2 | M | Frontend | TODO |\n| 5.3.8 | Build mobile-responsive layout adaptations — collapsible sidebar (hamburger menu on tablet/mobile), stacked KPI cards on mobile, touch-friendly map controls (pinch zoom), responsive data tables (horizontal scroll or card view), bottom navigation bar on mobile | P2 | L | Frontend | TODO |\n| 5.3.9 | Add real-time case status indicators — WebSocket-driven StatusPill components that update live without page refresh, optimistic UI updates on case actions, conflict resolution for concurrent edits (last-write-wins with notification), case lock indicator when another user is editing | P2 | M | Frontend | TODO |\n| 5.3.10 | Build tenant portal enhancements — responsive design for mobile-first tenant access, repair wizard (step-by-step with photo upload), rent balance check with payment history chart, document viewer (tenancy agreement, gas cert), accessibility improvements for diverse user base | P2 | L | Frontend | TODO |\n\n---\n\n### PHASE 5.4: TESTING & QA (Sprints 12-13)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.4.1 | Build comprehensive Selenium regression suite covering all 40+ routes — page load verification, CRUD operations on cases/tenants/properties, navigation flows (sidebar, breadcrumbs, search), error states (network failure, auth expiry), screenshot on failure | P1 | XL | Tester | TODO |\n| 5.4.2 | Write unit tests for all 7 AI services — damp-prediction.ts (5-factor edge cases), crime-context.ts (data correlation), vulnerability-detection.ts (7-factor scoring boundaries), benefits-engine.ts (UK benefit rules), property-passport.ts (aggregation), neighbourhood-briefing.ts (multi-source), govuk-notify.ts (template rendering) | P1 | L | Tester | TODO |\n| 5.4.3 | Write integration tests for external API proxy routes — mock HTTP servers for Police.uk/Open-Meteo/DEFRA/NOMIS, test cache-through pattern (cache miss → API call → cache hit), verify fallback behaviour on timeout/error, test rate limiting enforcement | P1 | L | Tester | TODO |\n| 5.4.4 | Perform load testing — Artillery or k6 scripts for 100 concurrent users, measure P95 latency across key endpoints (properties list, case detail, AI damp risk), identify bottlenecks (Firestore query limits, external API rate limits), test Cloud Run auto-scaling (0 → 10 instances) | P2 | M | Tester | TODO |\n| 5.4.5 | Perform accessibility audit — aXe or Lighthouse automated scan on all 40+ pages, fix all critical/serious violations, achieve >90 Lighthouse accessibility score, test with screen reader (NVDA/VoiceOver), keyboard-only navigation test for all workflows | P2 | M | Tester | TODO |\n| 5.4.6 | Set up CI test pipeline — GitHub Actions workflow running TypeScript check + unit tests + integration tests on every PR, Cloud Build step for E2E tests on staging, test report generation (JUnit XML), code coverage reporting, fail-on-error with status checks | P1 | M | Tester | TODO |\n| 5.4.7 | Create test data factory — parameterised builder functions for all entity types (createProperty(), createTenant(), createCase()), consistent seed data for test isolation, Firestore emulator integration for local testing, cleanup utilities | P2 | M | Tester | TODO |\n| 5.4.8 | Security testing — OWASP Top 10 verification, SQL injection prevention (N/A for Firestore but verify query construction), XSS testing on all input fields, CSRF token verification, authentication bypass testing, rate limit bypass testing, CSP violation testing | P1 | M | Tester | TODO |\n\n---\n\n### PHASE 5.5: DEVOPS & DEPLOYMENT (Sprints 13-14)\n\n| # | Task | Priority | Complexity | Agent | Status |\n|---|------|----------|------------|-------|--------|\n| 5.5.1 | Fix cloudbuild.yaml to use correct Artifact Registry path (`cloud-run-source-deploy/socialhomes`) — update image tag, add multi-stage build steps, add test step before deploy, add build notifications to Telegram, version tagging with git SHA | P1 | S | DevOps | TODO |\n| 5.5.2 | Set up staging environment on Cloud Run — separate service (`socialhomes-staging`), separate secrets (staging Firebase project), deploy-on-PR workflow, automatic cleanup of old revisions, staging URL for QA testing, environment variable differentiation | P1 | M | DevOps | TODO |\n| 5.5.3 | Configure Cloud Run auto-scaling policies — CPU utilisation target (70%), memory threshold, request latency trigger (P95 > 500ms → scale up), min instances (1 for production to avoid cold start), max instances (10), concurrency tuning (80 → optimal), startup probe and liveness check | P2 | M | DevOps | TODO |\n| 5.5.4 | Set up Cloud Monitoring alerts — error rate >5% alert, P95 latency >1s alert, memory >80% alert, Firestore read/write quota >80% warning, failed health check alert, notification channels (email + Telegram), alert dashboard in Cloud Console | P1 | M | DevOps | TODO |\n| 5.5.5 | Implement database backup strategy — Firestore scheduled exports to Cloud Storage (daily at 02:00 UTC), retention policy (30 days daily, 12 months weekly), point-in-time recovery testing, restore procedure documentation, backup monitoring alert | P1 | M | DevOps | TODO |\n| 5.5.6 | Set up Cloud CDN for static assets — frontend build output served via CDN edge nodes, cache-control headers (max-age=31536000 for hashed assets, no-cache for index.html), invalidation on deploy, compression (brotli/gzip), performance benchmarking | P2 | M | DevOps | TODO |\n| 5.5.7 | Configure custom domain with SSL — socialhomes.ai domain, Cloud Run domain mapping, managed SSL certificate via Google-managed, HTTP→HTTPS redirect, www→non-www redirect, DNS configuration documentation | P2 | S | DevOps | TODO |\n| 5.5.8 | Create runbook documentation — incident response procedures (severity levels, escalation matrix), rollback process (Cloud Run revision rollback), database recovery (Firestore import), secret rotation procedure, scaling playbook, on-call guide, post-mortem template | P2 | M | DevOps | TODO |\n| 5.5.9 | Set up log-based monitoring — Cloud Logging structured query for error patterns, log-based metrics (4xx rate, 5xx rate, auth failures), log sink to BigQuery for long-term analysis, correlation with request IDs, PII filtering in logs | P2 | M | DevOps | TODO |\n\n---\n\n## AGENT ROLES\n\n| Agent | Responsibility | Key Files |\n|-------|---------------|-----------|\n| **Fullstack** | Server routes, API integrations, data models, Firestore, AI services | `server/src/routes/`, `server/src/services/`, `server/src/models/` |\n| **Frontend** | UI components, pages, state management, styling, accessibility | `app/src/pages/`, `app/src/components/`, `app/src/hooks/` |\n| **Tester** | Selenium E2E, unit tests, integration tests, load tests, a11y audits | `tests/`, `server/src/routes/*.test.ts` |\n| **BA** | Requirements, specification docs, user stories, API reference | `docs/requirements/`, `Doc1-*.txt`, `Doc2-*.txt`, `Doc3-*.txt` |\n| **DevOps** | CI/CD, monitoring, security, infrastructure, scaling, backups | `cloudbuild.yaml`, `Dockerfile`, `DEVOPS.md` |\n\n---\n\n## KEY DOCUMENTS\n\n| Document | Location | Purpose |\n|----------|----------|---------|\n| Doc1-socialhomes-Base-Specification.txt | `docs/requirements/` | Core product specification (v5.0) |\n| Doc2-socialhomes-Technical-Architecture.txt | `docs/requirements/` | Technical architecture & data models (v5.0) |\n| Doc3-socialhomes-API-Requirements.txt | `docs/requirements/` | API endpoints & integration requirements (v5.0) |\n| Doc1-SocialHomesAi-Base-Specification.txt | Project root | Original base specification |\n| Doc2-SocialHomesAi-AI-Native-Features.txt | Project root | Original AI features specification |\n| Doc3-Public-API-Integration-Requirements.txt | Project root | Original public API requirements (2,333 lines) |\n| Doc4-UI-UX-Audit-Build-Guide.md | Project root | Frontend UI/UX audit + build guide |\n| CLAUDE.md | Project root | Claude Code project instructions |\n| SESSION-HISTORY.md | Project root | Persistent conversation history |\n| DEV-FIX-LIST.md | Project root | Bug/warning tracker from Selenium tests |\n| DEVOPS.md | Project root | DevOps and deployment guide |\n| EXECUTION-PLAN.md | Project root | This document |\n\n---\n\n## COMMUNICATION\n\n### Telegram (@SocialHomesBot)\n- **Async notifications**: Build status, deployment confirmations, test results\n- **Permission requests**: Routed via Telegram when user is away from desk\n- **Progress updates**: Phase/sprint completion summaries\n- **MCP config**: `.mcp.json` (not committed — contains bot token)\n\n### Session Continuity\n- Update `SESSION-HISTORY.md` at end of every session\n- `CLAUDE.md` provides context for new sessions\n- Entire.io captures checkpoints on commits\n\n---\n\n## METRICS & SUCCESS CRITERIA\n\n| Metric | Target | Current |\n|--------|--------|---------|\n| Selenium test pass rate | > 98% | 99.7% ✅ |\n| TypeScript errors | 0 | 0 ✅ |\n| Vite build warnings | 0 critical | 0 ✅ |\n| API response time (P95) | < 500ms | ~200-300ms ✅ |\n| WCAG AA compliance | 100% | 100% ✅ |\n| External API uptime | > 99.5% (with fallback) | 100% ✅ |\n| Bundle size | < 3MB | ~2.5MB ✅ |\n| Cloud Run cold start | < 3s | < 2s ✅ |\n\n### Phase 5 Additional Targets\n\n| Metric | Target |\n|--------|--------|\n| AI response latency (Vertex AI) | < 3s for conversational queries |\n| AI response latency (streaming first token) | < 500ms |\n| WebSocket connection stability | > 99.9% uptime |\n| Load test (100 concurrent users) | P95 < 1s, 0 errors |\n| Selenium test coverage | > 95% of routes |\n| Unit test coverage (services) | > 80% line coverage |\n| Staging deployment frequency | Every PR |\n| Database backup frequency | Daily automated |\n| Lighthouse accessibility score | > 90 on all pages |\n| Lighthouse performance score | > 80 on all pages |\n\n---\n\n## DEFERRED ITEMS (From Phases 3-4)\n\nItems deferred from earlier phases, now included in Phase 5:\n\n| Original ID | Task | New Phase 5 ID |\n|-------------|------|----------------|\n| 3.17 | E2E testing for all new features | 5.4.1 |\n| 4.12 | Full regression test suite | 5.4.1 |\n| 4.13 | Load testing (100 concurrent users) | 5.4.4 |\n| 4.14 | API reference documentation | 5.1.7 |\n| 4.9 | Cache warming, batch updates | 5.2.6 |\n\n---\n\n## PHASE 5 TASK SUMMARY BY AGENT\n\n| Agent | Total Tasks | P0 | P1 | P2 | P3 |\n|-------|-------------|----|----|----|----|\n| **BA** | 3 | 2 (DONE) | 0 | 1 | 0 |\n| **Fullstack** | 20 | 0 | 8 | 12 | 0 |\n| **Frontend** | 10 | 0 | 2 | 7 | 1 |\n| **Tester** | 8 | 0 | 4 | 4 | 0 |\n| **DevOps** | 9 | 0 | 3 | 6 | 0 |\n| **TOTAL** | **44** (DONE: 2, TODO: 42) |\n\n### Recommended Execution Order (Critical Path)\n\n**Sprint 9 (Weeks 17-18): Architecture + Backend Foundation**\n1. 5.1.3 → 5.2.1 → 5.2.2 (Vertex AI architecture → implementation → prompts)\n2. 5.1.4 → 5.2.3 (WebSocket design → implementation)\n3. 5.5.1 (Fix cloudbuild.yaml — unblocks CI)\n4. 5.1.8 (Firestore migration strategy — enables schema evolution)\n\n**Sprint 10 (Weeks 19-20): Backend Features**\n5. 5.2.4 (Notification dispatch — depends on WebSocket + GOV.UK Notify)\n6. 5.2.11 (AI communication drafting — depends on Vertex AI)\n7. 5.2.13 (Awaab's Law compliance engine — regulatory priority)\n8. 5.2.5, 5.2.6, 5.2.7 (Resilience features — parallel)\n\n**Sprint 11 (Weeks 21-22): Backend Complete + Frontend Start**\n9. 5.2.8, 5.2.9, 5.2.10, 5.2.12, 5.2.14 (Remaining backend — parallel)\n10. 5.3.1 (Yantra Assist chat UI — depends on Vertex AI backend)\n11. 5.3.2 (Notification bell — depends on WebSocket backend)\n12. 5.5.2 (Staging environment — enables test pipeline)\n\n**Sprint 12 (Weeks 23-24): Frontend + Testing Start**\n13. 5.3.3–5.3.10 (Remaining frontend features — parallel)\n14. 5.4.1 (Selenium regression suite — can begin once features stabilise)\n15. 5.4.6 (CI test pipeline — enables automated testing)\n16. 5.4.7 (Test data factory — enables isolated testing)\n\n**Sprint 13 (Weeks 25-26): Testing + QA**\n17. 5.4.2–5.4.5 (Unit, integration, load, accessibility tests — parallel)\n18. 5.4.8 (Security testing)\n19. 5.5.4 (Cloud Monitoring alerts)\n20. 5.5.5 (Database backup strategy)\n\n**Sprint 14 (Weeks 27-28): DevOps + Polish**\n21. 5.5.3, 5.5.6, 5.5.7 (Scaling, CDN, custom domain — parallel)\n22. 5.5.8, 5.5.9 (Runbook, log monitoring)\n23. 5.1.7 (API documentation — after all endpoints stable)\n24. 5.1.5, 5.1.6, 5.1.9 (Advanced architecture — parallel)\n25. Final regression testing and production deploy\n\n---\n\n## DEPENDENCY GRAPH (Key Chains)\n\n```\nVertex AI Chain:\n  5.1.3 (architecture) → 5.2.1 (SDK integration) → 5.2.2 (prompts)\n    → 5.2.11 (AI drafting) → 5.3.1 (chat UI)\n    → 5.2.14 (AI repair intake)\n\nWebSocket Chain:\n  5.1.4 (architecture) → 5.2.3 (Socket.io server) → 5.2.4 (notifications)\n    → 5.3.2 (notification bell) → 5.3.9 (real-time status)\n    → 5.2.8 (Firestore listeners)\n\nTesting Chain:\n  5.5.2 (staging env) → 5.4.6 (CI pipeline) → 5.4.7 (test factory)\n    → 5.4.1 (Selenium) + 5.4.2 (unit) + 5.4.3 (integration)\n\nDevOps Chain:\n  5.5.1 (cloudbuild fix) → 5.5.2 (staging) → 5.5.4 (monitoring)\n    → 5.5.5 (backups) → 5.5.7 (custom domain)\n```\n\n---\n\n**Plan Version 5.0 | Updated by BA Agent (Claude Opus 4.6) | Yantra Works | 2026-02-25**\n"},"sourceToolAssistantUUID":"272bc390-883c-4bc3-a103-0b37b9d2a519"}
{"parentUuid":"fc2fe25f-8828-4462-b96b-94ad0b38b744","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01FNXku3VWgmqxYaQGfsVV5P","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WbF2zLGFaoX47oC6dHwDGT","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":10011,"cache_read_input_tokens":112926,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":10011},"output_tokens":26,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMfTaynq9W3yMZg9Uo4","type":"assistant","uuid":"399a2254-5202-48d9-b339-2c29160921c5","timestamp":"2026-02-25T19:41:53.716Z"}
{"parentUuid":"399a2254-5202-48d9-b339-2c29160921c5","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WbF2zLGFaoX47oC6dHwDGT","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"77783ee0-c95e-490e-b434-6b160ad9e63f","timestamp":"2026-02-25T19:41:53.730Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"in_progress","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"pending","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"399a2254-5202-48d9-b339-2c29160921c5"}
{"parentUuid":"77783ee0-c95e-490e-b434-6b160ad9e63f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01A2vuXdGACKQQ2vcZ3hmF5J","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update SESSION-HISTORY.md:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":122937,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMfyYYVjcTcBcraVLNQ","type":"assistant","uuid":"44661cd8-d14d-44a9-a7bf-e4f3d435f867","timestamp":"2026-02-25T19:41:57.745Z"}
{"parentUuid":"44661cd8-d14d-44a9-a7bf-e4f3d435f867","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01A2vuXdGACKQQ2vcZ3hmF5J","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EXnqAwoWpHjZ34a8zurgPQ","name":"Read","input":{"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","offset":490},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":368,"cache_read_input_tokens":122937,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":368},"output_tokens":1,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMfyYYVjcTcBcraVLNQ","type":"assistant","uuid":"d254d454-857d-43d8-b13d-3529e7dc437c","timestamp":"2026-02-25T19:41:58.408Z"}
{"parentUuid":"d254d454-857d-43d8-b13d-3529e7dc437c","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EXnqAwoWpHjZ34a8zurgPQ","type":"tool_result","content":"   490→### Decisions Taken:\n   491→- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n   492→- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n   493→- Created sprint-by-sprint critical path execution order\n   494→- Added agent task summary with priority breakdown\n   495→- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n   496→- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n   497→\n   498→### Pending Work:\n   499→- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n   500→- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n   501→- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n   502→"}]},"uuid":"393f27f5-edef-425b-a0a8-ec53ceec83b1","timestamp":"2026-02-25T19:41:58.471Z","toolUseResult":{"type":"text","file":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","content":"### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n","numLines":13,"startLine":490,"totalLines":502}},"sourceToolAssistantUUID":"d254d454-857d-43d8-b13d-3529e7dc437c"}
{"parentUuid":"393f27f5-edef-425b-a0a8-ec53ceec83b1","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_015mqx2dFbRsEUNHfNfauU5V","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UzArc8nkBkKiquYQtqUJZJ","name":"Edit","input":{"replace_all":false,"file_path":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","old_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix","new_string":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n\n---\n\n## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)\n\nPerformed full project re-analysis with deep codebase exploration (40 tool calls\nacross all 116+ TypeScript files) and updated all specification documents to v6.0.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification\n   - Refreshed and validated all 17 functional modules against codebase\n   - Updated Phase 5 task count to 50 (from 44)\n   - Confirmed all 7 AI differentiators implemented and documented\n   - Validated 5 persona definitions with AI focus areas\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture\n   - Validated all version numbers against package.json files\n   - Confirmed 50+ API endpoints across 16 route modules\n   - Validated all Firestore schemas against firestore-schemas.ts\n   - Confirmed 17 composite indexes and security rules\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements\n   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)\n   - 7 killer differentiator services fully specified with algorithms\n   - 24 GOV.UK Notify templates across 7 categories\n   - Cache TTL, rate limiting, and fallback strategies documented\n\n#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):\n\n- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):\n  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)\n  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)\n  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)\n  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)\n  - Added new dependency chains for File/Data workflows\n- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9\n- All doc version references updated to v6.0\n- Refreshed critical path execution order with new tasks\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)\n- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)\n- `SESSION-HISTORY.md` (UPDATED — added Session 10)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management\n- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n- All documents validated against actual codebase (no stale references)\n- Maintained backward compatibility with all existing task IDs\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14"},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":384,"cache_read_input_tokens":123305,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":384},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMgDno2Cov4FgWo73FT","type":"assistant","uuid":"713809f2-8a1b-4848-a57d-81959a876912","timestamp":"2026-02-25T19:42:23.957Z"}
{"parentUuid":"713809f2-8a1b-4848-a57d-81959a876912","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UzArc8nkBkKiquYQtqUJZJ","type":"tool_result","content":"The file /mnt/c/.netapps/socialhomes/SESSION-HISTORY.md has been updated successfully."}]},"uuid":"f3c25948-af7c-480a-b0fd-d6eb28ca7fb3","timestamp":"2026-02-25T19:42:24.016Z","toolUseResult":{"filePath":"/mnt/c/.netapps/socialhomes/SESSION-HISTORY.md","oldString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix","newString":"### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n\n---\n\n## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)\n\nPerformed full project re-analysis with deep codebase exploration (40 tool calls\nacross all 116+ TypeScript files) and updated all specification documents to v6.0.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification\n   - Refreshed and validated all 17 functional modules against codebase\n   - Updated Phase 5 task count to 50 (from 44)\n   - Confirmed all 7 AI differentiators implemented and documented\n   - Validated 5 persona definitions with AI focus areas\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture\n   - Validated all version numbers against package.json files\n   - Confirmed 50+ API endpoints across 16 route modules\n   - Validated all Firestore schemas against firestore-schemas.ts\n   - Confirmed 17 composite indexes and security rules\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements\n   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)\n   - 7 killer differentiator services fully specified with algorithms\n   - 24 GOV.UK Notify templates across 7 categories\n   - Cache TTL, rate limiting, and fallback strategies documented\n\n#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):\n\n- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):\n  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)\n  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)\n  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)\n  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)\n  - Added new dependency chains for File/Data workflows\n- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9\n- All doc version references updated to v6.0\n- Refreshed critical path execution order with new tasks\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)\n- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)\n- `SESSION-HISTORY.md` (UPDATED — added Session 10)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management\n- Total Phase 5: 50 tasks (2 DONE, 48 TODO)\n- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard\n- All documents validated against actual codebase (no stale references)\n- Maintained backward compatibility with all existing task IDs\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14","originalFile":"# SocialHomes.Ai — Session History\n\n> Persistent conversation log across all Claude Code sessions.\n> Updated at the end of each session to preserve context.\n\n---\n\n## Session 1 — 2026-02-12 (Google Drive path)\n**Working directory:** `/mnt/g/My Drive/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Initial project setup and exploration\n- Telegram MCP bot configured (@SocialHomesBot, chat ID: socialhomes:8020560167)\n- Comprehensive Selenium testing initiated (17 test classes)\n- Project overview sent to Telegram\n\n### Key decisions:\n- Persona-scoped architecture (COO, Head of Housing, Manager, Housing Officer, Operative)\n- AI-native features: YantraAssist, entity intelligence, dynamic fields\n- Firestore backend with 75 properties, 68 tenants, 279 cases seeded\n\n---\n\n## Session 2 — 2026-02-13 (Migrated to C: drive)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n- Security cleanup: removed all exposed API keys and secrets from codebase\n- Added full workflow actions and cross-entity navigation\n- Eliminated all React Error #310 instances\n- Redesigned login page\n- Polished dashboard\n- Updated DEVOPS.md\n\n### Commits:\n- `e0c23e4` — security: remove all exposed API keys and secrets from codebase\n- `944e952` — feat: add full workflow actions & cross-entity navigation\n- `7f6c245` — fix: eliminate all React Error #310 + add action modals\n- `73fe9d7` — fix: eliminate Error #310 at source + redesign login + polish dashboard\n- `3d6cedd` — docs: update DEVOPS.md with security, serialisation, and UI changes\n\n---\n\n## Session 3 — 2026-02-14\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 1: Verified 4 previous bug fixes\n- BUG-001: ComplaintDetailPage.tsx — null checks intact\n- BUG-002: TenancyDetailPage.tsx — safeText() and ?? [] guards intact\n- BUG-003: AsbPage.tsx — navigation handlers intact\n- BUG-004: DashboardPage.tsx — \"Void Properties\" KPI card intact\n\n#### Task 2: Fixed 11 Selenium test warnings (WARN-001 to WARN-011)\n| Warning | File | Fix |\n|---------|------|-----|\n| WARN-001 | Header.tsx | Added aria-label=\"Yantra Assist\" + yantra-assist-trigger class |\n| WARN-002 | Breadcrumbs.tsx | Added aria-label=\"breadcrumb\" + breadcrumb-* classes |\n| WARN-003 | ExplorePage.tsx | Added marker.bindPopup() with entity info |\n| WARN-004 | ExplorePage.tsx | Changed children list to ul/li elements |\n| WARN-005 | BriefingPage.tsx | Added \"View\"/\"Review\" action buttons to tasks |\n| WARN-006 | BriefingPage.tsx | Added COMPLIANCE section with Big 6 stats |\n| WARN-007 | PropertiesPage.tsx | Added mini Leaflet map in list view |\n| WARN-008 | TenanciesPage.tsx | Added data-testid + dynamic count subtitle |\n| WARN-009 | TenantPortalPage.tsx | Added Quick Message form with select/textarea |\n| WARN-010 | AllocationsPage.tsx | Fixed useMemo dependency + address fallback |\n| WARN-011 | (no fix) | 131KB API response is expected behavior |\n\n#### Task 3: Installed Entire.io CLI\n- Installed v0.4.4 at ~/.local/bin/entire\n- Strategy: manual-commit\n- Fixed all 4 git hooks with PATH export\n\n#### Task 4: Build and deploy\n- TypeScript: 0 errors\n- Vite build: 2,580.62 kB JS bundle\n- Commit: `1aa4cdd` — fix: resolve 11 Selenium test warnings (WARN-001 to WARN-011)\n- Push: succeeded → Cloud Build triggered\n\n---\n\n## Session 4 — 2026-02-14 (current)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 5: Telegram notifications setup\n- Recovered existing @SocialHomesBot config (token + chat ID: 8020560167)\n- Created .mcp.json with telegram MCP server config\n- Added .mcp.json to .gitignore (contains bot token)\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n#### Task 6: Persistent conversation history\n- Created this file (SESSION-HISTORY.md) to preserve context across sessions\n- Added to .gitignore (local dev reference only)\n\n#### Task 7: Entire.io repo\n- Entire.io CLI v0.4.4 installed, strategy: manual-commit\n- No checkpoints yet (first commit after setup didn't trigger checkpoint)\n- GitHub repo: https://github.com/rajivpeter/SocialHomes_ai\n- Entire.io dashboard: https://app.entire.io (login required)\n\n#### Task 8: UI/UX Audit Document (in progress)\n- Frontend UI engineer agent reviewing all pages, components, interactions\n- Output: comprehensive audit for fullstack and tester agents\n\n#### Task 9: BA Requirements — Public API Integrations (in progress)\n- Business analyst agent creating Doc3-Public-API-Integration-Requirements.txt\n- Covers 30+ public service APIs across 3 tiers (Free/Registration/Subscription)\n- 7 killer differentiators documented\n\n#### Task 10: Master Execution Plan (pending)\n- Will be created after Tasks 8 and 9 complete\n\n---\n\n## Architecture Reference\n\n### Tech Stack\n- **Frontend:** React 19 + TypeScript + Vite + Tailwind CSS\n- **Backend:** Express.js + TypeScript\n- **Database:** Google Firestore\n- **Hosting:** Google Cloud Run (europe-west2)\n- **CI/CD:** GitHub → Cloud Build → Artifact Registry → Cloud Run\n- **Maps:** Leaflet.js + OpenStreetMap\n- **3D:** Three.js\n- **Charts:** Recharts\n- **AI:** YantraAssist (contextual AI assistant)\n\n### Key URLs\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GitHub:** https://github.com/rajivpeter/SocialHomes_ai\n- **GCP Project:** gen-lang-client-0878518473 (project number: 587984201316)\n- **Firebase Project:** gen-lang-client-0146156913\n- **Entire.io dashboard:** https://app.entire.io\n\n### Personas\n1. COO — Organisation-wide view\n2. Head of Housing — Regional oversight\n3. Housing Manager — Estate/block management\n4. Housing Officer — Frontline casework\n5. Repairs Operative — Job-level repairs\n\n### Telegram Bot\n- Bot: @SocialHomesBot\n- Chat ID: socialhomes:8020560167\n- MCP tools: send_message, continue_chat, notify_user, end_chat\n\n---\n\n## Session 5 — 2026-02-15\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 2 Complete: All 7 Killer Differentiators Implemented\n\n**Backend Services Created (7 new files):**\n| Service | File | Description |\n|---------|------|-------------|\n| Predictive Damp Intelligence | `server/src/services/damp-prediction.ts` | 5-factor weighted algorithm (weather 0.25, building 0.25, history 0.20, sensor 0.20, occupancy 0.10) |\n| Live Crime Context for ASB | `server/src/services/crime-context.ts` | Police data correlation with internal ASB cases, hotspot analysis |\n| Automatic Vulnerability Detection | `server/src/services/vulnerability-detection.ts` | 7-factor scoring (deprivation, arrears, health, isolation, age, dependents, UC transition) |\n| Benefits Entitlement Engine | `server/src/services/benefits-engine.ts` | UK 2025/26 benefit rules analysis (UC, PIP, AA, Pension Credit, etc.) |\n| Property Passport | `server/src/services/property-passport.ts` | Multi-source property dossier aggregation |\n| AI Neighbourhood Briefing | `server/src/services/neighbourhood-briefing.ts` | Per-estate daily briefing combining all data sources |\n| Mock Tier 3 Services | `server/src/services/mock-services.ts` | DWP UC verification, IoT sensors, GoCardless, NOMIS labour market |\n\n**API Routes Added (14 new endpoints in `server/src/routes/ai.ts`):**\n- D1: `GET /damp-risk/:propertyId`, `GET /damp-risk/estate/:estateId`\n- D2: `GET /crime-context/:estateId`, `GET /crime-context/case/:caseId`\n- D3: `GET /vulnerability/:tenantId`, `POST /vulnerability/scan`\n- D4: `GET /benefits-check/:tenantId`\n- D5: `GET /property-passport/:propertyId`\n- D6: `GET /briefing/:estateId`\n- Mocks: `GET /mock/uc-verification/:tenantId`, `GET /mock/iot-sensors/:propertyId`, `GET /mock/direct-debit/:tenantId`, `GET /mock/labour-market/:lsoaCode`\n\n**Frontend Components Created (4 new panels):**\n- `DampIntelligencePanel.tsx` — score badge, factor bars, recommendations\n- `VulnerabilityPanel.tsx` — 7-factor assessment, detected flags, actions\n- `BenefitsPanel.tsx` — entitlement list with status icons, unclaimed amounts\n- `NeighbourhoodBriefingPanel.tsx` — 6 summary cards, officer briefing, action items\n\n**Frontend Pages Updated:**\n- `PropertyDetailPage.tsx` — DampIntelligencePanel replaces static damp display\n- `TenancyDetailPage.tsx` — VulnerabilityPanel + BenefitsPanel added\n- `AiCentrePage.tsx` — New Differentiators tab with 6 feature cards + vulnerability scan\n- `api-client.ts` — 13 new AI API methods\n- `useApi.ts` — 10 new React Query hooks\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,395 modules, 38.43s\n- All clean on first attempt\n\n### Commits:\n- `4ce6faa` — feat: implement all 7 Killer Differentiators — AI services, API routes, and frontend panels (17 files, 3094 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 2 marked as DONE (all 14 tasks)\n\n---\n\n## Session 6 — 2026-02-16\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Phase 3 Complete: Enrichment — GOV.UK Notify, Tier 2 APIs, Accessibility\n\n**New Backend Services (2 files):**\n| Service | File | Lines | Description |\n|---------|------|-------|-------------|\n| GOV.UK Notify Templates | `server/src/services/govuk-notify.ts` | 1,257 | 24 templates across 7 categories (rent-arrears, repairs, asb, compliance, tenancy, damp-mould, general) with `((field))` personalisation rendering |\n| Census/NOMIS/Gas Safe/Electrical | `server/src/services/census-nomis.ts` | 493 | Census 2021 (ONS via NOMIS datasets NM_2072_1, NM_2021_1), NOMIS labour market (NM_162_1, NM_17_5), Gas Safe Register verification, Electrical Safety Register verification — all with fetchWithCache + simulated fallbacks |\n\n**API Routes Added (8 new endpoints):**\n- GOV.UK Notify (in `server/src/routes/ai.ts`): `GET /notify/templates`, `GET /notify/templates/:category`, `GET /notify/template/:id`, `POST /notify/render`\n- Census/NOMIS (in `server/src/routes/public-data.ts`): `GET /census/:lsoaCode`, `GET /nomis/:lsoaCode`, `GET /gas-safe/:registrationNumber`, `GET /electrical-safety/:registrationNumber`\n\n**Frontend Enhancements (5 files modified):**\n- `BriefingPage.tsx` — Estate selector + NeighbourhoodBriefingPanel accordion between AI Predictions and Compliance\n- `RepairDetailPage.tsx` — Gas Safe (green) and NICEIC (blue) contractor verification badges conditional on trade type\n- `ExplorePage.tsx` — Data layer toggle buttons (Crime/Damp/Compliance) in bottom bar with active/inactive state\n- `api-client.ts` — 8 new API methods (4 notify + 4 publicData)\n\n**Accessibility Fixes (WCAG AA):**\n- `ActionModal.tsx` — Focus trap (Tab wrapping), Escape key handler, `role=\"dialog\"`, `aria-modal`, `aria-labelledby`, `aria-describedby`, previous focus restoration, form validation with inline errors (`errors`/`touched` state), `noValidate` + custom validation, `aria-required`/`aria-invalid`/`aria-describedby` on inputs, `htmlFor` on labels\n- `index.css` — `*:focus-visible` outline styles, `@media (prefers-reduced-motion: reduce)` disables animations, `.sr-only` screen reader class, `.skip-to-content` skip link, `.field-error` validation styles\n- `Layout.tsx` — Skip-to-content link + `id=\"main-content\"` on `<main>`\n- `Sidebar.tsx` — `aria-label=\"Main navigation\"` on `<nav>`, `aria-label` on collapse button\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,396 modules, 39.22s — all clean\n- Server build: clean\n\n### Files Changed: 13 modified + 2 new (523 insertions)\n\n### Commits:\n- `e4aa674` — feat: Phase 3 Enrichment — GOV.UK Notify, Census/NOMIS APIs, accessibility (13 files, 2298 insertions)\n\n### EXECUTION-PLAN.md updated:\n- Phase 3 marked as DONE (14 of 17 tasks completed, 3 deferred)\n\n---\n\n#### Phase 4 Complete: Completion — Mock Services, Admin Dashboard, Security, Monitoring\n\n**Mock Service Endpoints (5 new in `server/src/services/mock-services.ts`):**\n| Service | Function | Description |\n|---------|----------|-------------|\n| Plentific/Fixflo | `mockRepairsMarketplace(caseId)` | Contractor dispatch, quotes, scheduling, satisfaction |\n| RSH/CORE/Ombudsman | `mockRegulatorySubmission(type, refId)` | IDA returns, CORE lettings/sales, ombudsman escalations, compliance scores |\n| DocuSign | `mockSigningEnvelope(documentType, tenantId)` | Tenancy agreements, Section 21, gas certs, ATP — envelope tracking with recipients |\n| Experian/TransUnion | `mockReferencingResult(applicantId)` | Credit scores, affordability checks, CCJs, previous addresses, recommendations |\n| Land Registry | `mockLandRegistryTitle(propertyId)` | Title numbers, freehold/leasehold, price paid, lease details, restrictions |\n\n**Admin Integration Dashboard:**\n- New page: `app/src/pages/admin/IntegrationsPage.tsx` (329 lines)\n- 20 integrations across 3 tiers with status dots, tier badges, cache hit rate bars\n- Toggle enable/disable + Test Connection buttons\n- Summary bar: total, active, issues, avg response time\n- 3 new admin routes: GET /integrations, POST /toggle, POST /test\n- Updated App.tsx routing to use IntegrationsPage\n\n**Security Hardening:**\n- CSP enabled with whitelist for Google APIs, Firebase, OSM tiles, Google Fonts\n- CORS tightened to allowed origins (localhost + Cloud Run URL)\n- New `server/src/middleware/rate-limiter.ts` — sliding window, 4 tiers (API 100/min, Auth 10/min, AI 30/min, Admin 20/min)\n- Security headers: Permissions-Policy, X-Content-Type-Options, Referrer-Policy\n- Request correlation ID via X-Request-ID (crypto.randomUUID)\n- Enhanced error handler: structured JSON logging, no stack leaks in production\n- JSON body limit reduced from 10mb to 1mb\n\n**Production Monitoring:**\n- New `server/src/services/monitoring.ts` — metrics singleton (request counts, response times, status codes, endpoint hits, cache stats)\n- New `server/src/middleware/metrics.ts` — records every request on res.finish\n- Enhanced /health endpoint: Firestore connectivity check, memory usage, uptime, degraded/unhealthy states\n- New admin route: GET /api/v1/admin/monitoring\n- Frontend API client: adminApi.monitoring()\n\n**API Routes Added (8 new):**\n- 5 mock routes: /mock/repairs-marketplace, /mock/regulatory, /mock/signing, /mock/referencing, /mock/land-registry\n- 3 admin routes: /admin/integrations, /admin/integrations/:id/toggle, /admin/integrations/:id/test\n\n### Build Results:\n- TypeScript (server): 0 errors\n- TypeScript (app): 0 errors\n- Vite build: 3,397 modules, 35.59s — all clean\n- Server build: clean\n\n### New Files: 4 (rate-limiter.ts, monitoring.ts, metrics.ts, IntegrationsPage.tsx)\n### Modified Files: 6 (mock-services.ts, ai.ts, admin.ts, index.ts, error-handler.ts, api-client.ts, App.tsx, EXECUTION-PLAN.md)\n\n### EXECUTION-PLAN.md updated:\n- Phase 4 marked as DONE (11 of 14 tasks completed, 3 deferred)\n\n---\n\n## Session 7 — 2026-02-16 (Cloud Run Deployment)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Claude Opus 4.6\n\n### What happened:\n\n#### Task 11: Cloud Run Deployment — Secret Manager + Deploy\n\n**Problem:** Previous deployment attempts failed:\n1. `gcloud builds submit --config=cloudbuild.yaml` → Artifact Registry repo `socialhomes/app` not found (actual repo is `cloud-run-source-deploy/socialhomes`)\n2. `gcloud run deploy --source .` → Docker image built successfully, but revision creation failed: \"Secret Manager API has not been used in project 587984201316\"\n\n**Resolution:**\n1. Enabled Secret Manager API: `gcloud services enable secretmanager.googleapis.com`\n2. Created 4 secrets in Secret Manager:\n   | Secret | Value Source |\n   |--------|-------------|\n   | FIREBASE_API_KEY | `REDACTED` (from git history) |\n   | FIREBASE_AUTH_DOMAIN | `gen-lang-client-0146156913.firebaseapp.com` (from git history) |\n   | FIREBASE_PROJECT_ID | `gen-lang-client-0146156913` (from architecture reference) |\n   | DEMO_USER_PASSWORD | `SocialHomes2026!` (from git history) |\n3. Granted IAM `secretmanager.secretAccessor` role to Cloud Run service account (`587984201316-compute@developer.gserviceaccount.com`)\n4. Deployed using pre-built image from Artifact Registry:\n   ```\n   gcloud run deploy socialhomes \\\n     --image=europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes:latest \\\n     --region=europe-west2 --memory=1Gi --cpu=1 \\\n     --min-instances=0 --max-instances=10 --port=8080 \\\n     --update-secrets='FIREBASE_API_KEY=FIREBASE_API_KEY:latest,...'\n   ```\n\n**Result:**\n- Revision `socialhomes-00008-rhg` deployed — 100% traffic\n- Health check: `healthy`, Firestore connected (984ms latency)\n- Firebase config endpoint: secrets injected correctly\n- **New Service URL:** `https://socialhomes-587984201316.europe-west2.run.app`\n\n### Key Discoveries:\n- GCP project `gen-lang-client-0878518473` has project number `587984201316`\n- Service URL changed from `socialhomes-674258130066` to `socialhomes-587984201316` (project number in URL)\n- Artifact Registry repo path: `cloud-run-source-deploy/socialhomes` (not `socialhomes/app` as in cloudbuild.yaml)\n- `cloudbuild.yaml` needs updating if Cloud Build CI/CD is to be used in future\n\n### Architecture Reference (updated):\n- **Live app:** https://socialhomes-587984201316.europe-west2.run.app\n- **GCP Project ID:** gen-lang-client-0878518473\n- **GCP Project Number:** 587984201316\n- **Firebase Project:** gen-lang-client-0146156913\n- **Artifact Registry:** `europe-west2-docker.pkg.dev/gen-lang-client-0878518473/cloud-run-source-deploy/socialhomes`\n- **Secrets:** 4 secrets in Secret Manager (FIREBASE_API_KEY, FIREBASE_AUTH_DOMAIN, FIREBASE_PROJECT_ID, DEMO_USER_PASSWORD)\n\n---\n\n## Session 8 — 2026-02-18 (Business Analyst Session)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Project Analysis & Specification Documents\n\nPerformed full project analysis covering:\n- All 73 frontend TypeScript files across 19 page directories\n- All 43 backend TypeScript files (routes, services, middleware, models)\n- 3 existing specification documents (Doc1, Doc2, Doc3 at project root)\n- All operational documents (CLAUDE.md, DEVOPS.md, DEV-FIX-LIST.md, SESSION-HISTORY.md)\n- Package.json files, Dockerfile, cloudbuild.yaml, Firestore configs\n\n#### Created 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** — Core product specification\n   - 9 sections: Product Overview, 16 Functional Modules, Persona System, AI Features, Data Model, UI Design, Regulatory Compliance, Non-Functional Requirements, Current Status\n   - Covers all 40+ routes, 8 prediction models, 7 killer differentiators\n   - Documents WCAG AA accessibility, 5 personas, Awaab's Law compliance\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** — Technical architecture & data models\n   - 10 sections: System Architecture, Tech Stack, Frontend Architecture, Backend Architecture, Data Models (Firestore schemas), API Architecture (50+ endpoints), External API Integration, Security, Deployment, Monitoring\n   - Full ASCII architecture diagram, middleware pipeline, rate limiting tiers\n   - Complete Firestore collection schemas (Property, Tenant, Case, Repair, Complaint, ASB, ExternalDataCache, Integration)\n\n3. **Doc3-socialhomes-API-Requirements.txt** — API & integration requirements\n   - 11 sections: API Overview, Tier 1 (3 live), Tier 2 (6 live), Tier 3 (8 mock), 7 Killer Differentiator Services, GOV.UK Notify (24 templates), Caching Architecture, Rate Limiting, Error Handling, Security, Future Roadmap\n   - Every API documented with: base URL, endpoints used, server route, cache TTL, rate limit, fallback strategy, data returned, used-by references\n\n#### Updated EXECUTION-PLAN.md (v2.0):\n\n- Preserved Phases 0–4 (all DONE) with progress counts\n- Added Phase 5: Evolution (32 new tasks across 5 sub-phases):\n  - 5.1: Project Setup & Architecture (7 tasks) — BA specs, AI architecture, WebSocket design, SaaS strategy, API docs\n  - 5.2: Backend Development (10 tasks) — Vertex AI, WebSocket, notifications, circuit breaker, cache warming, scheduling\n  - 5.3: Frontend Development (8 tasks) — Chat UI, real-time notifications, workflow builder, theme toggle, mobile responsive\n  - 5.4: Testing & QA (7 tasks) — Regression suite, unit tests, integration tests, load testing, a11y audit, CI pipeline\n  - 5.5: DevOps & Deployment (8 tasks) — Staging env, monitoring alerts, backups, CDN, custom domain, runbook\n- Added deferred items cross-reference table\n- Added Phase 5 metrics targets\n- Updated plan summary table\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (NEW)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (NEW)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (NEW)\n- `EXECUTION-PLAN.md` (UPDATED — v1.0 → v2.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 8)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Specification documents placed in `docs/requirements/` (new directory) — separate from original Doc1/Doc2/Doc3 at project root\n- Phase 5 organized into 5 sub-phases matching the required agent structure (setup, backend, frontend, testing, devops)\n- Tasks 5.1.1 and 5.1.2 marked as DONE (this session's output)\n- Deferred items from Phases 3–4 formally cross-referenced into Phase 5 tasks\n- Future roadmap includes Phase 6 (Enterprise Integrations) as a placeholder\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (30 remaining tasks)\n- Next priority: 5.1.3 (Vertex AI architecture), 5.2.1 (Vertex AI integration), 5.5.1 (Fix cloudbuild.yaml)\n\n---\n\n## Session 9 — 2026-02-23 (Business Analyst Session — Spec Refresh)\n**Working directory:** `/mnt/c/.netapps/socialhomes`\n**Agent:** Business Analyst Agent (Claude Opus 4.6)\n\n### What happened:\n\n#### Task: Comprehensive Specification Refresh (v2.0 → v3.0)\n\nPerformed full project re-analysis and updated all specification documents to v3.0.\nThis session built upon Session 8's initial docs with significantly enhanced content.\n\n#### Updated 3 Specification Documents in `docs/requirements/`:\n\n1. **Doc1-socialhomes-Base-Specification.txt** (v3.0) — Core product specification\n   - Enhanced with full content from original root-level Doc1 + Doc2 (AI-native features)\n   - 10 sections: Product Overview (with 5 estates detail), 17 Functional Modules\n     (added Global Search), Persona System (with AI focus per persona), AI-Native\n     Features (dynamic elements, action flow pattern, Yantra Assist, 8 models,\n     7 differentiators, AI-augmented workflows, signature interactions),\n     Data Model, UI Design (full colour palette, typography, component library),\n     Regulatory Compliance, Non-Functional Requirements, Simulated Data, Current Status\n   - Merged AI-native features spec into main Doc1 for single-source-of-truth\n\n2. **Doc2-socialhomes-Technical-Architecture.txt** (v3.0) — Technical architecture\n   - Enhanced with precise version numbers from package.json files\n   - Added request flow diagram, middleware pipeline detail\n   - Added accessibility implementation section\n   - Added Firestore security rules and indexes references\n   - Added infrastructure references (GCP project IDs, URLs)\n   - Added Entire.io to infrastructure table\n\n3. **Doc3-socialhomes-API-Requirements.txt** (v3.0) — API & integration requirements\n   - Cleaned up and made consistent with Doc2 endpoint registry\n   - Added NOMIS Labour Market extended mock (4.9)\n   - Enhanced future roadmap with Phase 6 enterprise integrations\n   - Added GOV.UK Notify API endpoints section (6.4)\n\n#### Updated EXECUTION-PLAN.md (v2.0 → v3.0):\n\n- Expanded from 32 to 38 Phase 5 tasks (6 new tasks added):\n  - 5.1.8: Firestore data migration strategy\n  - 5.2.11: AI communication drafting with Vertex AI\n  - 5.2.12: Tenant activity scoring\n  - 5.3.9: Real-time case status indicators\n  - (Renumbered existing tasks for consistency)\n- Added detailed task descriptions with specific implementation details\n- Added \"Phase 5 Task Summary by Agent\" section with counts per priority\n- Added \"Recommended Execution Order (Critical Path)\" with sprint-by-sprint plan\n- Added dependency chains (e.g., 5.1.3 → 5.2.1 → 5.2.2 for Vertex AI)\n\n### Files Changed:\n- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v2.0 → v3.0)\n- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v2.0 → v3.0)\n- `EXECUTION-PLAN.md` (UPDATED — v2.0 → v3.0)\n- `SESSION-HISTORY.md` (UPDATED — added Session 9)\n\n### Commits:\n- (pending — awaiting user instruction to commit)\n\n### Decisions Taken:\n- Merged AI-native features (from root Doc2) into docs/requirements/Doc1 for single source\n- Added 6 new Phase 5 tasks (38 total, up from 32) based on deeper analysis\n- Created sprint-by-sprint critical path execution order\n- Added agent task summary with priority breakdown\n- Tasks 5.1.1 and 5.1.2 re-marked as DONE (this session's updated output)\n- Total Phase 5: 38 tasks (2 DONE, 36 TODO)\n\n### Pending Work:\n- Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)\n- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)\n- Sprint 9 focus: Architecture decisions + backend foundation + CI fix\n","structuredPatch":[{"oldStart":499,"oldLines":3,"newStart":499,"newLines":71,"lines":[" - Phase 5 tasks 5.1.3–5.5.8 all at TODO status (36 remaining tasks)"," - Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)"," - Sprint 9 focus: Architecture decisions + backend foundation + CI fix","+","+---","+","+## Session 10 — 2026-02-25 (Business Analyst Session — Spec Refresh v6.0)","+**Working directory:** `/mnt/c/.netapps/socialhomes`","+**Agent:** Business Analyst Agent (Claude Opus 4.6)","+","+### What happened:","+","+#### Task: Comprehensive Specification Refresh (v5.0 -> v6.0)","+","+Performed full project re-analysis with deep codebase exploration (40 tool calls","+across all 116+ TypeScript files) and updated all specification documents to v6.0.","+","+#### Updated 3 Specification Documents in `docs/requirements/`:","+","+1. **Doc1-socialhomes-Base-Specification.txt** (v6.0) — Core product specification","+   - Refreshed and validated all 17 functional modules against codebase","+   - Updated Phase 5 task count to 50 (from 44)","+   - Confirmed all 7 AI differentiators implemented and documented","+   - Validated 5 persona definitions with AI focus areas","+","+2. **Doc2-socialhomes-Technical-Architecture.txt** (v6.0) — Technical architecture","+   - Validated all version numbers against package.json files","+   - Confirmed 50+ API endpoints across 16 route modules","+   - Validated all Firestore schemas against firestore-schemas.ts","+   - Confirmed 17 composite indexes and security rules","+","+3. **Doc3-socialhomes-API-Requirements.txt** (v6.0) — API & integration requirements","+   - All 20 integrations documented (3 Tier 1, 6 Tier 2, 9 Tier 3 mock)","+   - 7 killer differentiator services fully specified with algorithms","+   - 24 GOV.UK Notify templates across 7 categories","+   - Cache TTL, rate limiting, and fallback strategies documented","+","+#### Updated EXECUTION-PLAN.md (v5.0 -> v6.0):","+","+- Expanded Phase 5 from 44 to **50 tasks** (6 new tasks added):","+  - 5.2.15: File upload service (Cloud Storage, image compression, virus scanning)","+  - 5.2.16: GDPR data export pipeline (SAR processing, PII redaction)","+  - 5.3.11: Admin user management page (CRUD, role assignment, bulk import)","+  - 5.3.12: GDPR compliance dashboard (SAR tracker, retention policies)","+  - Added new dependency chains for File/Data workflows","+- Updated task summary: BA 3, Fullstack 23, Frontend 12, Tester 8, DevOps 9","+- All doc version references updated to v6.0","+- Refreshed critical path execution order with new tasks","+","+### Files Changed:","+- `docs/requirements/Doc1-socialhomes-Base-Specification.txt` (UPDATED — v5.0 -> v6.0)","+- `docs/requirements/Doc2-socialhomes-Technical-Architecture.txt` (UPDATED — v5.0 -> v6.0)","+- `docs/requirements/Doc3-socialhomes-API-Requirements.txt` (UPDATED — v5.0 -> v6.0)","+- `EXECUTION-PLAN.md` (UPDATED — v5.0 -> v6.0, 44 -> 50 tasks)","+- `SESSION-HISTORY.md` (UPDATED — added Session 10)","+","+### Commits:","+- (pending — awaiting user instruction to commit)","+","+### Decisions Taken:","+- Added 6 new Phase 5 tasks covering file upload, GDPR compliance, and admin management","+- Total Phase 5: 50 tasks (2 DONE, 48 TODO)","+- New dependency chains added: File/Data Chain linking upload -> portal, GDPR -> dashboard","+- All documents validated against actual codebase (no stale references)","+- Maintained backward compatibility with all existing task IDs","+","+### Pending Work:","+- Phase 5 tasks 5.1.3–5.5.9 all at TODO status (48 remaining tasks)","+- Critical path starts with: 5.1.3 (Vertex AI architecture), 5.1.4 (WebSocket design), 5.5.1 (Fix cloudbuild.yaml)","+- Sprint 9 focus: Architecture decisions + backend foundation + CI fix","+- Next BA task: 5.1.7 (OpenAPI/Swagger spec) — scheduled for Sprint 14"]}],"userModified":false,"replaceAll":false},"sourceToolAssistantUUID":"713809f2-8a1b-4848-a57d-81959a876912"}
{"parentUuid":"f3c25948-af7c-480a-b0fd-d6eb28ca7fb3","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","message":{"model":"claude-opus-4-6","id":"msg_01VfPX35iTKCBMCiYUSP6mF5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Gjd2dHnhNhcVGZXLCyLEwi","name":"TodoWrite","input":{"todos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"completed","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"caller":{"type":"direct"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1424,"cache_read_input_tokens":123689,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1424},"output_tokens":25,"service_tier":"standard","inference_geo":"not_available"}},"requestId":"req_011CYVMi7aYQay483iHGjnMw","type":"assistant","uuid":"7cb77cd1-0a34-4aa4-ac2a-7d9dc5aa98eb","timestamp":"2026-02-25T19:42:29.147Z"}
{"parentUuid":"7cb77cd1-0a34-4aa4-ac2a-7d9dc5aa98eb","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Gjd2dHnhNhcVGZXLCyLEwi","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"c97d780e-ac57-4b63-b903-ae8568703f2f","timestamp":"2026-02-25T19:42:29.157Z","toolUseResult":{"oldTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"in_progress","activeForm":"Updating SESSION-HISTORY.md with session summary"}],"newTodos":[{"content":"Analyze existing specification documents and codebase","status":"completed","activeForm":"Analyzing existing specification documents and codebase"},{"content":"Update Doc1-socialhomes-Base-Specification.txt to v6.0","status":"completed","activeForm":"Updating Doc1 Base Specification to v6.0"},{"content":"Update Doc2-socialhomes-Technical-Architecture.txt to v6.0","status":"completed","activeForm":"Updating Doc2 Technical Architecture to v6.0"},{"content":"Update Doc3-socialhomes-API-Requirements.txt to v6.0","status":"completed","activeForm":"Updating Doc3 API Requirements to v6.0"},{"content":"Update EXECUTION-PLAN.md with refreshed Phase 5 tasks","status":"completed","activeForm":"Updating EXECUTION-PLAN.md with refreshed Phase 5 tasks"},{"content":"Update SESSION-HISTORY.md with session summary","status":"completed","activeForm":"Updating SESSION-HISTORY.md with session summary"}]},"sourceToolAssistantUUID":"7cb77cd1-0a34-4aa4-ac2a-7d9dc5aa98eb"}
{"parentUuid":"c97d780e-ac57-4b63-b903-ae8568703f2f","isSidechain":false,"userType":"external","cwd":"/mnt/c/.netapps/socialhomes","sessionId":"581422cf-3f4d-48aa-b2f6-552d4ab11ae5","version":"2.1.56","gitBranch":"main","slug":"tidy-plotting-raccoon","type":"assistant","uuid":"9063a8d4-4c5a-4264-99e8-8578e5770036","timestamp":"2026-02-25T19:42:31.672Z","message":{"id":"1c748bcf-ec9c-48ba-9620-29a1045a2043","container":null,"model":"<synthetic>","role":"assistant","stop_reason":"stop_sequence","stop_sequence":"","type":"message","usage":{"input_tokens":0,"output_tokens":0,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":null,"cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":0},"inference_geo":null,"iterations":null,"speed":null},"content":[{"type":"text","text":"You've hit your limit · resets 12am (Europe/London)"}],"context_management":null},"error":"rate_limit","isApiErrorMessage":true}
